/*!
 * Universal, Accessible Video Player
 * (c) 2026 Matthias Peltzer
 * Released under GPL-2.0-or-later License
 */
(()=>{var Pe=Object.defineProperty;var Te=Object.getOwnPropertySymbols;var at=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable;var Ee=(u,e,t)=>e in u?Pe(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t,V=(u,e)=>{for(var t in e||(e={}))at.call(e,t)&&Ee(u,t,e[t]);if(Te)for(var t of Te(e))nt.call(e,t)&&Ee(u,t,e[t]);return u};var D=(u,e)=>()=>(u&&(e=u(u=0)),e);var H=(u,e)=>{for(var t in e)Pe(u,t,{get:e[t],enumerable:!0})};var g,F=D(()=>{g={createElement(u,e={}){let t=document.createElement(u);if(e.className&&(t.className=e.className),e.attributes)for(let[i,s]of Object.entries(e.attributes))t.setAttribute(i,s);if(e.innerHTML&&(t.innerHTML=e.innerHTML),e.textContent&&(t.textContent=e.textContent),e.style&&Object.assign(t.style,e.style),e.children)for(let i of e.children)i&&t.appendChild(i);return t},show(u){u!=null&&u.style&&(u.style.display="")},hide(u){u!=null&&u.style&&(u.style.display="none")},fadeIn(u,e=300,t){if(u&&(u.style.opacity="0",u.style.display="",u.style.transition="opacity ".concat(e,"ms ease"),u.offsetHeight,u.style.opacity="1",t)){let i=()=>{u.removeEventListener("transitionend",i),t()};u.addEventListener("transitionend",i,{once:!0}),setTimeout(i,e+50)}},fadeOut(u,e=300,t){if(!u)return;u.style.transition="opacity ".concat(e,"ms ease"),u.style.opacity="0";let i=()=>{u.removeEventListener("transitionend",i),u.style.display="none",t&&t()};u.addEventListener("transitionend",i,{once:!0}),setTimeout(i,e+50)},offset(u){if(!u)return{top:0,left:0,width:0,height:0};let e=u.getBoundingClientRect();return{top:e.top+window.scrollY,left:e.left+window.scrollX,width:e.width,height:e.height}},escapeHTML(u){let e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"};return u.replace(/[&<>"']/g,t=>e[t])},sanitizeHTML(u){let e=u.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+\s*=/gi,"").replace(/javascript:/gi,""),t=document.createElement("div");return t.innerHTML=e,t.innerHTML},createTooltip(u,e="vidply"){return this.createElement("span",{className:"".concat(e,"-tooltip"),textContent:u,attributes:{"aria-hidden":"true"}})},attachTooltip(u,e,t="vidply"){var o;if(!u||!e)return;(o=u.querySelector(".".concat(t,"-tooltip")))==null||o.remove();let i=this.createTooltip(e,t);u.appendChild(i);let s="".concat(t,"-tooltip-visible"),a=()=>i.classList.add(s),n=()=>i.classList.remove(s);u.addEventListener("mouseenter",a),u.addEventListener("mouseleave",n),u.addEventListener("focus",a),u.addEventListener("blur",n)},createButtonText(u,e="vidply"){return this.createElement("span",{className:"".concat(e,"-button-text"),textContent:u,attributes:{"aria-hidden":"true"}})},addClass(u,e){var t;(t=u==null?void 0:u.classList)==null||t.add(e)},removeClass(u,e){var t;(t=u==null?void 0:u.classList)==null||t.remove(e)},toggleClass(u,e){var t;(t=u==null?void 0:u.classList)==null||t.toggle(e)},hasClass(u,e){var t,i;return(i=(t=u==null?void 0:u.classList)==null?void 0:t.contains(e))!=null?i:!1}}});var xe,Ce=D(()=>{xe={player:{label:"Video Player",play:"Play",pause:"Pause",stop:"Stop",restart:"Restart from beginning",rewind:"Rewind",forward:"Forward",rewindSeconds:"Rewind {seconds} seconds",forwardSeconds:"Forward {seconds} seconds",previous:"Previous track",next:"Next track",playlist:"Toggle playlist",volume:"Volume",mute:"Mute",unmute:"Unmute",fullscreen:"Fullscreen",exitFullscreen:"Exit Fullscreen",captions:"Captions",chapters:"Chapters",quality:"Quality",captionStyling:"Caption styling",transcript:"Toggle transcript",audioDescription:"Audio description",signLanguage:"Sign language video",settings:"Settings",speed:"Playback Speed",pip:"Picture in Picture",currentTime:"Current time",duration:"Duration",progress:"Progress",seekForward:"Seek forward {seconds} seconds",seekBackward:"Seek backward {seconds} seconds",volumeUp:"Volume up",volumeDown:"Volume down",loading:"Loading...",loadingChapters:"Loading chapters...",error:"Error loading media",buffering:"Buffering...",signLanguageVideo:"Sign Language Video",closeSignLanguage:"Close sign language video",signLanguageSettings:"Sign language settings",startPlaybackFirst:"Please start playback first.",startPlaybackForAudioDescription:"Please start playback first to use audio description.",startPlaybackForSignLanguage:"Please start playback first to use sign language video.",noChapters:"No chapters available",noCaptions:"No captions available",auto:"Auto",autoQuality:"Auto (no quality selection available)",noQuality:"Quality selection not available",signLanguageDragResize:"Sign Language Video - Press D to drag with keyboard, R to resize",signLanguageDragActive:"Sign Language Video - Drag mode active. Use arrow keys to move, Escape to exit.",signLanguageResizeActive:"Sign Language Video - Resize mode active. Use left/right arrow keys to resize, Escape to exit.",enableSignDragMode:"Enable drag mode. Shortcut: D key",disableSignDragMode:"Disable drag mode. Shortcut: D key",enableSignDragModeAria:"Enable toggle keyboard drag mode with arrow keys. Shortcut: D key",disableSignDragModeAria:"Disable toggle keyboard drag mode with arrow keys. Shortcut: D key",enableSignResizeMode:"Enable resize mode. Shortcut: R key",disableSignResizeMode:"Disable resize mode. Shortcut: R key",enableSignResizeModeAria:"Enable keyboard resize mode with arrow keys. Shortcut: R key",disableSignResizeModeAria:"Disable keyboard resize mode with arrow keys. Shortcut: R key",resizeHandle:"Resize {direction} corner",moreOptions:"More options",noMoreOptions:"No additional options available"},captions:{off:"Off",select:"Select captions",fontSize:"Font Size",fontFamily:"Font Family",color:"Text Color",backgroundColor:"Background Color",opacity:"Opacity"},fontSizes:{small:"Small",normal:"Normal",large:"Large",xlarge:"X-Large"},fontFamilies:{sansSerif:"Sans-serif",serif:"Serif",monospace:"Monospace"},styleLabels:{textColor:"Text Color",background:"Background",font:"Font",fontSize:"Font Size",opacity:"Opacity"},audioDescription:{enable:"Enable audio description",disable:"Disable audio description"},signLanguage:{show:"Show sign language video",hide:"Hide sign language video",showInMainView:"Show sign language in main video",hideInMainView:"Hide sign language from main video"},transcript:{title:"Transcript",ariaLabel:"Video Transcript",close:"Close transcript",loading:"Loading transcript...",noTranscript:"No transcript available for this video.",settings:"Transcript settings. Press Enter to open menu, or D to enable drag mode",keyboardDragMode:"Toggle keyboard drag mode with arrow keys. Shortcut: D key",keyboardDragActive:"⌨️ Keyboard Drag Mode Active (Arrow keys to move, Shift+Arrows for large steps, D or ESC to exit)",dragResizePrompt:"Press D to drag or R to resize. Use Home to reset position, Esc to close.",dragModeEnabled:"Keyboard drag mode enabled. Use arrow keys to move, Shift+Arrow for larger steps. Press D or Esc to exit.",dragModeDisabled:"Keyboard drag mode disabled.",enableDragMode:"Enable drag mode. Shortcut: D key",disableDragMode:"Disable drag mode. Shortcut: D key",enableDragModeAria:"Enable toggle keyboard drag mode with arrow keys. Shortcut: D key",disableDragModeAria:"Disable toggle keyboard drag mode with arrow keys. Shortcut: D key",resizeWindow:"Resize Window",disableResizeWindow:"Disable Resize Mode",enableResizeMode:"Enable resize mode. Shortcut: R key",disableResizeMode:"Disable resize mode. Shortcut: R key",enableResizeModeAria:"Enable keyboard resize mode with arrow keys. Shortcut: R key",disableResizeModeAria:"Disable keyboard resize mode with arrow keys. Shortcut: R key",resizeModeHint:"Resize handles enabled. Drag edges or corners to adjust. Press Esc or R to exit.",resizeModeEnabled:"Resize mode enabled. Drag edges or corners to adjust. Press Esc or R to exit.",resizeModeDisabled:"Resize mode disabled.",positionReset:"Transcript position reset.",styleTranscript:"Open transcript style settings",closeMenu:"Close Menu",styleTitle:"Transcript Style",autoscroll:"Autoscroll",settingsMenu:"Transcript dialog settings",showTimestamps:"Show timestamps",hideTimestamps:"Hide timestamps",showTimestampsAria:"Show timestamps in transcript",hideTimestampsAria:"Hide timestamps in transcript"},settings:{title:"Settings",quality:"Quality",speed:"Speed",captions:"Captions",language:"Language",reset:"Reset to defaults",close:"Close"},speeds:{normal:"Normal"},time:{display:"Time display",durationPrefix:"Duration: ",of:"of",hour:"{count} hour",hours:"{count} hours",minute:"{count} minute",minutes:"{count} minutes",second:"{count} second",seconds:"{count} seconds"},playlist:{title:"Playlist",trackOf:"Track {current} of {total}",nowPlaying:"Now playing: Track {current} of {total}. {title}{artist}",by:" by ",untitled:"Untitled",trackUntitled:"Track {number}",currentlyPlaying:"Currently playing",notPlaying:"Not playing",pressEnterPlay:"Press Enter to play",pressEnterRestart:"Press Enter to restart",keyboardInstructions:"Playlist navigation: Use Up and Down arrow keys to move between tracks. Press Page Up or Page Down to skip 5 tracks. Press Home to go to first track, End to go to last track. Press Enter or Space to play the selected track.",endOfPlaylist:"End of playlist. {current} of {total}.",beginningOfPlaylist:"Beginning of playlist. 1 of {total}.",jumpedToLastTrack:"Jumped to last track. {current} of {total}.",jumpedToFirstTrack:"Jumped to first track. 1 of {total}.",firstTrack:"First track. 1 of {total}.",lastTrack:"Last track. {current} of {total}."}}});var De={};H(De,{de:()=>rt});var rt,Ae=D(()=>{rt={player:{label:"Videoplayer",play:"Abspielen",pause:"Pause",stop:"Stopp",restart:"Von vorne beginnen",rewind:"Zurückspulen",forward:"Vorspulen",rewindSeconds:"{seconds} Sekunden zurückspulen",forwardSeconds:"{seconds} Sekunden vorspulen",previous:"Vorheriger Titel",next:"Nächster Titel",playlist:"Wiedergabeliste umschalten",volume:"Lautstärke",mute:"Stumm",unmute:"Ton ein",fullscreen:"Vollbild",exitFullscreen:"Vollbild beenden",captions:"Untertitel",chapters:"Kapitel",quality:"Qualität",captionStyling:"Untertitel-Stil",transcript:"Transkript umschalten",audioDescription:"Audiodeskription",signLanguage:"Gebärdensprache-Video",settings:"Einstellungen",speed:"Wiedergabegeschwindigkeit",pip:"Bild-in-Bild",currentTime:"Aktuelle Zeit",duration:"Dauer",progress:"Fortschritt",seekForward:"{seconds} Sekunden vorspulen",seekBackward:"{seconds} Sekunden zurückspulen",volumeUp:"Lauter",volumeDown:"Leiser",loading:"Lädt...",loadingChapters:"Kapitel werden geladen...",error:"Fehler beim Laden",buffering:"Puffern...",signLanguageVideo:"Gebärdensprache-Video",closeSignLanguage:"Gebärdensprache-Video schließen",signLanguageSettings:"Gebärdensprache-Einstellungen",startPlaybackFirst:"Bitte starten Sie die Wiedergabe zuerst.",startPlaybackForAudioDescription:"Bitte starten Sie die Wiedergabe zuerst, um die Audiodeskription zu nutzen.",startPlaybackForSignLanguage:"Bitte starten Sie die Wiedergabe zuerst, um das Gebärdensprache-Video zu nutzen.",noChapters:"Keine Kapitel verfügbar",noCaptions:"Keine Untertitel verfügbar",auto:"Automatisch",autoQuality:"Automatisch (keine Qualitätsauswahl verfügbar)",noQuality:"Qualitätsauswahl nicht verfügbar",signLanguageDragResize:"Gebärdensprache-Video - Drücken Sie D zum Verschieben per Tastatur, R zum Ändern der Größe",signLanguageDragActive:"Gebärdensprache-Video - Verschiebemodus aktiv. Pfeiltasten zum Bewegen, Escape zum Beenden.",signLanguageResizeActive:"Gebärdensprache-Video - Größenänderungsmodus aktiv. Links-/Rechts-Pfeiltasten zum Ändern der Größe, Escape zum Beenden.",enableSignDragMode:"Verschiebemodus aktivieren. Tastenkombination: D-Taste",disableSignDragMode:"Verschiebemodus deaktivieren. Tastenkombination: D-Taste",enableSignDragModeAria:"Tastatur-Verschiebemodus mit Pfeiltasten aktivieren. Tastenkombination: D-Taste",disableSignDragModeAria:"Tastatur-Verschiebemodus mit Pfeiltasten deaktivieren. Tastenkombination: D-Taste",enableSignResizeMode:"Größenänderungsmodus aktivieren. Tastenkombination: R-Taste",disableSignResizeMode:"Größenänderungsmodus deaktivieren. Tastenkombination: R-Taste",enableSignResizeModeAria:"Tastatur-Größenänderungsmodus mit Pfeiltasten aktivieren. Tastenkombination: R-Taste",disableSignResizeModeAria:"Tastatur-Größenänderungsmodus mit Pfeiltasten deaktivieren. Tastenkombination: R-Taste",resizeHandle:"Größenänderung {direction}-Ecke",moreOptions:"Weitere Optionen",noMoreOptions:"Keine weiteren Optionen verfügbar"},captions:{off:"Aus",select:"Untertitel auswählen",fontSize:"Schriftgröße",fontFamily:"Schriftart",color:"Textfarbe",backgroundColor:"Hintergrundfarbe",opacity:"Deckkraft"},fontSizes:{small:"Klein",normal:"Normal",large:"Groß",xlarge:"Sehr groß"},fontFamilies:{sansSerif:"Sans-serif",serif:"Serif",monospace:"Monospace"},styleLabels:{textColor:"Textfarbe",background:"Hintergrund",font:"Schrift",fontSize:"Schriftgröße",opacity:"Deckkraft"},audioDescription:{enable:"Audiodeskription aktivieren",disable:"Audiodeskription deaktivieren"},signLanguage:{show:"Gebärdensprache-Video anzeigen",hide:"Gebärdensprache-Video ausblenden",showInMainView:"Gebärdensprache im Hauptvideo anzeigen",hideInMainView:"Gebärdensprache aus Hauptvideo entfernen"},transcript:{title:"Transkript",ariaLabel:"Video-Transkript",close:"Transkript schließen",loading:"Transkript wird geladen...",noTranscript:"Kein Transkript für dieses Video verfügbar.",settings:"Transkript-Einstellungen. Eingabetaste zum Öffnen des Menüs drücken oder D zum Aktivieren des Verschiebemodus",keyboardDragMode:"Tastatur-Verschiebemodus mit Pfeiltasten umschalten. Tastenkombination: D-Taste",keyboardDragActive:"⌨️ Tastatur-Verschiebemodus aktiv (Pfeiltasten zum Bewegen, Umschalt+Pfeiltasten für große Schritte, D oder ESC zum Beenden)",dragResizePrompt:"Drücken Sie D zum Verschieben oder R zur Größenänderung. Home setzt die Position zurück, Esc schließt.",dragModeEnabled:"Tastatur-Verschiebemodus aktiviert. Pfeiltasten zum Bewegen, Umschalt+Pfeiltasten für größere Schritte. D oder Esc zum Beenden.",dragModeDisabled:"Tastatur-Verschiebemodus deaktiviert.",enableDragMode:"Verschiebemodus aktivieren. Tastenkombination: D-Taste",disableDragMode:"Verschiebemodus deaktivieren. Tastenkombination: D-Taste",enableDragModeAria:"Tastatur-Verschiebemodus mit Pfeiltasten aktivieren. Tastenkombination: D-Taste",disableDragModeAria:"Tastatur-Verschiebemodus mit Pfeiltasten deaktivieren. Tastenkombination: D-Taste",resizeWindow:"Fenster vergrößern/verkleinern",disableResizeWindow:"Resize-Modus deaktivieren",enableResizeMode:"Größenänderungsmodus aktivieren. Tastenkombination: R-Taste",disableResizeMode:"Größenänderungsmodus deaktivieren. Tastenkombination: R-Taste",enableResizeModeAria:"Tastatur-Größenänderungsmodus mit Pfeiltasten aktivieren. Tastenkombination: R-Taste",disableResizeModeAria:"Tastatur-Größenänderungsmodus mit Pfeiltasten deaktivieren. Tastenkombination: R-Taste",resizeModeHint:"Griffe aktiviert. Ziehen Sie Kanten oder Ecken zum Anpassen. Esc oder R zum Beenden.",resizeModeEnabled:"Resize-Modus aktiviert. Kanten oder Ecken ziehen; Esc oder R beendet.",resizeModeDisabled:"Resize-Modus deaktiviert.",positionReset:"Transkriptposition zurückgesetzt.",styleTranscript:"Transkript-Stileinstellungen öffnen",closeMenu:"Menü schließen",styleTitle:"Transkript-Stil",autoscroll:"Auto-Scroll",settingsMenu:"Transkript-Dialog-Einstellungen",showTimestamps:"Zeitstempel anzeigen",hideTimestamps:"Zeitstempel ausblenden",showTimestampsAria:"Zeitstempel im Transkript anzeigen",hideTimestampsAria:"Zeitstempel im Transkript ausblenden"},settings:{title:"Einstellungen",quality:"Qualität",speed:"Geschwindigkeit",captions:"Untertitel",language:"Sprache",reset:"Zurücksetzen",close:"Schließen"},speeds:{normal:"Normal"},time:{display:"Zeitanzeige",durationPrefix:"Dauer: ",of:"von",hour:"{count} Stunde",hours:"{count} Stunden",minute:"{count} Minute",minutes:"{count} Minuten",second:"{count} Sekunde",seconds:"{count} Sekunden"},playlist:{title:"Wiedergabeliste",trackOf:"Titel {current} von {total}",nowPlaying:"Läuft gerade: Titel {current} von {total}. {title}{artist}",by:" von ",untitled:"Ohne Titel",trackUntitled:"Titel {number}",currentlyPlaying:"Wird gerade abgespielt",notPlaying:"Nicht aktiv",pressEnterPlay:"Eingabetaste zum Abspielen",pressEnterRestart:"Eingabetaste zum Neustart",keyboardInstructions:"Wiedergabelisten-Navigation: Verwenden Sie die Pfeiltasten nach oben und unten, um zwischen Titeln zu wechseln. Drücken Sie Bild auf oder Bild ab, um 5 Titel zu überspringen. Drücken Sie Pos1, um zum ersten Titel zu springen, Ende für den letzten Titel. Drücken Sie die Eingabetaste oder Leertaste, um den ausgewählten Titel abzuspielen.",endOfPlaylist:"Ende der Wiedergabeliste. {current} von {total}.",beginningOfPlaylist:"Anfang der Wiedergabeliste. 1 von {total}.",jumpedToLastTrack:"Zum letzten Titel gesprungen. {current} von {total}.",jumpedToFirstTrack:"Zum ersten Titel gesprungen. 1 von {total}.",firstTrack:"Erster Titel. 1 von {total}.",lastTrack:"Letzter Titel. {current} von {total}."}}});var ze={};H(ze,{es:()=>ot});var ot,Re=D(()=>{ot={player:{label:"Reproductor de video",play:"Reproducir",pause:"Pausa",stop:"Detener",restart:"Reiniciar desde el principio",rewind:"Retroceder",forward:"Avanzar",rewindSeconds:"Retroceder {seconds} segundos",forwardSeconds:"Avanzar {seconds} segundos",previous:"Pista anterior",next:"Siguiente pista",playlist:"Alternar lista de reproducción",volume:"Volumen",mute:"Silenciar",unmute:"Activar sonido",fullscreen:"Pantalla completa",exitFullscreen:"Salir de pantalla completa",captions:"Subtítulos",chapters:"Capítulos",quality:"Calidad",captionStyling:"Estilo de subtítulos",transcript:"Alternar transcripción",audioDescription:"Audiodescripción",signLanguage:"Video en lengua de señas",settings:"Configuración",speed:"Velocidad de reproducción",pip:"Imagen en imagen",currentTime:"Tiempo actual",duration:"Duración",progress:"Progreso",seekForward:"Avanzar {seconds} segundos",seekBackward:"Retroceder {seconds} segundos",volumeUp:"Subir volumen",volumeDown:"Bajar volumen",loading:"Cargando...",loadingChapters:"Cargando capítulos...",error:"Error al cargar",buffering:"Almacenando en búfer...",signLanguageVideo:"Video en Lengua de Señas",closeSignLanguage:"Cerrar video en lengua de señas",signLanguageSettings:"Configuración de lengua de señas",noChapters:"No hay capítulos disponibles",noCaptions:"No hay subtítulos disponibles",auto:"Automático",autoQuality:"Automático (selección de calidad no disponible)",noQuality:"Selección de calidad no disponible",signLanguageDragResize:"Video en Lengua de Señas - Presione D para arrastrar con el teclado, R para cambiar el tamaño",signLanguageDragActive:"Video en Lengua de Señas - Modo de arrastre activo. Use las teclas de flecha para mover, Escape para salir.",signLanguageResizeActive:"Video en Lengua de Señas - Modo de cambio de tamaño activo. Use las teclas de flecha izquierda/derecha para cambiar el tamaño, Escape para salir.",enableSignDragMode:"Activar modo de arrastre. Atajo: tecla D",disableSignDragMode:"Desactivar modo de arrastre. Atajo: tecla D",enableSignDragModeAria:"Activar modo de arrastre con teclado usando teclas de flecha. Atajo: tecla D",disableSignDragModeAria:"Desactivar modo de arrastre con teclado usando teclas de flecha. Atajo: tecla D",enableSignResizeMode:"Activar modo de cambio de tamaño. Atajo: tecla R",disableSignResizeMode:"Desactivar modo de cambio de tamaño. Atajo: tecla R",enableSignResizeModeAria:"Activar modo de cambio de tamaño con teclado usando teclas de flecha. Atajo: tecla R",disableSignResizeModeAria:"Desactivar modo de cambio de tamaño con teclado usando teclas de flecha. Atajo: tecla R",resizeHandle:"Cambiar tamaño esquina {direction}",moreOptions:"Más opciones",noMoreOptions:"No hay opciones adicionales disponibles"},captions:{off:"Desactivado",select:"Seleccionar subtítulos",fontSize:"Tamaño de fuente",fontFamily:"Familia de fuente",color:"Color de texto",backgroundColor:"Color de fondo",opacity:"Opacidad"},fontSizes:{small:"Pequeño",normal:"Normal",large:"Grande",xlarge:"Muy grande"},fontFamilies:{sansSerif:"Sans-serif",serif:"Serif",monospace:"Monospace"},styleLabels:{textColor:"Color de texto",background:"Fondo",font:"Fuente",fontSize:"Tamaño de fuente",opacity:"Opacidad"},audioDescription:{enable:"Activar audiodescripción",disable:"Desactivar audiodescripción"},signLanguage:{show:"Mostrar video en lengua de señas",hide:"Ocultar video en lengua de señas",showInMainView:"Mostrar lengua de señas en video principal",hideInMainView:"Ocultar lengua de señas del video principal"},transcript:{title:"Transcripción",ariaLabel:"Transcripción de video",close:"Cerrar transcripción",loading:"Cargando transcripción...",noTranscript:"No hay transcripción disponible para este video.",settings:"Configuración de transcripción. Presione Enter para abrir el menú o D para activar el modo de arrastre",keyboardDragMode:"Alternar modo de arrastre con teclado usando teclas de flecha. Atajo: tecla D",keyboardDragActive:"⌨️ Modo de Arrastre con Teclado Activo (Teclas de flecha para mover, Mayús+Flechas para pasos grandes, D o ESC para salir)",dragResizePrompt:"Pulsa D para mover o R para cambiar el tamaño. Home restablece la posición; Esc cierra.",dragModeEnabled:"Modo de arrastre con teclado activado. Usa flechas para mover, Mayús+Flechas para pasos grandes. Pulsa D o Esc para salir.",dragModeDisabled:"Modo de arrastre con teclado desactivado.",enableDragMode:"Activar modo de arrastre. Atajo: tecla D",disableDragMode:"Desactivar modo de arrastre. Atajo: tecla D",enableDragModeAria:"Activar modo de arrastre con teclado usando teclas de flecha. Atajo: tecla D",disableDragModeAria:"Desactivar modo de arrastre con teclado usando teclas de flecha. Atajo: tecla D",resizeWindow:"Cambiar tamaño de ventana",disableResizeWindow:"Desactivar modo de cambio de tamaño",enableResizeMode:"Activar modo de cambio de tamaño. Atajo: tecla R",disableResizeMode:"Desactivar modo de cambio de tamaño. Atajo: tecla R",enableResizeModeAria:"Activar modo de cambio de tamaño con teclado usando teclas de flecha. Atajo: tecla R",disableResizeModeAria:"Desactivar modo de cambio de tamaño con teclado usando teclas de flecha. Atajo: tecla R",resizeModeHint:"Controladores habilitados. Arrastra bordes o esquinas para ajustar. Pulsa Esc o R para salir.",resizeModeEnabled:"Modo de cambio de tamaño activado. Arrastra bordes o esquinas. Pulsa Esc o R para salir.",resizeModeDisabled:"Modo de cambio de tamaño desactivado.",positionReset:"Posición de la transcripción restablecida.",styleTranscript:"Abrir configuración de estilo de transcripción",closeMenu:"Cerrar menú",styleTitle:"Estilo de Transcripción",autoscroll:"Desplazamiento automático",settingsMenu:"Configuración del diálogo de transcripción",showTimestamps:"Mostrar marcas de tiempo",hideTimestamps:"Ocultar marcas de tiempo",showTimestampsAria:"Mostrar marcas de tiempo en la transcripción",hideTimestampsAria:"Ocultar marcas de tiempo en la transcripción"},settings:{title:"Configuración",quality:"Calidad",speed:"Velocidad",captions:"Subtítulos",language:"Idioma",reset:"Restablecer",close:"Cerrar"},speeds:{normal:"Normal"},time:{display:"Visualización de tiempo",durationPrefix:"Duración: ",of:"de",hour:"{count} hora",hours:"{count} horas",minute:"{count} minuto",minutes:"{count} minutos",second:"{count} segundo",seconds:"{count} segundos"},playlist:{title:"Lista de reproducción",trackOf:"Pista {current} de {total}",nowPlaying:"Reproduciendo ahora: Pista {current} de {total}. {title}{artist}",by:" por ",untitled:"Sin título",trackUntitled:"Pista {number}",currentlyPlaying:"Reproduciendo actualmente",notPlaying:"Sin reproducir",pressEnterPlay:"Pulsa Enter para reproducir",pressEnterRestart:"Pulsa Enter para reiniciar",keyboardInstructions:"Navegación de lista de reproducción: Use las teclas de flecha arriba y abajo para moverse entre pistas. Pulse Retroceder página o Avanzar página para saltar 5 pistas. Pulse Inicio para ir a la primera pista, Fin para la última pista. Pulse Intro o Espacio para reproducir la pista seleccionada.",endOfPlaylist:"Fin de la lista de reproducción. {current} de {total}.",beginningOfPlaylist:"Inicio de la lista de reproducción. 1 de {total}.",jumpedToLastTrack:"Saltó a la última pista. {current} de {total}.",jumpedToFirstTrack:"Saltó a la primera pista. 1 de {total}.",firstTrack:"Primera pista. 1 de {total}.",lastTrack:"Última pista. {current} de {total}."}}});var Be={};H(Be,{fr:()=>lt});var lt,Ve=D(()=>{lt={player:{label:"Lecteur vidéo",play:"Lecture",pause:"Pause",stop:"Arrêt",restart:"Redémarrer du début",rewind:"Reculer",forward:"Avancer",rewindSeconds:"Reculer de {seconds} secondes",forwardSeconds:"Avancer de {seconds} secondes",previous:"Piste précédente",next:"Piste suivante",playlist:"Basculer la liste de lecture",volume:"Volume",mute:"Muet",unmute:"Activer le son",fullscreen:"Plein écran",exitFullscreen:"Quitter le plein écran",captions:"Sous-titres",chapters:"Chapitres",quality:"Qualité",captionStyling:"Style des sous-titres",transcript:"Activer/désactiver la transcription",audioDescription:"Audiodescription",signLanguage:"Vidéo en langue des signes",settings:"Paramètres",speed:"Vitesse de lecture",pip:"Image dans l'image",currentTime:"Temps actuel",duration:"Durée",progress:"Progression",seekForward:"Avancer de {seconds} secondes",seekBackward:"Reculer de {seconds} secondes",volumeUp:"Augmenter le volume",volumeDown:"Diminuer le volume",loading:"Chargement...",loadingChapters:"Chargement des chapitres...",error:"Erreur de chargement",buffering:"Mise en mémoire tampon...",signLanguageVideo:"Vidéo en Langue des Signes",closeSignLanguage:"Fermer la vidéo en langue des signes",signLanguageSettings:"Paramètres de la langue des signes",noChapters:"Aucun chapitre disponible",noCaptions:"Aucun sous-titre disponible",auto:"Automatique",autoQuality:"Automatique (sélection de qualité non disponible)",noQuality:"Sélection de qualité non disponible",signLanguageDragResize:"Vidéo en Langue des Signes - Appuyez sur D pour déplacer avec le clavier, R pour redimensionner",signLanguageDragActive:"Vidéo en Langue des Signes - Mode glissement actif. Utilisez les touches fléchées pour déplacer, Échap pour quitter.",signLanguageResizeActive:"Vidéo en Langue des Signes - Mode redimensionnement actif. Utilisez les touches fléchées gauche/droite pour redimensionner, Échap pour quitter.",enableSignDragMode:"Activer le mode glissement. Raccourci : touche D",disableSignDragMode:"Désactiver le mode glissement. Raccourci : touche D",enableSignDragModeAria:"Activer le mode glissement clavier avec les touches fléchées. Raccourci : touche D",disableSignDragModeAria:"Désactiver le mode glissement clavier avec les touches fléchées. Raccourci : touche D",enableSignResizeMode:"Activer le mode redimensionnement. Raccourci : touche R",disableSignResizeMode:"Désactiver le mode redimensionnement. Raccourci : touche R",enableSignResizeModeAria:"Activer le mode redimensionnement clavier avec les touches fléchées. Raccourci : touche R",disableSignResizeModeAria:"Désactiver le mode redimensionnement clavier avec les touches fléchées. Raccourci : touche R",resizeHandle:"Redimensionner coin {direction}",moreOptions:"Plus d'options",noMoreOptions:"Aucune option supplémentaire disponible"},captions:{off:"Désactivé",select:"Sélectionner les sous-titres",fontSize:"Taille de police",fontFamily:"Police",color:"Couleur du texte",backgroundColor:"Couleur de fond",opacity:"Opacité"},fontSizes:{small:"Petit",normal:"Normal",large:"Grand",xlarge:"Très grand"},fontFamilies:{sansSerif:"Sans-serif",serif:"Serif",monospace:"Monospace"},styleLabels:{textColor:"Couleur du texte",background:"Arrière-plan",font:"Police",fontSize:"Taille de police",opacity:"Opacité"},audioDescription:{enable:"Activer l'audiodescription",disable:"Désactiver l'audiodescription"},signLanguage:{show:"Afficher la vidéo en langue des signes",hide:"Masquer la vidéo en langue des signes",showInMainView:"Afficher langue des signes dans la vidéo principale",hideInMainView:"Masquer langue des signes de la vidéo principale"},transcript:{title:"Transcription",ariaLabel:"Transcription vidéo",close:"Fermer la transcription",loading:"Chargement de la transcription...",noTranscript:"Aucune transcription disponible pour cette vidéo.",settings:"Paramètres de transcription. Appuyez sur Entrée pour ouvrir le menu ou D pour activer le mode glissement",keyboardDragMode:"Basculer le mode glissement avec les touches fléchées. Raccourci: touche D",keyboardDragActive:"⌨️ Mode Glissement Clavier Actif (Touches fléchées pour déplacer, Maj+Fléchées pour grands pas, D ou Échap pour quitter)",dragResizePrompt:"Appuyez sur D pour déplacer ou R pour redimensionner. Home réinitialise la position, Échap ferme.",dragModeEnabled:"Mode glissement clavier activé. Utilisez les flèches pour déplacer, Maj+Flèches pour de grands pas. Appuyez sur D ou Échap pour quitter.",dragModeDisabled:"Mode glissement clavier désactivé.",enableDragMode:"Activer le mode glissement. Raccourci : touche D",disableDragMode:"Désactiver le mode glissement. Raccourci : touche D",enableDragModeAria:"Activer le mode glissement clavier avec les touches fléchées. Raccourci : touche D",disableDragModeAria:"Désactiver le mode glissement clavier avec les touches fléchées. Raccourci : touche D",resizeWindow:"Redimensionner la fenêtre",disableResizeWindow:"Désactiver le mode de redimensionnement",enableResizeMode:"Activer le mode redimensionnement. Raccourci : touche R",disableResizeMode:"Désactiver le mode redimensionnement. Raccourci : touche R",enableResizeModeAria:"Activer le mode redimensionnement clavier avec les touches fléchées. Raccourci : touche R",disableResizeModeAria:"Désactiver le mode redimensionnement clavier avec les touches fléchées. Raccourci : touche R",resizeModeHint:"Poignées activées. Faites glisser les bords ou les coins pour ajuster. Appuyez sur Échap ou R pour quitter.",resizeModeEnabled:"Mode redimensionnement activé. Faites glisser les bords ou coins. Appuyez sur Échap ou R pour quitter.",resizeModeDisabled:"Mode redimensionnement désactivé.",positionReset:"Position de la transcription réinitialisée.",styleTranscript:"Ouvrir les paramètres de style de transcription",closeMenu:"Fermer le menu",styleTitle:"Style de Transcription",autoscroll:"Défilement automatique",settingsMenu:"Paramètres de dialogue de transcription",showTimestamps:"Afficher les horodatages",hideTimestamps:"Masquer les horodatages",showTimestampsAria:"Afficher les horodatages dans la transcription",hideTimestampsAria:"Masquer les horodatages dans la transcription"},settings:{title:"Paramètres",quality:"Qualité",speed:"Vitesse",captions:"Sous-titres",language:"Langue",reset:"Réinitialiser",close:"Fermer"},speeds:{normal:"Normal"},time:{display:"Affichage du temps",durationPrefix:"Durée : ",of:"sur",hour:"{count} heure",hours:"{count} heures",minute:"{count} minute",minutes:"{count} minutes",second:"{count} seconde",seconds:"{count} secondes"},playlist:{title:"Liste de lecture",trackOf:"Piste {current} sur {total}",nowPlaying:"Lecture en cours : Piste {current} sur {total}. {title}{artist}",by:" par ",untitled:"Sans titre",trackUntitled:"Piste {number}",currentlyPlaying:"En cours de lecture",notPlaying:"Non en lecture",pressEnterPlay:"Appuyez sur Entrée pour lire",pressEnterRestart:"Appuyez sur Entrée pour recommencer",keyboardInstructions:"Navigation de la liste de lecture : Utilisez les touches fléchées haut et bas pour naviguer entre les pistes. Appuyez sur Page précédente ou Page suivante pour sauter 5 pistes. Appuyez sur Début pour aller à la première piste, Fin pour la dernière piste. Appuyez sur Entrée ou Espace pour lire la piste sélectionnée.",endOfPlaylist:"Fin de la liste de lecture. {current} sur {total}.",beginningOfPlaylist:"Début de la liste de lecture. 1 sur {total}.",jumpedToLastTrack:"Sauté à la dernière piste. {current} sur {total}.",jumpedToFirstTrack:"Sauté à la première piste. 1 sur {total}.",firstTrack:"Première piste. 1 sur {total}.",lastTrack:"Dernière piste. {current} sur {total}."}}});var He={};H(He,{ja:()=>ct});var ct,Oe=D(()=>{ct={player:{label:"ビデオプレーヤー",play:"再生",pause:"一時停止",stop:"停止",restart:"最初から再生",rewind:"巻き戻し",forward:"早送り",rewindSeconds:"{seconds}秒戻す",forwardSeconds:"{seconds}秒進める",previous:"前のトラック",next:"次のトラック",playlist:"プレイリストの切り替え",volume:"音量",mute:"ミュート",unmute:"ミュート解除",fullscreen:"全画面表示",exitFullscreen:"全画面表示を終了",captions:"字幕",chapters:"チャプター",quality:"画質",captionStyling:"字幕スタイル",transcript:"文字起こし切り替え",audioDescription:"音声解説",signLanguage:"手話動画",settings:"設定",speed:"再生速度",pip:"ピクチャーインピクチャー",currentTime:"現在の時間",duration:"再生時間",progress:"進行状況",seekForward:"{seconds}秒進める",seekBackward:"{seconds}秒戻す",volumeUp:"音量を上げる",volumeDown:"音量を下げる",loading:"読み込み中...",loadingChapters:"チャプター読み込み中...",error:"読み込みエラー",buffering:"バッファリング中...",signLanguageVideo:"手話動画",closeSignLanguage:"手話動画を閉じる",signLanguageSettings:"手話設定",noChapters:"チャプターがありません",noCaptions:"字幕がありません",auto:"自動",autoQuality:"自動（画質選択不可）",noQuality:"画質選択不可",signLanguageDragResize:"手話動画 - キーボードでドラッグするにはDキーを、サイズ変更するにはRキーを押してください",signLanguageDragActive:"手話動画 - ドラッグモードが有効です。矢印キーで移動、Escapeで終了します。",signLanguageResizeActive:"手話動画 - サイズ変更モードが有効です。左右の矢印キーでサイズ変更、Escapeで終了します。",enableSignDragMode:"ドラッグモードを有効にする。ショートカット：Dキー",disableSignDragMode:"ドラッグモードを無効にする。ショートカット：Dキー",enableSignDragModeAria:"矢印キーでキーボードドラッグモードを有効にする。ショートカット：Dキー",disableSignDragModeAria:"矢印キーでキーボードドラッグモードを無効にする。ショートカット：Dキー",enableSignResizeMode:"サイズ変更モードを有効にする。ショートカット：Rキー",disableSignResizeMode:"サイズ変更モードを無効にする。ショートカット：Rキー",enableSignResizeModeAria:"矢印キーでキーボードサイズ変更モードを有効にする。ショートカット：Rキー",disableSignResizeModeAria:"矢印キーでキーボードサイズ変更モードを無効にする。ショートカット：Rキー",resizeHandle:"{direction}コーナーのサイズ変更",moreOptions:"その他のオプション",noMoreOptions:"追加のオプションはありません"},captions:{off:"オフ",select:"字幕を選択",fontSize:"フォントサイズ",fontFamily:"フォント",color:"テキストの色",backgroundColor:"背景色",opacity:"不透明度"},fontSizes:{small:"小",normal:"標準",large:"大",xlarge:"特大"},fontFamilies:{sansSerif:"サンセリフ",serif:"セリフ",monospace:"等幅"},styleLabels:{textColor:"テキストの色",background:"背景",font:"フォント",fontSize:"フォントサイズ",opacity:"不透明度"},audioDescription:{enable:"音声解説を有効にする",disable:"音声解説を無効にする"},signLanguage:{show:"手話動画を表示",hide:"手話動画を非表示",showInMainView:"メイン動画に手話を表示",hideInMainView:"メイン動画から手話を削除"},transcript:{title:"文字起こし",ariaLabel:"ビデオ文字起こし",close:"文字起こしを閉じる",loading:"文字起こしを読み込み中...",noTranscript:"このビデオの文字起こしはありません。",settings:"文字起こし設定。Enterキーでメニューを開く、またはDキーでドラッグモードを有効にする",keyboardDragMode:"矢印キーでキーボードドラッグモードを切り替え。ショートカット：Dキー",keyboardDragActive:"⌨️ キーボードドラッグモード有効（矢印キーで移動、Shift+矢印キーで大きく移動、DまたはESCで終了）",dragResizePrompt:"Dキーで移動、Rキーでサイズ変更。Homeで位置をリセット、Escで閉じます。",dragModeEnabled:"キーボードドラッグモードを有効にしました。矢印キーで移動、Shift+矢印キーで大きく移動できます。終了するには D または Esc を押します。",dragModeDisabled:"キーボードドラッグモードを無効にしました。",enableDragMode:"ドラッグモードを有効にする。ショートカット：Dキー",disableDragMode:"ドラッグモードを無効にする。ショートカット：Dキー",enableDragModeAria:"矢印キーでキーボードドラッグモードを有効にする。ショートカット：Dキー",disableDragModeAria:"矢印キーでキーボードドラッグモードを無効にする。ショートカット：Dキー",resizeWindow:"ウィンドウのサイズ変更",disableResizeWindow:"サイズ変更モードを無効にする",enableResizeMode:"サイズ変更モードを有効にする。ショートカット：Rキー",disableResizeMode:"サイズ変更モードを無効にする。ショートカット：Rキー",enableResizeModeAria:"矢印キーでキーボードサイズ変更モードを有効にする。ショートカット：Rキー",disableResizeModeAria:"矢印キーでキーボードサイズ変更モードを無効にする。ショートカット：Rキー",resizeModeHint:"リサイズハンドルが有効になりました。辺や角をドラッグして調整します。Esc または R で終了します。",resizeModeEnabled:"サイズ変更モードを有効にしました。辺や角をドラッグして調整します。Esc または R で終了します。",resizeModeDisabled:"サイズ変更モードを無効にしました。",positionReset:"文字起こしの位置をリセットしました。",styleTranscript:"文字起こしスタイル設定を開く",closeMenu:"メニューを閉じる",styleTitle:"文字起こしスタイル",autoscroll:"自動スクロール",settingsMenu:"文字起こしダイアログ設定",showTimestamps:"タイムスタンプを表示",hideTimestamps:"タイムスタンプを非表示",showTimestampsAria:"文字起こしにタイムスタンプを表示",hideTimestampsAria:"文字起こしのタイムスタンプを非表示"},settings:{title:"設定",quality:"画質",speed:"速度",captions:"字幕",language:"言語",reset:"リセット",close:"閉じる"},speeds:{normal:"通常"},time:{display:"時間表示",durationPrefix:"再生時間: ",of:"/",hour:"{count}時間",hours:"{count}時間",minute:"{count}分",minutes:"{count}分",second:"{count}秒",seconds:"{count}秒"},playlist:{title:"プレイリスト",trackOf:"トラック {current}/{total}",nowPlaying:"再生中: トラック {current}/{total}. {title}{artist}",by:" - ",untitled:"タイトルなし",trackUntitled:"トラック {number}",currentlyPlaying:"再生中",notPlaying:"停止中",pressEnterPlay:"Enterキーで再生",pressEnterRestart:"Enterキーで最初から再生",keyboardInstructions:"プレイリストナビゲーション：上下の矢印キーでトラック間を移動します。Page UpまたはPage Downで5トラックをスキップします。Homeで最初のトラックへ、Endで最後のトラックへ移動します。EnterまたはSpaceで選択したトラックを再生します。",endOfPlaylist:"プレイリストの終わりです。{current}/{total}。",beginningOfPlaylist:"プレイリストの始めです。1/{total}。",jumpedToLastTrack:"最後のトラックにジャンプしました。{current}/{total}。",jumpedToFirstTrack:"最初のトラックにジャンプしました。1/{total}。",firstTrack:"最初のトラックです。1/{total}。",lastTrack:"最後のトラックです。{current}/{total}。"}}});function fe(){return{en:xe}}function Fe(){return $e}async function Ne(u){let e=$e[u];if(!e)return null;let t=await e();return t[u]||t.default||null}var $e,St,Ie=D(()=>{Ce();$e={de:()=>Promise.resolve().then(()=>(Ae(),De)),es:()=>Promise.resolve().then(()=>(Re(),ze)),fr:()=>Promise.resolve().then(()=>(Ve(),Be)),ja:()=>Promise.resolve().then(()=>(Oe(),He))};St=fe()});var be,m,O=D(()=>{Ie();be=class{constructor(){this.currentLanguage="en",this.translations=fe(),this.loadingPromises=new Map,this.builtInLanguageLoaders=Fe()}setLanguage(e){this.translations[e]?this.currentLanguage=e:(console.warn('Language "'.concat(e,'" not found, falling back to English')),this.currentLanguage="en")}getLanguage(){return this.currentLanguage}async ensureLanguage(e){let t=(e||"").toLowerCase();if(!t)return this.currentLanguage;if(this.translations[t])return t;if(this.loadingPromises.has(t))return await this.loadingPromises.get(t),this.translations[t]?t:null;if(!this.builtInLanguageLoaders[t])return null;let i=(async()=>{try{let s=await Ne(t);s&&(this.translations[t]=s)}catch(s){console.warn('Language "'.concat(t,'" failed to load:'),s)}finally{this.loadingPromises.delete(t)}})();return this.loadingPromises.set(t,i),await i,this.translations[t]?t:null}t(e,t={}){let i=e.split("."),s=this.translations[this.currentLanguage];for(let a of i)if(s&&typeof s=="object"&&a in s)s=s[a];else{s=this.translations.en;for(let n of i)if(s&&typeof s=="object"&&n in s)s=s[n];else return e;break}return typeof s=="string"&&Object.entries(t).forEach(([a,n])=>{s=s.replace(new RegExp("{".concat(a,"}"),"g"),n)}),s}addTranslation(e,t){this.translations[e]||(this.translations[e]={}),Object.assign(this.translations[e],t)}async loadLanguageFromUrl(e,t){if(this.loadingPromises.has(t))return this.loadingPromises.get(t);let i=(async()=>{try{let s=await fetch(t);if(!s.ok)throw new Error("Failed to load language file: ".concat(s.statusText));let a=s.headers.get("content-type")||"",n,o=await s.arrayBuffer(),r=new TextDecoder("utf-8").decode(o);if(a.includes("application/json")||t.endsWith(".json"))n=JSON.parse(r);else if(a.includes("text/yaml")||a.includes("application/x-yaml")||t.endsWith(".yaml")||t.endsWith(".yml"))try{n=JSON.parse(r)}catch(c){if(typeof window!="undefined"&&window.jsyaml)n=window.jsyaml.load(r);else throw console.warn("YAML parsing requires js-yaml library. Please include it or use JSON format."),new Error("YAML parsing not available. Please use JSON format or include js-yaml library.")}else n=JSON.parse(r);return this.addTranslation(e,n),n}catch(s){throw console.error("Error loading language file from ".concat(t,":"),s),s}finally{this.loadingPromises.delete(t)}})();return this.loadingPromises.set(t,i),i}async loadLanguagesFromUrls(e){let t=Object.entries(e).map(([i,s])=>this.loadLanguageFromUrl(i,s));await Promise.all(t)}},m=new be});var A,ae=D(()=>{O();A={formatTime(u,e=!1){if(!isFinite(u)||u<0)return e?"00:00:00":"00:00";let t=Math.floor(u/3600),i=Math.floor(u%3600/60),s=Math.floor(u%60),a=n=>String(n).padStart(2,"0");return t>0||e?"".concat(a(t),":").concat(a(i),":").concat(a(s)):"".concat(a(i),":").concat(a(s))},parseTime(u){let e=u.split(":").map(t=>parseInt(t,10));return e.length===3?e[0]*3600+e[1]*60+e[2]:e.length===2?e[0]*60+e[1]:e.length===1?e[0]:0},formatDuration(u){if(!isFinite(u)||u<0)return m.t("time.seconds",{count:0});let e=Math.floor(u/3600),t=Math.floor(u%3600/60),i=Math.floor(u%60),s=[];if(e>0){let a=e===1?"time.hour":"time.hours";s.push(m.t(a,{count:e}))}if(t>0){let a=t===1?"time.minute":"time.minutes";s.push(m.t(a,{count:t}))}if(i>0||s.length===0){let a=i===1?"time.second":"time.seconds";s.push(m.t(a,{count:i}))}return s.join(", ")},formatPercentage(u,e){return e===0?0:Math.round(u/e*100)}}});function ut(u){return We[u]||We.play}function T(u,e=""){let t=document.createElement("span");return t.className="vidply-icon ".concat(e).trim(),t.innerHTML=ut(u),t.setAttribute("aria-hidden","true"),t}function _e(){let u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttribute("class","vidply-play-overlay"),u.setAttribute("viewBox","0 0 80 80"),u.setAttribute("width","80"),u.setAttribute("height","80"),u.setAttribute("aria-hidden","true"),u.setAttribute("role","presentation"),u.style.cursor="pointer";let e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t="vidply-play-shadow-".concat(Math.random().toString(36).substr(2,9)),i=document.createElementNS("http://www.w3.org/2000/svg","filter");i.setAttribute("id",t),i.setAttribute("x","-50%"),i.setAttribute("y","-50%"),i.setAttribute("width","200%"),i.setAttribute("height","200%");let s=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");s.setAttribute("in","SourceAlpha"),s.setAttribute("stdDeviation","3");let a=document.createElementNS("http://www.w3.org/2000/svg","feOffset");a.setAttribute("dx","0"),a.setAttribute("dy","2"),a.setAttribute("result","offsetblur");let n=document.createElementNS("http://www.w3.org/2000/svg","feComponentTransfer"),o=document.createElementNS("http://www.w3.org/2000/svg","feFuncA");o.setAttribute("type","linear"),o.setAttribute("slope","0.3"),n.appendChild(o);let r=document.createElementNS("http://www.w3.org/2000/svg","feMerge"),c=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode"),l=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");l.setAttribute("in","SourceGraphic"),r.appendChild(c),r.appendChild(l),i.appendChild(s),i.appendChild(a),i.appendChild(n),i.appendChild(r),e.appendChild(i),u.appendChild(e);let d=document.createElementNS("http://www.w3.org/2000/svg","circle");d.setAttribute("cx","40"),d.setAttribute("cy","40"),d.setAttribute("r","40"),d.setAttribute("fill","rgba(255, 255, 255, 0.95)"),d.setAttribute("filter","url(#".concat(t,")")),d.setAttribute("class","vidply-play-overlay-bg"),u.appendChild(d);let h=document.createElementNS("http://www.w3.org/2000/svg","polygon");return h.setAttribute("points","32,28 32,52 54,40"),h.setAttribute("fill","#0a406e"),h.setAttribute("class","vidply-play-overlay-icon"),u.appendChild(h),u}var dt,ht,We,q=D(()=>{dt={play:'<path d="M8 5v14l11-7z"/>',pause:'<path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>',stop:'<rect x="6" y="6" width="12" height="12"/>',rewind:'<path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/>',forward:'<path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"/>',skipPrevious:'<path d="M6 6h2v12H6V6zm3 6l8.5 6V6L9 12z"/>',skipNext:'<path d="M16 6h2v12h-2V6zM6 6l8.5 6L6 18V6z"/>',restart:'<path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>',volumeHigh:'<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>',volumeMedium:'<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>',volumeLow:'<path d="M7 9v6h4l5 5V4l-5 5H7z"/>',volumeMuted:'<path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>',fullscreen:'<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>',fullscreenExit:'<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>',settings:'<path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94L14.4 2.81c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>',captions:'<path d="M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 7H9.5v-.5h-2v3h2V13H11v1c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1zm7 0h-1.5v-.5h-2v3h2V13H18v1c0 .55-.45 1-1 1h-3c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1z"/>',captionsOff:'<path d="M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 7H9.5v-.5h-2v3h2V13H11v1c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1zm7 0h-1.5v-.5h-2v3h2V13H18v1c0 .55-.45 1-1 1h-3c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1z"/><path d="M0 0h24v24H0z" fill="none"/>',pip:'<path d="M19 7h-8v6h8V7zm2-4H3c-1.1 0-2 .9-2 2v14c0 1.1.9 1.98 2 1.98h18c1.1 0 2-.88 2-1.98V5c0-1.1-.9-2-2-2zm0 16.01H3V4.98h18v14.03z"/>',speed:'<path d="M20.38 8.57l-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44z"/><path d="M10.59 15.41a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83z"/>',close:'<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>',check:'<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>',loading:'<path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>',error:'<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>',playlist:'<path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/>',hd:'<path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm7-1c0 .55-.45 1-1 1h-.75v1.5h-1.5V15H14c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v4zm-3.5-.5h2v-3h-2v3z"/>',transcript:'<path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>',chapters:'<path d="M3 5h2v2H3V5zm0 4h2v2H3V9zm0 4h2v2H3v-2zm0 4h2v2H3v-2zM7 5h14v2H7V5zm0 4h14v2H7V9zm0 4h14v2H7v-2zm0 4h14v2H7v-2z"/>',audioDescription:'<rect x="2" y="5" width="20" height="14" rx="2" fill="#ffffff" stroke="#ffffff" stroke-width="2"/><text x="12" y="16" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#1a1a1a">AD</text>',audioDescriptionOn:'<rect x="2" y="5" width="20" height="14" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><text x="12" y="16" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="currentColor">AD</text>',signLanguage:'<g transform="scale(1.5)"><path d="M16 11.3c-.1-.9-4.8 1.3-5.4 1.1-2.6-1 5.8-1.3 5.1-2.9s-5.1 1.5-6 1.4C6.5 9.4 16.5 9.1 13.5 8c-1.9-.6-8.8 2.9-6.8.4.7-.6.7-1.9-.7-1.7-9.7 7.2-.7 12.2 8.8 7 0-1.3-3.5.4-4.1.4-2.6 0 5.6-2 5.4-3ZM3.9 7.8c3.2-4.2 3.7 1.2 6 .1s.2-.2.2-.3c.7-2.7 2.5-7.5-1.5-1.3-1.6 0 1.1-4 1-4.6C8.9-1 7.3 4.4 7.2 4.9c-1.6.7-.9-1.4-.7-1.5 3-6-.6-3.1-.9.4-2.5 1.8 0-2.8 0-3.5C2.8-.9 4 9.4 1.1 4.9S.1 4.6 0 5c-.4 2.7 2.6 7.2 3.9 2.8Z"/></g>',signLanguageOn:'<g transform="scale(1.5)"><path d="M16 11.3c-.1-.9-4.8 1.3-5.4 1.1-2.6-1 5.8-1.3 5.1-2.9s-5.1 1.5-6 1.4C6.5 9.4 16.5 9.1 13.5 8c-1.9-.6-8.8 2.9-6.8.4.7-.6.7-1.9-.7-1.7-9.7 7.2-.7 12.2 8.8 7 0-1.3-3.5.4-4.1.4-2.6 0 5.6-2 5.4-3ZM3.9 7.8c3.2-4.2 3.7 1.2 6 .1s.2-.2.2-.3c.7-2.7 2.5-7.5-1.5-1.3-1.6 0 1.1-4 1-4.6C8.9-1 7.3 4.4 7.2 4.9c-1.6.7-.9-1.4-.7-1.5 3-6-.6-3.1-.9.4-2.5 1.8 0-2.8 0-3.5C2.8-.9 4 9.4 1.1 4.9S.1 4.6 0 5c-.4 2.7 2.6 7.2 3.9 2.8Z"/></g>',signLanguagePip:'<g transform="scale(1.2) translate(1, 1)"><path d="M16 11.3c-.1-.9-4.8 1.3-5.4 1.1-2.6-1 5.8-1.3 5.1-2.9s-5.1 1.5-6 1.4C6.5 9.4 16.5 9.1 13.5 8c-1.9-.6-8.8 2.9-6.8.4.7-.6.7-1.9-.7-1.7-9.7 7.2-.7 12.2 8.8 7 0-1.3-3.5.4-4.1.4-2.6 0 5.6-2 5.4-3ZM3.9 7.8c3.2-4.2 3.7 1.2 6 .1s.2-.2.2-.3c.7-2.7 2.5-7.5-1.5-1.3-1.6 0 1.1-4 1-4.6C8.9-1 7.3 4.4 7.2 4.9c-1.6.7-.9-1.4-.7-1.5 3-6-.6-3.1-.9.4-2.5 1.8 0-2.8 0-3.5C2.8-.9 4 9.4 1.1 4.9S.1 4.6 0 5c-.4 2.7 2.6 7.2 3.9 2.8Z"/></g><polygon points="14,23 23,14 23,23" fill="currentColor"/>',signLanguagePipOn:'<g transform="scale(1.2) translate(1, 1)"><path d="M16 11.3c-.1-.9-4.8 1.3-5.4 1.1-2.6-1 5.8-1.3 5.1-2.9s-5.1 1.5-6 1.4C6.5 9.4 16.5 9.1 13.5 8c-1.9-.6-8.8 2.9-6.8.4.7-.6.7-1.9-.7-1.7-9.7 7.2-.7 12.2 8.8 7 0-1.3-3.5.4-4.1.4-2.6 0 5.6-2 5.4-3ZM3.9 7.8c3.2-4.2 3.7 1.2 6 .1s.2-.2.2-.3c.7-2.7 2.5-7.5-1.5-1.3-1.6 0 1.1-4 1-4.6C8.9-1 7.3 4.4 7.2 4.9c-1.6.7-.9-1.4-.7-1.5 3-6-.6-3.1-.9.4-2.5 1.8 0-2.8 0-3.5C2.8-.9 4 9.4 1.1 4.9S.1 4.6 0 5c-.4 2.7 2.6 7.2 3.9 2.8Z"/></g><polygon points="14,23 23,14 23,23" fill="currentColor"/>',music:'<path d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7zm-1.5 16c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>',moreVertical:'<path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>',move:'<path d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"/>',resize:'<path d="M21.71 11.29l-9-9c-.39-.39-1.02-.39-1.41 0l-9 9c-.39.39-.39 1.02 0 1.41l9 9c.39.39 1.02.39 1.41 0l9-9c.39-.38.39-1.01 0-1.41zM14 14.5V12h-4v2.5L7 11l3-3.5V10h4V7.5l3 3.5-3 3.5z"/>',clock:'<path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/><path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>'},ht=u=>'<svg viewBox="0 0 24 24" fill="currentColor">'.concat(u,"</svg>"),We=Object.fromEntries(Object.entries(dt).map(([u,e])=>[u,ht(e)]))});function N(u,{delay:e=0,preventScroll:t=!0}={}){u&&requestAnimationFrame(()=>{setTimeout(()=>{u&&document.contains(u)&&u.focus({preventScroll:t})},e)})}function qe(u,e,t={}){if(!u)return;let i=u.querySelector(e);i&&N(i,t)}var ne=D(()=>{});var W,ce=D(()=>{W=class{constructor(e="vidply"){this.namespace=e,this.storage=this.isStorageAvailable()?localStorage:null}isStorageAvailable(){try{let e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}getKey(e){return"".concat(this.namespace,"_").concat(e)}set(e,t){if(!this.storage)return!1;try{let i=this.getKey(e);return this.storage.setItem(i,JSON.stringify(t)),!0}catch(i){return console.warn("Failed to save to localStorage:",i),!1}}get(e,t=null){if(!this.storage)return t;try{let i=this.getKey(e),s=this.storage.getItem(i);return s?JSON.parse(s):t}catch(i){return console.warn("Failed to read from localStorage:",i),t}}remove(e){if(!this.storage)return!1;try{let t=this.getKey(e);return this.storage.removeItem(t),!0}catch(t){return console.warn("Failed to remove from localStorage:",t),!1}}clear(){if(!this.storage)return!1;try{return Object.keys(this.storage).forEach(t=>{t.startsWith(this.namespace)&&this.storage.removeItem(t)}),!0}catch(e){return console.warn("Failed to clear localStorage:",e),!1}}saveTranscriptPreferences(e){return this.set("transcript_preferences",e)}getTranscriptPreferences(){return this.get("transcript_preferences",null)}saveCaptionPreferences(e){return this.set("caption_preferences",e)}getCaptionPreferences(){return this.get("caption_preferences",null)}savePlayerPreferences(e){return this.set("player_preferences",e)}getPlayerPreferences(){return this.get("player_preferences",null)}saveSignLanguagePreferences(e){return this.set("sign_language_preferences",e)}getSignLanguagePreferences(){return this.get("sign_language_preferences",null)}}});var Ue={};H(Ue,{HTML5Renderer:()=>te});var te,ve=D(()=>{te=class{constructor(e){this.player=e,this.media=e.element,this._didDeferredLoad=!1}async init(){this.media.controls=!1,this.media.removeAttribute("controls"),this.attachEvents(),this.player.options.deferLoad?this.media.preload=this.player.options.preload||"none":(this.media.preload=this.player.options.preload,this.media.load()),this.player.container&&this.player.container.classList.remove("vidply-external-controls")}attachEvents(){this.media.addEventListener("loadedmetadata",()=>{this.player.state.duration=this.media.duration,this.player.emit("loadedmetadata"),this.media.tagName==="VIDEO"&&this.player.autoGeneratePoster().catch(e=>{this.player.log("Failed to auto-generate poster:",e,"warn")})}),this.media.addEventListener("play",()=>{this.player.state.playing=!0,this.player.state.paused=!1,this.player.state.ended=!1,this.player.emit("play"),this.player.options.onPlay&&this.player.options.onPlay.call(this.player),this.player.options.pauseOthersOnPlay&&this.pauseOtherPlayers()}),this.media.addEventListener("pause",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.emit("pause"),this.player.options.onPause&&this.player.options.onPause.call(this.player)}),this.media.addEventListener("ended",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.state.ended=!0,this.player.emit("ended"),this.player.options.onEnded&&this.player.options.onEnded.call(this.player),this.player.options.loop&&(this.player.seek(0),this.player.play())}),this.media.addEventListener("timeupdate",()=>{this.player.state.currentTime=this.media.currentTime,this.player.emit("timeupdate",this.media.currentTime),this.player.options.onTimeUpdate&&this.player.options.onTimeUpdate.call(this.player,this.media.currentTime)}),this.media.addEventListener("volumechange",()=>{this.player.state.volume=this.media.volume,this.player.state.muted=this.media.muted,this.player.emit("volumechange",this.media.volume),this.player.options.onVolumeChange&&this.player.options.onVolumeChange.call(this.player,this.media.volume)}),this.media.addEventListener("seeking",()=>{this.player.state.seeking=!0,this.player.emit("seeking")}),this.media.addEventListener("seeked",()=>{this.player.state.seeking=!1,this.player.emit("seeked")}),this.media.addEventListener("waiting",()=>{this.player.state.buffering=!0,this.player.emit("waiting")}),this.media.addEventListener("canplay",()=>{this.player.state.buffering=!1,this.player.emit("canplay")}),this.media.addEventListener("progress",()=>{if(this.media.buffered.length>0){let e=this.media.buffered.end(this.media.buffered.length-1);this.player.emit("progress",e)}}),this.media.addEventListener("error",e=>{this.player.handleError(this.media.error)}),this.media.addEventListener("ratechange",()=>{this.player.state.playbackSpeed=this.media.playbackRate,this.player.emit("ratechange",this.media.playbackRate)})}pauseOtherPlayers(){document.querySelectorAll(".vidply-player").forEach(t=>{if(t!==this.player.container){let i=t.querySelector("video, audio");i&&!i.paused&&i.pause()}})}play(){let e=window.scrollX,t=window.scrollY;if(this.player.options.deferLoad&&!this._didDeferredLoad){try{this.media.readyState===0&&this.media.load()}catch(s){}this._didDeferredLoad=!0}let i=this.media.play();return window.scrollTo(e,t),i!==void 0?(i.catch(s=>{if(this.player.log("Play failed:",s,"warn"),this.player.options.autoplay&&!this.player.state.muted){this.player.log("Retrying play with muted audio","info"),this.media.muted=!0;let a=window.scrollX,n=window.scrollY;this.media.play().then(()=>{window.scrollTo(a,n)}).catch(o=>{this.player.handleError(o)})}}),i):Promise.resolve()}ensureLoaded(){if(!(!this.player.options.deferLoad||this._didDeferredLoad)){try{this.media.readyState===0&&this.media.load()}catch(e){}this._didDeferredLoad=!0}}pause(){this.media.pause()}seek(e){this.media.currentTime=e}setVolume(e){this.media.volume=e}setMuted(e){this.media.muted=e}setPlaybackSpeed(e){this.media.playbackRate=e}getQualities(){let e=Array.from(this.media.querySelectorAll("source"));return e.length<=1?[]:e.map((t,i)=>{let s=t.getAttribute("data-quality")||t.getAttribute("label")||"",a=t.getAttribute("data-height")||this.extractHeightFromLabel(s),n=t.getAttribute("data-width")||"";return{index:i,height:a?parseInt(a):0,width:n?parseInt(n):0,src:t.src,type:t.type,name:s||(a?"".concat(a,"p"):"Quality ".concat(i+1))}}).filter(t=>t.height>0)}extractHeightFromLabel(e){let t=e.match(/(\d+)p/i);return t?parseInt(t[1]):0}switchQuality(e){let t=this.getQualities();if(e<0||e>=t.length){this.player.log("Invalid quality index","warn");return}let i=t[e],s=this.media.currentTime,a=!this.media.paused;if(this.media.currentSrc===i.src){this.player.log("Already at this quality level","info");return}this.player.log("Switching to quality: ".concat(i.name),"info"),this.media.src=i.src;let o=()=>{this.media.removeEventListener("loadedmetadata",o),this.media.currentTime=s,a&&this.media.play().catch(r=>{this.player.log("Failed to resume playback after quality switch","warn")}),this.player.emit("qualitychange",{quality:i.name,index:e})};this.media.addEventListener("loadedmetadata",o),this.media.load()}getCurrentQuality(){let e=this.getQualities(),t=this.media.currentSrc;for(let i=0;i<e.length;i++)if(e[i].src===t)return i;return 0}destroy(){this.media.removeEventListener("loadedmetadata",()=>{}),this.media.removeEventListener("play",()=>{}),this.media.removeEventListener("pause",()=>{})}}});var _,he=D(()=>{_=class{constructor(e,t={}){this.element=e,this.options=V({dragHandle:null,resizeHandles:[],onDragStart:null,onDrag:null,onDragEnd:null,onResizeStart:null,onResize:null,onResizeEnd:null,constrainToViewport:!0,minWidth:150,minHeight:100,maintainAspectRatio:!1,keyboardDragKey:"d",keyboardResizeKey:"r",keyboardStep:5,keyboardStepLarge:10,maxWidth:null,maxHeight:null,pointerResizeIndicatorText:null,onPointerResizeToggle:null,classPrefix:"draggable",storage:null,storageKey:null},t),this.isDragging=!1,this.isResizing=!1,this.resizeDirection=null,this.dragOffsetX=0,this.dragOffsetY=0,this.positionOffsetX=0,this.positionOffsetY=0,this.initialMouseX=0,this.initialMouseY=0,this.needsPositionConversion=!1,this.resizeStartX=0,this.resizeStartY=0,this.resizeStartWidth=0,this.resizeStartHeight=0,this.resizeStartLeft=0,this.resizeStartTop=0,this.keyboardDragMode=!1,this.keyboardResizeMode=!1,this.pointerResizeMode=!1,this.manuallyPositioned=!1,this.resizeHandlesManaged=new Map,this.resizeIndicatorElement=null,this.handlers={mousedown:this.onMouseDown.bind(this),mousemove:this.onMouseMove.bind(this),mouseup:this.onMouseUp.bind(this),touchstart:this.onTouchStart.bind(this),touchmove:this.onTouchMove.bind(this),touchend:this.onTouchEnd.bind(this),pointerdown:this.onPointerDown.bind(this),pointermove:this.onPointerMove.bind(this),pointerup:this.onPointerUp.bind(this),pointercancel:this.onPointerUp.bind(this),keydown:this.onKeyDown.bind(this),resizeHandleMousedown:this.onResizeHandleMouseDown.bind(this),resizeHandlePointerDown:this.onResizeHandlePointerDown.bind(this)},this.activePointerId=null,this.activePointerType=null,this.init()}hasManagedResizeHandles(){return Array.from(this.resizeHandlesManaged.values()).some(Boolean)}storeOriginalHandleDisplay(e){e.dataset.originalDisplay||(e.dataset.originalDisplay=e.style.display||"")}hideResizeHandle(e){e.style.display="none",e.setAttribute("aria-hidden","true")}showResizeHandle(e){let t=e.dataset.originalDisplay!==void 0?e.dataset.originalDisplay:"";e.style.display=t,e.removeAttribute("aria-hidden")}setManagedHandlesVisible(e){!this.options.resizeHandles||this.options.resizeHandles.length===0||this.options.resizeHandles.forEach(t=>{this.resizeHandlesManaged.get(t)&&(e?this.showResizeHandle(t):this.hideResizeHandle(t))})}init(){let e=this.options.dragHandle||this.element;typeof window!="undefined"&&"PointerEvent"in window?(e.addEventListener("pointerdown",this.handlers.pointerdown),document.addEventListener("pointermove",this.handlers.pointermove,{passive:!1}),document.addEventListener("pointerup",this.handlers.pointerup),document.addEventListener("pointercancel",this.handlers.pointercancel)):(e.addEventListener("mousedown",this.handlers.mousedown),e.addEventListener("touchstart",this.handlers.touchstart,{passive:!1}),document.addEventListener("mousemove",this.handlers.mousemove),document.addEventListener("mouseup",this.handlers.mouseup),document.addEventListener("touchmove",this.handlers.touchmove,{passive:!1}),document.addEventListener("touchend",this.handlers.touchend)),this.element.addEventListener("keydown",this.handlers.keydown),this.options.resizeHandles&&this.options.resizeHandles.length>0&&this.options.resizeHandles.forEach(t=>{typeof window!="undefined"&&"PointerEvent"in window?t.addEventListener("pointerdown",this.handlers.resizeHandlePointerDown):(t.addEventListener("mousedown",this.handlers.resizeHandleMousedown),t.addEventListener("touchstart",this.handlers.resizeHandleMousedown,{passive:!1}));let i=t.dataset.vidplyManagedResize==="true";this.resizeHandlesManaged.set(t,i),i&&(this.storeOriginalHandleDisplay(t),this.hideResizeHandle(t))})}onPointerDown(e){var t,i;if(e.isPrimary!==!1&&!(e.pointerType==="mouse"&&e.button!==0)&&!e.target.classList.contains("".concat(this.options.classPrefix,"-resize-handle"))&&!(this.options.onDragStart&&!this.options.onDragStart(e))){this.activePointerId=e.pointerId,this.activePointerType=e.pointerType;try{(i=(t=e.currentTarget)==null?void 0:t.setPointerCapture)==null||i.call(t,e.pointerId)}catch(s){}this.startDragging(e.clientX,e.clientY),e.preventDefault()}}onPointerMove(e){this.activePointerId!==null&&e.pointerId!==this.activePointerId||(this.isDragging?(this.drag(e.clientX,e.clientY),e.preventDefault()):this.isResizing&&(this.resize(e.clientX,e.clientY),e.preventDefault()))}onPointerUp(e){this.activePointerId!==null&&e.pointerId!==this.activePointerId||(this.isDragging?this.stopDragging():this.isResizing&&this.stopResizing(),this.activePointerId=null,this.activePointerType=null)}onMouseDown(e){e.target.classList.contains("".concat(this.options.classPrefix,"-resize-handle"))||this.options.onDragStart&&!this.options.onDragStart(e)||(this.startDragging(e.clientX,e.clientY),e.preventDefault())}onTouchStart(e){if(e.target.classList.contains("".concat(this.options.classPrefix,"-resize-handle"))||this.options.onDragStart&&!this.options.onDragStart(e))return;let t=e.touches[0];this.startDragging(t.clientX,t.clientY),e.preventDefault()}onResizeHandlePointerDown(e){var i,s;if(e.isPrimary===!1||e.pointerType==="mouse"&&e.button!==0)return;e.preventDefault(),e.stopPropagation();let t=e.target;this.resizeDirection=t.getAttribute("data-direction"),this.activePointerId=e.pointerId,this.activePointerType=e.pointerType;try{(s=(i=e.currentTarget)==null?void 0:i.setPointerCapture)==null||s.call(i,e.pointerId)}catch(a){}this.startResizing(e.clientX,e.clientY)}onResizeHandleMouseDown(e){var a,n,o,r;e.preventDefault(),e.stopPropagation();let t=e.target;this.resizeDirection=t.getAttribute("data-direction");let i=e.clientX||((n=(a=e.touches)==null?void 0:a[0])==null?void 0:n.clientX),s=e.clientY||((r=(o=e.touches)==null?void 0:o[0])==null?void 0:r.clientY);this.startResizing(i,s)}onMouseMove(e){this.isDragging?(this.drag(e.clientX,e.clientY),e.preventDefault()):this.isResizing&&(this.resize(e.clientX,e.clientY),e.preventDefault())}onTouchMove(e){if(this.isDragging||this.isResizing){let t=e.touches[0];this.isDragging?this.drag(t.clientX,t.clientY):this.resize(t.clientX,t.clientY),e.preventDefault()}}onMouseUp(){this.isDragging?this.stopDragging():this.isResizing&&this.stopResizing()}onTouchEnd(){this.isDragging?this.stopDragging():this.isResizing&&this.stopResizing()}onKeyDown(e){if(e.key.toLowerCase()===this.options.keyboardDragKey.toLowerCase()){e.preventDefault(),this.toggleKeyboardDragMode();return}if(e.key.toLowerCase()===this.options.keyboardResizeKey.toLowerCase()){e.preventDefault(),this.hasManagedResizeHandles()?this.togglePointerResizeMode():this.toggleKeyboardResizeMode();return}if(e.key==="Escape"){if(this.pointerResizeMode){e.preventDefault(),this.disablePointerResizeMode();return}if(this.keyboardDragMode||this.keyboardResizeMode){e.preventDefault(),this.disableKeyboardDragMode(),this.disableKeyboardResizeMode();return}}["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)&&(this.keyboardDragMode?(e.preventDefault(),e.stopPropagation(),this.keyboardDrag(e.key,e.shiftKey)):this.keyboardResizeMode&&(e.preventDefault(),e.stopPropagation(),this.keyboardResize(e.key,e.shiftKey))),e.key==="Home"&&(this.keyboardDragMode||this.keyboardResizeMode)&&(e.preventDefault(),this.resetPosition())}startDragging(e,t){let i=this.element.getBoundingClientRect(),s=window.getComputedStyle(this.element),a=s.right!=="auto"||s.bottom!=="auto"||s.transform!=="none";if(this.positionOffsetX=0,this.positionOffsetY=0,a){let o,r;if(s.position==="absolute"){let h=(this.element.offsetParent||document.body).getBoundingClientRect();o=i.left-h.left,r=i.top-h.top,this.positionOffsetX=h.left,this.positionOffsetY=h.top}else if(s.position==="fixed"){let d=parseFloat(s.left),h=parseFloat(s.top),p=Number.isFinite(d),y=Number.isFinite(h);o=p?d:i.left,r=y?h:i.top,this.positionOffsetX=i.left-o,this.positionOffsetY=i.top-r}else o=i.left,r=i.top,this.positionOffsetX=i.left-o,this.positionOffsetY=i.top-r;let l=this.element.style.cssText.split(";").filter(d=>{let h=d.trim();if(!h)return!1;let p=h.indexOf(":");if(p===-1)return!1;let y=h.substring(0,p).trim(),b=h.substring(p+1).trim();return!(!b||b===""||y==="right"||y==="bottom"||y==="transform"||y==="left"||y==="top"||y==="inset"||y.startsWith("border-image"))}).join("; ");l&&(l+="; "),l+="left: ".concat(o,"px; top: ").concat(r,"px; right: auto; bottom: auto; transform: none"),this.element.style.cssText=l}let n=this.element.getBoundingClientRect();this.dragOffsetX=e-n.left,this.dragOffsetY=t-n.top,this.isDragging=!0,this.element.classList.add("".concat(this.options.classPrefix,"-dragging")),document.body.style.cursor="grabbing",document.body.style.userSelect="none"}drag(e,t){if(!this.isDragging)return;let i=e-this.dragOffsetX-this.positionOffsetX,s=t-this.dragOffsetY-this.positionOffsetY;if(this.options.constrainToViewport){let a=this.element.getBoundingClientRect(),n=document.documentElement.clientWidth,o=document.documentElement.clientHeight,r=100,c=-(a.width-r),l=-(a.height-r),d=n-r,h=o-r;i=Math.max(c,Math.min(i,d)),s=Math.max(l,Math.min(s,h))}this.element.style.left="".concat(i,"px"),this.element.style.top="".concat(s,"px"),this.options.onDrag&&this.options.onDrag({x:i,y:s})}stopDragging(){this.isDragging=!1,this.element.classList.remove("".concat(this.options.classPrefix,"-dragging")),document.body.style.cursor="",document.body.style.userSelect="",this.manuallyPositioned=!0,this.options.onDragEnd&&this.options.onDragEnd()}startResizing(e,t){this.isResizing=!0,this.resizeStartX=e,this.resizeStartY=t;let i=this.element.getBoundingClientRect();this.resizeStartWidth=i.width,this.resizeStartHeight=i.height,this.resizeStartLeft=i.left,this.resizeStartTop=i.top,this.element.classList.add("".concat(this.options.classPrefix,"-resizing")),document.body.style.userSelect="none",this.options.onResizeStart&&this.options.onResizeStart()}resize(e,t){if(!this.isResizing)return;let i=e-this.resizeStartX,s=t-this.resizeStartY,a=this.resizeStartWidth,n=this.resizeStartHeight,o=this.resizeStartLeft,r=this.resizeStartTop;if(this.resizeDirection.includes("e")&&(a=Math.max(this.options.minWidth,this.resizeStartWidth+i)),this.resizeDirection.includes("w")){let l=Math.max(this.options.minWidth,this.resizeStartWidth-i);o=this.resizeStartLeft+(this.resizeStartWidth-l),a=l}let c=typeof this.options.maxWidth=="function"?this.options.maxWidth():this.options.maxWidth;if(Number.isFinite(c)){let l=Math.min(a,c);l!==a&&this.resizeDirection.includes("w")&&(o+=a-l),a=l}if(!this.options.maintainAspectRatio){if(this.resizeDirection.includes("s")&&(n=Math.max(this.options.minHeight,this.resizeStartHeight+s)),this.resizeDirection.includes("n")){let d=Math.max(this.options.minHeight,this.resizeStartHeight-s);r=this.resizeStartTop+(this.resizeStartHeight-d),n=d}let l=typeof this.options.maxHeight=="function"?this.options.maxHeight():this.options.maxHeight;if(Number.isFinite(l)){let d=Math.min(n,l);d!==n&&this.resizeDirection.includes("n")&&(r+=n-d),n=d}}this.element.style.width="".concat(a,"px"),this.options.maintainAspectRatio?this.element.style.height="auto":this.element.style.height="".concat(n,"px"),this.resizeDirection.includes("w")&&(this.element.style.left="".concat(o,"px")),this.resizeDirection.includes("n")&&!this.options.maintainAspectRatio&&(this.element.style.top="".concat(r,"px")),this.options.onResize&&this.options.onResize({width:a,height:n,left:o,top:r})}stopResizing(){this.isResizing=!1,this.resizeDirection=null,this.element.classList.remove("".concat(this.options.classPrefix,"-resizing")),document.body.style.userSelect="",this.manuallyPositioned=!0,this.options.onResizeEnd&&this.options.onResizeEnd()}toggleKeyboardDragMode(){this.keyboardDragMode?this.disableKeyboardDragMode():this.enableKeyboardDragMode()}enableKeyboardDragMode(){this.keyboardDragMode=!0,this.keyboardResizeMode=!1,this.element.classList.add("".concat(this.options.classPrefix,"-keyboard-drag")),this.element.classList.remove("".concat(this.options.classPrefix,"-keyboard-resize")),this.focusElement()}disableKeyboardDragMode(){this.keyboardDragMode=!1,this.element.classList.remove("".concat(this.options.classPrefix,"-keyboard-drag"))}toggleKeyboardResizeMode(){this.keyboardResizeMode?this.disableKeyboardResizeMode():this.enableKeyboardResizeMode()}enableKeyboardResizeMode(){this.keyboardResizeMode=!0,this.keyboardDragMode=!1,this.element.classList.add("".concat(this.options.classPrefix,"-keyboard-resize")),this.element.classList.remove("".concat(this.options.classPrefix,"-keyboard-drag")),this.focusElement()}disableKeyboardResizeMode(){this.keyboardResizeMode=!1,this.element.classList.remove("".concat(this.options.classPrefix,"-keyboard-resize"))}enablePointerResizeMode({focus:e=!0}={}){if(!this.hasManagedResizeHandles()){this.enableKeyboardResizeMode();return}this.pointerResizeMode||(this.pointerResizeMode=!0,this.setManagedHandlesVisible(!0),this.element.classList.add("".concat(this.options.classPrefix,"-resizable")),this.enableKeyboardResizeMode(),e&&this.focusElement(),typeof this.options.onPointerResizeToggle=="function"&&this.options.onPointerResizeToggle(!0))}disablePointerResizeMode({focus:e=!1}={}){this.pointerResizeMode&&(this.pointerResizeMode=!1,this.setManagedHandlesVisible(!1),this.element.classList.remove("".concat(this.options.classPrefix,"-resizable")),this.disableKeyboardResizeMode(),e&&this.focusElement(),typeof this.options.onPointerResizeToggle=="function"&&this.options.onPointerResizeToggle(!1))}togglePointerResizeMode(){return this.pointerResizeMode?this.disablePointerResizeMode():this.enablePointerResizeMode(),this.pointerResizeMode}focusElement(){if(typeof this.element.focus=="function")try{this.element.focus({preventScroll:!0})}catch(e){this.element.focus()}}keyboardDrag(e,t){let i=t?this.options.keyboardStepLarge:this.options.keyboardStep,s=parseFloat(this.element.style.left)||0,a=parseFloat(this.element.style.top)||0;if(window.getComputedStyle(this.element).transform!=="none"){let c=this.element.getBoundingClientRect();s=c.left,a=c.top,this.element.style.transform="none",this.element.style.left="".concat(s,"px"),this.element.style.top="".concat(a,"px")}let o=s,r=a;switch(e){case"ArrowLeft":o-=i;break;case"ArrowRight":o+=i;break;case"ArrowUp":r-=i;break;case"ArrowDown":r+=i;break}this.element.style.left="".concat(o,"px"),this.element.style.top="".concat(r,"px"),this.options.onDrag&&this.options.onDrag({x:o,y:r})}keyboardResize(e,t){let i=t?this.options.keyboardStepLarge:this.options.keyboardStep,s=this.element.getBoundingClientRect(),a=s.width,n=s.height;switch(e){case"ArrowLeft":a-=i;break;case"ArrowRight":a+=i;break;case"ArrowUp":this.options.maintainAspectRatio?a+=i:n-=i;break;case"ArrowDown":this.options.maintainAspectRatio?a-=i:n+=i;break}a=Math.max(this.options.minWidth,a),n=Math.max(this.options.minHeight,n),this.element.style.width="".concat(a,"px"),this.options.maintainAspectRatio?this.element.style.height="auto":this.element.style.height="".concat(n,"px"),this.options.onResize&&this.options.onResize({width:a,height:n})}resetPosition(){this.element.style.left="50%",this.element.style.top="50%",this.element.style.transform="translate(-50%, -50%)",this.element.style.right="",this.element.style.bottom="",this.manuallyPositioned=!1,this.options.onDrag&&this.options.onDrag({centered:!0})}destroy(){let e=this.options.dragHandle||this.element;this.disablePointerResizeMode(),e.removeEventListener("mousedown",this.handlers.mousedown),e.removeEventListener("touchstart",this.handlers.touchstart),e.removeEventListener("pointerdown",this.handlers.pointerdown),document.removeEventListener("mousemove",this.handlers.mousemove),document.removeEventListener("mouseup",this.handlers.mouseup),document.removeEventListener("touchmove",this.handlers.touchmove),document.removeEventListener("touchend",this.handlers.touchend),document.removeEventListener("pointermove",this.handlers.pointermove),document.removeEventListener("pointerup",this.handlers.pointerup),document.removeEventListener("pointercancel",this.handlers.pointercancel),this.element.removeEventListener("keydown",this.handlers.keydown),this.options.resizeHandles&&this.options.resizeHandles.length>0&&this.options.resizeHandles.forEach(t=>{t.removeEventListener("mousedown",this.handlers.resizeHandleMousedown),t.removeEventListener("touchstart",this.handlers.resizeHandleMousedown),t.removeEventListener("pointerdown",this.handlers.resizeHandlePointerDown)}),this.element.classList.remove("".concat(this.options.classPrefix,"-dragging"),"".concat(this.options.classPrefix,"-resizing"),"".concat(this.options.classPrefix,"-keyboard-drag"),"".concat(this.options.classPrefix,"-keyboard-resize"))}}});function z({classPrefix:u,itemClass:e,icon:t,label:i,ariaLabel:s,onClick:a,hasTextClass:n=!1}){let o=typeof i=="string"&&(i.startsWith("transcript.")||i.startsWith("player.")||i.startsWith("settings.")),r=s||o&&m.t(i)||i,c=g.createElement("button",{className:e,attributes:{type:"button","aria-label":r,tabindex:"-1"}});t&&c.appendChild(T(t));let d=typeof i=="string"&&(i.startsWith("transcript.")||i.startsWith("player.")||i.startsWith("settings."))&&m.t(i)||i,h=g.createElement("span",{textContent:d,className:n?"".concat(u,"-settings-text"):void 0,attributes:{"aria-hidden":"true"}});return c.appendChild(h),a&&c.addEventListener("click",a),c}function I(u,e,t,i){if(!u)return;let s=Array.from(u.querySelectorAll(t));if(s.length===0)return;let a=n=>{let o=s.indexOf(document.activeElement);switch(n.key){case"ArrowDown":n.preventDefault(),n.stopPropagation();let r=(o+1)%s.length;s.forEach((d,h)=>{d.setAttribute("tabindex",h===r?"0":"-1")}),s[r].focus({preventScroll:!1}),s[r].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"ArrowUp":n.preventDefault(),n.stopPropagation();let c=(o-1+s.length)%s.length;s.forEach((d,h)=>{d.setAttribute("tabindex",h===c?"0":"-1")}),s[c].focus({preventScroll:!1}),s[c].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"Home":n.preventDefault(),n.stopPropagation(),s.forEach((d,h)=>{d.setAttribute("tabindex",h===0?"0":"-1")}),s[0].focus({preventScroll:!1}),s[0].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"End":n.preventDefault(),n.stopPropagation();let l=s.length-1;s.forEach((d,h)=>{d.setAttribute("tabindex",h===l?"0":"-1")}),s[l].focus({preventScroll:!1}),s[l].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"Enter":case" ":n.preventDefault(),n.stopPropagation(),document.activeElement&&s.includes(document.activeElement)&&(document.activeElement.click(),i&&setTimeout(()=>{e&&document.contains(e)&&e.focus()},0));break;case"Escape":n.preventDefault(),n.stopPropagation(),i&&i();break}};return u.addEventListener("keydown",a,!0),a}function Q(u,e,t=0){u&&setTimeout(()=>{let i=Array.from(u.querySelectorAll(e));i.length>0&&(i.forEach((s,a)=>{s.setAttribute("tabindex",a===0?"0":"-1")}),N(i[0],{delay:0}),i[0].scrollIntoView({behavior:"smooth",block:"nearest"}))},t)}var ue=D(()=>{F();q();O();ne()});function G({classPrefix:u,labelClass:e,selectClass:t,labelText:i,selectId:s,hidden:a=!1,onChange:n=null,options:o=[]}){let c=typeof i=="string"&&(i.startsWith("transcript.")||i.startsWith("player.")||i.startsWith("settings.")||i.startsWith("captions."))&&m.t(i)||i,l=g.createElement("label",{className:e,textContent:c,attributes:{for:s,style:a?"display: none;":void 0}}),d=g.createElement("select",{className:t,attributes:{id:s,style:a?"display: none;":void 0}});return o.forEach(h=>{let p=g.createElement("option",{textContent:h.text,attributes:{value:h.value,selected:h.selected?"selected":void 0}});d.appendChild(p)}),n&&d.addEventListener("change",n),{label:l,select:d}}function J(u){u&&["mousedown","click"].forEach(e=>{u.addEventListener(e,t=>{t.stopPropagation()})})}var pe=D(()=>{F();O()});var Ke={};H(Ke,{TranscriptManager:()=>we});var we,je=D(()=>{F();ae();q();O();ce();ne();ue();he();pe();we=class{constructor(e){var i,s;this.player=e,this.transcriptWindow=null,this.transcriptEntries=[],this.metadataCues=[],this.currentActiveEntry=null,this.isVisible=!1,this.storage=new W("vidply"),this.draggableResizable=null,this.settingsMenuVisible=!1,this.settingsMenu=null,this.settingsButton=null,this.settingsMenuJustOpened=!1,this.resizeOptionButton=null,this.resizeOptionText=null,this.dragOptionButton=null,this.dragOptionText=null,this.resizeModeIndicator=null,this.resizeModeIndicatorTimeout=null,this.transcriptResizeHandles=[],this.liveRegion=null,this.styleDialog=null,this.styleDialogVisible=!1,this.styleDialogJustOpened=!1,this.languageSelector=null,this.languageLabel=null,this.currentTranscriptLanguage=null,this.availableTranscriptLanguages=[],this.languageSelectorHandler=null;let t=this.storage.getTranscriptPreferences();this.autoscrollEnabled=(t==null?void 0:t.autoscroll)!==void 0?t.autoscroll:!0,this.showTimestamps=(t==null?void 0:t.showTimestamps)!==void 0?t.showTimestamps:!1,this.transcriptStyle={fontSize:(t==null?void 0:t.fontSize)||this.player.options.transcriptFontSize||"100%",fontFamily:(t==null?void 0:t.fontFamily)||this.player.options.transcriptFontFamily||"sans-serif",color:(t==null?void 0:t.color)||this.player.options.transcriptColor||"#ffffff",backgroundColor:(t==null?void 0:t.backgroundColor)||this.player.options.transcriptBackgroundColor||"#1e1e1e",opacity:(s=(i=t==null?void 0:t.opacity)!=null?i:this.player.options.transcriptOpacity)!=null?s:.98},this.handlers={timeupdate:()=>this.updateActiveEntry(),audiodescriptionenabled:()=>{this.isVisible&&this.loadTranscriptData()},audiodescriptiondisabled:()=>{this.isVisible&&this.loadTranscriptData()},resize:null,settingsClick:null,settingsKeydown:null,documentClick:null,styleDialogKeydown:null},this.timeouts=new Set,this.init()}init(){this.setupMetadataHandlingOnLoad(),this.player.on("timeupdate",this.handlers.timeupdate),this.player.on("audiodescriptionenabled",this.handlers.audiodescriptionenabled),this.player.on("audiodescriptiondisabled",this.handlers.audiodescriptiondisabled),this.player.on("fullscreenchange",()=>{this.isVisible&&(window.innerWidth<768&&this.setupDragAndDrop(),(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.setManagedTimeout(()=>this.positionTranscript(),100))})}toggleTranscript(){this.isVisible?this.hideTranscript():this.showTranscript()}showTranscript(){if(this.transcriptWindow){this.transcriptWindow.style.display="flex",this.isVisible=!0,this.player.controlBar&&typeof this.player.controlBar.updateTranscriptButton=="function"&&this.player.controlBar.updateTranscriptButton(),N(this.settingsButton,{delay:150});return}this.createTranscriptWindow(),this.loadTranscriptData(),this.transcriptWindow&&(this.transcriptWindow.style.display="flex",(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.setManagedTimeout(()=>this.positionTranscript(),0),N(this.settingsButton,{delay:150})),this.isVisible=!0}hideTranscript({focusButton:e=!1}={}){var t,i;if(this.transcriptWindow&&(this.transcriptWindow.style.display="none",this.isVisible=!1),this.draggableResizable&&this.draggableResizable.pointerResizeMode&&(this.draggableResizable.disablePointerResizeMode(),this.updateResizeOptionState()),this.hideResizeModeIndicator(),this.announceLive(""),this.player.controlBar&&typeof this.player.controlBar.updateTranscriptButton=="function"&&this.player.controlBar.updateTranscriptButton(),e){let s=(i=(t=this.player.controlBar)==null?void 0:t.controls)==null?void 0:i.transcript;s&&typeof s.focus=="function"&&s.focus({preventScroll:!0})}}createTranscriptWindow(){this.transcriptWindow=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-window"),attributes:{role:"dialog","aria-label":m.t("transcript.ariaLabel"),tabindex:"-1"}}),this.transcriptHeader=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-header"),attributes:{tabindex:"0"}}),this.headerLeft=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-header-left")});let e=m.t("transcript.settingsMenu");this.settingsButton=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-transcript-settings"),attributes:{type:"button","aria-label":e,"aria-expanded":"false"}}),this.settingsButton.appendChild(T("settings")),g.attachTooltip(this.settingsButton,e,this.player.options.classPrefix),this.handlers.settingsClick=p=>{p.preventDefault(),p.stopPropagation(),this.settingsMenuVisible?this.hideSettingsMenu():this.showSettingsMenu()},this.settingsButton.addEventListener("click",this.handlers.settingsClick),this.handlers.settingsKeydown=p=>{p.key==="d"||p.key==="D"?(p.preventDefault(),p.stopPropagation(),this.toggleKeyboardDragMode()):p.key==="r"||p.key==="R"?(p.preventDefault(),p.stopPropagation(),this.toggleResizeMode()):p.key==="Escape"&&this.settingsMenuVisible&&(p.preventDefault(),p.stopPropagation(),this.hideSettingsMenu())},this.settingsButton.addEventListener("keydown",this.handlers.settingsKeydown);let t=g.createElement("h3",{textContent:"".concat(m.t("transcript.title"),". ").concat(m.t("transcript.dragResizePrompt"))}),i="".concat(this.player.options.classPrefix,"-transcript-autoscroll-").concat(Date.now()),s=g.createElement("label",{className:"".concat(this.player.options.classPrefix,"-transcript-autoscroll-label"),attributes:{for:i}});this.autoscrollCheckbox=g.createElement("input",{attributes:{id:i,type:"checkbox"}}),this.autoscrollEnabled&&(this.autoscrollCheckbox.checked=!0);let a=g.createElement("span",{textContent:m.t("transcript.autoscroll"),className:"".concat(this.player.options.classPrefix,"-transcript-autoscroll-text")});s.appendChild(this.autoscrollCheckbox),s.appendChild(a),this.autoscrollCheckbox.addEventListener("change",p=>{this.autoscrollEnabled=p.target.checked,this.saveAutoscrollPreference()}),this.transcriptHeader.appendChild(t),this.headerLeft.appendChild(this.settingsButton),this.headerLeft.appendChild(s);let n="".concat(this.player.options.classPrefix,"-transcript-language-select-").concat(Date.now()),{label:o,select:r}=G({classPrefix:this.player.options.classPrefix,labelClass:"".concat(this.player.options.classPrefix,"-transcript-language-label"),selectClass:"".concat(this.player.options.classPrefix,"-transcript-language-select"),labelText:"settings.language",selectId:n,hidden:!1});this.languageLabel=o,this.languageSelector=r;let c=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-language-wrapper"),attributes:{style:"display: none;"}});c.appendChild(this.languageLabel),c.appendChild(this.languageSelector),this.languageSelectorWrapper=c,J(c),this.headerLeft.appendChild(c);let l=m.t("transcript.close"),d=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-transcript-close"),attributes:{type:"button","aria-label":l}});d.appendChild(T("close")),g.attachTooltip(d,l,this.player.options.classPrefix),d.addEventListener("click",()=>this.hideTranscript({focusButton:!0})),this.transcriptHeader.appendChild(this.headerLeft),this.transcriptHeader.appendChild(d),this.transcriptContent=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-content")}),this.transcriptWindow.appendChild(this.transcriptHeader),this.transcriptWindow.appendChild(this.transcriptContent),this.createResizeHandles(),this.liveRegion=g.createElement("div",{className:"vidply-sr-only",attributes:{"aria-live":"polite","aria-atomic":"true"}}),this.transcriptWindow.appendChild(this.liveRegion),this.player.container.appendChild(this.transcriptWindow),this.setupDragAndDrop(),(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.positionTranscript(),this.handlers.documentClick=p=>{this.settingsMenuJustOpened||this.styleDialogJustOpened||this.settingsButton&&this.settingsButton.contains(p.target)||this.settingsMenu&&this.settingsMenu.contains(p.target)||(this.settingsMenuVisible&&this.hideSettingsMenu(),this.styleDialogVisible&&this.styleDialog&&!this.styleDialog.contains(p.target)&&this.hideStyleDialog())},this.documentClickHandlerAdded=!1;let h;this.handlers.resize=()=>{h&&this.clearManagedTimeout(h),h=this.setManagedTimeout(()=>{(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.positionTranscript()},100)},window.addEventListener("resize",this.handlers.resize)}createResizeHandles(){if(!this.transcriptWindow)return;let e=["n","s","e","w","ne","nw","se","sw"];this.transcriptResizeHandles=e.map(t=>{let i=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-resize-handle ").concat(this.player.options.classPrefix,"-transcript-resize-").concat(t),attributes:{"data-direction":t,"data-vidply-managed-resize":"true","aria-hidden":"true"}});return i.style.display="none",this.transcriptWindow.appendChild(i),i})}positionTranscript(){if(!this.transcriptWindow||!this.player.videoWrapper||!this.isVisible||this.draggableResizable&&this.draggableResizable.manuallyPositioned)return;let e=window.innerWidth<768,t=this.player.videoWrapper.getBoundingClientRect(),i=this.player.state.fullscreen;if(e&&!i)this.transcriptWindow.style.position="relative",this.transcriptWindow.style.left="0",this.transcriptWindow.style.right="0",this.transcriptWindow.style.bottom="auto",this.transcriptWindow.style.top="auto",this.transcriptWindow.style.width="100%",this.transcriptWindow.style.maxWidth="100%",this.transcriptWindow.style.maxHeight="400px",this.transcriptWindow.style.height="auto",this.transcriptWindow.style.borderRadius="0",this.transcriptWindow.style.transform="none",this.transcriptWindow.style.border="none",this.transcriptWindow.style.borderTop="1px solid var(--vidply-border-light)",this.transcriptWindow.style.removeProperty("border-right"),this.transcriptWindow.style.removeProperty("border-bottom"),this.transcriptWindow.style.removeProperty("border-left"),this.transcriptWindow.style.removeProperty("border-image"),this.transcriptWindow.style.removeProperty("border-image-source"),this.transcriptWindow.style.removeProperty("border-image-slice"),this.transcriptWindow.style.removeProperty("border-image-width"),this.transcriptWindow.style.removeProperty("border-image-outset"),this.transcriptWindow.style.removeProperty("border-image-repeat"),this.transcriptWindow.style.boxShadow="none",this.transcriptHeader&&(this.transcriptHeader.style.cursor="default"),this.transcriptWindow.parentNode!==this.player.container&&this.player.container.appendChild(this.transcriptWindow);else if(i){this.transcriptWindow.style.position="fixed",this.transcriptWindow.style.left="auto",this.transcriptWindow.style.right="20px",this.transcriptWindow.style.bottom="80px",this.transcriptWindow.style.top="auto",this.transcriptWindow.style.maxHeight="calc(100vh - 180px)",this.transcriptWindow.style.height="auto";let s=260,a=Math.max(s,window.innerWidth-40),n=parseFloat(this.transcriptWindow.style.width)||400,o=Math.max(s,Math.min(n,a));this.transcriptWindow.style.width="".concat(o,"px"),this.transcriptWindow.style.maxWidth="none",this.transcriptWindow.style.borderRadius="8px",this.transcriptWindow.style.border="1px solid var(--vidply-border)",this.transcriptWindow.style.removeProperty("border-top"),this.transcriptWindow.style.removeProperty("border-right"),this.transcriptWindow.style.removeProperty("border-bottom"),this.transcriptWindow.style.removeProperty("border-left"),this.transcriptWindow.style.removeProperty("border-image"),this.transcriptWindow.style.removeProperty("border-image-source"),this.transcriptWindow.style.removeProperty("border-image-slice"),this.transcriptWindow.style.removeProperty("border-image-width"),this.transcriptWindow.style.removeProperty("border-image-outset"),this.transcriptWindow.style.removeProperty("border-image-repeat"),this.transcriptHeader&&(this.transcriptHeader.style.cursor="move"),this.transcriptWindow.parentNode!==this.player.container&&this.player.container.appendChild(this.transcriptWindow)}else{let s=parseFloat(this.transcriptWindow.style.width)||400,a=20,n=260,o=this.player.container.getBoundingClientRect();window.getComputedStyle(this.player.container).position==="static"&&(this.player.container.style.position="relative");let c=t.right-o.left+a,l=window.innerWidth-t.right-a,d=Math.max(n,Math.min(s,l)),h=t.height;this.transcriptWindow.style.position="absolute",this.transcriptWindow.style.left="".concat(c,"px"),this.transcriptWindow.style.right="auto",this.transcriptWindow.style.bottom="auto",this.transcriptWindow.style.top="0",this.transcriptWindow.style.height="".concat(h,"px"),this.transcriptWindow.style.maxHeight="none",this.transcriptWindow.style.width="".concat(d,"px"),this.transcriptWindow.style.maxWidth="none",this.transcriptWindow.style.borderRadius="8px",this.transcriptWindow.style.border="1px solid var(--vidply-border)",this.transcriptWindow.style.removeProperty("border-top"),this.transcriptWindow.style.removeProperty("border-right"),this.transcriptWindow.style.removeProperty("border-bottom"),this.transcriptWindow.style.removeProperty("border-left"),this.transcriptWindow.style.removeProperty("border-image"),this.transcriptWindow.style.removeProperty("border-image-source"),this.transcriptWindow.style.removeProperty("border-image-slice"),this.transcriptWindow.style.removeProperty("border-image-width"),this.transcriptWindow.style.removeProperty("border-image-outset"),this.transcriptWindow.style.removeProperty("border-image-repeat"),this.transcriptHeader&&(this.transcriptHeader.style.cursor="move"),this.transcriptWindow.parentNode!==this.player.container&&this.player.container.appendChild(this.transcriptWindow)}}getAvailableTranscriptLanguages(){let e=this.player.textTracks,t=new Map;return e.forEach(i=>{(i.kind==="captions"||i.kind==="subtitles")&&i.language&&(t.has(i.language)||t.set(i.language,{language:i.language,label:i.label||i.language,track:i}))}),Array.from(t.values())}updateLanguageSelector(){if(this.languageSelector){if(this.availableTranscriptLanguages=this.getAvailableTranscriptLanguages(),this.languageSelector.innerHTML="",this.availableTranscriptLanguages.length<2){this.languageSelectorWrapper&&(this.languageSelectorWrapper.style.display="none");return}if(this.languageSelectorWrapper&&(this.languageSelectorWrapper.style.display="flex"),this.availableTranscriptLanguages.forEach((e,t)=>{let i=g.createElement("option",{textContent:e.label,attributes:{value:e.language,lang:e.language}});this.languageSelector.appendChild(i)}),this.currentTranscriptLanguage)this.languageSelector.value=this.currentTranscriptLanguage;else if(this.availableTranscriptLanguages.length>0){let e=this.player.textTracks.find(t=>(t.kind==="captions"||t.kind==="subtitles")&&t.mode==="showing");this.currentTranscriptLanguage=e?e.language:this.availableTranscriptLanguages[0].language,this.languageSelector.value=this.currentTranscriptLanguage}this.languageSelectorHandler&&this.languageSelector.removeEventListener("change",this.languageSelectorHandler),this.languageSelectorHandler=e=>{this.currentTranscriptLanguage=e.target.value,this.loadTranscriptData(),this.transcriptContent&&this.currentTranscriptLanguage&&this.transcriptContent.setAttribute("lang",this.currentTranscriptLanguage)},this.languageSelector.addEventListener("change",this.languageSelectorHandler)}}loadTranscriptData(){this.transcriptEntries=[],this.transcriptContent.innerHTML="";let e=this.player.textTracks,t=null;this.currentTranscriptLanguage&&(t=e.find(r=>(r.kind==="captions"||r.kind==="subtitles")&&r.language===this.currentTranscriptLanguage)),t||(t=e.find(r=>r.kind==="captions"||r.kind==="subtitles"),t&&(this.currentTranscriptLanguage=t.language));let i=null;this.currentTranscriptLanguage&&(i=e.find(r=>r.kind==="descriptions"&&r.language===this.currentTranscriptLanguage)),i||(i=e.find(r=>r.kind==="descriptions"));let s=e.find(r=>r.kind==="metadata");if(!t&&!i&&!s){this.showNoTranscriptMessage();return}let a=[t,i,s].filter(Boolean);if(a.forEach(r=>{r.mode==="disabled"&&(r.mode="hidden")}),a.some(r=>!r.cues||r.cues.length===0)){let r=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-loading"),textContent:m.t("transcript.loading")});this.transcriptContent.appendChild(r);let c=0,l=()=>{c++,c>=a.length&&this.loadTranscriptData()};a.forEach(d=>{d.addEventListener("load",l,{once:!0})}),this.setManagedTimeout(()=>{this.loadTranscriptData()},500);return}let o=[];t&&t.cues&&Array.from(t.cues).forEach(r=>{o.push({cue:r,type:"caption"})}),i&&i.cues&&Array.from(i.cues).forEach(r=>{o.push({cue:r,type:"description"})}),s&&s.cues&&(this.metadataCues=Array.from(s.cues),this.setupMetadataHandling()),o.sort((r,c)=>r.cue.startTime-c.cue.startTime),o.forEach((r,c)=>{let l=this.createTranscriptEntry(r.cue,c,r.type);this.transcriptEntries.push({element:l,cue:r.cue,type:r.type,startTime:r.cue.startTime,endTime:r.cue.endTime}),this.transcriptContent.appendChild(l)}),this.applyTranscriptStyles(),this.updateTimestampVisibility(),this.transcriptContent&&this.currentTranscriptLanguage&&this.transcriptContent.setAttribute("lang",this.currentTranscriptLanguage),this.updateLanguageSelector()}setupMetadataHandlingOnLoad(){let e=()=>{let i=this.player.textTracks.find(s=>s.kind==="metadata");if(i){if(i.mode==="disabled"&&(i.mode="hidden"),this.metadataCueChangeHandler&&i.removeEventListener("cuechange",this.metadataCueChangeHandler),this.metadataCueChangeHandler=()=>{let s=Array.from(i.activeCues||[]);s.length>0&&this.player.options.debug&&console.log("[VidPly Metadata] Active cues:",s.map(a=>({start:a.startTime,end:a.endTime,text:a.text}))),s.forEach(a=>{this.handleMetadataCue(a)})},i.addEventListener("cuechange",this.metadataCueChangeHandler),this.player.options.debug){let s=i.cues?i.cues.length:0;console.log("[VidPly Metadata] Track enabled,",s,"cues available")}}else this.player.options.debug&&console.warn("[VidPly Metadata] No metadata track found")};e(),this.player.on("loadedmetadata",e)}setupMetadataHandling(){!this.metadataCues||this.metadataCues.length===0||this.player.options.debug&&console.log("[VidPly Metadata]",this.metadataCues.length,"cues stored from transcript load")}handleMetadataCue(e){let t=e.text.trim();this.player.options.debug&&console.log("[VidPly Metadata] Processing cue:",{time:e.startTime,text:t}),this.player.emit("metadata",{time:e.startTime,endTime:e.endTime,text:t,cue:e}),t.includes("PAUSE")&&(this.player.state.paused||(this.player.options.debug&&console.log("[VidPly Metadata] Pausing video at",e.startTime),this.player.pause()),this.player.emit("metadata:pause",{time:e.startTime,text:t}));let i=t.match(/FOCUS:([\w#-]+)/);if(i){let a=i[1],n=document.querySelector(a);n?(this.player.options.debug&&console.log("[VidPly Metadata] Focusing element:",a),this.setManagedTimeout(()=>{n.focus({preventScroll:!0})},10)):this.player.options.debug&&console.warn("[VidPly Metadata] Element not found:",a),this.player.emit("metadata:focus",{time:e.startTime,target:a,element:n,text:t})}let s=t.match(/#[\w-]+/g);s&&(this.player.options.debug&&console.log("[VidPly Metadata] Hashtags found:",s),this.player.emit("metadata:hashtags",{time:e.startTime,hashtags:s,text:t}))}createTranscriptEntry(e,t,i="caption"){let s=this.stripVTTFormatting(e.text),a=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-entry ").concat(this.player.options.classPrefix,"-transcript-").concat(i),attributes:{tabindex:"0","data-start":String(e.startTime),"data-end":String(e.endTime),"data-type":i}}),n=g.createElement("span",{className:"".concat(this.player.options.classPrefix,"-transcript-time"),textContent:A.formatTime(e.startTime),attributes:{"aria-hidden":"true"}}),o=g.createElement("span",{className:"".concat(this.player.options.classPrefix,"-transcript-text"),textContent:s});a.appendChild(n),a.appendChild(o);let r=()=>{this.player.seek(e.startTime),this.player.state.paused&&this.player.play()};return a.addEventListener("click",r),a.addEventListener("keydown",c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),r())}),a}stripVTTFormatting(e){return e.replace(/<[^>]+>/g,"").replace(/\n/g," ").trim()}showNoTranscriptMessage(){let e=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-empty"),textContent:m.t("transcript.noTranscript")});this.transcriptContent.appendChild(e)}updateActiveEntry(){if(!this.isVisible||this.transcriptEntries.length===0)return;let e=this.player.state.currentTime,t=this.transcriptEntries.find(i=>e>=i.startTime&&e<i.endTime);t&&t!==this.currentActiveEntry?(this.currentActiveEntry&&this.currentActiveEntry.element.classList.remove("".concat(this.player.options.classPrefix,"-transcript-entry-active")),t.element.classList.add("".concat(this.player.options.classPrefix,"-transcript-entry-active")),this.scrollToEntry(t.element),this.currentActiveEntry=t):!t&&this.currentActiveEntry&&(this.currentActiveEntry.element.classList.remove("".concat(this.player.options.classPrefix,"-transcript-entry-active")),this.currentActiveEntry=null)}scrollToEntry(e){if(!this.transcriptContent||!this.autoscrollEnabled)return;let t=this.transcriptContent.getBoundingClientRect(),i=e.getBoundingClientRect();if(i.top<t.top||i.bottom>t.bottom){let s=e.offsetTop-this.transcriptContent.clientHeight/2+e.clientHeight/2;this.transcriptContent.scrollTo({top:s,behavior:"smooth"})}}saveAutoscrollPreference(){let e=this.storage.getTranscriptPreferences()||{};e.autoscroll=this.autoscrollEnabled,this.storage.saveTranscriptPreferences(e)}setupDragAndDrop(){if(!this.transcriptHeader||!this.transcriptWindow)return;let e=window.innerWidth<768,t=this.player.state.fullscreen;if(e&&!t){this.draggableResizable&&(this.draggableResizable.destroy(),this.draggableResizable=null);return}this.draggableResizable||(this.draggableResizable=new _(this.transcriptWindow,{dragHandle:this.transcriptHeader,resizeHandles:this.transcriptResizeHandles,constrainToViewport:!0,classPrefix:"".concat(this.player.options.classPrefix,"-transcript"),keyboardDragKey:"d",keyboardResizeKey:"r",keyboardStep:10,keyboardStepLarge:50,minWidth:300,minHeight:200,maxWidth:()=>Math.max(320,window.innerWidth-40),maxHeight:()=>Math.max(200,window.innerHeight-120),pointerResizeIndicatorText:m.t("transcript.resizeModeHint"),onPointerResizeToggle:i=>{this.transcriptResizeHandles.forEach(s=>{s.style.display=i?"block":"none"}),this.onPointerResizeModeChange(i)},onDragStart:i=>{let s=[".".concat(this.player.options.classPrefix,"-transcript-close"),".".concat(this.player.options.classPrefix,"-transcript-settings"),".".concat(this.player.options.classPrefix,"-transcript-language-select"),".".concat(this.player.options.classPrefix,"-transcript-language-label"),".".concat(this.player.options.classPrefix,"-transcript-settings-menu"),".".concat(this.player.options.classPrefix,"-transcript-style-dialog")];for(let a of s)if(i.target.closest(a))return!1;return!0}}),this.customKeyHandler=i=>{let s=i.key.toLowerCase(),a=i.defaultPrevented;if(!(this.settingsMenuVisible||this.styleDialogVisible)){if(s==="home"){i.preventDefault(),i.stopPropagation(),this.draggableResizable&&(this.draggableResizable.pointerResizeMode&&this.draggableResizable.disablePointerResizeMode(),this.draggableResizable.manuallyPositioned=!1,this.positionTranscript(),this.updateResizeOptionState(),this.announceLive(m.t("transcript.positionReset")));return}if(s==="r"){if(a)return;i.preventDefault(),i.stopPropagation(),this.toggleResizeMode()&&this.transcriptWindow.focus({preventScroll:!0});return}if(s==="escape"){if(this.draggableResizable&&this.draggableResizable.pointerResizeMode){i.preventDefault(),i.stopPropagation(),this.draggableResizable.disablePointerResizeMode();return}if(this.draggableResizable&&this.draggableResizable.keyboardDragMode){i.preventDefault(),i.stopPropagation(),this.draggableResizable.disableKeyboardDragMode(),this.announceLive(m.t("transcript.dragModeDisabled"));return}i.preventDefault(),i.stopPropagation(),this.hideTranscript({focusButton:!0});return}}},this.transcriptWindow.addEventListener("keydown",this.customKeyHandler))}toggleKeyboardDragMode(){if(this.draggableResizable){let e=this.draggableResizable.keyboardDragMode;this.draggableResizable.toggleKeyboardDragMode();let t=this.draggableResizable.keyboardDragMode;!e&&t&&this.enableMoveMode(),this.updateDragOptionState(),this.settingsMenuVisible&&this.hideSettingsMenu(),this.transcriptWindow.focus({preventScroll:!0})}}toggleSettingsMenu(){this.settingsMenuVisible?this.hideSettingsMenu():this.showSettingsMenu()}showSettingsMenu(){if(this.settingsMenuJustOpened=!0,setTimeout(()=>{this.settingsMenuJustOpened=!1},350),this.documentClickHandlerAdded||setTimeout(()=>{document.addEventListener("click",this.handlers.documentClick),this.documentClickHandlerAdded=!0},300),this.settingsMenu){this.settingsMenu.style.display="block",this.settingsMenuVisible=!0,this.settingsButton&&this.settingsButton.setAttribute("aria-expanded","true"),this.attachSettingsMenuKeyboardNavigation(),this.positionSettingsMenuImmediate(),this.updateResizeOptionState(),setTimeout(()=>{let v=this.settingsMenu.querySelectorAll(".".concat(this.player.options.classPrefix,"-transcript-settings-item"));if(v.length>0){v[0].setAttribute("tabindex","0");for(let f=1;f<v.length;f++)v[f].setAttribute("tabindex","-1");v[0].focus({preventScroll:!0})}},50);return}this.settingsMenu=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-settings-menu"),attributes:{role:"menu"}});let e=z({classPrefix:this.player.options.classPrefix,itemClass:"".concat(this.player.options.classPrefix,"-transcript-settings-item"),icon:"move",label:"transcript.enableDragMode",hasTextClass:!0,onClick:()=>{this.toggleKeyboardDragMode(),this.hideSettingsMenu()}});e.setAttribute("role","switch"),e.setAttribute("aria-checked","false");let t=e.querySelector(".".concat(this.player.options.classPrefix,"-tooltip"));t&&t.remove();let i=e.querySelector(".".concat(this.player.options.classPrefix,"-button-text"));i&&i.remove(),this.dragOptionButton=e,this.dragOptionText=e.querySelector(".".concat(this.player.options.classPrefix,"-settings-text")),this.updateDragOptionState();let s=z({classPrefix:this.player.options.classPrefix,itemClass:"".concat(this.player.options.classPrefix,"-transcript-settings-item"),icon:"settings",label:"transcript.styleTranscript",onClick:v=>{v.preventDefault(),v.stopPropagation(),this.hideSettingsMenu(),setTimeout(()=>{this.showStyleDialog()},50)}}),a=s.querySelector(".".concat(this.player.options.classPrefix,"-tooltip"));a&&a.remove();let n=s.querySelector(".".concat(this.player.options.classPrefix,"-button-text"));n&&n.remove();let o=z({classPrefix:this.player.options.classPrefix,itemClass:"".concat(this.player.options.classPrefix,"-transcript-settings-item"),icon:"resize",label:"transcript.enableResizeMode",hasTextClass:!0,onClick:v=>{v.preventDefault(),v.stopPropagation(),this.toggleResizeMode({focus:!1})?(this.hideSettingsMenu({focusButton:!1}),setTimeout(()=>{this.transcriptWindow&&this.transcriptWindow.focus({preventScroll:!0})},20)):this.hideSettingsMenu({focusButton:!0})}});o.setAttribute("role","switch"),o.setAttribute("aria-checked","false");let r=o.querySelector(".".concat(this.player.options.classPrefix,"-tooltip"));r&&r.remove();let c=o.querySelector(".".concat(this.player.options.classPrefix,"-button-text"));c&&c.remove(),this.resizeOptionButton=o,this.resizeOptionText=o.querySelector(".".concat(this.player.options.classPrefix,"-settings-text")),this.updateResizeOptionState();let l=z({classPrefix:this.player.options.classPrefix,itemClass:"".concat(this.player.options.classPrefix,"-transcript-settings-item"),icon:"clock",label:"transcript.showTimestamps",hasTextClass:!0,onClick:()=>{this.toggleShowTimestamps()}});l.setAttribute("role","switch"),l.setAttribute("aria-checked",this.showTimestamps?"true":"false");let d=l.querySelector(".".concat(this.player.options.classPrefix,"-tooltip"));d&&d.remove();let h=l.querySelector(".".concat(this.player.options.classPrefix,"-button-text"));h&&h.remove(),this.showTimestampsButton=l,this.showTimestampsText=l.querySelector(".".concat(this.player.options.classPrefix,"-settings-text")),this.updateShowTimestampsState();let p=z({classPrefix:this.player.options.classPrefix,itemClass:"".concat(this.player.options.classPrefix,"-transcript-settings-item"),icon:"close",label:"transcript.closeMenu",onClick:()=>{this.hideSettingsMenu()}}),y=p.querySelector(".".concat(this.player.options.classPrefix,"-tooltip"));y&&y.remove();let b=p.querySelector(".".concat(this.player.options.classPrefix,"-button-text"));b&&b.remove(),this.settingsMenu.appendChild(e),this.settingsMenu.appendChild(o),this.settingsMenu.appendChild(s),this.settingsMenu.appendChild(l),this.settingsMenu.appendChild(p),this.settingsMenu.style.visibility="hidden",this.settingsMenu.style.display="block",this.settingsButton&&this.settingsButton.parentNode?this.settingsButton.insertAdjacentElement("afterend",this.settingsMenu):this.headerLeft?this.headerLeft.appendChild(this.settingsMenu):this.transcriptHeader?this.transcriptHeader.appendChild(this.settingsMenu):this.transcriptWindow.appendChild(this.settingsMenu),this.positionSettingsMenuImmediate(),requestAnimationFrame(()=>{this.settingsMenu&&(this.settingsMenu.style.visibility="visible")}),this.settingsMenuKeyHandler=I(this.settingsMenu,this.settingsButton,".".concat(this.player.options.classPrefix,"-transcript-settings-item"),()=>this.hideSettingsMenu({focusButton:!0})),this.settingsMenuVisible=!0,this.settingsMenu.style.display="block",this.settingsButton&&this.settingsButton.setAttribute("aria-expanded","true"),this.updateResizeOptionState(),setTimeout(()=>{let v=this.settingsMenu.querySelectorAll(".".concat(this.player.options.classPrefix,"-transcript-settings-item"));if(v.length>0){v[0].setAttribute("tabindex","0");for(let f=1;f<v.length;f++)v[f].setAttribute("tabindex","-1");v[0].focus({preventScroll:!0})}},50)}positionSettingsMenuImmediate(){if(!this.settingsMenu||!this.settingsButton)return;let e=this.settingsButton.parentElement;if(!e)return;let t=this.settingsButton.getBoundingClientRect(),i=e.getBoundingClientRect(),s=this.settingsMenu.getBoundingClientRect(),a=window.innerHeight,n=t.left-i.left,o=t.bottom-i.top,r=t.top-i.top,c=a-t.bottom,l=t.top,d=o+4;c<s.height+20&&l>c?(d=r-s.height-4,this.settingsMenu.classList.add("vidply-menu-above")):this.settingsMenu.classList.remove("vidply-menu-above"),this.settingsMenu.style.top="".concat(d,"px"),this.settingsMenu.style.left="".concat(n,"px"),this.settingsMenu.style.right="auto",this.settingsMenu.style.bottom="auto"}positionSettingsMenu(){!this.settingsMenu||!this.settingsButton||requestAnimationFrame(()=>{setTimeout(()=>{this.positionSettingsMenuImmediate()},10)})}attachSettingsMenuKeyboardNavigation(){if(!this.settingsMenu)return;this.settingsMenuKeyHandler&&this.settingsMenu.removeEventListener("keydown",this.settingsMenuKeyHandler,!0);let e=I(this.settingsMenu,this.settingsButton,".".concat(this.player.options.classPrefix,"-transcript-settings-item"),()=>this.hideSettingsMenu({focusButton:!0}));this.settingsMenuKeyHandler=e}hideSettingsMenu({focusButton:e=!0}={}){this.settingsMenu&&(this.settingsMenu.style.display="none",this.settingsMenuVisible=!1,this.settingsMenuJustOpened=!1,this.settingsMenuKeyHandler&&(this.settingsMenu.removeEventListener("keydown",this.settingsMenuKeyHandler,!0),this.settingsMenuKeyHandler=null),this.settingsButton&&(this.settingsButton.setAttribute("aria-expanded","false"),e&&this.settingsButton.focus({preventScroll:!0})))}enableMoveMode(){this.hideResizeModeIndicator(),this.transcriptWindow.classList.add("".concat(this.player.options.classPrefix,"-transcript-move-mode"));let e=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-move-tooltip"),textContent:"Drag with mouse or press D for keyboard drag mode"});this.transcriptHeader.appendChild(e),setTimeout(()=>{this.transcriptWindow.classList.remove("".concat(this.player.options.classPrefix,"-transcript-move-mode")),e.parentNode&&e.remove()},2e3)}toggleResizeMode({focus:e=!0}={}){return this.draggableResizable?this.draggableResizable.pointerResizeMode?(this.draggableResizable.disablePointerResizeMode({focus:e}),!1):(this.draggableResizable.enablePointerResizeMode({focus:e}),!0):!1}updateDragOptionState(){if(!this.dragOptionButton)return;let e=!!(this.draggableResizable&&this.draggableResizable.keyboardDragMode),t=e?m.t("transcript.disableDragMode"):m.t("transcript.enableDragMode"),i=e?m.t("transcript.disableDragModeAria"):m.t("transcript.enableDragModeAria");this.dragOptionButton.setAttribute("aria-checked",e?"true":"false"),this.dragOptionButton.setAttribute("aria-label",i),this.dragOptionText&&(this.dragOptionText.textContent=t)}updateResizeOptionState(){if(!this.resizeOptionButton)return;let e=!!(this.draggableResizable&&this.draggableResizable.pointerResizeMode),t=e?m.t("transcript.disableResizeMode"):m.t("transcript.enableResizeMode"),i=e?m.t("transcript.disableResizeModeAria"):m.t("transcript.enableResizeModeAria");this.resizeOptionButton.setAttribute("aria-checked",e?"true":"false"),this.resizeOptionButton.setAttribute("aria-label",i),this.resizeOptionText&&(this.resizeOptionText.textContent=t)}toggleShowTimestamps(){this.showTimestamps=!this.showTimestamps,this.updateShowTimestampsState(),this.updateTimestampVisibility(),this.saveTimestampsPreference()}updateShowTimestampsState(){if(!this.showTimestampsButton)return;let e=this.showTimestamps?m.t("transcript.hideTimestamps"):m.t("transcript.showTimestamps"),t=this.showTimestamps?m.t("transcript.hideTimestampsAria"):m.t("transcript.showTimestampsAria");this.showTimestampsButton.setAttribute("aria-checked",this.showTimestamps?"true":"false"),this.showTimestampsButton.setAttribute("aria-label",t),this.showTimestampsText&&(this.showTimestampsText.textContent=e)}updateTimestampVisibility(){if(!this.transcriptContent)return;this.transcriptContent.querySelectorAll(".".concat(this.player.options.classPrefix,"-transcript-time")).forEach(t=>{t.style.display=this.showTimestamps?"":"none"})}saveTimestampsPreference(){let e=this.storage.getTranscriptPreferences()||{};e.showTimestamps=this.showTimestamps,this.storage.saveTranscriptPreferences(e)}showResizeModeIndicator(){if(!this.transcriptHeader)return;this.hideResizeModeIndicator();let e=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-resize-tooltip"),textContent:m.t("transcript.resizeModeHint")||"Resize handles enabled. Drag edges or corners to adjust. Press Esc or R to exit."});this.transcriptHeader.appendChild(e),this.resizeModeIndicator=e,this.resizeModeIndicatorTimeout=this.setManagedTimeout(()=>{this.hideResizeModeIndicator()},3e3)}hideResizeModeIndicator(){this.resizeModeIndicatorTimeout&&(this.clearManagedTimeout(this.resizeModeIndicatorTimeout),this.resizeModeIndicatorTimeout=null),this.resizeModeIndicator&&this.resizeModeIndicator.parentNode&&this.resizeModeIndicator.remove(),this.resizeModeIndicator=null}onPointerResizeModeChange(e){this.updateResizeOptionState(),e?(this.showResizeModeIndicator(),this.announceLive(m.t("transcript.resizeModeEnabled"))):(this.hideResizeModeIndicator(),this.announceLive(m.t("transcript.resizeModeDisabled")))}showStyleDialog(){if(this.styleDialog){this.styleDialog.style.display="block",this.styleDialogVisible=!0,this.handlers.styleDialogKeydown&&document.addEventListener("keydown",this.handlers.styleDialogKeydown),this.styleDialogJustOpened=!0,setTimeout(()=>{this.styleDialogJustOpened=!1},350),setTimeout(()=>{let r=this.styleDialog.querySelector("select, input");r&&r.focus({preventScroll:!0})},0);return}this.styleDialog=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-style-dialog")});let e=g.createElement("h4",{textContent:m.t("transcript.styleTitle"),className:"".concat(this.player.options.classPrefix,"-transcript-style-title")});this.styleDialog.appendChild(e);let t=this.createStyleSelectControl(m.t("captions.fontSize"),"fontSize",[{label:m.t("fontSizes.small"),value:"90%"},{label:m.t("fontSizes.normal"),value:"100%"},{label:m.t("fontSizes.large"),value:"110%"},{label:m.t("fontSizes.xlarge"),value:"120%"}]);this.styleDialog.appendChild(t);let i=this.createStyleSelectControl(m.t("captions.fontFamily"),"fontFamily",[{label:m.t("fontFamilies.sansSerif"),value:"sans-serif"},{label:m.t("fontFamilies.serif"),value:"serif"},{label:m.t("fontFamilies.monospace"),value:"monospace"}]);this.styleDialog.appendChild(i);let s=this.createStyleColorControl(m.t("captions.color"),"color");this.styleDialog.appendChild(s);let a=this.createStyleColorControl(m.t("captions.backgroundColor"),"backgroundColor");this.styleDialog.appendChild(a);let n=this.createStyleOpacityControl(m.t("captions.opacity"),"opacity");this.styleDialog.appendChild(n);let o=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-transcript-style-close"),textContent:m.t("settings.close"),attributes:{type:"button"}});o.addEventListener("click",()=>this.hideStyleDialog()),this.styleDialog.appendChild(o),this.handlers.styleDialogKeydown=r=>{if(this.styleDialogVisible){if(r.key==="Escape"){r.preventDefault(),r.stopPropagation(),this.hideStyleDialog();return}if(r.key==="Tab"){let c=this.styleDialog.querySelectorAll("select, input, button"),l=c[0],d=c[c.length-1];r.shiftKey&&document.activeElement===l?(r.preventDefault(),d.focus({preventScroll:!0})):!r.shiftKey&&document.activeElement===d&&(r.preventDefault(),l.focus({preventScroll:!0}))}}},document.addEventListener("keydown",this.handlers.styleDialogKeydown),this.headerLeft?this.headerLeft.appendChild(this.styleDialog):this.transcriptHeader.appendChild(this.styleDialog),this.applyTranscriptStyles(),this.styleDialogVisible=!0,this.styleDialog.style.display="block",this.styleDialogJustOpened=!0,setTimeout(()=>{this.styleDialogJustOpened=!1},350),setTimeout(()=>{let r=this.styleDialog.querySelector("select, input");r&&r.focus({preventScroll:!0})},0)}hideStyleDialog(){this.styleDialog&&(this.styleDialog.style.display="none",this.styleDialogVisible=!1,this.handlers.styleDialogKeydown&&document.removeEventListener("keydown",this.handlers.styleDialogKeydown),this.settingsButton&&this.settingsButton.focus({preventScroll:!0}))}createStyleSelectControl(e,t,i){let s=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-style-group")}),a="".concat(this.player.options.classPrefix,"-transcript-").concat(t,"-").concat(Date.now()),n=g.createElement("label",{textContent:e,attributes:{for:a}});s.appendChild(n);let o=g.createElement("select",{className:"".concat(this.player.options.classPrefix,"-transcript-style-select"),attributes:{id:a}});return i.forEach(r=>{let c=g.createElement("option",{textContent:r.label,attributes:{value:r.value}});this.transcriptStyle[t]===r.value&&(c.selected=!0),o.appendChild(c)}),o.addEventListener("change",r=>{this.transcriptStyle[t]=r.target.value,this.applyTranscriptStyles(),this.savePreferences()}),s.appendChild(o),s}createStyleColorControl(e,t){let i=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-style-group")}),s="".concat(this.player.options.classPrefix,"-transcript-").concat(t,"-").concat(Date.now()),a=g.createElement("label",{textContent:e,attributes:{for:s}});i.appendChild(a);let n=g.createElement("input",{attributes:{id:s,type:"color",value:this.transcriptStyle[t]},className:"".concat(this.player.options.classPrefix,"-transcript-style-color")});return n.addEventListener("input",o=>{this.transcriptStyle[t]=o.target.value,this.applyTranscriptStyles(),this.savePreferences()}),i.appendChild(n),i}createStyleOpacityControl(e,t){let i=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-style-group")}),s="".concat(this.player.options.classPrefix,"-transcript-").concat(t,"-").concat(Date.now()),a=g.createElement("label",{textContent:e,attributes:{for:s}});i.appendChild(a);let n=g.createElement("span",{textContent:Math.round(this.transcriptStyle[t]*100)+"%",className:"".concat(this.player.options.classPrefix,"-transcript-style-value")}),o=g.createElement("input",{attributes:{id:s,type:"range",min:"0",max:"1",step:"0.1",value:String(this.transcriptStyle[t])},className:"".concat(this.player.options.classPrefix,"-transcript-style-range")});o.addEventListener("input",c=>{let l=parseFloat(c.target.value);this.transcriptStyle[t]=l,n.textContent=Math.round(l*100)+"%",this.applyTranscriptStyles(),this.savePreferences()});let r=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-transcript-style-range-container")});return r.appendChild(o),r.appendChild(n),i.appendChild(a),i.appendChild(r),i}savePreferences(){this.storage.saveTranscriptPreferences(this.transcriptStyle)}applyTranscriptStyles(){if(!this.transcriptWindow)return;this.transcriptWindow.style.backgroundColor=this.transcriptStyle.backgroundColor,this.transcriptWindow.style.opacity=String(this.transcriptStyle.opacity),this.transcriptContent&&(this.transcriptContent.style.fontSize=this.transcriptStyle.fontSize,this.transcriptContent.style.fontFamily=this.transcriptStyle.fontFamily,this.transcriptContent.style.color=this.transcriptStyle.color),this.transcriptWindow.querySelectorAll(".".concat(this.player.options.classPrefix,"-transcript-text")).forEach(i=>{i.style.fontSize=this.transcriptStyle.fontSize,i.style.fontFamily=this.transcriptStyle.fontFamily,i.style.color=this.transcriptStyle.color}),this.transcriptWindow.querySelectorAll(".".concat(this.player.options.classPrefix,"-transcript-time")).forEach(i=>{i.style.fontFamily=this.transcriptStyle.fontFamily})}setManagedTimeout(e,t){let i=setTimeout(()=>{this.timeouts.delete(i),e()},t);return this.timeouts.add(i),i}clearManagedTimeout(e){e&&(clearTimeout(e),this.timeouts.delete(e))}destroy(){this.hideResizeModeIndicator(),this.draggableResizable&&(this.draggableResizable.pointerResizeMode&&(this.draggableResizable.disablePointerResizeMode(),this.updateResizeOptionState()),this.draggableResizable.destroy(),this.draggableResizable=null),this.transcriptWindow&&this.customKeyHandler&&(this.transcriptWindow.removeEventListener("keydown",this.customKeyHandler),this.customKeyHandler=null),this.handlers.timeupdate&&this.player.off("timeupdate",this.handlers.timeupdate),this.handlers.audiodescriptionenabled&&this.player.off("audiodescriptionenabled",this.handlers.audiodescriptionenabled),this.handlers.audiodescriptiondisabled&&this.player.off("audiodescriptiondisabled",this.handlers.audiodescriptiondisabled),this.settingsButton&&(this.handlers.settingsClick&&this.settingsButton.removeEventListener("click",this.handlers.settingsClick),this.handlers.settingsKeydown&&this.settingsButton.removeEventListener("keydown",this.handlers.settingsKeydown)),this.handlers.styleDialogKeydown&&document.removeEventListener("keydown",this.handlers.styleDialogKeydown),this.handlers.documentClick&&document.removeEventListener("click",this.handlers.documentClick),this.handlers.resize&&window.removeEventListener("resize",this.handlers.resize),this.timeouts.forEach(e=>clearTimeout(e)),this.timeouts.clear(),this.handlers=null,this.transcriptWindow&&this.transcriptWindow.parentNode&&this.transcriptWindow.parentNode.removeChild(this.transcriptWindow),this.transcriptWindow=null,this.transcriptHeader=null,this.transcriptContent=null,this.transcriptEntries=[],this.settingsMenu=null,this.styleDialog=null,this.transcriptResizeHandles=[],this.resizeOptionButton=null,this.resizeOptionText=null,this.liveRegion=null}announceLive(e){this.liveRegion&&(this.liveRegion.textContent=e||"")}}});var Xe={};H(Xe,{YouTubeRenderer:()=>Se});var Se,Ye=D(()=>{Se=class{constructor(e){this.player=e,this.youtube=null,this.videoId=null,this.isReady=!1,this.iframe=null}async init(){let e=this.player.currentSource||this.player.element.src;if(this.videoId=this.extractVideoId(e),!this.videoId)throw new Error("Invalid YouTube URL");await this.loadYouTubeAPI(),this.createIframe(),await this.initializePlayer()}extractVideoId(e){let t=[/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/,/youtube\.com\/embed\/([^&\s]+)/];for(let i of t){let s=e.match(i);if(s&&s[1])return s[1]}return null}async loadYouTubeAPI(){return window.YT&&window.YT.Player?Promise.resolve():new Promise((e,t)=>{if(window.onYouTubeIframeAPIReady){let a=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{a(),e()};return}let i=document.createElement("script");i.src="https://www.youtube.com/iframe_api",window.onYouTubeIframeAPIReady=()=>{e()},i.onerror=()=>t(new Error("Failed to load YouTube API"));let s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(i,s)})}createIframe(){this.player.element.style.display="none",this.iframe=document.createElement("div"),this.iframe.id="youtube-player-".concat(Math.random().toString(36).substr(2,9)),this.iframe.style.width="100%",this.iframe.style.maxHeight="100%",this.player.element.parentNode.insertBefore(this.iframe,this.player.element)}async initializePlayer(){return new Promise(e=>{this.youtube=new window.YT.Player(this.iframe.id,{videoId:this.videoId,width:"100%",height:"100%",playerVars:{controls:1,disablekb:0,fs:1,modestbranding:1,rel:0,showinfo:0,iv_load_policy:3,autoplay:this.player.options.autoplay?1:0,mute:this.player.options.muted?1:0,start:this.player.options.startTime||0},events:{onReady:t=>{this.isReady=!0,this.attachEvents(),this.player.container&&this.player.container.classList.add("vidply-external-controls"),e()},onStateChange:t=>this.handleStateChange(t),onError:t=>this.handleError(t)}})})}attachEvents(){this.timeUpdateInterval=setInterval(()=>{if(this.isReady&&this.youtube){let e=this.youtube.getCurrentTime(),t=this.youtube.getDuration();this.player.state.currentTime=e,this.player.state.duration=t,this.player.emit("timeupdate",e)}},250),this.youtube.getDuration&&(this.player.state.duration=this.youtube.getDuration(),this.player.emit("loadedmetadata"))}handleStateChange(e){let t=window.YT.PlayerState;switch(e.data){case t.PLAYING:this.player.state.playing=!0,this.player.state.paused=!1,this.player.state.ended=!1,this.player.state.buffering=!1,this.player.emit("play"),this.player.emit("playing"),this.player.options.onPlay&&this.player.options.onPlay.call(this.player);break;case t.PAUSED:this.player.state.playing=!1,this.player.state.paused=!0,this.player.emit("pause"),this.player.options.onPause&&this.player.options.onPause.call(this.player);break;case t.ENDED:this.player.state.playing=!1,this.player.state.paused=!0,this.player.state.ended=!0,this.player.emit("ended"),this.player.options.onEnded&&this.player.options.onEnded.call(this.player),this.player.options.loop&&(this.youtube.seekTo(0),this.youtube.playVideo());break;case t.BUFFERING:this.player.state.buffering=!0,this.player.emit("waiting");break;case t.CUED:this.player.emit("loadedmetadata");break}}handleError(e){let t={2:"Invalid video ID",5:"HTML5 player error",100:"Video not found",101:"Video not allowed to be played in embedded players",150:"Video not allowed to be played in embedded players"},i=new Error(t[e.data]||"YouTube player error");this.player.handleError(i)}play(){if(this.isReady&&this.youtube){let e=window.scrollX,t=window.scrollY;this.youtube.playVideo(),window.scrollTo(e,t)}}pause(){this.isReady&&this.youtube&&this.youtube.pauseVideo()}seek(e){this.isReady&&this.youtube&&this.youtube.seekTo(e,!0)}setVolume(e){this.isReady&&this.youtube&&(this.youtube.setVolume(e*100),this.player.state.volume=e)}setMuted(e){this.isReady&&this.youtube&&(e?this.youtube.mute():this.youtube.unMute(),this.player.state.muted=e)}setPlaybackSpeed(e){this.isReady&&this.youtube&&(this.youtube.setPlaybackRate(e),this.player.state.playbackSpeed=e)}destroy(){this.timeUpdateInterval&&clearInterval(this.timeUpdateInterval),this.youtube&&this.youtube.destroy&&this.youtube.destroy(),this.iframe&&this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),this.player.element&&(this.player.element.style.display="")}}});var Qe={};H(Qe,{VimeoRenderer:()=>Me});var Me,Ge=D(()=>{Me=class{constructor(e){this.player=e,this.vimeo=null,this.videoId=null,this.isReady=!1,this.iframe=null}async init(){let e=this.player.currentSource||this.player.element.src;if(this.videoId=this.extractVideoId(e),!this.videoId)throw new Error("Invalid Vimeo URL");await this.loadVimeoAPI(),this.createIframe(),await this.initializePlayer()}extractVideoId(e){let t=[/vimeo\.com\/(\d+)/,/vimeo\.com\/video\/(\d+)/,/player\.vimeo\.com\/video\/(\d+)/];for(let i of t){let s=e.match(i);if(s&&s[1])return s[1]}return null}async loadVimeoAPI(){return window.Vimeo&&window.Vimeo.Player?Promise.resolve():new Promise((e,t)=>{let i=document.createElement("script");i.src="https://player.vimeo.com/api/player.js",i.onload=()=>e(),i.onerror=()=>t(new Error("Failed to load Vimeo API")),document.head.appendChild(i)})}createIframe(){this.player.element.style.display="none",this.iframe=document.createElement("div"),this.iframe.id="vimeo-player-".concat(Math.random().toString(36).substr(2,9)),this.iframe.style.width="100%",this.iframe.style.maxHeight="100%",this.player.element.parentNode.insertBefore(this.iframe,this.player.element)}async initializePlayer(){let e={id:this.videoId,width:"100%",height:"100%",controls:!0,autoplay:this.player.options.autoplay,muted:this.player.options.muted,loop:this.player.options.loop,keyboard:!1};this.player.options.startTime>0&&(e.startTime=this.player.options.startTime),this.vimeo=new window.Vimeo.Player(this.iframe.id,e),await this.vimeo.ready(),this.isReady=!0;let t=this.iframe.querySelector("iframe");t&&(t.style.width="100%",t.style.height="100%",t.setAttribute("width","100%"),t.setAttribute("height","100%")),this.player.container&&this.player.container.classList.add("vidply-external-controls"),this.attachEvents();try{let i=await this.vimeo.getDuration();this.player.state.duration=i,this.player.emit("loadedmetadata")}catch(i){this.player.log("Error getting duration:",i,"warn")}}attachEvents(){this.vimeo.on("play",()=>{this.player.state.playing=!0,this.player.state.paused=!1,this.player.state.ended=!1,this.player.emit("play"),this.player.options.onPlay&&this.player.options.onPlay.call(this.player)}),this.vimeo.on("pause",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.emit("pause"),this.player.options.onPause&&this.player.options.onPause.call(this.player)}),this.vimeo.on("ended",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.state.ended=!0,this.player.emit("ended"),this.player.options.onEnded&&this.player.options.onEnded.call(this.player)}),this.vimeo.on("timeupdate",e=>{this.player.state.currentTime=e.seconds,this.player.state.duration=e.duration,this.player.emit("timeupdate",e.seconds),this.player.options.onTimeUpdate&&this.player.options.onTimeUpdate.call(this.player,e.seconds)}),this.vimeo.on("volumechange",e=>{this.player.state.volume=e.volume,this.player.emit("volumechange",e.volume)}),this.vimeo.on("bufferstart",()=>{this.player.state.buffering=!0,this.player.emit("waiting")}),this.vimeo.on("bufferend",()=>{this.player.state.buffering=!1,this.player.emit("canplay")}),this.vimeo.on("seeking",()=>{this.player.state.seeking=!0,this.player.emit("seeking")}),this.vimeo.on("seeked",()=>{this.player.state.seeking=!1,this.player.emit("seeked")}),this.vimeo.on("playbackratechange",e=>{this.player.state.playbackSpeed=e.playbackRate,this.player.emit("ratechange",e.playbackRate)}),this.vimeo.on("error",e=>{this.player.handleError(new Error("Vimeo error: ".concat(e.message)))})}play(){if(this.isReady&&this.vimeo){let e=window.scrollX,t=window.scrollY;this.vimeo.play().catch(i=>{this.player.log("Play error:",i,"warn")}),window.scrollTo(e,t)}}pause(){this.isReady&&this.vimeo&&this.vimeo.pause().catch(e=>{this.player.log("Pause error:",e,"warn")})}seek(e){this.isReady&&this.vimeo&&this.vimeo.setCurrentTime(e).catch(t=>{this.player.log("Seek error:",t,"warn")})}setVolume(e){this.isReady&&this.vimeo&&(this.vimeo.setVolume(e).catch(t=>{this.player.log("Volume error:",t,"warn")}),this.player.state.volume=e)}setMuted(e){this.isReady&&this.vimeo&&(e?this.vimeo.setVolume(0):this.vimeo.setVolume(this.player.state.volume),this.player.state.muted=e)}setPlaybackSpeed(e){this.isReady&&this.vimeo&&(this.vimeo.setPlaybackRate(e).catch(t=>{this.player.log("Playback rate error:",t,"warn")}),this.player.state.playbackSpeed=e)}destroy(){this.vimeo&&this.vimeo.destroy&&this.vimeo.destroy(),this.iframe&&this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),this.player.element&&(this.player.element.style.display="")}}});var Je={};H(Je,{HLSRenderer:()=>ke});var ke,Ze=D(()=>{ke=class{constructor(e){this.player=e,this.media=e.element,this.hls=null,this._hlsSourceLoaded=!1,this._pendingSrc=null}async init(){this.canPlayNatively()?(this.player.log("Using native HLS support"),await this.initNative()):(this.player.log("Using hls.js for HLS support"),await this.initHlsJs())}canPlayNatively(){let e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),t=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;return!e&&!t?!1:document.createElement("video").canPlayType("application/vnd.apple.mpegurl")!==""}async initNative(){let e=(await Promise.resolve().then(()=>(ve(),Ue))).HTML5Renderer,t=new e(this.player);await t.init(),Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(i=>{i!=="constructor"&&typeof t[i]=="function"&&(this[i]=t[i].bind(t))})}async initHlsJs(){if(this.media.controls=!1,this.media.removeAttribute("controls"),window.Hls||await this.loadHlsJs(),!window.Hls.isSupported())throw new Error("HLS is not supported in this browser");this.hls=new window.Hls({debug:this.player.options.debug,autoStartLoad:!this.player.options.deferLoad,enableWorker:!0,lowLatencyMode:!1,backBufferLength:90,maxBufferLength:30,maxMaxBufferLength:600,maxBufferSize:60*1e3*1e3,maxBufferHole:.5,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:4,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3}),this.hls.attachMedia(this.media);let e=this.player.currentSource;if(!e){let t=this.player.element.querySelector("source");t?e=t.getAttribute("src"):e=this.player.element.getAttribute("src")||this.player.element.src}if(this.player.log("Loading HLS source: ".concat(e),"log"),!e)throw new Error("No HLS source found");this.player.options.deferLoad?this._pendingSrc=e:(this.hls.loadSource(e),this._hlsSourceLoaded=!0),this.attachHlsEvents(),this.attachMediaEvents()}async loadHlsJs(){return new Promise((e,t)=>{let i=document.createElement("script");i.src="https://cdn.jsdelivr.net/npm/hls.js@latest",i.onload=()=>e(),i.onerror=()=>t(new Error("Failed to load hls.js")),document.head.appendChild(i)})}attachHlsEvents(){this.hls.on(window.Hls.Events.MANIFEST_PARSED,(e,t)=>{this.player.log("HLS manifest loaded, found "+t.levels.length+" quality levels"),this.player.emit("hlsmanifestparsed",t),this.player.container&&this.player.container.classList.remove("vidply-external-controls")}),this.hls.on(window.Hls.Events.LEVEL_SWITCHED,(e,t)=>{this.player.log("HLS level switched to "+t.level),this.player.emit("hlslevelswitched",t)}),this.hls.on(window.Hls.Events.ERROR,(e,t)=>{this.handleHlsError(t)}),this.hls.on(window.Hls.Events.FRAG_BUFFERED,()=>{this.player.state.buffering=!1})}attachMediaEvents(){this.media.addEventListener("loadedmetadata",()=>{this.player.state.duration=this.media.duration,this.player.emit("loadedmetadata")}),this.media.addEventListener("play",()=>{this.player.state.playing=!0,this.player.state.paused=!1,this.player.state.ended=!1,this.player.emit("play"),this.player.options.onPlay&&this.player.options.onPlay.call(this.player)}),this.media.addEventListener("pause",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.emit("pause"),this.player.options.onPause&&this.player.options.onPause.call(this.player)}),this.media.addEventListener("ended",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.state.ended=!0,this.player.emit("ended"),this.player.options.onEnded&&this.player.options.onEnded.call(this.player),this.player.options.loop&&(this.player.seek(0),this.player.play())}),this.media.addEventListener("timeupdate",()=>{this.player.state.currentTime=this.media.currentTime,this.player.emit("timeupdate",this.media.currentTime),this.player.options.onTimeUpdate&&this.player.options.onTimeUpdate.call(this.player,this.media.currentTime)}),this.media.addEventListener("volumechange",()=>{this.player.state.volume=this.media.volume,this.player.state.muted=this.media.muted,this.player.emit("volumechange",this.media.volume)}),this.media.addEventListener("waiting",()=>{this.player.state.buffering=!0,this.player.emit("waiting")}),this.media.addEventListener("canplay",()=>{this.player.state.buffering=!1,this.player.emit("canplay")}),this.media.addEventListener("error",()=>{this.player.handleError(this.media.error)})}handleHlsError(e){if(this.player.log("HLS Error - Type: ".concat(e.type,", Details: ").concat(e.details,", Fatal: ").concat(e.fatal),"warn"),e.response&&this.player.log("Response code: ".concat(e.response.code,", URL: ").concat(e.response.url),"warn"),e.fatal)switch(e.type){case window.Hls.ErrorTypes.NETWORK_ERROR:this.player.log("Fatal network error, trying to recover...","error"),this.player.log("Network error details: ".concat(e.details),"error"),setTimeout(()=>{this.hls.startLoad()},1e3);break;case window.Hls.ErrorTypes.MEDIA_ERROR:this.player.log("Fatal media error, trying to recover...","error"),this.hls.recoverMediaError();break;default:this.player.log("Fatal error, cannot recover","error"),this.player.handleError(new Error("HLS Error: ".concat(e.type," - ").concat(e.details))),this.hls.destroy();break}else this.player.log("Non-fatal HLS error: "+e.details,"warn")}ensureLoaded(){if(!this.player.options.deferLoad||!this.hls||this._hlsSourceLoaded)return;let e=this._pendingSrc||this.player._pendingSource||this.player.currentSource;if(e)try{this.hls.loadSource(e),this._hlsSourceLoaded=!0,this.hls.startLoad()}catch(t){}}play(){let e=window.scrollX,t=window.scrollY;if(this.player.options.deferLoad&&this.hls&&!this._hlsSourceLoaded){let s=this._pendingSrc||this.player.currentSource;if(s)try{this.hls.loadSource(s),this.hls.startLoad(),this._hlsSourceLoaded=!0}catch(a){}}let i=this.media.play();window.scrollTo(e,t),i!==void 0&&i.catch(s=>{this.player.log("Play failed:",s,"warn")})}pause(){this.media.pause()}seek(e){this.media.currentTime=e}setVolume(e){this.media.volume=e}setMuted(e){this.media.muted=e}setPlaybackSpeed(e){this.media.playbackRate=e}switchQuality(e){this.hls&&(this.hls.currentLevel=e)}getQualities(){return this.hls&&this.hls.levels?this.hls.levels.map((e,t)=>{let i=Number(e.height)||0,s=Number(e.bitrate)||0,a=s>0?Math.round(s/1e3):0,n=i>0?"".concat(i,"p"):a>0?"".concat(a," kb"):"Auto";return{index:t,height:e.height,width:e.width,bitrate:e.bitrate,name:n}}):[]}getCurrentQuality(){return this.hls?this.hls.currentLevel:-1}destroy(){this.hls&&(this.hls.destroy(),this.hls=null)}}});var et={};H(et,{SoundCloudRenderer:()=>ye,default:()=>pt});var ye,pt,tt=D(()=>{ye=class{constructor(e){this.player=e,this.widget=null,this.trackUrl=null,this.isReady=!1,this.iframe=null,this.iframeId=null}async init(){var e;if(this.trackUrl=this.player.currentSource||this.player.element.src||((e=this.player.element.querySelector("source"))==null?void 0:e.src),!this.trackUrl||!this.isValidSoundCloudUrl(this.trackUrl))throw new Error("Invalid SoundCloud URL");await this.loadSoundCloudAPI(),this.createIframe(),await this.initializeWidget()}isValidSoundCloudUrl(e){return e.includes("soundcloud.com")||e.includes("api.soundcloud.com")}isPlaylist(){return this.trackUrl&&this.trackUrl.includes("/sets/")}getEmbedUrl(){let e=encodeURIComponent(this.trackUrl),t=new URLSearchParams({url:this.trackUrl,auto_play:this.player.options.autoplay?"true":"false",hide_related:"true",show_comments:"false",show_user:"true",show_reposts:"false",show_teaser:"false",visual:"false",color:"%23007bff"});return"https://w.soundcloud.com/player/?".concat(t.toString())}async loadSoundCloudAPI(){return window.SC&&window.SC.Widget?Promise.resolve():new Promise((e,t)=>{let i=document.createElement("script");i.src="https://w.soundcloud.com/player/api.js",i.onload=()=>{setTimeout(()=>{window.SC&&window.SC.Widget?e():t(new Error("SoundCloud Widget API not available"))},100)},i.onerror=()=>t(new Error("Failed to load SoundCloud Widget API")),document.head.appendChild(i)})}createIframe(){this.player.element.style.display="none",this.player.element.removeAttribute("poster"),this.player.videoWrapper&&(this.player.videoWrapper.classList.remove("vidply-forced-poster"),this.player.videoWrapper.style.removeProperty("--vidply-poster-image")),this.iframeId="soundcloud-player-".concat(Math.random().toString(36).substr(2,9)),this.iframe=document.createElement("iframe"),this.iframe.id=this.iframeId,this.iframe.scrolling="no",this.iframe.frameBorder="no",this.iframe.allow="autoplay",this.iframe.src=this.getEmbedUrl(),this.iframe.style.width="100%",this.iframe.style.display="block",this.isPlaylist()?this.iframe.classList.add("vidply-soundcloud-iframe","vidply-soundcloud-playlist"):this.iframe.classList.add("vidply-soundcloud-iframe"),this.iframe.style.maxHeight="100%",this.player.element.parentNode.insertBefore(this.iframe,this.player.element)}async initializeWidget(){return new Promise((e,t)=>{this.iframe.addEventListener("load",()=>{try{this.widget=window.SC.Widget(this.iframe),this.widget.bind(window.SC.Widget.Events.READY,()=>{this.isReady=!0,this.attachEvents(),this.player.container&&this.player.container.classList.add("vidply-external-controls"),this.widget.getCurrentSound(i=>{i&&(this.player.state.duration=i.duration/1e3,this.player.emit("loadedmetadata"))}),e()}),this.widget.bind(window.SC.Widget.Events.ERROR,i=>{this.player.handleError(new Error("SoundCloud error: ".concat(i.message||"Unknown error")))})}catch(i){t(i)}}),setTimeout(()=>{this.isReady||t(new Error("SoundCloud widget initialization timeout"))},1e4)})}attachEvents(){if(!this.widget)return;let e=window.SC.Widget.Events;this.widget.bind(e.PLAY,()=>{this.player.state.playing=!0,this.player.state.paused=!1,this.player.state.ended=!1,this.player.emit("play"),this.player.options.onPlay&&this.player.options.onPlay.call(this.player)}),this.widget.bind(e.PAUSE,()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.emit("pause"),this.player.options.onPause&&this.player.options.onPause.call(this.player)}),this.widget.bind(e.FINISH,()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.state.ended=!0,this.player.emit("ended"),this.player.options.onEnded&&this.player.options.onEnded.call(this.player),this.player.options.loop&&(this.seek(0),this.play())}),this.widget.bind(e.PLAY_PROGRESS,t=>{let i=t.currentPosition/1e3;this.player.state.currentTime=i,this.player.emit("timeupdate",i),this.player.options.onTimeUpdate&&this.player.options.onTimeUpdate.call(this.player,i)}),this.widget.bind(e.SEEK,t=>{this.player.state.currentTime=t.currentPosition/1e3,this.player.emit("seeked")}),this.widget.bind(e.LOAD_PROGRESS,t=>{if(this.player.state.duration){let i=t.loadedProgress*this.player.state.duration;this.player.emit("progress",i)}})}play(){if(this.isReady&&this.widget){let e=window.scrollX,t=window.scrollY;this.widget.play(),window.scrollTo(e,t)}}pause(){this.isReady&&this.widget&&this.widget.pause()}seek(e){this.isReady&&this.widget&&(this.widget.seekTo(e*1e3),this.player.state.currentTime=e)}setVolume(e){this.isReady&&this.widget&&(this.widget.setVolume(e*100),this.player.state.volume=e)}setMuted(e){this.isReady&&this.widget&&(e?this.widget.getVolume(t=>{this._previousVolume=t,this.widget.setVolume(0)}):this.widget.setVolume(this._previousVolume||100),this.player.state.muted=e)}setPlaybackSpeed(e){this.player.log("SoundCloud does not support playback speed control","warn")}getCurrentSound(){return new Promise(e=>{this.isReady&&this.widget?this.widget.getCurrentSound(t=>{e(t)}):e(null)})}destroy(){if(this.widget){let e=window.SC.Widget.Events;try{this.widget.unbind(e.READY),this.widget.unbind(e.PLAY),this.widget.unbind(e.PAUSE),this.widget.unbind(e.FINISH),this.widget.unbind(e.PLAY_PROGRESS),this.widget.unbind(e.SEEK),this.widget.unbind(e.LOAD_PROGRESS),this.widget.unbind(e.ERROR)}catch(t){}}this.iframe&&this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),this.player.element&&(this.player.element.style.display=""),this.widget=null,this.isReady=!1}},pt=ye});var se=class{constructor(){this.events={}}on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),this}once(e,t){let i=(...s)=>{t(...s),this.off(e,i)};return this.on(e,i)}off(e,t){return this.events[e]?(t?this.events[e]=this.events[e].filter(i=>i!==t):delete this.events[e],this):this}emit(e,...t){return this.events[e]?(this.events[e].forEach(i=>{i(...t)}),this):this}removeAllListeners(){return this.events={},this}};F();F();ae();q();O();ne();function re(u,e=100){let t;return function(...s){let a=()=>{clearTimeout(t),u(...s)};clearTimeout(t),t=setTimeout(a,e)}}function X(u=768){return window.innerWidth<u}function Y(u,e=100){let t=!1,i=()=>{t||(t=!0,u())};requestAnimationFrame(i),setTimeout(i,e)}async function oe(u,e,t={}){if(!u||u.tagName!=="VIDEO")return null;let{restoreState:i=!0,quality:s=.9,maxWidth:a,maxHeight:n}=t,o=!u.paused,r=u.currentTime,c=u.muted;return i&&(u.muted=!0),new Promise(l=>{let d=()=>{try{let y=u.videoWidth||640,b=u.videoHeight||360;if(a&&y>a){let w=a/y;y=a,b=Math.round(b*w)}if(n&&b>n){let w=n/b;b=n,y=Math.round(y*w)}let v=document.createElement("canvas");v.width=y,v.height=b,v.getContext("2d").drawImage(u,0,0,y,b);let L=v.toDataURL("image/jpeg",s);i&&(u.currentTime=r,u.muted=c,o&&!u.paused&&u.play().catch(()=>{})),l(L)}catch(y){i&&(u.currentTime=r,u.muted=c,o&&!u.paused&&u.play().catch(()=>{})),l(null)}},h=()=>{u.removeEventListener("seeked",h),requestAnimationFrame(()=>{requestAnimationFrame(d)})};if(Math.abs(u.currentTime-e)<.1&&u.readyState>=2)d();else if(u.readyState>=1)u.addEventListener("seeked",h),u.currentTime=e;else{let y=()=>{u.removeEventListener("loadedmetadata",y),u.addEventListener("seeked",h),u.currentTime=e};u.addEventListener("loadedmetadata",y)}})}var le=class{constructor(e){this.player=e,this.element=null,this.controls={},this.hideTimeout=null,this.isDraggingProgress=!1,this.isDraggingVolume=!1,this.openMenu=null,this.openMenuButton=null,this.init()}init(){this.createElement(),this.createControls(),this.updateDuration(),this.updateProgress(),this.attachEvents(),this.setupAutoHide(),this.setupOverflowDetection()}isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}positionMenu(e,t,i=!1){let s=X(),a=e.classList.contains("".concat(this.player.options.classPrefix,"-overflow-menu-list"));if(this.player.state.fullscreen&&e.parentElement===this.player.container){let r=()=>{let c=t.getBoundingClientRect(),l=e.getBoundingClientRect(),d=this.player.container.getBoundingClientRect(),h=window.innerHeight,p=c.left+c.width/2-d.left,y=c.top-d.top,b=c.bottom-d.top,v=c.top-d.top,f=d.bottom-c.bottom;if(v>=l.height+20||v>f?(e.style.bottom="".concat(d.height-y+8,"px"),e.style.top="auto",e.classList.remove("vidply-menu-below")):(e.style.top="".concat(b+8,"px"),e.style.bottom="auto",e.classList.add("vidply-menu-below")),a){let L=c.right-d.left;e.style.right="".concat(d.width-L,"px"),e.style.left="auto",e.style.transform="none"}else e.style.left="".concat(p,"px"),e.style.right="auto",e.style.transform="translateX(-50%)"};i?r():requestAnimationFrame(r);return}if(s){let r=e.classList.contains("".concat(this.player.options.classPrefix,"-volume-menu")),c=()=>{let l=t.parentElement;if(!l)return;let d=t.getBoundingClientRect(),h=l.getBoundingClientRect(),p=e.getBoundingClientRect(),y=window.innerWidth,b=window.innerHeight;if(r){let v=d.left+d.width/2-h.left;e.style.left="".concat(v,"px"),e.style.right="auto",e.style.transform="translateX(-50%)";return}p.right>y&&(e.style.left="auto",e.style.right="10px",e.style.transform="none"),p.left<0&&(e.style.left="10px",e.style.right="auto",e.style.transform="none"),p.top<10&&(e.style.top="10px",e.style.bottom="auto"),p.bottom>b-10&&(e.style.bottom="10px",e.style.top="auto")};i?c():requestAnimationFrame(c);return}let o=()=>{let r=t.getBoundingClientRect(),c=e.getBoundingClientRect(),l=window.innerWidth,d=window.innerHeight,h=t.parentElement;if(!h)return;let p=h.getBoundingClientRect(),y=r.left+r.width/2-p.left,b=r.bottom-p.top,v=r.top-p.top,f=r.top,L=d-r.bottom,w=v-c.height-8,S=null;f<c.height+20&&L>f?(w=null,S=p.bottom-p.top-b+8,e.classList.add("vidply-menu-below")):e.classList.remove("vidply-menu-below");let P="auto",M="auto",E="translateX(0)";if(a)P="auto",M=0,E="translateX(0)";else{P=y-c.width/2;let C=r.left+r.width/2-c.width/2;C<10?(P=0,E="translateX(0)"):C+c.width>l-10?(P="auto",M=0,E="translateX(0)"):(P=y,E="translateX(-50%)")}w!==null?(e.style.top="".concat(w,"px"),e.style.bottom="auto"):S!==null&&(e.style.top="auto",e.style.bottom="".concat(S,"px")),P!=="auto"?(e.style.left="".concat(P,"px"),e.style.right="auto"):(e.style.left="auto",e.style.right="".concat(M,"px")),e.style.transform=E};i?o():requestAnimationFrame(()=>{setTimeout(o,10)})}insertMenuIntoDOM(e,t){e.id||(e.id="vidply-menu-".concat(Math.random().toString(36).substr(2,9))),t.setAttribute("aria-controls",e.id),t.setAttribute("aria-haspopup","true"),this.player.state.fullscreen?(this.player.container.appendChild(e),e.dataset.triggerButton=t.getAttribute("aria-label")||"button"):t.insertAdjacentElement("afterend",e)}attachMenuCloseHandler(e,t,i=!1){this.openMenu&&this.openMenu!==e&&this.openMenuButton&&(this.openMenuButton._vidplyBlurHandler&&(this.openMenuButton.removeEventListener("blur",this.openMenuButton._vidplyBlurHandler),delete this.openMenuButton._vidplyBlurHandler),this.openMenuButton._vidplyMousedownHandler&&(this.openMenuButton.removeEventListener("mousedown",this.openMenuButton._vidplyMousedownHandler),delete this.openMenuButton._vidplyMousedownHandler),this.openMenu&&document.contains(this.openMenu)?this.openMenu.remove():this.openMenu&&this.openMenu.parentNode&&this.openMenu.parentNode.removeChild(this.openMenu),this.openMenuButton&&this.openMenuButton.setAttribute("aria-expanded","false")),this.openMenu=e,this.openMenuButton=t,this.positionMenu(e,t),t&&t.setAttribute("aria-expanded","true");let s=!1,a=!0,n=()=>{s=!0,a=!1,setTimeout(()=>{s=!1,a=!0},200)};t.addEventListener("mousedown",n),t._vidplyMousedownHandler=n;let o=d=>{if(!a||s||this.openMenu!==e)return;let h=d.relatedTarget;requestAnimationFrame(()=>{setTimeout(()=>{var w;if(!a||this.openMenu!==e)return;let p=document.activeElement;if(e.contains(p))return;let y=this.player.signLanguageWrapper,b=(w=this.player.transcriptManager)==null?void 0:w.transcriptWindow;if(y&&y.contains(p)||b&&b.contains(p))return;let v=this.element.querySelectorAll("button"),f=Array.from(v).includes(p)&&p!==t,L=h&&Array.from(v).includes(h)&&h!==t;if(f||L){if(this.openMenu!==e)return;e&&document.contains(e)?e.remove():e&&e.parentNode&&e.parentNode.removeChild(e),t&&t.setAttribute("aria-expanded","false"),this.openMenu===e&&(this.openMenu=null,this.openMenuButton=null),t.removeEventListener("blur",o),t.removeEventListener("mousedown",n),delete t._vidplyBlurHandler,delete t._vidplyMousedownHandler}},10)})};t.addEventListener("blur",o),t._vidplyBlurHandler=o;let r=()=>{this.closeMenuAndReturnFocus(e,t)},c=null,l=null;setTimeout(()=>{c=d=>{i&&e.contains(d.target)||this.openMenu===e&&!e.contains(d.target)&&!t.contains(d.target)&&(r(),c&&document.removeEventListener("click",c),l&&document.removeEventListener("keydown",l))},l=d=>{d.key==="Escape"&&this.openMenu===e&&(d.preventDefault(),d.stopPropagation(),this.closeMenuAndReturnFocus(e,t,!0),c&&document.removeEventListener("click",c),l&&document.removeEventListener("keydown",l))},document.addEventListener("click",c),document.addEventListener("keydown",l)},100)}closeMenuAndReturnFocus(e,t,i=!0){e&&(document.contains(e)?e.remove():e.parentNode&&e.parentNode.removeChild(e)),t&&(t.setAttribute("aria-expanded","false"),e&&e.id&&t.removeAttribute("aria-controls"),i&&requestAnimationFrame(()=>{setTimeout(()=>{t&&document.contains(t)&&t.focus({preventScroll:!0})},0)})),this.openMenu===e&&(this.openMenu=null,this.openMenuButton=null)}closeOpenMenu(){this.openMenu&&this.openMenuButton&&(this.openMenu&&document.contains(this.openMenu)?this.openMenu.remove():this.openMenu&&this.openMenu.parentNode&&this.openMenu.parentNode.removeChild(this.openMenu),this.openMenuButton&&this.openMenuButton.setAttribute("aria-expanded","false"),this.openMenu=null,this.openMenuButton=null)}attachMenuKeyboardNavigation(e,t){let i=Array.from(e.querySelectorAll(".".concat(this.player.options.classPrefix,"-menu-item")));if(i.length===0)return;let s=a=>{let n=i.indexOf(document.activeElement);switch(a.key){case"ArrowDown":a.preventDefault(),a.stopPropagation();let o=(n+1)%i.length;i[o].focus({preventScroll:!1}),i[o].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"ArrowUp":a.preventDefault(),a.stopPropagation();let r=(n-1+i.length)%i.length;i[r].focus({preventScroll:!1}),i[r].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"ArrowLeft":case"ArrowRight":a.preventDefault(),a.stopPropagation();break;case"Home":a.preventDefault(),a.stopPropagation(),i[0].focus({preventScroll:!1}),i[0].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"End":a.preventDefault(),a.stopPropagation(),i[i.length-1].focus({preventScroll:!1}),i[i.length-1].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"Enter":case" ":a.preventDefault(),a.stopPropagation(),document.activeElement&&i.includes(document.activeElement)&&(document.activeElement.click(),N(t,{delay:0}));break;case"Escape":a.preventDefault(),a.stopPropagation(),this.closeMenuAndReturnFocus(e,t,!0);break}};e.addEventListener("keydown",s)}createElement(){this.element=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-controls"),attributes:{role:"region","aria-label":m.t("player.label")+" controls"}})}createControls(){var v,f,L,w,S,P,M,E,C,x,R,B,K;let e=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-progress-time-wrapper")});this.player.options.progressBar&&(this.createProgressBar(),e.appendChild(this.controls.progress)),(this.player.options.currentTime||this.player.options.duration)&&e.appendChild(this.createTimeDisplay()),this.element.appendChild(e);let t=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-controls-buttons")}),i=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-controls-left")});this.player.playlistManager&&i.appendChild(this.createPreviousButton()),this.player.options.playPauseButton&&i.appendChild(this.createPlayPauseButton()),i.appendChild(this.createRestartButton()),this.player.playlistManager&&i.appendChild(this.createNextButton()),this.player.playlistManager||i.appendChild(this.createRewindButton()),this.player.playlistManager||i.appendChild(this.createForwardButton()),this.player.options.volumeControl&&(this.isTouchDevice()?i.appendChild(this.createMuteButton()):i.appendChild(this.createVolumeControl())),this.rightButtons=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-controls-right")});let s=this.hasChapterTracks(),a=this.hasCaptionTracks(),n=this.hasQualityLevels(),o=this.hasAudioDescription();if(this.player.options.chaptersButton&&s){let k=this.createChaptersButton();k.dataset.overflowPriority="3",k.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(k)}if(this.player.options.captionsButton&&a){let k=this.createCaptionsButton();k.dataset.overflowPriority="1",k.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(k)}if(this.player.options.captionStyleButton&&a){let k=this.createCaptionStyleButton();k.dataset.overflowPriority="3",k.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(k)}let r=this.player.currentSource||((f=(v=this.player.element)==null?void 0:v.getAttribute)==null?void 0:f.call(v,"src"))||((L=this.player.element)==null?void 0:L.currentSrc)||((w=this.player.element)==null?void 0:w.src)||((E=(M=(P=(S=this.player.element)==null?void 0:S.querySelector)==null?void 0:P.call(S,"source"))==null?void 0:M.getAttribute)==null?void 0:E.call(M,"src"))||((R=(x=(C=this.player.element)==null?void 0:C.querySelector)==null?void 0:x.call(C,"source"))==null?void 0:R.src)||"",c=typeof r=="string"&&r.includes(".m3u8"),l=((K=(B=this.player.element)==null?void 0:B.tagName)==null?void 0:K.toLowerCase())==="video",d=!!this.player.options.hideSpeedForHls&&c||!!this.player.options.hideSpeedForHlsVideo&&c&&l;if(this.player.options.speedButton&&!d){let k=this.createSpeedButton();k.dataset.overflowPriority="1",k.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(k)}if(this.player.options.audioDescriptionButton&&o){let k=this.createAudioDescriptionButton();k.dataset.overflowPriority="2",k.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(k)}if(this.player.options.transcriptButton&&a){let k=this.createTranscriptButton();k.dataset.overflowPriority="3",k.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(k)}if(this.player.playlistManager&&this.player.options.playlistToggleButton!==!1){let k=this.createPlaylistToggleButton();k.dataset.overflowPriority="2",k.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(k)}let h=this.hasSignLanguage(),p=this.player.options.signLanguageButton!==!1&&h,y=this.player.options.signLanguageDisplayMode||"both";if(p){if(["pip","both"].includes(y)){let k=this.createSignLanguageButton();k.dataset.overflowPriority="3",k.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(k)}if(["main","both"].includes(y)){let k=this.createSignLanguageInMainViewButton();k.dataset.overflowPriority="3",k.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(k)}}if(this.player.options.qualityButton&&n){let k=this.createQualityButton();k.dataset.overflowPriority="2",k.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(k)}if(this.player.options.pipButton&&"pictureInPictureEnabled"in document){let k=this.createPipButton();k.dataset.overflowPriority="3",k.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(k)}let b=this.player.element.tagName.toLowerCase()==="audio";if(this.player.options.fullscreenButton&&!b){let k=this.createFullscreenButton();k.dataset.overflowPriority="1",k.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(k)}this.overflowMenuButton=this.createOverflowMenuButton(),this.overflowMenuButton.style.display="none",this.rightButtons.appendChild(this.overflowMenuButton),t.appendChild(i),t.appendChild(this.rightButtons),this.element.appendChild(t),this.ensureButtonTooltips(t)}ensureButtonTooltips(e){e.querySelectorAll("button").forEach(i=>{if(i.querySelector(".".concat(this.player.options.classPrefix,"-tooltip"))||i.querySelector(".".concat(this.player.options.classPrefix,"-button-text"))||i.getAttribute("role")==="menuitem"||i.classList.contains("".concat(this.player.options.classPrefix,"-settings-item"))||i.classList.contains("".concat(this.player.options.classPrefix,"-menu-item"))||i.classList.contains("".concat(this.player.options.classPrefix,"-transcript-settings-item"))||i.classList.contains("".concat(this.player.options.classPrefix,"-sign-language-settings-item"))||i.classList.contains("".concat(this.player.options.classPrefix,"-popup-settings-item")))return;let s=i.getAttribute("aria-label");s&&g.attachTooltip(i,s,this.player.options.classPrefix)})}hasChapterTracks(){var s,a;let e=this.player.element.textTracks;for(let n=0;n<e.length;n++)if(e[n].kind==="chapters")return!0;if(Array.from(this.player.element.querySelectorAll('track[kind="chapters"]')).length>0)return!0;let i=(a=(s=this.player.playlistManager)==null?void 0:s.getCurrentTrack)==null?void 0:a.call(s);return i!=null&&i.tracks&&Array.isArray(i.tracks)?i.tracks.some(n=>(n==null?void 0:n.kind)==="chapters"):!1}hasCaptionTracks(){var s,a;let e=this.player.element.textTracks;for(let n=0;n<e.length;n++)if(e[n].kind==="captions"||e[n].kind==="subtitles")return!0;if(Array.from(this.player.element.querySelectorAll("track")).some(n=>n.getAttribute("kind")==="captions"||n.getAttribute("kind")==="subtitles"))return!0;let i=(a=(s=this.player.playlistManager)==null?void 0:s.getCurrentTrack)==null?void 0:a.call(s);return i!=null&&i.tracks&&Array.isArray(i.tracks)?i.tracks.some(n=>(n==null?void 0:n.kind)==="captions"||(n==null?void 0:n.kind)==="subtitles"):!1}hasQualityLevels(){if(this.player.renderer&&this.player.renderer.getQualities){let e=this.player.renderer.getQualities();return e&&e.length>1}return!1}hasAudioDescription(){return this.player.audioDescriptionSrc&&this.player.audioDescriptionSrc.length>0?!0:Array.from(this.player.element.textTracks||[]).some(t=>t.kind==="descriptions")}hasSignLanguage(){let e=this.player.signLanguageSrc&&this.player.signLanguageSrc.length>0,t=this.player.signLanguageSources&&Object.keys(this.player.signLanguageSources).length>0;return e||t}createProgressBar(){let e=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-progress-container"),attributes:{role:"slider","aria-label":m.t("player.progress"),"aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":"0",tabindex:"0"}});this.controls.buffered=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-progress-buffered")}),this.controls.played=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-progress-played")}),this.controls.progressHandle=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-progress-handle")}),this.controls.progressTooltip=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-progress-tooltip")}),this.controls.progressPreview=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-progress-preview"),attributes:{"aria-hidden":"true"}}),this.controls.progressTooltip.appendChild(this.controls.progressPreview),this.controls.progressTooltipTime=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-progress-tooltip-time")}),this.controls.progressTooltip.appendChild(this.controls.progressTooltipTime),e.appendChild(this.controls.buffered),e.appendChild(this.controls.played),this.controls.played.appendChild(this.controls.progressHandle),e.appendChild(this.controls.progressTooltip),this.controls.progress=e,this.initPreviewThumbnail(),this.setupProgressBarEvents()}initPreviewThumbnail(){this.previewThumbnailCache=new Map,this.previewVideo=null,this.currentPreviewTime=null,this.previewThumbnailTimeout=null,this.previewSupported=!1,this.previewVideoReady=!1,this.previewVideoInitialized=!1,this.player.element&&this.player.element.tagName}ensurePreviewVideoInitialized(){var n,o;if(this.previewVideoInitialized||!((o=(n=this.player)==null?void 0:n.state)!=null&&o.hasStartedPlayback))return;let e=this.player.renderer,t=e&&e.media&&e.media.tagName==="VIDEO",i=t&&e.media===this.player.element&&!e.hls&&typeof e.seek=="function";if(this.previewSupported=i&&t,!this.previewSupported)return;let s=e.media||this.player.element,a=null;if(s.src)a=s.src;else{let r=s.querySelector("source");r&&(a=r.src)}if(!a){this.player.log("No video source found for preview","warn"),this.previewSupported=!1;return}this.previewVideo=document.createElement("video"),this.previewVideo.muted=!0,this.previewVideo.preload="auto",this.previewVideo.playsInline=!0,this.previewVideo.style.position="absolute",this.previewVideo.style.visibility="hidden",this.previewVideo.style.width="1px",this.previewVideo.style.height="1px",this.previewVideo.style.top="-9999px",s.crossOrigin&&(this.previewVideo.crossOrigin=s.crossOrigin),this.previewVideo.addEventListener("error",r=>{this.player.log("Preview video failed to load:",r,"warn"),this.previewSupported=!1}),this.previewVideo.addEventListener("loadedmetadata",()=>{this.previewVideoReady=!0},{once:!0}),this.player.container&&this.player.container.appendChild(this.previewVideo),this.previewVideo.src=a,this.previewVideoReady=!1,this.previewVideoInitialized=!0}async generatePreviewThumbnail(e){if(!this.previewSupported||!this.previewVideo)return null;this.previewVideoReady||(this.previewVideo.readyState<2?await new Promise((s,a)=>{let n=setTimeout(()=>{a(new Error("Preview video data load timeout"))},1e4),o=()=>{clearTimeout(n),this.previewVideo.removeEventListener("loadeddata",r),this.previewVideo.removeEventListener("canplay",r),this.previewVideo.removeEventListener("error",c)},r=()=>{this.previewVideo.readyState>=2&&(o(),this.previewVideoReady=!0,s())},c=()=>{o(),a(new Error("Preview video failed to load"))};this.previewVideo.readyState>=1&&this.previewVideo.addEventListener("loadeddata",r),this.previewVideo.addEventListener("canplay",r),this.previewVideo.addEventListener("error",c),this.previewVideo.readyState>=2&&r()}).catch(()=>(this.previewSupported=!1,null)):this.previewVideoReady=!0);let t=Math.floor(e);if(this.previewThumbnailCache.has(t))return this.previewThumbnailCache.get(t);let i=await oe(this.previewVideo,e,{restoreState:!1,quality:.8,maxWidth:160,maxHeight:90});if(i){if(this.previewThumbnailCache.size>=20){let s=this.previewThumbnailCache.keys().next().value;this.previewThumbnailCache.delete(s)}this.previewThumbnailCache.set(t,i)}return i}async updatePreviewThumbnail(e){!this.previewSupported||!this.controls.progressPreview||(this.previewThumbnailTimeout&&clearTimeout(this.previewThumbnailTimeout),this.previewThumbnailTimeout=setTimeout(async()=>{try{let t=await this.generatePreviewThumbnail(e);t&&this.controls.progressPreview?(this.controls.progressPreview.style.backgroundImage='url("'.concat(t,'")'),this.controls.progressPreview.style.display="block",this.controls.progressPreview.style.backgroundRepeat="no-repeat",this.controls.progressPreview.style.backgroundPosition="center"):this.controls.progressPreview&&(this.controls.progressPreview.style.display="none"),this.currentPreviewTime=e}catch(t){this.player.log("Preview thumbnail update failed:",t,"warn"),this.controls.progressPreview&&(this.controls.progressPreview.style.display="none")}},100))}setupProgressBarEvents(){let e=this.controls.progress,t=i=>{let s=e.getBoundingClientRect(),a=s.width>0?Math.max(0,Math.min(1,(i-s.left)/s.width)):0,n=this.player.state.duration||0,o=a*n;return{percent:a,time:o}};e.addEventListener("mousedown",i=>{this.isDraggingProgress=!0;let{time:s}=t(i.clientX);this.player.seek(s)}),document.addEventListener("mousemove",i=>{if(this.isDraggingProgress){let{time:s}=t(i.clientX);this.player.seek(s)}}),document.addEventListener("mouseup",()=>{this.isDraggingProgress=!1}),e.addEventListener("mousemove",i=>{var s,a;if(!this.isDraggingProgress){let{time:n}=t(i.clientX),o=e.getBoundingClientRect(),r=i.clientX-o.left;if(this.controls.progressTooltipTime.textContent=A.formatTime(n),this.controls.progressTooltip.style.left="".concat(r,"px"),this.controls.progressTooltip.style.display="block",!((a=(s=this.player)==null?void 0:s.state)!=null&&a.hasStartedPlayback)){this.controls.progressPreview&&(this.controls.progressPreview.style.display="none");return}this.ensurePreviewVideoInitialized(),this.previewSupported?this.updatePreviewThumbnail(n):this.controls.progressPreview&&(this.controls.progressPreview.style.display="none")}}),e.addEventListener("mouseleave",()=>{this.controls.progressTooltip.style.display="none",this.previewThumbnailTimeout&&clearTimeout(this.previewThumbnailTimeout)}),e.addEventListener("keydown",i=>{i.key==="ArrowLeft"?(i.preventDefault(),this.player.seekBackward(5)):i.key==="ArrowRight"&&(i.preventDefault(),this.player.seekForward(5))}),e.addEventListener("touchstart",i=>{this.isDraggingProgress=!0;let s=i.touches[0],{time:a}=t(s.clientX);this.player.seek(a)}),e.addEventListener("touchmove",i=>{if(this.isDraggingProgress){i.preventDefault();let s=i.touches[0],{time:a}=t(s.clientX);this.player.seek(a)}}),e.addEventListener("touchend",()=>{this.isDraggingProgress=!1})}createPlayPauseButton(){let e=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-play-pause"),attributes:{type:"button","aria-label":m.t("player.play")}});return e.appendChild(T("play")),e.addEventListener("click",()=>{this.player.toggle()}),this.controls.playPause=e,e}createRestartButton(){let e=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-restart"),attributes:{type:"button","aria-label":m.t("player.restart")}});return e.appendChild(T("restart")),e.addEventListener("click",()=>{this.player.seek(0),this.player.play()}),e}createPreviousButton(){let e=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-previous"),attributes:{type:"button","aria-label":m.t("player.previous")}});e.appendChild(T("skipPrevious")),e.addEventListener("click",()=>{this.player.playlistManager&&this.player.playlistManager.previous()});let t=()=>{this.player.playlistManager&&(e.disabled=!this.player.playlistManager.hasPrevious()&&!this.player.playlistManager.options.loop)};return this.player.on("playlisttrackchange",t),t(),this.controls.previous=e,e}createNextButton(){let e=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-next"),attributes:{type:"button","aria-label":m.t("player.next")}});e.appendChild(T("skipNext")),e.addEventListener("click",()=>{this.player.playlistManager&&this.player.playlistManager.next()});let t=()=>{this.player.playlistManager&&(e.disabled=!this.player.playlistManager.hasNext()&&!this.player.playlistManager.options.loop)};return this.player.on("playlisttrackchange",t),t(),this.controls.next=e,e}createPlaylistToggleButton(){let e=this.player.playlistManager?"".concat(this.player.playlistManager.uniqueId,"-panel"):"vidply-playlist-panel",t=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-playlist-toggle"),attributes:{type:"button","aria-label":m.t("player.playlist"),"aria-expanded":"false","aria-pressed":"false","aria-controls":e}});return t.appendChild(T("playlist")),t.addEventListener("click",()=>{this.player.playlistManager&&this.player.playlistManager.togglePanel()}),this.controls.playlistToggle=t,t}createRewindButton(){let e=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-rewind"),attributes:{type:"button","aria-label":m.t("player.rewindSeconds",{seconds:15})}});return e.appendChild(T("rewind")),e.addEventListener("click",()=>{this.player.seekBackward(15)}),e}createForwardButton(){let e=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-forward"),attributes:{type:"button","aria-label":m.t("player.forwardSeconds",{seconds:15})}});return e.appendChild(T("forward")),e.addEventListener("click",()=>{this.player.seekForward(15)}),e}createMuteButton(){let e=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-mute"),attributes:{type:"button","aria-label":m.t("player.mute")}});return e.appendChild(T("volumeHigh")),e.addEventListener("click",()=>{this.player.toggleMute()}),this.controls.mute=e,e}createVolumeControl(){let e=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-mute"),attributes:{type:"button","aria-label":m.t("player.volume"),"aria-expanded":"false"}});return e.appendChild(T("volumeHigh")),e.addEventListener("contextmenu",t=>{t.preventDefault(),this.player.toggleMute()}),e.addEventListener("click",()=>{this.showVolumeSlider(e)}),this.controls.mute=e,e}showVolumeSlider(e){let t=document.querySelector(".".concat(this.player.options.classPrefix,"-volume-menu"));if(t){t.remove(),e.setAttribute("aria-expanded","false");return}let i=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-volume-menu ").concat(this.player.options.classPrefix,"-menu")}),s=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-volume-slider"),attributes:{role:"slider","aria-label":m.t("player.volume"),"aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":String(Math.round(this.player.state.volume*100)),tabindex:"0"}}),a=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-volume-track")}),n=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-volume-fill")}),o=this.player.state.volume*100;n.style.height="".concat(o,"%");let r=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-volume-handle")});a.appendChild(n),n.appendChild(r),s.appendChild(a),i.appendChild(s);let c=l=>{let d=a.getBoundingClientRect(),h=Math.max(0,Math.min(1,1-(l-d.top)/d.height));this.player.setVolume(h)};s.addEventListener("mousedown",l=>{l.stopPropagation(),l.preventDefault(),this.isDraggingVolume=!0,c(l.clientY)}),document.addEventListener("mousemove",l=>{this.isDraggingVolume&&c(l.clientY)}),document.addEventListener("mouseup",()=>{this.isDraggingVolume=!1}),s.addEventListener("touchstart",l=>{l.stopPropagation(),l.preventDefault(),this.isDraggingVolume=!0;let d=l.touches[0];c(d.clientY)},{passive:!1}),s.addEventListener("touchmove",l=>{if(this.isDraggingVolume){l.preventDefault();let d=l.touches[0];c(d.clientY)}},{passive:!1}),s.addEventListener("touchend",l=>{l.stopPropagation(),l.preventDefault(),this.isDraggingVolume=!1},{passive:!1}),s.addEventListener("touchcancel",()=>{this.isDraggingVolume=!1}),s.addEventListener("keydown",l=>{l.key==="ArrowUp"?(l.preventDefault(),this.player.setVolume(Math.min(1,this.player.state.volume+.1))):l.key==="ArrowDown"?(l.preventDefault(),this.player.setVolume(Math.max(0,this.player.state.volume-.1))):l.key==="Escape"&&(l.preventDefault(),l.stopPropagation(),this.closeMenuAndReturnFocus(i,e,!0))}),i.addEventListener("click",l=>{l.stopPropagation()}),i.addEventListener("touchstart",l=>{l.stopPropagation()}),i.addEventListener("touchmove",l=>{l.stopPropagation()}),i.addEventListener("touchend",l=>{l.stopPropagation()}),i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.controls.volumeSlider=s,this.controls.volumeFill=n,N(s,{delay:50}),this.attachMenuCloseHandler(i,e,!0)}createTimeDisplay(){let e=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-time"),attributes:{role:"group","aria-label":m.t("time.display")}});this.controls.currentTimeDisplay=g.createElement("span",{className:"".concat(this.player.options.classPrefix,"-current-time")});let t=g.createElement("span",{textContent:"00:00",attributes:{"aria-hidden":"true"}}),i=g.createElement("span",{className:"vidply-sr-only",textContent:m.t("time.seconds",{count:0})});this.controls.currentTimeDisplay.appendChild(t),this.controls.currentTimeDisplay.appendChild(i),this.controls.currentTimeVisual=t,this.controls.currentTimeAccessible=i;let s=g.createElement("span",{textContent:" / ",attributes:{"aria-hidden":"true"}});this.controls.durationDisplay=g.createElement("span",{className:"".concat(this.player.options.classPrefix,"-duration")});let a=g.createElement("span",{textContent:"00:00",attributes:{"aria-hidden":"true"}}),n=g.createElement("span",{className:"vidply-sr-only",textContent:m.t("time.durationPrefix")+m.t("time.seconds",{count:0})});return this.controls.durationDisplay.appendChild(a),this.controls.durationDisplay.appendChild(n),this.controls.durationVisual=a,this.controls.durationAccessible=n,e.appendChild(this.controls.currentTimeDisplay),e.appendChild(s),e.appendChild(this.controls.durationDisplay),e}createChaptersButton(){let e=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-chapters"),attributes:{type:"button","aria-label":m.t("player.chapters"),"aria-expanded":"false"}});return e.appendChild(T("chapters")),e.addEventListener("click",()=>{this.showChaptersMenu(e)}),this.controls.chapters=e,e}showChaptersMenu(e){let t=document.querySelector(".".concat(this.player.options.classPrefix,"-chapters-menu"));if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-chapters-menu ").concat(this.player.options.classPrefix,"-menu"),attributes:{role:"menu","aria-label":m.t("player.chapters")}}),s=Array.from(this.player.element.textTracks).filter(a=>a.kind==="chapters");if(s.length===0){let a=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-menu-item"),textContent:m.t("player.noChapters"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(a)}else{let a=s[0];if(a.mode==="disabled"&&(a.mode="hidden"),!a.cues||a.cues.length===0){let n=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-menu-item"),textContent:m.t("player.loadingChapters"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(n);let o=()=>{i.remove(),this.showChaptersMenu(e)};a.addEventListener("load",o,{once:!0}),setTimeout(()=>{a.cues&&a.cues.length>0&&document.contains(i)&&(i.remove(),this.showChaptersMenu(e))},500)}else{let n=a.cues;for(let o=0;o<n.length;o++){let r=n[o],c=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-menu-item"),attributes:{type:"button",role:"menuitem",tabindex:"-1"}}),l=g.createElement("span",{className:"".concat(this.player.options.classPrefix,"-chapter-time"),textContent:A.formatTime(r.startTime),attributes:{"aria-label":A.formatDuration(r.startTime)}}),d=g.createElement("span",{className:"".concat(this.player.options.classPrefix,"-chapter-title"),textContent:r.text});c.appendChild(l),c.appendChild(document.createTextNode(" ")),c.appendChild(d),c.addEventListener("click",()=>{this.player.seek(r.startTime),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(c)}this.attachMenuKeyboardNavigation(i,e),setTimeout(()=>{let o=i.querySelector(".".concat(this.player.options.classPrefix,"-menu-item"));o&&o.focus({preventScroll:!0})},0)}}i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e)}createQualityButton(){let e=m.t("player.quality"),t=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-quality"),attributes:{type:"button","aria-label":e,"aria-expanded":"false"}});t.appendChild(T("hd")),g.attachTooltip(t,e,this.player.options.classPrefix);let i=g.createElement("span",{className:"".concat(this.player.options.classPrefix,"-quality-text"),textContent:""});return t.appendChild(i),t.addEventListener("click",()=>{this.showQualityMenu(t)}),this.controls.quality=t,this.controls.qualityText=i,setTimeout(()=>this.updateQualityIndicator(),500),t}showQualityMenu(e){let t=document.querySelector(".".concat(this.player.options.classPrefix,"-quality-menu"));if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-quality-menu ").concat(this.player.options.classPrefix,"-menu"),attributes:{role:"menu","aria-label":m.t("player.quality")}});if(this.player.renderer&&this.player.renderer.getQualities){let s=this.player.renderer.getQualities(),a=this.player.renderer.getCurrentQuality?this.player.renderer.getCurrentQuality():-1,n=this.player.renderer.hls!==void 0;if(s.length===0){let o=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-menu-item"),textContent:m.t("player.autoQuality"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(o)}else{let o=null;if(n){let r=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-menu-item"),textContent:m.t("player.auto"),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});this.player.renderer.hls&&this.player.renderer.hls.currentLevel===-1&&(r.classList.add("".concat(this.player.options.classPrefix,"-menu-item-active")),r.appendChild(T("check")),o=r),r.addEventListener("click",()=>{this.player.renderer.switchQuality&&this.player.renderer.switchQuality(-1),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(r)}s.forEach(r=>{let c=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-menu-item"),textContent:r.name||"".concat(r.height,"p"),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});r.index===a&&(c.classList.add("".concat(this.player.options.classPrefix,"-menu-item-active")),c.appendChild(T("check")),o=c),c.addEventListener("click",()=>{this.player.renderer.switchQuality&&this.player.renderer.switchQuality(r.index),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(c)}),this.attachMenuKeyboardNavigation(i,e),setTimeout(()=>{let r=o||i.querySelector(".".concat(this.player.options.classPrefix,"-menu-item"));r&&r.focus({preventScroll:!0})},0)}}else{let s=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-menu-item"),textContent:m.t("player.noQuality"),style:{opacity:"0.5",cursor:"default"}});i.appendChild(s)}i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e)}createCaptionStyleButton(){let e=m.t("player.captionStyling"),t=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-caption-style"),attributes:{type:"button","aria-label":e,"aria-expanded":"false"}}),i=g.createElement("span",{textContent:"Aa",style:{fontSize:"14px",fontWeight:"bold"}});return t.appendChild(i),g.attachTooltip(t,e,this.player.options.classPrefix),t.addEventListener("click",()=>{this.showCaptionStyleMenu(t)}),this.controls.captionStyle=t,t}showCaptionStyleMenu(e){let t=document.querySelector(".".concat(this.player.options.classPrefix,"-caption-style-menu"));if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-caption-style-menu ").concat(this.player.options.classPrefix,"-menu ").concat(this.player.options.classPrefix,"-settings-menu"),attributes:{role:"menu","aria-label":m.t("player.captionStyling")}});if(i.addEventListener("click",c=>{c.stopPropagation()}),!this.player.captionManager||this.player.captionManager.tracks.length===0){let c=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-menu-item"),textContent:m.t("player.noCaptions"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default",padding:"12px 16px"}});i.appendChild(c),i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e,!0);return}let s=this.createStyleControl(m.t("styleLabels.fontSize"),"captionsFontSize",[{label:m.t("fontSizes.small"),value:"87.5%"},{label:m.t("fontSizes.normal"),value:"100%"},{label:m.t("fontSizes.large"),value:"125%"},{label:m.t("fontSizes.xlarge"),value:"150%"}]);i.appendChild(s);let a=this.createStyleControl(m.t("styleLabels.font"),"captionsFontFamily",[{label:m.t("fontFamilies.sansSerif"),value:"sans-serif"},{label:m.t("fontFamilies.serif"),value:"serif"},{label:m.t("fontFamilies.monospace"),value:"monospace"}]);i.appendChild(a);let n=this.createColorControl(m.t("styleLabels.textColor"),"captionsColor");i.appendChild(n);let o=this.createColorControl(m.t("styleLabels.background"),"captionsBackgroundColor");i.appendChild(o);let r=this.createOpacityControl(m.t("styleLabels.opacity"),"captionsOpacity");i.appendChild(r),i.style.minWidth="220px",i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e,!0),qe(i,".".concat(this.player.options.classPrefix,"-style-select"))}createStyleControl(e,t,i){let s=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-style-group")}),a="".concat(this.player.options.classPrefix,"-").concat(t,"-").concat(Date.now()),n=g.createElement("label",{textContent:e,attributes:{for:a},style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"rgba(255,255,255,0.7)"}});s.appendChild(n);let o=g.createElement("select",{className:"".concat(this.player.options.classPrefix,"-style-select"),attributes:{id:a},style:{width:"100%",padding:"6px",background:"var(--vidply-white)",border:"1px solid var(--vidply-white-10)",borderRadius:"4px",color:"var(--vidply-black)",fontSize:"13px"}}),r=this.player.options[t];return i.forEach(c=>{let l=g.createElement("option",{textContent:c.label,attributes:{value:c.value}});c.value===r&&(l.selected=!0),o.appendChild(l)}),o.addEventListener("mousedown",c=>{c.stopPropagation()}),o.addEventListener("click",c=>{c.stopPropagation()}),o.addEventListener("change",c=>{c.stopPropagation(),this.player.options[t]=c.target.value,this.player.captionManager&&this.player.captionManager.setCaptionStyle(t.replace("captions","").charAt(0).toLowerCase()+t.replace("captions","").slice(1),c.target.value)}),s.appendChild(o),s}createColorControl(e,t){let i=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-style-group")}),s="".concat(this.player.options.classPrefix,"-").concat(t,"-").concat(Date.now()),a=g.createElement("label",{textContent:e,attributes:{for:s},style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"rgba(255,255,255,0.7)"}});i.appendChild(a);let n=g.createElement("input",{attributes:{id:s,type:"color",value:this.player.options[t]},style:{width:"100%",height:"32px",padding:"2px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"4px",cursor:"pointer"}});return n.addEventListener("mousedown",o=>{o.stopPropagation()}),n.addEventListener("click",o=>{o.stopPropagation()}),n.addEventListener("change",o=>{o.stopPropagation(),this.player.options[t]=o.target.value,this.player.captionManager&&this.player.captionManager.setCaptionStyle(t.replace("captions","").charAt(0).toLowerCase()+t.replace("captions","").slice(1),o.target.value)}),i.appendChild(n),i}createOpacityControl(e,t){let i=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-style-group")}),s="".concat(this.player.options.classPrefix,"-").concat(t,"-").concat(Date.now()),a=g.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"}}),n=g.createElement("label",{textContent:e,attributes:{for:s},style:{fontSize:"12px",color:"rgba(255,255,255,0.7)"}}),o=g.createElement("span",{textContent:Math.round(this.player.options[t]*100)+"%",style:{fontSize:"12px",color:"rgba(255,255,255,0.7)"}});a.appendChild(n),a.appendChild(o),i.appendChild(a);let r=g.createElement("input",{attributes:{id:s,type:"range",min:"0",max:"1",step:"0.1",value:String(this.player.options[t])},style:{width:"100%",cursor:"pointer"}});return r.addEventListener("mousedown",c=>{c.stopPropagation()}),r.addEventListener("click",c=>{c.stopPropagation()}),r.addEventListener("input",c=>{c.stopPropagation();let l=parseFloat(c.target.value);o.textContent=Math.round(l*100)+"%",this.player.options[t]=l,this.player.captionManager&&this.player.captionManager.setCaptionStyle(t.replace("captions","").charAt(0).toLowerCase()+t.replace("captions","").slice(1),l)}),i.appendChild(r),i}createSpeedButton(){let e=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-speed"),attributes:{type:"button","aria-label":m.t("player.speed"),"aria-expanded":"false"}});e.appendChild(T("speed"));let t=g.createElement("span",{className:"".concat(this.player.options.classPrefix,"-speed-text"),textContent:"1x"});return e.appendChild(t),e.addEventListener("click",()=>{this.showSpeedMenu(e)}),this.controls.speed=e,this.controls.speedText=t,e}formatSpeedLabel(e){if(e===1)return m.t("speeds.normal");let t=e.toLocaleString(m.getLanguage(),{minimumFractionDigits:0,maximumFractionDigits:2});return"".concat(t,"×")}showSpeedMenu(e){let t=document.querySelector(".".concat(this.player.options.classPrefix,"-speed-menu"));if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-speed-menu ").concat(this.player.options.classPrefix,"-menu"),attributes:{role:"menu"}}),s=[.25,.5,.75,1,1.25,1.5,1.75,2],a=null;s.forEach(n=>{let o=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-menu-item"),textContent:this.formatSpeedLabel(n),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});n===this.player.state.playbackSpeed&&(o.classList.add("".concat(this.player.options.classPrefix,"-menu-item-active")),o.appendChild(T("check")),a=o),o.addEventListener("click",()=>{this.player.setPlaybackSpeed(n),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(o)}),i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuKeyboardNavigation(i,e),this.attachMenuCloseHandler(i,e),setTimeout(()=>{let n=a||i.querySelector(".".concat(this.player.options.classPrefix,"-menu-item"));n&&n.focus({preventScroll:!0})},0)}createCaptionsButton(){let e=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-captions-button"),attributes:{type:"button","aria-label":m.t("player.captions"),"aria-expanded":"false"}});return e.appendChild(T("captionsOff")),e.addEventListener("click",()=>{this.showCaptionsMenu(e)}),this.controls.captions=e,e}showCaptionsMenu(e){let t=document.querySelector(".".concat(this.player.options.classPrefix,"-captions-menu"));if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-captions-menu ").concat(this.player.options.classPrefix,"-menu"),attributes:{role:"menu","aria-label":m.t("captions.select")}});if(!this.player.captionManager||this.player.captionManager.tracks.length===0){let o=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-menu-item"),textContent:m.t("player.noCaptions"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(o),this.insertMenuIntoDOM(i,e),this.attachMenuCloseHandler(i,e);return}let s=null,a=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-menu-item"),textContent:m.t("captions.off"),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});this.player.state.captionsEnabled||(a.classList.add("".concat(this.player.options.classPrefix,"-menu-item-active")),a.appendChild(T("check")),s=a),a.addEventListener("click",()=>{this.player.disableCaptions(),this.updateCaptionsButton(),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(a),this.player.captionManager.getAvailableTracks().forEach(o=>{let r=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-menu-item"),textContent:o.label,attributes:{type:"button",role:"menuitem",lang:o.language,tabindex:"-1"}});this.player.state.captionsEnabled&&this.player.captionManager.currentTrack===this.player.captionManager.tracks[o.index]&&(r.classList.add("".concat(this.player.options.classPrefix,"-menu-item-active")),r.appendChild(T("check")),s=r),r.addEventListener("click",()=>{this.player.captionManager.switchTrack(o.index),this.updateCaptionsButton(),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(r)}),this.insertMenuIntoDOM(i,e),this.attachMenuKeyboardNavigation(i,e),this.attachMenuCloseHandler(i,e),setTimeout(()=>{let o=s||i.querySelector(".".concat(this.player.options.classPrefix,"-menu-item"));o&&o.focus({preventScroll:!0})},0)}updateCaptionsButton(){if(!this.controls.captions)return;let e=this.controls.captions.querySelector(".vidply-icon"),t=this.player.state.captionsEnabled;e.innerHTML=t?T("captions").innerHTML:T("captionsOff").innerHTML}createTranscriptButton(){let e=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-transcript"),attributes:{type:"button","aria-label":m.t("player.transcript"),"aria-expanded":"false"}});return e.appendChild(T("transcript")),e.addEventListener("click",async()=>{await this.player.toggleTranscript(),this.updateTranscriptButton()}),this.controls.transcript=e,e}updateTranscriptButton(){if(!this.controls.transcript)return;let e=this.player.transcriptManager&&this.player.transcriptManager.isVisible;this.controls.transcript.setAttribute("aria-expanded",e?"true":"false")}createAudioDescriptionButton(){let e=m.t("player.audioDescription"),t=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-audio-description"),attributes:{type:"button","aria-label":e,role:"switch","aria-checked":"false"}});return t.appendChild(T("audioDescription")),g.attachTooltip(t,e,this.player.options.classPrefix),t.addEventListener("click",async()=>{await this.player.toggleAudioDescription(),this.updateAudioDescriptionButton()}),this.controls.audioDescription=t,t}updateAudioDescriptionButton(){if(!this.controls.audioDescription)return;let e=this.controls.audioDescription.querySelector(".vidply-icon"),t=this.player.state.audioDescriptionEnabled;e.innerHTML=t?T("audioDescriptionOn").innerHTML:T("audioDescription").innerHTML,this.controls.audioDescription.setAttribute("aria-checked",t?"true":"false")}createSignLanguageButton(){let e=m.t("player.signLanguage"),t=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-sign-language"),attributes:{type:"button","aria-label":e,"aria-expanded":"false"}});return t.appendChild(T("signLanguagePip")),g.attachTooltip(t,e,this.player.options.classPrefix),t.addEventListener("click",()=>{this.player.toggleSignLanguage(),this.updateSignLanguageButton()}),this.controls.signLanguage=t,t}updateSignLanguageButton(){if(!this.controls.signLanguage)return;let e=this.controls.signLanguage.querySelector(".vidply-icon"),t=this.player.state.signLanguageEnabled;e.innerHTML=t?T("signLanguagePipOn").innerHTML:T("signLanguagePip").innerHTML,this.controls.signLanguage.setAttribute("aria-expanded",t?"true":"false"),this.controls.signLanguage.setAttribute("aria-label",t?m.t("signLanguage.hide"):m.t("signLanguage.show"))}createSignLanguageInMainViewButton(){let e=m.t("signLanguage.showInMainView"),t=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-sign-language-main-view"),attributes:{type:"button","aria-label":e,"aria-pressed":"false"}});return t.appendChild(T("signLanguage")),g.attachTooltip(t,e,this.player.options.classPrefix),t.addEventListener("click",()=>{this.player.signLanguageManager&&this.player.signLanguageManager.toggleInMainView()}),this.controls.signLanguageMainView=t,t}updateSignLanguageInMainViewButton(){let e=this.controls.signLanguageMainView;if(!e)return;let t=this.player.state.signLanguageInMainView,i=t?m.t("signLanguage.hideInMainView"):m.t("signLanguage.showInMainView"),s=t?"signLanguageOn":"signLanguage";e.querySelector(".vidply-icon").innerHTML=T(s).innerHTML,e.setAttribute("aria-pressed",String(t)),e.setAttribute("aria-label",i);let a=e.querySelector(".".concat(this.player.options.classPrefix,"-tooltip"));a&&(a.textContent=i)}updateAccessibilityButtons(){var r;let e=this.hasAudioDescription(),t=this.hasSignLanguage();if(e){if(!this.controls.audioDescription&&this.player.options.audioDescriptionButton!==!1){let c=this.createAudioDescriptionButton();c.dataset.overflowPriority="2",c.dataset.overflowPriorityMobile="3";let l=this.rightButtons.querySelector(".".concat(this.player.options.classPrefix,"-transcript")),d=this.rightButtons.querySelector(".".concat(this.player.options.classPrefix,"-playlist-toggle")),h=l||d||null;h?this.rightButtons.insertBefore(c,h):this.rightButtons.appendChild(c),this.setupOverflowMenu()}this.controls.audioDescription&&(this.controls.audioDescription.style.display="")}else this.controls.audioDescription&&(this.controls.audioDescription.style.display="none");let i=t&&this.player.options.signLanguageButton!==!1,s=this.player.options.classPrefix,a=this.player.options.signLanguageDisplayMode||"both",n=["pip","both"].includes(a),o=["main","both"].includes(a);if(i){let c=this.rightButtons.querySelector(".".concat(s,"-quality")),l=this.rightButtons.querySelector(".".concat(s,"-fullscreen")),d=c||l||null,h=!1;if(n&&!this.controls.signLanguage){let p=this.createSignLanguageButton();p.dataset.overflowPriority="3",p.dataset.overflowPriorityMobile="3",d?this.rightButtons.insertBefore(p,d):this.rightButtons.appendChild(p),h=!0}if(o&&!this.controls.signLanguageMainView){let p=this.createSignLanguageInMainViewButton();p.dataset.overflowPriority="3",p.dataset.overflowPriorityMobile="3";let y=(r=this.controls.signLanguage)==null?void 0:r.nextSibling;y?this.rightButtons.insertBefore(p,y):d?this.rightButtons.insertBefore(p,d):this.rightButtons.appendChild(p),h=!0}h&&this.setupOverflowMenu(),this.controls.signLanguage&&(this.controls.signLanguage.style.display=n?"":"none"),this.controls.signLanguageMainView&&(this.controls.signLanguageMainView.style.display=o?"":"none")}else this.controls.signLanguage&&(this.controls.signLanguage.style.display="none"),this.controls.signLanguageMainView&&(this.controls.signLanguageMainView.style.display="none")}createSettingsButton(){let e=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-settings"),attributes:{type:"button","aria-label":m.t("player.settings")}});return e.appendChild(T("settings")),e.addEventListener("click",()=>{this.player.showSettings()}),e}createPipButton(){let e=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-pip"),attributes:{type:"button","aria-label":m.t("player.pip")}});return e.appendChild(T("pip")),e.addEventListener("click",()=>{this.player.togglePiP()}),e}createFullscreenButton(){let e=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-fullscreen"),attributes:{type:"button","aria-label":m.t("player.fullscreen")}});return e.appendChild(T("fullscreen")),e.addEventListener("click",()=>{this.player.toggleFullscreen()}),this.controls.fullscreen=e,e}attachEvents(){this.player.on("play",()=>this.updatePlayPauseButton()),this.player.on("pause",()=>this.updatePlayPauseButton()),this.player.on("timeupdate",()=>this.updateProgress()),this.player.on("loadedmetadata",()=>{this.updateDuration(),this.ensureQualityButton(),this.updateQualityIndicator(),this.updatePreviewVideoSource()}),this.player.on("sourcechange",()=>{this.updatePreviewVideoSource()}),this.player.on("volumechange",()=>this.updateVolumeDisplay()),this.player.on("progress",()=>this.updateBuffered()),this.player.on("playbackspeedchange",()=>this.updateSpeedDisplay()),this.player.on("fullscreenchange",()=>this.updateFullscreenButton()),this.player.on("captionsenabled",()=>this.updateCaptionsButton()),this.player.on("captionsdisabled",()=>this.updateCaptionsButton()),this.player.on("audiodescriptionenabled",()=>this.updateAudioDescriptionButton()),this.player.on("audiodescriptiondisabled",()=>this.updateAudioDescriptionButton()),this.player.on("signlanguageenabled",()=>this.updateSignLanguageButton()),this.player.on("signlanguagedisabled",()=>this.updateSignLanguageButton()),this.player.on("signlanguageinmainviewenabled",()=>this.updateSignLanguageInMainViewButton()),this.player.on("signlanguageinmainviewdisabled",()=>this.updateSignLanguageInMainViewButton()),this.player.on("qualitychange",()=>this.updateQualityIndicator()),this.player.on("hlslevelswitched",()=>this.updateQualityIndicator()),this.player.on("hlsmanifestparsed",()=>{this.ensureQualityButton(),this.updateQualityIndicator()})}updatePlayPauseButton(){if(!this.controls.playPause)return;let e=this.controls.playPause.querySelector(".vidply-icon"),t=this.player.state.playing;e.innerHTML=t?T("pause").innerHTML:T("play").innerHTML;let i=t?m.t("player.pause"):m.t("player.play");this.controls.playPause.setAttribute("aria-label",i),g.attachTooltip(this.controls.playPause,i,this.player.options.classPrefix)}updateProgress(){if(!this.controls.played)return;let e=this.player.state.currentTime||0,t=this.player.state.duration||0,i=t>0?Math.min(100,Math.max(0,e/t*100)):0;this.controls.played.style.width="".concat(i,"%"),this.controls.progress.setAttribute("aria-valuenow",String(Math.round(i)));let s=A.formatDuration(this.player.state.currentTime),a=A.formatDuration(this.player.state.duration);if(this.controls.progress.setAttribute("aria-valuetext","".concat(Math.round(i),"%, ").concat(s," ").concat(m.t("time.of")," ").concat(a)),this.controls.currentTimeVisual){let n=this.player.state.currentTime;this.controls.currentTimeVisual.textContent=A.formatTime(n),this.controls.currentTimeAccessible&&(this.controls.currentTimeAccessible.textContent=A.formatDuration(n))}}updateDuration(){if(this.controls.durationVisual){let e=this.player.state.duration;this.controls.durationVisual.textContent=A.formatTime(e),this.controls.durationAccessible&&(this.controls.durationAccessible.textContent=m.t("time.durationPrefix")+A.formatDuration(e))}}updateVolumeDisplay(){let e=this.player.state.volume*100;if(this.controls.volumeFill&&(this.controls.volumeFill.style.height="".concat(e,"%")),this.controls.volumeSlider&&this.controls.volumeSlider.setAttribute("aria-valuenow",String(Math.round(e))),this.controls.mute){let t=this.controls.mute.querySelector(".vidply-icon");if(t){let i;this.player.state.muted||this.player.state.volume===0?i="volumeMuted":this.player.state.volume<.3?i="volumeLow":this.player.state.volume<.7?i="volumeMedium":i="volumeHigh",t.innerHTML=T(i).innerHTML;let s=this.player.state.muted?m.t("player.unmute"):m.t("player.mute");this.controls.mute.setAttribute("aria-label",s),g.attachTooltip(this.controls.mute,s,this.player.options.classPrefix)}}this.controls.volumeSlider&&this.controls.volumeSlider.setAttribute("aria-valuenow",String(Math.round(e)))}updateBuffered(){if(!this.controls.buffered||!this.player.element.buffered||this.player.element.buffered.length===0)return;let t=this.player.element.buffered.end(this.player.element.buffered.length-1)/this.player.state.duration*100;this.controls.buffered.style.width="".concat(t,"%")}updateSpeedDisplay(){this.controls.speedText&&(this.controls.speedText.textContent="".concat(this.player.state.playbackSpeed,"x"))}updateFullscreenButton(){if(!this.controls.fullscreen)return;let e=this.controls.fullscreen.querySelector(".vidply-icon"),t=this.player.state.fullscreen;e.innerHTML=t?T("fullscreenExit").innerHTML:T("fullscreen").innerHTML,this.controls.fullscreen.setAttribute("aria-label",t?m.t("player.exitFullscreen"):m.t("player.fullscreen"))}ensureQualityButton(){if(!this.player.options.qualityButton||this.controls.quality||!this.hasQualityLevels())return;let e=this.createQualityButton(),t=this.rightButtons.querySelector(".".concat(this.player.options.classPrefix,"-speed")),s=this.rightButtons.querySelector(".".concat(this.player.options.classPrefix,"-caption-style"))||t;s?this.rightButtons.insertBefore(e,s):this.rightButtons.insertBefore(e,this.rightButtons.firstChild),this.player.log("Quality button added dynamically","info")}updateQualityIndicator(){if(!this.controls.qualityText||!this.player.renderer||!this.player.renderer.getQualities)return;let e=this.player.renderer.getQualities();if(e.length===0){this.controls.qualityText.textContent="";return}let t="";if(this.player.renderer.hls&&this.player.renderer.hls.currentLevel===-1)t="Auto";else if(this.player.renderer.getCurrentQuality){let i=this.player.renderer.getCurrentQuality(),s=e.find(a=>a.index===i);s&&(t=s.height?"".concat(s.height,"p"):"")}this.controls.qualityText.textContent=t}setupAutoHide(){if(this.player.element.tagName!=="VIDEO")return;let e=()=>{if(this.element.classList.add("".concat(this.player.options.classPrefix,"-controls-visible")),this.player.container.classList.add("".concat(this.player.options.classPrefix,"-controls-visible")),this.player.state.controlsVisible=!0,clearTimeout(this.hideTimeout),this.player.state.playing){let t=this.player.state.fullscreen?this.player.options.hideControlsDelay*1.5:this.player.options.hideControlsDelay;this.hideTimeout=setTimeout(()=>{this.element.classList.remove("".concat(this.player.options.classPrefix,"-controls-visible")),this.player.container.classList.remove("".concat(this.player.options.classPrefix,"-controls-visible")),this.player.state.controlsVisible=!1},t)}};this.player.container.addEventListener("mousemove",e),this.player.container.addEventListener("touchstart",e),this.player.container.addEventListener("touchmove",e),this.player.container.addEventListener("click",e),this.player.container.addEventListener("tap",e),this.element.addEventListener("focusin",e),this.player.on("pause",()=>{e(),clearTimeout(this.hideTimeout)}),this.player.on("play",()=>{e()}),this.player.on("enterfullscreen",()=>{e(),this.player.state.fullscreen&&(clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(()=>{this.player.state.playing&&(this.element.classList.remove("".concat(this.player.options.classPrefix,"-controls-visible")),this.player.container.classList.remove("".concat(this.player.options.classPrefix,"-controls-visible")),this.player.state.controlsVisible=!1)},this.player.options.hideControlsDelay*2))}),e()}createOverflowMenuButton(){let e=m.t("player.moreOptions"),t=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-button ").concat(this.player.options.classPrefix,"-overflow-menu"),attributes:{type:"button","aria-label":e,"aria-expanded":"false"}});return t.appendChild(T("moreVertical")),g.attachTooltip(t,e,this.player.options.classPrefix),t.addEventListener("click",()=>{this.showOverflowMenu(t)}),this.controls.overflowMenu=t,t}showOverflowMenu(e){let t=document.querySelector(".".concat(this.player.options.classPrefix,"-overflow-menu-list"));if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-overflow-menu-list ").concat(this.player.options.classPrefix,"-menu"),attributes:{role:"menu","aria-label":m.t("player.moreOptions")}}),s=Array.from(this.rightButtons.querySelectorAll('button[data-in-overflow="true"]'));if(s.length===0){let a=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-menu-item"),textContent:m.t("player.noMoreOptions"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(a)}else s.forEach(a=>{let n=g.createElement("button",{className:"".concat(this.player.options.classPrefix,"-menu-item"),attributes:{type:"button",role:"menuitem",tabindex:"-1"}}),o=a.getAttribute("aria-label")||a.getAttribute("title")||"",r=a.querySelector(".vidply-icon");if(r){let l=r.cloneNode(!0);n.appendChild(l)}else{let l=a.querySelector("span");if(l&&l.textContent&&l.textContent.length<=3){let d=l.cloneNode(!0);d.classList.add("vidply-icon"),n.appendChild(d)}}let c=g.createElement("span",{textContent:o});n.appendChild(c),n.addEventListener("click",l=>{this._overflowMenuItemRef=n;let d=a.style.display;a.style.display="",a.style.visibility="hidden",a.click(),setTimeout(()=>{a.style.display=d,a.style.visibility="",this._overflowMenuItemRef=null},100),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(n)}),this.attachMenuKeyboardNavigation(i,e),setTimeout(()=>{let a=i.querySelector(".".concat(this.player.options.classPrefix,"-menu-item"));a&&a.tagName==="BUTTON"&&a.focus({preventScroll:!0})},0);i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e)}setupOverflowDetection(){let e=()=>{let i=window.innerWidth>=768,s=window.innerHeight<window.innerWidth,a=this.player.state.fullscreen,n=s&&a;if(!this.rightButtons||this.rightButtons.children.length===0){this.overflowMenuButton&&(this.overflowMenuButton.style.display="none");return}let o=Array.from(this.rightButtons.children).filter(f=>!f.classList.contains("".concat(this.player.options.classPrefix,"-overflow-menu")));if(o.length===0){this.overflowMenuButton&&(this.overflowMenuButton.style.display="none");return}let r=!i&&!s;if(this.player.options.debug&&console.log("Overflow detection:",{isDesktop:i,isFullscreen:a,isLandscape:s,isLandscapeFullscreen:n,shouldUseOverflow:r,width:window.innerWidth,height:window.innerHeight}),!r){o.forEach(f=>{f.dataset.inOverflow="false",f.style.display=""}),this.overflowMenuButton&&(this.overflowMenuButton.style.display="none"),this.player.options.debug&&console.log("No overflow menu needed - all buttons visible, overflow button hidden");return}this.player.options.debug&&console.log("Mobile portrait - checking for overflow..."),o.forEach(f=>{f.style.display=""});let c=this.rightButtons.offsetWidth,d=c-50,h=0,p=o.map(f=>{let L=getComputedStyle(f),w=f.offsetWidth+parseInt(L.marginLeft||0)+parseInt(L.marginRight||0);return h+=w,{btn:f,width:w}});h+=(o.length-1)*8;let b=window.innerWidth<768,v=h>d||b||n&&!i;if(this.player.options.debug&&console.log("Overflow detection:",{containerWidth:c,availableWidth:d,totalWidth:h,needsOverflow:v,isSmallScreen:b,reason:b?"mobile screen":h>d?"not enough space":"enough space",buttonCount:o.length}),v){let f=window.innerWidth<768,L=f?"overflowPriorityMobile":"overflowPriority";this.player.options.debug&&console.log("Using ".concat(f?"mobile":"desktop"," priorities (width: ").concat(window.innerWidth,"px)"));let w=p.sort((M,E)=>{let C=parseInt(M.btn.dataset[L]||M.btn.dataset.overflowPriority||"1");return parseInt(E.btn.dataset[L]||E.btn.dataset.overflowPriority||"1")-C}),S=h,P=0;for(let{btn:M,width:E}of w){let C=parseInt(M.dataset[L]||M.dataset.overflowPriority||"1"),x=M.getAttribute("aria-label")||"unknown";if(C===1){M.dataset.inOverflow="false",M.style.display="";continue}(f?C>1:S>d)?(M.dataset.inOverflow="true",M.style.display="none",S-=E,P++,this.player.options.debug&&console.log("  → Hiding button: ".concat(x," (priority ").concat(C,", ").concat(f?"mobile":"desktop",")"))):(M.dataset.inOverflow="false",M.style.display="")}if(this.player.options.debug&&console.log("Overflow button exists?",!!this.overflowMenuButton),!this.overflowMenuButton){console.error("Overflow menu button not found!");return}P>0?(this.overflowMenuButton.style.display="",this.player.options.debug&&console.log("Showing overflow menu button -",P,"buttons moved")):(this.overflowMenuButton.style.display="none",this.player.options.debug&&console.log("Hiding overflow menu button - all buttons fit"))}else o.forEach(f=>{f.dataset.inOverflow="false",f.style.display=""}),this.overflowMenuButton.style.display="none"},t=new ResizeObserver(()=>{requestAnimationFrame(e)});t.observe(this.rightButtons),window.addEventListener("resize",()=>{requestAnimationFrame(e)}),this.player.on("fullscreenchange",()=>{setTimeout(()=>{requestAnimationFrame(e)},50)}),requestAnimationFrame(()=>{e(),setTimeout(()=>e(),100),setTimeout(()=>e(),300),setTimeout(()=>e(),500)}),document.fonts&&document.fonts.ready&&document.fonts.ready.then(()=>{requestAnimationFrame(e)}),this.overflowResizeObserver=t}show(){this.element.style.display=""}hide(){this.element.style.display="none"}updatePreviewVideoSource(){var s;let e=this.player.renderer;if(!e||!e.media||e.media.tagName!=="VIDEO"||(!this.previewSupported&&!this.previewVideo&&this.initPreviewThumbnail(),!this.previewSupported||!this.previewVideo))return;let t=e.media,i=t.src||((s=t.querySelector("source"))==null?void 0:s.src);i&&this.previewVideo.src!==i?(this.previewThumbnailCache.clear(),this.previewVideoReady=!1,this.previewVideo.src=i,t.crossOrigin&&(this.previewVideo.crossOrigin=t.crossOrigin),this.previewVideo.addEventListener("loadedmetadata",()=>{this.previewVideoReady=!0},{once:!0})):i&&!this.previewVideoReady&&this.previewVideo.readyState>=1&&(this.previewVideoReady=!0)}cleanupPreviewThumbnail(){this.previewThumbnailTimeout&&(clearTimeout(this.previewThumbnailTimeout),this.previewThumbnailTimeout=null),this.previewVideo&&this.previewVideo.parentNode&&(this.previewVideo.parentNode.removeChild(this.previewVideo),this.previewVideo=null),this.previewThumbnailCache.clear()}destroy(){this.hideTimeout&&clearTimeout(this.hideTimeout),this.overflowResizeObserver&&this.overflowResizeObserver.disconnect(),this.cleanupPreviewThumbnail(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}};F();O();ce();var U=class{constructor(e){this.player=e,this.element=null,this.tracks=[],this.currentTrack=null,this.currentCue=null,this.storage=new W("vidply"),this.loadSavedPreferences(),this.init()}loadSavedPreferences(){let e=this.storage.getCaptionPreferences();e&&(e.fontSize&&(this.player.options.captionsFontSize=e.fontSize),e.fontFamily&&(this.player.options.captionsFontFamily=e.fontFamily),e.color&&(this.player.options.captionsColor=e.color),e.backgroundColor&&(this.player.options.captionsBackgroundColor=e.backgroundColor),e.opacity!==void 0&&(this.player.options.captionsOpacity=e.opacity))}saveCaptionPreferences(){this.storage.saveCaptionPreferences({fontSize:this.player.options.captionsFontSize,fontFamily:this.player.options.captionsFontFamily,color:this.player.options.captionsColor,backgroundColor:this.player.options.captionsBackgroundColor,opacity:this.player.options.captionsOpacity})}init(){this.createElement(),this.loadTracks(),this.attachEvents(),this.player.options.captionsDefault&&this.tracks.length>0&&!this.currentTrack&&this.enable()}createElement(){this.element=g.createElement("div",{className:"".concat(this.player.options.classPrefix,"-captions"),attributes:{role:"region","aria-label":m.t("player.captions")}}),this.updateStyles(),(this.player.videoWrapper||this.player.container).appendChild(this.element)}loadTracks(){let e=this.player.element.textTracks,t=-1;for(let i=0;i<e.length;i++){let s=e[i];if(s.kind==="subtitles"||s.kind==="captions"){let a=this.player.findTrackElement(s),n=a&&a.hasAttribute("default");this.tracks.push({track:s,language:s.language,label:s.label,kind:s.kind,index:i,isDefault:n}),s.mode==="showing"||s.mode,s.mode="hidden",n&&(t=this.tracks.length-1)}}t>=0&&requestAnimationFrame(()=>{this.enable(t)})}attachEvents(){this.player.on("timeupdate",()=>{this.updateCaptions()}),this.player.on("captionschange",()=>{this.updateStyles()}),this.debouncedPositionCaptions=re(()=>{this.positionCaptionsOnMobile()},150),window.addEventListener("resize",this.debouncedPositionCaptions),this.player.on("enterfullscreen",()=>{Y(()=>this.positionCaptionsOnMobile(),100)}),this.player.on("exitfullscreen",()=>{Y(()=>this.positionCaptionsOnMobile(),100)})}enable(e=0){if(this.tracks.length===0)return;this.currentTrack&&this.currentTrack.track&&(this.cueChangeHandler&&this.currentTrack.track.removeEventListener("cuechange",this.cueChangeHandler),this.currentTrack.track.mode="hidden");let t=this.tracks[e];if(t&&t.track){t.track.mode="hidden",this.currentTrack=t,this.player.state.captionsEnabled=!0,t.language&&this.element.setAttribute("lang",t.language),this.cueChangeHandler&&t.track.removeEventListener("cuechange",this.cueChangeHandler),this.cueChangeHandler=()=>{this.updateCaptions()},t.track.addEventListener("cuechange",this.cueChangeHandler);let i=()=>{if(t.track.readyState<2){let s=()=>{t.track.removeEventListener("load",s),t.track.removeEventListener("error",s),requestAnimationFrame(()=>{this.currentTrack&&this.currentTrack.track===t.track&&this.updateCaptions()})};t.track.addEventListener("load",s,{once:!0}),t.track.addEventListener("error",s,{once:!0})}else requestAnimationFrame(()=>{this.currentTrack&&this.currentTrack.track===t.track&&this.updateCaptions()})};requestAnimationFrame(()=>{this.currentTrack&&this.currentTrack.track===t.track&&i()}),this.player.emit("captionsenabled",t)}}disable(){this.currentTrack&&(this.currentTrack.track.mode="hidden",this.currentTrack=null),this.element.style.display="none",this.element.innerHTML="",this.element.removeAttribute("lang"),this.currentCue=null,this.player.state.captionsEnabled=!1,this.player.emit("captionsdisabled")}updateCaptions(){if(!this.currentTrack||!this.currentTrack.track)return;if(this.currentTrack.track.mode==="disabled"&&(this.currentTrack.track.mode="hidden"),this.currentTrack.track.mode==="showing"&&(this.currentTrack.track.mode="hidden"),!this.currentTrack.track.activeCues){this.currentTrack.track.cues&&this.currentTrack.track.cues.length>0&&this.currentCue&&(this.element.innerHTML="",this.element.style.display="none",this.currentCue=null);return}let e=this.currentTrack.track.activeCues,t=this.player.element.tagName.toLowerCase()==="audio";if(e.length>0){let i=e[0];if(this.currentCue!==i){this.currentCue=i;let s=i.text;if(s=this.parseVTTFormatting(s),t){this.element.querySelectorAll(".".concat(this.player.options.classPrefix,"-caption-cue")).forEach(r=>r.classList.remove("".concat(this.player.options.classPrefix,"-caption-active")));let n="cue-".concat(i.startTime,"-").concat(i.endTime),o=this.element.querySelector('[data-cue-id="'.concat(n,'"]'));o||(o=document.createElement("div"),o.className="".concat(this.player.options.classPrefix,"-caption-cue"),o.setAttribute("data-cue-id",n),o.innerHTML=g.sanitizeHTML(s),this.element.appendChild(o)),o.classList.add("".concat(this.player.options.classPrefix,"-caption-active")),requestAnimationFrame(()=>{o&&o.scrollIntoView({behavior:"smooth",block:"center"})})}else this.element.innerHTML=g.sanitizeHTML(s);this.element.style.display="block",this.positionCaptionsOnMobile(),this.player.emit("captionchange",i)}}else this.currentCue&&(t||(this.element.innerHTML="",this.element.style.display="none"),this.currentCue=null)}positionCaptionsOnMobile(){var s,a;if(!this.element||this.element.style.display==="none")return;let e=((s=this.player.state)==null?void 0:s.fullscreen)||!1,t=X();if(!t&&!e){this.element.style.bottom="";return}let i=(a=this.player.controlBar)==null?void 0:a.element;i&&requestAnimationFrame(()=>{if(!this.element||this.element.style.display==="none")return;let n=i.getBoundingClientRect(),r=this.player.videoWrapper.getBoundingClientRect().bottom-n.top+16;this.element.style.bottom="".concat(r,"px"),this.player.options.debug&&console.log("[VidPly] Caption position:",{mobile:t,isFullscreen:e,controlsHeight:n.height,bottomOffset:"".concat(r,"px")})})}parseVTTFormatting(e){return e=e.replace(/<c[^>]*>(.*?)<\/c>/g,'<span class="caption-class">$1</span>'),e=e.replace(/<b>(.*?)<\/b>/g,"<strong>$1</strong>"),e=e.replace(/<i>(.*?)<\/i>/g,"<em>$1</em>"),e=e.replace(/<u>(.*?)<\/u>/g,"<u>$1</u>"),e=e.replace(/<v\s+([^>]+)>(.*?)<\/v>/g,'<span class="caption-voice" data-voice="$1">$2</span>'),e}updateStyles(){if(!this.element)return;let e=this.player.options;this.element.style.fontSize=e.captionsFontSize,this.element.style.fontFamily=e.captionsFontFamily,this.element.style.color=e.captionsColor,this.element.style.backgroundColor=this.hexToRgba(e.captionsBackgroundColor,e.captionsOpacity)}hexToRgba(e,t){let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?"rgba(".concat(parseInt(i[1],16),", ").concat(parseInt(i[2],16),", ").concat(parseInt(i[3],16),", ").concat(t,")"):e}setCaptionStyle(e,t){switch(e){case"fontSize":this.player.options.captionsFontSize=t;break;case"fontFamily":this.player.options.captionsFontFamily=t;break;case"color":this.player.options.captionsColor=t;break;case"backgroundColor":this.player.options.captionsBackgroundColor=t;break;case"opacity":this.player.options.captionsOpacity=t;break}this.updateStyles(),this.saveCaptionPreferences(),this.player.emit("captionschange")}getAvailableTracks(){return this.tracks.map((e,t)=>({index:t,language:e.language,label:e.label||e.language,kind:e.kind}))}switchTrack(e){e>=0&&e<this.tracks.length&&(this.disable(),this.enable(e))}destroy(){this.disable(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}};var de=class{constructor(e){this.player=e,this.shortcuts=e.options.keyboardShortcuts,this.init()}init(){this.attachEvents()}attachEvents(){this.player.container.addEventListener("keydown",e=>{this.handleKeydown(e)},!0),this.player.container.hasAttribute("tabindex")||this.player.container.setAttribute("tabindex","0")}handleKeydown(e){var a,n;if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||e.target.tagName==="SELECT")return;let t=document.activeElement;if(t){if(t.closest('.vidply-menu, [role="menu"]')||t.closest(".vidply-playlist-item-button"))return;if(t.closest(".vidply-sign-language-wrapper")){let d=(a=this.player.signLanguageManager)==null?void 0:a.draggable;if(d!=null&&d.keyboardDragMode||d!=null&&d.keyboardResizeMode)return}if(t.closest(".vidply-transcript-window")){let d=(n=this.player.transcriptManager)==null?void 0:n.draggableResizable;if(d!=null&&d.keyboardDragMode||d!=null&&d.keyboardResizeMode)return}}let i=e.key,s=!1;if(i==="Escape"&&this.player.state.fullscreen){this.player.exitFullscreen(),e.preventDefault(),e.stopPropagation();return}for(let[o,r]of Object.entries(this.shortcuts))if(r.includes(i)&&(s=this.executeAction(o,e),s)){e.preventDefault(),e.stopPropagation(),this.announceAction(o);break}!s&&this.player.options.debug&&console.log("[VidPly] Unhandled key:",e.key,"code:",e.code,"shiftKey:",e.shiftKey)}executeAction(e,t){switch(e){case"play-pause":return this.player.toggle(),!0;case"volume-up":return this.player.setVolume(Math.min(1,this.player.state.volume+.1)),!0;case"volume-down":return this.player.setVolume(Math.max(0,this.player.state.volume-.1)),!0;case"seek-forward":return this.player.seekForward(),!0;case"seek-backward":return this.player.seekBackward(),!0;case"mute":return this.player.toggleMute(),!0;case"fullscreen":return this.player.toggleFullscreen(),!0;case"captions":if(this.player.captionManager&&this.player.captionManager.tracks.length>1){let i=this.player.controlBar&&this.player.controlBar.controls.captions;i?this.player.controlBar.showCaptionsMenu(i):this.player.toggleCaptions()}else this.player.toggleCaptions();return!0;case"caption-style-menu":return this.player.controlBar&&this.player.controlBar.controls.captionStyle?(this.player.controlBar.showCaptionStyleMenu(this.player.controlBar.controls.captionStyle),!0):!1;case"speed-up":return this.player.setPlaybackSpeed(Math.min(2,this.player.state.playbackSpeed+.25)),!0;case"speed-down":return this.player.setPlaybackSpeed(Math.max(.25,this.player.state.playbackSpeed-.25)),!0;case"speed-menu":return this.player.controlBar&&this.player.controlBar.controls.speed?(this.player.controlBar.showSpeedMenu(this.player.controlBar.controls.speed),!0):!1;case"quality-menu":return this.player.controlBar&&this.player.controlBar.controls.quality?(this.player.controlBar.showQualityMenu(this.player.controlBar.controls.quality),!0):!1;case"chapters-menu":return this.player.controlBar&&this.player.controlBar.controls.chapters?(this.player.controlBar.showChaptersMenu(this.player.controlBar.controls.chapters),!0):!1;case"transcript-toggle":return this.player.transcriptManager?(this.player.transcriptManager.toggleTranscript(),!0):!1;default:return!1}}announceAction(e){if(!this.player.options.screenReaderAnnouncements)return;let t="";switch(e){case"play-pause":t=this.player.state.playing?"Playing":"Paused";break;case"volume-up":t="Volume ".concat(Math.round(this.player.state.volume*100),"%");break;case"volume-down":t="Volume ".concat(Math.round(this.player.state.volume*100),"%");break;case"mute":t=this.player.state.muted?"Muted":"Unmuted";break;case"fullscreen":t=this.player.state.fullscreen?"Fullscreen":"Exit fullscreen";break;case"captions":t=this.player.state.captionsEnabled?"Captions on":"Captions off";break;case"speed-up":case"speed-down":t="Speed ".concat(this.player.state.playbackSpeed,"x");break}t&&this.announce(t)}announce(e,t="polite"){let i=document.getElementById("vidply-announcer");i||(i=document.createElement("div"),i.id="vidply-announcer",i.className="vidply-sr-only",i.setAttribute("aria-live",t),i.setAttribute("aria-atomic","true"),i.style.cssText="\n        position: absolute;\n        left: -10000px;\n        width: 1px;\n        height: 1px;\n        overflow: hidden;\n      ",document.body.appendChild(i)),i.textContent="",setTimeout(()=>{i.textContent=e},100)}updateShortcut(e,t){Array.isArray(t)&&(this.shortcuts[e]=t)}destroy(){}};ve();q();O();ce();he();ue();pe();var ge=class{constructor(e){this.player=e,this.enabled=!1,this.desiredState=!1,this.src=e.options.audioDescriptionSrc,this.sourceElement=null,this.originalSource=null,this.captionTracks=[]}initFromSourceElements(e,t){for(let i of e){let s=i.getAttribute("data-desc-src"),a=i.getAttribute("data-orig-src");if(s||a){if(this.sourceElement||(this.sourceElement=i),a)this.originalSource||(this.originalSource=a),this.player.originalSrc||(this.player.originalSrc=a);else{let n=i.getAttribute("src");!this.originalSource&&n&&(this.originalSource=n),!this.player.originalSrc&&n&&(this.player.originalSrc=n)}s&&!this.src&&(this.src=s)}}t.forEach(i=>{let s=i.getAttribute("kind"),a=i.getAttribute("data-desc-src");(s==="captions"||s==="subtitles"||s==="chapters"||s==="descriptions")&&a&&(this.captionTracks.push({trackElement:i,originalSrc:i.getAttribute("src"),describedSrc:a,originalTrackSrc:i.getAttribute("data-orig-src")||i.getAttribute("src"),explicit:!0}),this.player.log("Found explicit described ".concat(s," track: ").concat(i.getAttribute("src")," -> ").concat(a)))})}isAvailable(){let e=this.player.sourceElements.some(t=>t.getAttribute("data-desc-src"));return!!(this.src||e||this.captionTracks.length>0)}async enable(){let e=this.player.sourceElements.some(r=>r.getAttribute("data-desc-src")),t=this.captionTracks.length>0;if(!this.src&&!e&&!t){console.warn("VidPly: No audio description source, source elements, or tracks provided");return}this.desiredState=!0;let i=this.player.state.currentTime,s=this.player.state.playing,a=this.player.element.poster||this.player.element.getAttribute("poster")||this.player.options.poster,n=i<.1&&!s,o=this._getCurrentCaptionText();this.sourceElement?await this._enableWithSourceElement(i,s,a,n,o):await this._enableWithDirectSrc(i,s,a,n)}async disable(){if(!this.player.originalSrc)return;this.desiredState=!1;let e=this.player.state.currentTime,t=this.player.state.playing,i=this.player.element.poster||this.player.element.getAttribute("poster")||this.player.options.poster,s=e<.1&&!t,a=this._getCurrentCaptionText();this.sourceElement?await this._disableWithSourceElement(e,t,i,s,a):await this._disableWithDirectSrc(e,t,i)}async toggle(){let e=this.player.findTextTrack("descriptions"),t=this.isAvailable();e&&!t?e.mode==="showing"?(e.mode="hidden",this.enabled=!1,this.player.emit("audiodescriptiondisabled")):(e.mode="showing",this.enabled=!0,this.player.emit("audiodescriptionenabled")):e&&t?this.enabled?(this.desiredState=!1,await this.disable()):(e.mode="showing",this.desiredState=!0,await this.enable()):t&&(this.enabled?(this.desiredState=!1,await this.disable()):(this.desiredState=!0,await this.enable()))}_getCurrentCaptionText(){return this.player.captionManager&&this.player.captionManager.currentTrack&&this.player.captionManager.currentCue?this.player.captionManager.currentCue.text:null}async _validateTrackExists(e){try{return(await fetch(e,{method:"HEAD"})).ok}catch(t){return!1}}async _swapCaptionTracks(e=!0){if(this.captionTracks.length===0)return[];let t=[],i=this.captionTracks.map(async n=>{if(n.trackElement&&n.describedSrc&&n.explicit===!0)try{let o=await this._validateTrackExists(e?n.describedSrc:n.originalSrc);return{trackInfo:n,exists:o}}catch(o){return{trackInfo:n,exists:!1}}return{trackInfo:n,exists:!1}}),a=(await Promise.all(i)).filter(n=>n.exists);if(a.length>0){let n=new Map;a.forEach(({trackInfo:r})=>{let c=r.trackElement.track;c?n.set(r,{wasShowing:c.mode==="showing",wasHidden:c.mode==="hidden"}):n.set(r,{wasShowing:!1,wasHidden:!1})});let o=a.map(({trackInfo:r})=>{let c={};Array.from(r.trackElement.attributes).forEach(d=>{c[d.name]=d.value});let l={trackInfo:r,oldSrc:r.trackElement.getAttribute("src"),parent:r.trackElement.parentNode,nextSibling:r.trackElement.nextSibling,attributes:c};return r.trackElement.remove(),l});this.player.element.load(),await new Promise(r=>{setTimeout(()=>{o.forEach(({trackInfo:l,parent:d,nextSibling:h,attributes:p})=>{t.push(l);let y=document.createElement("track"),b=e?l.describedSrc:l.originalSrc;y.setAttribute("src",b),Object.keys(p).forEach(f=>{f!=="src"&&f!=="data-desc-src"&&y.setAttribute(f,p[f])});let v=d||this.player.element;h&&h.parentNode?v.insertBefore(y,h):v.appendChild(y),l.trackElement=y}),this.player.invalidateTrackCache();let c=()=>{this.player.setManagedTimeout(()=>{t.forEach(l=>{let d=l.trackElement.track;if(d){let h=n.get(l)||{wasShowing:!1,wasHidden:!1};d.mode="hidden";let p=()=>{h.wasShowing||h.wasHidden?d.mode="hidden":d.mode="disabled"};d.readyState>=2?p():(d.addEventListener("load",p,{once:!0}),d.addEventListener("error",p,{once:!0}))}})},300)};this.player.element.readyState>=1?setTimeout(c,200):(this.player.element.addEventListener("loadedmetadata",c,{once:!0}),setTimeout(c,2e3)),r()},100)})}return t}_updateSourceElements(e=!0){let t=this.player.sourceElements,i=[];t.forEach(s=>{let a=s.getAttribute("data-desc-src"),n=s.getAttribute("src");if(a){let o=s.getAttribute("type"),r=s.getAttribute("data-orig-src")||n;i.push({src:e?a:r,type:o,origSrc:r,descSrc:a})}else i.push({src:s.getAttribute("src"),type:s.getAttribute("type"),origSrc:null,descSrc:null})}),this.player.element.hasAttribute("src")&&this.player.element.removeAttribute("src"),t.forEach(s=>s.remove()),i.forEach(s=>{let a=document.createElement("source");a.setAttribute("src",s.src),s.type&&a.setAttribute("type",s.type),s.origSrc&&a.setAttribute("data-orig-src",s.origSrc),s.descSrc&&a.setAttribute("data-desc-src",s.descSrc);let n=this.player.element.querySelector("track");n?this.player.element.insertBefore(a,n):this.player.element.appendChild(a)}),this.player._sourceElementsDirty=!0,this.player._sourceElementsCache=null}async _waitForMediaReady(e=!1){await new Promise(t=>{if(this.player.element.readyState>=1)t();else{let i=()=>{this.player.element.removeEventListener("loadedmetadata",i),t()};this.player.element.addEventListener("loadedmetadata",i)}}),await new Promise(t=>setTimeout(t,300)),e&&await new Promise(t=>{if(this.player.element.readyState>=3)t();else{let i=()=>{this.player.element.removeEventListener("canplay",i),this.player.element.removeEventListener("canplaythrough",i),t()};this.player.element.addEventListener("canplay",i,{once:!0}),this.player.element.addEventListener("canplaythrough",i,{once:!0}),setTimeout(()=>{this.player.element.removeEventListener("canplay",i),this.player.element.removeEventListener("canplaythrough",i),t()},3e3)}})}async _restorePlaybackState(e,t,i,s){let a=e;if(s&&this.player.captionManager&&this.player.captionManager.tracks.length>0){await new Promise(o=>setTimeout(o,500));let n=this.player.findMatchingCaptionTime(s,this.player.captionManager.tracks);n!==null&&(a=n,this.player.options.debug&&this.player.log("[VidPly] Syncing via caption: ".concat(e,"s -> ").concat(a,"s")))}a>0&&(this.player.seek(a),await new Promise(n=>setTimeout(n,100))),t?(await this.player.play(),this.player.setManagedTimeout(()=>{this.player.hidePosterOverlay()},100)):(this.player.pause(),i||this.player.hidePosterOverlay())}async _enableWithSourceElement(e,t,i,s,a){await this._swapCaptionTracks(!0),this._updateSourceElements(!0),i&&this.player.element.tagName==="VIDEO"&&(this.player.element.poster=i),this.player.element.load(),await this._waitForMediaReady(e>0||t),await this._restorePlaybackState(e,t,s,a),this.desiredState&&(this.enabled=!0,this.player.state.audioDescriptionEnabled=!0,this.player.emit("audiodescriptionenabled"),this._reloadTranscript())}async _enableWithDirectSrc(e,t,i,s){await this._swapCaptionTracks(!0),i&&this.player.element.tagName==="VIDEO"&&(this.player.element.poster=i),this.player.element.src=this.src,await this._waitForMediaReady(e>0||t),e>0&&(this.player.seek(e),await new Promise(a=>setTimeout(a,100))),t?await this.player.play():(this.player.pause(),s||this.player.hidePosterOverlay()),this.desiredState&&(this.enabled=!0,this.player.state.audioDescriptionEnabled=!0,this.player.emit("audiodescriptionenabled"),this._reloadTranscript())}async _disableWithSourceElement(e,t,i,s,a){await this._swapCaptionTracks(!1),this._updateSourceElements(!1),i&&this.player.element.tagName==="VIDEO"&&(this.player.element.poster=i),this.player.element.load(),this.player.invalidateTrackCache(),await this._waitForMediaReady(e>0||t),await this._restorePlaybackState(e,t,s,a),this.player.captionManager&&(this.player.captionManager.destroy(),this.player.captionManager=new U(this.player)),!this.desiredState&&(this.enabled=!1,this.player.state.audioDescriptionEnabled=!1,this.player.emit("audiodescriptiondisabled"),this._reloadTranscript())}async _disableWithDirectSrc(e,t,i){await this._swapCaptionTracks(!1),i&&this.player.element.tagName==="VIDEO"&&(this.player.element.poster=i);let s=this.originalSource||this.player.originalSrc;this.player.element.src=s,this.player.element.load(),await this._waitForMediaReady(e>0||t),e>0&&this.player.seek(e),t&&await this.player.play(),!this.desiredState&&(this.enabled=!1,this.player.state.audioDescriptionEnabled=!1,this.player.emit("audiodescriptiondisabled"),this._reloadTranscript())}_reloadTranscript(){this.player.transcriptManager&&this.player.transcriptManager.isVisible&&this.player.setManagedTimeout(()=>{this.player.transcriptManager&&this.player.transcriptManager.loadTranscriptData&&this.player.transcriptManager.loadTranscriptData()},800)}updateSources(e){this.src=e||null,this.enabled=!1,this.desiredState=!1,this.sourceElement=null,this.originalSource=null,this.captionTracks=[]}reinitialize(){this.player.invalidateTrackCache(),this.initFromSourceElements(this.player.sourceElements,this.player.trackElements)}destroy(){this.enabled=!1,this.desiredState=!1,this.captionTracks=[],this.sourceElement=null,this.originalSource=null}};F();q();O();he();ue();pe();var me=class{constructor(e){this.player=e,this.src=e.options.signLanguageSrc,this.sources=e.options.signLanguageSources||{},this.currentLanguage=null,this.desiredPosition=e.options.signLanguagePosition||"bottom-right",this.wrapper=null,this.header=null,this.video=null,this.selector=null,this.settingsButton=null,this.settingsMenu=null,this.resizeHandles=[],this.enabled=!1,this.inMainView=!1,this.mainViewOriginalSrc=null,this.mainViewOriginalSources=null,this._mainViewUsingSourceSwap=!1,this._mainViewMutedBefore=!1,this.settingsMenuVisible=!1,this.settingsMenuJustOpened=!1,this.documentClickHandlerAdded=!1,this.handlers=null,this.settingsHandlers=null,this.interactionHandlers=null,this.draggable=null,this.documentClickHandler=null,this.settingsMenuKeyHandler=null,this.customKeyHandler=null,this.dragOptionButton=null,this.dragOptionText=null,this.resizeOptionButton=null,this.resizeOptionText=null}isAvailable(){return Object.keys(this.sources).length>0||!!this.src}enable(){let e=Object.keys(this.sources).length>0,t=!!this.src;if(!e&&!t){console.warn("No sign language video source provided");return}if(this.wrapper){this.wrapper.style.display="block",this.enabled=!0,this.player.state.signLanguageEnabled=!0,this.player.emit("signlanguageenabled"),this.player.setManagedTimeout(()=>{this.settingsButton&&document.contains(this.settingsButton)&&this.settingsButton.focus({preventScroll:!0})},150);return}let i=null,s=null;e?(i=this._determineInitialLanguage(),s=this.sources[i],this.currentLanguage=i):s=this.src,this._createWrapper(),this._createHeader(e,i),this._createVideo(s),this._createResizeHandles(),this.wrapper.appendChild(this.header),this.wrapper.appendChild(this.video),this.resizeHandles.forEach(a=>this.wrapper.appendChild(a)),this._applyInitialSize(),this.player.container.appendChild(this.wrapper),requestAnimationFrame(()=>{this.constrainPosition()}),this.video.currentTime=this.player.state.currentTime,this.player.state.paused||this.video.play(),this._setupInteraction(),this._setupEventHandlers(e),this.enabled=!0,this.player.state.signLanguageEnabled=!0,this.player.emit("signlanguageenabled"),this.player.setManagedTimeout(()=>{this.settingsButton&&document.contains(this.settingsButton)&&this.settingsButton.focus({preventScroll:!0})},150)}disable(){this.settingsMenuVisible&&this.hideSettingsMenu({focusButton:!1}),this.wrapper&&(this.wrapper.style.display="none"),this.enabled=!1,this.player.state.signLanguageEnabled=!1,this.player.emit("signlanguagedisabled")}toggle(){this.enabled?this.disable():this.enable()}async enableInMainView(){let e=Object.keys(this.sources).length>0,t=!!this.src;if(!e&&!t||!this.player.element||this.player.element.tagName!=="VIDEO"||this.inMainView)return;let i;if(e){let d=this._determineInitialLanguage();this.currentLanguage=d,i=this.sources[d]}else i=this.src;let s=this.player.element,a=this.player.state.currentTime,n=this.player.state.playing,o=s.poster||s.getAttribute("poster")||this.player.options.poster,r=a<.1&&!n,c=Array.from(s.querySelectorAll("source")),l=c[0];if(this.mainViewOriginalSrc=s.currentSrc&&s.currentSrc.length>0?s.currentSrc:s.src&&s.src.length>0?s.src:l&&l.getAttribute("src")?l.getAttribute("src"):"",this._mainViewMutedBefore=this.player.state.muted,o&&r&&s.tagName==="VIDEO"&&(s.poster=o),c.length>0){this.mainViewOriginalSources=c,this.mainViewOriginalSources.forEach(y=>y.remove());let d=document.createElement("source");d.setAttribute("src",i);let h=this._inferVideoType(i);h&&d.setAttribute("type",h);let p=s.querySelector("track");p?s.insertBefore(d,p):s.appendChild(d),this._mainViewUsingSourceSwap=!0}else s.src=i,this._mainViewUsingSourceSwap=!1;s.muted=!0,this.player.currentSource=i,typeof this.player.invalidateTrackCache=="function"&&this.player.invalidateTrackCache(),s.load(),await this._waitForMediaReadyMainView(a>0||n),a>0&&(this.player.seek(a),await new Promise(d=>setTimeout(d,100))),n?await this.player.play():(this.player.pause(),!r&&this.player.hidePosterOverlay&&this.player.hidePosterOverlay()),this.inMainView=!0,this.player.state.signLanguageInMainView=!0,this.player.videoWrapper&&this.player.videoWrapper.classList.add("vidply-sign-language-main-view-active"),this.player.emit("signlanguageinmainviewenabled")}async disableInMainView(){var a,n;if(!this.inMainView)return;if(!this.mainViewOriginalSrc&&!this.mainViewOriginalSources){this.inMainView=!1,this.player.state.signLanguageInMainView=!1,this.player.videoWrapper&&this.player.videoWrapper.classList.remove("vidply-sign-language-main-view-active"),this.player.emit("signlanguageinmainviewdisabled");return}let e=this.player.element,t=this.player.state.currentTime,i=this.player.state.playing,s=e.poster||e.getAttribute("poster")||this.player.options.poster;if(this._mainViewUsingSourceSwap&&this.mainViewOriginalSources&&this.mainViewOriginalSources.length>0){Array.from(e.querySelectorAll("source")).forEach(r=>r.remove());let o=e.querySelector("track");this.mainViewOriginalSources.forEach(r=>{o?e.insertBefore(r,o):e.appendChild(r)}),this._mainViewUsingSourceSwap=!1}else this.mainViewOriginalSrc&&(e.src=this.mainViewOriginalSrc);if(e.muted=this._mainViewMutedBefore,this.player.currentSource=this.mainViewOriginalSrc||e.querySelector("source")&&e.querySelector("source").src||"",typeof this.player.invalidateTrackCache=="function"&&this.player.invalidateTrackCache(),e.load(),await this._waitForMediaReadyMainView(t>0||i),t>0&&this.player.seek(t),i)try{await this.player.play()}catch(o){(n=(a=this.player).log)==null||n.call(a,"Sign language main view: play after restore failed",o,"warn")}this.mainViewOriginalSrc=null,this.mainViewOriginalSources=null,this.inMainView=!1,this.player.state.signLanguageInMainView=!1,this.player.videoWrapper&&this.player.videoWrapper.classList.remove("vidply-sign-language-main-view-active"),this.player.emit("signlanguageinmainviewdisabled")}async _waitForMediaReadyMainView(e=!1){let t=this.player.element,i=new Promise(a=>{if(t.readyState>=1){a();return}let n=()=>{t.removeEventListener("loadedmetadata",n),t.removeEventListener("error",o),a()},o=()=>{t.removeEventListener("loadedmetadata",n),t.removeEventListener("error",o),a()};t.addEventListener("loadedmetadata",n),t.addEventListener("error",o,{once:!0})}),s=new Promise(a=>setTimeout(a,1e4));await Promise.race([i,s]),await new Promise(a=>setTimeout(a,300)),e&&await new Promise(a=>{if(t.readyState>=3)a();else{let n=()=>{t.removeEventListener("canplay",n),t.removeEventListener("canplaythrough",n),a()};t.addEventListener("canplay",n,{once:!0}),t.addEventListener("canplaythrough",n,{once:!0}),setTimeout(()=>{t.removeEventListener("canplay",n),t.removeEventListener("canplaythrough",n),a()},3e3)}})}toggleInMainView(){this.inMainView?this.disableInMainView():this.enableInMainView()}switchLanguage(e){if(this.sources[e]){if(this.currentLanguage=e,this.video){let t=this.video.currentTime,i=!this.video.paused;this.video.src=this.sources[e],this.video.currentTime=t,i&&this.video.play().catch(()=>{})}if(this.inMainView&&this.player.element&&this.player.element.tagName==="VIDEO"){let t=this.player.state.currentTime,i=this.player.state.playing;if(this._mainViewUsingSourceSwap){let s=this.player.element.querySelector("source");if(s){s.setAttribute("src",this.sources[e]);let a=this._inferVideoType(this.sources[e]);a&&s.setAttribute("type",a)}}else this.player.element.src=this.sources[e];this.player.currentSource=this.sources[e],typeof this.player.invalidateTrackCache=="function"&&this.player.invalidateTrackCache(),this.player.element.load(),this._waitForMediaReadyMainView(!0).then(()=>{t>0&&this.player.seek(t),i&&this.player.play()})}this.player.emit("signlanguagelanguagechanged",e)}}_inferVideoType(e){if(!e)return"";let t=e.split("?")[0].toLowerCase();return t.endsWith(".mp4")?"video/mp4":t.endsWith(".webm")?"video/webm":t.endsWith(".ogv")||t.endsWith(".ogg")?"video/ogg":""}getLanguageLabel(e){return{en:"English",de:"Deutsch",es:"Español",fr:"Français",it:"Italiano",ja:"日本語",pt:"Português",ar:"العربية",hi:"हिन्दी"}[e]||e.toUpperCase()}_determineInitialLanguage(){var e;if(this.player.captionManager&&this.player.captionManager.currentTrack){let t=(e=this.player.captionManager.currentTrack.language)==null?void 0:e.toLowerCase().split("-")[0];if(t&&this.sources[t])return t}if(this.player.options.language){let t=this.player.options.language.toLowerCase().split("-")[0];if(this.sources[t])return t}return Object.keys(this.sources)[0]}_createWrapper(){this.wrapper=document.createElement("div"),this.wrapper.className="vidply-sign-language-wrapper",this.wrapper.setAttribute("tabindex","0"),this.wrapper.setAttribute("aria-label",m.t("player.signLanguageDragResize"))}_createHeader(e,t){let i=this.player.options.classPrefix;this.header=g.createElement("div",{className:"".concat(i,"-sign-language-header"),attributes:{tabindex:"0"}});let s=g.createElement("div",{className:"".concat(i,"-sign-language-header-left")}),a=g.createElement("h3",{textContent:m.t("player.signLanguageVideo")});this._createSettingsButton(s),e&&this._createLanguageSelector(s,t),s.appendChild(a);let n=this._createCloseButton();this.header.appendChild(s),this.header.appendChild(n),this.settingsMenuVisible=!1,this.settingsMenu=null,this.settingsMenuJustOpened=!1}_createSettingsButton(e){let t=this.player.options.classPrefix,i=m.t("player.signLanguageSettings");this.settingsButton=g.createElement("button",{className:"".concat(t,"-sign-language-settings"),attributes:{type:"button","aria-label":i,"aria-expanded":"false"}}),this.settingsButton.appendChild(T("settings")),g.attachTooltip(this.settingsButton,i,t),this.settingsHandlers={click:s=>{s.preventDefault(),s.stopPropagation(),this.documentClickHandler&&(this.settingsMenuJustOpened=!0,setTimeout(()=>{this.settingsMenuJustOpened=!1},100)),this.settingsMenuVisible?this.hideSettingsMenu():this.showSettingsMenu()},keydown:s=>{s.key==="d"||s.key==="D"?(s.preventDefault(),s.stopPropagation(),this.toggleKeyboardDragMode()):s.key==="r"||s.key==="R"?(s.preventDefault(),s.stopPropagation(),this.toggleResizeMode()):s.key==="Escape"&&this.settingsMenuVisible&&(s.preventDefault(),s.stopPropagation(),this.hideSettingsMenu())}},this.settingsButton.addEventListener("click",this.settingsHandlers.click),this.settingsButton.addEventListener("keydown",this.settingsHandlers.keydown),e.appendChild(this.settingsButton)}_createLanguageSelector(e,t){let i=this.player.options.classPrefix,s="".concat(i,"-sign-language-select-").concat(Date.now()),a=Object.keys(this.sources).map(c=>({value:c,text:this.getLanguageLabel(c),selected:c===t})),{label:n,select:o}=G({classPrefix:i,labelClass:"".concat(i,"-sign-language-label"),selectClass:"".concat(i,"-sign-language-select"),labelText:"settings.language",selectId:s,options:a,onChange:c=>{c.stopPropagation(),this.switchLanguage(c.target.value)}});this.selector=o;let r=g.createElement("div",{className:"".concat(i,"-sign-language-selector-wrapper")});r.appendChild(n),r.appendChild(this.selector),J(r),e.appendChild(r)}_createCloseButton(){let e=this.player.options.classPrefix,t=m.t("player.closeSignLanguage"),i=g.createElement("button",{className:"".concat(e,"-sign-language-close"),attributes:{type:"button","aria-label":t}});return i.appendChild(T("close")),g.attachTooltip(i,t,e),i.addEventListener("click",()=>{var s,a;this.disable(),(a=(s=this.player.controlBar)==null?void 0:s.controls)!=null&&a.signLanguage&&setTimeout(()=>{this.player.controlBar.controls.signLanguage.focus({preventScroll:!0})},0)}),i}_createVideo(e){this.video=document.createElement("video"),this.video.className="vidply-sign-language-video",this.video.src=e,this.video.setAttribute("aria-label",m.t("player.signLanguage")),this.video.muted=!0,this.video.setAttribute("playsinline","")}_createResizeHandles(){let e=this.player.options.classPrefix;this.resizeHandles=["n","s","e","w","ne","nw","se","sw"].map(t=>{let i=g.createElement("div",{className:"".concat(e,"-sign-resize-handle ").concat(e,"-sign-resize-").concat(t),attributes:{"data-direction":t,"data-vidply-managed-resize":"true","aria-hidden":"true"}});return i.style.display="none",i})}_applyInitialSize(){var t;let e=this.player.storage.getSignLanguagePreferences();(t=e==null?void 0:e.size)!=null&&t.width?this.wrapper.style.width=e.size.width:this.wrapper.style.width="280px",this.wrapper.style.height="auto"}_setupInteraction(){var s,a;let e=window.innerWidth<768,t=this.player.state.fullscreen;if(e&&!t&&((a=(s=this.player)==null?void 0:s.options)==null?void 0:a.signLanguageDragOnMobile)===!1){this.draggable&&(this.draggable.destroy(),this.draggable=null);return}if(this.draggable)return;let i=this.player.options.classPrefix;this.draggable=new _(this.wrapper,{dragHandle:this.wrapper,resizeHandles:this.resizeHandles,constrainToViewport:!0,maintainAspectRatio:!0,minWidth:150,minHeight:100,classPrefix:"".concat(i,"-sign"),keyboardDragKey:"d",keyboardResizeKey:"r",keyboardStep:10,keyboardStepLarge:50,pointerResizeIndicatorText:m.t("player.signLanguageResizeActive"),onPointerResizeToggle:n=>{this.resizeHandles.forEach(o=>{o.style.display=n?"block":"none"})},onDragStart:n=>!(n.target.closest(".".concat(i,"-sign-language-close"))||n.target.closest(".".concat(i,"-sign-language-settings"))||n.target.closest(".".concat(i,"-sign-language-select"))||n.target.closest(".".concat(i,"-sign-language-label"))||n.target.closest(".".concat(i,"-sign-language-settings-menu")))}),this._setupCustomKeyHandler(),this.interactionHandlers={draggable:this.draggable,customKeyHandler:this.customKeyHandler}}_setupCustomKeyHandler(){this.customKeyHandler=e=>{var i,s,a,n;let t=e.key.toLowerCase();if(!this.settingsMenuVisible){if(t==="home"){e.preventDefault(),e.stopPropagation(),this.draggable&&(this.draggable.pointerResizeMode&&this.draggable.disablePointerResizeMode(),this.draggable.manuallyPositioned=!1,this.constrainPosition());return}if(t==="r"){e.preventDefault(),e.stopPropagation(),this.toggleResizeMode()&&this.wrapper.focus({preventScroll:!0});return}if(t==="escape"){if(e.preventDefault(),e.stopPropagation(),(i=this.draggable)!=null&&i.pointerResizeMode){this.draggable.disablePointerResizeMode();return}if((s=this.draggable)!=null&&s.keyboardDragMode){this.draggable.disableKeyboardDragMode();return}this.disable(),(n=(a=this.player.controlBar)==null?void 0:a.controls)!=null&&n.signLanguage&&setTimeout(()=>{this.player.controlBar.controls.signLanguage.focus({preventScroll:!0})},0)}}},this.wrapper.addEventListener("keydown",this.customKeyHandler)}_setupEventHandlers(e){this.handlers={play:()=>{this.video&&this.video.play()},pause:()=>{this.video&&this.video.pause()},timeupdate:()=>{this.video&&Math.abs(this.video.currentTime-this.player.state.currentTime)>.5&&(this.video.currentTime=this.player.state.currentTime)},ratechange:()=>{this.video&&(this.video.playbackRate=this.player.state.playbackSpeed)}},this.player.on("play",this.handlers.play),this.player.on("pause",this.handlers.pause),this.player.on("timeupdate",this.handlers.timeupdate),this.player.on("ratechange",this.handlers.ratechange),e&&(this.handlers.captionChange=()=>{var t,i;if((t=this.player.captionManager)!=null&&t.currentTrack&&this.selector){let s=(i=this.player.captionManager.currentTrack.language)==null?void 0:i.toLowerCase().split("-")[0];s&&this.sources[s]&&this.currentLanguage!==s&&(this.switchLanguage(s),this.selector.value=s)}},this.player.on("captionsenabled",this.handlers.captionChange))}constrainPosition(){var b;if(!this.wrapper||!this.player.videoWrapper||(b=this.draggable)!=null&&b.manuallyPositioned)return;this.wrapper.style.width||(this.wrapper.style.width="280px");let e=this.player.videoWrapper.getBoundingClientRect(),t=this.player.container.getBoundingClientRect(),i=this.wrapper.getBoundingClientRect(),s=e.left-t.left,a=e.top-t.top,n=e.width,o=e.height,r=i.width||280,c=i.height||280*9/16,l,d,h=16,p=95;switch(this.desiredPosition||"bottom-right"){case"bottom-right":l=s+n-r-h,d=a+o-c-p;break;case"bottom-left":l=s+h,d=a+o-c-p;break;case"top-right":l=s+n-r-h,d=a+h;break;case"top-left":l=s+h,d=a+h;break;default:l=s+n-r-h,d=a+o-c-p}l=Math.max(s,Math.min(l,s+n-r)),d=Math.max(a,Math.min(d,a+o-c-p)),this.wrapper.style.left="".concat(l,"px"),this.wrapper.style.top="".concat(d,"px"),this.wrapper.style.right="auto",this.wrapper.style.bottom="auto"}showSettingsMenu(){var e;if(this.settingsMenuJustOpened=!0,setTimeout(()=>{this.settingsMenuJustOpened=!1},350),this._addDocumentClickHandler(),this.settingsMenu){this.settingsMenu.style.display="block",this.settingsMenuVisible=!0,(e=this.settingsButton)==null||e.setAttribute("aria-expanded","true"),this._attachMenuKeyboardNavigation(),this._positionSettingsMenu(),this._updateDragOptionState(),this._updateResizeOptionState(),Q(this.settingsMenu,".".concat(this.player.options.classPrefix,"-sign-language-settings-item"));return}this._createSettingsMenu()}hideSettingsMenu({focusButton:e=!0}={}){if(this.settingsMenu){this.settingsMenu.style.display="none",this.settingsMenuVisible=!1,this.settingsMenuJustOpened=!1,this.settingsMenuKeyHandler&&(this.settingsMenu.removeEventListener("keydown",this.settingsMenuKeyHandler),this.settingsMenuKeyHandler=null);let t=this.player.options.classPrefix;Array.from(this.settingsMenu.querySelectorAll(".".concat(t,"-sign-language-settings-item"))).forEach(s=>s.setAttribute("tabindex","-1")),this.settingsButton&&(this.settingsButton.setAttribute("aria-expanded","false"),e&&this.settingsButton.focus({preventScroll:!0}))}}_addDocumentClickHandler(){this.documentClickHandlerAdded||(this.documentClickHandler=e=>{this.settingsMenuJustOpened||this.settingsButton&&(this.settingsButton===e.target||this.settingsButton.contains(e.target))||this.settingsMenu&&this.settingsMenu.contains(e.target)||this.settingsMenuVisible&&this.hideSettingsMenu()},setTimeout(()=>{document.addEventListener("mousedown",this.documentClickHandler,!0),this.documentClickHandlerAdded=!0},300))}_createSettingsMenu(){var a,n;let e=this.player.options.classPrefix;this.settingsMenu=g.createElement("div",{className:"".concat(e,"-sign-language-settings-menu"),attributes:{role:"menu"}});let t=z({classPrefix:e,itemClass:"".concat(e,"-sign-language-settings-item"),icon:"move",label:"player.enableSignDragMode",hasTextClass:!0,onClick:()=>{var o;this.toggleKeyboardDragMode(),this.hideSettingsMenu({focusButton:!1}),(o=this.draggable)!=null&&o.keyboardDragMode&&setTimeout(()=>{var r,c;(c=(r=this.wrapper)==null?void 0:r.focus)==null||c.call(r,{preventScroll:!0})},20)}});t.setAttribute("data-setting","keyboard-drag"),t.setAttribute("role","switch"),t.setAttribute("aria-checked","false"),this._removeTooltipFromMenuItem(t),this.dragOptionButton=t,this.dragOptionText=t.querySelector(".".concat(e,"-settings-text")),this._updateDragOptionState();let i=z({classPrefix:e,itemClass:"".concat(e,"-sign-language-settings-item"),icon:"resize",label:"player.enableSignResizeMode",hasTextClass:!0,onClick:o=>{o.preventDefault(),o.stopPropagation(),this.toggleResizeMode({focus:!1})?(this.hideSettingsMenu({focusButton:!1}),setTimeout(()=>{this.wrapper&&this.wrapper.focus({preventScroll:!0})},20)):this.hideSettingsMenu({focusButton:!0})}});i.setAttribute("role","switch"),i.setAttribute("aria-checked","false"),this._removeTooltipFromMenuItem(i),this.resizeOptionButton=i,this.resizeOptionText=i.querySelector(".".concat(e,"-settings-text")),this._updateResizeOptionState();let s=z({classPrefix:e,itemClass:"".concat(e,"-sign-language-settings-item"),icon:"close",label:"transcript.closeMenu",onClick:()=>this.hideSettingsMenu()});this._removeTooltipFromMenuItem(s),this.settingsMenu.appendChild(t),this.settingsMenu.appendChild(i),this.settingsMenu.appendChild(s),this.settingsMenu.style.visibility="hidden",this.settingsMenu.style.display="block",(a=this.settingsButton)!=null&&a.parentNode?this.settingsButton.insertAdjacentElement("afterend",this.settingsMenu):this.wrapper&&this.wrapper.appendChild(this.settingsMenu),this._positionSettingsMenuImmediate(),requestAnimationFrame(()=>{this.settingsMenu&&(this.settingsMenu.style.visibility="visible")}),this._attachMenuKeyboardNavigation(),this.settingsMenuVisible=!0,(n=this.settingsButton)==null||n.setAttribute("aria-expanded","true"),this._updateDragOptionState(),this._updateResizeOptionState(),Q(this.settingsMenu,".".concat(e,"-sign-language-settings-item"))}_removeTooltipFromMenuItem(e){let t=this.player.options.classPrefix,i=e.querySelector(".".concat(t,"-tooltip"));i&&i.remove();let s=e.querySelector(".".concat(t,"-button-text"));s&&s.remove()}_attachMenuKeyboardNavigation(){this.settingsMenuKeyHandler&&this.settingsMenu.removeEventListener("keydown",this.settingsMenuKeyHandler),this.settingsMenuKeyHandler=I(this.settingsMenu,this.settingsButton,".".concat(this.player.options.classPrefix,"-sign-language-settings-item"),()=>this.hideSettingsMenu({focusButton:!0}))}_positionSettingsMenuImmediate(){if(!this.settingsMenu||!this.settingsButton)return;let e=this.settingsButton.getBoundingClientRect(),t=this.settingsMenu.getBoundingClientRect(),i=window.innerWidth,s=window.innerHeight,a=this.settingsButton.parentElement;if(!a)return;let n=a.getBoundingClientRect(),o=e.left+e.width/2-n.left,r=e.bottom-n.top,c=e.top-n.top,l=e.top,d=s-e.bottom,h=r+8,p=null;d<t.height+20&&l>d?(h=null,p=n.bottom-n.top-c+8,this.settingsMenu.classList.add("vidply-menu-above")):this.settingsMenu.classList.remove("vidply-menu-above");let y=o-t.width/2,b="auto",v="translateX(0)",f=e.left+e.width/2-t.width/2;f<10?y=0:f+t.width>i-10?(y="auto",b=0):(y=o,v="translateX(-50%)"),h!==null?(this.settingsMenu.style.top="".concat(h,"px"),this.settingsMenu.style.bottom="auto"):p!==null&&(this.settingsMenu.style.top="auto",this.settingsMenu.style.bottom="".concat(p,"px")),y!=="auto"?(this.settingsMenu.style.left="".concat(y,"px"),this.settingsMenu.style.right="auto"):(this.settingsMenu.style.left="auto",this.settingsMenu.style.right="".concat(b,"px")),this.settingsMenu.style.transform=v}_positionSettingsMenu(){requestAnimationFrame(()=>{setTimeout(()=>{this._positionSettingsMenuImmediate()},10)})}toggleKeyboardDragMode(){if(this.draggable){let e=this.draggable.keyboardDragMode;this.draggable.toggleKeyboardDragMode();let t=this.draggable.keyboardDragMode;!e&&t&&this._enableMoveMode(),this._updateDragOptionState()}}_enableMoveMode(){this.wrapper.classList.add("".concat(this.player.options.classPrefix,"-sign-move-mode")),this._updateResizeOptionState(),setTimeout(()=>{this.wrapper.classList.remove("".concat(this.player.options.classPrefix,"-sign-move-mode"))},2e3)}toggleResizeMode({focus:e=!0}={}){return this.draggable?this.draggable.pointerResizeMode?(this.draggable.disablePointerResizeMode({focus:e}),this._updateResizeOptionState(),!1):(this.draggable.enablePointerResizeMode({focus:e}),this._updateResizeOptionState(),!0):!1}_updateDragOptionState(){var s;if(!this.dragOptionButton)return;let e=!!((s=this.draggable)!=null&&s.keyboardDragMode),t=e?m.t("player.disableSignDragMode"):m.t("player.enableSignDragMode"),i=e?m.t("player.disableSignDragModeAria"):m.t("player.enableSignDragModeAria");this.dragOptionButton.setAttribute("aria-checked",e?"true":"false"),this.dragOptionButton.setAttribute("aria-label",i),this.dragOptionText&&(this.dragOptionText.textContent=t)}_updateResizeOptionState(){var s;if(!this.resizeOptionButton)return;let e=!!((s=this.draggable)!=null&&s.pointerResizeMode),t=e?m.t("player.disableSignResizeMode"):m.t("player.enableSignResizeMode"),i=e?m.t("player.disableSignResizeModeAria"):m.t("player.enableSignResizeModeAria");this.resizeOptionButton.setAttribute("aria-checked",e?"true":"false"),this.resizeOptionButton.setAttribute("aria-label",i),this.resizeOptionText&&(this.resizeOptionText.textContent=t)}savePreferences(){this.wrapper&&this.player.storage.saveSignLanguagePreferences({size:{width:this.wrapper.style.width}})}updateSources(e,t){this.src=e||null,this.sources=t||{},this.currentLanguage=null}cleanup(){var e;if(this.inMainView&&this.player.element){let t=this.player.element;if(this._mainViewUsingSourceSwap&&this.mainViewOriginalSources&&this.mainViewOriginalSources.length>0){Array.from(t.querySelectorAll("source")).forEach(s=>s.remove());let i=t.querySelector("track");this.mainViewOriginalSources.forEach(s=>{i?t.insertBefore(s,i):t.appendChild(s)}),this._mainViewUsingSourceSwap=!1}else this.mainViewOriginalSrc&&(t.src=this.mainViewOriginalSrc);t.muted=this._mainViewMutedBefore,typeof this.player.invalidateTrackCache=="function"&&this.player.invalidateTrackCache(),t.load(),this.mainViewOriginalSrc=null,this.mainViewOriginalSources=null,this.inMainView=!1,this.player.state.signLanguageInMainView=!1,this.player.videoWrapper&&this.player.videoWrapper.classList.remove("vidply-sign-language-main-view-active"),this.player.emit("signlanguageinmainviewdisabled")}this.settingsMenuVisible&&this.hideSettingsMenu({focusButton:!1}),this.documentClickHandler&&this.documentClickHandlerAdded&&(document.removeEventListener("mousedown",this.documentClickHandler,!0),this.documentClickHandlerAdded=!1,this.documentClickHandler=null),this.settingsHandlers&&this.settingsButton&&(this.settingsButton.removeEventListener("click",this.settingsHandlers.click),this.settingsButton.removeEventListener("keydown",this.settingsHandlers.keydown)),this.settingsHandlers=null,this.handlers&&(this.player.off("play",this.handlers.play),this.player.off("pause",this.handlers.pause),this.player.off("timeupdate",this.handlers.timeupdate),this.player.off("ratechange",this.handlers.ratechange),this.handlers.captionChange&&this.player.off("captionsenabled",this.handlers.captionChange),this.handlers=null),this.wrapper&&this.customKeyHandler&&this.wrapper.removeEventListener("keydown",this.customKeyHandler),this.draggable&&(this.draggable.pointerResizeMode&&this.draggable.disablePointerResizeMode(),this.draggable.destroy(),this.draggable=null),this.interactionHandlers=null,(e=this.wrapper)!=null&&e.parentNode&&(this.video&&(this.video.pause(),this.video.src=""),this.wrapper.parentNode.removeChild(this.wrapper)),this.wrapper=null,this.video=null,this.settingsButton=null,this.settingsMenu=null}destroy(){this.cleanup(),this.enabled=!1}};var it=0,Z=class u extends se{constructor(e,t={}){if(super(),this.element=typeof e=="string"?document.querySelector(e):e,!this.element)throw new Error("VidPly: Element not found");if(it++,this.instanceId=it,this.element.tagName!=="VIDEO"&&this.element.tagName!=="AUDIO"){let s=t.mediaType||"video",a=document.createElement(s);Array.from(this.element.attributes).forEach(o=>{o.name!=="id"&&o.name!=="class"&&!o.name.startsWith("data-")&&a.setAttribute(o.name,o.value)}),this.element.querySelectorAll("track").forEach(o=>{a.appendChild(o.cloneNode(!0))}),this.element.innerHTML="",this.element.appendChild(a),this.element=a}this._originalElement=this.element,this.options=V({width:null,height:null,poster:null,responsive:!0,fillContainer:!1,autoplay:!1,loop:!1,muted:!1,volume:.8,playbackSpeed:1,preload:"metadata",initialDuration:0,deferLoad:!1,requirePlaybackForAccessibilityToggles:!1,startTime:0,playsInline:!0,controls:!0,hideControlsDelay:3e3,playPauseButton:!0,progressBar:!0,currentTime:!0,duration:!0,volumeControl:!0,muteButton:!0,chaptersButton:!0,qualityButton:!0,captionStyleButton:!0,speedButton:!0,hideSpeedForHls:!1,hideSpeedForHlsVideo:!1,captionsButton:!0,transcriptButton:!0,fullscreenButton:!0,pipButton:!1,seekInterval:10,seekIntervalLarge:30,captions:!0,captionsDefault:!1,captionsFontSize:"100%",captionsFontFamily:"sans-serif",captionsColor:"#FFFFFF",captionsBackgroundColor:"#000000",captionsOpacity:.8,audioDescription:!0,audioDescriptionSrc:null,audioDescriptionButton:!0,signLanguage:!0,signLanguageSrc:null,signLanguageButton:!0,signLanguagePosition:"bottom-right",signLanguageDisplayMode:"both",transcript:!1,transcriptPosition:"external",transcriptContainer:null,keyboard:!0,keyboardShortcuts:{"play-pause":[" ","p","k"],"volume-up":["ArrowUp"],"volume-down":["ArrowDown"],"seek-forward":["ArrowRight"],"seek-backward":["ArrowLeft"],mute:["m"],fullscreen:["f"],captions:["c"],"caption-style-menu":["a"],"speed-up":[">"],"speed-down":["<"],"speed-menu":["s"],"quality-menu":["q"],"chapters-menu":["j"],"transcript-toggle":["t"]},ariaLabels:{},screenReaderAnnouncements:!0,highContrast:!1,focusHighlight:!0,metadataAlerts:{},metadataHashtags:{},language:"en",languages:["en"],debug:!1,classPrefix:"vidply",iconType:"svg",pauseOthersOnPlay:!0,onReady:null,onPlay:null,onPause:null,onEnded:null,onTimeUpdate:null,onVolumeChange:null,onError:null},t),this.options.metadataAlerts=this.options.metadataAlerts||{},this.options.metadataHashtags=this.options.metadataHashtags||{},this.noticeElement=null,this.noticeTimeout=null,this.storage=new W("vidply");let i=this.storage.getPlayerPreferences();i&&(i.volume!==void 0&&(this.options.volume=i.volume),i.playbackSpeed!==void 0&&(this.options.playbackSpeed=i.playbackSpeed),i.muted!==void 0&&(this.options.muted=i.muted)),this.state={ready:!1,playing:!1,paused:!0,ended:!1,buffering:!1,seeking:!1,hasStartedPlayback:!1,muted:this.options.muted,volume:this.options.volume,currentTime:0,duration:Number(this.options.initialDuration)>0?Number(this.options.initialDuration):0,playbackSpeed:this.options.playbackSpeed,fullscreen:!1,pip:!1,captionsEnabled:this.options.captionsDefault,currentCaption:null,controlsVisible:!0,audioDescriptionEnabled:!1,signLanguageEnabled:!1,signLanguageInMainView:!1},this.originalSrc=null,this.audioDescriptionSrc=this.options.audioDescriptionSrc,this.signLanguageSrc=this.options.signLanguageSrc,this.signLanguageSources=this.options.signLanguageSources||{},this.currentSignLanguage=null,this.signLanguageVideo=null,this.audioDescriptionSourceElement=null,this.originalAudioDescriptionSource=null,this.audioDescriptionCaptionTracks=[],this._audioDescriptionDesiredState=!1,this._textTracksCache=null,this._textTracksDirty=!0,this._sourceElementsCache=null,this._sourceElementsDirty=!0,this._trackElementsCache=null,this._trackElementsDirty=!0,this.timeouts=new Set,this.container=null,this.renderer=null,this.controlBar=null,this.captionManager=null,this.keyboardManager=null,this.settingsDialog=null,this.metadataCueChangeHandler=null,this.metadataAlertHandlers=new Map,this.audioDescriptionManager=new ge(this),this.signLanguageManager=new me(this),Object.defineProperties(this,{signLanguageWrapper:{get:()=>this.signLanguageManager.wrapper,set:s=>{this.signLanguageManager.wrapper=s}},signLanguageVideo:{get:()=>this.signLanguageManager.video,set:s=>{this.signLanguageManager.video=s}},signLanguageHeader:{get:()=>this.signLanguageManager.header,set:s=>{this.signLanguageManager.header=s}},signLanguageSettingsButton:{get:()=>this.signLanguageManager.settingsButton,set:s=>{this.signLanguageManager.settingsButton=s}},signLanguageSettingsMenu:{get:()=>this.signLanguageManager.settingsMenu,set:s=>{this.signLanguageManager.settingsMenu=s}},signLanguageSettingsMenuVisible:{get:()=>this.signLanguageManager.settingsMenuVisible,set:s=>{this.signLanguageManager.settingsMenuVisible=s}},signLanguageDraggable:{get:()=>this.signLanguageManager.draggable,set:s=>{this.signLanguageManager.draggable=s}},currentSignLanguage:{get:()=>this.signLanguageManager.currentLanguage,set:s=>{this.signLanguageManager.currentLanguage=s}}}),this.init()}showNotice(e,{timeout:t=2500,priority:i="polite"}={}){var s;try{if(!e||!this.container)return;if((s=this.keyboardManager)!=null&&s.announce&&this.keyboardManager.announce(e,i),!this.noticeElement){let a=document.createElement("div");a.className="".concat(this.options.classPrefix,"-notice"),a.setAttribute("role","status"),a.setAttribute("aria-live",i),a.setAttribute("aria-atomic","true"),a.style.position="absolute",a.style.left="0.75rem",a.style.right="0.75rem",a.style.top="0.75rem",a.style.zIndex="9999",a.style.padding="0.5rem 0.75rem",a.style.borderRadius="0.5rem",a.style.background="rgba(0, 0, 0, 0.75)",a.style.color="#fff",a.style.fontSize="0.875rem",a.style.lineHeight="1.3",a.style.pointerEvents="none",this.noticeElement=a,this.container.appendChild(a)}this.noticeElement.textContent=e,this.noticeElement.style.display="block",this.noticeTimeout&&(clearTimeout(this.noticeTimeout),this.noticeTimeout=null),this.noticeTimeout=setTimeout(()=>{this.noticeElement&&(this.noticeElement.style.display="none")},t)}catch(a){}}async init(){var e;try{if(this.log("Initializing VidPly player"),this.options.languageFiles)try{await m.loadLanguagesFromUrls(this.options.languageFiles)}catch(i){console.warn("Failed to load some language files:",i)}if(this.options.languageFile&&this.options.languageFileUrl)try{await m.loadLanguageFromUrl(this.options.languageFile,this.options.languageFileUrl),this.log("Custom language file loaded for ".concat(this.options.languageFile))}catch(i){console.warn("Failed to load language file for ".concat(this.options.languageFile,":"),i)}if(!this.options.language||this.options.language==="en"){let i=this.detectHtmlLanguage();i&&(this.options.language=i,this.log("Auto-detected language from HTML: ".concat(i)))}this.options.language||(this.options.language="en"),await m.ensureLanguage(this.options.language),m.setLanguage(this.options.language),this.createContainer(),this.element.src||((e=this.element.querySelector("source"))==null?void 0:e.src)?await this.initializeRenderer():this.log("No initial source - waiting for playlist or manual load"),this.options.controls&&(this.controlBar=new le(this),this.videoWrapper.appendChild(this.controlBar.element)),this.options.captions&&(this.captionManager=new U(this)),this.options.transcript&&await this.ensureTranscriptManager(),this.setupMetadataHandling(),this.options.keyboard&&(this.keyboardManager=new de(this)),this.setupResponsiveHandlers(),this.options.startTime>0&&this.seek(this.options.startTime),requestAnimationFrame(()=>{this.options.muted?this.mute():this.renderer&&this.renderer.media&&this.renderer.setMuted(!1),this.options.volume!==.8?this.setVolume(this.options.volume):this.renderer&&this.renderer.media&&this.renderer.setVolume(this.options.volume)}),this.state.ready=!0,this.emit("ready"),this.options.onReady&&this.options.onReady.call(this),this.options.autoplay&&this.play(),this.log("Player initialized successfully")}catch(t){this.handleError(t)}}async ensureTranscriptManager(){if(this.transcriptManager)return this.transcriptManager;if(!this.options.transcript&&!this.options.transcriptButton)return null;let e=await Promise.resolve().then(()=>(je(),Ke)),t=e.TranscriptManager||e.default;return t?(this.transcriptManager=new t(this),this.transcriptManager):null}async toggleTranscript(){let e=await this.ensureTranscriptManager();e&&(e.toggleTranscript(),this.controlBar&&this.controlBar.updateTranscriptButton())}detectHtmlLanguage(){let e=document.documentElement.lang||document.documentElement.getAttribute("lang");if(!e)return null;let t=e.toLowerCase().split("-")[0];return m.translations[t]||m.builtInLanguageLoaders&&m.builtInLanguageLoaders[t]?t:(this.log('Language "'.concat(e,'" not available, using English as fallback')),null)}createContainer(){let e=this.instanceId>1?"".concat(m.t("player.label")," ").concat(this.instanceId):m.t("player.label");this.container=g.createElement("div",{className:"".concat(this.options.classPrefix,"-player"),attributes:{role:"application","aria-label":e,tabindex:"0"}});let t=this.element.tagName.toLowerCase();if(this.container.classList.add("".concat(this.options.classPrefix,"-").concat(t)),this.options.responsive&&this.container.classList.add("".concat(this.options.classPrefix,"-responsive")),this.videoWrapper=g.createElement("div",{className:"".concat(this.options.classPrefix,"-video-wrapper")}),this.element.parentNode.insertBefore(this.container,this.element),this.element.tagName==="AUDIO"&&this.options.poster&&(this.trackArtworkElement=g.createElement("div",{className:"".concat(this.options.classPrefix,"-track-artwork"),attributes:{"aria-hidden":"true"}}),this.trackArtworkElement.style.backgroundImage="url(".concat(this.options.poster,")"),this.container.appendChild(this.trackArtworkElement)),this.container.appendChild(this.videoWrapper),this.videoWrapper.appendChild(this.element),this.element.controls=!1,this.element.removeAttribute("controls"),this.element.setAttribute("tabindex","-1"),this.element.style.width="100%",this.element.style.height="100%",this.element.tagName==="VIDEO"&&this.options.playsInline&&(this.element.setAttribute("playsinline",""),this.element.playsInline=!0),this.options.width&&(this.container.style.width=typeof this.options.width=="number"?"".concat(this.options.width,"px"):this.options.width),this.options.height&&(this.container.style.height=typeof this.options.height=="number"?"".concat(this.options.height,"px"):this.options.height),this.options.poster&&this.element.tagName==="VIDEO"){let i=this.resolvePosterPath(this.options.poster);this.element.poster=i}this.element.tagName==="VIDEO"&&this.createPlayButtonOverlay(),this.element.vidply=this,u.instances.push(this),this.element.style.cursor="pointer",this.element.addEventListener("click",i=>{i.target===this.element&&this.toggle()}),this.on("play",()=>{this.state.hasStartedPlayback=!0,this.hidePosterOverlay()}),this.on("timeupdate",()=>{this.state.currentTime>0&&this.hidePosterOverlay()}),this.element.addEventListener("loadeddata",()=>{(this.state.playing||this.state.currentTime>0)&&this.hidePosterOverlay()},{once:!0})}createPlayButtonOverlay(){this.playButtonOverlay=_e(),this.playButtonOverlay.addEventListener("click",()=>{this.toggle()}),this.videoWrapper.appendChild(this.playButtonOverlay),this.on("play",()=>{this.playButtonOverlay.style.opacity="0",this.playButtonOverlay.style.pointerEvents="none"}),this.on("pause",()=>{this.playButtonOverlay.style.opacity="1",this.playButtonOverlay.style.pointerEvents="auto",this.positionPlayOverlayOnMobile()}),this.on("ended",()=>{this.playButtonOverlay.style.opacity="1",this.playButtonOverlay.style.pointerEvents="auto",this.positionPlayOverlayOnMobile()}),this.debouncedPositionPlayOverlay=re(()=>{this.positionPlayOverlayOnMobile()},150),window.addEventListener("resize",this.debouncedPositionPlayOverlay),this.on("loadedmetadata",()=>{this.positionPlayOverlayOnMobile()}),this.on("enterfullscreen",()=>{Y(()=>this.positionPlayOverlayOnMobile(),100)}),this.on("exitfullscreen",()=>{Y(()=>this.positionPlayOverlayOnMobile(),100)})}positionPlayOverlayOnMobile(){if(!this.playButtonOverlay||this.element.tagName!=="VIDEO")return;if(!X()){this.playButtonOverlay.style.top="";return}let t=this.element.getBoundingClientRect(),i=this.videoWrapper.getBoundingClientRect(),s=t.top-i.top+t.height/2;this.playButtonOverlay.style.top="".concat(s,"px")}async initializeRenderer(){var i;let e=this._pendingSource||this.element.src||((i=this.element.querySelector("source"))==null?void 0:i.src);if(!e)throw new Error("No media source found");this.currentSource=e,this._pendingSource=null,this.audioDescriptionManager.initFromSourceElements(this.sourceElements,this.trackElements),this.originalSrc||(this.originalSrc=e);let t=te;if(e.includes("youtube.com")||e.includes("youtu.be")){let s=await Promise.resolve().then(()=>(Ye(),Xe));t=s.YouTubeRenderer||s.default}else if(e.includes("vimeo.com")){let s=await Promise.resolve().then(()=>(Ge(),Qe));t=s.VimeoRenderer||s.default}else if(e.includes(".m3u8")){let s=await Promise.resolve().then(()=>(Ze(),Je));t=s.HLSRenderer||s.default}else if(e.includes("soundcloud.com")||e.includes("api.soundcloud.com")){let s=await Promise.resolve().then(()=>(tt(),et));t=s.SoundCloudRenderer||s.default}this.log("Using ".concat((t==null?void 0:t.name)||"HTML5Renderer"," renderer")),this.renderer=new t(this),await this.renderer.init(),this.invalidateTrackCache()}get textTracks(){return(!this._textTracksCache||this._textTracksDirty)&&(this._textTracksCache=Array.from(this.element.textTracks||[]),this._textTracksDirty=!1),this._textTracksCache}get sourceElements(){return(!this._sourceElementsCache||this._sourceElementsDirty)&&(this._sourceElementsCache=Array.from(this.element.querySelectorAll("source")),this._sourceElementsDirty=!1),this._sourceElementsCache}get trackElements(){return(!this._trackElementsCache||this._trackElementsDirty)&&(this._trackElementsCache=Array.from(this.element.querySelectorAll("track")),this._trackElementsDirty=!1),this._trackElementsCache}invalidateTrackCache(){this._textTracksDirty=!0,this._trackElementsDirty=!0,this._sourceElementsDirty=!0}findTextTrack(e,t=null){let i=this.textTracks;return t?i.find(s=>s.kind===e&&s.language===t):i.find(s=>s.kind===e)}findSourceElement(e,t=null){let i=this.sourceElements;return t?i.find(s=>s.getAttribute(e)===t):i.find(s=>s.hasAttribute(e))}findTrackElement(e){return this.trackElements.find(t=>t.track===e)}resolvePosterPath(e){if(!e||e.match(/^(https?:|\/)/))return e;try{return new URL(e,window.location.href).href}catch(t){return e}}async generatePosterFromVideo(e=10){if(this.element.tagName!=="VIDEO")return null;let t=this.renderer;if(!t||!t.media||t.media.tagName!=="VIDEO")return null;let i=t.media;(!i.duration||i.duration<e)&&(e=Math.min(e,Math.max(1,i.duration*.1)));let s=i;return this.controlBar&&this.controlBar.previewVideo&&this.controlBar.previewSupported&&(s=this.controlBar.previewVideo),await oe(s,e,{restoreState:s===i,quality:.9})}async autoGeneratePoster(){if(this.element.getAttribute("poster")||this.element.poster||this.options.poster||this.element.tagName!=="VIDEO")return;(!this.state.duration||this.state.duration===0)&&await new Promise(i=>{let s=()=>{this.element.removeEventListener("loadedmetadata",s),i()};this.element.readyState>=1?i():this.element.addEventListener("loadedmetadata",s)});let t=await this.generatePosterFromVideo(10);t&&(this.element.poster=t,this.log("Auto-generated poster from video frame at 10 seconds","info"),this.showPosterOverlay())}showPosterOverlay(){if(!this.videoWrapper||this.element.tagName!=="VIDEO")return;let e=this.element.getAttribute("poster")||this.element.poster||this.options.poster;if(!e)return;let t=e.startsWith("data:")?e:this.resolvePosterPath(e);this.videoWrapper.style.setProperty("--vidply-poster-image",'url("'.concat(t,'")')),this.videoWrapper.classList.add("vidply-forced-poster"),this._isAudioContent&&this.container?this.container.classList.add("vidply-audio-content"):this.container&&this.container.classList.remove("vidply-audio-content")}hidePosterOverlay(){this.videoWrapper&&(this.videoWrapper.classList.remove("vidply-forced-poster"),this.videoWrapper.style.removeProperty("--vidply-poster-image"))}setManagedTimeout(e,t){let i=setTimeout(()=>{this.timeouts.delete(i),e()},t);return this.timeouts.add(i),i}clearManagedTimeout(e){e&&(clearTimeout(e),this.timeouts.delete(e))}isExternalRendererUrl(e){return e?e.includes("youtube.com")||e.includes("youtu.be")||e.includes("vimeo.com")||e.includes("soundcloud.com")||e.includes("api.soundcloud.com")||e.includes(".m3u8"):!1}async load(e){var t;try{this.log("Loading new media:",e.src),this.renderer&&this.pause();let i=window.scrollX||window.pageXOffset,s=window.scrollY||window.pageYOffset;this.trackElements.forEach(l=>l.remove()),this.invalidateTrackCache();let n=this.isExternalRendererUrl(e.src);if(n&&(this._switchingRenderer=!0),n?(this.element.removeAttribute("src"),this.element.querySelectorAll("source").forEach(d=>d.removeAttribute("src"))):(this.element.src=e.src,e.type&&(this.element.type=e.type)),this._pendingSource=e.src,this._isAudioContent=e.type&&e.type.startsWith("audio/"),this.container&&(this._isAudioContent?this.container.classList.add("vidply-audio-content"):this.container.classList.remove("vidply-audio-content")),e.poster&&this.element.tagName==="VIDEO")if(this._isAudioContent){if(this.element.removeAttribute("poster"),this.videoWrapper){let l=this.resolvePosterPath(e.poster);this.videoWrapper.style.setProperty("--vidply-poster-image",'url("'.concat(l,'")')),this.videoWrapper.classList.add("vidply-forced-poster")}}else this.element.poster=this.resolvePosterPath(e.poster),this.videoWrapper&&(this.videoWrapper.classList.remove("vidply-forced-poster"),this.videoWrapper.style.removeProperty("--vidply-poster-image"));e.tracks&&e.tracks.length>0&&(e.tracks.forEach(l=>{let d=document.createElement("track");d.src=l.src,d.kind=l.kind||"captions",d.srclang=l.srclang||"en",d.label=l.label||l.srclang,l.default&&(d.default=!0),l.describedSrc&&d.setAttribute("data-desc-src",l.describedSrc);let h=this.element.firstChild;h&&h.nodeType===Node.ELEMENT_NODE&&h.tagName!=="TRACK"?this.element.insertBefore(d,h):this.element.appendChild(d)}),this.invalidateTrackCache());let o=this.state.signLanguageEnabled,r=this.state.audioDescriptionEnabled;this.audioDescriptionSrc=e.audioDescriptionSrc||null,this.signLanguageSrc=e.signLanguageSrc||null,this.originalSrc=e.src,this.audioDescriptionManager&&(this.audioDescriptionManager.updateSources(e.audioDescriptionSrc),this.audioDescriptionManager.reinitialize()),this.signLanguageManager&&this.signLanguageManager.updateSources(e.signLanguageSrc,e.signLanguageSources),r&&this.disableAudioDescription(),o&&this.disableSignLanguage();let c=this.shouldChangeRenderer(e.src);if(c&&this.renderer&&(this.renderer.destroy(),this.renderer=null),!this.renderer||c)await this.initializeRenderer();else if(this.renderer.media=this.element,this.options.deferLoad){try{this.element.preload=this.options.preload||"metadata"}catch(l){}this.renderer&&(typeof this.renderer._didDeferredLoad=="boolean"&&(this.renderer._didDeferredLoad=!1),typeof this.renderer._hlsSourceLoaded=="boolean"&&(this.renderer._hlsSourceLoaded=!1),"_pendingSrc"in this.renderer&&(this.renderer._pendingSrc=this._pendingSource||this.currentSource||null))}else this.element.load();if(n?setTimeout(()=>{this._switchingRenderer=!1},500):this._switchingRenderer=!1,window.scrollTo(i,s),this.captionManager&&(this.captionManager.destroy(),this.captionManager=new U(this)),this.transcriptManager){let l=this.transcriptManager.isVisible;this.transcriptManager.destroy(),this.transcriptManager=null,await this.ensureTranscriptManager(),l&&this.controlBar&&this.controlBar.hasCaptionTracks()&&((t=this.transcriptManager)==null||t.showTranscript())}this.controlBar&&this.updateControlBar(),window.scrollTo(i,s),o&&this.signLanguageSrc&&setTimeout(()=>{this.enableSignLanguage(),window.scrollTo(i,s)},150),r&&this.audioDescriptionSrc&&setTimeout(()=>{this.enableAudioDescription(),window.scrollTo(i,s)},150),this.emit("sourcechange",e),this.log("Media loaded successfully")}catch(i){this.handleError(i)}}ensureLoaded(){try{if(!this.renderer)return;typeof this.renderer.ensureLoaded=="function"&&this.renderer.ensureLoaded()}catch(e){}}updateControlBar(){if(!this.controlBar)return;let e=this.controlBar;e.element.innerHTML="",e.createControls(),e.attachEvents(),e.setupAutoHide(),e.setupOverflowDetection()}shouldChangeRenderer(e){if(!this.renderer)return!0;let t=e.includes("youtube.com")||e.includes("youtu.be"),i=e.includes("vimeo.com"),s=e.includes(".m3u8"),a=e.includes("soundcloud.com")||e.includes("api.soundcloud.com"),n=this.renderer.constructor.name;return!!(t&&n!=="YouTubeRenderer"||i&&n!=="VimeoRenderer"||s&&n!=="HLSRenderer"||a&&n!=="SoundCloudRenderer"||!t&&!i&&!s&&!a&&n!=="HTML5Renderer")}play(){if(this.renderer){this.renderer.play();return}if(this.playlistManager&&Array.isArray(this.playlistManager.tracks)&&this.playlistManager.tracks.length>0){let e=this.playlistManager.currentIndex>=0?this.playlistManager.currentIndex:0;this.playlistManager.play(e,!0)}}pause(){this.renderer&&this.renderer.pause()}stop(){this.pause(),this.seek(0)}toggle(){this.state.playing?this.pause():this.play()}seek(e){this.renderer&&this.renderer.seek(e)}seekForward(e=this.options.seekInterval){this.seek(Math.min(this.state.currentTime+e,this.state.duration))}seekBackward(e=this.options.seekInterval){this.seek(Math.max(this.state.currentTime-e,0))}setVolume(e){let t=Math.max(0,Math.min(1,e));this.renderer&&this.renderer.setVolume(t),this.state.volume=t,t>0&&this.state.muted&&(this.state.muted=!1,this.renderer&&this.renderer.setMuted(!1),this.emit("volumechange")),this.savePlayerPreferences()}getVolume(){return this.state.volume}mute(){this.renderer&&this.renderer.setMuted(!0),this.state.muted=!0,this.savePlayerPreferences(),this.emit("volumechange")}unmute(){this.renderer&&this.renderer.setMuted(!1),this.state.muted=!1,this.savePlayerPreferences(),this.emit("volumechange")}toggleMute(){this.state.muted?this.unmute():this.mute()}setPlaybackSpeed(e){let t=Math.max(.25,Math.min(2,e));this.renderer&&this.renderer.setPlaybackSpeed(t),this.state.playbackSpeed=t,this.savePlayerPreferences(),this.emit("playbackspeedchange",t)}getPlaybackSpeed(){return this.state.playbackSpeed}savePlayerPreferences(){this.storage.savePlayerPreferences({volume:this.state.volume,muted:this.state.muted,playbackSpeed:this.state.playbackSpeed})}enterFullscreen(){let e=this.container,t=null;if(/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1){this._enablePseudoFullscreen();return}e.requestFullscreen?t=e.requestFullscreen():e.webkitRequestFullscreen?t=e.webkitRequestFullscreen():e.mozRequestFullScreen?t=e.mozRequestFullScreen():e.msRequestFullscreen&&(t=e.msRequestFullscreen()),t&&t.catch&&t.catch(s=>{this.log("Fullscreen API failed, using pseudo-fullscreen:",s.message),this._enablePseudoFullscreen()}),!e.requestFullscreen&&!e.webkitRequestFullscreen&&!e.mozRequestFullScreen&&!e.msRequestFullscreen?this._enablePseudoFullscreen():(this.state.fullscreen=!0,this.container.classList.add("".concat(this.options.classPrefix,"-fullscreen")),this.emit("fullscreenchange",!0))}exitFullscreen(){!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():this._disablePseudoFullscreen(),this.state.fullscreen=!1,this.container.classList.remove("".concat(this.options.classPrefix,"-fullscreen")),this.emit("fullscreenchange",!1)}toggleFullscreen(){this.state.fullscreen?this.exitFullscreen():this.enterFullscreen()}_enablePseudoFullscreen(){var t;this.state.fullscreen=!0,this.container.classList.add("".concat(this.options.classPrefix,"-fullscreen")),document.body.classList.add("vidply-fullscreen-active"),this._originalScrollX=window.scrollX||window.pageXOffset,this._originalScrollY=window.scrollY||window.pageYOffset,this._originalBodyOverflow=document.body.style.overflow,this._originalBodyPosition=document.body.style.position,this._originalBodyWidth=document.body.style.width,this._originalBodyHeight=document.body.style.height,this._originalHtmlOverflow=document.documentElement.style.overflow,this._originalBodyBackground=document.body.style.background,this._originalHtmlBackground=document.documentElement.style.background,document.body.style.overflow="hidden",document.body.style.width="100%",document.body.style.height="100%",document.body.style.background="#000",document.documentElement.style.overflow="hidden",document.documentElement.style.background="#000",this._originalViewport=(t=document.querySelector('meta[name="viewport"]'))==null?void 0:t.getAttribute("content");let e=document.querySelector('meta[name="viewport"]');e&&e.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"),window.scrollTo(0,0),this._makeBackgroundInert(),this.emit("fullscreenchange",!0),this.emit("enterfullscreen")}_makeBackgroundInert(){this._inertElements=[];let e=this.container;for(;e&&e!==document.body&&e!==document.documentElement;){let t=e.parentElement;t&&Array.from(t.children).forEach(i=>{i!==e&&i.nodeType===Node.ELEMENT_NODE&&!i.hasAttribute("inert")&&i.tagName!=="SCRIPT"&&i.tagName!=="STYLE"&&i.tagName!=="LINK"&&i.tagName!=="META"&&(i.setAttribute("inert",""),this._inertElements.push(i))}),e=t}}_restoreBackgroundInteractivity(){this._inertElements&&(this._inertElements.forEach(e=>{e.removeAttribute("inert")}),this._inertElements=[])}_disablePseudoFullscreen(){if(document.body.classList.remove("vidply-fullscreen-active"),this._restoreBackgroundInteractivity(),this._originalBodyOverflow!==void 0&&(document.body.style.overflow=this._originalBodyOverflow,delete this._originalBodyOverflow),this._originalBodyPosition!==void 0&&(document.body.style.position=this._originalBodyPosition,delete this._originalBodyPosition),this._originalBodyWidth!==void 0&&(document.body.style.width=this._originalBodyWidth,delete this._originalBodyWidth),this._originalBodyHeight!==void 0&&(document.body.style.height=this._originalBodyHeight,delete this._originalBodyHeight),this._originalHtmlOverflow!==void 0&&(document.documentElement.style.overflow=this._originalHtmlOverflow,delete this._originalHtmlOverflow),this._originalBodyBackground!==void 0&&(document.body.style.background=this._originalBodyBackground,delete this._originalBodyBackground),this._originalHtmlBackground!==void 0&&(document.documentElement.style.background=this._originalHtmlBackground,delete this._originalHtmlBackground),this._originalViewport!==void 0){let e=document.querySelector('meta[name="viewport"]');e&&e.setAttribute("content",this._originalViewport),delete this._originalViewport}this._originalScrollX!==void 0&&this._originalScrollY!==void 0&&(window.scrollTo(this._originalScrollX,this._originalScrollY),delete this._originalScrollX,delete this._originalScrollY),this.emit("exitfullscreen")}enterPiP(){this.element.requestPictureInPicture&&(this.element.requestPictureInPicture(),this.state.pip=!0,this.emit("pipchange",!0))}exitPiP(){document.pictureInPictureElement&&(document.exitPictureInPicture(),this.state.pip=!1,this.emit("pipchange",!1))}togglePiP(){this.state.pip?this.exitPiP():this.enterPiP()}enableCaptions(){this.captionManager&&(this.captionManager.enable(),this.state.captionsEnabled=!0)}disableCaptions(){this.captionManager&&(this.captionManager.disable(),this.state.captionsEnabled=!1)}toggleCaptions(){this.state.captionsEnabled?this.disableCaptions():this.enableCaptions()}async validateTrackExists(e){try{return(await fetch(e,{method:"HEAD",cache:"no-cache"})).ok}catch(t){return!1}}stripVTTFormatting(e){return e?e.replace(/<[^>]+>/g,"").replace(/\n/g," ").trim().toLowerCase():""}findMatchingCaptionTime(e,t){if(!e||!t||t.length===0)return null;let i=this.stripVTTFormatting(e);for(let s of t){if(s.kind!=="captions"&&s.kind!=="subtitles")continue;let a=s.track;if(!(!a||!a.cues))for(let n=0;n<a.cues.length;n++){let o=a.cues[n],r=this.stripVTTFormatting(o.text);if(r===i)return o.startTime;let c=i.split(/\s+/).filter(d=>d.length>2),l=r.split(/\s+/).filter(d=>d.length>2);if(c.length>0&&l.length>0&&c.filter(p=>l.includes(p)).length/c.length>=.8)return o.startTime}}return null}async enableAudioDescription(){return this.audioDescriptionManager.enable()}async _legacyEnableAudioDescription(){let e=this.sourceElements.some(l=>l.getAttribute("data-desc-src")),t=this.audioDescriptionCaptionTracks.length>0;if(!this.audioDescriptionSrc&&!e&&!t){console.warn("VidPly: No audio description source, source elements, or tracks provided");return}let i=this.element.currentTime,s=this.state.playing,a=!s&&i===0,n=null;if(this.captionManager&&this.captionManager.currentTrack){let l=this.captionManager.currentTrack.track;if(l&&l.activeCues&&l.activeCues.length>0){let d=l.activeCues[0];n=this.stripVTTFormatting(d.text)}}let o=this.resolvePosterPath(this.element.getAttribute("poster")||this.element.poster||this.options.poster);a&&this.showPosterOverlay();let r=[];if(this.audioDescriptionSourceElement){let l=this.element.currentSrc||this.element.src,d=this.sourceElements,h=null,p=this.audioDescriptionSrc;for(let w of d){let S=w.getAttribute("src"),P=w.getAttribute("data-desc-src"),M=S?S.split("/").pop():"",E=l?l.split("/").pop():"";if(l&&(l===S||l.includes(S)||l.includes(M)||M&&E===M)){h=w,P?p=P:S&&(p=this.audioDescriptionSrc||p);break}}if(!h){h=this.audioDescriptionSourceElement;let w=h.getAttribute("data-desc-src");w&&(p=w)}if(this.audioDescriptionCaptionTracks.length>0){let w=this.audioDescriptionCaptionTracks.map(async M=>{if(M.trackElement&&M.describedSrc)if(M.explicit===!0)try{let E=await this.validateTrackExists(M.describedSrc);return{trackInfo:M,exists:E}}catch(E){return{trackInfo:M,exists:!1}}else return{trackInfo:M,exists:!1};return{trackInfo:M,exists:!1}}),S=await Promise.all(w),P=S.filter(M=>M.exists);if(P.length>0){let M=new Map;P.forEach(({trackInfo:x})=>{let R=x.trackElement.track;R?M.set(x,{wasShowing:R.mode==="showing",wasHidden:R.mode==="hidden"}):M.set(x,{wasShowing:!1,wasHidden:!1})});let E=P.map(({trackInfo:x})=>{let R=x.trackElement.getAttribute("src"),B=x.trackElement.parentNode,K=x.trackElement.nextSibling,k={};return Array.from(x.trackElement.attributes).forEach($=>{k[$.name]=$.value}),{trackInfo:x,oldSrc:R,parent:B,nextSibling:K,attributes:k}});E.forEach(({trackInfo:x})=>{x.trackElement.remove()}),this.element.load(),await new Promise(x=>{setTimeout(()=>{E.forEach(({trackInfo:B,oldSrc:K,parent:k,nextSibling:$,attributes:j})=>{r.push(B);let ee=document.createElement("track");ee.setAttribute("src",B.describedSrc),Object.keys(j).forEach(ie=>{ie!=="src"&&ie!=="data-desc-src"&&ee.setAttribute(ie,j[ie])}),$&&$.parentNode?k.insertBefore(ee,$):k.appendChild(ee),B.trackElement=ee}),this.invalidateTrackCache();let R=()=>{this.setManagedTimeout(()=>{r.forEach(B=>{let k=B.trackElement.track;if(k){let $=M.get(B)||{wasShowing:!1,wasHidden:!1};k.mode="hidden";let j=()=>{$.wasShowing||$.wasHidden?k.mode="hidden":k.mode="disabled"};k.readyState>=2?j():(k.addEventListener("load",j,{once:!0}),k.addEventListener("error",j,{once:!0}))}})},300)};this.element.readyState>=1?setTimeout(R,200):(this.element.addEventListener("loadedmetadata",R,{once:!0}),setTimeout(R,2e3)),x()},100)});let C=S.length-P.length}}let y=this.sourceElements,b=[];y.forEach(w=>{let S=w.getAttribute("data-desc-src"),P=w.getAttribute("src");if(S){let M=w.getAttribute("type"),E=w.getAttribute("data-orig-src");E||(E=P),b.push({src:S,type:M,origSrc:E,descSrc:S})}else{let M=w.getAttribute("type"),E=w.getAttribute("src");b.push({src:E,type:M,origSrc:null,descSrc:null})}});let v=this.element.hasAttribute("src"),f=v?this.element.getAttribute("src"):null;v&&this.element.removeAttribute("src"),y.forEach(w=>{w.remove()}),b.forEach(w=>{let S=document.createElement("source");S.setAttribute("src",w.src),w.type&&S.setAttribute("type",w.type),w.origSrc&&S.setAttribute("data-orig-src",w.origSrc),w.descSrc&&S.setAttribute("data-desc-src",w.descSrc);let P=this.element.querySelector("track");P?this.element.insertBefore(S,P):this.element.appendChild(S)}),this._sourceElementsDirty=!0,this._sourceElementsCache=null,o&&this.element.tagName==="VIDEO"&&(this.element.poster=o),this.element.load(),await new Promise(w=>{let S=()=>{this.element.removeEventListener("loadedmetadata",S),w()};this.element.readyState>=1?w():this.element.addEventListener("loadedmetadata",S)}),await new Promise(w=>setTimeout(w,300)),(i>0||s)&&await new Promise(w=>{let S=()=>{this.element.removeEventListener("canplay",S),this.element.removeEventListener("canplaythrough",S),w()};this.element.readyState>=3?w():(this.element.addEventListener("canplay",S,{once:!0}),this.element.addEventListener("canplaythrough",S,{once:!0}),setTimeout(()=>{this.element.removeEventListener("canplay",S),this.element.removeEventListener("canplaythrough",S),w()},3e3))});let L=i;if(n&&this.captionManager&&this.captionManager.tracks.length>0){await new Promise(S=>setTimeout(S,500));let w=this.findMatchingCaptionTime(n,this.captionManager.tracks);w!==null&&(L=w,this.options.debug&&console.log("[VidPly] Syncing via caption: ".concat(i,"s -> ").concat(L,"s")))}if(L>0&&(this.seek(L),await new Promise(w=>setTimeout(w,100))),s?(await this.play(),this.setManagedTimeout(()=>{this.hidePosterOverlay()},100)):(this.pause(),a||this.hidePosterOverlay()),!this._audioDescriptionDesiredState)return;this.state.audioDescriptionEnabled=!0,this.emit("audiodescriptionenabled")}else{if(this.audioDescriptionCaptionTracks.length>0){let h=this.audioDescriptionCaptionTracks.map(async b=>{if(b.trackElement&&b.describedSrc)if(b.explicit===!0)try{let v=await this.validateTrackExists(b.describedSrc);return{trackInfo:b,exists:v}}catch(v){return{trackInfo:b,exists:!1}}else return{trackInfo:b,exists:!1};return{trackInfo:b,exists:!1}}),y=(await Promise.all(h)).filter(b=>b.exists);if(y.length>0){let b=new Map;y.forEach(({trackInfo:f})=>{let L=f.trackElement.track;L?b.set(f,{wasShowing:L.mode==="showing",wasHidden:L.mode==="hidden"}):b.set(f,{wasShowing:!1,wasHidden:!1})});let v=y.map(({trackInfo:f})=>{let L=f.trackElement.getAttribute("src"),w=f.trackElement.parentNode,S=f.trackElement.nextSibling,P={};return Array.from(f.trackElement.attributes).forEach(M=>{P[M.name]=M.value}),{trackInfo:f,oldSrc:L,parent:w,nextSibling:S,attributes:P}});v.forEach(({trackInfo:f})=>{f.trackElement.remove()}),this.element.load(),setTimeout(()=>{v.forEach(({trackInfo:L,oldSrc:w,parent:S,nextSibling:P,attributes:M})=>{r.push(L);let E=document.createElement("track");E.setAttribute("src",L.describedSrc),Object.keys(M).forEach(x=>{x!=="src"&&x!=="data-desc-src"&&E.setAttribute(x,M[x])});let C=S.firstChild;C&&C.nodeType===Node.ELEMENT_NODE&&C.tagName!=="TRACK"?S.insertBefore(E,C):P&&P.parentNode?S.insertBefore(E,P):S.appendChild(E),L.trackElement=E}),this.element.load();let f=()=>{setTimeout(()=>{r.forEach(L=>{let S=L.trackElement.track;if(S){let P=b.get(L)||{wasShowing:!1,wasHidden:!1};S.mode="hidden";let M=()=>{P.wasShowing||P.wasHidden?S.mode="hidden":S.mode="disabled"};S.readyState>=2?M():(S.addEventListener("load",M,{once:!0}),S.addEventListener("error",M,{once:!0}))}})},300)};this.element.readyState>=1?setTimeout(f,200):(this.element.addEventListener("loadedmetadata",f,{once:!0}),setTimeout(f,2e3))},100)}}let l=this.sourceElements;if(l.some(h=>h.getAttribute("data-desc-src"))){let h=[];l.forEach(p=>{let y=p.getAttribute("data-desc-src"),b=p.getAttribute("src");if(y){let v=p.getAttribute("type"),f=p.getAttribute("data-orig-src");f||(f=b),h.push({src:y,type:v,origSrc:f,descSrc:y})}else{let v=p.getAttribute("type"),f=p.getAttribute("src");h.push({src:f,type:v,origSrc:null,descSrc:null})}}),l.forEach(p=>{p.remove()}),h.forEach(p=>{let y=document.createElement("source");y.setAttribute("src",p.src),p.type&&y.setAttribute("type",p.type),p.origSrc&&y.setAttribute("data-orig-src",p.origSrc),p.descSrc&&y.setAttribute("data-desc-src",p.descSrc),this.element.appendChild(y)}),o&&this.element.tagName==="VIDEO"&&(this.element.poster=o),this.element.load(),this.invalidateTrackCache()}else o&&this.element.tagName==="VIDEO"&&(this.element.poster=o),this.element.src=this.audioDescriptionSrc}await new Promise(l=>{let d=()=>{this.element.removeEventListener("loadedmetadata",d),l()};this.element.readyState>=1?l():this.element.addEventListener("loadedmetadata",d)}),(i>0||s)&&await new Promise(l=>{let d=()=>{this.element.removeEventListener("canplay",d),this.element.removeEventListener("canplaythrough",d),l()};this.element.readyState>=3?l():(this.element.addEventListener("canplay",d,{once:!0}),this.element.addEventListener("canplaythrough",d,{once:!0}),setTimeout(()=>{this.element.removeEventListener("canplay",d),this.element.removeEventListener("canplaythrough",d),l()},3e3))}),this.element.tagName==="VIDEO"&&i===0&&!s&&this.element.readyState>=1&&(this.element.currentTime=.001,this.setManagedTimeout(()=>{this.element.currentTime=0},10));let c=i;if(n&&this.captionManager&&this.captionManager.tracks.length>0){await new Promise(d=>setTimeout(d,500));let l=this.findMatchingCaptionTime(n,this.captionManager.tracks);l!==null&&(c=l,this.options.debug&&console.log("[VidPly] Syncing via caption: ".concat(i,"s -> ").concat(c,"s")))}if(c>0&&(this.seek(c),await new Promise(l=>setTimeout(l,100))),s?(await this.play(),this.setManagedTimeout(()=>{this.hidePosterOverlay()},100)):(this.pause(),a||this.hidePosterOverlay()),r.length>0&&this.captionManager){let l=this.state.captionsEnabled,d=null;if(this.captionManager.currentTrack){let p=this.captionManager.tracks.findIndex(y=>y.track===this.captionManager.currentTrack.track);p>=0&&(d={language:this.captionManager.tracks[p].language,kind:this.captionManager.tracks[p].kind})}setTimeout(()=>{if(this.captionManager.tracks=[],this.captionManager.loadTracks(),l&&d&&this.captionManager.tracks.length>0){let p=this.captionManager.tracks.findIndex(y=>y.language===d.language&&y.kind===d.kind);if(p>=0){let y=this.captionManager.tracks[p];if(y.track.readyState>=2)this.captionManager.enable(p);else{let b=()=>{y.track.removeEventListener("load",b),y.track.removeEventListener("error",b),this.captionManager&&this.captionManager.tracks.includes(y)&&this.captionManager.enable(p)};y.track.addEventListener("load",b,{once:!0}),y.track.addEventListener("error",b,{once:!0}),y.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(y)&&this.captionManager.enable(p)},1e3)}}else if(this.captionManager.tracks.length>0){let y=this.captionManager.tracks[0];if(y.track.readyState>=2)this.captionManager.enable(0);else{let b=()=>{y.track.removeEventListener("load",b),y.track.removeEventListener("error",b),this.captionManager&&this.captionManager.tracks.includes(y)&&this.captionManager.enable(0)};y.track.addEventListener("load",b,{once:!0}),y.track.addEventListener("error",b,{once:!0}),y.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(y)&&this.captionManager.enable(0)},1e3)}}}},600)}if(this.transcriptManager&&this.transcriptManager.isVisible){let l=typeof r!="undefined"?r:[];if(l.length>0){let d=()=>{this.invalidateTrackCache();let p=this.textTracks,y=l.map(f=>{let L=f.trackElement,w=L.getAttribute("src"),S=L.getAttribute("srclang"),P=L.getAttribute("kind"),M=p.find(E=>L.track===E);if(M||(M=p.find(E=>{if(E.language===S&&(E.kind===P||P==="captions"&&E.kind==="subtitles")){let C=this.findTrackElement(E);if(C&&C.getAttribute("src")===w)return!0}return!1})),M){let E=this.findTrackElement(M);if(E&&E.getAttribute("src")!==w)return null}return M}).filter(Boolean);if(y.length===0){this.setManagedTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},1e3);return}y.forEach(f=>{f.mode==="disabled"&&(f.mode="hidden")});let b=0,v=()=>{b++,b>=y.length&&this.setManagedTimeout(()=>{if(this.transcriptManager&&this.transcriptManager.loadTranscriptData){this.invalidateTrackCache();let f=this.textTracks,L=l.map(S=>S.describedSrc);(y.some(S=>{let P=this.findTrackElement(S);return P&&L.includes(P.getAttribute("src"))})||y.length>0)&&this.transcriptManager.loadTranscriptData()}},800)};y.forEach(f=>{f.mode==="disabled"&&(f.mode="hidden");let L=this.findTrackElement(f),w=L?L.getAttribute("src"):null,S=l.find(M=>{let E=M.trackElement;return E&&(E.track===f||E.getAttribute("srclang")===f.language&&E.getAttribute("kind")===f.kind)}),P=S?S.describedSrc:null;if(P&&w&&w!==P){v();return}if(f.readyState>=2&&f.cues&&f.cues.length>0)v();else{f.mode==="disabled"&&(f.mode="hidden");let M=()=>{this.setManagedTimeout(v,300)};f.readyState>=2?this.setManagedTimeout(()=>{f.cues&&f.cues.length>0?v():f.addEventListener("load",M,{once:!0})},100):(f.addEventListener("load",M,{once:!0}),f.addEventListener("error",()=>{v()},{once:!0}))}})};this.setManagedTimeout(()=>{this.element.readyState>=1?d():(this.element.addEventListener("loadedmetadata",d,{once:!0}),this.setManagedTimeout(d,2e3))},500),setTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},5e3)}else setTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},800)}a||this.hidePosterOverlay(),this._audioDescriptionDesiredState&&(this.state.audioDescriptionEnabled=!0,this.emit("audiodescriptionenabled"))}async disableAudioDescription(){return this.audioDescriptionManager.disable()}async _legacyDisableAudioDescription(){if(!this.originalSrc)return;let e=this.element.currentTime,t=this.state.playing,i=null;if(this.captionManager&&this.captionManager.currentTrack){let c=this.captionManager.currentTrack.track;if(c&&c.activeCues&&c.activeCues.length>0){let l=c.activeCues[0];i=this.stripVTTFormatting(l.text)}}let s=this.resolvePosterPath(this.element.getAttribute("poster")||this.element.poster||this.options.poster),a=[];if(this.audioDescriptionCaptionTracks.length>0){let c=this.audioDescriptionCaptionTracks.map(l=>{let d=l.trackElement;if(!d||!d.parentNode)return null;let h=d.parentNode,p=d.nextSibling,y={};return Array.from(d.attributes).forEach(b=>{y[b.name]=b.value}),{trackInfo:l,parent:h,nextSibling:p,attributes:y}}).filter(Boolean);c.forEach(({trackInfo:l})=>{l.trackElement&&l.trackElement.parentNode&&l.trackElement.remove()}),this.element.load(),await new Promise(l=>{setTimeout(()=>{c.forEach(({trackInfo:d,parent:h,nextSibling:p,attributes:y})=>{a.push(d);let b=document.createElement("track");b.setAttribute("src",d.originalTrackSrc),Object.keys(y).forEach(v=>{v!=="src"&&v!=="data-desc-src"&&b.setAttribute(v,y[v])}),d.describedSrc&&b.setAttribute("data-desc-src",d.describedSrc),p&&p.parentNode?h.insertBefore(b,p):h.appendChild(b),d.trackElement=b}),this.invalidateTrackCache(),l()},100)})}let n=this.sourceElements;if(n.some(c=>c.getAttribute("data-orig-src"))){let c=[];n.forEach(h=>{let p=h.getAttribute("data-orig-src"),y=h.getAttribute("data-desc-src");if(p){let b=h.getAttribute("type");c.push({src:p,type:b,origSrc:p,descSrc:y})}else{let b=h.getAttribute("type"),v=h.getAttribute("src");c.push({src:v,type:b,origSrc:null,descSrc:y})}});let l=this.element.hasAttribute("src"),d=l?this.element.getAttribute("src"):null;l&&this.element.removeAttribute("src"),n.forEach(h=>{h.remove()}),c.forEach(h=>{let p=document.createElement("source");p.setAttribute("src",h.src),h.type&&p.setAttribute("type",h.type),h.origSrc&&p.setAttribute("data-orig-src",h.origSrc),h.descSrc&&p.setAttribute("data-desc-src",h.descSrc);let y=this.element.querySelector("track");y?this.element.insertBefore(p,y):this.element.appendChild(p)}),this._sourceElementsDirty=!0,this._sourceElementsCache=null,s&&this.element.tagName==="VIDEO"&&(this.element.poster=s),this.element.load()}else{s&&this.element.tagName==="VIDEO"&&(this.element.poster=s);let c=this.originalAudioDescriptionSource||this.originalSrc;this.element.src=c,this.element.load()}await new Promise(c=>{let l=()=>{this.element.removeEventListener("loadedmetadata",l),c()};this.element.readyState>=1?c():this.element.addEventListener("loadedmetadata",l)}),(e>0||t)&&await new Promise(c=>{let l=()=>{this.element.removeEventListener("canplay",l),this.element.removeEventListener("canplaythrough",l),c()};this.element.readyState>=3?c():(this.element.addEventListener("canplay",l,{once:!0}),this.element.addEventListener("canplaythrough",l,{once:!0}),setTimeout(()=>{this.element.removeEventListener("canplay",l),this.element.removeEventListener("canplaythrough",l),c()},3e3))});let r=e;if(i&&this.captionManager&&this.captionManager.tracks.length>0){await new Promise(l=>setTimeout(l,500));let c=this.findMatchingCaptionTime(i,this.captionManager.tracks);c!==null&&(r=c,this.options.debug&&console.log("[VidPly] Syncing via caption: ".concat(e,"s -> ").concat(r,"s")))}if(r>0&&(this.seek(r),await new Promise(c=>setTimeout(c,100))),t?(await this.play(),this.hidePosterOverlay()):(this.pause(),!t&&r===0?this.showPosterOverlay():this.hidePosterOverlay()),a.length>0&&this.captionManager){let c=this.state.captionsEnabled,l=null;if(this.captionManager.currentTrack){let h=this.captionManager.tracks.findIndex(p=>p.track===this.captionManager.currentTrack.track);h>=0&&(l={language:this.captionManager.tracks[h].language,kind:this.captionManager.tracks[h].kind})}setTimeout(()=>{if(this.captionManager.tracks=[],this.captionManager.loadTracks(),c&&l&&this.captionManager.tracks.length>0){let h=this.captionManager.tracks.findIndex(p=>p.language===l.language&&p.kind===l.kind);if(h>=0){let p=this.captionManager.tracks[h];if(p.track.readyState>=2)this.captionManager.enable(h);else{let y=()=>{p.track.removeEventListener("load",y),p.track.removeEventListener("error",y),this.captionManager&&this.captionManager.tracks.includes(p)&&this.captionManager.enable(h)};p.track.addEventListener("load",y,{once:!0}),p.track.addEventListener("error",y,{once:!0}),p.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(p)&&this.captionManager.enable(h)},1e3)}}else if(this.captionManager.tracks.length>0){let p=this.captionManager.tracks[0];if(p.track.readyState>=2)this.captionManager.enable(0);else{let y=()=>{p.track.removeEventListener("load",y),p.track.removeEventListener("error",y),this.captionManager&&this.captionManager.tracks.includes(p)&&this.captionManager.enable(0)};p.track.addEventListener("load",y,{once:!0}),p.track.addEventListener("error",y,{once:!0}),p.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(p)&&this.captionManager.enable(0)},1e3)}}}},600)}this.transcriptManager&&this.transcriptManager.isVisible&&this.setManagedTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},500),!this._audioDescriptionDesiredState&&(this.state.audioDescriptionEnabled=!1,this.emit("audiodescriptiondisabled"))}async toggleAudioDescription(){var e,t,i;if(this.options.requirePlaybackForAccessibilityToggles&&!this.renderer&&((t=(e=this.playlistManager)==null?void 0:e.tracks)!=null&&t.length)){this.showNotice(m.t("player.startPlaybackForAudioDescription"));return}if(!this.renderer&&this.playlistManager&&((i=this.playlistManager.tracks)!=null&&i.length)){this.audioDescriptionManager.desiredState=!this.audioDescriptionManager.desiredState,this.state.audioDescriptionEnabled=this.audioDescriptionManager.desiredState,this.emit(this.audioDescriptionManager.desiredState?"audiodescriptionenabled":"audiodescriptiondisabled"),this.play();return}return this.audioDescriptionManager.toggle()}enableSignLanguage(){return this.signLanguageManager.enable()}_legacyEnableSignLanguage(){var d;let e=Object.keys(this.signLanguageSources).length>0,t=!!this.signLanguageSrc;if(!e&&!t){console.warn("No sign language video source provided");return}if(this.signLanguageWrapper){this.signLanguageWrapper.style.display="block",this.state.signLanguageEnabled=!0,this.emit("signlanguageenabled"),this.setManagedTimeout(()=>{this.signLanguageSettingsButton&&document.contains(this.signLanguageSettingsButton)&&this.signLanguageSettingsButton.focus({preventScroll:!0})},150);return}let i=null,s=null;if(e){if(this.captionManager&&this.captionManager.currentTrack){let h=(d=this.captionManager.currentTrack.language)==null?void 0:d.toLowerCase().split("-")[0];h&&this.signLanguageSources[h]&&(i=h,s=this.signLanguageSources[h])}if(!i&&this.options.language){let h=this.options.language.toLowerCase().split("-")[0];this.signLanguageSources[h]&&(i=h,s=this.signLanguageSources[h])}i||(i=Object.keys(this.signLanguageSources)[0],s=this.signLanguageSources[i]),this.currentSignLanguage=i}else s=this.signLanguageSrc;this.signLanguageWrapper=document.createElement("div"),this.signLanguageWrapper.className="vidply-sign-language-wrapper",this.signLanguageWrapper.setAttribute("tabindex","0"),this.signLanguageWrapper.setAttribute("aria-label",m.t("player.signLanguageDragResize")),this.signLanguageHeader=g.createElement("div",{className:"".concat(this.options.classPrefix,"-sign-language-header"),attributes:{tabindex:"0"}});let a=g.createElement("div",{className:"".concat(this.options.classPrefix,"-sign-language-header-left")}),n=g.createElement("h3",{textContent:m.t("player.signLanguageVideo")}),o=m.t("player.signLanguageSettings");if(this.signLanguageSettingsButton=g.createElement("button",{className:"".concat(this.options.classPrefix,"-sign-language-settings"),attributes:{type:"button","aria-label":o,"aria-expanded":"false"}}),this.signLanguageSettingsButton.appendChild(T("settings")),g.attachTooltip(this.signLanguageSettingsButton,o,this.options.classPrefix),this.signLanguageSettingsHandlers={settingsClick:h=>{if(h.preventDefault(),h.stopPropagation(),this.signLanguageDocumentClickHandler){let p=this.signLanguageSettingsMenuJustOpened;this.signLanguageSettingsMenuJustOpened=!0,setTimeout(()=>{this.signLanguageSettingsMenuJustOpened=p},100)}this.signLanguageSettingsMenuVisible?this.hideSignLanguageSettingsMenu():this.showSignLanguageSettingsMenu()},settingsKeydown:h=>{h.key==="d"||h.key==="D"?(h.preventDefault(),h.stopPropagation(),this.toggleSignLanguageKeyboardDragMode()):h.key==="r"||h.key==="R"?(h.preventDefault(),h.stopPropagation(),this.toggleSignLanguageResizeMode()):h.key==="Escape"&&this.signLanguageSettingsMenuVisible&&(h.preventDefault(),h.stopPropagation(),this.hideSignLanguageSettingsMenu())}},this.signLanguageSettingsButton.addEventListener("click",this.signLanguageSettingsHandlers.settingsClick),this.signLanguageSettingsButton.addEventListener("keydown",this.signLanguageSettingsHandlers.settingsKeydown),a.appendChild(this.signLanguageSettingsButton),this.signLanguageSelector=null,e){let h="".concat(this.options.classPrefix,"-sign-language-select-").concat(Date.now()),p=Object.keys(this.signLanguageSources).map(f=>({value:f,text:this.getSignLanguageLabel(f),selected:f===i})),{label:y,select:b}=G({classPrefix:this.options.classPrefix,labelClass:"".concat(this.options.classPrefix,"-sign-language-label"),selectClass:"".concat(this.options.classPrefix,"-sign-language-select"),labelText:"settings.language",selectId:h,options:p,onChange:f=>{f.stopPropagation();let L=f.target.value;this.switchSignLanguage(L)}});this.signLanguageSelector=b;let v=g.createElement("div",{className:"".concat(this.options.classPrefix,"-sign-language-selector-wrapper")});v.appendChild(y),v.appendChild(this.signLanguageSelector),J(v),a.appendChild(v)}a.appendChild(n);let r=m.t("player.closeSignLanguage"),c=g.createElement("button",{className:"".concat(this.options.classPrefix,"-sign-language-close"),attributes:{type:"button","aria-label":r}});c.appendChild(T("close")),g.attachTooltip(c,r,this.options.classPrefix),c.addEventListener("click",()=>{this.disableSignLanguage(),this.controlBar&&this.controlBar.controls&&this.controlBar.controls.signLanguage&&setTimeout(()=>{this.controlBar.controls.signLanguage.focus({preventScroll:!0})},0)}),this.signLanguageHeader.appendChild(a),this.signLanguageHeader.appendChild(c),this.signLanguageSettingsMenuVisible=!1,this.signLanguageSettingsMenu=null,this.signLanguageSettingsMenuJustOpened=!1,this.signLanguageResizeOptionButton=null,this.signLanguageResizeOptionText=null,this.signLanguageDragOptionButton=null,this.signLanguageDragOptionText=null,this.signLanguageDocumentClickHandler=null,this.signLanguageDocumentClickHandlerAdded=!1,this.signLanguageVideo=document.createElement("video"),this.signLanguageVideo.className="vidply-sign-language-video",this.signLanguageVideo.src=s,this.signLanguageVideo.setAttribute("aria-label",m.t("player.signLanguage")),this.signLanguageVideo.muted=!0,this.signLanguageVideo.setAttribute("playsinline",""),this.signLanguageResizeHandles=["n","s","e","w","ne","nw","se","sw"].map(h=>{let p=g.createElement("div",{className:"".concat(this.options.classPrefix,"-sign-resize-handle ").concat(this.options.classPrefix,"-sign-resize-").concat(h),attributes:{"data-direction":h,"data-vidply-managed-resize":"true","aria-hidden":"true"}});return p.style.display="none",p}),this.signLanguageWrapper.appendChild(this.signLanguageHeader),this.signLanguageWrapper.appendChild(this.signLanguageVideo),this.signLanguageResizeHandles.forEach(h=>this.signLanguageWrapper.appendChild(h));let l=this.storage.getSignLanguagePreferences();l&&l.size&&l.size.width?this.signLanguageWrapper.style.width=l.size.width:this.signLanguageWrapper.style.width="280px",this.signLanguageWrapper.style.height="auto",this.signLanguageDesiredPosition=this.options.signLanguagePosition||"bottom-right",this.container.appendChild(this.signLanguageWrapper),requestAnimationFrame(()=>{this.constrainSignLanguagePosition()}),this.signLanguageVideo.currentTime=this.state.currentTime,this.state.paused||this.signLanguageVideo.play(),this.setupSignLanguageInteraction(),this.signLanguageHandlers={play:()=>{this.signLanguageVideo&&this.signLanguageVideo.play()},pause:()=>{this.signLanguageVideo&&this.signLanguageVideo.pause()},timeupdate:()=>{this.signLanguageVideo&&Math.abs(this.signLanguageVideo.currentTime-this.state.currentTime)>.5&&(this.signLanguageVideo.currentTime=this.state.currentTime)},ratechange:()=>{this.signLanguageVideo&&(this.signLanguageVideo.playbackRate=this.state.playbackSpeed)}},this.on("play",this.signLanguageHandlers.play),this.on("pause",this.signLanguageHandlers.pause),this.on("timeupdate",this.signLanguageHandlers.timeupdate),this.on("ratechange",this.signLanguageHandlers.ratechange),e&&(this.signLanguageHandlers.captionChange=()=>{var h;if(this.captionManager&&this.captionManager.currentTrack&&this.signLanguageSelector){let p=(h=this.captionManager.currentTrack.language)==null?void 0:h.toLowerCase().split("-")[0];p&&this.signLanguageSources[p]&&this.currentSignLanguage!==p&&(this.switchSignLanguage(p),this.signLanguageSelector.value=p)}},this.on("captionsenabled",this.signLanguageHandlers.captionChange)),this.state.signLanguageEnabled=!0,this.emit("signlanguageenabled"),this.setManagedTimeout(()=>{this.signLanguageSettingsButton&&document.contains(this.signLanguageSettingsButton)&&this.signLanguageSettingsButton.focus({preventScroll:!0})},150)}disableSignLanguage(){return this.signLanguageManager.disable()}toggleSignLanguage(){var e,t,i;if(this.options.requirePlaybackForAccessibilityToggles&&!this.renderer&&((t=(e=this.playlistManager)==null?void 0:e.tracks)!=null&&t.length)){this.showNotice(m.t("player.startPlaybackForSignLanguage"));return}if(!this.renderer&&this.playlistManager&&((i=this.playlistManager.tracks)!=null&&i.length)){let s=this.signLanguageManager.enabled,a=this.signLanguageManager.toggle();return!s&&this.signLanguageManager.enabled&&this.play(),a}return this.signLanguageManager.toggle()}setupSignLanguageInteraction(){return this.signLanguageManager._setupInteraction()}_legacySetupSignLanguageInteraction(){if(!this.signLanguageWrapper)return;let e=window.innerWidth<768,t=this.state.fullscreen;if(e&&!t){this.signLanguageDraggable&&(this.signLanguageDraggable.destroy(),this.signLanguageDraggable=null);return}this.signLanguageDraggable||(this.signLanguageDraggable=new _(this.signLanguageWrapper,{dragHandle:this.signLanguageHeader,resizeHandles:this.signLanguageResizeHandles,constrainToViewport:!0,maintainAspectRatio:!0,minWidth:150,minHeight:100,classPrefix:"".concat(this.options.classPrefix,"-sign"),keyboardDragKey:"d",keyboardResizeKey:"r",keyboardStep:10,keyboardStepLarge:50,pointerResizeIndicatorText:m.t("player.signLanguageResizeActive"),onPointerResizeToggle:i=>{this.signLanguageResizeHandles.forEach(s=>{s.style.display=i?"block":"none"})},onDragStart:i=>!(i.target.closest(".".concat(this.options.classPrefix,"-sign-language-close"))||i.target.closest(".".concat(this.options.classPrefix,"-sign-language-settings"))||i.target.closest(".".concat(this.options.classPrefix,"-sign-language-select"))||i.target.closest(".".concat(this.options.classPrefix,"-sign-language-label"))||i.target.closest(".".concat(this.options.classPrefix,"-sign-language-settings-menu")))}),this.signLanguageCustomKeyHandler=i=>{let s=i.key.toLowerCase();if(!this.signLanguageSettingsMenuVisible){if(s==="home"){i.preventDefault(),i.stopPropagation(),this.signLanguageDraggable&&(this.signLanguageDraggable.pointerResizeMode&&this.signLanguageDraggable.disablePointerResizeMode(),this.signLanguageDraggable.manuallyPositioned=!1,this.constrainSignLanguagePosition());return}if(s==="r"){i.preventDefault(),i.stopPropagation(),this.toggleSignLanguageResizeMode()&&this.signLanguageWrapper.focus({preventScroll:!0});return}if(s==="escape"){if(i.preventDefault(),i.stopPropagation(),this.signLanguageDraggable&&this.signLanguageDraggable.pointerResizeMode){this.signLanguageDraggable.disablePointerResizeMode();return}if(this.signLanguageDraggable&&this.signLanguageDraggable.keyboardDragMode){this.signLanguageDraggable.disableKeyboardDragMode();return}this.disableSignLanguage(),this.controlBar&&this.controlBar.controls&&this.controlBar.controls.signLanguage&&setTimeout(()=>{this.controlBar.controls.signLanguage.focus({preventScroll:!0})},0);return}}},this.signLanguageWrapper.addEventListener("keydown",this.signLanguageCustomKeyHandler),this.signLanguageInteractionHandlers={draggable:this.signLanguageDraggable,headerKeyHandler:this.signLanguageHeaderKeyHandler,customKeyHandler:this.signLanguageCustomKeyHandler})}toggleSignLanguageKeyboardDragMode(){if(this.signLanguageDraggable){let e=this.signLanguageDraggable.keyboardDragMode;this.signLanguageDraggable.toggleKeyboardDragMode();let t=this.signLanguageDraggable.keyboardDragMode;!e&&t&&this.enableSignLanguageMoveMode(),this.updateSignLanguageDragOptionState()}}enableSignLanguageMoveMode(){this.signLanguageWrapper.classList.add("".concat(this.options.classPrefix,"-sign-move-mode")),this.updateSignLanguageResizeOptionState(),setTimeout(()=>{this.signLanguageWrapper.classList.remove("".concat(this.options.classPrefix,"-sign-move-mode"))},2e3)}toggleSignLanguageResizeMode({focus:e=!0}={}){return this.signLanguageDraggable?this.signLanguageDraggable.pointerResizeMode?(this.signLanguageDraggable.disablePointerResizeMode({focus:e}),this.updateSignLanguageResizeOptionState(),!1):(this.signLanguageDraggable.enablePointerResizeMode({focus:e}),this.updateSignLanguageResizeOptionState(),!0):!1}getSignLanguageLabel(e){return{en:"English",de:"Deutsch",es:"Español",fr:"Français",it:"Italiano",ja:"日本語",pt:"Português",ar:"العربية",hi:"हिन्दी"}[e]||e.toUpperCase()}switchSignLanguage(e){return this.signLanguageManager.switchLanguage(e)}_legacySwitchSignLanguage(e){if(!this.signLanguageSources[e]||!this.signLanguageVideo)return;let t=this.signLanguageVideo.currentTime,i=!this.signLanguageVideo.paused;this.signLanguageVideo.src=this.signLanguageSources[e],this.currentSignLanguage=e,this.signLanguageVideo.currentTime=t,i&&this.signLanguageVideo.play().catch(()=>{}),this.emit("signlanguagelanguagechanged",e)}showSignLanguageSettingsMenu(){return this.signLanguageManager.showSettingsMenu()}_legacyShowSignLanguageSettingsMenu(){if(this.signLanguageSettingsMenuJustOpened=!0,setTimeout(()=>{this.signLanguageSettingsMenuJustOpened=!1},350),this.signLanguageDocumentClickHandlerAdded||(this.signLanguageDocumentClickHandler=l=>{this.signLanguageSettingsMenuJustOpened||this.signLanguageSettingsButton&&(this.signLanguageSettingsButton===l.target||this.signLanguageSettingsButton.contains(l.target))||this.signLanguageSettingsMenu&&this.signLanguageSettingsMenu.contains(l.target)||this.signLanguageSettingsMenuVisible&&this.hideSignLanguageSettingsMenu()},setTimeout(()=>{document.addEventListener("mousedown",this.signLanguageDocumentClickHandler,!0),this.signLanguageDocumentClickHandlerAdded=!0},300)),this.signLanguageSettingsMenu){this.signLanguageSettingsMenu.style.display="block",this.signLanguageSettingsMenuVisible=!0,this.signLanguageSettingsButton&&this.signLanguageSettingsButton.setAttribute("aria-expanded","true"),this.signLanguageSettingsMenuKeyHandler=I(this.signLanguageSettingsMenu,this.signLanguageSettingsButton,".".concat(this.options.classPrefix,"-sign-language-settings-item"),()=>this.hideSignLanguageSettingsMenu({focusButton:!0})),this.positionSignLanguageSettingsMenu(),this.updateSignLanguageDragOptionState(),this.updateSignLanguageResizeOptionState(),Q(this.signLanguageSettingsMenu,".".concat(this.options.classPrefix,"-sign-language-settings-item"));return}this.signLanguageSettingsMenu=g.createElement("div",{className:"".concat(this.options.classPrefix,"-sign-language-settings-menu"),attributes:{role:"menu"}});let e=z({classPrefix:this.options.classPrefix,itemClass:"".concat(this.options.classPrefix,"-sign-language-settings-item"),icon:"move",label:"player.enableSignDragMode",hasTextClass:!0,onClick:()=>{this.toggleSignLanguageKeyboardDragMode(),this.hideSignLanguageSettingsMenu()}});e.setAttribute("role","switch"),e.setAttribute("aria-checked","false");let t=e.querySelector(".".concat(this.options.classPrefix,"-tooltip"));t&&t.remove();let i=e.querySelector(".".concat(this.options.classPrefix,"-button-text"));i&&i.remove(),this.signLanguageDragOptionButton=e,this.signLanguageDragOptionText=e.querySelector(".".concat(this.options.classPrefix,"-settings-text")),this.updateSignLanguageDragOptionState();let s=z({classPrefix:this.options.classPrefix,itemClass:"".concat(this.options.classPrefix,"-sign-language-settings-item"),icon:"resize",label:"player.enableSignResizeMode",hasTextClass:!0,onClick:l=>{l.preventDefault(),l.stopPropagation(),this.toggleSignLanguageResizeMode({focus:!1})?(this.hideSignLanguageSettingsMenu({focusButton:!1}),setTimeout(()=>{this.signLanguageWrapper&&this.signLanguageWrapper.focus({preventScroll:!0})},20)):this.hideSignLanguageSettingsMenu({focusButton:!0})}});s.setAttribute("role","switch"),s.setAttribute("aria-checked","false");let a=s.querySelector(".".concat(this.options.classPrefix,"-tooltip"));a&&a.remove();let n=s.querySelector(".".concat(this.options.classPrefix,"-button-text"));n&&n.remove(),this.signLanguageResizeOptionButton=s,this.signLanguageResizeOptionText=s.querySelector(".".concat(this.options.classPrefix,"-settings-text")),this.updateSignLanguageResizeOptionState();let o=z({classPrefix:this.options.classPrefix,itemClass:"".concat(this.options.classPrefix,"-sign-language-settings-item"),icon:"close",label:"transcript.closeMenu",onClick:()=>{this.hideSignLanguageSettingsMenu()}}),r=o.querySelector(".".concat(this.options.classPrefix,"-tooltip"));r&&r.remove();let c=o.querySelector(".".concat(this.options.classPrefix,"-button-text"));c&&c.remove(),this.signLanguageSettingsMenu.appendChild(e),this.signLanguageSettingsMenu.appendChild(s),this.signLanguageSettingsMenu.appendChild(o),this.signLanguageSettingsMenu.style.visibility="hidden",this.signLanguageSettingsMenu.style.display="block",this.signLanguageSettingsButton&&this.signLanguageSettingsButton.parentNode?this.signLanguageSettingsButton.insertAdjacentElement("afterend",this.signLanguageSettingsMenu):this.signLanguageWrapper&&this.signLanguageWrapper.appendChild(this.signLanguageSettingsMenu),this.positionSignLanguageSettingsMenuImmediate(),requestAnimationFrame(()=>{this.signLanguageSettingsMenu&&(this.signLanguageSettingsMenu.style.visibility="visible")}),this.signLanguageSettingsMenuKeyHandler=I(this.signLanguageSettingsMenu,this.signLanguageSettingsButton,".".concat(this.options.classPrefix,"-sign-language-settings-item"),()=>this.hideSignLanguageSettingsMenu({focusButton:!0})),this.signLanguageSettingsMenuVisible=!0,this.signLanguageSettingsButton&&this.signLanguageSettingsButton.setAttribute("aria-expanded","true"),this.updateSignLanguageDragOptionState(),this.updateSignLanguageResizeOptionState(),Q(this.signLanguageSettingsMenu,".".concat(this.options.classPrefix,"-sign-language-settings-item"))}hideSignLanguageSettingsMenu({focusButton:e=!0}={}){return this.signLanguageManager.hideSettingsMenu({focusButton:e})}positionSignLanguageSettingsMenuImmediate(){if(!this.signLanguageSettingsMenu||!this.signLanguageSettingsButton)return;let e=this.signLanguageSettingsButton.getBoundingClientRect(),t=this.signLanguageSettingsMenu.getBoundingClientRect(),i=window.innerWidth,s=window.innerHeight,a=this.signLanguageSettingsButton.parentElement;if(!a)return;let n=a.getBoundingClientRect(),o=e.left+e.width/2-n.left,r=e.bottom-n.top,c=e.top-n.top,l=e.top,d=s-e.bottom,h=r+8,p=null;d<t.height+20&&l>d?(h=null,p=n.bottom-n.top-c+8,this.signLanguageSettingsMenu.classList.add("vidply-menu-above")):this.signLanguageSettingsMenu.classList.remove("vidply-menu-above");let y=o-t.width/2,b="auto",v="translateX(0)",f=e.left+e.width/2-t.width/2;f<10?(y=0,v="translateX(0)"):f+t.width>i-10?(y="auto",b=0,v="translateX(0)"):(y=o,v="translateX(-50%)"),h!==null?(this.signLanguageSettingsMenu.style.top="".concat(h,"px"),this.signLanguageSettingsMenu.style.bottom="auto"):p!==null&&(this.signLanguageSettingsMenu.style.top="auto",this.signLanguageSettingsMenu.style.bottom="".concat(p,"px")),y!=="auto"?(this.signLanguageSettingsMenu.style.left="".concat(y,"px"),this.signLanguageSettingsMenu.style.right="auto"):(this.signLanguageSettingsMenu.style.left="auto",this.signLanguageSettingsMenu.style.right="".concat(b,"px")),this.signLanguageSettingsMenu.style.transform=v}positionSignLanguageSettingsMenu(){!this.signLanguageSettingsMenu||!this.signLanguageSettingsButton||!this.signLanguageWrapper||requestAnimationFrame(()=>{setTimeout(()=>{this.positionSignLanguageSettingsMenuImmediate()},10)})}attachSignLanguageSettingsMenuKeyboardNavigation(){this.signLanguageSettingsMenu&&(this.signLanguageSettingsMenuKeyHandler&&this.signLanguageSettingsMenu.removeEventListener("keydown",this.signLanguageSettingsMenuKeyHandler),this.signLanguageSettingsMenuKeyHandler=I(this.signLanguageSettingsMenu,this.signLanguageSettingsButton,".".concat(this.options.classPrefix,"-sign-language-settings-item"),()=>this.hideSignLanguageSettingsMenu({focusButton:!0})))}updateSignLanguageDragOptionState(){if(!this.signLanguageDragOptionButton)return;let e=!!(this.signLanguageDraggable&&this.signLanguageDraggable.keyboardDragMode),t=e?m.t("player.disableSignDragMode"):m.t("player.enableSignDragMode"),i=e?m.t("player.disableSignDragModeAria"):m.t("player.enableSignDragModeAria");this.signLanguageDragOptionButton.setAttribute("aria-checked",e?"true":"false"),this.signLanguageDragOptionButton.setAttribute("aria-label",i),this.signLanguageDragOptionText&&(this.signLanguageDragOptionText.textContent=t)}updateSignLanguageResizeOptionState(){if(!this.signLanguageResizeOptionButton)return;let e=!!(this.signLanguageDraggable&&this.signLanguageDraggable.pointerResizeMode),t=e?m.t("player.disableSignResizeMode"):m.t("player.enableSignResizeMode"),i=e?m.t("player.disableSignResizeModeAria"):m.t("player.enableSignResizeModeAria");this.signLanguageResizeOptionButton.setAttribute("aria-checked",e?"true":"false"),this.signLanguageResizeOptionButton.setAttribute("aria-label",i),this.signLanguageResizeOptionText&&(this.signLanguageResizeOptionText.textContent=t)}constrainSignLanguagePosition(){return this.signLanguageManager.constrainPosition()}saveSignLanguagePreferences(){return this.signLanguageManager.savePreferences()}_legacyConstrainSignLanguagePosition(){if(!this.signLanguageWrapper||!this.videoWrapper||this.signLanguageDraggable&&this.signLanguageDraggable.manuallyPositioned)return;(!this.signLanguageWrapper.style.width||this.signLanguageWrapper.style.width==="")&&(this.signLanguageWrapper.style.width="280px");let e=this.videoWrapper.getBoundingClientRect(),t=this.container.getBoundingClientRect(),i=this.signLanguageWrapper.getBoundingClientRect(),s=e.left-t.left,a=e.top-t.top,n=e.width,o=e.height,r=i.width||280,c=i.height||280*9/16,l,d,h=16,p=95;switch(this.signLanguageDesiredPosition||"bottom-right"){case"bottom-right":l=s+n-r-h,d=a+o-c-p;break;case"bottom-left":l=s+h,d=a+o-c-p;break;case"top-right":l=s+n-r-h,d=a+h;break;case"top-left":l=s+h,d=a+h;break;default:l=s+n-r-h,d=a+o-c-p}l=Math.max(s,Math.min(l,s+n-r)),d=Math.max(a,Math.min(d,a+o-c-p)),this.signLanguageWrapper.style.left="".concat(l,"px"),this.signLanguageWrapper.style.top="".concat(d,"px"),this.signLanguageWrapper.style.right="auto",this.signLanguageWrapper.style.bottom="auto",this.signLanguageWrapper.classList.remove(...Array.from(this.signLanguageWrapper.classList).filter(b=>b.startsWith("vidply-sign-position-")))}_legacySaveSignLanguagePreferences(){this.signLanguageWrapper&&this.storage.saveSignLanguagePreferences({size:{width:this.signLanguageWrapper.style.width}})}cleanupSignLanguage(){return this.signLanguageManager.cleanup()}showSettings(){console.warn("[VidPly] Settings dialog has been removed. Use individual control buttons (speed, captions, etc.)")}hideSettings(){}getCurrentTime(){return this.state.currentTime}getDuration(){return this.state.duration}isPlaying(){return this.state.playing}isPaused(){return this.state.paused}isEnded(){return this.state.ended}isMuted(){return this.state.muted}isFullscreen(){return this.state.fullscreen}handleError(e){if(this._switchingRenderer){this.log("Suppressing error during renderer switch:",e,"debug");return}this.log("Error:",e,"error"),this.emit("error",e),this.options.onError&&this.options.onError.call(this,e)}log(...e){if(!this.options.debug)return;let t="log";if(e.length>0){let i=e[e.length-1];typeof i=="string"&&console[i]&&(t=i,e=e.slice(0,-1))}e.length===0&&(e=[""]),typeof console[t]=="function"?console[t]("[VidPly]",...e):console.log("[VidPly]",...e)}setupResponsiveHandlers(){if(typeof ResizeObserver!="undefined"?(this.resizeObserver=new ResizeObserver(e=>{for(let t of e){let i=t.contentRect.width;this.controlBar&&typeof this.controlBar.updateControlsForViewport=="function"&&this.controlBar.updateControlsForViewport(i),this.transcriptManager&&this.transcriptManager.isVisible&&this.transcriptManager.positionTranscript()}}),this.resizeObserver.observe(this.container)):(this.resizeHandler=()=>{let e=this.container.clientWidth;this.controlBar&&typeof this.controlBar.updateControlsForViewport=="function"&&this.controlBar.updateControlsForViewport(e),this.transcriptManager&&this.transcriptManager.isVisible&&(!this.transcriptManager.draggableResizable||!this.transcriptManager.draggableResizable.manuallyPositioned)&&this.transcriptManager.positionTranscript()},window.addEventListener("resize",this.resizeHandler)),window.matchMedia){this.orientationHandler=t=>{setTimeout(()=>{this.transcriptManager&&this.transcriptManager.isVisible&&(!this.transcriptManager.draggableResizable||!this.transcriptManager.draggableResizable.manuallyPositioned)&&this.transcriptManager.positionTranscript()},100)};let e=window.matchMedia("(orientation: portrait)");e.addEventListener?e.addEventListener("change",this.orientationHandler):e.addListener&&e.addListener(this.orientationHandler),this.orientationQuery=e}this.fullscreenChangeHandler=()=>{let e=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);this.state.fullscreen!==e&&(this.state.fullscreen=e,e?(this.container.classList.add("".concat(this.options.classPrefix,"-fullscreen")),document.body.classList.add("vidply-fullscreen-active"),this._makeBackgroundInert()):(this.container.classList.remove("".concat(this.options.classPrefix,"-fullscreen")),document.body.classList.remove("vidply-fullscreen-active"),this._restoreBackgroundInteractivity(),this._disablePseudoFullscreen()),this.emit("fullscreenchange",e),this.controlBar&&this.controlBar.updateFullscreenButton(),this.signLanguageWrapper&&this.signLanguageWrapper.style.display!=="none"&&(window.innerWidth<768&&this.setupSignLanguageInteraction(),this.setManagedTimeout(()=>{requestAnimationFrame(()=>{this.storage.saveSignLanguagePreferences({size:null}),this.signLanguageDesiredPosition="bottom-right",this.signLanguageWrapper.style.width=e?"400px":"280px",this.constrainSignLanguagePosition()})},500)))},document.addEventListener("fullscreenchange",this.fullscreenChangeHandler),document.addEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),document.addEventListener("mozfullscreenchange",this.fullscreenChangeHandler),document.addEventListener("MSFullscreenChange",this.fullscreenChangeHandler)}destroy(){if(this.log("Destroying player"),this.renderer&&this.renderer.destroy(),this.controlBar&&this.controlBar.destroy(),this.captionManager&&this.captionManager.destroy(),this.keyboardManager&&this.keyboardManager.destroy(),this.transcriptManager&&this.transcriptManager.destroy(),this.cleanupSignLanguage(),this.playButtonOverlay&&this.playButtonOverlay.parentNode&&(this.playButtonOverlay.remove(),this.playButtonOverlay=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),this.orientationQuery&&this.orientationHandler&&(this.orientationQuery.removeEventListener?this.orientationQuery.removeEventListener("change",this.orientationHandler):this.orientationQuery.removeListener&&this.orientationQuery.removeListener(this.orientationHandler),this.orientationQuery=null,this.orientationHandler=null),this.fullscreenChangeHandler&&(document.removeEventListener("fullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("mozfullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("MSFullscreenChange",this.fullscreenChangeHandler),this.fullscreenChangeHandler=null),this.timeouts.forEach(e=>clearTimeout(e)),this.timeouts.clear(),this.metadataCueChangeHandler){let t=this.textTracks.find(i=>i.kind==="metadata");t&&t.removeEventListener("cuechange",this.metadataCueChangeHandler),this.metadataCueChangeHandler=null}this.metadataAlertHandlers&&this.metadataAlertHandlers.size>0&&(this.metadataAlertHandlers.forEach(({button:e,handler:t})=>{e&&t&&e.removeEventListener("click",t)}),this.metadataAlertHandlers.clear()),this.container&&this.container.parentNode&&(this.container.parentNode.insertBefore(this.element,this.container),this.container.parentNode.removeChild(this.container)),this.removeAllListeners()}setupMetadataHandling(){let e=()=>{let i=this.textTracks.find(s=>s.kind==="metadata");if(i){if(i.mode==="disabled"&&(i.mode="hidden"),this.metadataCueChangeHandler&&i.removeEventListener("cuechange",this.metadataCueChangeHandler),this.metadataCueChangeHandler=()=>{let s=Array.from(i.activeCues||[]);s.length>0&&this.options.debug&&this.log("[Metadata] Active cues:",s.map(a=>({start:a.startTime,end:a.endTime,text:a.text}))),s.forEach(a=>{this.handleMetadataCue(a)})},i.addEventListener("cuechange",this.metadataCueChangeHandler),this.options.debug){let s=i.cues?i.cues.length:0;this.log("[Metadata] Track enabled,",s,"cues available")}}else this.options.debug&&this.log("[Metadata] No metadata track found")};e(),this.on("loadedmetadata",e)}normalizeMetadataSelector(e){if(!e)return null;let t=e.trim();return t?t.startsWith("#")||t.startsWith(".")||t.startsWith("[")?t:"#".concat(t):null}resolveMetadataConfig(e,t){if(!e||!t)return null;if(Object.prototype.hasOwnProperty.call(e,t))return e[t];let i=t.replace(/^#/,"");return Object.prototype.hasOwnProperty.call(e,i)?e[i]:null}cacheMetadataAlertContent(e,t={}){if(!e)return;let i=t.titleSelector||"[data-vidply-alert-title], h3, header",s=t.messageSelector||"[data-vidply-alert-message], p",a=e.querySelector(i);a&&!a.dataset.vidplyAlertTitleOriginal&&(a.dataset.vidplyAlertTitleOriginal=a.textContent.trim());let n=e.querySelector(s);n&&!n.dataset.vidplyAlertMessageOriginal&&(n.dataset.vidplyAlertMessageOriginal=n.textContent.trim())}restoreMetadataAlertContent(e,t={}){if(!e)return;let i=t.titleSelector||"[data-vidply-alert-title], h3, header",s=t.messageSelector||"[data-vidply-alert-message], p",a=e.querySelector(i);a&&a.dataset.vidplyAlertTitleOriginal&&(a.textContent=a.dataset.vidplyAlertTitleOriginal);let n=e.querySelector(s);n&&n.dataset.vidplyAlertMessageOriginal&&(n.textContent=n.dataset.vidplyAlertMessageOriginal)}focusMetadataTarget(e,t=null){var i,s;if(!(!e||e==="none")){if(e==="alert"&&t){t.focus({preventScroll:!0});return}if(e==="player"){this.container&&this.container.focus({preventScroll:!0});return}if(e==="media"){this.element.focus({preventScroll:!0});return}if(e==="playButton"){let a=(s=(i=this.controlBar)==null?void 0:i.controls)==null?void 0:s.playPause;a&&a.focus({preventScroll:!0});return}if(typeof e=="string"){let a=document.querySelector(e);a&&(a.tabIndex===-1&&!a.hasAttribute("tabindex")&&a.setAttribute("tabindex","-1"),a.focus({preventScroll:!0}))}}}handleMetadataAlert(e,t={}){var c;if(!e)return;let i=this.resolveMetadataConfig(this.options.metadataAlerts,e)||{},s=t.element||document.querySelector(e);if(!s){this.options.debug&&this.log("[Metadata] Alert element not found:",e);return}this.options.debug&&this.log("[Metadata] Handling alert",e,{reason:t.reason,config:i}),this.cacheMetadataAlertContent(s,i),s.dataset.vidplyAlertOriginalDisplay||(s.dataset.vidplyAlertOriginalDisplay=s.style.display||""),s.dataset.vidplyAlertDisplay||(s.dataset.vidplyAlertDisplay=i.display||"block");let a=t.show!==void 0?t.show:i.show!==!1;if(a){let l=i.display||s.dataset.vidplyAlertDisplay||"block";s.style.display=l,s.hidden=!1,s.removeAttribute("hidden"),s.setAttribute("aria-hidden","false"),s.setAttribute("data-vidply-alert-active","true")}i.resetContent!==!1&&t.reason==="focus"&&this.restoreMetadataAlertContent(s,i);let o=t.focus!==void 0?t.focus:(c=i.focusOnShow)!=null?c:t.reason!=="focus";a&&o&&(s.tabIndex===-1&&!s.hasAttribute("tabindex")&&s.setAttribute("tabindex","-1"),s.focus({preventScroll:!0})),a&&i.autoScroll!==!1&&t.autoScroll!==!1&&s.scrollIntoView({behavior:"smooth",block:"nearest"});let r=i.continueButton;if(r){let l=null;if(r==="self"||s.matches(r)?l=s:l=s.querySelector(r)||document.querySelector(r),l&&!this.metadataAlertHandlers.has(e)){let d=()=>{var y;if(i.hideOnContinue!==!1){let b=s.dataset.vidplyAlertOriginalDisplay||"";s.style.display=i.hideDisplay||b||"none",s.setAttribute("aria-hidden","true"),s.removeAttribute("data-vidply-alert-active")}i.resume!==!1&&this.state.paused&&this.play();let p=i.focusTarget||"playButton";this.setManagedTimeout(()=>{this.focusMetadataTarget(p,s)},(y=i.focusDelay)!=null?y:100)};l.addEventListener("click",d),this.metadataAlertHandlers.set(e,{button:l,handler:d})}}return s}handleMetadataHashtags(e){if(!Array.isArray(e)||e.length===0)return;let t=this.options.metadataHashtags;t&&e.forEach(i=>{let s=this.resolveMetadataConfig(t,i);if(!s)return;let a=this.normalizeMetadataSelector(s.alert||s.selector||s.target);if(!a)return;let n=document.querySelector(a);if(!n){this.options.debug&&this.log("[Metadata] Hashtag target not found:",a);return}if(this.options.debug&&this.log("[Metadata] Handling hashtag",i,{selector:a,config:s}),this.cacheMetadataAlertContent(n,s),s.title){let c=s.titleSelector||"[data-vidply-alert-title], h3, header",l=n.querySelector(c);l&&(l.textContent=s.title)}if(s.message){let c=s.messageSelector||"[data-vidply-alert-message], p",l=n.querySelector(c);l&&(l.textContent=s.message)}let o=s.show!==!1,r=s.focus!==void 0?s.focus:!1;this.handleMetadataAlert(a,{element:n,show:o,focus:r,autoScroll:s.autoScroll,reason:"hashtag"})})}handleMetadataCue(e){let t=e.text.trim();this.options.debug&&this.log("[Metadata] Processing cue:",{time:e.startTime,text:t}),this.emit("metadata",{time:e.startTime,endTime:e.endTime,text:t,cue:e}),t.includes("PAUSE")&&(this.state.paused||(this.options.debug&&this.log("[Metadata] Pausing video at",e.startTime),this.pause()),this.emit("metadata:pause",{time:e.startTime,text:t}));let i=t.match(/FOCUS:([\w#-]+)/);if(i){let a=i[1],n=this.normalizeMetadataSelector(a),o=n?document.querySelector(n):null;o?(this.options.debug&&this.log("[Metadata] Focusing element:",n),o.tabIndex===-1&&!o.hasAttribute("tabindex")&&o.setAttribute("tabindex","-1"),this.setManagedTimeout(()=>{o.focus({preventScroll:!0})},10)):this.options.debug&&this.log("[Metadata] Element not found:",n||a),this.emit("metadata:focus",{time:e.startTime,target:a,selector:n,element:o,text:t}),n&&this.handleMetadataAlert(n,{element:o,reason:"focus"})}let s=t.match(/#[\w-]+/g);s&&(this.options.debug&&this.log("[Metadata] Hashtags found:",s),this.emit("metadata:hashtags",{time:e.startTime,hashtags:s,text:t}),this.handleMetadataHashtags(s))}};Z.instances=[];F();q();O();ae();var gt=0,Le=class{constructor(e,t={}){this.player=e,this.tracks=[],this.initialTracks=Array.isArray(t.tracks)?t.tracks:[],this.currentIndex=-1,this.instanceId=++gt,this.uniqueId="vidply-playlist-".concat(this.instanceId),this.options=V({autoAdvance:t.autoAdvance!==!1,autoPlayFirst:t.autoPlayFirst!==!1,loop:t.loop||!1,showPanel:t.showPanel!==!1,recreatePlayers:t.recreatePlayers||!1},t),this.container=null,this.playlistPanel=null,this.trackInfoElement=null,this.navigationFeedback=null,this.isPanelVisible=this.options.showPanel!==!1,this.isChangingTrack=!1,this.hostElement=t.hostElement||null,this.PlayerClass=t.PlayerClass||null,this.handleTrackEnd=this.handleTrackEnd.bind(this),this.handleTrackError=this.handleTrackError.bind(this),this.player.playlistManager=this,this.init(),this.updatePlayerControls(),this.initialTracks.length>0&&this.loadPlaylist(this.initialTracks)}getTrackMediaType(e){let t=e.src||"";return t.includes("youtube.com")||t.includes("youtu.be")?"youtube":t.includes("vimeo.com")?"vimeo":t.includes("soundcloud.com")||t.includes("api.soundcloud.com")?"soundcloud":t.includes(".m3u8")?"hls":e.type&&e.type.startsWith("audio/")?"audio":"video"}async recreatePlayerForTrack(e,t=!1){var p;if(!this.hostElement||!this.PlayerClass)return console.warn("VidPly Playlist: Cannot recreate player - missing hostElement or PlayerClass"),!1;let i=this.getTrackMediaType(e),s=i==="audio"?"audio":"video",a=this.isPanelVisible,n=[...this.tracks],o=this.currentIndex;this.trackArtworkElement&&this.trackArtworkElement.parentNode&&this.trackArtworkElement.parentNode.removeChild(this.trackArtworkElement),this.trackInfoElement&&this.trackInfoElement.parentNode&&this.trackInfoElement.parentNode.removeChild(this.trackInfoElement),this.navigationFeedback&&this.navigationFeedback.parentNode&&this.navigationFeedback.parentNode.removeChild(this.navigationFeedback),this.playlistPanel&&this.playlistPanel.parentNode&&this.playlistPanel.parentNode.removeChild(this.playlistPanel);let r=(p=this.player)!=null&&p.options?V({},this.player.options):{};this.player&&(this.player.off("ended",this.handleTrackEnd),this.player.off("error",this.handleTrackError),this.player.destroy()),this.hostElement.innerHTML="";let c=document.createElement(s),l=r.preload||"metadata";c.setAttribute("preload",l),s==="video"&&e.poster&&(i==="video"||i==="hls")&&c.setAttribute("poster",e.poster);let d=["youtube","vimeo","soundcloud","hls"].includes(i);if(!d){let y=document.createElement("source");y.src=e.src,e.type&&(y.type=e.type),c.appendChild(y),e.tracks&&e.tracks.length>0&&e.tracks.forEach(b=>{let v=document.createElement("track");v.src=b.src,v.kind=b.kind||"captions",v.srclang=b.srclang||"en",v.label=b.label||b.srclang,b.default&&(v.default=!0),c.appendChild(v)})}this.hostElement.appendChild(c);let h={mediaType:s,poster:e.poster,audioDescriptionSrc:e.audioDescriptionSrc||null,audioDescriptionDuration:e.audioDescriptionDuration||null,signLanguageSrc:e.signLanguageSrc||null};if(Object.assign(h,r),this.player=new this.PlayerClass(c,h),this.player.playlistManager=this,await new Promise(y=>{this.player.on("ready",y)}),this.player.on("ended",this.handleTrackEnd),this.player.on("error",this.handleTrackError),this.player.container){if(this.trackArtworkElement){let y=this.player.container.querySelector(".vidply-video-wrapper");y?this.player.container.insertBefore(this.trackArtworkElement,y):this.player.container.appendChild(this.trackArtworkElement)}this.trackInfoElement&&this.player.container.appendChild(this.trackInfoElement),this.navigationFeedback&&this.player.container.appendChild(this.navigationFeedback),this.playlistPanel&&this.player.container.appendChild(this.playlistPanel)}return this.container=this.player.container,this.updatePlayerControls(),this.tracks=n,this.currentIndex=o,this.updatePlaylistUI(),this.isPanelVisible=a,this.playlistPanel&&(this.playlistPanel.style.display=a?"":"none"),d?this.player.load({src:e.src,type:e.type,poster:e.poster,tracks:e.tracks||[],audioDescriptionSrc:e.audioDescriptionSrc||null,signLanguageSrc:e.signLanguageSrc||null}):this.player.load({src:e.src,type:e.type,poster:e.poster,tracks:e.tracks||[],audioDescriptionSrc:e.audioDescriptionSrc||null,signLanguageSrc:e.signLanguageSrc||null}),t&&setTimeout(()=>{this.player.play()},100),!0}init(){this.player.on("ended",this.handleTrackEnd),this.player.on("error",this.handleTrackError),this.player.on("play",this.handlePlaybackStateChange.bind(this)),this.player.on("pause",this.handlePlaybackStateChange.bind(this)),this.player.on("ended",this.handlePlaybackStateChange.bind(this)),this.player.on("fullscreenchange",this.handleFullscreenChange.bind(this)),this.player.on("audiodescriptionenabled",this.handleAudioDescriptionChange.bind(this)),this.player.on("audiodescriptiondisabled",this.handleAudioDescriptionChange.bind(this)),this.options.showPanel&&this.createUI(),this.tracks.length===0&&this.initialTracks.length===0&&this.loadPlaylistFromAttribute()}loadPlaylistFromAttribute(){if(!this.player.element||!this.player.element.parentElement){console.log("VidPly Playlist: No player element found");return}let t=this.player.element.parentElement.parentElement,i=t?t.parentElement:null;if(!i){console.log("VidPly Playlist: No original element found");return}this.loadOptionsFromAttributes(i);let s=i.getAttribute("data-playlist");if(!s){console.log("VidPly Playlist: No data-playlist attribute found");return}console.log("VidPly Playlist: Found data-playlist attribute, parsing...");try{let a=JSON.parse(s);Array.isArray(a)&&a.length>0?(console.log("VidPly Playlist: Loaded ".concat(a.length," tracks from data-playlist")),this.loadPlaylist(a)):console.warn("VidPly Playlist: data-playlist is not a valid array or is empty")}catch(a){console.error("VidPly Playlist: Failed to parse data-playlist attribute",a)}}loadOptionsFromAttributes(e){let t=e.getAttribute("data-playlist-auto-advance");t!==null&&(this.options.autoAdvance=t==="true");let i=e.getAttribute("data-playlist-auto-play-first");i!==null&&(this.options.autoPlayFirst=i==="true");let s=e.getAttribute("data-playlist-loop");s!==null&&(this.options.loop=s==="true");let a=e.getAttribute("data-playlist-show-panel");a!==null&&(this.options.showPanel=a==="true"),console.log("VidPly Playlist: Options from attributes:",this.options)}updatePlayerControls(){if(!this.player.controlBar)return;let e=this.player.controlBar;e.element.innerHTML="",e.createControls(),e.attachEvents(),e.setupAutoHide()}loadPlaylist(e){this.tracks=e,this.currentIndex=-1,this.container&&this.container.classList.add("vidply-has-playlist"),this.playlistPanel&&this.renderPlaylist(),e.length>0&&(this.options.autoPlayFirst?this.play(0):this.loadTrack(0).catch(()=>{})),this.updatePlaylistVisibilityInFullscreen()}async loadTrack(e){var s,a;if(e<0||e>=this.tracks.length){console.warn("VidPly Playlist: Invalid track index",e);return}let t=this.tracks[e];if(this.selectTrack(e),this.isChangingTrack=!0,this.options.recreatePlayers&&this.hostElement&&this.PlayerClass){let n=this.player?this.player.element.tagName==="AUDIO"?"audio":"video":null,o=this.getTrackMediaType(t);if(n!==(o==="audio"||o==="soundcloud"?"audio":"video")){await this.recreatePlayerForTrack(t,!1),this.selectTrack(e),this.player.emit("playlisttrackchange",{index:e,item:t,total:this.tracks.length}),setTimeout(()=>{this.isChangingTrack=!1},150);return}}let i=this.player.load({src:t.src,type:t.type,poster:t.poster,tracks:t.tracks||[],audioDescriptionSrc:t.audioDescriptionSrc||null,signLanguageSrc:t.signLanguageSrc||null,signLanguageSources:t.signLanguageSources||{}});(a=(s=this.player)==null?void 0:s.options)!=null&&a.deferLoad&&typeof this.player.ensureLoaded=="function"&&Promise.resolve(i).then(()=>{var n,o;return(o=(n=this.player)==null?void 0:n.ensureLoaded)==null?void 0:o.call(n)}).catch(()=>{}),this.player.emit("playlisttrackchange",{index:e,item:t,total:this.tracks.length}),setTimeout(()=>{this.isChangingTrack=!1},150)}selectTrack(e){var i,s,a,n;if(e<0||e>=this.tracks.length){console.warn("VidPly Playlist: Invalid track index",e);return}let t=this.tracks[e];this.currentIndex=e;try{if(((s=(i=this.player)==null?void 0:i.element)==null?void 0:s.tagName)==="VIDEO")if(t.poster){let r=typeof this.player.resolvePosterPath=="function"?this.player.resolvePosterPath(t.poster):t.poster;this.player.element.poster=r,(n=(a=this.player).applyPosterAspectRatio)==null||n.call(a,r)}else this.player.element.removeAttribute("poster");if(this.player.audioDescriptionSrc=t.audioDescriptionSrc||null,this.player.signLanguageSrc=t.signLanguageSrc||null,this.player.signLanguageSources=t.signLanguageSources||{},t.duration&&Number(t.duration)>0&&(this.player.state.duration=Number(t.duration)),this.player.audioDescriptionManager&&(this.player.audioDescriptionManager.src=t.audioDescriptionSrc||null,this.player.audioDescriptionManager.originalSource=t.src||this.player.originalSrc||null),this.player.signLanguageManager&&(this.player.signLanguageManager.src=t.signLanguageSrc||null,this.player.signLanguageManager.sources=t.signLanguageSources||{},this.player.signLanguageManager.currentLanguage=null),t.src&&!this.player.originalSrc&&(this.player.originalSrc=t.src),Array.from(this.player.element.querySelectorAll("track")).forEach(r=>r.remove()),Array.isArray(t.tracks)&&t.tracks.forEach(r=>{if(!(r!=null&&r.src))return;let c=document.createElement("track");c.src=r.src,c.kind=r.kind||"captions",c.srclang=r.srclang||"en",c.label=r.label||r.srclang||"Track",r.default&&(c.default=!0),r.describedSrc&&c.setAttribute("data-desc-src",r.describedSrc),this.player.element.appendChild(c)}),typeof this.player.invalidateTrackCache=="function"&&this.player.invalidateTrackCache(),this.player.audioDescriptionManager&&typeof this.player.audioDescriptionManager.initFromSourceElements=="function")try{this.player.audioDescriptionManager.captionTracks=[],this.player.audioDescriptionManager.initFromSourceElements(this.player.sourceElements,this.player.trackElements)}catch(r){}if(this.player.captionManager&&typeof this.player.captionManager.loadTracks=="function")try{this.player.captionManager.tracks=[],this.player.captionManager.currentTrack=null,this.player.captionManager.loadTracks()}catch(r){}typeof this.player.updateControlBar=="function"&&this.player.updateControlBar()}catch(o){}this.updateTrackInfo(t),this.updatePlaylistUI(),this.player.emit("playlisttrackselect",{index:e,item:t,total:this.tracks.length})}async play(e,t=!1){var a,n;if(e<0||e>=this.tracks.length){console.warn("VidPly Playlist: Invalid track index",e);return}let i=this.tracks[e];if(this.isChangingTrack=!0,this.currentIndex=e,this.options.recreatePlayers&&this.hostElement&&this.PlayerClass){let o=this.player?this.player.element.tagName==="AUDIO"?"audio":"video":null,r=this.getTrackMediaType(i);if(o!==(r==="audio"||r==="soundcloud"?"audio":"video")){await this.recreatePlayerForTrack(i,!0),this.updateTrackInfo(i),this.updatePlaylistUI(),this.player.emit("playlisttrackchange",{index:e,item:i,total:this.tracks.length}),setTimeout(()=>{this.isChangingTrack=!1},150);return}}let s=i.src;(n=(a=this.player)==null?void 0:a.audioDescriptionManager)!=null&&n.desiredState&&i.audioDescriptionSrc&&(this.player.originalSrc=i.src,this.player.audioDescriptionManager.originalSource=i.src,this.player.audioDescriptionManager.src=i.audioDescriptionSrc,s=i.audioDescriptionSrc),this.player.load({src:s,type:i.type,poster:i.poster,tracks:i.tracks||[],audioDescriptionSrc:i.audioDescriptionSrc||null,signLanguageSrc:i.signLanguageSrc||null,signLanguageSources:i.signLanguageSources||{}}),this.updateTrackInfo(i),this.updatePlaylistUI(),this.player.emit("playlisttrackchange",{index:e,item:i,total:this.tracks.length}),setTimeout(()=>{this.player.play(),setTimeout(()=>{this.isChangingTrack=!1},50)},100)}next(){let e=this.currentIndex+1;if(e>=this.tracks.length)if(this.options.loop)e=0;else return;this.play(e)}previous(){let e=this.currentIndex-1;if(e<0)if(this.options.loop)e=this.tracks.length-1;else return;this.play(e)}handleTrackEnd(){this.isChangingTrack||this.options.autoAdvance&&this.next()}isExternalRendererUrl(e){return e?e.includes("youtube.com")||e.includes("youtu.be")||e.includes("vimeo.com")||e.includes("soundcloud.com")||e.includes("api.soundcloud.com")||e.includes(".m3u8"):!1}handleTrackError(e){let t=this.getCurrentTrack();t&&t.src&&this.isExternalRendererUrl(t.src)||this.isChangingTrack||(console.error("VidPly Playlist: Track error",e),this.options.autoAdvance&&setTimeout(()=>{this.next()},1e3))}handlePlaybackStateChange(){this.updatePlaylistVisibilityInFullscreen()}handleFullscreenChange(){setTimeout(()=>{this.updatePlaylistVisibilityInFullscreen()},50)}handleAudioDescriptionChange(){let e=this.getCurrentTrack();e&&(this.updateTrackInfo(e),this.updatePlaylistUI(),this.updatePlaylistDurations())}updatePlaylistDurations(){if(!this.playlistPanel)return;this.playlistPanel.querySelectorAll(".vidply-playlist-item").forEach((t,i)=>{let s=this.tracks[i];if(!s)return;let a=this.getEffectiveDuration(s),n=a?A.formatTime(a):"",o=t.querySelector(".vidply-playlist-duration-badge");o&&(o.textContent=n);let r=t.querySelector(".vidply-playlist-item-duration");r&&(r.textContent=n)})}getEffectiveDuration(e){return e?this.player.state.audioDescriptionEnabled&&e.audioDescriptionDuration?e.audioDescriptionDuration:e.duration||null:null}updatePlaylistVisibilityInFullscreen(){if(!this.playlistPanel||!this.tracks.length)return;let e=this.player.state.fullscreen,t=this.player.state.playing;e?t?(this.playlistPanel.classList.remove("vidply-playlist-fullscreen-visible"),setTimeout(()=>{this.player.state.playing&&this.player.state.fullscreen&&(this.playlistPanel.style.display="none")},300)):(this.playlistPanel.classList.add("vidply-playlist-fullscreen-visible"),this.playlistPanel.style.display="block"):(this.playlistPanel.classList.remove("vidply-playlist-fullscreen-visible"),this.isPanelVisible&&this.tracks.length>0?this.playlistPanel.style.display="block":this.playlistPanel.style.display="none")}createUI(){if(this.container=this.player.container,!this.container){console.warn("VidPly Playlist: No container found");return}this.trackInfoElement=g.createElement("div",{className:"vidply-track-info",attributes:{role:"status"}}),this.trackInfoElement.style.display="none",this.container.appendChild(this.trackInfoElement),this.navigationFeedback=g.createElement("div",{className:"vidply-sr-only",attributes:{role:"status","aria-live":"polite","aria-atomic":"true"}}),this.container.appendChild(this.navigationFeedback),this.playlistPanel=g.createElement("div",{className:"vidply-playlist-panel",attributes:{id:"".concat(this.uniqueId,"-panel"),role:"region","aria-label":m.t("playlist.title"),"aria-labelledby":"".concat(this.uniqueId,"-heading")}}),this.playlistPanel.style.display=(this.isPanelVisible,"none"),this.container.appendChild(this.playlistPanel)}updateTrackInfo(e){if(!this.trackInfoElement)return;let t=this.currentIndex+1,i=this.tracks.length,s=e.title||m.t("playlist.untitled"),a=e.artist||"",n=this.getEffectiveDuration(e),o=n?A.formatTime(n):"",r=n?A.formatDuration(n):"",c=a?m.t("playlist.by")+a:"",l=r?". ".concat(r):"",d=m.t("playlist.nowPlaying",{current:t,total:i,title:s,artist:c})+l,h=m.t("playlist.trackOf",{current:t,total:i}),p=o?'<span class="vidply-track-duration" aria-hidden="true">'.concat(g.escapeHTML(o),"</span>"):"",y=e.description||"";this.trackInfoElement.innerHTML='\n      <span class="vidply-sr-only">'.concat(g.escapeHTML(d),'</span>\n      <div class="vidply-track-header" aria-hidden="true">\n        <span class="vidply-track-number">').concat(g.escapeHTML(h),"</span>\n        ").concat(p,'\n      </div>\n      <div class="vidply-track-title" aria-hidden="true">').concat(g.escapeHTML(s),"</div>\n      ").concat(a?'<div class="vidply-track-artist" aria-hidden="true">'.concat(g.escapeHTML(a),"</div>"):"","\n      ").concat(y?'<div class="vidply-track-description" aria-hidden="true">'.concat(g.escapeHTML(y),"</div>"):"","\n    "),this.trackInfoElement.style.display="block",this.updateTrackArtwork(e)}updateTrackArtwork(e){var t,i;if(((i=(t=this.player)==null?void 0:t.element)==null?void 0:i.tagName)!=="AUDIO"){this.trackArtworkElement&&(this.trackArtworkElement.style.display="none");return}if(!this.trackArtworkElement&&this.container){this.trackArtworkElement=g.createElement("div",{className:"vidply-track-artwork",attributes:{"aria-hidden":"true"}}),this.trackArtworkElement.style.display="none";let s=this.container.querySelector(".vidply-video-wrapper");s?this.container.insertBefore(this.trackArtworkElement,s):this.container.appendChild(this.trackArtworkElement)}this.trackArtworkElement&&(e.poster?(this.trackArtworkElement.style.backgroundImage="url(".concat(e.poster,")"),this.trackArtworkElement.style.display="block"):this.trackArtworkElement.style.display="none")}renderPlaylist(){if(!this.playlistPanel)return;this.playlistPanel.innerHTML="";let e=g.createElement("h2",{className:"vidply-playlist-header",attributes:{id:"".concat(this.uniqueId,"-heading")}});e.textContent="".concat(m.t("playlist.title")," (").concat(this.tracks.length,")"),this.playlistPanel.appendChild(e);let t=g.createElement("div",{className:"vidply-sr-only",attributes:{id:"".concat(this.uniqueId,"-keyboard-instructions")}});t.textContent=m.t("playlist.keyboardInstructions"),this.playlistPanel.appendChild(t);let i=g.createElement("ul",{className:"vidply-playlist-list",attributes:{role:"listbox","aria-labelledby":"".concat(this.uniqueId,"-heading"),"aria-describedby":"".concat(this.uniqueId,"-keyboard-instructions")}});this.tracks.forEach((s,a)=>{let n=this.createPlaylistItem(s,a);i.appendChild(n)}),this.playlistPanel.appendChild(i),this.isPanelVisible&&(this.playlistPanel.style.display="block")}createPlaylistItem(e,t){let i=m.t("playlist.trackOf",{current:t+1,total:this.tracks.length}),s=e.title||m.t("playlist.trackUntitled",{number:t+1}),a=e.artist?m.t("playlist.by")+e.artist:"",n=this.getEffectiveDuration(e),o=n?A.formatTime(n):"",r=n?A.formatDuration(n):"",c=t===this.currentIndex,l="".concat(s).concat(a);r&&(l+=". ".concat(r));let d=g.createElement("li",{className:c?"vidply-playlist-item vidply-playlist-item-active":"vidply-playlist-item",attributes:{"data-playlist-index":t}}),h=g.createElement("button",{className:"vidply-playlist-item-button",attributes:{type:"button",role:"option",tabIndex:t===0?0:-1,"aria-label":l,"aria-posinset":t+1,"aria-setsize":this.tracks.length,"aria-checked":c?"true":"false"}});c&&(h.setAttribute("aria-current","true"),h.setAttribute("tabIndex","0"));let p=g.createElement("span",{className:"vidply-playlist-thumbnail-container",attributes:{"aria-hidden":"true"}}),y=g.createElement("span",{className:"vidply-playlist-thumbnail"});if(e.poster)y.style.backgroundImage="url(".concat(e.poster,")");else{let w=T("music");w.classList.add("vidply-playlist-thumbnail-icon"),y.appendChild(w)}if(p.appendChild(y),o&&e.poster){let w=g.createElement("span",{className:"vidply-playlist-duration-badge"});w.textContent=o,p.appendChild(w)}h.appendChild(p);let b=g.createElement("span",{className:"vidply-playlist-item-info",attributes:{"aria-hidden":"true"}}),v=g.createElement("span",{className:"vidply-playlist-item-title-row"}),f=g.createElement("span",{className:"vidply-playlist-item-title"});if(f.textContent=s,v.appendChild(f),o&&!e.poster){let w=g.createElement("span",{className:"vidply-playlist-item-duration"});w.textContent=o,v.appendChild(w)}if(b.appendChild(v),e.artist){let w=g.createElement("span",{className:"vidply-playlist-item-artist"});w.textContent=e.artist,b.appendChild(w)}if(e.description){let w=g.createElement("span",{className:"vidply-playlist-item-description"});w.textContent=e.description,b.appendChild(w)}h.appendChild(b);let L=T("play");return L.classList.add("vidply-playlist-item-icon"),L.setAttribute("aria-hidden","true"),h.appendChild(L),h.addEventListener("click",()=>{let w=this.tracks[t];this.isExternalRendererUrl(w==null?void 0:w.src)&&this.player.state.fullscreen?(this.player.exitFullscreen(),setTimeout(()=>{this.play(t,!0)},100)):this.play(t,!0)}),h.addEventListener("keydown",w=>{this.handlePlaylistItemKeydown(w,t)}),d.appendChild(h),d}handlePlaylistItemKeydown(e,t){let i=Array.from(this.playlistPanel.querySelectorAll(".vidply-playlist-item-button")),s=-1,a="";switch(e.key){case"Enter":case" ":e.preventDefault(),e.stopPropagation();{let n=this.tracks[t];this.isExternalRendererUrl(n==null?void 0:n.src)&&this.player.state.fullscreen?(this.player.exitFullscreen(),setTimeout(()=>{this.play(t,!0)},100)):this.play(t,!0)}return;case"ArrowDown":e.preventDefault(),e.stopPropagation(),t<i.length-1?s=t+1:a=m.t("playlist.endOfPlaylist",{current:i.length,total:i.length});break;case"ArrowUp":e.preventDefault(),e.stopPropagation(),t>0?s=t-1:a=m.t("playlist.beginningOfPlaylist",{total:i.length});break;case"PageDown":e.preventDefault(),e.stopPropagation(),s=Math.min(t+5,i.length-1),s===i.length-1&&t!==s&&(a=m.t("playlist.jumpedToLastTrack",{current:s+1,total:i.length}));break;case"PageUp":e.preventDefault(),e.stopPropagation(),s=Math.max(t-5,0),s===0&&t!==s&&(a=m.t("playlist.jumpedToFirstTrack",{total:i.length}));break;case"Home":e.preventDefault(),e.stopPropagation(),s=0,t!==0&&(a=m.t("playlist.firstTrack",{total:i.length}));break;case"End":e.preventDefault(),e.stopPropagation(),s=i.length-1,t!==i.length-1&&(a=m.t("playlist.lastTrack",{current:i.length,total:i.length}));break}if(s!==-1&&s!==t){i[t].setAttribute("tabIndex","-1"),i[s].setAttribute("tabIndex","0"),i[s].focus({preventScroll:!1});let n=i[s].closest(".vidply-playlist-item");n&&n.scrollIntoView({behavior:"smooth",block:"nearest"})}a&&this.navigationFeedback&&(this.navigationFeedback.textContent=a,setTimeout(()=>{this.navigationFeedback&&(this.navigationFeedback.textContent="")},1e3))}updatePlaylistUI(){if(!this.playlistPanel)return;let e=this.playlistPanel.querySelectorAll(".vidply-playlist-item"),t=this.playlistPanel.querySelectorAll(".vidply-playlist-item-button");e.forEach((i,s)=>{let a=t[s];if(!a)return;let n=this.tracks[s],o=m.t("playlist.trackOf",{current:s+1,total:this.tracks.length}),r=n.title||m.t("playlist.trackUntitled",{number:s+1}),c=n.artist?m.t("playlist.by")+n.artist:"",l=this.getEffectiveDuration(n),d=l?A.formatDuration(l):"";if(s===this.currentIndex){i.classList.add("vidply-playlist-item-active"),a.setAttribute("aria-current","true"),a.setAttribute("aria-checked","true"),a.setAttribute("tabIndex","0");let h="".concat(r).concat(c);d&&(h+=". ".concat(d)),a.setAttribute("aria-label",h),i.scrollIntoView({behavior:"smooth",block:"nearest"})}else{i.classList.remove("vidply-playlist-item-active"),a.removeAttribute("aria-current"),a.setAttribute("aria-checked","false"),a.setAttribute("tabIndex","-1");let h="".concat(r).concat(c);d&&(h+=". ".concat(d)),a.setAttribute("aria-label",h)}})}getCurrentTrack(){return this.tracks[this.currentIndex]||null}getPlaylistInfo(){return{currentIndex:this.currentIndex,totalTracks:this.tracks.length,currentTrack:this.getCurrentTrack(),hasNext:this.hasNext(),hasPrevious:this.hasPrevious()}}hasNext(){return this.options.loop?!0:this.currentIndex<this.tracks.length-1}hasPrevious(){return this.options.loop?!0:this.currentIndex>0}addTrack(e){this.tracks.push(e),this.playlistPanel&&this.renderPlaylist()}removeTrack(e){e<0||e>=this.tracks.length||(this.tracks.splice(e,1),e<this.currentIndex?this.currentIndex--:e===this.currentIndex&&(this.currentIndex>=this.tracks.length&&(this.currentIndex=this.tracks.length-1),this.currentIndex>=0&&this.play(this.currentIndex)),this.playlistPanel&&this.renderPlaylist())}clear(){this.tracks=[],this.currentIndex=-1,this.playlistPanel&&(this.playlistPanel.innerHTML="",this.playlistPanel.style.display="none"),this.trackInfoElement&&(this.trackInfoElement.innerHTML="",this.trackInfoElement.style.display="none"),this.trackArtworkElement&&(this.trackArtworkElement.style.backgroundImage="",this.trackArtworkElement.style.display="none")}togglePanel(e){return this.playlistPanel?((e!==void 0?e:this.playlistPanel.style.display==="none")?(this.playlistPanel.style.display="block",this.isPanelVisible=!0,this.tracks.length>0&&setTimeout(()=>{let i=this.playlistPanel.querySelector('.vidply-playlist-item[tabindex="0"]');i&&i.focus({preventScroll:!0})},100),this.player.controlBar&&this.player.controlBar.controls.playlistToggle&&(this.player.controlBar.controls.playlistToggle.setAttribute("aria-expanded","true"),this.player.controlBar.controls.playlistToggle.setAttribute("aria-pressed","true"))):(this.playlistPanel.style.display="none",this.isPanelVisible=!1,this.player.controlBar&&this.player.controlBar.controls.playlistToggle&&(this.player.controlBar.controls.playlistToggle.setAttribute("aria-expanded","false"),this.player.controlBar.controls.playlistToggle.setAttribute("aria-pressed","false"),this.player.controlBar.controls.playlistToggle.focus({preventScroll:!0}))),this.isPanelVisible):!1}showPanel(){return this.togglePanel(!0)}hidePanel(){return this.togglePanel(!1)}destroy(){this.player.off("ended",this.handleTrackEnd),this.player.off("error",this.handleTrackError),this.trackArtworkElement&&this.trackArtworkElement.remove(),this.trackInfoElement&&this.trackInfoElement.remove(),this.playlistPanel&&this.playlistPanel.remove(),this.clear()}};function st(){document.querySelectorAll("[data-vidply]").forEach(e=>{let t=e.dataset.vidplyOptions?JSON.parse(e.dataset.vidplyOptions):{},i=mt(e.dataset),s=V(V({},i),t);new Z(e,s)})}function mt(u){let e={},t={signLanguageSrc:"signLanguageSrc",signLanguageButton:"signLanguageButton",signLanguagePosition:"signLanguagePosition",signLanguageDisplayMode:"signLanguageDisplayMode",audioDescriptionSrc:"audioDescriptionSrc",audioDescriptionButton:"audioDescriptionButton",autoplay:"autoplay",loop:"loop",muted:"muted",controls:"controls",poster:"poster",width:"width",height:"height",language:"language",captions:"captions",captionsDefault:"captionsDefault",transcript:"transcript",transcriptButton:"transcriptButton",keyboard:"keyboard",responsive:"responsive",pipButton:"pipButton",fullscreenButton:"fullscreenButton"};Object.keys(t).forEach(s=>{let a=t[s],n=u[s];n!==void 0&&(n==="true"?e[a]=!0:n==="false"?e[a]=!1:!isNaN(n)&&n!==""?e[a]=Number(n):e[a]=n)});let i={};if(Object.keys(u).forEach(s=>{if(s.startsWith("signLanguageSrc")&&s!=="signLanguageSrc"){let a=s.match(/^signLanguageSrc([A-Z][a-z]*)$/);if(a){let n=a[1].toLowerCase();i[n]=u[s]}}}),Object.keys(i).length>0&&(e.signLanguageSources=i,u.signLanguageSrc&&!e.signLanguageSrc&&(e.signLanguageSrc=u.signLanguageSrc)),u.vidplyLanguageFiles)try{e.languageFiles=JSON.parse(u.vidplyLanguageFiles)}catch(s){console.warn("Invalid JSON in data-vidply-language-files:",s)}if(u.vidplyLanguageFile)try{let s=JSON.parse(u.vidplyLanguageFile);typeof s=="object"&&s!==null&&(e.languageFiles=s)}catch(s){u.vidplyLanguageFileCode&&u.vidplyLanguageFileUrl&&(e.languageFile=u.vidplyLanguageFileCode,e.languageFileUrl=u.vidplyLanguageFileUrl)}else u.vidplyLanguageFileCode&&u.vidplyLanguageFileUrl&&(e.languageFile=u.vidplyLanguageFileCode,e.languageFileUrl=u.vidplyLanguageFileUrl);return e}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",st):st();var Yi=Z;})();
