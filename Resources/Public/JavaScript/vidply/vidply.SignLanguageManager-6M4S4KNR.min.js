/*!
 * Universal, Accessible Video Player
 * (c) 2026 Matthias Peltzer
 * Released under GPL-2.0-or-later License
 */
import{DraggableResizable as e,attachMenuKeyboardNavigation as t,createIconElement as i,createLabeledSelect as s,createMenuItem as a,focusFirstMenuItem as n,preventDragOnElement as r}from"./vidply.chunk-7OK6TG2Y.min.js";import{DOMUtils as l,i18n as o}from"./vidply.chunk-YLKHFL57.min.js";var h=class{constructor(e){this.player=e,this.src=e.options.signLanguageSrc,this.sources=e.options.signLanguageSources||{},this.currentLanguage=null,this.desiredPosition=e.options.signLanguagePosition||"bottom-right",this.wrapper=null,this.header=null,this.video=null,this.selector=null,this.settingsButton=null,this.settingsMenu=null,this.resizeHandles=[],this.enabled=!1,this.inMainView=!1,this.mainViewOriginalSrc=null,this.mainViewOriginalSources=null,this._mainViewUsingSourceSwap=!1,this._mainViewMutedBefore=!1,this.settingsMenuVisible=!1,this.settingsMenuJustOpened=!1,this.documentClickHandlerAdded=!1,this.handlers=null,this.settingsHandlers=null,this.interactionHandlers=null,this.draggable=null,this.documentClickHandler=null,this.settingsMenuKeyHandler=null,this.customKeyHandler=null,this.dragOptionButton=null,this.dragOptionText=null,this.resizeOptionButton=null,this.resizeOptionText=null}isAvailable(){return Object.keys(this.sources).length>0||!!this.src}enable(){const e=Object.keys(this.sources).length>0;if(!e&&!this.src)return void console.warn("No sign language video source provided");if(this.wrapper)return this.wrapper.style.display="block",this.enabled=!0,this.player.state.signLanguageEnabled=!0,this.player.emit("signlanguageenabled"),void this.player.setManagedTimeout(()=>{this.settingsButton&&document.contains(this.settingsButton)&&this.settingsButton.focus({preventScroll:!0})},150);let t=null,i=null;e?(t=this._determineInitialLanguage(),i=this.sources[t],this.currentLanguage=t):i=this.src,this._createWrapper(),this._createHeader(e,t),this._createVideo(i),this._createResizeHandles(),this.wrapper.appendChild(this.header),this.wrapper.appendChild(this.video),this.resizeHandles.forEach(e=>this.wrapper.appendChild(e)),this._applyInitialSize(),this.player.container.appendChild(this.wrapper),requestAnimationFrame(()=>{this.constrainPosition()}),this.video.currentTime=this.player.state.currentTime,this.player.state.paused||this.video.play(),this._setupInteraction(),this._setupEventHandlers(e),this.enabled=!0,this.player.state.signLanguageEnabled=!0,this.player.emit("signlanguageenabled"),this.player.setManagedTimeout(()=>{this.settingsButton&&document.contains(this.settingsButton)&&this.settingsButton.focus({preventScroll:!0})},150)}disable(){this.settingsMenuVisible&&this.hideSettingsMenu({focusButton:!1}),this.wrapper&&(this.wrapper.style.display="none"),this.enabled=!1,this.player.state.signLanguageEnabled=!1,this.player.emit("signlanguagedisabled")}toggle(){this.enabled?this.disable():this.enable()}async enableInMainView(){const e=Object.keys(this.sources).length>0;if(!e&&!this.src)return;if(!this.player.element||"VIDEO"!==this.player.element.tagName)return;if(this.inMainView)return;let t;if(e){const e=this._determineInitialLanguage();this.currentLanguage=e,t=this.sources[e]}else t=this.src;const i=this.player.element,s=this.player.state.currentTime,a=this.player.state.playing,n=i.poster||i.getAttribute("poster")||this.player.options.poster,r=s<.1&&!a,l=Array.from(i.querySelectorAll("source")),o=l[0];if(this.mainViewOriginalSrc=i.currentSrc&&i.currentSrc.length>0?i.currentSrc:i.src&&i.src.length>0?i.src:o&&o.getAttribute("src")?o.getAttribute("src"):"",this._mainViewMutedBefore=this.player.state.muted,n&&r&&"VIDEO"===i.tagName&&(i.poster=n),l.length>0){this.mainViewOriginalSources=l,this.mainViewOriginalSources.forEach(e=>e.remove());const e=document.createElement("source");e.setAttribute("src",t);const s=this._inferVideoType(t);s&&e.setAttribute("type",s);const a=i.querySelector("track");a?i.insertBefore(e,a):i.appendChild(e),this._mainViewUsingSourceSwap=!0}else i.src=t,this._mainViewUsingSourceSwap=!1;i.muted=!0,this.player.currentSource=t,"function"==typeof this.player.invalidateTrackCache&&this.player.invalidateTrackCache(),i.load(),await this._waitForMediaReadyMainView(s>0||a),s>0&&(this.player.seek(s),await new Promise(e=>setTimeout(e,100))),a?await this.player.play():(this.player.pause(),!r&&this.player.hidePosterOverlay&&this.player.hidePosterOverlay()),this.inMainView=!0,this.player.state.signLanguageInMainView=!0,this.player.videoWrapper&&this.player.videoWrapper.classList.add("vidply-sign-language-main-view-active"),this.player.emit("signlanguageinmainviewenabled")}async disableInMainView(){if(!this.inMainView)return;if(!this.mainViewOriginalSrc&&!this.mainViewOriginalSources)return this.inMainView=!1,this.player.state.signLanguageInMainView=!1,this.player.videoWrapper&&this.player.videoWrapper.classList.remove("vidply-sign-language-main-view-active"),void this.player.emit("signlanguageinmainviewdisabled");const e=this.player.element,t=this.player.state.currentTime,i=this.player.state.playing;if(e.poster||e.getAttribute("poster"),this._mainViewUsingSourceSwap&&this.mainViewOriginalSources&&this.mainViewOriginalSources.length>0){Array.from(e.querySelectorAll("source")).forEach(e=>e.remove());const t=e.querySelector("track");this.mainViewOriginalSources.forEach(i=>{t?e.insertBefore(i,t):e.appendChild(i)}),this._mainViewUsingSourceSwap=!1}else this.mainViewOriginalSrc&&(e.src=this.mainViewOriginalSrc);if(e.muted=this._mainViewMutedBefore,this.player.currentSource=this.mainViewOriginalSrc||e.querySelector("source")&&e.querySelector("source").src||"","function"==typeof this.player.invalidateTrackCache&&this.player.invalidateTrackCache(),e.load(),await this._waitForMediaReadyMainView(t>0||i),t>0&&this.player.seek(t),i)try{await this.player.play()}catch(e){this.player.log?.("Sign language main view: play after restore failed",e,"warn")}this.mainViewOriginalSrc=null,this.mainViewOriginalSources=null,this.inMainView=!1,this.player.state.signLanguageInMainView=!1,this.player.videoWrapper&&this.player.videoWrapper.classList.remove("vidply-sign-language-main-view-active"),this.player.emit("signlanguageinmainviewdisabled")}async _waitForMediaReadyMainView(e=!1){const t=this.player.element,i=new Promise(e=>{if(t.readyState>=1)return void e();const i=()=>{t.removeEventListener("loadedmetadata",i),t.removeEventListener("error",s),e()},s=()=>{t.removeEventListener("loadedmetadata",i),t.removeEventListener("error",s),e()};t.addEventListener("loadedmetadata",i),t.addEventListener("error",s,{once:!0})}),s=new Promise(e=>setTimeout(e,1e4));await Promise.race([i,s]),await new Promise(e=>setTimeout(e,300)),e&&await new Promise(e=>{if(t.readyState>=3)e();else{const i=()=>{t.removeEventListener("canplay",i),t.removeEventListener("canplaythrough",i),e()};t.addEventListener("canplay",i,{once:!0}),t.addEventListener("canplaythrough",i,{once:!0}),setTimeout(()=>{t.removeEventListener("canplay",i),t.removeEventListener("canplaythrough",i),e()},3e3)}})}toggleInMainView(){this.inMainView?this.disableInMainView():this.enableInMainView()}switchLanguage(e){if(this.sources[e]){if(this.currentLanguage=e,this.video){const t=this.video.currentTime,i=!this.video.paused;this.video.src=this.sources[e],this.video.currentTime=t,i&&this.video.play().catch(()=>{})}if(this.inMainView&&this.player.element&&"VIDEO"===this.player.element.tagName){const t=this.player.state.currentTime,i=this.player.state.playing;if(this._mainViewUsingSourceSwap){const t=this.player.element.querySelector("source");if(t){t.setAttribute("src",this.sources[e]);const i=this._inferVideoType(this.sources[e]);i&&t.setAttribute("type",i)}}else this.player.element.src=this.sources[e];this.player.currentSource=this.sources[e],"function"==typeof this.player.invalidateTrackCache&&this.player.invalidateTrackCache(),this.player.element.load(),this._waitForMediaReadyMainView(!0).then(()=>{t>0&&this.player.seek(t),i&&this.player.play()})}this.player.emit("signlanguagelanguagechanged",e)}}_inferVideoType(e){if(!e)return"";const t=e.split("?")[0].toLowerCase();return t.endsWith(".mp4")?"video/mp4":t.endsWith(".webm")?"video/webm":t.endsWith(".ogv")||t.endsWith(".ogg")?"video/ogg":""}getLanguageLabel(e){return{en:"English",de:"Deutsch",es:"Español",fr:"Français",it:"Italiano",ja:"日本語",pt:"Português",ar:"العربية",hi:"हिन्दी"}[e]||e.toUpperCase()}_determineInitialLanguage(){if(this.player.captionManager&&this.player.captionManager.currentTrack){const e=this.player.captionManager.currentTrack.language?.toLowerCase().split("-")[0];if(e&&this.sources[e])return e}if(this.player.options.language){const e=this.player.options.language.toLowerCase().split("-")[0];if(this.sources[e])return e}return Object.keys(this.sources)[0]}_createWrapper(){this.wrapper=document.createElement("div"),this.wrapper.className="vidply-sign-language-wrapper",this.wrapper.setAttribute("tabindex","0"),this.wrapper.setAttribute("aria-label",o.t("player.signLanguageDragResize"))}_createHeader(e,t){const i=this.player.options.classPrefix;this.header=l.createElement("div",{className:`${i}-sign-language-header`,attributes:{tabindex:"0"}});const s=l.createElement("div",{className:`${i}-sign-language-header-left`}),a=l.createElement("h3",{textContent:o.t("player.signLanguageVideo")});this._createSettingsButton(s),e&&this._createLanguageSelector(s,t),s.appendChild(a);const n=this._createCloseButton();this.header.appendChild(s),this.header.appendChild(n),this.settingsMenuVisible=!1,this.settingsMenu=null,this.settingsMenuJustOpened=!1}_createSettingsButton(e){const t=this.player.options.classPrefix,s=o.t("player.signLanguageSettings");this.settingsButton=l.createElement("button",{className:`${t}-sign-language-settings`,attributes:{type:"button","aria-label":s,"aria-expanded":"false"}}),this.settingsButton.appendChild(i("settings")),l.attachTooltip(this.settingsButton,s,t),this.settingsHandlers={click:e=>{e.preventDefault(),e.stopPropagation(),this.documentClickHandler&&(this.settingsMenuJustOpened=!0,setTimeout(()=>{this.settingsMenuJustOpened=!1},100)),this.settingsMenuVisible?this.hideSettingsMenu():this.showSettingsMenu()},keydown:e=>{"d"===e.key||"D"===e.key?(e.preventDefault(),e.stopPropagation(),this.toggleKeyboardDragMode()):"r"===e.key||"R"===e.key?(e.preventDefault(),e.stopPropagation(),this.toggleResizeMode()):"Escape"===e.key&&this.settingsMenuVisible&&(e.preventDefault(),e.stopPropagation(),this.hideSettingsMenu())}},this.settingsButton.addEventListener("click",this.settingsHandlers.click),this.settingsButton.addEventListener("keydown",this.settingsHandlers.keydown),e.appendChild(this.settingsButton)}_createLanguageSelector(e,t){const i=this.player.options.classPrefix,a=`${i}-sign-language-select-${Date.now()}`,n=Object.keys(this.sources).map(e=>({value:e,text:this.getLanguageLabel(e),selected:e===t})),{label:o,select:h}=s({classPrefix:i,labelClass:`${i}-sign-language-label`,selectClass:`${i}-sign-language-select`,labelText:"settings.language",selectId:a,options:n,onChange:e=>{e.stopPropagation(),this.switchLanguage(e.target.value)}});this.selector=h;const g=l.createElement("div",{className:`${i}-sign-language-selector-wrapper`});g.appendChild(o),g.appendChild(this.selector),r(g),e.appendChild(g)}_createCloseButton(){const e=this.player.options.classPrefix,t=o.t("player.closeSignLanguage"),s=l.createElement("button",{className:`${e}-sign-language-close`,attributes:{type:"button","aria-label":t}});return s.appendChild(i("close")),l.attachTooltip(s,t,e),s.addEventListener("click",()=>{this.disable(),this.player.controlBar?.controls?.signLanguage&&setTimeout(()=>{this.player.controlBar.controls.signLanguage.focus({preventScroll:!0})},0)}),s}_createVideo(e){this.video=document.createElement("video"),this.video.className="vidply-sign-language-video",this.video.src=e,this.video.setAttribute("aria-label",o.t("player.signLanguage")),this.video.muted=!0,this.video.setAttribute("playsinline","")}_createResizeHandles(){const e=this.player.options.classPrefix;this.resizeHandles=["n","s","e","w","ne","nw","se","sw"].map(t=>{const i=l.createElement("div",{className:`${e}-sign-resize-handle ${e}-sign-resize-${t}`,attributes:{"data-direction":t,"data-vidply-managed-resize":"true","aria-hidden":"true"}});return i.style.display="none",i})}_applyInitialSize(){const e=this.player.storage.getSignLanguagePreferences();this.wrapper.style.width=e?.size?.width?e.size.width:"280px",this.wrapper.style.height="auto"}_setupInteraction(){if(window.innerWidth<768&&!this.player.state.fullscreen&&!1===this.player?.options?.signLanguageDragOnMobile)return void(this.draggable&&(this.draggable.destroy(),this.draggable=null));if(this.draggable)return;const t=this.player.options.classPrefix;this.draggable=new e(this.wrapper,{dragHandle:this.wrapper,resizeHandles:this.resizeHandles,constrainToViewport:!0,maintainAspectRatio:!0,minWidth:150,minHeight:100,classPrefix:`${t}-sign`,keyboardDragKey:"d",keyboardResizeKey:"r",keyboardStep:10,keyboardStepLarge:50,pointerResizeIndicatorText:o.t("player.signLanguageResizeActive"),onPointerResizeToggle:e=>{this.resizeHandles.forEach(t=>{t.style.display=e?"block":"none"})},onDragStart:e=>!(e.target.closest(`.${t}-sign-language-close`)||e.target.closest(`.${t}-sign-language-settings`)||e.target.closest(`.${t}-sign-language-select`)||e.target.closest(`.${t}-sign-language-label`)||e.target.closest(`.${t}-sign-language-settings-menu`))}),this._setupCustomKeyHandler(),this.interactionHandlers={draggable:this.draggable,customKeyHandler:this.customKeyHandler}}_setupCustomKeyHandler(){this.customKeyHandler=e=>{const t=e.key.toLowerCase();if(!this.settingsMenuVisible){if("home"===t)return e.preventDefault(),e.stopPropagation(),void(this.draggable&&(this.draggable.pointerResizeMode&&this.draggable.disablePointerResizeMode(),this.draggable.manuallyPositioned=!1,this.constrainPosition()));if("r"===t)return e.preventDefault(),e.stopPropagation(),void(this.toggleResizeMode()&&this.wrapper.focus({preventScroll:!0}));if("escape"===t){if(e.preventDefault(),e.stopPropagation(),this.draggable?.pointerResizeMode)return void this.draggable.disablePointerResizeMode();if(this.draggable?.keyboardDragMode)return void this.draggable.disableKeyboardDragMode();this.disable(),this.player.controlBar?.controls?.signLanguage&&setTimeout(()=>{this.player.controlBar.controls.signLanguage.focus({preventScroll:!0})},0)}}},this.wrapper.addEventListener("keydown",this.customKeyHandler)}_setupEventHandlers(e){this.handlers={play:()=>{this.video&&this.video.play()},pause:()=>{this.video&&this.video.pause()},timeupdate:()=>{this.video&&Math.abs(this.video.currentTime-this.player.state.currentTime)>.5&&(this.video.currentTime=this.player.state.currentTime)},ratechange:()=>{this.video&&(this.video.playbackRate=this.player.state.playbackSpeed)}},this.player.on("play",this.handlers.play),this.player.on("pause",this.handlers.pause),this.player.on("timeupdate",this.handlers.timeupdate),this.player.on("ratechange",this.handlers.ratechange),e&&(this.handlers.captionChange=()=>{if(this.player.captionManager?.currentTrack&&this.selector){const e=this.player.captionManager.currentTrack.language?.toLowerCase().split("-")[0];e&&this.sources[e]&&this.currentLanguage!==e&&(this.switchLanguage(e),this.selector.value=e)}},this.player.on("captionsenabled",this.handlers.captionChange))}constrainPosition(){if(!this.wrapper||!this.player.videoWrapper)return;if(this.draggable?.manuallyPositioned)return;this.wrapper.style.width||(this.wrapper.style.width="280px");const e=this.player.videoWrapper.getBoundingClientRect(),t=this.player.container.getBoundingClientRect(),i=this.wrapper.getBoundingClientRect(),s=e.left-t.left,a=e.top-t.top,n=e.width,r=e.height;let l,o,h=i.width||280,g=i.height||157.5;const u=16;switch(this.desiredPosition||"bottom-right"){case"bottom-right":default:l=s+n-h-u,o=a+r-g-95;break;case"bottom-left":l=s+u,o=a+r-g-95;break;case"top-right":l=s+n-h-u,o=a+u;break;case"top-left":l=s+u,o=a+u}l=Math.max(s,Math.min(l,s+n-h)),o=Math.max(a,Math.min(o,a+r-g-95)),this.wrapper.style.left=`${l}px`,this.wrapper.style.top=`${o}px`,this.wrapper.style.right="auto",this.wrapper.style.bottom="auto"}showSettingsMenu(){if(this.settingsMenuJustOpened=!0,setTimeout(()=>{this.settingsMenuJustOpened=!1},350),this._addDocumentClickHandler(),this.settingsMenu)return this.settingsMenu.style.display="block",this.settingsMenuVisible=!0,this.settingsButton?.setAttribute("aria-expanded","true"),this._attachMenuKeyboardNavigation(),this._positionSettingsMenu(),this._updateDragOptionState(),this._updateResizeOptionState(),void n(this.settingsMenu,`.${this.player.options.classPrefix}-sign-language-settings-item`);this._createSettingsMenu()}hideSettingsMenu({focusButton:e=!0}={}){this.settingsMenu&&(this.settingsMenu.style.display="none",this.settingsMenuVisible=!1,this.settingsMenuJustOpened=!1,this.settingsMenuKeyHandler&&(this.settingsMenu.removeEventListener("keydown",this.settingsMenuKeyHandler),this.settingsMenuKeyHandler=null),Array.from(this.settingsMenu.querySelectorAll(`.${this.player.options.classPrefix}-sign-language-settings-item`)).forEach(e=>e.setAttribute("tabindex","-1")),this.settingsButton&&(this.settingsButton.setAttribute("aria-expanded","false"),e&&this.settingsButton.focus({preventScroll:!0})))}_addDocumentClickHandler(){this.documentClickHandlerAdded||(this.documentClickHandler=e=>{this.settingsMenuJustOpened||this.settingsButton&&(this.settingsButton===e.target||this.settingsButton.contains(e.target))||this.settingsMenu&&this.settingsMenu.contains(e.target)||this.settingsMenuVisible&&this.hideSettingsMenu()},setTimeout(()=>{document.addEventListener("mousedown",this.documentClickHandler,!0),this.documentClickHandlerAdded=!0},300))}_createSettingsMenu(){const e=this.player.options.classPrefix;this.settingsMenu=l.createElement("div",{className:`${e}-sign-language-settings-menu`,attributes:{role:"menu"}});const t=a({classPrefix:e,itemClass:`${e}-sign-language-settings-item`,icon:"move",label:"player.enableSignDragMode",hasTextClass:!0,onClick:()=>{this.toggleKeyboardDragMode(),this.hideSettingsMenu({focusButton:!1}),this.draggable?.keyboardDragMode&&setTimeout(()=>{this.wrapper?.focus?.({preventScroll:!0})},20)}});t.setAttribute("data-setting","keyboard-drag"),t.setAttribute("role","switch"),t.setAttribute("aria-checked","false"),this._removeTooltipFromMenuItem(t),this.dragOptionButton=t,this.dragOptionText=t.querySelector(`.${e}-settings-text`),this._updateDragOptionState();const i=a({classPrefix:e,itemClass:`${e}-sign-language-settings-item`,icon:"resize",label:"player.enableSignResizeMode",hasTextClass:!0,onClick:e=>{e.preventDefault(),e.stopPropagation(),this.toggleResizeMode({focus:!1})?(this.hideSettingsMenu({focusButton:!1}),setTimeout(()=>{this.wrapper&&this.wrapper.focus({preventScroll:!0})},20)):this.hideSettingsMenu({focusButton:!0})}});i.setAttribute("role","switch"),i.setAttribute("aria-checked","false"),this._removeTooltipFromMenuItem(i),this.resizeOptionButton=i,this.resizeOptionText=i.querySelector(`.${e}-settings-text`),this._updateResizeOptionState();const s=a({classPrefix:e,itemClass:`${e}-sign-language-settings-item`,icon:"close",label:"transcript.closeMenu",onClick:()=>this.hideSettingsMenu()});this._removeTooltipFromMenuItem(s),this.settingsMenu.appendChild(t),this.settingsMenu.appendChild(i),this.settingsMenu.appendChild(s),this.settingsMenu.style.visibility="hidden",this.settingsMenu.style.display="block",this.settingsButton?.parentNode?this.settingsButton.insertAdjacentElement("afterend",this.settingsMenu):this.wrapper&&this.wrapper.appendChild(this.settingsMenu),this._positionSettingsMenuImmediate(),requestAnimationFrame(()=>{this.settingsMenu&&(this.settingsMenu.style.visibility="visible")}),this._attachMenuKeyboardNavigation(),this.settingsMenuVisible=!0,this.settingsButton?.setAttribute("aria-expanded","true"),this._updateDragOptionState(),this._updateResizeOptionState(),n(this.settingsMenu,`.${e}-sign-language-settings-item`)}_removeTooltipFromMenuItem(e){const t=this.player.options.classPrefix,i=e.querySelector(`.${t}-tooltip`);i&&i.remove();const s=e.querySelector(`.${t}-button-text`);s&&s.remove()}_attachMenuKeyboardNavigation(){this.settingsMenuKeyHandler&&this.settingsMenu.removeEventListener("keydown",this.settingsMenuKeyHandler),this.settingsMenuKeyHandler=t(this.settingsMenu,this.settingsButton,`.${this.player.options.classPrefix}-sign-language-settings-item`,()=>this.hideSettingsMenu({focusButton:!0}))}_positionSettingsMenuImmediate(){if(!this.settingsMenu||!this.settingsButton)return;const e=this.settingsButton.getBoundingClientRect(),t=this.settingsMenu.getBoundingClientRect(),i=window.innerWidth,s=window.innerHeight,a=this.settingsButton.parentElement;if(!a)return;const n=a.getBoundingClientRect(),r=e.left+e.width/2-n.left,l=s-e.bottom;let o=e.bottom-n.top+8,h=null;l<t.height+20&&e.top>l?(o=null,h=n.bottom-n.top-(e.top-n.top)+8,this.settingsMenu.classList.add("vidply-menu-above")):this.settingsMenu.classList.remove("vidply-menu-above");let g=r-t.width/2,u="auto",d="translateX(0)";const p=e.left+e.width/2-t.width/2;p<10?g=0:p+t.width>i-10?(g="auto",u=0):(g=r,d="translateX(-50%)"),null!==o?(this.settingsMenu.style.top=`${o}px`,this.settingsMenu.style.bottom="auto"):null!==h&&(this.settingsMenu.style.top="auto",this.settingsMenu.style.bottom=`${h}px`),"auto"!==g?(this.settingsMenu.style.left=`${g}px`,this.settingsMenu.style.right="auto"):(this.settingsMenu.style.left="auto",this.settingsMenu.style.right=`${u}px`),this.settingsMenu.style.transform=d}_positionSettingsMenu(){requestAnimationFrame(()=>{setTimeout(()=>{this._positionSettingsMenuImmediate()},10)})}toggleKeyboardDragMode(){if(this.draggable){const e=this.draggable.keyboardDragMode;this.draggable.toggleKeyboardDragMode(),!e&&this.draggable.keyboardDragMode&&this._enableMoveMode(),this._updateDragOptionState()}}_enableMoveMode(){this.wrapper.classList.add(`${this.player.options.classPrefix}-sign-move-mode`),this._updateResizeOptionState(),setTimeout(()=>{this.wrapper.classList.remove(`${this.player.options.classPrefix}-sign-move-mode`)},2e3)}toggleResizeMode({focus:e=!0}={}){return!!this.draggable&&(this.draggable.pointerResizeMode?(this.draggable.disablePointerResizeMode({focus:e}),this._updateResizeOptionState(),!1):(this.draggable.enablePointerResizeMode({focus:e}),this._updateResizeOptionState(),!0))}_updateDragOptionState(){if(!this.dragOptionButton)return;const e=!!this.draggable?.keyboardDragMode,t=o.t(e?"player.disableSignDragMode":"player.enableSignDragMode"),i=o.t(e?"player.disableSignDragModeAria":"player.enableSignDragModeAria");this.dragOptionButton.setAttribute("aria-checked",e?"true":"false"),this.dragOptionButton.setAttribute("aria-label",i),this.dragOptionText&&(this.dragOptionText.textContent=t)}_updateResizeOptionState(){if(!this.resizeOptionButton)return;const e=!!this.draggable?.pointerResizeMode,t=o.t(e?"player.disableSignResizeMode":"player.enableSignResizeMode"),i=o.t(e?"player.disableSignResizeModeAria":"player.enableSignResizeModeAria");this.resizeOptionButton.setAttribute("aria-checked",e?"true":"false"),this.resizeOptionButton.setAttribute("aria-label",i),this.resizeOptionText&&(this.resizeOptionText.textContent=t)}savePreferences(){this.wrapper&&this.player.storage.saveSignLanguagePreferences({size:{width:this.wrapper.style.width}})}updateSources(e,t){this.src=e||null,this.sources=t||{},this.currentLanguage=null}cleanup(){if(this.inMainView&&this.player.element){const e=this.player.element;if(this._mainViewUsingSourceSwap&&this.mainViewOriginalSources&&this.mainViewOriginalSources.length>0){Array.from(e.querySelectorAll("source")).forEach(e=>e.remove());const t=e.querySelector("track");this.mainViewOriginalSources.forEach(i=>{t?e.insertBefore(i,t):e.appendChild(i)}),this._mainViewUsingSourceSwap=!1}else this.mainViewOriginalSrc&&(e.src=this.mainViewOriginalSrc);e.muted=this._mainViewMutedBefore,"function"==typeof this.player.invalidateTrackCache&&this.player.invalidateTrackCache(),e.load(),this.mainViewOriginalSrc=null,this.mainViewOriginalSources=null,this.inMainView=!1,this.player.state.signLanguageInMainView=!1,this.player.videoWrapper&&this.player.videoWrapper.classList.remove("vidply-sign-language-main-view-active"),this.player.emit("signlanguageinmainviewdisabled")}this.settingsMenuVisible&&this.hideSettingsMenu({focusButton:!1}),this.documentClickHandler&&this.documentClickHandlerAdded&&(document.removeEventListener("mousedown",this.documentClickHandler,!0),this.documentClickHandlerAdded=!1,this.documentClickHandler=null),this.settingsHandlers&&this.settingsButton&&(this.settingsButton.removeEventListener("click",this.settingsHandlers.click),this.settingsButton.removeEventListener("keydown",this.settingsHandlers.keydown)),this.settingsHandlers=null,this.handlers&&(this.player.off("play",this.handlers.play),this.player.off("pause",this.handlers.pause),this.player.off("timeupdate",this.handlers.timeupdate),this.player.off("ratechange",this.handlers.ratechange),this.handlers.captionChange&&this.player.off("captionsenabled",this.handlers.captionChange),this.handlers=null),this.wrapper&&this.customKeyHandler&&this.wrapper.removeEventListener("keydown",this.customKeyHandler),this.draggable&&(this.draggable.pointerResizeMode&&this.draggable.disablePointerResizeMode(),this.draggable.destroy(),this.draggable=null),this.interactionHandlers=null,this.wrapper?.parentNode&&(this.video&&(this.video.pause(),this.video.src=""),this.wrapper.parentNode.removeChild(this.wrapper)),this.wrapper=null,this.video=null,this.settingsButton=null,this.settingsMenu=null}destroy(){this.cleanup(),this.enabled=!1}};export{h as SignLanguageManager};