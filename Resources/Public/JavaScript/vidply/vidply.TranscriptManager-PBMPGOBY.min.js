/*!
 * Universal, Accessible Video Player
 * (c) 2026 Matthias Peltzer
 * Released under GPL-2.0-or-later License
 */
import{a as o,b as n,c as C,d as w,f as x,h as P,i as S,j as b,k as T,m as W,n as z}from"./vidply.chunk-I7BQYXMN.min.js";var E=class{constructor(t){this.player=t,this.transcriptWindow=null,this.transcriptEntries=[],this.metadataCues=[],this.currentActiveEntry=null,this.isVisible=!1,this.storage=new P("vidply"),this.draggableResizable=null,this.settingsMenuVisible=!1,this.settingsMenu=null,this.settingsButton=null,this.settingsMenuJustOpened=!1,this.resizeOptionButton=null,this.resizeOptionText=null,this.dragOptionButton=null,this.dragOptionText=null,this.resizeModeIndicator=null,this.resizeModeIndicatorTimeout=null,this.transcriptResizeHandles=[],this.liveRegion=null,this.styleDialog=null,this.styleDialogVisible=!1,this.styleDialogJustOpened=!1,this.languageSelector=null,this.languageLabel=null,this.currentTranscriptLanguage=null,this.availableTranscriptLanguages=[],this.languageSelectorHandler=null;let e=this.storage.getTranscriptPreferences();this.autoscrollEnabled=e?.autoscroll!==void 0?e.autoscroll:!0,this.showTimestamps=e?.showTimestamps!==void 0?e.showTimestamps:!1,this.transcriptStyle={fontSize:e?.fontSize||this.player.options.transcriptFontSize||"100%",fontFamily:e?.fontFamily||this.player.options.transcriptFontFamily||"sans-serif",color:e?.color||this.player.options.transcriptColor||"#ffffff",backgroundColor:e?.backgroundColor||this.player.options.transcriptBackgroundColor||"#1e1e1e",opacity:e?.opacity??this.player.options.transcriptOpacity??.98},this.handlers={timeupdate:()=>this.updateActiveEntry(),audiodescriptionenabled:()=>{this.isVisible&&this.loadTranscriptData()},audiodescriptiondisabled:()=>{this.isVisible&&this.loadTranscriptData()},resize:null,settingsClick:null,settingsKeydown:null,documentClick:null,styleDialogKeydown:null},this.timeouts=new Set,this.init()}init(){this.setupMetadataHandlingOnLoad(),this.player.on("timeupdate",this.handlers.timeupdate),this.player.on("audiodescriptionenabled",this.handlers.audiodescriptionenabled),this.player.on("audiodescriptiondisabled",this.handlers.audiodescriptiondisabled),this.player.on("fullscreenchange",()=>{this.isVisible&&(window.innerWidth<768&&this.setupDragAndDrop(),(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.setManagedTimeout(()=>this.positionTranscript(),100))})}toggleTranscript(){this.isVisible?this.hideTranscript():this.showTranscript()}showTranscript(){if(this.transcriptWindow){this.transcriptWindow.style.display="flex",this.isVisible=!0,this.player.controlBar&&typeof this.player.controlBar.updateTranscriptButton=="function"&&this.player.controlBar.updateTranscriptButton(),x(this.settingsButton,{delay:150});return}this.createTranscriptWindow(),this.loadTranscriptData(),this.transcriptWindow&&(this.transcriptWindow.style.display="flex",(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.setManagedTimeout(()=>this.positionTranscript(),0),x(this.settingsButton,{delay:150})),this.isVisible=!0}hideTranscript({focusButton:t=!1}={}){if(this.transcriptWindow&&(this.transcriptWindow.style.display="none",this.isVisible=!1),this.draggableResizable&&this.draggableResizable.pointerResizeMode&&(this.draggableResizable.disablePointerResizeMode(),this.updateResizeOptionState()),this.hideResizeModeIndicator(),this.announceLive(""),this.player.controlBar&&typeof this.player.controlBar.updateTranscriptButton=="function"&&this.player.controlBar.updateTranscriptButton(),t){let e=this.player.controlBar?.controls?.transcript;e&&typeof e.focus=="function"&&e.focus({preventScroll:!0})}}createTranscriptWindow(){this.transcriptWindow=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-window`,attributes:{role:"dialog","aria-label":n.t("transcript.ariaLabel"),tabindex:"-1"}}),this.transcriptHeader=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-header`,attributes:{tabindex:"0"}}),this.headerLeft=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-header-left`});let t=n.t("transcript.settingsMenu");this.settingsButton=o.createElement("button",{className:`${this.player.options.classPrefix}-transcript-settings`,attributes:{type:"button","aria-label":t,"aria-expanded":"false"}}),this.settingsButton.appendChild(w("settings")),o.attachTooltip(this.settingsButton,t,this.player.options.classPrefix),this.handlers.settingsClick=h=>{h.preventDefault(),h.stopPropagation(),this.settingsMenuVisible?this.hideSettingsMenu():this.showSettingsMenu()},this.settingsButton.addEventListener("click",this.handlers.settingsClick),this.handlers.settingsKeydown=h=>{h.key==="d"||h.key==="D"?(h.preventDefault(),h.stopPropagation(),this.toggleKeyboardDragMode()):h.key==="r"||h.key==="R"?(h.preventDefault(),h.stopPropagation(),this.toggleResizeMode()):h.key==="Escape"&&this.settingsMenuVisible&&(h.preventDefault(),h.stopPropagation(),this.hideSettingsMenu())},this.settingsButton.addEventListener("keydown",this.handlers.settingsKeydown);let e=o.createElement("h3",{textContent:`${n.t("transcript.title")}. ${n.t("transcript.dragResizePrompt")}`}),i=`${this.player.options.classPrefix}-transcript-autoscroll-${Date.now()}`,a=o.createElement("label",{className:`${this.player.options.classPrefix}-transcript-autoscroll-label`,attributes:{for:i}});this.autoscrollCheckbox=o.createElement("input",{attributes:{id:i,type:"checkbox"}}),this.autoscrollEnabled&&(this.autoscrollCheckbox.checked=!0);let r=o.createElement("span",{textContent:n.t("transcript.autoscroll"),className:`${this.player.options.classPrefix}-transcript-autoscroll-text`});a.appendChild(this.autoscrollCheckbox),a.appendChild(r),this.autoscrollCheckbox.addEventListener("change",h=>{this.autoscrollEnabled=h.target.checked,this.saveAutoscrollPreference()}),this.transcriptHeader.appendChild(e),this.headerLeft.appendChild(this.settingsButton),this.headerLeft.appendChild(a);let p=`${this.player.options.classPrefix}-transcript-language-select-${Date.now()}`,{label:l,select:s}=W({classPrefix:this.player.options.classPrefix,labelClass:`${this.player.options.classPrefix}-transcript-language-label`,selectClass:`${this.player.options.classPrefix}-transcript-language-select`,labelText:"settings.language",selectId:p,hidden:!1});this.languageLabel=l,this.languageSelector=s;let c=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-language-wrapper`,attributes:{style:"display: none;"}});c.appendChild(this.languageLabel),c.appendChild(this.languageSelector),this.languageSelectorWrapper=c,z(c),this.headerLeft.appendChild(c);let d=n.t("transcript.close"),g=o.createElement("button",{className:`${this.player.options.classPrefix}-transcript-close`,attributes:{type:"button","aria-label":d}});g.appendChild(w("close")),o.attachTooltip(g,d,this.player.options.classPrefix),g.addEventListener("click",()=>this.hideTranscript({focusButton:!0})),this.transcriptHeader.appendChild(this.headerLeft),this.transcriptHeader.appendChild(g),this.transcriptContent=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-content`}),this.transcriptWindow.appendChild(this.transcriptHeader),this.transcriptWindow.appendChild(this.transcriptContent),this.createResizeHandles(),this.liveRegion=o.createElement("div",{className:"vidply-sr-only",attributes:{"aria-live":"polite","aria-atomic":"true"}}),this.transcriptWindow.appendChild(this.liveRegion),this.player.container.appendChild(this.transcriptWindow),this.setupDragAndDrop(),(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.positionTranscript(),this.handlers.documentClick=h=>{this.settingsMenuJustOpened||this.styleDialogJustOpened||this.settingsButton&&this.settingsButton.contains(h.target)||this.settingsMenu&&this.settingsMenu.contains(h.target)||(this.settingsMenuVisible&&this.hideSettingsMenu(),this.styleDialogVisible&&this.styleDialog&&!this.styleDialog.contains(h.target)&&this.hideStyleDialog())},this.documentClickHandlerAdded=!1;let m;this.handlers.resize=()=>{m&&this.clearManagedTimeout(m),m=this.setManagedTimeout(()=>{(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.positionTranscript()},100)},window.addEventListener("resize",this.handlers.resize)}createResizeHandles(){if(!this.transcriptWindow)return;let t=["n","s","e","w","ne","nw","se","sw"];this.transcriptResizeHandles=t.map(e=>{let i=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-resize-handle ${this.player.options.classPrefix}-transcript-resize-${e}`,attributes:{"data-direction":e,"data-vidply-managed-resize":"true","aria-hidden":"true"}});return i.style.display="none",this.transcriptWindow.appendChild(i),i})}positionTranscript(){if(!this.transcriptWindow||!this.player.videoWrapper||!this.isVisible||this.draggableResizable&&this.draggableResizable.manuallyPositioned)return;let t=window.innerWidth<768,e=this.player.videoWrapper.getBoundingClientRect(),i=this.player.state.fullscreen;if(t&&!i){this.transcriptWindow.style.position="relative",this.transcriptWindow.style.left="0",this.transcriptWindow.style.right="0",this.transcriptWindow.style.bottom="auto",this.transcriptWindow.style.top="auto",this.transcriptWindow.style.width="100%",this.transcriptWindow.style.maxWidth="100%",this.transcriptWindow.style.maxHeight="300px",this.transcriptWindow.style.height="auto",this.transcriptWindow.style.borderRadius="0",this.transcriptWindow.style.transform="none",this.transcriptWindow.style.border="none",this.transcriptWindow.style.borderTop="1px solid var(--vidply-border-light)",this.transcriptWindow.style.removeProperty("border-right"),this.transcriptWindow.style.removeProperty("border-bottom"),this.transcriptWindow.style.removeProperty("border-left"),this.transcriptWindow.style.removeProperty("border-image"),this.transcriptWindow.style.removeProperty("border-image-source"),this.transcriptWindow.style.removeProperty("border-image-slice"),this.transcriptWindow.style.removeProperty("border-image-width"),this.transcriptWindow.style.removeProperty("border-image-outset"),this.transcriptWindow.style.removeProperty("border-image-repeat"),this.transcriptWindow.style.boxShadow="none",this.transcriptHeader&&(this.transcriptHeader.style.cursor="default");let a=this.player.videoWrapper;a&&a.nextSibling!==this.transcriptWindow&&a.parentNode.insertBefore(this.transcriptWindow,a.nextSibling)}else if(i){this.transcriptWindow.style.position="fixed",this.transcriptWindow.style.left="auto",this.transcriptWindow.style.right="20px",this.transcriptWindow.style.bottom="80px",this.transcriptWindow.style.top="auto",this.transcriptWindow.style.maxHeight="calc(100vh - 180px)",this.transcriptWindow.style.height="auto";let a=260,r=Math.max(a,window.innerWidth-40),p=parseFloat(this.transcriptWindow.style.width)||400,l=Math.max(a,Math.min(p,r));this.transcriptWindow.style.width=`${l}px`,this.transcriptWindow.style.maxWidth="none",this.transcriptWindow.style.borderRadius="8px",this.transcriptWindow.style.border="1px solid var(--vidply-border)",this.transcriptWindow.style.removeProperty("border-top"),this.transcriptWindow.style.removeProperty("border-right"),this.transcriptWindow.style.removeProperty("border-bottom"),this.transcriptWindow.style.removeProperty("border-left"),this.transcriptWindow.style.removeProperty("border-image"),this.transcriptWindow.style.removeProperty("border-image-source"),this.transcriptWindow.style.removeProperty("border-image-slice"),this.transcriptWindow.style.removeProperty("border-image-width"),this.transcriptWindow.style.removeProperty("border-image-outset"),this.transcriptWindow.style.removeProperty("border-image-repeat"),this.transcriptHeader&&(this.transcriptHeader.style.cursor="move"),this.transcriptWindow.parentNode!==this.player.container&&this.player.container.appendChild(this.transcriptWindow)}else{let a=parseFloat(this.transcriptWindow.style.width)||400,r=20,p=260,l=this.player.container.getBoundingClientRect();window.getComputedStyle(this.player.container).position==="static"&&(this.player.container.style.position="relative");let c=window.innerWidth-e.right-r,d=c<a,g=c>=p;if(d||!g){let f=Math.min(320,e.width-40),u=Math.min(280,e.height-120),y=this.player.videoWrapper.getBoundingClientRect(),R=70,M=Math.max(180,u),D=y.bottom-l.top-R-M,L=l.right-y.right+12;this.transcriptWindow.style.position="absolute",this.transcriptWindow.style.left="auto",this.transcriptWindow.style.right=`${L}px`,this.transcriptWindow.style.top=`${D}px`,this.transcriptWindow.style.bottom="auto",this.transcriptWindow.style.width=`${Math.max(p,f)}px`,this.transcriptWindow.style.maxWidth="320px",this.transcriptWindow.style.height=`${M}px`,this.transcriptWindow.style.maxHeight="280px",this.transcriptWindow.style.boxShadow="0 4px 16px rgba(0, 0, 0, 0.6)"}else{let h=e.right-l.left+r,v=Math.max(p,Math.min(a,c)),f=e.height;this.transcriptWindow.style.position="absolute",this.transcriptWindow.style.left=`${h}px`,this.transcriptWindow.style.right="auto",this.transcriptWindow.style.bottom="auto",this.transcriptWindow.style.top="0",this.transcriptWindow.style.height=`${f}px`,this.transcriptWindow.style.maxHeight="none",this.transcriptWindow.style.width=`${v}px`,this.transcriptWindow.style.maxWidth="none",this.transcriptWindow.style.boxShadow=""}this.transcriptWindow.style.borderRadius="8px",this.transcriptWindow.style.border="1px solid var(--vidply-border)",this.transcriptWindow.style.removeProperty("border-top"),this.transcriptWindow.style.removeProperty("border-right"),this.transcriptWindow.style.removeProperty("border-bottom"),this.transcriptWindow.style.removeProperty("border-left"),this.transcriptWindow.style.removeProperty("border-image"),this.transcriptWindow.style.removeProperty("border-image-source"),this.transcriptWindow.style.removeProperty("border-image-slice"),this.transcriptWindow.style.removeProperty("border-image-width"),this.transcriptWindow.style.removeProperty("border-image-outset"),this.transcriptWindow.style.removeProperty("border-image-repeat"),this.transcriptHeader&&(this.transcriptHeader.style.cursor="move"),this.transcriptWindow.parentNode!==this.player.container&&this.player.container.appendChild(this.transcriptWindow)}}getAvailableTranscriptLanguages(){let t=this.player.textTracks,e=new Map;return t.forEach(i=>{(i.kind==="captions"||i.kind==="subtitles")&&i.language&&(e.has(i.language)||e.set(i.language,{language:i.language,label:i.label||i.language,track:i}))}),Array.from(e.values())}updateLanguageSelector(){if(this.languageSelector){if(this.availableTranscriptLanguages=this.getAvailableTranscriptLanguages(),this.languageSelector.innerHTML="",this.availableTranscriptLanguages.length<2){this.languageSelectorWrapper&&(this.languageSelectorWrapper.style.display="none");return}if(this.languageSelectorWrapper&&(this.languageSelectorWrapper.style.display="flex"),this.availableTranscriptLanguages.forEach((t,e)=>{let i=o.createElement("option",{textContent:t.label,attributes:{value:t.language,lang:t.language}});this.languageSelector.appendChild(i)}),this.currentTranscriptLanguage)this.languageSelector.value=this.currentTranscriptLanguage;else if(this.availableTranscriptLanguages.length>0){let t=this.player.textTracks.find(e=>(e.kind==="captions"||e.kind==="subtitles")&&e.mode==="showing");this.currentTranscriptLanguage=t?t.language:this.availableTranscriptLanguages[0].language,this.languageSelector.value=this.currentTranscriptLanguage}this.languageSelectorHandler&&this.languageSelector.removeEventListener("change",this.languageSelectorHandler),this.languageSelectorHandler=t=>{this.currentTranscriptLanguage=t.target.value,this.loadTranscriptData(),this.transcriptContent&&this.currentTranscriptLanguage&&this.transcriptContent.setAttribute("lang",this.currentTranscriptLanguage)},this.languageSelector.addEventListener("change",this.languageSelectorHandler)}}loadTranscriptData(){this.transcriptEntries=[],this.transcriptContent.innerHTML="";let t=this.player.textTracks,e=null;this.currentTranscriptLanguage&&(e=t.find(s=>(s.kind==="captions"||s.kind==="subtitles")&&s.language===this.currentTranscriptLanguage)),e||(e=t.find(s=>s.kind==="captions"||s.kind==="subtitles"),e&&(this.currentTranscriptLanguage=e.language));let i=null;this.currentTranscriptLanguage&&(i=t.find(s=>s.kind==="descriptions"&&s.language===this.currentTranscriptLanguage)),i||(i=t.find(s=>s.kind==="descriptions"));let a=t.find(s=>s.kind==="metadata");if(!e&&!i&&!a){this.showNoTranscriptMessage();return}let r=[e,i,a].filter(Boolean);if(r.forEach(s=>{s.mode==="disabled"&&(s.mode="hidden")}),r.some(s=>!s.cues||s.cues.length===0)){let s=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-loading`,textContent:n.t("transcript.loading")});this.transcriptContent.appendChild(s);let c=0,d=()=>{c++,c>=r.length&&this.loadTranscriptData()};r.forEach(g=>{g.addEventListener("load",d,{once:!0})}),this.setManagedTimeout(()=>{this.loadTranscriptData()},500);return}let l=[];e&&e.cues&&Array.from(e.cues).forEach(s=>{l.push({cue:s,type:"caption"})}),i&&i.cues&&Array.from(i.cues).forEach(s=>{l.push({cue:s,type:"description"})}),a&&a.cues&&(this.metadataCues=Array.from(a.cues),this.setupMetadataHandling()),l.sort((s,c)=>s.cue.startTime-c.cue.startTime),l.forEach((s,c)=>{let d=this.createTranscriptEntry(s.cue,c,s.type);this.transcriptEntries.push({element:d,cue:s.cue,type:s.type,startTime:s.cue.startTime,endTime:s.cue.endTime}),this.transcriptContent.appendChild(d)}),this.applyTranscriptStyles(),this.updateTimestampVisibility(),this.transcriptContent&&this.currentTranscriptLanguage&&this.transcriptContent.setAttribute("lang",this.currentTranscriptLanguage),this.updateLanguageSelector()}setupMetadataHandlingOnLoad(){let t=()=>{let i=this.player.textTracks.find(a=>a.kind==="metadata");if(i){if(i.mode==="disabled"&&(i.mode="hidden"),this.metadataCueChangeHandler&&i.removeEventListener("cuechange",this.metadataCueChangeHandler),this.metadataCueChangeHandler=()=>{let a=Array.from(i.activeCues||[]);a.length>0&&this.player.options.debug&&console.log("[VidPly Metadata] Active cues:",a.map(r=>({start:r.startTime,end:r.endTime,text:r.text}))),a.forEach(r=>{this.handleMetadataCue(r)})},i.addEventListener("cuechange",this.metadataCueChangeHandler),this.player.options.debug){let a=i.cues?i.cues.length:0;console.log("[VidPly Metadata] Track enabled,",a,"cues available")}}else this.player.options.debug&&console.warn("[VidPly Metadata] No metadata track found")};t(),this.player.on("loadedmetadata",t)}setupMetadataHandling(){!this.metadataCues||this.metadataCues.length===0||this.player.options.debug&&console.log("[VidPly Metadata]",this.metadataCues.length,"cues stored from transcript load")}handleMetadataCue(t){let e=t.text.trim();this.player.options.debug&&console.log("[VidPly Metadata] Processing cue:",{time:t.startTime,text:e}),this.player.emit("metadata",{time:t.startTime,endTime:t.endTime,text:e,cue:t}),e.includes("PAUSE")&&(this.player.state.paused||(this.player.options.debug&&console.log("[VidPly Metadata] Pausing video at",t.startTime),this.player.pause()),this.player.emit("metadata:pause",{time:t.startTime,text:e}));let i=e.match(/FOCUS:([\w#-]+)/);if(i){let r=i[1],p=document.querySelector(r);p?(this.player.options.debug&&console.log("[VidPly Metadata] Focusing element:",r),this.setManagedTimeout(()=>{p.focus({preventScroll:!0})},10)):this.player.options.debug&&console.warn("[VidPly Metadata] Element not found:",r),this.player.emit("metadata:focus",{time:t.startTime,target:r,element:p,text:e})}let a=e.match(/#[\w-]+/g);a&&(this.player.options.debug&&console.log("[VidPly Metadata] Hashtags found:",a),this.player.emit("metadata:hashtags",{time:t.startTime,hashtags:a,text:e}))}createTranscriptEntry(t,e,i="caption"){let a=this.stripVTTFormatting(t.text),r=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-entry ${this.player.options.classPrefix}-transcript-${i}`,attributes:{tabindex:"0","data-start":String(t.startTime),"data-end":String(t.endTime),"data-type":i}}),p=o.createElement("span",{className:`${this.player.options.classPrefix}-transcript-time`,textContent:C.formatTime(t.startTime),attributes:{"aria-hidden":"true"}}),l=o.createElement("span",{className:`${this.player.options.classPrefix}-transcript-text`,textContent:a});r.appendChild(p),r.appendChild(l);let s=()=>{this.player.seek(t.startTime),this.player.state.paused&&this.player.play()};return r.addEventListener("click",s),r.addEventListener("keydown",c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),s())}),r}stripVTTFormatting(t){return t.replace(/<[^>]+>/g,"").replace(/\n/g," ").trim()}showNoTranscriptMessage(){let t=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-empty`,textContent:n.t("transcript.noTranscript")});this.transcriptContent.appendChild(t)}updateActiveEntry(){if(!this.isVisible||this.transcriptEntries.length===0)return;let t=this.player.state.currentTime,e=this.transcriptEntries.find(i=>t>=i.startTime&&t<i.endTime);e&&e!==this.currentActiveEntry?(this.currentActiveEntry&&this.currentActiveEntry.element.classList.remove(`${this.player.options.classPrefix}-transcript-entry-active`),e.element.classList.add(`${this.player.options.classPrefix}-transcript-entry-active`),this.scrollToEntry(e.element),this.currentActiveEntry=e):!e&&this.currentActiveEntry&&(this.currentActiveEntry.element.classList.remove(`${this.player.options.classPrefix}-transcript-entry-active`),this.currentActiveEntry=null)}scrollToEntry(t){if(!this.transcriptContent||!this.autoscrollEnabled)return;let e=this.transcriptContent.getBoundingClientRect(),i=t.getBoundingClientRect();if(i.top<e.top||i.bottom>e.bottom){let a=t.offsetTop-this.transcriptContent.clientHeight/2+t.clientHeight/2;this.transcriptContent.scrollTo({top:a,behavior:"smooth"})}}saveAutoscrollPreference(){let t=this.storage.getTranscriptPreferences()||{};t.autoscroll=this.autoscrollEnabled,this.storage.saveTranscriptPreferences(t)}setupDragAndDrop(){if(!this.transcriptHeader||!this.transcriptWindow)return;let t=window.innerWidth<768,e=this.player.state.fullscreen;if(t&&!e){this.draggableResizable&&(this.draggableResizable.destroy(),this.draggableResizable=null);return}this.draggableResizable||(this.draggableResizable=new S(this.transcriptWindow,{dragHandle:this.transcriptHeader,resizeHandles:this.transcriptResizeHandles,constrainToViewport:!0,classPrefix:`${this.player.options.classPrefix}-transcript`,keyboardDragKey:"d",keyboardResizeKey:"r",keyboardStep:10,keyboardStepLarge:50,minWidth:300,minHeight:200,maxWidth:()=>Math.max(320,window.innerWidth-40),maxHeight:()=>Math.max(200,window.innerHeight-120),pointerResizeIndicatorText:n.t("transcript.resizeModeHint"),onPointerResizeToggle:i=>{this.transcriptResizeHandles.forEach(a=>{a.style.display=i?"block":"none"}),this.onPointerResizeModeChange(i)},onDragStart:i=>{let a=[`.${this.player.options.classPrefix}-transcript-close`,`.${this.player.options.classPrefix}-transcript-settings`,`.${this.player.options.classPrefix}-transcript-language-select`,`.${this.player.options.classPrefix}-transcript-language-label`,`.${this.player.options.classPrefix}-transcript-settings-menu`,`.${this.player.options.classPrefix}-transcript-style-dialog`];for(let r of a)if(i.target.closest(r))return!1;return!0}}),this.customKeyHandler=i=>{let a=i.key.toLowerCase(),r=i.defaultPrevented;if(!(this.settingsMenuVisible||this.styleDialogVisible)){if(a==="home"){i.preventDefault(),i.stopPropagation(),this.draggableResizable&&(this.draggableResizable.pointerResizeMode&&this.draggableResizable.disablePointerResizeMode(),this.draggableResizable.manuallyPositioned=!1,this.positionTranscript(),this.updateResizeOptionState(),this.announceLive(n.t("transcript.positionReset")));return}if(a==="r"){if(r)return;i.preventDefault(),i.stopPropagation(),this.toggleResizeMode()&&this.transcriptWindow.focus({preventScroll:!0});return}if(a==="escape"){if(this.draggableResizable&&this.draggableResizable.pointerResizeMode){i.preventDefault(),i.stopPropagation(),this.draggableResizable.disablePointerResizeMode();return}if(this.draggableResizable&&this.draggableResizable.keyboardDragMode){i.preventDefault(),i.stopPropagation(),this.draggableResizable.disableKeyboardDragMode(),this.announceLive(n.t("transcript.dragModeDisabled"));return}i.preventDefault(),i.stopPropagation(),this.hideTranscript({focusButton:!0});return}}},this.transcriptWindow.addEventListener("keydown",this.customKeyHandler))}toggleKeyboardDragMode(){if(this.draggableResizable){let t=this.draggableResizable.keyboardDragMode;this.draggableResizable.toggleKeyboardDragMode();let e=this.draggableResizable.keyboardDragMode;!t&&e&&this.enableMoveMode(),this.updateDragOptionState(),this.settingsMenuVisible&&this.hideSettingsMenu(),this.transcriptWindow.focus({preventScroll:!0})}}toggleSettingsMenu(){this.settingsMenuVisible?this.hideSettingsMenu():this.showSettingsMenu()}showSettingsMenu(){if(this.settingsMenuJustOpened=!0,setTimeout(()=>{this.settingsMenuJustOpened=!1},350),this.documentClickHandlerAdded||setTimeout(()=>{document.addEventListener("click",this.handlers.documentClick),this.documentClickHandlerAdded=!0},300),this.settingsMenu){this.settingsMenu.style.display="block",this.settingsMenuVisible=!0,this.settingsButton&&this.settingsButton.setAttribute("aria-expanded","true"),this.attachSettingsMenuKeyboardNavigation(),this.positionSettingsMenuImmediate(),this.updateResizeOptionState(),setTimeout(()=>{let u=this.settingsMenu.querySelectorAll(`.${this.player.options.classPrefix}-transcript-settings-item`);if(u.length>0){u[0].setAttribute("tabindex","0");for(let y=1;y<u.length;y++)u[y].setAttribute("tabindex","-1");u[0].focus({preventScroll:!0})}},50);return}this.settingsMenu=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-settings-menu`,attributes:{role:"menu"}});let t=b({classPrefix:this.player.options.classPrefix,itemClass:`${this.player.options.classPrefix}-transcript-settings-item`,icon:"move",label:"transcript.enableDragMode",hasTextClass:!0,onClick:()=>{this.toggleKeyboardDragMode(),this.hideSettingsMenu()}});t.setAttribute("role","switch"),t.setAttribute("aria-checked","false");let e=t.querySelector(`.${this.player.options.classPrefix}-tooltip`);e&&e.remove();let i=t.querySelector(`.${this.player.options.classPrefix}-button-text`);i&&i.remove(),this.dragOptionButton=t,this.dragOptionText=t.querySelector(`.${this.player.options.classPrefix}-settings-text`),this.updateDragOptionState();let a=b({classPrefix:this.player.options.classPrefix,itemClass:`${this.player.options.classPrefix}-transcript-settings-item`,icon:"settings",label:"transcript.styleTranscript",onClick:u=>{u.preventDefault(),u.stopPropagation(),this.hideSettingsMenu(),setTimeout(()=>{this.showStyleDialog()},50)}}),r=a.querySelector(`.${this.player.options.classPrefix}-tooltip`);r&&r.remove();let p=a.querySelector(`.${this.player.options.classPrefix}-button-text`);p&&p.remove();let l=b({classPrefix:this.player.options.classPrefix,itemClass:`${this.player.options.classPrefix}-transcript-settings-item`,icon:"resize",label:"transcript.enableResizeMode",hasTextClass:!0,onClick:u=>{u.preventDefault(),u.stopPropagation(),this.toggleResizeMode({focus:!1})?(this.hideSettingsMenu({focusButton:!1}),setTimeout(()=>{this.transcriptWindow&&this.transcriptWindow.focus({preventScroll:!0})},20)):this.hideSettingsMenu({focusButton:!0})}});l.setAttribute("role","switch"),l.setAttribute("aria-checked","false");let s=l.querySelector(`.${this.player.options.classPrefix}-tooltip`);s&&s.remove();let c=l.querySelector(`.${this.player.options.classPrefix}-button-text`);c&&c.remove(),this.resizeOptionButton=l,this.resizeOptionText=l.querySelector(`.${this.player.options.classPrefix}-settings-text`),this.updateResizeOptionState();let d=b({classPrefix:this.player.options.classPrefix,itemClass:`${this.player.options.classPrefix}-transcript-settings-item`,icon:"clock",label:"transcript.showTimestamps",hasTextClass:!0,onClick:()=>{this.toggleShowTimestamps()}});d.setAttribute("role","switch"),d.setAttribute("aria-checked",this.showTimestamps?"true":"false");let g=d.querySelector(`.${this.player.options.classPrefix}-tooltip`);g&&g.remove();let m=d.querySelector(`.${this.player.options.classPrefix}-button-text`);m&&m.remove(),this.showTimestampsButton=d,this.showTimestampsText=d.querySelector(`.${this.player.options.classPrefix}-settings-text`),this.updateShowTimestampsState();let h=b({classPrefix:this.player.options.classPrefix,itemClass:`${this.player.options.classPrefix}-transcript-settings-item`,icon:"close",label:"transcript.closeMenu",onClick:()=>{this.hideSettingsMenu()}}),v=h.querySelector(`.${this.player.options.classPrefix}-tooltip`);v&&v.remove();let f=h.querySelector(`.${this.player.options.classPrefix}-button-text`);f&&f.remove(),this.settingsMenu.appendChild(t),this.settingsMenu.appendChild(l),this.settingsMenu.appendChild(a),this.settingsMenu.appendChild(d),this.settingsMenu.appendChild(h),this.settingsMenu.style.visibility="hidden",this.settingsMenu.style.display="block",this.settingsButton&&this.settingsButton.parentNode?this.settingsButton.insertAdjacentElement("afterend",this.settingsMenu):this.headerLeft?this.headerLeft.appendChild(this.settingsMenu):this.transcriptHeader?this.transcriptHeader.appendChild(this.settingsMenu):this.transcriptWindow.appendChild(this.settingsMenu),this.positionSettingsMenuImmediate(),requestAnimationFrame(()=>{this.settingsMenu&&(this.settingsMenu.style.visibility="visible")}),this.settingsMenuKeyHandler=T(this.settingsMenu,this.settingsButton,`.${this.player.options.classPrefix}-transcript-settings-item`,()=>this.hideSettingsMenu({focusButton:!0})),this.settingsMenuVisible=!0,this.settingsMenu.style.display="block",this.settingsButton&&this.settingsButton.setAttribute("aria-expanded","true"),this.updateResizeOptionState(),setTimeout(()=>{let u=this.settingsMenu.querySelectorAll(`.${this.player.options.classPrefix}-transcript-settings-item`);if(u.length>0){u[0].setAttribute("tabindex","0");for(let y=1;y<u.length;y++)u[y].setAttribute("tabindex","-1");u[0].focus({preventScroll:!0})}},50)}positionSettingsMenuImmediate(){if(!this.settingsMenu||!this.settingsButton)return;let t=this.settingsButton.parentElement;if(!t)return;let e=this.settingsButton.getBoundingClientRect(),i=t.getBoundingClientRect(),a=this.settingsMenu.getBoundingClientRect(),r=window.innerHeight,p=e.left-i.left,l=e.bottom-i.top,s=e.top-i.top,c=r-e.bottom,d=e.top,g=l+4;c<a.height+20&&d>c?(g=s-a.height-4,this.settingsMenu.classList.add("vidply-menu-above")):this.settingsMenu.classList.remove("vidply-menu-above"),this.settingsMenu.style.top=`${g}px`,this.settingsMenu.style.left=`${p}px`,this.settingsMenu.style.right="auto",this.settingsMenu.style.bottom="auto"}positionSettingsMenu(){!this.settingsMenu||!this.settingsButton||requestAnimationFrame(()=>{setTimeout(()=>{this.positionSettingsMenuImmediate()},10)})}attachSettingsMenuKeyboardNavigation(){if(!this.settingsMenu)return;this.settingsMenuKeyHandler&&this.settingsMenu.removeEventListener("keydown",this.settingsMenuKeyHandler,!0);let t=T(this.settingsMenu,this.settingsButton,`.${this.player.options.classPrefix}-transcript-settings-item`,()=>this.hideSettingsMenu({focusButton:!0}));this.settingsMenuKeyHandler=t}hideSettingsMenu({focusButton:t=!0}={}){this.settingsMenu&&(this.settingsMenu.style.display="none",this.settingsMenuVisible=!1,this.settingsMenuJustOpened=!1,this.settingsMenuKeyHandler&&(this.settingsMenu.removeEventListener("keydown",this.settingsMenuKeyHandler,!0),this.settingsMenuKeyHandler=null),this.settingsButton&&(this.settingsButton.setAttribute("aria-expanded","false"),t&&this.settingsButton.focus({preventScroll:!0})))}enableMoveMode(){this.hideResizeModeIndicator(),this.transcriptWindow.classList.add(`${this.player.options.classPrefix}-transcript-move-mode`);let t=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-move-tooltip`,textContent:"Drag with mouse or press D for keyboard drag mode"});this.transcriptHeader.appendChild(t),setTimeout(()=>{this.transcriptWindow.classList.remove(`${this.player.options.classPrefix}-transcript-move-mode`),t.parentNode&&t.remove()},2e3)}toggleResizeMode({focus:t=!0}={}){return this.draggableResizable?this.draggableResizable.pointerResizeMode?(this.draggableResizable.disablePointerResizeMode({focus:t}),!1):(this.draggableResizable.enablePointerResizeMode({focus:t}),!0):!1}updateDragOptionState(){if(!this.dragOptionButton)return;let t=!!(this.draggableResizable&&this.draggableResizable.keyboardDragMode),e=t?n.t("transcript.disableDragMode"):n.t("transcript.enableDragMode"),i=t?n.t("transcript.disableDragModeAria"):n.t("transcript.enableDragModeAria");this.dragOptionButton.setAttribute("aria-checked",t?"true":"false"),this.dragOptionButton.setAttribute("aria-label",i),this.dragOptionText&&(this.dragOptionText.textContent=e)}updateResizeOptionState(){if(!this.resizeOptionButton)return;let t=!!(this.draggableResizable&&this.draggableResizable.pointerResizeMode),e=t?n.t("transcript.disableResizeMode"):n.t("transcript.enableResizeMode"),i=t?n.t("transcript.disableResizeModeAria"):n.t("transcript.enableResizeModeAria");this.resizeOptionButton.setAttribute("aria-checked",t?"true":"false"),this.resizeOptionButton.setAttribute("aria-label",i),this.resizeOptionText&&(this.resizeOptionText.textContent=e)}toggleShowTimestamps(){this.showTimestamps=!this.showTimestamps,this.updateShowTimestampsState(),this.updateTimestampVisibility(),this.saveTimestampsPreference()}updateShowTimestampsState(){if(!this.showTimestampsButton)return;let t=this.showTimestamps?n.t("transcript.hideTimestamps"):n.t("transcript.showTimestamps"),e=this.showTimestamps?n.t("transcript.hideTimestampsAria"):n.t("transcript.showTimestampsAria");this.showTimestampsButton.setAttribute("aria-checked",this.showTimestamps?"true":"false"),this.showTimestampsButton.setAttribute("aria-label",e),this.showTimestampsText&&(this.showTimestampsText.textContent=t)}updateTimestampVisibility(){if(!this.transcriptContent)return;this.transcriptContent.querySelectorAll(`.${this.player.options.classPrefix}-transcript-time`).forEach(e=>{e.style.display=this.showTimestamps?"":"none"})}saveTimestampsPreference(){let t=this.storage.getTranscriptPreferences()||{};t.showTimestamps=this.showTimestamps,this.storage.saveTranscriptPreferences(t)}showResizeModeIndicator(){if(!this.transcriptHeader)return;this.hideResizeModeIndicator();let t=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-resize-tooltip`,textContent:n.t("transcript.resizeModeHint")||"Resize handles enabled. Drag edges or corners to adjust. Press Esc or R to exit."});this.transcriptHeader.appendChild(t),this.resizeModeIndicator=t,this.resizeModeIndicatorTimeout=this.setManagedTimeout(()=>{this.hideResizeModeIndicator()},3e3)}hideResizeModeIndicator(){this.resizeModeIndicatorTimeout&&(this.clearManagedTimeout(this.resizeModeIndicatorTimeout),this.resizeModeIndicatorTimeout=null),this.resizeModeIndicator&&this.resizeModeIndicator.parentNode&&this.resizeModeIndicator.remove(),this.resizeModeIndicator=null}onPointerResizeModeChange(t){this.updateResizeOptionState(),t?(this.showResizeModeIndicator(),this.announceLive(n.t("transcript.resizeModeEnabled"))):(this.hideResizeModeIndicator(),this.announceLive(n.t("transcript.resizeModeDisabled")))}showStyleDialog(){if(this.styleDialog){this.styleDialog.style.display="block",this.styleDialogVisible=!0,this.handlers.styleDialogKeydown&&document.addEventListener("keydown",this.handlers.styleDialogKeydown),this.styleDialogJustOpened=!0,setTimeout(()=>{this.styleDialogJustOpened=!1},350),setTimeout(()=>{let s=this.styleDialog.querySelector("select, input");s&&s.focus({preventScroll:!0})},0);return}this.styleDialog=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-style-dialog`});let t=o.createElement("h4",{textContent:n.t("transcript.styleTitle"),className:`${this.player.options.classPrefix}-transcript-style-title`});this.styleDialog.appendChild(t);let e=this.createStyleSelectControl(n.t("captions.fontSize"),"fontSize",[{label:n.t("fontSizes.small"),value:"90%"},{label:n.t("fontSizes.normal"),value:"100%"},{label:n.t("fontSizes.large"),value:"110%"},{label:n.t("fontSizes.xlarge"),value:"120%"}]);this.styleDialog.appendChild(e);let i=this.createStyleSelectControl(n.t("captions.fontFamily"),"fontFamily",[{label:n.t("fontFamilies.sansSerif"),value:"sans-serif"},{label:n.t("fontFamilies.serif"),value:"serif"},{label:n.t("fontFamilies.monospace"),value:"monospace"}]);this.styleDialog.appendChild(i);let a=this.createStyleColorControl(n.t("captions.color"),"color");this.styleDialog.appendChild(a);let r=this.createStyleColorControl(n.t("captions.backgroundColor"),"backgroundColor");this.styleDialog.appendChild(r);let p=this.createStyleOpacityControl(n.t("captions.opacity"),"opacity");this.styleDialog.appendChild(p);let l=o.createElement("button",{className:`${this.player.options.classPrefix}-transcript-style-close`,textContent:n.t("settings.close"),attributes:{type:"button"}});l.addEventListener("click",()=>this.hideStyleDialog()),this.styleDialog.appendChild(l),this.handlers.styleDialogKeydown=s=>{if(this.styleDialogVisible){if(s.key==="Escape"){s.preventDefault(),s.stopPropagation(),this.hideStyleDialog();return}if(s.key==="Tab"){let c=this.styleDialog.querySelectorAll("select, input, button"),d=c[0],g=c[c.length-1];s.shiftKey&&document.activeElement===d?(s.preventDefault(),g.focus({preventScroll:!0})):!s.shiftKey&&document.activeElement===g&&(s.preventDefault(),d.focus({preventScroll:!0}))}}},document.addEventListener("keydown",this.handlers.styleDialogKeydown),this.headerLeft?this.headerLeft.appendChild(this.styleDialog):this.transcriptHeader.appendChild(this.styleDialog),this.applyTranscriptStyles(),this.styleDialogVisible=!0,this.styleDialog.style.display="block",this.styleDialogJustOpened=!0,setTimeout(()=>{this.styleDialogJustOpened=!1},350),setTimeout(()=>{let s=this.styleDialog.querySelector("select, input");s&&s.focus({preventScroll:!0})},0)}hideStyleDialog(){this.styleDialog&&(this.styleDialog.style.display="none",this.styleDialogVisible=!1,this.handlers.styleDialogKeydown&&document.removeEventListener("keydown",this.handlers.styleDialogKeydown),this.settingsButton&&this.settingsButton.focus({preventScroll:!0}))}createStyleSelectControl(t,e,i){let a=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-style-group`}),r=`${this.player.options.classPrefix}-transcript-${e}-${Date.now()}`,p=o.createElement("label",{textContent:t,attributes:{for:r}});a.appendChild(p);let l=o.createElement("select",{className:`${this.player.options.classPrefix}-transcript-style-select`,attributes:{id:r}});return i.forEach(s=>{let c=o.createElement("option",{textContent:s.label,attributes:{value:s.value}});this.transcriptStyle[e]===s.value&&(c.selected=!0),l.appendChild(c)}),l.addEventListener("change",s=>{this.transcriptStyle[e]=s.target.value,this.applyTranscriptStyles(),this.savePreferences()}),a.appendChild(l),a}createStyleColorControl(t,e){let i=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-style-group`}),a=`${this.player.options.classPrefix}-transcript-${e}-${Date.now()}`,r=o.createElement("label",{textContent:t,attributes:{for:a}});i.appendChild(r);let p=o.createElement("input",{attributes:{id:a,type:"color",value:this.transcriptStyle[e]},className:`${this.player.options.classPrefix}-transcript-style-color`});return p.addEventListener("input",l=>{this.transcriptStyle[e]=l.target.value,this.applyTranscriptStyles(),this.savePreferences()}),i.appendChild(p),i}createStyleOpacityControl(t,e){let i=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-style-group`}),a=`${this.player.options.classPrefix}-transcript-${e}-${Date.now()}`,r=o.createElement("label",{textContent:t,attributes:{for:a}});i.appendChild(r);let p=o.createElement("span",{textContent:Math.round(this.transcriptStyle[e]*100)+"%",className:`${this.player.options.classPrefix}-transcript-style-value`}),l=o.createElement("input",{attributes:{id:a,type:"range",min:"0",max:"1",step:"0.1",value:String(this.transcriptStyle[e])},className:`${this.player.options.classPrefix}-transcript-style-range`});l.addEventListener("input",c=>{let d=parseFloat(c.target.value);this.transcriptStyle[e]=d,p.textContent=Math.round(d*100)+"%",this.applyTranscriptStyles(),this.savePreferences()});let s=o.createElement("div",{className:`${this.player.options.classPrefix}-transcript-style-range-container`});return s.appendChild(l),s.appendChild(p),i.appendChild(r),i.appendChild(s),i}savePreferences(){this.storage.saveTranscriptPreferences(this.transcriptStyle)}applyTranscriptStyles(){if(!this.transcriptWindow)return;this.transcriptWindow.style.backgroundColor=this.transcriptStyle.backgroundColor,this.transcriptWindow.style.opacity=String(this.transcriptStyle.opacity),this.transcriptContent&&(this.transcriptContent.style.fontSize=this.transcriptStyle.fontSize,this.transcriptContent.style.fontFamily=this.transcriptStyle.fontFamily,this.transcriptContent.style.color=this.transcriptStyle.color),this.transcriptWindow.querySelectorAll(`.${this.player.options.classPrefix}-transcript-text`).forEach(i=>{i.style.fontSize=this.transcriptStyle.fontSize,i.style.fontFamily=this.transcriptStyle.fontFamily,i.style.color=this.transcriptStyle.color}),this.transcriptWindow.querySelectorAll(`.${this.player.options.classPrefix}-transcript-time`).forEach(i=>{i.style.fontFamily=this.transcriptStyle.fontFamily})}setManagedTimeout(t,e){let i=setTimeout(()=>{this.timeouts.delete(i),t()},e);return this.timeouts.add(i),i}clearManagedTimeout(t){t&&(clearTimeout(t),this.timeouts.delete(t))}destroy(){this.hideResizeModeIndicator(),this.draggableResizable&&(this.draggableResizable.pointerResizeMode&&(this.draggableResizable.disablePointerResizeMode(),this.updateResizeOptionState()),this.draggableResizable.destroy(),this.draggableResizable=null),this.transcriptWindow&&this.customKeyHandler&&(this.transcriptWindow.removeEventListener("keydown",this.customKeyHandler),this.customKeyHandler=null),this.handlers.timeupdate&&this.player.off("timeupdate",this.handlers.timeupdate),this.handlers.audiodescriptionenabled&&this.player.off("audiodescriptionenabled",this.handlers.audiodescriptionenabled),this.handlers.audiodescriptiondisabled&&this.player.off("audiodescriptiondisabled",this.handlers.audiodescriptiondisabled),this.settingsButton&&(this.handlers.settingsClick&&this.settingsButton.removeEventListener("click",this.handlers.settingsClick),this.handlers.settingsKeydown&&this.settingsButton.removeEventListener("keydown",this.handlers.settingsKeydown)),this.handlers.styleDialogKeydown&&document.removeEventListener("keydown",this.handlers.styleDialogKeydown),this.handlers.documentClick&&document.removeEventListener("click",this.handlers.documentClick),this.handlers.resize&&window.removeEventListener("resize",this.handlers.resize),this.timeouts.forEach(t=>clearTimeout(t)),this.timeouts.clear(),this.handlers=null,this.transcriptWindow&&this.transcriptWindow.parentNode&&this.transcriptWindow.parentNode.removeChild(this.transcriptWindow),this.transcriptWindow=null,this.transcriptHeader=null,this.transcriptContent=null,this.transcriptEntries=[],this.settingsMenu=null,this.styleDialog=null,this.transcriptResizeHandles=[],this.resizeOptionButton=null,this.resizeOptionText=null,this.liveRegion=null}announceLive(t){this.liveRegion&&(this.liveRegion.textContent=t||"")}};export{E as TranscriptManager};
