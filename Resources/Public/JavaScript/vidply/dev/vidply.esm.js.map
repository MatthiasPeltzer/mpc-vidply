{
  "version": 3,
  "sources": ["../../src/utils/EventEmitter.js", "../../src/utils/PerformanceUtils.js", "../../src/utils/VideoFrameCapture.js", "../../src/controls/ControlBar.js", "../../src/controls/CaptionManager.js", "../../src/controls/KeyboardManager.js", "../../src/core/AudioDescriptionManager.js", "../../src/core/SignLanguageManager.js", "../../src/core/Player.js", "../../src/features/PlaylistManager.js", "../../src/index.js"],
  "sourcesContent": ["/**\r\n * Simple EventEmitter implementation\r\n */\r\n\r\nexport class EventEmitter {\r\n  constructor() {\r\n    this.events = {};\r\n  }\r\n\r\n  on(event, listener) {\r\n    if (!this.events[event]) {\r\n      this.events[event] = [];\r\n    }\r\n    this.events[event].push(listener);\r\n    return this;\r\n  }\r\n\r\n  once(event, listener) {\r\n    const onceListener = (...args) => {\r\n      listener(...args);\r\n      this.off(event, onceListener);\r\n    };\r\n    return this.on(event, onceListener);\r\n  }\r\n\r\n  off(event, listener) {\r\n    if (!this.events[event]) return this;\r\n    \r\n    if (!listener) {\r\n      delete this.events[event];\r\n    } else {\r\n      this.events[event] = this.events[event].filter(l => l !== listener);\r\n    }\r\n    \r\n    return this;\r\n  }\r\n\r\n  emit(event, ...args) {\r\n    if (!this.events[event]) return this;\r\n    \r\n    this.events[event].forEach(listener => {\r\n      listener(...args);\r\n    });\r\n    \r\n    return this;\r\n  }\r\n\r\n  removeAllListeners() {\r\n    this.events = {};\r\n    return this;\r\n  }\r\n}\r\n\r\n", "/**\r\n * Performance Utilities\r\n */\r\n\r\n/**\r\n * Debounce function - limits how often a function can be called\r\n * @param {Function} func - Function to debounce\r\n * @param {number} wait - Wait time in milliseconds\r\n * @returns {Function} Debounced function\r\n */\r\nexport function debounce(func, wait = 100) {\r\n    let timeout;\r\n    return function executedFunction(...args) {\r\n        const later = () => {\r\n            clearTimeout(timeout);\r\n            func(...args);\r\n        };\r\n        clearTimeout(timeout);\r\n        timeout = setTimeout(later, wait);\r\n    };\r\n}\r\n\r\n/**\r\n * Throttle function - ensures function is called at most once per interval\r\n * @param {Function} func - Function to throttle\r\n * @param {number} limit - Time limit in milliseconds\r\n * @returns {Function} Throttled function\r\n */\r\nexport function throttle(func, limit = 100) {\r\n    let inThrottle;\r\n    return function executedFunction(...args) {\r\n        if (!inThrottle) {\r\n            func(...args);\r\n            inThrottle = true;\r\n            setTimeout(() => inThrottle = false, limit);\r\n        }\r\n    };\r\n}\r\n\r\n/**\r\n * Check if current viewport is mobile size\r\n * @param {number} breakpoint - Mobile breakpoint in pixels (default 768)\r\n * @returns {boolean} True if mobile\r\n */\r\nexport function isMobile(breakpoint = 768) {\r\n    return window.innerWidth < breakpoint;\r\n}\r\n\r\n/**\r\n * Request animation frame with timeout fallback\r\n * @param {Function} callback - Function to call\r\n * @param {number} timeout - Timeout in ms (default 100)\r\n */\r\nexport function rafWithTimeout(callback, timeout = 100) {\r\n    let called = false;\r\n    \r\n    const execute = () => {\r\n        if (!called) {\r\n            called = true;\r\n            callback();\r\n        }\r\n    };\r\n    \r\n    requestAnimationFrame(execute);\r\n    setTimeout(execute, timeout);\r\n}\r\n\r\n", "/**\r\n * Utility for capturing frames from video elements\r\n */\r\n\r\n/**\r\n * Capture a frame from a video element at a specific time\r\n * @param {HTMLVideoElement} video - Video element to capture from\r\n * @param {number} time - Time in seconds to capture\r\n * @param {Object} options - Options for frame capture\r\n * @param {boolean} [options.restoreState=true] - Whether to restore video state after capture\r\n * @param {number} [options.quality=0.9] - JPEG quality (0-1)\r\n * @param {number} [options.maxWidth] - Maximum width for thumbnail\r\n * @param {number} [options.maxHeight] - Maximum height for thumbnail\r\n * @returns {Promise<string|null>} Data URL of the captured frame or null if failed\r\n */\r\nexport async function captureVideoFrame(video, time, options = {}) {\r\n    if (!video || video.tagName !== 'VIDEO') {\r\n        return null;\r\n    }\r\n\r\n    const {\r\n        restoreState = true,\r\n        quality = 0.9,\r\n        maxWidth,\r\n        maxHeight\r\n    } = options;\r\n\r\n    // Save original state if we need to restore it\r\n    const wasPlaying = !video.paused;\r\n    const originalTime = video.currentTime;\r\n    const originalMuted = video.muted;\r\n\r\n    // Ensure video is muted during capture to avoid audio playback\r\n    if (restoreState) {\r\n        video.muted = true;\r\n    }\r\n\r\n    return new Promise((resolve) => {\r\n        const captureFrame = () => {\r\n            try {\r\n                // Get video dimensions\r\n                let width = video.videoWidth || 640;\r\n                let height = video.videoHeight || 360;\r\n\r\n                // Scale down if max dimensions specified\r\n                if (maxWidth && width > maxWidth) {\r\n                    const ratio = maxWidth / width;\r\n                    width = maxWidth;\r\n                    height = Math.round(height * ratio);\r\n                }\r\n                if (maxHeight && height > maxHeight) {\r\n                    const ratio = maxHeight / height;\r\n                    height = maxHeight;\r\n                    width = Math.round(width * ratio);\r\n                }\r\n\r\n                // Create canvas to capture frame\r\n                const canvas = document.createElement('canvas');\r\n                canvas.width = width;\r\n                canvas.height = height;\r\n                \r\n                const ctx = canvas.getContext('2d');\r\n                ctx.drawImage(video, 0, 0, width, height);\r\n                \r\n                const dataURL = canvas.toDataURL('image/jpeg', quality);\r\n                \r\n                // Restore original state if needed\r\n                if (restoreState) {\r\n                    video.currentTime = originalTime;\r\n                    video.muted = originalMuted;\r\n                    if (wasPlaying && !video.paused) {\r\n                        video.play().catch(() => {});\r\n                    }\r\n                }\r\n                \r\n                resolve(dataURL);\r\n            } catch (error) {\r\n                // Restore original state on error\r\n                if (restoreState) {\r\n                    video.currentTime = originalTime;\r\n                    video.muted = originalMuted;\r\n                    if (wasPlaying && !video.paused) {\r\n                        video.play().catch(() => {});\r\n                    }\r\n                }\r\n                resolve(null);\r\n            }\r\n        };\r\n\r\n        const onSeeked = () => {\r\n            video.removeEventListener('seeked', onSeeked);\r\n            // Wait for frame to be ready (double RAF for better frame quality)\r\n            requestAnimationFrame(() => {\r\n                requestAnimationFrame(captureFrame);\r\n            });\r\n        };\r\n\r\n        // Check if video is already at the right time and ready\r\n        const timeDiff = Math.abs(video.currentTime - time);\r\n        // Need at least HAVE_METADATA (1) to know duration, but HAVE_CURRENT_DATA (2) is better for frame capture\r\n        if (timeDiff < 0.1 && video.readyState >= 2) {\r\n            // Video is already at the right position, capture immediately\r\n            captureFrame();\r\n        } else if (video.readyState >= 1) {\r\n            // Video has metadata, we can seek\r\n            video.addEventListener('seeked', onSeeked);\r\n            video.currentTime = time;\r\n        } else {\r\n            // Video not ready yet, wait for metadata first\r\n            const onLoadedMetadata = () => {\r\n                video.removeEventListener('loadedmetadata', onLoadedMetadata);\r\n                video.addEventListener('seeked', onSeeked);\r\n                video.currentTime = time;\r\n            };\r\n            video.addEventListener('loadedmetadata', onLoadedMetadata);\r\n        }\r\n    });\r\n}\r\n\r\n", "/**\r\n * Control Bar Component\r\n */\r\n\r\nimport {DOMUtils} from '../utils/DOMUtils.js';\r\nimport {TimeUtils} from '../utils/TimeUtils.js';\r\nimport {createIconElement} from '../icons/Icons.js';\r\nimport {i18n} from '../i18n/i18n.js';\r\nimport {focusElement, focusFirstElement} from '../utils/FocusUtils.js';\r\nimport {isMobile} from '../utils/PerformanceUtils.js';\r\nimport {captureVideoFrame} from '../utils/VideoFrameCapture.js';\r\n\r\nexport class ControlBar {\r\n    constructor(player) {\r\n        this.player = player;\r\n        this.element = null;\r\n        this.controls = {};\r\n        this.hideTimeout = null;\r\n        this.isDraggingProgress = false;\r\n        this.isDraggingVolume = false;\r\n        this.openMenu = null; // Track currently open menu\r\n        this.openMenuButton = null; // Track button that opened the menu\r\n\r\n        this.init();\r\n    }\r\n\r\n    init() {\r\n        this.createElement();\r\n        this.createControls();\r\n        // Ensure time UI reflects any prefilled state (e.g. initialDuration)\r\n        // even when media metadata is deferred and 'loadedmetadata' won't fire yet.\r\n        this.updateDuration();\r\n        this.updateProgress();\r\n        this.attachEvents();\r\n        this.setupAutoHide();\r\n        this.setupOverflowDetection();\r\n    }\r\n\r\n    // Helper method to detect touch devices\r\n    isTouchDevice() {\r\n        return (\r\n            ('ontouchstart' in window) ||\r\n            (navigator.maxTouchPoints > 0) ||\r\n            (navigator.msMaxTouchPoints > 0)\r\n        );\r\n    }\r\n\r\n    // Smart menu positioning to avoid overflow\r\n    positionMenu(menu, button, immediate = false) {\r\n        const mobile = isMobile();\r\n        const isOverflowMenu = menu.classList.contains(`${this.player.options.classPrefix}-overflow-menu-list`);\r\n        const isFullscreen = this.player.state.fullscreen;\r\n        \r\n        // In fullscreen, menu is appended to player container, so use fixed positioning\r\n        if (isFullscreen && menu.parentElement === this.player.container) {\r\n            const doFullscreenPositioning = () => {\r\n                const buttonRect = button.getBoundingClientRect();\r\n                const menuRect = menu.getBoundingClientRect();\r\n                const containerRect = this.player.container.getBoundingClientRect();\r\n                const viewportHeight = window.innerHeight;\r\n                \r\n                // Position relative to player container\r\n                const buttonCenterX = buttonRect.left + buttonRect.width / 2 - containerRect.left;\r\n                const buttonTop = buttonRect.top - containerRect.top;\r\n                const buttonBottom = buttonRect.bottom - containerRect.top;\r\n                \r\n                const spaceAbove = buttonRect.top - containerRect.top;\r\n                const spaceBelow = containerRect.bottom - buttonRect.bottom;\r\n                \r\n                // Position menu above button by default\r\n                if (spaceAbove >= menuRect.height + 20 || spaceAbove > spaceBelow) {\r\n                    menu.style.bottom = `${containerRect.height - buttonTop + 8}px`;\r\n                    menu.style.top = 'auto';\r\n                    menu.classList.remove('vidply-menu-below');\r\n                } else {\r\n                    // Position below if more space there\r\n                    menu.style.top = `${buttonBottom + 8}px`;\r\n                    menu.style.bottom = 'auto';\r\n                    menu.classList.add('vidply-menu-below');\r\n                }\r\n                \r\n                // Horizontal positioning\r\n                if (isOverflowMenu) {\r\n                    // Overflow menu aligns to right\r\n                    const buttonRight = buttonRect.right - containerRect.left;\r\n                    menu.style.right = `${containerRect.width - buttonRight}px`;\r\n                    menu.style.left = 'auto';\r\n                    menu.style.transform = 'none';\r\n                } else {\r\n                    // Other menus center on button\r\n                    menu.style.left = `${buttonCenterX}px`;\r\n                    menu.style.right = 'auto';\r\n                    menu.style.transform = 'translateX(-50%)';\r\n                }\r\n            };\r\n            \r\n            if (immediate) {\r\n                doFullscreenPositioning();\r\n            } else {\r\n                requestAnimationFrame(doFullscreenPositioning);\r\n            }\r\n            return;\r\n        }\r\n        \r\n        if (mobile) {\r\n            // On mobile, ensure menus stay within viewport\r\n            const isVolumeMenu = menu.classList.contains(`${this.player.options.classPrefix}-volume-menu`);\r\n            \r\n            const doMobilePositioning = () => {\r\n                // Get the button's parent container (controls-left or controls-right)\r\n                const parentContainer = button.parentElement;\r\n                if (!parentContainer) return;\r\n                \r\n                const buttonRect = button.getBoundingClientRect();\r\n                const parentRect = parentContainer.getBoundingClientRect();\r\n                const menuRect = menu.getBoundingClientRect();\r\n                const viewportWidth = window.innerWidth;\r\n                const viewportHeight = window.innerHeight;\r\n                \r\n                // Volume menu should be centered on its button\r\n                if (isVolumeMenu) {\r\n                    // Calculate button position relative to parent\r\n                    const buttonCenterX = buttonRect.left + buttonRect.width / 2 - parentRect.left;\r\n                    \r\n                    // Center menu on button\r\n                    menu.style.left = `${buttonCenterX}px`;\r\n                    menu.style.right = 'auto';\r\n                    menu.style.transform = 'translateX(-50%)';\r\n                    return;\r\n                }\r\n                \r\n                // Check if menu overflows viewport\r\n                if (menuRect.right > viewportWidth) {\r\n                    menu.style.left = 'auto';\r\n                    menu.style.right = '10px';\r\n                    menu.style.transform = 'none';\r\n                }\r\n                \r\n                if (menuRect.left < 0) {\r\n                    menu.style.left = '10px';\r\n                    menu.style.right = 'auto';\r\n                    menu.style.transform = 'none';\r\n                }\r\n                \r\n                // Ensure menu doesn't go off top or bottom\r\n                if (menuRect.top < 10) {\r\n                    menu.style.top = '10px';\r\n                    // Important: clear bottom constraint, otherwise top+bottom will squeeze the menu height\r\n                    // into a tiny strip on some mobile layouts.\r\n                    menu.style.bottom = 'auto';\r\n                }\r\n                \r\n                if (menuRect.bottom > viewportHeight - 10) {\r\n                    menu.style.bottom = '10px';\r\n                    menu.style.top = 'auto';\r\n                }\r\n            };\r\n            \r\n            if (immediate) {\r\n                doMobilePositioning();\r\n            } else {\r\n                requestAnimationFrame(doMobilePositioning);\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Desktop: Smart positioning\r\n        // Menu is now a sibling of the button, within controls-left or controls-right container\r\n        // These containers have position: relative, so menus position relative to them\r\n        \r\n        const doPositioning = () => {\r\n            const buttonRect = button.getBoundingClientRect();\r\n            const menuRect = menu.getBoundingClientRect();\r\n            const viewportWidth = window.innerWidth;\r\n            const viewportHeight = window.innerHeight;\r\n            \r\n            // Get the button's parent container (controls-left or controls-right)\r\n            const parentContainer = button.parentElement;\r\n            if (!parentContainer) return;\r\n            \r\n            const parentRect = parentContainer.getBoundingClientRect();\r\n            \r\n            // Calculate position relative to parent container\r\n            const buttonCenterX = buttonRect.left + buttonRect.width / 2 - parentRect.left;\r\n            const buttonBottom = buttonRect.bottom - parentRect.top;\r\n            const buttonTop = buttonRect.top - parentRect.top;\r\n            \r\n            const spaceAbove = buttonRect.top;\r\n            const spaceBelow = viewportHeight - buttonRect.bottom;\r\n            \r\n            // Position menu above button by default\r\n            let menuTop = buttonTop - menuRect.height - 8;\r\n            let menuBottom = null;\r\n            \r\n            // Prefer above, but switch to below if not enough space\r\n            if (spaceAbove < menuRect.height + 20 && spaceBelow > spaceAbove) {\r\n                menuTop = null;\r\n                // Calculate bottom position relative to parent container\r\n                // bottom: X means X pixels from the bottom of the positioned parent\r\n                // We want the menu to be 8px below the button\r\n                const parentHeight = parentRect.bottom - parentRect.top;\r\n                menuBottom = parentHeight - buttonBottom + 8;\r\n                menu.classList.add('vidply-menu-below');\r\n            } else {\r\n                menu.classList.remove('vidply-menu-below');\r\n            }\r\n            \r\n            // Calculate horizontal position\r\n            let menuLeft = 'auto';\r\n            let menuRight = 'auto';\r\n            let transformX = 'translateX(0)';\r\n            \r\n            // For overflow menu, always align to the right edge\r\n            if (isOverflowMenu) {\r\n                menuLeft = 'auto';\r\n                menuRight = 0;\r\n                transformX = 'translateX(0)';\r\n            } else {\r\n                // For other menus, center on button by default\r\n                menuLeft = buttonCenterX - menuRect.width / 2;\r\n                \r\n                // Check horizontal overflow\r\n                const menuLeftAbsolute = buttonRect.left + buttonRect.width / 2 - menuRect.width / 2;\r\n                if (menuLeftAbsolute < 10) {\r\n                    // Too far left, align to left edge of parent\r\n                    menuLeft = 0;\r\n                    transformX = 'translateX(0)';\r\n                } else if (menuLeftAbsolute + menuRect.width > viewportWidth - 10) {\r\n                    // Too far right, align to right edge of parent\r\n                    menuLeft = 'auto';\r\n                    menuRight = 0;\r\n                    transformX = 'translateX(0)';\r\n                } else {\r\n                    // Center on button\r\n                    menuLeft = buttonCenterX;\r\n                    transformX = 'translateX(-50%)';\r\n                }\r\n            }\r\n            \r\n            // Apply calculated positions\r\n            if (menuTop !== null) {\r\n                menu.style.top = `${menuTop}px`;\r\n                menu.style.bottom = 'auto';\r\n            } else if (menuBottom !== null) {\r\n                menu.style.top = 'auto';\r\n                menu.style.bottom = `${menuBottom}px`;\r\n            }\r\n            \r\n            if (menuLeft !== 'auto') {\r\n                menu.style.left = `${menuLeft}px`;\r\n                menu.style.right = 'auto';\r\n            } else {\r\n                menu.style.left = 'auto';\r\n                menu.style.right = `${menuRight}px`;\r\n            }\r\n            \r\n            menu.style.transform = transformX;\r\n        };\r\n        \r\n        if (immediate) {\r\n            // Position immediately (synchronously) - used when menu is first shown\r\n            doPositioning();\r\n        } else {\r\n            // Use requestAnimationFrame to ensure layout is stable before positioning\r\n            requestAnimationFrame(() => {\r\n                setTimeout(doPositioning, 10); // Small delay to ensure layout is stable\r\n            });\r\n        }\r\n    }\r\n\r\n    // Helper method to insert menu into DOM (handles fullscreen vs normal mode)\r\n    insertMenuIntoDOM(menu, button) {\r\n        // Ensure menu has an ID for aria-controls relationship\r\n        if (!menu.id) {\r\n            menu.id = `vidply-menu-${Math.random().toString(36).substr(2, 9)}`;\r\n        }\r\n        \r\n        // Set ARIA attributes for screen reader users (WCAG 4.1.2)\r\n        button.setAttribute('aria-controls', menu.id);\r\n        button.setAttribute('aria-haspopup', 'true');\r\n        \r\n        // In fullscreen, append menu to player container to escape video-wrapper stacking context\r\n        // This allows menus to appear above the playlist panel\r\n        // Otherwise, keep it after the button for WCAG compliance\r\n        const isFullscreen = this.player.state.fullscreen;\r\n        if (isFullscreen) {\r\n            // Append to player container as sibling to playlist panel\r\n            this.player.container.appendChild(menu);\r\n            // Store reference to button for positioning\r\n            menu.dataset.triggerButton = button.getAttribute('aria-label') || 'button';\r\n        } else {\r\n            // Insert menu right after the button in the DOM for keyboard navigation\r\n            button.insertAdjacentElement('afterend', menu);\r\n        }\r\n    }\r\n\r\n    // Helper method to attach close-on-outside-click behavior to menus\r\n    attachMenuCloseHandler(menu, button, preventCloseOnInteraction = false) {\r\n        // Close any previously open menu and clean up its handlers\r\n        if (this.openMenu && this.openMenu !== menu && this.openMenuButton) {\r\n            // Remove previous button's blur handler if it exists\r\n            if (this.openMenuButton._vidplyBlurHandler) {\r\n                this.openMenuButton.removeEventListener('blur', this.openMenuButton._vidplyBlurHandler);\r\n                delete this.openMenuButton._vidplyBlurHandler;\r\n            }\r\n            if (this.openMenuButton._vidplyMousedownHandler) {\r\n                this.openMenuButton.removeEventListener('mousedown', this.openMenuButton._vidplyMousedownHandler);\r\n                delete this.openMenuButton._vidplyMousedownHandler;\r\n            }\r\n            \r\n            // Close previous menu without returning focus\r\n            if (this.openMenu && document.contains(this.openMenu)) {\r\n                this.openMenu.remove();\r\n            } else if (this.openMenu && this.openMenu.parentNode) {\r\n                this.openMenu.parentNode.removeChild(this.openMenu);\r\n            }\r\n            if (this.openMenuButton) {\r\n                this.openMenuButton.setAttribute('aria-expanded', 'false');\r\n            }\r\n        }\r\n        \r\n        // Track this menu as open\r\n        this.openMenu = menu;\r\n        this.openMenuButton = button;\r\n        \r\n        // Position menu smartly\r\n        this.positionMenu(menu, button);\r\n        \r\n        // Set aria-expanded to true when menu opens\r\n        if (button) {\r\n            button.setAttribute('aria-expanded', 'true');\r\n        }\r\n        \r\n        // Add focus handler to button to close menu when focus leaves to another control bar button\r\n        // But only if it's a keyboard navigation (Tab), not a click\r\n        let isClickingButton = false;\r\n        let blurHandlerActive = true;\r\n        \r\n        const handleButtonMousedown = () => {\r\n            isClickingButton = true;\r\n            // Temporarily disable blur handler when clicking\r\n            blurHandlerActive = false;\r\n            setTimeout(() => {\r\n                isClickingButton = false;\r\n                blurHandlerActive = true;\r\n            }, 200);\r\n        };\r\n        button.addEventListener('mousedown', handleButtonMousedown);\r\n        button._vidplyMousedownHandler = handleButtonMousedown; // Store for cleanup\r\n        \r\n        const handleButtonBlur = (e) => {\r\n            // If blur handler is disabled (during click) or this is a click, don't close the menu\r\n            if (!blurHandlerActive || isClickingButton) {\r\n                return;\r\n            }\r\n            \r\n            // Check if this menu is still the open menu (might have been replaced)\r\n            if (this.openMenu !== menu) {\r\n                return;\r\n            }\r\n            \r\n            // Store the related target (where focus is going) before async operations\r\n            const relatedTarget = e.relatedTarget;\r\n            \r\n            // Use requestAnimationFrame to check where focus went after browser handles focus\r\n            requestAnimationFrame(() => {\r\n                setTimeout(() => {\r\n                    // Check again if blur handler is still active and menu is still open\r\n                    if (!blurHandlerActive || this.openMenu !== menu) {\r\n                        return;\r\n                    }\r\n                    \r\n                    const activeElement = document.activeElement;\r\n                    \r\n                    // Don't close if focus is still within the menu\r\n                    if (menu.contains(activeElement)) {\r\n                        return;\r\n                    }\r\n                    \r\n                    // Don't close if focus moved to sign language or transcript windows\r\n                    const signLanguageWrapper = this.player.signLanguageWrapper;\r\n                    const transcriptWindow = this.player.transcriptManager?.transcriptWindow;\r\n                    if ((signLanguageWrapper && signLanguageWrapper.contains(activeElement)) ||\r\n                        (transcriptWindow && transcriptWindow.contains(activeElement))) {\r\n                        return;\r\n                    }\r\n                    \r\n                    // If focus moved to another button in the control bar, close the menu\r\n                    const controlBarButtons = this.element.querySelectorAll('button');\r\n                    const isFocusOnAnotherButton = Array.from(controlBarButtons).includes(activeElement) && activeElement !== button;\r\n                    \r\n                    // Also check relatedTarget in case activeElement hasn't updated yet\r\n                    const isRelatedTargetAnotherButton = relatedTarget && Array.from(controlBarButtons).includes(relatedTarget) && relatedTarget !== button;\r\n                    \r\n                    // Close menu if focus moved to another control bar button (without returning focus)\r\n                    if (isFocusOnAnotherButton || isRelatedTargetAnotherButton) {\r\n                        // Double-check this menu is still the open menu\r\n                        if (this.openMenu !== menu) {\r\n                            return;\r\n                        }\r\n                        \r\n                        // Just remove the menu, don't touch focus at all\r\n                        if (menu && document.contains(menu)) {\r\n                            menu.remove();\r\n                        } else if (menu && menu.parentNode) {\r\n                            menu.parentNode.removeChild(menu);\r\n                        }\r\n                        if (button) {\r\n                            button.setAttribute('aria-expanded', 'false');\r\n                        }\r\n                        // Clear tracking\r\n                        if (this.openMenu === menu) {\r\n                            this.openMenu = null;\r\n                            this.openMenuButton = null;\r\n                        }\r\n                        button.removeEventListener('blur', handleButtonBlur);\r\n                        button.removeEventListener('mousedown', handleButtonMousedown);\r\n                        delete button._vidplyBlurHandler;\r\n                        delete button._vidplyMousedownHandler;\r\n                    }\r\n                }, 10); // Small delay to ensure focus has fully moved\r\n            });\r\n        };\r\n        button.addEventListener('blur', handleButtonBlur);\r\n        button._vidplyBlurHandler = handleButtonBlur; // Store for cleanup\r\n        \r\n        const closeMenuAndUpdateAria = () => {\r\n            this.closeMenuAndReturnFocus(menu, button);\r\n        };\r\n        \r\n        // Store document handlers for cleanup\r\n        let documentClickHandler = null;\r\n        let documentEscapeHandler = null;\r\n        \r\n        setTimeout(() => {\r\n            documentClickHandler = (e) => {\r\n                // If this menu has form controls, don't close when clicking inside\r\n                if (preventCloseOnInteraction && menu.contains(e.target)) {\r\n                    return;\r\n                }\r\n\r\n                // Check if click is outside menu and button\r\n                // Also check if this menu is still the open menu\r\n                if (this.openMenu === menu && !menu.contains(e.target) && !button.contains(e.target)) {\r\n                    closeMenuAndUpdateAria();\r\n                    if (documentClickHandler) {\r\n                        document.removeEventListener('click', documentClickHandler);\r\n                    }\r\n                    if (documentEscapeHandler) {\r\n                        document.removeEventListener('keydown', documentEscapeHandler);\r\n                    }\r\n                }\r\n            };\r\n\r\n            documentEscapeHandler = (e) => {\r\n                if (e.key === 'Escape' && this.openMenu === menu) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    // Close menu and return focus to the button that opened it\r\n                    this.closeMenuAndReturnFocus(menu, button, true);\r\n                    if (documentClickHandler) {\r\n                        document.removeEventListener('click', documentClickHandler);\r\n                    }\r\n                    if (documentEscapeHandler) {\r\n                        document.removeEventListener('keydown', documentEscapeHandler);\r\n                    }\r\n                }\r\n            };\r\n\r\n            document.addEventListener('click', documentClickHandler);\r\n            document.addEventListener('keydown', documentEscapeHandler);\r\n        }, 100);\r\n    }\r\n\r\n    // Helper method to close menu and return focus to button\r\n    closeMenuAndReturnFocus(menu, button, returnFocus = true) {\r\n        if (menu) {\r\n            // Remove menu from DOM - use remove() which works reliably\r\n            if (document.contains(menu)) {\r\n                menu.remove();\r\n            } else if (menu.parentNode) {\r\n                // Fallback if menu is not in document but has parent\r\n                menu.parentNode.removeChild(menu);\r\n            }\r\n        }\r\n        if (button) {\r\n            button.setAttribute('aria-expanded', 'false');\r\n            // Clean up aria-controls since menu is removed (optional, but cleaner)\r\n            // Note: Keeping it doesn't cause issues, but removing it is semantically correct\r\n            // when the referenced element no longer exists\r\n            if (menu && menu.id) {\r\n                button.removeAttribute('aria-controls');\r\n            }\r\n            // Only return focus if explicitly requested (not when tabbing away)\r\n            if (returnFocus) {\r\n                // Use requestAnimationFrame to ensure DOM updates are complete before focusing\r\n                // This prevents focus from jumping to next/previous button\r\n                requestAnimationFrame(() => {\r\n                    setTimeout(() => {\r\n                        if (button && document.contains(button)) {\r\n                            button.focus({ preventScroll: true });\r\n                        }\r\n                    }, 0);\r\n                });\r\n            }\r\n        }\r\n        // Clear tracking\r\n        if (this.openMenu === menu) {\r\n            this.openMenu = null;\r\n            this.openMenuButton = null;\r\n        }\r\n    }\r\n    \r\n    // Close any open menu when tabbing to another button or clicking another button\r\n    closeOpenMenu() {\r\n        if (this.openMenu && this.openMenuButton) {\r\n            // Close without returning focus (user is tabbing to next element or clicking another button)\r\n            if (this.openMenu && document.contains(this.openMenu)) {\r\n                this.openMenu.remove();\r\n            } else if (this.openMenu && this.openMenu.parentNode) {\r\n                this.openMenu.parentNode.removeChild(this.openMenu);\r\n            }\r\n            if (this.openMenuButton) {\r\n                this.openMenuButton.setAttribute('aria-expanded', 'false');\r\n            }\r\n            // Clear tracking\r\n            this.openMenu = null;\r\n            this.openMenuButton = null;\r\n        }\r\n    }\r\n\r\n    // Helper method to add keyboard navigation to menus (arrow keys)\r\n    attachMenuKeyboardNavigation(menu, button) {\r\n        const menuItems = Array.from(menu.querySelectorAll(`.${this.player.options.classPrefix}-menu-item`));\r\n        \r\n        if (menuItems.length === 0) return;\r\n\r\n        const handleKeyDown = (e) => {\r\n            const currentIndex = menuItems.indexOf(document.activeElement);\r\n            \r\n            switch (e.key) {\r\n                case 'ArrowDown':\r\n                    e.preventDefault();\r\n                    e.stopPropagation(); // Prevent volume/seek actions\r\n                    const nextIndex = (currentIndex + 1) % menuItems.length;\r\n                    menuItems[nextIndex].focus({ preventScroll: false });\r\n                    menuItems[nextIndex].scrollIntoView({ behavior: 'smooth', block: 'nearest' });\r\n                    break;\r\n                \r\n                case 'ArrowUp':\r\n                    e.preventDefault();\r\n                    e.stopPropagation(); // Prevent volume/seek actions\r\n                    const prevIndex = (currentIndex - 1 + menuItems.length) % menuItems.length;\r\n                    menuItems[prevIndex].focus({ preventScroll: false });\r\n                    menuItems[prevIndex].scrollIntoView({ behavior: 'smooth', block: 'nearest' });\r\n                    break;\r\n                \r\n                case 'ArrowLeft':\r\n                case 'ArrowRight':\r\n                    // Prevent seeking when in menu (but allow menu to handle if needed)\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    break;\r\n                \r\n                case 'Home':\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    menuItems[0].focus({ preventScroll: false });\r\n                    menuItems[0].scrollIntoView({ behavior: 'smooth', block: 'nearest' });\r\n                    break;\r\n                \r\n                case 'End':\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    menuItems[menuItems.length - 1].focus({ preventScroll: false });\r\n                    menuItems[menuItems.length - 1].scrollIntoView({ behavior: 'smooth', block: 'nearest' });\r\n                    break;\r\n                \r\n                case 'Enter':\r\n                case ' ':\r\n                    e.preventDefault();\r\n                    e.stopPropagation(); // Prevent event from reaching KeyboardManager\r\n                    if (document.activeElement && menuItems.includes(document.activeElement)) {\r\n                        document.activeElement.click();\r\n                        // Menu will be closed by the click handler, but ensure focus returns\r\n                        focusElement(button, { delay: 0 });\r\n                    }\r\n                    break;\r\n                \r\n                case 'Escape':\r\n                    e.preventDefault();\r\n                    e.stopPropagation(); // Prevent event from reaching KeyboardManager\r\n                    // Close menu and return focus to the button that opened it\r\n                    this.closeMenuAndReturnFocus(menu, button, true);\r\n                    break;\r\n            }\r\n        };\r\n\r\n        menu.addEventListener('keydown', handleKeyDown);\r\n    }\r\n\r\n    createElement() {\r\n        this.element = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-controls`,\r\n            attributes: {\r\n                'role': 'region',\r\n                'aria-label': i18n.t('player.label') + ' controls'\r\n            }\r\n        });\r\n    }\r\n\r\n    createControls() {\r\n        // Progress bar and time display wrapper\r\n        const progressTimeWrapper = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-progress-time-wrapper`\r\n        });\r\n\r\n        // Progress bar container\r\n        if (this.player.options.progressBar) {\r\n            this.createProgressBar();\r\n            progressTimeWrapper.appendChild(this.controls.progress);\r\n        }\r\n\r\n        // Time display (right beside progress bar)\r\n        if (this.player.options.currentTime || this.player.options.duration) {\r\n            progressTimeWrapper.appendChild(this.createTimeDisplay());\r\n        }\r\n\r\n        this.element.appendChild(progressTimeWrapper);\r\n\r\n        // Button container\r\n        const buttonContainer = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-controls-buttons`\r\n        });\r\n\r\n        // Left buttons\r\n        const leftButtons = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-controls-left`\r\n        });\r\n\r\n        // Previous track button (if playlist)\r\n        if (this.player.playlistManager) {\r\n            leftButtons.appendChild(this.createPreviousButton());\r\n        }\r\n\r\n        // Play/Pause button\r\n        if (this.player.options.playPauseButton) {\r\n            leftButtons.appendChild(this.createPlayPauseButton());\r\n        }\r\n\r\n        // Restart button (right beside play button)\r\n        leftButtons.appendChild(this.createRestartButton());\r\n\r\n        // Next track button (if playlist)\r\n        if (this.player.playlistManager) {\r\n            leftButtons.appendChild(this.createNextButton());\r\n        }\r\n\r\n        // Rewind button (not shown in playlist mode)\r\n        if (!this.player.playlistManager) {\r\n            leftButtons.appendChild(this.createRewindButton());\r\n        }\r\n\r\n        // Forward button (not shown in playlist mode)\r\n        if (!this.player.playlistManager) {\r\n            leftButtons.appendChild(this.createForwardButton());\r\n        }\r\n\r\n        // Volume control\r\n        if (this.player.options.volumeControl) {\r\n            // On touch devices: simple mute button (hardware buttons control volume)\r\n            // On desktop: full volume control with slider\r\n            if (this.isTouchDevice()) {\r\n                leftButtons.appendChild(this.createMuteButton());\r\n            } else {\r\n                leftButtons.appendChild(this.createVolumeControl());\r\n            }\r\n        }\r\n\r\n        // Right buttons\r\n        this.rightButtons = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-controls-right`\r\n        });\r\n\r\n        // Check for available features\r\n        const hasChapters = this.hasChapterTracks();\r\n        const hasCaptions = this.hasCaptionTracks();\r\n        const hasQualityLevels = this.hasQualityLevels();\r\n        const hasAudioDescription = this.hasAudioDescription();\r\n\r\n        // Priority order (lower number = higher priority, stays visible longer)\r\n        // Desktop (>768px):\r\n        //   Priority 1: Play, Volume, Captions, Speed, Fullscreen\r\n        //   Priority 2: Audio Description, Quality  \r\n        //   Priority 3: Chapters, Caption Style, Transcript, Sign Language, PiP\r\n        // Smaller screens (<768px):\r\n        //   Priority 1: Play, Volume, Progress (only left controls visible)\r\n        //   Priority 3: ALL right-side buttons go to overflow menu\r\n\r\n        // 1. Chapters button\r\n        if (this.player.options.chaptersButton && hasChapters) {\r\n            const btn = this.createChaptersButton();\r\n            btn.dataset.overflowPriority = '3';\r\n            btn.dataset.overflowPriorityMobile = '3';\r\n            this.rightButtons.appendChild(btn);\r\n        }\r\n\r\n        // 2. Captions button\r\n        if (this.player.options.captionsButton && hasCaptions) {\r\n            const btn = this.createCaptionsButton();\r\n            btn.dataset.overflowPriority = '1';\r\n            btn.dataset.overflowPriorityMobile = '3';\r\n            this.rightButtons.appendChild(btn);\r\n        }\r\n\r\n        // 3. Caption styling button\r\n        if (this.player.options.captionStyleButton && hasCaptions) {\r\n            const btn = this.createCaptionStyleButton();\r\n            btn.dataset.overflowPriority = '3';\r\n            btn.dataset.overflowPriorityMobile = '3';\r\n            this.rightButtons.appendChild(btn);\r\n        }\r\n\r\n        // 4. Playback speed button\r\n        // IMPORTANT: Don't rely on renderer.constructor.name here.\r\n        // In production builds, class names are minified (e.g. \"class s\"), which would break the check.\r\n        // Instead, detect HLS by the current source URL.\r\n        const src = this.player.currentSource\r\n            || this.player.element?.getAttribute?.('src')\r\n            || this.player.element?.currentSrc\r\n            || this.player.element?.src\r\n            || this.player.element?.querySelector?.('source')?.getAttribute?.('src')\r\n            || this.player.element?.querySelector?.('source')?.src\r\n            || '';\r\n        const isHlsSource = typeof src === 'string' && src.includes('.m3u8');\r\n        const isVideoElement = this.player.element?.tagName?.toLowerCase() === 'video';\r\n        const hideSpeedForThisPlayer =\r\n            (!!this.player.options.hideSpeedForHls && isHlsSource)\r\n            || (!!this.player.options.hideSpeedForHlsVideo && isHlsSource && isVideoElement);\r\n        if (this.player.options.speedButton && !hideSpeedForThisPlayer) {\r\n            const btn = this.createSpeedButton();\r\n            btn.dataset.overflowPriority = '1';\r\n            btn.dataset.overflowPriorityMobile = '3';\r\n            this.rightButtons.appendChild(btn);\r\n        }\r\n\r\n        // 5. Audio Description button\r\n        if (this.player.options.audioDescriptionButton && hasAudioDescription) {\r\n            const btn = this.createAudioDescriptionButton();\r\n            btn.dataset.overflowPriority = '2';\r\n            btn.dataset.overflowPriorityMobile = '3';\r\n            this.rightButtons.appendChild(btn);\r\n        }\r\n\r\n        // 6. Transcript button\r\n        if (this.player.options.transcriptButton && hasCaptions) {\r\n            const btn = this.createTranscriptButton();\r\n            btn.dataset.overflowPriority = '3';\r\n            btn.dataset.overflowPriorityMobile = '3';\r\n            this.rightButtons.appendChild(btn);\r\n        }\r\n\r\n        // 6.5 Playlist toggle button (for playlists)\r\n        if (this.player.playlistManager && this.player.options.playlistToggleButton !== false) {\r\n            const btn = this.createPlaylistToggleButton();\r\n            btn.dataset.overflowPriority = '2';\r\n            btn.dataset.overflowPriorityMobile = '3';\r\n            this.rightButtons.appendChild(btn);\r\n        }\r\n\r\n        // 7. Sign Language buttons (PiP overlay and/or main view src swap)\r\n        const hasSignLanguage = this.hasSignLanguage();\r\n        const showSignLanguageButtons = this.player.options.signLanguageButton !== false && hasSignLanguage;\r\n        const signLanguageDisplayMode = this.player.options.signLanguageDisplayMode || 'both';\r\n        if (showSignLanguageButtons) {\r\n            // PiP overlay button (show if mode is 'pip' or 'both')\r\n            if (['pip', 'both'].includes(signLanguageDisplayMode)) {\r\n                const pipBtn = this.createSignLanguageButton();\r\n                pipBtn.dataset.overflowPriority = '3';\r\n                pipBtn.dataset.overflowPriorityMobile = '3';\r\n                this.rightButtons.appendChild(pipBtn);\r\n            }\r\n            \r\n            // Main view button (show if mode is 'main' or 'both')\r\n            if (['main', 'both'].includes(signLanguageDisplayMode)) {\r\n                const mainViewBtn = this.createSignLanguageInMainViewButton();\r\n                mainViewBtn.dataset.overflowPriority = '3';\r\n                mainViewBtn.dataset.overflowPriorityMobile = '3';\r\n                this.rightButtons.appendChild(mainViewBtn);\r\n            }\r\n        }\r\n\r\n        // Quality button (before fullscreen)\r\n        if (this.player.options.qualityButton && hasQualityLevels) {\r\n            const btn = this.createQualityButton();\r\n            btn.dataset.overflowPriority = '2';\r\n            btn.dataset.overflowPriorityMobile = '3';\r\n            this.rightButtons.appendChild(btn);\r\n        }\r\n\r\n        // PiP button (before fullscreen)\r\n        if (this.player.options.pipButton && 'pictureInPictureEnabled' in document) {\r\n            const btn = this.createPipButton();\r\n            btn.dataset.overflowPriority = '3';\r\n            btn.dataset.overflowPriorityMobile = '3';\r\n            this.rightButtons.appendChild(btn);\r\n        }\r\n\r\n        // 8. Fullscreen button (last)\r\n        // Don't show fullscreen button for audio players\r\n        const isAudioPlayer = this.player.element.tagName.toLowerCase() === 'audio';\r\n        if (this.player.options.fullscreenButton && !isAudioPlayer) {\r\n            const btn = this.createFullscreenButton();\r\n            btn.dataset.overflowPriority = '1';\r\n            btn.dataset.overflowPriorityMobile = '3';\r\n            this.rightButtons.appendChild(btn);\r\n        }\r\n\r\n        // Create overflow menu button (initially hidden)\r\n        this.overflowMenuButton = this.createOverflowMenuButton();\r\n        this.overflowMenuButton.style.display = 'none';\r\n        this.rightButtons.appendChild(this.overflowMenuButton);\r\n\r\n        buttonContainer.appendChild(leftButtons);\r\n        buttonContainer.appendChild(this.rightButtons);\r\n        this.element.appendChild(buttonContainer);\r\n        \r\n        // Ensure all buttons have title attributes\r\n        this.ensureButtonTooltips(buttonContainer);\r\n    }\r\n    \r\n    /**\r\n     * Ensure all buttons in the controls have title attributes\r\n     * Uses aria-label as title if title is not present\r\n     */\r\n    ensureButtonTooltips(container) {\r\n        const buttons = container.querySelectorAll('button');\r\n        buttons.forEach(button => {\r\n            // Skip if tooltip already exists\r\n            if (button.querySelector(`.${this.player.options.classPrefix}-tooltip`)) {\r\n                return;\r\n            }\r\n            \r\n            // Skip if button text already exists\r\n            if (button.querySelector(`.${this.player.options.classPrefix}-button-text`)) {\r\n                return;\r\n            }\r\n            \r\n            // Skip menu items - they already have visible text\r\n            if (button.getAttribute('role') === 'menuitem' || \r\n                button.classList.contains(`${this.player.options.classPrefix}-settings-item`) ||\r\n                button.classList.contains(`${this.player.options.classPrefix}-menu-item`) ||\r\n                button.classList.contains(`${this.player.options.classPrefix}-transcript-settings-item`) ||\r\n                button.classList.contains(`${this.player.options.classPrefix}-sign-language-settings-item`) ||\r\n                button.classList.contains(`${this.player.options.classPrefix}-popup-settings-item`)) {\r\n                return;\r\n            }\r\n            \r\n            const ariaLabel = button.getAttribute('aria-label');\r\n            if (ariaLabel) {\r\n                // Add tooltip (aria-hidden popover)\r\n                DOMUtils.attachTooltip(button, ariaLabel, this.player.options.classPrefix);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Helper methods to check for available features\r\n    hasChapterTracks() {\r\n        // 1) Prefer already-loaded TextTracks (fast + accurate)\r\n        const textTracks = this.player.element.textTracks;\r\n        for (let i = 0; i < textTracks.length; i++) {\r\n            if (textTracks[i].kind === 'chapters') return true;\r\n            }\r\n\r\n        // 2) Fallback to DOM <track> elements (works before tracks are fully loaded)\r\n        const trackEls = Array.from(this.player.element.querySelectorAll('track[kind=\"chapters\"]'));\r\n        if (trackEls.length > 0) return true;\r\n\r\n        // 3) Playlist metadata fallback (works even when we intentionally defer loading)\r\n        const current = this.player.playlistManager?.getCurrentTrack?.();\r\n        if (current?.tracks && Array.isArray(current.tracks)) {\r\n            return current.tracks.some(t => t?.kind === 'chapters');\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    hasCaptionTracks() {\r\n        // 1) Prefer already-loaded TextTracks\r\n        const textTracks = this.player.element.textTracks;\r\n        for (let i = 0; i < textTracks.length; i++) {\r\n            if (textTracks[i].kind === 'captions' || textTracks[i].kind === 'subtitles') return true;\r\n        }\r\n\r\n        // 2) Fallback to DOM <track> elements\r\n        const trackEls = Array.from(this.player.element.querySelectorAll('track'));\r\n        if (trackEls.some(el => (el.getAttribute('kind') === 'captions' || el.getAttribute('kind') === 'subtitles'))) {\r\n                return true;\r\n            }\r\n\r\n        // 3) Playlist metadata fallback\r\n        const current = this.player.playlistManager?.getCurrentTrack?.();\r\n        if (current?.tracks && Array.isArray(current.tracks)) {\r\n            return current.tracks.some(t => t?.kind === 'captions' || t?.kind === 'subtitles');\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    hasQualityLevels() {\r\n        // Check if renderer supports quality selection\r\n        if (this.player.renderer && this.player.renderer.getQualities) {\r\n            const qualities = this.player.renderer.getQualities();\r\n            return qualities && qualities.length > 1;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    hasAudioDescription() {\r\n        // Check for audio-described video source OR description tracks\r\n        if (this.player.audioDescriptionSrc && this.player.audioDescriptionSrc.length > 0) {\r\n            return true;\r\n        }\r\n        \r\n        // Check for description tracks\r\n        const textTracks = Array.from(this.player.element.textTracks || []);\r\n        return textTracks.some(track => track.kind === 'descriptions');\r\n    }\r\n\r\n    hasSignLanguage() {\r\n        // Check for single source or multiple sources\r\n        const hasSingleSource = this.player.signLanguageSrc && this.player.signLanguageSrc.length > 0;\r\n        const hasMultipleSources = this.player.signLanguageSources && Object.keys(this.player.signLanguageSources).length > 0;\r\n        return hasSingleSource || hasMultipleSources;\r\n    }\r\n\r\n    createProgressBar() {\r\n        const progressContainer = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-progress-container`,\r\n            attributes: {\r\n                'role': 'slider',\r\n                'aria-label': i18n.t('player.progress'),\r\n                'aria-valuemin': '0',\r\n                'aria-valuemax': '100',\r\n                'aria-valuenow': '0',\r\n                'tabindex': '0'\r\n            }\r\n        });\r\n\r\n        // Buffered progress\r\n        this.controls.buffered = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-progress-buffered`\r\n        });\r\n\r\n        // Played progress\r\n        this.controls.played = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-progress-played`\r\n        });\r\n\r\n        // Progress handle\r\n        this.controls.progressHandle = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-progress-handle`\r\n        });\r\n\r\n        // Tooltip\r\n        this.controls.progressTooltip = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-progress-tooltip`\r\n        });\r\n\r\n        // Preview thumbnail (for video only)\r\n        this.controls.progressPreview = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-progress-preview`,\r\n            attributes: {\r\n                'aria-hidden': 'true'\r\n            }\r\n        });\r\n        this.controls.progressTooltip.appendChild(this.controls.progressPreview);\r\n\r\n        // Time text\r\n        this.controls.progressTooltipTime = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-progress-tooltip-time`\r\n        });\r\n        this.controls.progressTooltip.appendChild(this.controls.progressTooltipTime);\r\n\r\n        progressContainer.appendChild(this.controls.buffered);\r\n        progressContainer.appendChild(this.controls.played);\r\n        this.controls.played.appendChild(this.controls.progressHandle);\r\n        progressContainer.appendChild(this.controls.progressTooltip);\r\n\r\n        this.controls.progress = progressContainer;\r\n\r\n        // Initialize preview functionality\r\n        this.initPreviewThumbnail();\r\n\r\n        // Progress bar events\r\n        this.setupProgressBarEvents();\r\n    }\r\n\r\n    /**\r\n     * Initialize preview thumbnail functionality for HTML5 video\r\n     */\r\n    initPreviewThumbnail() {\r\n        this.previewThumbnailCache = new Map();\r\n        this.previewVideo = null;\r\n        this.currentPreviewTime = null;\r\n        this.previewThumbnailTimeout = null;\r\n        this.previewSupported = false;\r\n        this.previewVideoReady = false;\r\n        this.previewVideoInitialized = false;\r\n\r\n        // Check if preview is supported (HTML5 video only)\r\n        // Check if element is a video\r\n        const isVideo = this.player.element && this.player.element.tagName === 'VIDEO';\r\n        \r\n        if (!isVideo) {\r\n            return;\r\n        }\r\n\r\n        // IMPORTANT: do NOT create/load the preview video until the user has started playback at least once.\r\n        // Otherwise we'd trigger heavy MP4 network traffic just by hovering the progress bar.\r\n    }\r\n\r\n    /**\r\n     * Lazily create the hidden preview video (only after playback started once)\r\n     */\r\n    ensurePreviewVideoInitialized() {\r\n        if (this.previewVideoInitialized) return;\r\n        if (!this.player?.state?.hasStartedPlayback) return;\r\n\r\n        const renderer = this.player.renderer;\r\n        const hasVideoMedia = renderer && renderer.media && renderer.media.tagName === 'VIDEO';\r\n        const isHTML5Renderer = hasVideoMedia &&\r\n            renderer.media === this.player.element &&\r\n            !renderer.hls &&\r\n            typeof renderer.seek === 'function';\r\n\r\n        this.previewSupported = isHTML5Renderer && hasVideoMedia;\r\n        if (!this.previewSupported) return;\r\n\r\n        const mainVideo = renderer.media || this.player.element;\r\n        let videoSrc = null;\r\n        if (mainVideo.src) {\r\n            videoSrc = mainVideo.src;\r\n        } else {\r\n            const source = mainVideo.querySelector('source');\r\n            if (source) {\r\n                videoSrc = source.src;\r\n            }\r\n        }\r\n\r\n        if (!videoSrc) {\r\n            this.player.log('No video source found for preview', 'warn');\r\n            this.previewSupported = false;\r\n            return;\r\n        }\r\n\r\n        // Create a hidden video element for capturing frames\r\n        this.previewVideo = document.createElement('video');\r\n        this.previewVideo.muted = true;\r\n        this.previewVideo.preload = 'auto'; // Need more than metadata to capture frames\r\n        this.previewVideo.playsInline = true;\r\n        this.previewVideo.style.position = 'absolute';\r\n        this.previewVideo.style.visibility = 'hidden';\r\n        this.previewVideo.style.width = '1px';\r\n        this.previewVideo.style.height = '1px';\r\n        this.previewVideo.style.top = '-9999px';\r\n\r\n        if (mainVideo.crossOrigin) {\r\n            this.previewVideo.crossOrigin = mainVideo.crossOrigin;\r\n        }\r\n\r\n        this.previewVideo.addEventListener('error', (e) => {\r\n            this.player.log('Preview video failed to load:', e, 'warn');\r\n            this.previewSupported = false;\r\n        });\r\n\r\n        this.previewVideo.addEventListener('loadedmetadata', () => {\r\n            this.previewVideoReady = true;\r\n        }, { once: true });\r\n\r\n        if (this.player.container) {\r\n            this.player.container.appendChild(this.previewVideo);\r\n        }\r\n\r\n        this.previewVideo.src = videoSrc;\r\n        this.previewVideoReady = false;\r\n        this.previewVideoInitialized = true;\r\n    }\r\n\r\n    /**\r\n     * Generate preview thumbnail for a specific time\r\n     * @param {number} time - Time in seconds\r\n     * @returns {Promise<string>} Data URL of the thumbnail\r\n     */\r\n    async generatePreviewThumbnail(time) {\r\n        if (!this.previewSupported || !this.previewVideo) {\r\n            return null;\r\n        }\r\n\r\n        // Wait for preview video to be ready if not yet loaded\r\n        if (!this.previewVideoReady) {\r\n            if (this.previewVideo.readyState < 2) {\r\n                // Wait for at least HAVE_CURRENT_DATA (2) to ensure we can capture frames\r\n                await new Promise((resolve, reject) => {\r\n                    const timeout = setTimeout(() => {\r\n                        reject(new Error('Preview video data load timeout'));\r\n                    }, 10000);\r\n                    \r\n                    const cleanup = () => {\r\n                        clearTimeout(timeout);\r\n                        this.previewVideo.removeEventListener('loadeddata', checkReady);\r\n                        this.previewVideo.removeEventListener('canplay', checkReady);\r\n                        this.previewVideo.removeEventListener('error', onError);\r\n                    };\r\n                    \r\n                    const checkReady = () => {\r\n                        if (this.previewVideo.readyState >= 2) {\r\n                            cleanup();\r\n                            this.previewVideoReady = true;\r\n                            resolve();\r\n                        }\r\n                    };\r\n                    \r\n                    const onError = () => {\r\n                        cleanup();\r\n                        reject(new Error('Preview video failed to load'));\r\n                    };\r\n                    \r\n                    // Try loadeddata first (faster), fallback to canplay\r\n                    if (this.previewVideo.readyState >= 1) {\r\n                        this.previewVideo.addEventListener('loadeddata', checkReady);\r\n                    }\r\n                    this.previewVideo.addEventListener('canplay', checkReady);\r\n                    this.previewVideo.addEventListener('error', onError);\r\n                    \r\n                    // If already ready, resolve immediately\r\n                    if (this.previewVideo.readyState >= 2) {\r\n                        checkReady();\r\n                    }\r\n                }).catch(() => {\r\n                    this.previewSupported = false;\r\n                    return null;\r\n                });\r\n            } else {\r\n                this.previewVideoReady = true;\r\n            }\r\n        }\r\n\r\n        // Check cache first\r\n        const cacheKey = Math.floor(time);\r\n        if (this.previewThumbnailCache.has(cacheKey)) {\r\n            return this.previewThumbnailCache.get(cacheKey);\r\n        }\r\n\r\n        // Use shared frame capture utility\r\n        // Don't restore state since preview video is always muted and hidden\r\n        const dataURL = await captureVideoFrame(this.previewVideo, time, {\r\n            restoreState: false,\r\n            quality: 0.8,\r\n            maxWidth: 160,\r\n            maxHeight: 90\r\n        });\r\n\r\n        if (dataURL) {\r\n            // Cache the thumbnail (limit cache size to 20 entries using LRU-like behavior)\r\n            if (this.previewThumbnailCache.size >= 20) {\r\n                // Delete oldest entry (first key in insertion order)\r\n                const firstKey = this.previewThumbnailCache.keys().next().value;\r\n                this.previewThumbnailCache.delete(firstKey);\r\n            }\r\n            this.previewThumbnailCache.set(cacheKey, dataURL);\r\n        }\r\n\r\n        return dataURL;\r\n    }\r\n\r\n    /**\r\n     * Update preview thumbnail display\r\n     * @param {number} time - Time in seconds\r\n     */\r\n    async updatePreviewThumbnail(time) {\r\n        if (!this.previewSupported || !this.controls.progressPreview) {\r\n            return;\r\n        }\r\n\r\n        // Clear any pending updates\r\n        if (this.previewThumbnailTimeout) {\r\n            clearTimeout(this.previewThumbnailTimeout);\r\n        }\r\n\r\n        // Debounce thumbnail generation to avoid excessive seeking\r\n        this.previewThumbnailTimeout = setTimeout(async () => {\r\n            try {\r\n                const thumbnail = await this.generatePreviewThumbnail(time);\r\n                if (thumbnail && this.controls.progressPreview) {\r\n                    // Set background image and make visible\r\n                    this.controls.progressPreview.style.backgroundImage = `url(\"${thumbnail}\")`;\r\n                    this.controls.progressPreview.style.display = 'block';\r\n                    this.controls.progressPreview.style.backgroundRepeat = 'no-repeat';\r\n                    this.controls.progressPreview.style.backgroundPosition = 'center';\r\n                } else {\r\n                    // Hide if thumbnail generation failed\r\n                    if (this.controls.progressPreview) {\r\n                        this.controls.progressPreview.style.display = 'none';\r\n                    }\r\n                }\r\n                this.currentPreviewTime = time;\r\n            } catch (error) {\r\n                this.player.log('Preview thumbnail update failed:', error, 'warn');\r\n                if (this.controls.progressPreview) {\r\n                    this.controls.progressPreview.style.display = 'none';\r\n                }\r\n            }\r\n        }, 100);\r\n    }\r\n\r\n    setupProgressBarEvents() {\r\n        const progress = this.controls.progress;\r\n\r\n        const updateProgress = (clientX) => {\r\n            const rect = progress.getBoundingClientRect();\r\n            // Guard against division by zero if progress bar has no width\r\n            const percent = rect.width > 0 ? Math.max(0, Math.min(1, (clientX - rect.left) / rect.width)) : 0;\r\n            const duration = this.player.state.duration || 0;\r\n            const time = percent * duration;\r\n            return {percent, time};\r\n        };\r\n\r\n        // Mouse events\r\n        progress.addEventListener('mousedown', (e) => {\r\n            this.isDraggingProgress = true;\r\n            const {time} = updateProgress(e.clientX);\r\n            this.player.seek(time);\r\n        });\r\n\r\n        document.addEventListener('mousemove', (e) => {\r\n            if (this.isDraggingProgress) {\r\n                const {time} = updateProgress(e.clientX);\r\n                this.player.seek(time);\r\n            }\r\n        });\r\n\r\n        document.addEventListener('mouseup', () => {\r\n            this.isDraggingProgress = false;\r\n        });\r\n\r\n        // Hover tooltip\r\n        progress.addEventListener('mousemove', (e) => {\r\n            if (!this.isDraggingProgress) {\r\n                const {time} = updateProgress(e.clientX);\r\n                const rect = progress.getBoundingClientRect();\r\n                const left = e.clientX - rect.left;\r\n                \r\n                // Update tooltip time text\r\n                this.controls.progressTooltipTime.textContent = TimeUtils.formatTime(time);\r\n                \r\n                // Update tooltip position\r\n                this.controls.progressTooltip.style.left = `${left}px`;\r\n                this.controls.progressTooltip.style.display = 'block';\r\n\r\n                // Only show preview thumbnails after the user has started playback at least once.\r\n                // Before that, show just the timestamp (no empty preview box).\r\n                if (!this.player?.state?.hasStartedPlayback) {\r\n                    if (this.controls.progressPreview) {\r\n                        this.controls.progressPreview.style.display = 'none';\r\n                    }\r\n                    return;\r\n                }\r\n\r\n                this.ensurePreviewVideoInitialized();\r\n                if (this.previewSupported) {\r\n                    this.updatePreviewThumbnail(time);\r\n                } else if (this.controls.progressPreview) {\r\n                    this.controls.progressPreview.style.display = 'none';\r\n                }\r\n            }\r\n        });\r\n\r\n        progress.addEventListener('mouseleave', () => {\r\n            this.controls.progressTooltip.style.display = 'none';\r\n            if (this.previewThumbnailTimeout) {\r\n                clearTimeout(this.previewThumbnailTimeout);\r\n            }\r\n        });\r\n\r\n        // Keyboard navigation\r\n        progress.addEventListener('keydown', (e) => {\r\n            if (e.key === 'ArrowLeft') {\r\n                e.preventDefault();\r\n                this.player.seekBackward(5);\r\n            } else if (e.key === 'ArrowRight') {\r\n                e.preventDefault();\r\n                this.player.seekForward(5);\r\n            }\r\n        });\r\n\r\n        // Touch events\r\n        progress.addEventListener('touchstart', (e) => {\r\n            this.isDraggingProgress = true;\r\n            const touch = e.touches[0];\r\n            const {time} = updateProgress(touch.clientX);\r\n            this.player.seek(time);\r\n        });\r\n\r\n        progress.addEventListener('touchmove', (e) => {\r\n            if (this.isDraggingProgress) {\r\n                e.preventDefault();\r\n                const touch = e.touches[0];\r\n                const {time} = updateProgress(touch.clientX);\r\n                this.player.seek(time);\r\n            }\r\n        });\r\n\r\n        progress.addEventListener('touchend', () => {\r\n            this.isDraggingProgress = false;\r\n        });\r\n    }\r\n\r\n    createPlayPauseButton() {\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-play-pause`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.play')\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('play'));\r\n\r\n        button.addEventListener('click', () => {\r\n            this.player.toggle();\r\n        });\r\n\r\n        this.controls.playPause = button;\r\n        return button;\r\n    }\r\n\r\n    createRestartButton() {\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-restart`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.restart')\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('restart'));\r\n\r\n        button.addEventListener('click', () => {\r\n            this.player.seek(0);\r\n            this.player.play();\r\n        });\r\n\r\n        return button;\r\n    }\r\n\r\n    createPreviousButton() {\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-previous`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.previous')\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('skipPrevious'));\r\n\r\n        button.addEventListener('click', () => {\r\n            if (this.player.playlistManager) {\r\n                this.player.playlistManager.previous();\r\n            }\r\n        });\r\n\r\n        // Update button state\r\n        const updateState = () => {\r\n            if (this.player.playlistManager) {\r\n                button.disabled = !this.player.playlistManager.hasPrevious() && !this.player.playlistManager.options.loop;\r\n            }\r\n        };\r\n        this.player.on('playlisttrackchange', updateState);\r\n        updateState();\r\n\r\n        this.controls.previous = button;\r\n        return button;\r\n    }\r\n\r\n    createNextButton() {\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-next`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.next')\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('skipNext'));\r\n\r\n        button.addEventListener('click', () => {\r\n            if (this.player.playlistManager) {\r\n                this.player.playlistManager.next();\r\n            }\r\n        });\r\n\r\n        // Update button state\r\n        const updateState = () => {\r\n            if (this.player.playlistManager) {\r\n                button.disabled = !this.player.playlistManager.hasNext() && !this.player.playlistManager.options.loop;\r\n            }\r\n        };\r\n        this.player.on('playlisttrackchange', updateState);\r\n        updateState();\r\n\r\n        this.controls.next = button;\r\n        return button;\r\n    }\r\n\r\n    createPlaylistToggleButton() {\r\n        // Get unique panel ID from playlist manager\r\n        const panelId = this.player.playlistManager ? `${this.player.playlistManager.uniqueId}-panel` : 'vidply-playlist-panel';\r\n        \r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-playlist-toggle`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.playlist'),\r\n                'aria-expanded': 'false',\r\n                'aria-pressed': 'false',\r\n                'aria-controls': panelId\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('playlist'));\r\n\r\n        button.addEventListener('click', () => {\r\n            if (this.player.playlistManager) {\r\n                this.player.playlistManager.togglePanel();\r\n            }\r\n        });\r\n\r\n        this.controls.playlistToggle = button;\r\n        return button;\r\n    }\r\n\r\n    createRewindButton() {\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-rewind`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.rewindSeconds', { seconds: 15 })\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('rewind'));\r\n\r\n        button.addEventListener('click', () => {\r\n            this.player.seekBackward(15);\r\n        });\r\n\r\n        return button;\r\n    }\r\n\r\n    createForwardButton() {\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-forward`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.forwardSeconds', { seconds: 15 })\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('forward'));\r\n\r\n        button.addEventListener('click', () => {\r\n            this.player.seekForward(15);\r\n        });\r\n\r\n        return button;\r\n    }\r\n\r\n    createMuteButton() {\r\n        // Simple mute/unmute button for touch devices\r\n        const muteButton = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-mute`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.mute')\r\n            }\r\n        });\r\n\r\n        muteButton.appendChild(createIconElement('volumeHigh'));\r\n\r\n        // Simply toggle mute on click/touch\r\n        muteButton.addEventListener('click', () => {\r\n            this.player.toggleMute();\r\n        });\r\n\r\n        this.controls.mute = muteButton;\r\n\r\n        return muteButton;\r\n    }\r\n\r\n    createVolumeControl() {\r\n        // Mute/Volume button with slider (desktop)\r\n        const muteButton = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-mute`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.volume'),\r\n                'aria-expanded': 'false'\r\n            }\r\n        });\r\n\r\n        muteButton.appendChild(createIconElement('volumeHigh'));\r\n\r\n        // Toggle mute on right click, show volume slider on left click\r\n        muteButton.addEventListener('contextmenu', (e) => {\r\n            e.preventDefault();\r\n            this.player.toggleMute();\r\n        });\r\n\r\n        muteButton.addEventListener('click', () => {\r\n            this.showVolumeSlider(muteButton);\r\n        });\r\n\r\n        this.controls.mute = muteButton;\r\n\r\n        return muteButton;\r\n    }\r\n\r\n    showVolumeSlider(button) {\r\n        // Remove existing slider if any\r\n        const existingSlider = document.querySelector(`.${this.player.options.classPrefix}-volume-menu`);\r\n        if (existingSlider) {\r\n            existingSlider.remove();\r\n            button.setAttribute('aria-expanded', 'false');\r\n            return;\r\n        }\r\n\r\n        // Volume menu container\r\n        const volumeMenu = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-volume-menu ${this.player.options.classPrefix}-menu`\r\n        });\r\n\r\n        const volumeSlider = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-volume-slider`,\r\n            attributes: {\r\n                'role': 'slider',\r\n                'aria-label': i18n.t('player.volume'),\r\n                'aria-valuemin': '0',\r\n                'aria-valuemax': '100',\r\n                'aria-valuenow': String(Math.round(this.player.state.volume * 100)),\r\n                'tabindex': '0'\r\n            }\r\n        });\r\n\r\n        const volumeTrack = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-volume-track`\r\n        });\r\n\r\n        const volumeFill = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-volume-fill`\r\n        });\r\n        \r\n        // Set initial fill height based on current volume\r\n        const initialVolumePercent = this.player.state.volume * 100;\r\n        volumeFill.style.height = `${initialVolumePercent}%`;\r\n\r\n        const volumeHandle = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-volume-handle`\r\n        });\r\n\r\n        volumeTrack.appendChild(volumeFill);\r\n        volumeFill.appendChild(volumeHandle);\r\n        volumeSlider.appendChild(volumeTrack);\r\n        volumeMenu.appendChild(volumeSlider);\r\n\r\n        // Volume slider events\r\n        const updateVolume = (clientY) => {\r\n            const rect = volumeTrack.getBoundingClientRect();\r\n            const percent = Math.max(0, Math.min(1, 1 - ((clientY - rect.top) / rect.height)));\r\n            this.player.setVolume(percent);\r\n        };\r\n\r\n        // Mouse events\r\n        volumeSlider.addEventListener('mousedown', (e) => {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            this.isDraggingVolume = true;\r\n            updateVolume(e.clientY);\r\n        });\r\n\r\n        document.addEventListener('mousemove', (e) => {\r\n            if (this.isDraggingVolume) {\r\n                updateVolume(e.clientY);\r\n            }\r\n        });\r\n\r\n        document.addEventListener('mouseup', () => {\r\n            this.isDraggingVolume = false;\r\n        });\r\n\r\n        // Touch events for iOS and mobile devices\r\n        volumeSlider.addEventListener('touchstart', (e) => {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            this.isDraggingVolume = true;\r\n            const touch = e.touches[0];\r\n            updateVolume(touch.clientY);\r\n        }, { passive: false });\r\n\r\n        volumeSlider.addEventListener('touchmove', (e) => {\r\n            if (this.isDraggingVolume) {\r\n                e.preventDefault();\r\n                const touch = e.touches[0];\r\n                updateVolume(touch.clientY);\r\n            }\r\n        }, { passive: false });\r\n\r\n        volumeSlider.addEventListener('touchend', (e) => {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            this.isDraggingVolume = false;\r\n        }, { passive: false });\r\n\r\n        volumeSlider.addEventListener('touchcancel', () => {\r\n            this.isDraggingVolume = false;\r\n        });\r\n\r\n        // Keyboard volume control\r\n        volumeSlider.addEventListener('keydown', (e) => {\r\n            if (e.key === 'ArrowUp') {\r\n                e.preventDefault();\r\n                this.player.setVolume(Math.min(1, this.player.state.volume + 0.1));\r\n            } else if (e.key === 'ArrowDown') {\r\n                e.preventDefault();\r\n                this.player.setVolume(Math.max(0, this.player.state.volume - 0.1));\r\n            } else if (e.key === 'Escape') {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                // Close menu and return focus to button\r\n                this.closeMenuAndReturnFocus(volumeMenu, button, true);\r\n            }\r\n        });\r\n\r\n        // Prevent menu from closing when interacting with slider\r\n        volumeMenu.addEventListener('click', (e) => {\r\n            e.stopPropagation();\r\n        });\r\n        \r\n        // Prevent menu from closing on touch events\r\n        volumeMenu.addEventListener('touchstart', (e) => {\r\n            e.stopPropagation();\r\n        });\r\n        \r\n        volumeMenu.addEventListener('touchmove', (e) => {\r\n            e.stopPropagation();\r\n        });\r\n        \r\n        volumeMenu.addEventListener('touchend', (e) => {\r\n            e.stopPropagation();\r\n        });\r\n\r\n        // Position menu first (before it's visible) to prevent jumping\r\n        volumeMenu.style.visibility = 'hidden';\r\n        volumeMenu.style.display = 'block';\r\n        \r\n        // Insert menu into DOM (handles fullscreen positioning)\r\n        this.insertMenuIntoDOM(volumeMenu, button);\r\n        \r\n        // Position immediately (synchronously) while hidden\r\n        this.positionMenu(volumeMenu, button, true);\r\n        \r\n        // Make menu visible after positioning\r\n        requestAnimationFrame(() => {\r\n            volumeMenu.style.visibility = 'visible';\r\n        });\r\n\r\n        this.controls.volumeSlider = volumeSlider;\r\n        this.controls.volumeFill = volumeFill;\r\n\r\n        // Focus the volume slider for keyboard accessibility\r\n        focusElement(volumeSlider, { delay: 50 });\r\n\r\n        // Close menu on outside click\r\n        this.attachMenuCloseHandler(volumeMenu, button, true);\r\n    }\r\n\r\n    createTimeDisplay() {\r\n        const container = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-time`,\r\n            attributes: {\r\n                'role': 'group',\r\n                'aria-label': i18n.t('time.display')\r\n            }\r\n        });\r\n\r\n        // Current time - visual text hidden, accessible text provided via sr-only span\r\n        this.controls.currentTimeDisplay = DOMUtils.createElement('span', {\r\n            className: `${this.player.options.classPrefix}-current-time`\r\n        });\r\n        \r\n        // Create visual text inside, hidden from screen readers\r\n        const currentTimeVisual = DOMUtils.createElement('span', {\r\n            textContent: '00:00',\r\n            attributes: {\r\n                'aria-hidden': 'true'\r\n            }\r\n        });\r\n        const currentTimeAccessible = DOMUtils.createElement('span', {\r\n            className: 'vidply-sr-only',\r\n            textContent: i18n.t('time.seconds', { count: 0 })\r\n        });\r\n\r\n        this.controls.currentTimeDisplay.appendChild(currentTimeVisual);\r\n        this.controls.currentTimeDisplay.appendChild(currentTimeAccessible);\r\n        this.controls.currentTimeVisual = currentTimeVisual;\r\n        this.controls.currentTimeAccessible = currentTimeAccessible;\r\n\r\n        const separator = DOMUtils.createElement('span', {\r\n            textContent: ' / ',\r\n            attributes: {\r\n                'aria-hidden': 'true'\r\n            }\r\n        });\r\n\r\n        // Duration - visual text hidden, accessible text provided via sr-only span\r\n        this.controls.durationDisplay = DOMUtils.createElement('span', {\r\n            className: `${this.player.options.classPrefix}-duration`\r\n        });\r\n        \r\n        // Create visual text inside, hidden from screen readers\r\n        const durationVisual = DOMUtils.createElement('span', {\r\n            textContent: '00:00',\r\n            attributes: {\r\n                'aria-hidden': 'true'\r\n            }\r\n        });\r\n        const durationAccessible = DOMUtils.createElement('span', {\r\n            className: 'vidply-sr-only',\r\n            textContent: i18n.t('time.durationPrefix') + i18n.t('time.seconds', { count: 0 })\r\n        });\r\n\r\n        this.controls.durationDisplay.appendChild(durationVisual);\r\n        this.controls.durationDisplay.appendChild(durationAccessible);\r\n        this.controls.durationVisual = durationVisual;\r\n        this.controls.durationAccessible = durationAccessible;\r\n\r\n        container.appendChild(this.controls.currentTimeDisplay);\r\n        container.appendChild(separator);\r\n        container.appendChild(this.controls.durationDisplay);\r\n\r\n        return container;\r\n    }\r\n\r\n    createChaptersButton() {\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-chapters`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.chapters'),\r\n                'aria-expanded': 'false'\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('chapters'));\r\n\r\n        button.addEventListener('click', () => {\r\n            this.showChaptersMenu(button);\r\n        });\r\n\r\n        this.controls.chapters = button;\r\n        return button;\r\n    }\r\n\r\n    showChaptersMenu(button) {\r\n        // Remove existing menu if any (toggle behavior)\r\n        const existingMenu = document.querySelector(`.${this.player.options.classPrefix}-chapters-menu`);\r\n        if (existingMenu) {\r\n            existingMenu.remove();\r\n            button.setAttribute('aria-expanded', 'false');\r\n            // Clear tracking if this was the open menu\r\n            if (this.openMenu === existingMenu) {\r\n                this.openMenu = null;\r\n                this.openMenuButton = null;\r\n            }\r\n            return;\r\n        }\r\n\r\n        const menu = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-chapters-menu ${this.player.options.classPrefix}-menu`,\r\n            attributes: {\r\n                'role': 'menu',\r\n                'aria-label': i18n.t('player.chapters')\r\n            }\r\n        });\r\n\r\n        // Get chapter tracks\r\n        const chapterTracks = Array.from(this.player.element.textTracks).filter(\r\n            track => track.kind === 'chapters'\r\n        );\r\n\r\n        if (chapterTracks.length === 0) {\r\n            // No chapters available\r\n            const noChaptersItem = DOMUtils.createElement('div', {\r\n                className: `${this.player.options.classPrefix}-menu-item`,\r\n                textContent: i18n.t('player.noChapters'),\r\n                attributes: {\r\n                    'role': 'menuitem'\r\n                },\r\n                style: {opacity: '0.5', cursor: 'default'}\r\n            });\r\n            menu.appendChild(noChaptersItem);\r\n        } else {\r\n            const chapterTrack = chapterTracks[0];\r\n\r\n            // Ensure track is in 'hidden' mode to load cues\r\n            if (chapterTrack.mode === 'disabled') {\r\n                chapterTrack.mode = 'hidden';\r\n            }\r\n\r\n            if (!chapterTrack.cues || chapterTrack.cues.length === 0) {\r\n                // Cues not loaded yet - wait for them to load\r\n                const loadingItem = DOMUtils.createElement('div', {\r\n                    className: `${this.player.options.classPrefix}-menu-item`,\r\n                    textContent: i18n.t('player.loadingChapters'),\r\n                    attributes: {\r\n                        'role': 'menuitem'\r\n                    },\r\n                    style: {opacity: '0.5', cursor: 'default'}\r\n                });\r\n                menu.appendChild(loadingItem);\r\n\r\n                // Listen for track load event\r\n                const onTrackLoad = () => {\r\n                    // Remove loading message and rebuild menu\r\n                    menu.remove();\r\n                    this.showChaptersMenu(button);\r\n                };\r\n\r\n                chapterTrack.addEventListener('load', onTrackLoad, {once: true});\r\n\r\n                // Also try again after a short delay as fallback\r\n                setTimeout(() => {\r\n                    if (chapterTrack.cues && chapterTrack.cues.length > 0 && document.contains(menu)) {\r\n                        menu.remove();\r\n                        this.showChaptersMenu(button);\r\n                    }\r\n                }, 500);\r\n            } else {\r\n                // Display chapters\r\n                const cues = chapterTrack.cues;\r\n                for (let i = 0; i < cues.length; i++) {\r\n                    const cue = cues[i];\r\n                    const item = DOMUtils.createElement('button', {\r\n                        className: `${this.player.options.classPrefix}-menu-item`,\r\n                        attributes: {\r\n                            'type': 'button',\r\n                            'role': 'menuitem',\r\n                            'tabindex': '-1'\r\n                        }\r\n                    });\r\n\r\n                    const timeLabel = DOMUtils.createElement('span', {\r\n                        className: `${this.player.options.classPrefix}-chapter-time`,\r\n                        textContent: TimeUtils.formatTime(cue.startTime),\r\n                        attributes: {\r\n                            'aria-label': TimeUtils.formatDuration(cue.startTime)\r\n                        }\r\n                    });\r\n\r\n                    const titleLabel = DOMUtils.createElement('span', {\r\n                        className: `${this.player.options.classPrefix}-chapter-title`,\r\n                        textContent: cue.text\r\n                    });\r\n\r\n                    item.appendChild(timeLabel);\r\n                    item.appendChild(document.createTextNode(' '));\r\n                    item.appendChild(titleLabel);\r\n\r\n                    item.addEventListener('click', () => {\r\n                        this.player.seek(cue.startTime);\r\n                        this.closeMenuAndReturnFocus(menu, button);\r\n                    });\r\n\r\n                    menu.appendChild(item);\r\n                }\r\n                \r\n                // Add keyboard navigation\r\n                this.attachMenuKeyboardNavigation(menu, button);\r\n                \r\n                // Focus first item\r\n                setTimeout(() => {\r\n                    const firstItem = menu.querySelector(`.${this.player.options.classPrefix}-menu-item`);\r\n                    if (firstItem) {\r\n                        firstItem.focus({ preventScroll: true });\r\n                    }\r\n                }, 0);\r\n            }\r\n        }\r\n\r\n        // Position menu first (before it's visible) to prevent jumping\r\n        // Set menu to invisible temporarily\r\n        menu.style.visibility = 'hidden';\r\n        menu.style.display = 'block';\r\n        \r\n        // Insert menu into DOM (handles fullscreen positioning)\r\n        this.insertMenuIntoDOM(menu, button);\r\n        \r\n        // Position immediately (synchronously) while hidden\r\n        this.positionMenu(menu, button, true);\r\n        \r\n        // Make menu visible after positioning\r\n        requestAnimationFrame(() => {\r\n            menu.style.visibility = 'visible';\r\n        });\r\n\r\n        // Close menu on outside click\r\n        this.attachMenuCloseHandler(menu, button);\r\n    }\r\n\r\n    createQualityButton() {\r\n        const ariaLabel = i18n.t('player.quality');\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-quality`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': ariaLabel,\r\n                'aria-expanded': 'false'\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('hd'));\r\n        DOMUtils.attachTooltip(button, ariaLabel, this.player.options.classPrefix);\r\n\r\n        // Add quality indicator text\r\n        const qualityText = DOMUtils.createElement('span', {\r\n            className: `${this.player.options.classPrefix}-quality-text`,\r\n            textContent: ''\r\n        });\r\n        button.appendChild(qualityText);\r\n\r\n        button.addEventListener('click', () => {\r\n            this.showQualityMenu(button);\r\n        });\r\n\r\n        this.controls.quality = button;\r\n        this.controls.qualityText = qualityText;\r\n        \r\n        // Update quality indicator after a short delay to ensure renderer is ready\r\n        setTimeout(() => this.updateQualityIndicator(), 500);\r\n        \r\n        return button;\r\n    }\r\n\r\n    showQualityMenu(button) {\r\n        // Remove existing menu if any (toggle behavior)\r\n        const existingMenu = document.querySelector(`.${this.player.options.classPrefix}-quality-menu`);\r\n        if (existingMenu) {\r\n            existingMenu.remove();\r\n            button.setAttribute('aria-expanded', 'false');\r\n            // Clear tracking if this was the open menu\r\n            if (this.openMenu === existingMenu) {\r\n                this.openMenu = null;\r\n                this.openMenuButton = null;\r\n            }\r\n            return;\r\n        }\r\n\r\n        const menu = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-quality-menu ${this.player.options.classPrefix}-menu`,\r\n            attributes: {\r\n                'role': 'menu',\r\n                'aria-label': i18n.t('player.quality')\r\n            }\r\n        });\r\n\r\n        // Check if renderer supports quality selection\r\n        if (this.player.renderer && this.player.renderer.getQualities) {\r\n            const qualities = this.player.renderer.getQualities();\r\n            const currentQuality = this.player.renderer.getCurrentQuality ? this.player.renderer.getCurrentQuality() : -1;\r\n            const isHLS = this.player.renderer.hls !== undefined;\r\n\r\n            if (qualities.length === 0) {\r\n                // No qualities available\r\n                const noQualityItem = DOMUtils.createElement('div', {\r\n                    className: `${this.player.options.classPrefix}-menu-item`,\r\n                    textContent: i18n.t('player.autoQuality'),\r\n                    attributes: {\r\n                        'role': 'menuitem'\r\n                    },\r\n                    style: {opacity: '0.5', cursor: 'default'}\r\n                });\r\n                menu.appendChild(noQualityItem);\r\n            } else {\r\n                let activeItem = null;\r\n                \r\n                // Auto quality option (only for HLS)\r\n                if (isHLS) {\r\n                    const autoItem = DOMUtils.createElement('button', {\r\n                        className: `${this.player.options.classPrefix}-menu-item`,\r\n                        textContent: i18n.t('player.auto'),\r\n                        attributes: {\r\n                            'type': 'button',\r\n                            'role': 'menuitem',\r\n                            'tabindex': '-1'\r\n                        }\r\n                    });\r\n\r\n                    // Check if auto is currently selected\r\n                    const isAuto = this.player.renderer.hls && this.player.renderer.hls.currentLevel === -1;\r\n                    if (isAuto) {\r\n                        autoItem.classList.add(`${this.player.options.classPrefix}-menu-item-active`);\r\n                        autoItem.appendChild(createIconElement('check'));\r\n                        activeItem = autoItem;\r\n                    }\r\n\r\n                    autoItem.addEventListener('click', () => {\r\n                        if (this.player.renderer.switchQuality) {\r\n                            this.player.renderer.switchQuality(-1); // -1 for auto\r\n                        }\r\n                        this.closeMenuAndReturnFocus(menu, button);\r\n                    });\r\n\r\n                    menu.appendChild(autoItem);\r\n                }\r\n\r\n                // Quality options\r\n                qualities.forEach(quality => {\r\n                    const item = DOMUtils.createElement('button', {\r\n                        className: `${this.player.options.classPrefix}-menu-item`,\r\n                        textContent: quality.name || `${quality.height}p`,\r\n                        attributes: {\r\n                            'type': 'button',\r\n                            'role': 'menuitem',\r\n                            'tabindex': '-1'\r\n                        }\r\n                    });\r\n\r\n                    // Highlight current quality\r\n                    if (quality.index === currentQuality) {\r\n                        item.classList.add(`${this.player.options.classPrefix}-menu-item-active`);\r\n                        item.appendChild(createIconElement('check'));\r\n                        activeItem = item;\r\n                    }\r\n\r\n                    item.addEventListener('click', () => {\r\n                        if (this.player.renderer.switchQuality) {\r\n                            this.player.renderer.switchQuality(quality.index);\r\n                        }\r\n                        this.closeMenuAndReturnFocus(menu, button);\r\n                    });\r\n\r\n                    menu.appendChild(item);\r\n                });\r\n                \r\n                // Add keyboard navigation\r\n                this.attachMenuKeyboardNavigation(menu, button);\r\n                \r\n                // Focus active item or first item\r\n                setTimeout(() => {\r\n                    const focusTarget = activeItem || menu.querySelector(`.${this.player.options.classPrefix}-menu-item`);\r\n                    if (focusTarget) {\r\n                        focusTarget.focus({ preventScroll: true });\r\n                    }\r\n                }, 0);\r\n            }\r\n        } else {\r\n            // No quality support\r\n            const noSupportItem = DOMUtils.createElement('div', {\r\n                className: `${this.player.options.classPrefix}-menu-item`,\r\n                textContent: i18n.t('player.noQuality'),\r\n                style: {opacity: '0.5', cursor: 'default'}\r\n            });\r\n            menu.appendChild(noSupportItem);\r\n        }\r\n\r\n        // Position menu first (before it's visible) to prevent jumping\r\n        // Set menu to invisible temporarily\r\n        menu.style.visibility = 'hidden';\r\n        menu.style.display = 'block';\r\n        \r\n        // Insert menu into DOM (handles fullscreen positioning)\r\n        this.insertMenuIntoDOM(menu, button);\r\n        \r\n        // Position immediately (synchronously) while hidden\r\n        this.positionMenu(menu, button, true);\r\n        \r\n        // Make menu visible after positioning\r\n        requestAnimationFrame(() => {\r\n            menu.style.visibility = 'visible';\r\n        });\r\n\r\n        // Close menu on outside click\r\n        this.attachMenuCloseHandler(menu, button);\r\n    }\r\n\r\n    createCaptionStyleButton() {\r\n        const ariaLabel = i18n.t('player.captionStyling');\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-caption-style`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': ariaLabel,\r\n                'aria-expanded': 'false'\r\n            }\r\n        });\r\n\r\n        // Create \"Aa\" text icon for styling\r\n        const textIcon = DOMUtils.createElement('span', {\r\n            textContent: 'Aa',\r\n            style: {\r\n                fontSize: '14px',\r\n                fontWeight: 'bold'\r\n            }\r\n        });\r\n        button.appendChild(textIcon);\r\n        DOMUtils.attachTooltip(button, ariaLabel, this.player.options.classPrefix);\r\n\r\n        button.addEventListener('click', () => {\r\n            this.showCaptionStyleMenu(button);\r\n        });\r\n\r\n        this.controls.captionStyle = button;\r\n        return button;\r\n    }\r\n\r\n    showCaptionStyleMenu(button) {\r\n        // Remove existing menu if any (toggle behavior)\r\n        const existingMenu = document.querySelector(`.${this.player.options.classPrefix}-caption-style-menu`);\r\n        if (existingMenu) {\r\n            existingMenu.remove();\r\n            button.setAttribute('aria-expanded', 'false');\r\n            // Clear tracking if this was the open menu\r\n            if (this.openMenu === existingMenu) {\r\n                this.openMenu = null;\r\n                this.openMenuButton = null;\r\n            }\r\n            return;\r\n        }\r\n\r\n        const menu = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-caption-style-menu ${this.player.options.classPrefix}-menu ${this.player.options.classPrefix}-settings-menu`,\r\n            attributes: {\r\n                'role': 'menu',\r\n                'aria-label': i18n.t('player.captionStyling')\r\n            }\r\n        });\r\n\r\n        // Prevent menu from closing when clicking inside\r\n        menu.addEventListener('click', (e) => {\r\n            e.stopPropagation();\r\n        });\r\n\r\n        // Check if there are any caption tracks\r\n        if (!this.player.captionManager || this.player.captionManager.tracks.length === 0) {\r\n            // Show \"No captions available\" message\r\n            const noTracksItem = DOMUtils.createElement('div', {\r\n                className: `${this.player.options.classPrefix}-menu-item`,\r\n                textContent: i18n.t('player.noCaptions'),\r\n                attributes: {\r\n                    'role': 'menuitem'\r\n                },\r\n                style: {opacity: '0.5', cursor: 'default', padding: '12px 16px'}\r\n            });\r\n            menu.appendChild(noTracksItem);\r\n\r\n            // Position menu first (before it's visible) to prevent jumping\r\n            // Set menu to invisible temporarily\r\n            menu.style.visibility = 'hidden';\r\n            menu.style.display = 'block';\r\n            \r\n            // Insert menu into DOM (handles fullscreen positioning)\r\n            this.insertMenuIntoDOM(menu, button);\r\n            \r\n            // Position immediately (synchronously) while hidden\r\n            this.positionMenu(menu, button, true);\r\n            \r\n            // Make menu visible after positioning\r\n            requestAnimationFrame(() => {\r\n                menu.style.visibility = 'visible';\r\n            });\r\n\r\n            // Close menu on outside click\r\n            this.attachMenuCloseHandler(menu, button, true);\r\n            return;\r\n        }\r\n\r\n        // Font Size\r\n        const fontSizeGroup = this.createStyleControl(\r\n            i18n.t('styleLabels.fontSize'),\r\n            'captionsFontSize',\r\n            [\r\n                {label: i18n.t('fontSizes.small'), value: '87.5%'},\r\n                {label: i18n.t('fontSizes.normal'), value: '100%'},\r\n                {label: i18n.t('fontSizes.large'), value: '125%'},\r\n                {label: i18n.t('fontSizes.xlarge'), value: '150%'}\r\n            ]\r\n        );\r\n        menu.appendChild(fontSizeGroup);\r\n\r\n        // Font Family\r\n        const fontFamilyGroup = this.createStyleControl(\r\n            i18n.t('styleLabels.font'),\r\n            'captionsFontFamily',\r\n            [\r\n                {label: i18n.t('fontFamilies.sansSerif'), value: 'sans-serif'},\r\n                {label: i18n.t('fontFamilies.serif'), value: 'serif'},\r\n                {label: i18n.t('fontFamilies.monospace'), value: 'monospace'}\r\n            ]\r\n        );\r\n        menu.appendChild(fontFamilyGroup);\r\n\r\n        // Text Color\r\n        const colorGroup = this.createColorControl(i18n.t('styleLabels.textColor'), 'captionsColor');\r\n        menu.appendChild(colorGroup);\r\n\r\n        // Background Color\r\n        const bgColorGroup = this.createColorControl(i18n.t('styleLabels.background'), 'captionsBackgroundColor');\r\n        menu.appendChild(bgColorGroup);\r\n\r\n        // Opacity\r\n        const opacityGroup = this.createOpacityControl(i18n.t('styleLabels.opacity'), 'captionsOpacity');\r\n        menu.appendChild(opacityGroup);\r\n\r\n        // Set min-width for caption style menu\r\n        menu.style.minWidth = '220px';\r\n\r\n        // Position menu first (before it's visible) to prevent jumping\r\n        // Set menu to invisible temporarily\r\n        menu.style.visibility = 'hidden';\r\n        menu.style.display = 'block';\r\n        \r\n        // Insert menu into DOM (handles fullscreen positioning)\r\n        this.insertMenuIntoDOM(menu, button);\r\n        \r\n        // Position immediately (synchronously) while hidden\r\n        this.positionMenu(menu, button, true);\r\n        \r\n        // Make menu visible after positioning\r\n        requestAnimationFrame(() => {\r\n            menu.style.visibility = 'visible';\r\n        });\r\n\r\n        // Close menu on outside click (but not when interacting with controls)\r\n        this.attachMenuCloseHandler(menu, button, true);\r\n\r\n        // Auto-focus the first style select element\r\n        focusFirstElement(menu, `.${this.player.options.classPrefix}-style-select`);\r\n    }\r\n\r\n    createStyleControl(label, property, options) {\r\n        const group = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-style-group`\r\n        });\r\n\r\n        // Generate unique ID for the control\r\n        const controlId = `${this.player.options.classPrefix}-${property}-${Date.now()}`;\r\n\r\n        const labelEl = DOMUtils.createElement('label', {\r\n            textContent: label,\r\n            attributes: {\r\n                'for': controlId\r\n            },\r\n            style: {\r\n                display: 'block',\r\n                fontSize: '12px',\r\n                marginBottom: '4px',\r\n                color: 'rgba(255,255,255,0.7)'\r\n            }\r\n        });\r\n        group.appendChild(labelEl);\r\n\r\n        const select = DOMUtils.createElement('select', {\r\n            className: `${this.player.options.classPrefix}-style-select`,\r\n            attributes: {\r\n                'id': controlId\r\n            },\r\n            style: {\r\n                width: '100%',\r\n                padding: '6px',\r\n                background: 'var(--vidply-white)',\r\n                border: '1px solid var(--vidply-white-10)',\r\n                borderRadius: '4px',\r\n                color: 'var(--vidply-black)',\r\n                fontSize: '13px'\r\n            }\r\n        });\r\n\r\n        const currentValue = this.player.options[property];\r\n        options.forEach(opt => {\r\n            const option = DOMUtils.createElement('option', {\r\n                textContent: opt.label,\r\n                attributes: {value: opt.value}\r\n            });\r\n            if (opt.value === currentValue) {\r\n                option.selected = true;\r\n            }\r\n            select.appendChild(option);\r\n        });\r\n\r\n        // Prevent clicks from closing the menu\r\n        select.addEventListener('mousedown', (e) => {\r\n            e.stopPropagation();\r\n        });\r\n\r\n        select.addEventListener('click', (e) => {\r\n            e.stopPropagation();\r\n        });\r\n\r\n        select.addEventListener('change', (e) => {\r\n            e.stopPropagation();\r\n            this.player.options[property] = e.target.value;\r\n            if (this.player.captionManager) {\r\n                this.player.captionManager.setCaptionStyle(\r\n                    property.replace('captions', '').charAt(0).toLowerCase() + property.replace('captions', '').slice(1),\r\n                    e.target.value\r\n                );\r\n            }\r\n        });\r\n\r\n        group.appendChild(select);\r\n        return group;\r\n    }\r\n\r\n    createColorControl(label, property) {\r\n        const group = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-style-group`\r\n        });\r\n\r\n        // Generate unique ID for the control\r\n        const controlId = `${this.player.options.classPrefix}-${property}-${Date.now()}`;\r\n\r\n        const labelEl = DOMUtils.createElement('label', {\r\n            textContent: label,\r\n            attributes: {\r\n                'for': controlId\r\n            },\r\n            style: {\r\n                display: 'block',\r\n                fontSize: '12px',\r\n                marginBottom: '4px',\r\n                color: 'rgba(255,255,255,0.7)'\r\n            }\r\n        });\r\n        group.appendChild(labelEl);\r\n\r\n        const input = DOMUtils.createElement('input', {\r\n            attributes: {\r\n                'id': controlId,\r\n                type: 'color',\r\n                value: this.player.options[property]\r\n            },\r\n            style: {\r\n                width: '100%',\r\n                height: '32px',\r\n                padding: '2px',\r\n                background: 'rgba(255,255,255,0.1)',\r\n                border: '1px solid rgba(255,255,255,0.2)',\r\n                borderRadius: '4px',\r\n                cursor: 'pointer'\r\n            }\r\n        });\r\n\r\n        // Prevent clicks from closing the menu\r\n        input.addEventListener('mousedown', (e) => {\r\n            e.stopPropagation();\r\n        });\r\n\r\n        input.addEventListener('click', (e) => {\r\n            e.stopPropagation();\r\n        });\r\n\r\n        input.addEventListener('change', (e) => {\r\n            e.stopPropagation();\r\n            this.player.options[property] = e.target.value;\r\n            if (this.player.captionManager) {\r\n                this.player.captionManager.setCaptionStyle(\r\n                    property.replace('captions', '').charAt(0).toLowerCase() + property.replace('captions', '').slice(1),\r\n                    e.target.value\r\n                );\r\n            }\r\n        });\r\n\r\n        group.appendChild(input);\r\n        return group;\r\n    }\r\n\r\n    createOpacityControl(label, property) {\r\n        const group = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-style-group`\r\n        });\r\n\r\n        // Generate unique ID for the control\r\n        const controlId = `${this.player.options.classPrefix}-${property}-${Date.now()}`;\r\n\r\n        const labelContainer = DOMUtils.createElement('div', {\r\n            style: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                marginBottom: '4px'\r\n            }\r\n        });\r\n\r\n        const labelEl = DOMUtils.createElement('label', {\r\n            textContent: label,\r\n            attributes: {\r\n                'for': controlId\r\n            },\r\n            style: {\r\n                fontSize: '12px',\r\n                color: 'rgba(255,255,255,0.7)'\r\n            }\r\n        });\r\n\r\n        const valueEl = DOMUtils.createElement('span', {\r\n            textContent: Math.round(this.player.options[property] * 100) + '%',\r\n            style: {\r\n                fontSize: '12px',\r\n                color: 'rgba(255,255,255,0.7)'\r\n            }\r\n        });\r\n\r\n        labelContainer.appendChild(labelEl);\r\n        labelContainer.appendChild(valueEl);\r\n        group.appendChild(labelContainer);\r\n\r\n        const input = DOMUtils.createElement('input', {\r\n            attributes: {\r\n                'id': controlId,\r\n                type: 'range',\r\n                min: '0',\r\n                max: '1',\r\n                step: '0.1',\r\n                value: String(this.player.options[property])\r\n            },\r\n            style: {\r\n                width: '100%',\r\n                cursor: 'pointer'\r\n            }\r\n        });\r\n\r\n        // Prevent clicks from closing the menu\r\n        input.addEventListener('mousedown', (e) => {\r\n            e.stopPropagation();\r\n        });\r\n\r\n        input.addEventListener('click', (e) => {\r\n            e.stopPropagation();\r\n        });\r\n\r\n        input.addEventListener('input', (e) => {\r\n            e.stopPropagation();\r\n            const value = parseFloat(e.target.value);\r\n            valueEl.textContent = Math.round(value * 100) + '%';\r\n            this.player.options[property] = value;\r\n            if (this.player.captionManager) {\r\n                this.player.captionManager.setCaptionStyle(\r\n                    property.replace('captions', '').charAt(0).toLowerCase() + property.replace('captions', '').slice(1),\r\n                    value\r\n                );\r\n            }\r\n        });\r\n\r\n        group.appendChild(input);\r\n        return group;\r\n    }\r\n\r\n    createSpeedButton() {\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-speed`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.speed'),\r\n                'aria-expanded': 'false'\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('speed'));\r\n\r\n        const speedText = DOMUtils.createElement('span', {\r\n            className: `${this.player.options.classPrefix}-speed-text`,\r\n            textContent: '1x'\r\n        });\r\n        button.appendChild(speedText);\r\n\r\n        button.addEventListener('click', () => {\r\n            this.showSpeedMenu(button);\r\n        });\r\n\r\n        this.controls.speed = button;\r\n        this.controls.speedText = speedText;\r\n        return button;\r\n    }\r\n\r\n    formatSpeedLabel(speed) {\r\n        // Special case: 1x is \"Normal\" (translated)\r\n        if (speed === 1) {\r\n            return i18n.t('speeds.normal');\r\n        }\r\n        \r\n        // For other speeds, format with locale-specific decimal separator\r\n        const speedStr = speed.toLocaleString(i18n.getLanguage(), {\r\n            minimumFractionDigits: 0,\r\n            maximumFractionDigits: 2\r\n        });\r\n        \r\n        return `${speedStr}`;\r\n    }\r\n\r\n    showSpeedMenu(button) {\r\n        // Remove existing menu if any (toggle behavior)\r\n        const existingMenu = document.querySelector(`.${this.player.options.classPrefix}-speed-menu`);\r\n        if (existingMenu) {\r\n            existingMenu.remove();\r\n            button.setAttribute('aria-expanded', 'false');\r\n            // Clear tracking if this was the open menu\r\n            if (this.openMenu === existingMenu) {\r\n                this.openMenu = null;\r\n                this.openMenuButton = null;\r\n            }\r\n            return;\r\n        }\r\n\r\n        const menu = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-speed-menu ${this.player.options.classPrefix}-menu`,\r\n            attributes: {\r\n                'role': 'menu'\r\n            }\r\n        });\r\n\r\n        const speeds = [0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2];\r\n        let activeItem = null;\r\n\r\n        speeds.forEach(speed => {\r\n            const item = DOMUtils.createElement('button', {\r\n                className: `${this.player.options.classPrefix}-menu-item`,\r\n                textContent: this.formatSpeedLabel(speed),\r\n                attributes: {\r\n                    'type': 'button',\r\n                    'role': 'menuitem',\r\n                    'tabindex': '-1'\r\n                }\r\n            });\r\n\r\n            if (speed === this.player.state.playbackSpeed) {\r\n                item.classList.add(`${this.player.options.classPrefix}-menu-item-active`);\r\n                item.appendChild(createIconElement('check'));\r\n                activeItem = item;\r\n            }\r\n\r\n            item.addEventListener('click', () => {\r\n                this.player.setPlaybackSpeed(speed);\r\n                this.closeMenuAndReturnFocus(menu, button);\r\n            });\r\n\r\n            menu.appendChild(item);\r\n        });\r\n\r\n        // Position menu first (before it's visible) to prevent jumping\r\n        // Set menu to invisible temporarily\r\n        menu.style.visibility = 'hidden';\r\n        menu.style.display = 'block';\r\n        \r\n        // Insert menu into DOM (handles fullscreen positioning)\r\n        this.insertMenuIntoDOM(menu, button);\r\n        \r\n        // Position immediately (synchronously) while hidden\r\n        this.positionMenu(menu, button, true);\r\n        \r\n        // Make menu visible after positioning\r\n        requestAnimationFrame(() => {\r\n            menu.style.visibility = 'visible';\r\n        });\r\n\r\n        // Add keyboard navigation\r\n        this.attachMenuKeyboardNavigation(menu, button);\r\n\r\n        // Close menu on outside click\r\n        this.attachMenuCloseHandler(menu, button);\r\n\r\n        // Focus the active item or first item\r\n        setTimeout(() => {\r\n            const focusTarget = activeItem || menu.querySelector(`.${this.player.options.classPrefix}-menu-item`);\r\n            if (focusTarget) {\r\n                focusTarget.focus({ preventScroll: true });\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n    createCaptionsButton() {\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-captions-button`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.captions'),\r\n                'aria-expanded': 'false'\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('captionsOff'));\r\n\r\n        button.addEventListener('click', () => {\r\n            this.showCaptionsMenu(button);\r\n        });\r\n\r\n        this.controls.captions = button;\r\n        return button;\r\n    }\r\n\r\n    showCaptionsMenu(button) {\r\n        // Remove existing menu if any (toggle behavior)\r\n        const existingMenu = document.querySelector(`.${this.player.options.classPrefix}-captions-menu`);\r\n        if (existingMenu) {\r\n            existingMenu.remove();\r\n            button.setAttribute('aria-expanded', 'false');\r\n            // Clear tracking if this was the open menu\r\n            if (this.openMenu === existingMenu) {\r\n                this.openMenu = null;\r\n                this.openMenuButton = null;\r\n            }\r\n            return;\r\n        }\r\n\r\n        const menu = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-captions-menu ${this.player.options.classPrefix}-menu`,\r\n            attributes: {\r\n                'role': 'menu',\r\n                'aria-label': i18n.t('captions.select')\r\n            }\r\n        });\r\n\r\n        // Check if there are any caption tracks\r\n        if (!this.player.captionManager || this.player.captionManager.tracks.length === 0) {\r\n            // Show \"No captions available\" message\r\n            const noTracksItem = DOMUtils.createElement('div', {\r\n                className: `${this.player.options.classPrefix}-menu-item`,\r\n                textContent: i18n.t('player.noCaptions'),\r\n                attributes: {\r\n                    'role': 'menuitem'\r\n                },\r\n                style: {opacity: '0.5', cursor: 'default'}\r\n            });\r\n            menu.appendChild(noTracksItem);\r\n\r\n            // Insert menu into DOM (handles fullscreen positioning)\r\n            this.insertMenuIntoDOM(menu, button);\r\n\r\n            // Close menu on outside click\r\n            this.attachMenuCloseHandler(menu, button);\r\n            return;\r\n        }\r\n\r\n        let activeItem = null;\r\n\r\n        // Off option\r\n        const offItem = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-menu-item`,\r\n            textContent: i18n.t('captions.off'),\r\n            attributes: {\r\n                'type': 'button',\r\n                'role': 'menuitem',\r\n                'tabindex': '-1'\r\n            }\r\n        });\r\n\r\n        if (!this.player.state.captionsEnabled) {\r\n            offItem.classList.add(`${this.player.options.classPrefix}-menu-item-active`);\r\n            offItem.appendChild(createIconElement('check'));\r\n            activeItem = offItem;\r\n        }\r\n\r\n        offItem.addEventListener('click', () => {\r\n            this.player.disableCaptions();\r\n            this.updateCaptionsButton();\r\n            this.closeMenuAndReturnFocus(menu, button);\r\n        });\r\n\r\n        menu.appendChild(offItem);\r\n\r\n        // Available tracks\r\n        const tracks = this.player.captionManager.getAvailableTracks();\r\n        tracks.forEach(track => {\r\n            const item = DOMUtils.createElement('button', {\r\n                className: `${this.player.options.classPrefix}-menu-item`,\r\n                textContent: track.label,\r\n                attributes: {\r\n                    'type': 'button',\r\n                    'role': 'menuitem',\r\n                    'lang': track.language,\r\n                    'tabindex': '-1'\r\n                }\r\n            });\r\n\r\n            // Check if this is the current track\r\n            if (this.player.state.captionsEnabled &&\r\n                this.player.captionManager.currentTrack === this.player.captionManager.tracks[track.index]) {\r\n                item.classList.add(`${this.player.options.classPrefix}-menu-item-active`);\r\n                item.appendChild(createIconElement('check'));\r\n                activeItem = item;\r\n            }\r\n\r\n            item.addEventListener('click', () => {\r\n                this.player.captionManager.switchTrack(track.index);\r\n                this.updateCaptionsButton();\r\n                this.closeMenuAndReturnFocus(menu, button);\r\n            });\r\n\r\n            menu.appendChild(item);\r\n        });\r\n\r\n        // Insert menu into DOM (handles fullscreen positioning)\r\n        this.insertMenuIntoDOM(menu, button);\r\n\r\n        // Add keyboard navigation for the menu\r\n        this.attachMenuKeyboardNavigation(menu, button);\r\n\r\n        // Close menu on outside click and Escape key\r\n        this.attachMenuCloseHandler(menu, button);\r\n\r\n        // Focus the active item or the first item\r\n        setTimeout(() => {\r\n            const focusTarget = activeItem || menu.querySelector(`.${this.player.options.classPrefix}-menu-item`);\r\n            if (focusTarget) {\r\n                focusTarget.focus({ preventScroll: true });\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n    updateCaptionsButton() {\r\n        if (!this.controls.captions) return;\r\n\r\n        const icon = this.controls.captions.querySelector('.vidply-icon');\r\n        const isEnabled = this.player.state.captionsEnabled;\r\n\r\n        icon.innerHTML = isEnabled ?\r\n            createIconElement('captions').innerHTML :\r\n            createIconElement('captionsOff').innerHTML;\r\n\r\n    }\r\n\r\n    createTranscriptButton() {\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-transcript`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.transcript'),\r\n                'aria-expanded': 'false'\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('transcript'));\r\n\r\n        button.addEventListener('click', async () => {\r\n            await this.player.toggleTranscript();\r\n                this.updateTranscriptButton();\r\n        });\r\n\r\n        this.controls.transcript = button;\r\n        return button;\r\n    }\r\n\r\n    updateTranscriptButton() {\r\n        if (!this.controls.transcript) return;\r\n\r\n        const isVisible = this.player.transcriptManager && this.player.transcriptManager.isVisible;\r\n        this.controls.transcript.setAttribute('aria-expanded', isVisible ? 'true' : 'false');\r\n    }\r\n\r\n    createAudioDescriptionButton() {\r\n        const ariaLabel = i18n.t('player.audioDescription');\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-audio-description`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': ariaLabel,\r\n                'role': 'switch',\r\n                'aria-checked': 'false'\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('audioDescription'));\r\n        DOMUtils.attachTooltip(button, ariaLabel, this.player.options.classPrefix);\r\n\r\n        button.addEventListener('click', async () => {\r\n            await this.player.toggleAudioDescription();\r\n            this.updateAudioDescriptionButton();\r\n        });\r\n\r\n        this.controls.audioDescription = button;\r\n        return button;\r\n    }\r\n\r\n    updateAudioDescriptionButton() {\r\n        if (!this.controls.audioDescription) return;\r\n\r\n        const icon = this.controls.audioDescription.querySelector('.vidply-icon');\r\n        const isEnabled = this.player.state.audioDescriptionEnabled;\r\n\r\n        icon.innerHTML = isEnabled ?\r\n            createIconElement('audioDescriptionOn').innerHTML :\r\n            createIconElement('audioDescription').innerHTML;\r\n\r\n        this.controls.audioDescription.setAttribute('aria-checked', isEnabled ? 'true' : 'false');\r\n        // Keep aria-label static - let aria-checked convey the state for switch role\r\n        // The label describes what the control is, not what action it performs\r\n    }\r\n\r\n    createSignLanguageButton() {\r\n        const ariaLabel = i18n.t('player.signLanguage');\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-sign-language`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': ariaLabel,\r\n                'aria-expanded': 'false'\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('signLanguagePip'));\r\n        DOMUtils.attachTooltip(button, ariaLabel, this.player.options.classPrefix);\r\n\r\n        button.addEventListener('click', () => {\r\n            this.player.toggleSignLanguage();\r\n            this.updateSignLanguageButton();\r\n        });\r\n\r\n        this.controls.signLanguage = button;\r\n        return button;\r\n    }\r\n\r\n    updateSignLanguageButton() {\r\n        if (!this.controls.signLanguage) return;\r\n\r\n        const icon = this.controls.signLanguage.querySelector('.vidply-icon');\r\n        const isEnabled = this.player.state.signLanguageEnabled;\r\n\r\n        icon.innerHTML = isEnabled ?\r\n            createIconElement('signLanguagePipOn').innerHTML :\r\n            createIconElement('signLanguagePip').innerHTML;\r\n\r\n        this.controls.signLanguage.setAttribute('aria-expanded', isEnabled ? 'true' : 'false');\r\n        this.controls.signLanguage.setAttribute('aria-label',\r\n            isEnabled ? i18n.t('signLanguage.hide') : i18n.t('signLanguage.show')\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Create sign language in main view button (src swap, like audio description)\r\n     */\r\n    createSignLanguageInMainViewButton() {\r\n        const ariaLabel = i18n.t('signLanguage.showInMainView');\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-sign-language-main-view`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': ariaLabel,\r\n                'aria-pressed': 'false'\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('signLanguage'));\r\n        DOMUtils.attachTooltip(button, ariaLabel, this.player.options.classPrefix);\r\n\r\n        button.addEventListener('click', () => {\r\n            if (this.player.signLanguageManager) {\r\n                this.player.signLanguageManager.toggleInMainView();\r\n            }\r\n        });\r\n\r\n        this.controls.signLanguageMainView = button;\r\n        return button;\r\n    }\r\n\r\n    /**\r\n     * Update sign language in main view button state\r\n     */\r\n    updateSignLanguageInMainViewButton() {\r\n        const btn = this.controls.signLanguageMainView;\r\n        if (!btn) return;\r\n\r\n        const isEnabled = this.player.state.signLanguageInMainView;\r\n        const newLabel = isEnabled ? i18n.t('signLanguage.hideInMainView') : i18n.t('signLanguage.showInMainView');\r\n        const iconName = isEnabled ? 'signLanguageOn' : 'signLanguage';\r\n\r\n        btn.querySelector('.vidply-icon').innerHTML = createIconElement(iconName).innerHTML;\r\n        btn.setAttribute('aria-pressed', String(isEnabled));\r\n        btn.setAttribute('aria-label', newLabel);\r\n        \r\n        const tooltip = btn.querySelector(`.${this.player.options.classPrefix}-tooltip`);\r\n        if (tooltip) tooltip.textContent = newLabel;\r\n    }\r\n\r\n    /**\r\n     * Update accessibility buttons visibility based on current track data.\r\n     * Called when loading a new playlist track to show/hide buttons accordingly.\r\n     */\r\n    updateAccessibilityButtons() {\r\n        const hasAudioDescription = this.hasAudioDescription();\r\n        const hasSignLanguage = this.hasSignLanguage();\r\n        \r\n        // Handle Audio Description button\r\n        if (hasAudioDescription) {\r\n            // Create button if it doesn't exist\r\n            if (!this.controls.audioDescription && this.player.options.audioDescriptionButton !== false) {\r\n                const btn = this.createAudioDescriptionButton();\r\n                btn.dataset.overflowPriority = '2';\r\n                btn.dataset.overflowPriorityMobile = '3';\r\n                // Insert before transcript or playlist toggle button\r\n                const transcriptBtn = this.rightButtons.querySelector(`.${this.player.options.classPrefix}-transcript`);\r\n                const playlistBtn = this.rightButtons.querySelector(`.${this.player.options.classPrefix}-playlist-toggle`);\r\n                const insertBefore = transcriptBtn || playlistBtn || null;\r\n                if (insertBefore) {\r\n                    this.rightButtons.insertBefore(btn, insertBefore);\r\n                } else {\r\n                    this.rightButtons.appendChild(btn);\r\n                }\r\n                // Re-setup overflow menu after adding button\r\n                this.setupOverflowMenu();\r\n            }\r\n            // Show button\r\n            if (this.controls.audioDescription) {\r\n                this.controls.audioDescription.style.display = '';\r\n            }\r\n        } else {\r\n            // Hide button if no audio description available\r\n            if (this.controls.audioDescription) {\r\n                this.controls.audioDescription.style.display = 'none';\r\n            }\r\n        }\r\n        \r\n        // Handle Sign Language buttons (PiP overlay and/or main view based on displayMode)\r\n        const showSignLanguage = hasSignLanguage && this.player.options.signLanguageButton !== false;\r\n        const classPrefix = this.player.options.classPrefix;\r\n        const displayMode = this.player.options.signLanguageDisplayMode || 'both';\r\n        const showPip = ['pip', 'both'].includes(displayMode);\r\n        const showMain = ['main', 'both'].includes(displayMode);\r\n        \r\n        if (showSignLanguage) {\r\n            // Find insertion point once for both buttons\r\n            const qualityBtn = this.rightButtons.querySelector(`.${classPrefix}-quality`);\r\n            const fullscreenBtn = this.rightButtons.querySelector(`.${classPrefix}-fullscreen`);\r\n            const insertBeforeRef = qualityBtn || fullscreenBtn || null;\r\n            let needsOverflowSetup = false;\r\n            \r\n            // Create PiP button if needed and doesn't exist\r\n            if (showPip && !this.controls.signLanguage) {\r\n                const btn = this.createSignLanguageButton();\r\n                btn.dataset.overflowPriority = '3';\r\n                btn.dataset.overflowPriorityMobile = '3';\r\n                if (insertBeforeRef) {\r\n                    this.rightButtons.insertBefore(btn, insertBeforeRef);\r\n                } else {\r\n                    this.rightButtons.appendChild(btn);\r\n                }\r\n                needsOverflowSetup = true;\r\n            }\r\n            \r\n            // Create main view button if needed and doesn't exist\r\n            if (showMain && !this.controls.signLanguageMainView) {\r\n                const btn = this.createSignLanguageInMainViewButton();\r\n                btn.dataset.overflowPriority = '3';\r\n                btn.dataset.overflowPriorityMobile = '3';\r\n                // Insert after PiP button or at the reference point\r\n                const afterPip = this.controls.signLanguage?.nextSibling;\r\n                if (afterPip) {\r\n                    this.rightButtons.insertBefore(btn, afterPip);\r\n                } else if (insertBeforeRef) {\r\n                    this.rightButtons.insertBefore(btn, insertBeforeRef);\r\n                } else {\r\n                    this.rightButtons.appendChild(btn);\r\n                }\r\n                needsOverflowSetup = true;\r\n            }\r\n            \r\n            if (needsOverflowSetup) {\r\n                this.setupOverflowMenu();\r\n            }\r\n            \r\n            // Show/hide buttons based on displayMode\r\n            if (this.controls.signLanguage) {\r\n                this.controls.signLanguage.style.display = showPip ? '' : 'none';\r\n            }\r\n            if (this.controls.signLanguageMainView) {\r\n                this.controls.signLanguageMainView.style.display = showMain ? '' : 'none';\r\n            }\r\n        } else {\r\n            // Hide both buttons if no sign language available\r\n            if (this.controls.signLanguage) this.controls.signLanguage.style.display = 'none';\r\n            if (this.controls.signLanguageMainView) this.controls.signLanguageMainView.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    createSettingsButton() {\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-settings`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.settings')\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('settings'));\r\n\r\n        button.addEventListener('click', () => {\r\n            this.player.showSettings();\r\n        });\r\n\r\n        return button;\r\n    }\r\n\r\n    createPipButton() {\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-pip`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.pip')\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('pip'));\r\n\r\n        button.addEventListener('click', () => {\r\n            this.player.togglePiP();\r\n        });\r\n\r\n        return button;\r\n    }\r\n\r\n    createFullscreenButton() {\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-fullscreen`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': i18n.t('player.fullscreen')\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('fullscreen'));\r\n\r\n        button.addEventListener('click', () => {\r\n            this.player.toggleFullscreen();\r\n        });\r\n\r\n        this.controls.fullscreen = button;\r\n        return button;\r\n    }\r\n\r\n    attachEvents() {\r\n        // Update controls based on player state\r\n        this.player.on('play', () => this.updatePlayPauseButton());\r\n        this.player.on('pause', () => this.updatePlayPauseButton());\r\n        this.player.on('timeupdate', () => this.updateProgress());\r\n        this.player.on('loadedmetadata', () => {\r\n            this.updateDuration();\r\n            this.ensureQualityButton();\r\n            this.updateQualityIndicator();\r\n            // Update preview video source when metadata loads (for playlists)\r\n            this.updatePreviewVideoSource();\r\n        });\r\n        this.player.on('sourcechange', () => {\r\n            // Update preview video source when source changes (for playlists)\r\n            this.updatePreviewVideoSource();\r\n        });\r\n        this.player.on('volumechange', () => this.updateVolumeDisplay());\r\n        this.player.on('progress', () => this.updateBuffered());\r\n        this.player.on('playbackspeedchange', () => this.updateSpeedDisplay());\r\n        this.player.on('fullscreenchange', () => this.updateFullscreenButton());\r\n        this.player.on('captionsenabled', () => this.updateCaptionsButton());\r\n        this.player.on('captionsdisabled', () => this.updateCaptionsButton());\r\n        this.player.on('audiodescriptionenabled', () => this.updateAudioDescriptionButton());\r\n        this.player.on('audiodescriptiondisabled', () => this.updateAudioDescriptionButton());\r\n        this.player.on('signlanguageenabled', () => this.updateSignLanguageButton());\r\n        this.player.on('signlanguagedisabled', () => this.updateSignLanguageButton());\r\n        this.player.on('signlanguageinmainviewenabled', () => this.updateSignLanguageInMainViewButton());\r\n        this.player.on('signlanguageinmainviewdisabled', () => this.updateSignLanguageInMainViewButton());\r\n        this.player.on('qualitychange', () => this.updateQualityIndicator());\r\n        this.player.on('hlslevelswitched', () => this.updateQualityIndicator());\r\n        this.player.on('hlsmanifestparsed', () => {\r\n            this.ensureQualityButton();\r\n            this.updateQualityIndicator();\r\n        });\r\n    }\r\n\r\n    updatePlayPauseButton() {\r\n        if (!this.controls.playPause) return;\r\n\r\n        const icon = this.controls.playPause.querySelector('.vidply-icon');\r\n        const isPlaying = this.player.state.playing;\r\n\r\n        icon.innerHTML = isPlaying ?\r\n            createIconElement('pause').innerHTML :\r\n            createIconElement('play').innerHTML;\r\n\r\n        const newAriaLabel = isPlaying ? i18n.t('player.pause') : i18n.t('player.play');\r\n        this.controls.playPause.setAttribute('aria-label', newAriaLabel);\r\n        // Update tooltip to match aria-label\r\n        DOMUtils.attachTooltip(this.controls.playPause, newAriaLabel, this.player.options.classPrefix);\r\n    }\r\n\r\n    updateProgress() {\r\n        if (!this.controls.played) return;\r\n\r\n        const currentTime = this.player.state.currentTime || 0;\r\n        const duration = this.player.state.duration || 0;\r\n        \r\n        // Guard against division by zero and ensure valid percentage\r\n        const percent = duration > 0 ? Math.min(100, Math.max(0, (currentTime / duration) * 100)) : 0;\r\n        \r\n        this.controls.played.style.width = `${percent}%`;\r\n        this.controls.progress.setAttribute('aria-valuenow', String(Math.round(percent)));\r\n        \r\n        // Set aria-valuetext to announce both percentage and time for screen readers\r\n        const currentTimeText = TimeUtils.formatDuration(this.player.state.currentTime);\r\n        const durationText = TimeUtils.formatDuration(this.player.state.duration);\r\n        this.controls.progress.setAttribute('aria-valuetext', \r\n            `${Math.round(percent)}%, ${currentTimeText} ${i18n.t('time.of')} ${durationText}`);\r\n\r\n        if (this.controls.currentTimeVisual) {\r\n            const currentTime = this.player.state.currentTime;\r\n            // Update visual text (hidden from screen readers)\r\n            this.controls.currentTimeVisual.textContent = TimeUtils.formatTime(currentTime);\r\n            if (this.controls.currentTimeAccessible) {\r\n                this.controls.currentTimeAccessible.textContent = TimeUtils.formatDuration(currentTime);\r\n            }\r\n        }\r\n    }\r\n\r\n    updateDuration() {\r\n        if (this.controls.durationVisual) {\r\n            const duration = this.player.state.duration;\r\n            // Update visual text (hidden from screen readers)\r\n            this.controls.durationVisual.textContent = TimeUtils.formatTime(duration);\r\n            if (this.controls.durationAccessible) {\r\n                this.controls.durationAccessible.textContent = i18n.t('time.durationPrefix') + TimeUtils.formatDuration(duration);\r\n            }\r\n        }\r\n    }\r\n\r\n    updateVolumeDisplay() {\r\n        const percent = this.player.state.volume * 100;\r\n\r\n        // Update volume fill bar if it exists\r\n        if (this.controls.volumeFill) {\r\n            this.controls.volumeFill.style.height = `${percent}%`;\r\n        }\r\n        \r\n        // Update volume slider aria-valuenow if it exists\r\n        if (this.controls.volumeSlider) {\r\n            this.controls.volumeSlider.setAttribute('aria-valuenow', String(Math.round(percent)));\r\n        }\r\n\r\n        // Update mute button icon (should always work even if slider not shown)\r\n        if (this.controls.mute) {\r\n            const icon = this.controls.mute.querySelector('.vidply-icon');\r\n            if (icon) {\r\n                let iconName;\r\n\r\n                if (this.player.state.muted || this.player.state.volume === 0) {\r\n                    iconName = 'volumeMuted';\r\n                } else if (this.player.state.volume < 0.3) {\r\n                    iconName = 'volumeLow';\r\n                } else if (this.player.state.volume < 0.7) {\r\n                    iconName = 'volumeMedium';\r\n                } else {\r\n                    iconName = 'volumeHigh';\r\n                }\r\n\r\n                icon.innerHTML = createIconElement(iconName).innerHTML;\r\n\r\n                const newMuteAriaLabel =\r\n                    this.player.state.muted ? i18n.t('player.unmute') : i18n.t('player.mute');\r\n                this.controls.mute.setAttribute('aria-label', newMuteAriaLabel);\r\n                // Update tooltip to match aria-label\r\n                DOMUtils.attachTooltip(this.controls.mute, newMuteAriaLabel, this.player.options.classPrefix);\r\n            }\r\n        }\r\n\r\n        // Update volume slider attribute if it exists\r\n        if (this.controls.volumeSlider) {\r\n            this.controls.volumeSlider.setAttribute('aria-valuenow', String(Math.round(percent)));\r\n        }\r\n    }\r\n\r\n    updateBuffered() {\r\n        if (!this.controls.buffered || !this.player.element.buffered || this.player.element.buffered.length === 0) return;\r\n\r\n        const buffered = this.player.element.buffered.end(this.player.element.buffered.length - 1);\r\n        const percent = (buffered / this.player.state.duration) * 100;\r\n        this.controls.buffered.style.width = `${percent}%`;\r\n    }\r\n\r\n    updateSpeedDisplay() {\r\n        if (this.controls.speedText) {\r\n            this.controls.speedText.textContent = `${this.player.state.playbackSpeed}x`;\r\n        }\r\n    }\r\n\r\n    updateFullscreenButton() {\r\n        if (!this.controls.fullscreen) return;\r\n\r\n        const icon = this.controls.fullscreen.querySelector('.vidply-icon');\r\n        const isFullscreen = this.player.state.fullscreen;\r\n\r\n        icon.innerHTML = isFullscreen ?\r\n            createIconElement('fullscreenExit').innerHTML :\r\n            createIconElement('fullscreen').innerHTML;\r\n\r\n        this.controls.fullscreen.setAttribute('aria-label',\r\n            isFullscreen ? i18n.t('player.exitFullscreen') : i18n.t('player.fullscreen')\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Ensure quality button exists if qualities are available\r\n     * This is called after renderer initialization to dynamically add the button\r\n     */\r\n    ensureQualityButton() {\r\n        // Skip if quality button is disabled\r\n        if (!this.player.options.qualityButton) return;\r\n        \r\n        // Skip if button already exists\r\n        if (this.controls.quality) return;\r\n        \r\n        // Check if qualities are now available\r\n        if (!this.hasQualityLevels()) return;\r\n        \r\n        // Create and insert the quality button before the speed button\r\n        const qualityButton = this.createQualityButton();\r\n        \r\n        // Find the speed button or caption style button to insert before\r\n        const speedButton = this.rightButtons.querySelector(`.${this.player.options.classPrefix}-speed`);\r\n        const captionStyleButton = this.rightButtons.querySelector(`.${this.player.options.classPrefix}-caption-style`);\r\n        const insertBefore = captionStyleButton || speedButton;\r\n        \r\n        if (insertBefore) {\r\n            this.rightButtons.insertBefore(qualityButton, insertBefore);\r\n        } else {\r\n            // If no reference button, add it at the beginning of right buttons\r\n            this.rightButtons.insertBefore(qualityButton, this.rightButtons.firstChild);\r\n        }\r\n        \r\n        this.player.log('Quality button added dynamically', 'info');\r\n    }\r\n\r\n    updateQualityIndicator() {\r\n        if (!this.controls.qualityText) return;\r\n        if (!this.player.renderer || !this.player.renderer.getQualities) return;\r\n\r\n        const qualities = this.player.renderer.getQualities();\r\n        if (qualities.length === 0) {\r\n            this.controls.qualityText.textContent = '';\r\n            return;\r\n        }\r\n\r\n        // Get current quality\r\n        let currentQualityText = '';\r\n        \r\n        // Check if it's HLS with auto mode\r\n        if (this.player.renderer.hls && this.player.renderer.hls.currentLevel === -1) {\r\n            currentQualityText = 'Auto';\r\n        } else if (this.player.renderer.getCurrentQuality) {\r\n            const currentIndex = this.player.renderer.getCurrentQuality();\r\n            const currentQuality = qualities.find(q => q.index === currentIndex);\r\n            if (currentQuality) {\r\n                currentQualityText = currentQuality.height ? `${currentQuality.height}p` : '';\r\n            }\r\n        }\r\n\r\n        this.controls.qualityText.textContent = currentQualityText;\r\n    }\r\n\r\n    setupAutoHide() {\r\n        if (this.player.element.tagName !== 'VIDEO') return;\r\n\r\n        const showControls = () => {\r\n            this.element.classList.add(`${this.player.options.classPrefix}-controls-visible`);\r\n            this.player.container.classList.add(`${this.player.options.classPrefix}-controls-visible`);\r\n            this.player.state.controlsVisible = true;\r\n\r\n            clearTimeout(this.hideTimeout);\r\n\r\n            if (this.player.state.playing) {\r\n                // Use longer delay in fullscreen mode for better mobile UX\r\n                const delay = this.player.state.fullscreen \r\n                    ? this.player.options.hideControlsDelay * 1.5 \r\n                    : this.player.options.hideControlsDelay;\r\n                    \r\n                this.hideTimeout = setTimeout(() => {\r\n                    this.element.classList.remove(`${this.player.options.classPrefix}-controls-visible`);\r\n                    this.player.container.classList.remove(`${this.player.options.classPrefix}-controls-visible`);\r\n                    this.player.state.controlsVisible = false;\r\n                }, delay);\r\n            }\r\n        };\r\n\r\n        // Mouse and touch events to show controls\r\n        this.player.container.addEventListener('mousemove', showControls);\r\n        this.player.container.addEventListener('touchstart', showControls);\r\n        this.player.container.addEventListener('touchmove', showControls); // Also show on touch drag/swipe\r\n        this.player.container.addEventListener('click', showControls);\r\n        this.player.container.addEventListener('tap', showControls); // Some mobile browsers use tap event\r\n\r\n        // Show controls on focus\r\n        this.element.addEventListener('focusin', showControls);\r\n\r\n        // Always show when paused\r\n        this.player.on('pause', () => {\r\n            showControls();\r\n            clearTimeout(this.hideTimeout);\r\n        });\r\n\r\n        this.player.on('play', () => {\r\n            showControls();\r\n        });\r\n\r\n        // Show controls when entering fullscreen (especially important for mobile landscape)\r\n        this.player.on('enterfullscreen', () => {\r\n            showControls();\r\n            // In fullscreen, keep controls visible longer initially\r\n            if (this.player.state.fullscreen) {\r\n                clearTimeout(this.hideTimeout);\r\n                this.hideTimeout = setTimeout(() => {\r\n                    if (this.player.state.playing) {\r\n                        this.element.classList.remove(`${this.player.options.classPrefix}-controls-visible`);\r\n                        this.player.container.classList.remove(`${this.player.options.classPrefix}-controls-visible`);\r\n                        this.player.state.controlsVisible = false;\r\n                    }\r\n                }, this.player.options.hideControlsDelay * 2); // Double the delay in fullscreen\r\n            }\r\n        });\r\n\r\n        // Initial state\r\n        showControls();\r\n    }\r\n\r\n    createOverflowMenuButton() {\r\n        const ariaLabel = i18n.t('player.moreOptions');\r\n        const button = DOMUtils.createElement('button', {\r\n            className: `${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-overflow-menu`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': ariaLabel,\r\n                'aria-expanded': 'false'\r\n            }\r\n        });\r\n\r\n        button.appendChild(createIconElement('moreVertical'));\r\n        DOMUtils.attachTooltip(button, ariaLabel, this.player.options.classPrefix);\r\n\r\n        button.addEventListener('click', () => {\r\n            this.showOverflowMenu(button);\r\n        });\r\n\r\n        this.controls.overflowMenu = button;\r\n        return button;\r\n    }\r\n\r\n    showOverflowMenu(button) {\r\n        // Remove existing menu if any (toggle behavior)\r\n        const existingMenu = document.querySelector(`.${this.player.options.classPrefix}-overflow-menu-list`);\r\n        if (existingMenu) {\r\n            existingMenu.remove();\r\n            button.setAttribute('aria-expanded', 'false');\r\n            if (this.openMenu === existingMenu) {\r\n                this.openMenu = null;\r\n                this.openMenuButton = null;\r\n            }\r\n            return;\r\n        }\r\n\r\n        const menu = DOMUtils.createElement('div', {\r\n            className: `${this.player.options.classPrefix}-overflow-menu-list ${this.player.options.classPrefix}-menu`,\r\n            attributes: {\r\n                'role': 'menu',\r\n                'aria-label': i18n.t('player.moreOptions')\r\n            }\r\n        });\r\n\r\n        // Get all overflow buttons (those currently hidden)\r\n        const overflowButtons = Array.from(this.rightButtons.querySelectorAll('button[data-in-overflow=\"true\"]'));\r\n\r\n        if (overflowButtons.length === 0) {\r\n            // No overflow items\r\n            const noItemsText = DOMUtils.createElement('div', {\r\n                className: `${this.player.options.classPrefix}-menu-item`,\r\n                textContent: i18n.t('player.noMoreOptions'),\r\n                attributes: {\r\n                    'role': 'menuitem'\r\n                },\r\n                style: {opacity: '0.5', cursor: 'default'}\r\n            });\r\n            menu.appendChild(noItemsText);\r\n        } else {\r\n            // Create menu items for each overflow button\r\n            overflowButtons.forEach(btn => {\r\n                const item = DOMUtils.createElement('button', {\r\n                    className: `${this.player.options.classPrefix}-menu-item`,\r\n                    attributes: {\r\n                        'type': 'button',\r\n                        'role': 'menuitem',\r\n                        'tabindex': '-1'\r\n                    }\r\n                });\r\n\r\n                // Get button label\r\n                const label = btn.getAttribute('aria-label') || btn.getAttribute('title') || '';\r\n                \r\n                // Copy icon if present (SVG icon or text icon like \"Aa\")\r\n                const icon = btn.querySelector('.vidply-icon');\r\n                if (icon) {\r\n                    const iconClone = icon.cloneNode(true);\r\n                    item.appendChild(iconClone);\r\n                } else {\r\n                    // Check for text icon (like caption styling \"Aa\")\r\n                    const firstChild = btn.querySelector('span');\r\n                    if (firstChild && firstChild.textContent && firstChild.textContent.length <= 3) {\r\n                        const iconClone = firstChild.cloneNode(true);\r\n                        iconClone.classList.add('vidply-icon'); // Add icon class for consistent styling\r\n                        item.appendChild(iconClone);\r\n                    }\r\n                }\r\n                \r\n                const labelSpan = DOMUtils.createElement('span', {\r\n                    textContent: label\r\n                });\r\n                item.appendChild(labelSpan);\r\n\r\n                // When clicked, trigger the original button's click\r\n                item.addEventListener('click', (e) => {\r\n                    // Store the overflow menu item as the positioning reference\r\n                    // This allows submenus to position relative to the visible menu item\r\n                    this._overflowMenuItemRef = item;\r\n                    \r\n                    // Temporarily make the original button visible for positioning\r\n                    const originalDisplay = btn.style.display;\r\n                    btn.style.display = '';\r\n                    btn.style.visibility = 'hidden'; // Keep it invisible but in layout\r\n                    \r\n                    // Trigger the button's menu\r\n                    btn.click();\r\n                    \r\n                    // Restore original state after menu is positioned\r\n                    setTimeout(() => {\r\n                        btn.style.display = originalDisplay;\r\n                        btn.style.visibility = '';\r\n                        this._overflowMenuItemRef = null;\r\n                    }, 100);\r\n                    \r\n                    // Close overflow menu\r\n                    this.closeMenuAndReturnFocus(menu, button);\r\n                });\r\n\r\n                menu.appendChild(item);\r\n            });\r\n\r\n            // Add keyboard navigation\r\n            this.attachMenuKeyboardNavigation(menu, button);\r\n\r\n            // Focus first item\r\n            setTimeout(() => {\r\n                const firstItem = menu.querySelector(`.${this.player.options.classPrefix}-menu-item`);\r\n                if (firstItem && firstItem.tagName === 'BUTTON') {\r\n                    firstItem.focus({ preventScroll: true });\r\n                }\r\n            }, 0);\r\n        }\r\n\r\n        // Position menu first (before it's visible) to prevent jumping\r\n        menu.style.visibility = 'hidden';\r\n        menu.style.display = 'block';\r\n        \r\n        // Insert menu into DOM (handles fullscreen positioning)\r\n        this.insertMenuIntoDOM(menu, button);\r\n        \r\n        // Position immediately (synchronously) while hidden\r\n        this.positionMenu(menu, button, true);\r\n        \r\n        // Make menu visible after positioning\r\n        requestAnimationFrame(() => {\r\n            menu.style.visibility = 'visible';\r\n        });\r\n\r\n        // Close menu on outside click\r\n        this.attachMenuCloseHandler(menu, button);\r\n    }\r\n\r\n    setupOverflowDetection() {\r\n        // Check for overflow after layout is stable\r\n        const checkOverflow = () => {\r\n            // Check screen size and orientation\r\n            const isDesktop = window.innerWidth >= 768;\r\n            const isLandscape = window.innerHeight < window.innerWidth;\r\n            const isFullscreen = this.player.state.fullscreen;\r\n            const isLandscapeFullscreen = isLandscape && isFullscreen;\r\n            \r\n            if (!this.rightButtons || this.rightButtons.children.length === 0) {\r\n                // Hide overflow button if no buttons exist\r\n                if (this.overflowMenuButton) {\r\n                    this.overflowMenuButton.style.display = 'none';\r\n                }\r\n                return;\r\n            }\r\n\r\n            // Get all buttons (except the overflow menu button itself)\r\n            const allButtons = Array.from(this.rightButtons.children).filter(\r\n                btn => !btn.classList.contains(`${this.player.options.classPrefix}-overflow-menu`)\r\n            );\r\n\r\n            if (allButtons.length === 0) {\r\n                // Hide overflow button if no buttons exist\r\n                if (this.overflowMenuButton) {\r\n                    this.overflowMenuButton.style.display = 'none';\r\n                }\r\n                return;\r\n            }\r\n\r\n            // Determine if we should use overflow menu\r\n            // Only use overflow on mobile portrait (width < 768px and not in landscape)\r\n            // In landscape mode, always show all buttons (even on mobile) to ensure fullscreen button is accessible\r\n            const shouldUseOverflow = !isDesktop && !isLandscape;\r\n            \r\n            if (this.player.options.debug) {\r\n                console.log('Overflow detection:', {\r\n                    isDesktop,\r\n                    isFullscreen,\r\n                    isLandscape,\r\n                    isLandscapeFullscreen,\r\n                    shouldUseOverflow,\r\n                    width: window.innerWidth,\r\n                    height: window.innerHeight\r\n                });\r\n            }\r\n\r\n            // If we shouldn't use overflow menu, show all buttons and hide overflow button\r\n            if (!shouldUseOverflow) {\r\n                allButtons.forEach(btn => {\r\n                    btn.dataset.inOverflow = 'false';\r\n                    btn.style.display = '';\r\n                });\r\n                // Always hide overflow menu button\r\n                if (this.overflowMenuButton) {\r\n                    this.overflowMenuButton.style.display = 'none';\r\n                }\r\n                if (this.player.options.debug) {\r\n                    console.log('No overflow menu needed - all buttons visible, overflow button hidden');\r\n                }\r\n                return;\r\n            }\r\n            \r\n            // Continue with overflow detection for mobile portrait only\r\n            if (this.player.options.debug) {\r\n                console.log('Mobile portrait - checking for overflow...');\r\n            }\r\n\r\n            // First, make all buttons visible to measure their actual widths\r\n            allButtons.forEach(btn => {\r\n                btn.style.display = '';\r\n            });\r\n\r\n            // Get available width\r\n            const containerWidth = this.rightButtons.offsetWidth;\r\n            const overflowButtonWidth = 50; // Reserve space for overflow button + gap\r\n            const availableWidth = containerWidth - overflowButtonWidth;\r\n\r\n            // Calculate total width needed for all buttons including gaps\r\n            let totalWidth = 0;\r\n            const buttonWidths = allButtons.map(btn => {\r\n                const style = getComputedStyle(btn);\r\n                const width = btn.offsetWidth + \r\n                             parseInt(style.marginLeft || 0) + \r\n                             parseInt(style.marginRight || 0);\r\n                totalWidth += width;\r\n                return {btn, width};\r\n            });\r\n\r\n            // Add gap widths (8px per gap between buttons)\r\n            const gapWidth = 8;\r\n            totalWidth += (allButtons.length - 1) * gapWidth;\r\n\r\n            // Check if overflow is needed\r\n            const isSmallScreen = window.innerWidth < 768;\r\n            const needsOverflow = totalWidth > availableWidth || isSmallScreen || (isLandscapeFullscreen && !isDesktop); // Always overflow on mobile and mobile landscape fullscreen\r\n\r\n            // Debug logging\r\n            if (this.player.options.debug) {\r\n                console.log('Overflow detection:', {\r\n                    containerWidth,\r\n                    availableWidth,\r\n                    totalWidth,\r\n                    needsOverflow,\r\n                    isSmallScreen,\r\n                    reason: isSmallScreen ? 'mobile screen' : (totalWidth > availableWidth ? 'not enough space' : 'enough space'),\r\n                    buttonCount: allButtons.length\r\n                });\r\n            }\r\n\r\n            if (needsOverflow) {\r\n                // Use responsive priorities based on screen size\r\n                const isSmallScreen = window.innerWidth < 768;\r\n                const priorityAttr = isSmallScreen ? 'overflowPriorityMobile' : 'overflowPriority';\r\n                \r\n                if (this.player.options.debug) {\r\n                    console.log(`Using ${isSmallScreen ? 'mobile' : 'desktop'} priorities (width: ${window.innerWidth}px)`);\r\n                }\r\n                \r\n                // Sort buttons by priority (highest priority last)\r\n                const sortedButtons = buttonWidths.sort((a, b) => {\r\n                    const priorityA = parseInt(a.btn.dataset[priorityAttr] || a.btn.dataset.overflowPriority || '1');\r\n                    const priorityB = parseInt(b.btn.dataset[priorityAttr] || b.btn.dataset.overflowPriority || '1');\r\n                    return priorityB - priorityA; // Higher priority = lower number = later in array\r\n                });\r\n\r\n                // Hide buttons starting with lowest priority until fits\r\n                let currentWidth = totalWidth;\r\n                let movedToOverflow = 0;\r\n\r\n                for (const {btn, width} of sortedButtons) {\r\n                    const priority = parseInt(btn.dataset[priorityAttr] || btn.dataset.overflowPriority || '1');\r\n                    const buttonLabel = btn.getAttribute('aria-label') || 'unknown';\r\n                    \r\n                    // Never hide priority 1 buttons\r\n                    if (priority === 1) {\r\n                        btn.dataset.inOverflow = 'false';\r\n                        btn.style.display = '';\r\n                        continue;\r\n                    }\r\n\r\n                    // On mobile, hide all non-priority-1 buttons (priority 2 and 3)\r\n                    // On desktop, only hide if not enough space\r\n                    const shouldHide = isSmallScreen ? (priority > 1) : (currentWidth > availableWidth);\r\n\r\n                    if (shouldHide) {\r\n                        // Move to overflow\r\n                        btn.dataset.inOverflow = 'true';\r\n                        btn.style.display = 'none';\r\n                        currentWidth -= width;\r\n                        movedToOverflow++;\r\n                        if (this.player.options.debug) {\r\n                            console.log(`   Hiding button: ${buttonLabel} (priority ${priority}, ${isSmallScreen ? 'mobile' : 'desktop'})`);\r\n                        }\r\n                    } else {\r\n                        // Keep visible\r\n                        btn.dataset.inOverflow = 'false';\r\n                        btn.style.display = '';\r\n                    }\r\n                }\r\n\r\n                // Show overflow menu button if we moved any buttons\r\n                if (this.player.options.debug) {\r\n                    console.log('Overflow button exists?', !!this.overflowMenuButton);\r\n                }\r\n                \r\n                if (!this.overflowMenuButton) {\r\n                    console.error('Overflow menu button not found!');\r\n                    return;\r\n                }\r\n                \r\n                if (movedToOverflow > 0) {\r\n                    this.overflowMenuButton.style.display = '';\r\n                    if (this.player.options.debug) {\r\n                        console.log('Showing overflow menu button -', movedToOverflow, 'buttons moved');\r\n                    }\r\n                } else {\r\n                    this.overflowMenuButton.style.display = 'none';\r\n                    if (this.player.options.debug) {\r\n                        console.log('Hiding overflow menu button - all buttons fit');\r\n                    }\r\n                }\r\n            } else {\r\n                // No overflow needed - show all buttons\r\n                allButtons.forEach(btn => {\r\n                    btn.dataset.inOverflow = 'false';\r\n                    btn.style.display = '';\r\n                });\r\n                this.overflowMenuButton.style.display = 'none';\r\n            }\r\n        };\r\n\r\n        // Check on resize\r\n        const resizeObserver = new ResizeObserver(() => {\r\n            requestAnimationFrame(checkOverflow);\r\n        });\r\n        resizeObserver.observe(this.rightButtons);\r\n\r\n        // Check on window resize\r\n        window.addEventListener('resize', () => {\r\n            requestAnimationFrame(checkOverflow);\r\n        });\r\n\r\n        // Check on fullscreen changes (important for desktop/tablet fullscreen)\r\n        this.player.on('fullscreenchange', () => {\r\n            // Use setTimeout to ensure fullscreen state is fully updated\r\n            setTimeout(() => {\r\n                requestAnimationFrame(checkOverflow);\r\n            }, 50);\r\n        });\r\n\r\n        // Initial checks at multiple intervals to ensure layout is stable\r\n        // Some browsers need more time for font loading, CSS rendering, etc.\r\n        requestAnimationFrame(() => {\r\n            checkOverflow();\r\n            setTimeout(() => checkOverflow(), 100);\r\n            setTimeout(() => checkOverflow(), 300);\r\n            setTimeout(() => checkOverflow(), 500);\r\n        });\r\n\r\n        // Also check when fonts are loaded\r\n        if (document.fonts && document.fonts.ready) {\r\n            document.fonts.ready.then(() => {\r\n                requestAnimationFrame(checkOverflow);\r\n            });\r\n        }\r\n\r\n        // Store for cleanup\r\n        this.overflowResizeObserver = resizeObserver;\r\n    }\r\n\r\n    show() {\r\n        this.element.style.display = '';\r\n    }\r\n\r\n    hide() {\r\n        this.element.style.display = 'none';\r\n    }\r\n\r\n    /**\r\n     * Update preview video source when player source changes (for playlists)\r\n     * Also re-initializes if preview wasn't set up initially\r\n     */\r\n    updatePreviewVideoSource() {\r\n        const renderer = this.player.renderer;\r\n        if (!renderer || !renderer.media || renderer.media.tagName !== 'VIDEO') {\r\n            return;\r\n        }\r\n\r\n        // If preview wasn't initialized yet, try to initialize it now\r\n        if (!this.previewSupported && !this.previewVideo) {\r\n            this.initPreviewThumbnail();\r\n        }\r\n\r\n        if (!this.previewSupported || !this.previewVideo) {\r\n            return;\r\n        }\r\n\r\n        const mainVideo = renderer.media;\r\n        const newSrc = mainVideo.src || mainVideo.querySelector('source')?.src;\r\n        \r\n        if (newSrc && this.previewVideo.src !== newSrc) {\r\n            // Clear cache when source changes\r\n            this.previewThumbnailCache.clear();\r\n            this.previewVideoReady = false;\r\n            this.previewVideo.src = newSrc;\r\n            \r\n            // Copy crossOrigin if set\r\n            if (mainVideo.crossOrigin) {\r\n                this.previewVideo.crossOrigin = mainVideo.crossOrigin;\r\n            }\r\n            \r\n            // Wait for new source to load\r\n            this.previewVideo.addEventListener('loadedmetadata', () => {\r\n                this.previewVideoReady = true;\r\n            }, { once: true });\r\n        } else if (newSrc && !this.previewVideoReady && this.previewVideo.readyState >= 1) {\r\n            // If source is the same but video is ready, mark as ready\r\n            this.previewVideoReady = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Cleanup preview thumbnail resources\r\n     */\r\n    cleanupPreviewThumbnail() {\r\n        if (this.previewThumbnailTimeout) {\r\n            clearTimeout(this.previewThumbnailTimeout);\r\n            this.previewThumbnailTimeout = null;\r\n        }\r\n        \r\n        if (this.previewVideo && this.previewVideo.parentNode) {\r\n            this.previewVideo.parentNode.removeChild(this.previewVideo);\r\n            this.previewVideo = null;\r\n        }\r\n        \r\n        this.previewThumbnailCache.clear();\r\n    }\r\n\r\n    destroy() {\r\n        if (this.hideTimeout) {\r\n            clearTimeout(this.hideTimeout);\r\n        }\r\n\r\n        if (this.overflowResizeObserver) {\r\n            this.overflowResizeObserver.disconnect();\r\n        }\r\n\r\n        // Cleanup preview thumbnail resources\r\n        this.cleanupPreviewThumbnail();\r\n\r\n        if (this.element && this.element.parentNode) {\r\n            this.element.parentNode.removeChild(this.element);\r\n        }\r\n    }\r\n}\r\n\r\n", "/**\n * Caption/Subtitle Manager\n */\n\nimport {DOMUtils} from '../utils/DOMUtils.js';\nimport {i18n} from '../i18n/i18n.js';\nimport {StorageManager} from '../utils/StorageManager.js';\nimport {debounce, isMobile, rafWithTimeout} from '../utils/PerformanceUtils.js';\n\nexport class CaptionManager {\n    constructor(player) {\n        this.player = player;\n        this.element = null;\n        this.tracks = [];\n        this.currentTrack = null;\n        this.currentCue = null;\n        \n        // Storage manager\n        this.storage = new StorageManager('vidply');\n        \n        // Load saved preferences\n        this.loadSavedPreferences();\n\n        this.init();\n    }\n    \n    loadSavedPreferences() {\n        const saved = this.storage.getCaptionPreferences();\n        if (saved) {\n            // Override player options with saved preferences\n            if (saved.fontSize) this.player.options.captionsFontSize = saved.fontSize;\n            if (saved.fontFamily) this.player.options.captionsFontFamily = saved.fontFamily;\n            if (saved.color) this.player.options.captionsColor = saved.color;\n            if (saved.backgroundColor) this.player.options.captionsBackgroundColor = saved.backgroundColor;\n            if (saved.opacity !== undefined) this.player.options.captionsOpacity = saved.opacity;\n        }\n    }\n    \n    saveCaptionPreferences() {\n        this.storage.saveCaptionPreferences({\n            fontSize: this.player.options.captionsFontSize,\n            fontFamily: this.player.options.captionsFontFamily,\n            color: this.player.options.captionsColor,\n            backgroundColor: this.player.options.captionsBackgroundColor,\n            opacity: this.player.options.captionsOpacity\n        });\n    }\n\n    init() {\n        this.createElement();\n        this.loadTracks();\n        this.attachEvents();\n\n        // Only enable captions via captionsDefault option if no default track was found\n        // (loadTracks() already enables tracks with the default attribute)\n        if (this.player.options.captionsDefault && this.tracks.length > 0 && !this.currentTrack) {\n            this.enable();\n        }\n    }\n\n    createElement() {\n        this.element = DOMUtils.createElement('div', {\n            className: `${this.player.options.classPrefix}-captions`,\n            attributes: {\n                'role': 'region',\n                'aria-label': i18n.t('player.captions')\n            }\n        });\n\n        // Apply caption styles\n        this.updateStyles();\n\n        // Append to videoWrapper if it exists, otherwise to container\n        const target = this.player.videoWrapper || this.player.container;\n        target.appendChild(this.element);\n    }\n\n    loadTracks() {\n        const textTracks = this.player.element.textTracks;\n        let defaultTrackIndex = -1;\n\n        for (let i = 0; i < textTracks.length; i++) {\n            const track = textTracks[i];\n\n            if (track.kind === 'subtitles' || track.kind === 'captions') {\n                // Check if this track has the default attribute\n                const trackElement = this.player.findTrackElement(track);\n                const isDefault = trackElement && trackElement.hasAttribute('default');\n                \n                this.tracks.push({\n                    track: track,\n                    language: track.language,\n                    label: track.label,\n                    kind: track.kind,\n                    index: i,\n                    isDefault: isDefault\n                });\n\n                // Set all tracks to 'hidden' mode (not 'disabled' or 'showing')\n                // 'hidden' mode loads cues and fires events, but doesn't show native captions\n                // This is important even for default tracks - we want custom caption display\n                if (track.mode === 'showing') {\n                    // If browser set it to 'showing' (e.g., for default tracks), change to 'hidden'\n                    track.mode = 'hidden';\n                } else if (track.mode === 'disabled') {\n                    // If disabled, set to 'hidden' to load cues\n                    track.mode = 'hidden';\n                } else {\n                    // Ensure it's 'hidden' (might already be, but be explicit)\n                    track.mode = 'hidden';\n                }\n                \n                if (isDefault) {\n                    defaultTrackIndex = this.tracks.length - 1;\n                }\n            }\n        }\n        \n        // If a default track was found, enable it\n        // Use a small delay to ensure tracks are ready\n        if (defaultTrackIndex >= 0) {\n            requestAnimationFrame(() => {\n                this.enable(defaultTrackIndex);\n            });\n        }\n    }\n\n    attachEvents() {\n        this.player.on('timeupdate', () => {\n            this.updateCaptions();\n        });\n\n        this.player.on('captionschange', () => {\n            this.updateStyles();\n        });\n        \n        // Debounced resize handler to avoid excessive recalculations\n        this.debouncedPositionCaptions = debounce(() => {\n            this.positionCaptionsOnMobile();\n        }, 150);\n        \n        window.addEventListener('resize', this.debouncedPositionCaptions);\n        \n        // Recalculate on fullscreen change with RAF\n        this.player.on('enterfullscreen', () => {\n            rafWithTimeout(() => this.positionCaptionsOnMobile(), 100);\n        });\n        \n        this.player.on('exitfullscreen', () => {\n            rafWithTimeout(() => this.positionCaptionsOnMobile(), 100);\n        });\n    }\n\n    enable(trackIndex = 0) {\n        if (this.tracks.length === 0) {\n            return;\n        }\n\n        // Disable current track\n        if (this.currentTrack && this.currentTrack.track) {\n            // Remove cuechange listener from old track\n            if (this.cueChangeHandler) {\n                this.currentTrack.track.removeEventListener('cuechange', this.cueChangeHandler);\n            }\n            this.currentTrack.track.mode = 'hidden';\n        }\n\n        // Enable selected track\n        const selectedTrack = this.tracks[trackIndex];\n\n        if (selectedTrack && selectedTrack.track) {\n            // Set to 'hidden' not 'showing' to prevent browser from displaying native captions\n            // We'll handle the display ourselves\n            // But we need to set mode to 'hidden' to load cues\n            selectedTrack.track.mode = 'hidden';\n            this.currentTrack = selectedTrack;\n            this.player.state.captionsEnabled = true;\n            \n            // Set lang attribute for screen readers to pronounce text correctly\n            if (selectedTrack.language) {\n                this.element.setAttribute('lang', selectedTrack.language);\n            }\n\n            // Remove any existing cuechange listener from this track\n            if (this.cueChangeHandler) {\n                selectedTrack.track.removeEventListener('cuechange', this.cueChangeHandler);\n            }\n\n            // Add event listener for cue changes\n            this.cueChangeHandler = () => {\n                this.updateCaptions();\n            };\n            selectedTrack.track.addEventListener('cuechange', this.cueChangeHandler);\n\n            // Force track to load if it's not already loaded\n            // If track is not ready, wait for it to load\n            const ensureTrackReady = () => {\n                if (selectedTrack.track.readyState < 2) {\n                    // Track not loaded yet, wait for load event\n                    const onTrackLoad = () => {\n                        selectedTrack.track.removeEventListener('load', onTrackLoad);\n                        selectedTrack.track.removeEventListener('error', onTrackLoad);\n                        // Force initial update after track loads\n                        requestAnimationFrame(() => {\n                            if (this.currentTrack && this.currentTrack.track === selectedTrack.track) {\n                                this.updateCaptions();\n                            }\n                        });\n                    };\n                    selectedTrack.track.addEventListener('load', onTrackLoad, { once: true });\n                    selectedTrack.track.addEventListener('error', onTrackLoad, { once: true });\n                } else {\n                    // Track already loaded, force initial update\n                    requestAnimationFrame(() => {\n                        if (this.currentTrack && this.currentTrack.track === selectedTrack.track) {\n                            this.updateCaptions();\n                        }\n                    });\n                }\n            };\n\n            // Use requestAnimationFrame to ensure track is ready\n            requestAnimationFrame(() => {\n                if (this.currentTrack && this.currentTrack.track === selectedTrack.track) {\n                    ensureTrackReady();\n                }\n            });\n\n            this.player.emit('captionsenabled', selectedTrack);\n        }\n    }\n\n    disable() {\n        if (this.currentTrack) {\n            this.currentTrack.track.mode = 'hidden';\n            this.currentTrack = null;\n        }\n\n        this.element.style.display = 'none';\n        this.element.innerHTML = '';\n        this.element.removeAttribute('lang');\n        this.currentCue = null;\n        this.player.state.captionsEnabled = false;\n        this.player.emit('captionsdisabled');\n    }\n\n    updateCaptions() {\n        if (!this.currentTrack || !this.currentTrack.track) {\n            return;\n        }\n\n        // Ensure track mode is set to 'hidden' (not 'disabled') to receive cue updates\n        // 'hidden' mode loads cues and fires cuechange events, but doesn't show native captions\n        // If track is 'disabled', it won't have activeCues or fire events\n        if (this.currentTrack.track.mode === 'disabled') {\n            this.currentTrack.track.mode = 'hidden';\n        }\n\n        // Ensure track is in 'hidden' mode (not 'showing') for custom caption display\n        if (this.currentTrack.track.mode === 'showing') {\n            this.currentTrack.track.mode = 'hidden';\n        }\n\n        // Check if track has cues loaded\n        if (!this.currentTrack.track.activeCues) {\n            // If no activeCues property, track might not be ready yet\n            // Try to access cues directly\n            if (this.currentTrack.track.cues && this.currentTrack.track.cues.length > 0) {\n                // Track has cues but no active ones yet - this is normal\n                // Clear any existing caption\n                if (this.currentCue) {\n                    this.element.innerHTML = '';\n                    this.element.style.display = 'none';\n                    this.currentCue = null;\n                }\n            }\n            return;\n        }\n\n        const activeCues = this.currentTrack.track.activeCues;\n        const isAudioPlayer = this.player.element.tagName.toLowerCase() === 'audio';\n\n        if (activeCues.length > 0) {\n            const cue = activeCues[0];\n\n            // Only update if the cue has changed\n            if (this.currentCue !== cue) {\n                this.currentCue = cue;\n\n                // Parse and display cue text\n                let text = cue.text;\n\n                // Handle VTT formatting\n                text = this.parseVTTFormatting(text);\n\n                // Audio players: transcript-style accumulation\n                if (isAudioPlayer) {\n                    // Remove highlight from previous active cue\n                    const existingCues = this.element.querySelectorAll(`.${this.player.options.classPrefix}-caption-cue`);\n                    existingCues.forEach(el => el.classList.remove(`${this.player.options.classPrefix}-caption-active`));\n                    \n                    // Check if this cue is already displayed\n                    const cueId = `cue-${cue.startTime}-${cue.endTime}`;\n                    let cueElement = this.element.querySelector(`[data-cue-id=\"${cueId}\"]`);\n                    \n                    if (!cueElement) {\n                        // Create new cue element\n                        cueElement = document.createElement('div');\n                        cueElement.className = `${this.player.options.classPrefix}-caption-cue`;\n                        cueElement.setAttribute('data-cue-id', cueId);\n                        cueElement.innerHTML = DOMUtils.sanitizeHTML(text);\n                        this.element.appendChild(cueElement);\n                    }\n                    \n                    // Highlight active cue\n                    cueElement.classList.add(`${this.player.options.classPrefix}-caption-active`);\n                    \n                    // Scroll to active cue smoothly - center it for better visibility\n                    requestAnimationFrame(() => {\n                        if (cueElement) {\n                            cueElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\n                        }\n                    });\n                } else {\n                    // Video players: replace content as before\n                    this.element.innerHTML = DOMUtils.sanitizeHTML(text);\n                }\n\n                // Make sure it's visible when there's content\n                this.element.style.display = 'block';\n                \n                // Position captions above controls on mobile\n                this.positionCaptionsOnMobile();\n\n                this.player.emit('captionchange', cue);\n            }\n        } else if (this.currentCue) {\n            // Clear caption when no active cues (video players only)\n            if (!isAudioPlayer) {\n                this.element.innerHTML = '';\n                this.element.style.display = 'none';\n            }\n            this.currentCue = null;\n        }\n    }\n    \n    positionCaptionsOnMobile() {\n        if (!this.element || this.element.style.display === 'none') {\n            return;\n        }\n        \n        const isFullscreen = this.player.state?.fullscreen || false;\n        const mobile = isMobile();\n        \n        if (!mobile && !isFullscreen) {\n            // Reset to CSS defaults on desktop\n            this.element.style.bottom = '';\n            return;\n        }\n        \n        const controls = this.player.controlBar?.element;\n        if (!controls) {\n            return;\n        }\n        \n        // Use requestAnimationFrame to ensure layout is complete\n        requestAnimationFrame(() => {\n            if (!this.element || this.element.style.display === 'none') {\n                return;\n            }\n            \n            const controlsRect = controls.getBoundingClientRect();\n            const wrapperRect = this.player.videoWrapper.getBoundingClientRect();\n            const bottomOffset = wrapperRect.bottom - controlsRect.top + 16;\n            \n            this.element.style.bottom = `${bottomOffset}px`;\n            \n            if (this.player.options.debug) {\n                console.log('[VidPly] Caption position:', {\n                    mobile,\n                    isFullscreen,\n                    controlsHeight: controlsRect.height,\n                    bottomOffset: `${bottomOffset}px`\n                });\n            }\n        });\n    }\n\n    parseVTTFormatting(text) {\n        // Basic VTT tag support\n        text = text.replace(/<c[^>]*>(.*?)<\\/c>/g, '<span class=\"caption-class\">$1</span>');\n        text = text.replace(/<b>(.*?)<\\/b>/g, '<strong>$1</strong>');\n        text = text.replace(/<i>(.*?)<\\/i>/g, '<em>$1</em>');\n        text = text.replace(/<u>(.*?)<\\/u>/g, '<u>$1</u>');\n\n        // Voice tags\n        text = text.replace(/<v\\s+([^>]+)>(.*?)<\\/v>/g, '<span class=\"caption-voice\" data-voice=\"$1\">$2</span>');\n\n        return text;\n    }\n\n    updateStyles() {\n        if (!this.element) return;\n\n        const options = this.player.options;\n\n        this.element.style.fontSize = options.captionsFontSize;\n        this.element.style.fontFamily = options.captionsFontFamily;\n        this.element.style.color = options.captionsColor;\n        this.element.style.backgroundColor = this.hexToRgba(\n            options.captionsBackgroundColor,\n            options.captionsOpacity\n        );\n    }\n\n    hexToRgba(hex, alpha) {\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n        if (result) {\n            return `rgba(${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}, ${alpha})`;\n        }\n        return hex;\n    }\n\n    setCaptionStyle(property, value) {\n        switch (property) {\n            case 'fontSize':\n                this.player.options.captionsFontSize = value;\n                break;\n            case 'fontFamily':\n                this.player.options.captionsFontFamily = value;\n                break;\n            case 'color':\n                this.player.options.captionsColor = value;\n                break;\n            case 'backgroundColor':\n                this.player.options.captionsBackgroundColor = value;\n                break;\n            case 'opacity':\n                this.player.options.captionsOpacity = value;\n                break;\n        }\n\n        this.updateStyles();\n        this.saveCaptionPreferences();\n        this.player.emit('captionschange');\n    }\n\n    getAvailableTracks() {\n        return this.tracks.map((t, index) => ({\n            index,\n            language: t.language,\n            label: t.label || t.language,\n            kind: t.kind\n        }));\n    }\n\n    switchTrack(trackIndex) {\n        if (trackIndex >= 0 && trackIndex < this.tracks.length) {\n            this.disable();\n            this.enable(trackIndex);\n        }\n    }\n\n    destroy() {\n        this.disable();\n\n        if (this.element && this.element.parentNode) {\n            this.element.parentNode.removeChild(this.element);\n        }\n    }\n}\n\n", "/**\r\n * Keyboard Accessibility Manager\r\n */\r\n\r\nexport class KeyboardManager {\r\n  constructor(player) {\r\n    this.player = player;\r\n    this.shortcuts = player.options.keyboardShortcuts;\r\n    \r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    this.attachEvents();\r\n  }\r\n\r\n  attachEvents() {\r\n    // Listen for keyboard events on the player container using CAPTURE phase\r\n    // This ensures we intercept events before they reach child elements\r\n    this.player.container.addEventListener('keydown', (e) => {\r\n      this.handleKeydown(e);\r\n    }, true); // Use capture phase\r\n\r\n    // Make player container focusable\r\n    if (!this.player.container.hasAttribute('tabindex')) {\r\n      this.player.container.setAttribute('tabindex', '0');\r\n    }\r\n  }\r\n\r\n  handleKeydown(e) {\r\n    // Don't handle if target is an input element\r\n    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {\r\n      return;\r\n    }\r\n    \r\n    // Don't handle if focus is inside a menu (let menu handle its own keyboard navigation)\r\n    const activeElement = document.activeElement;\r\n    if (activeElement) {\r\n      const menu = activeElement.closest('.vidply-menu, [role=\"menu\"]');\r\n      if (menu) {\r\n        return; // Let the menu handle keyboard events\r\n      }\r\n      \r\n        // Don't handle if focus is on a playlist button (let playlist handle navigation)\r\n        const playlistButton = activeElement.closest('.vidply-playlist-item-button');\r\n        if (playlistButton) {\r\n          return; // Let the playlist handle keyboard events\r\n        }\r\n\r\n      // Don't steal arrow keys when the sign-language overlay is in keyboard drag/resize mode.\r\n      // DraggableResizable listens on the overlay itself, but we run in CAPTURE phase, so we must opt out here.\r\n      const signWrapper = activeElement.closest('.vidply-sign-language-wrapper');\r\n      if (signWrapper) {\r\n        const draggable = this.player.signLanguageManager?.draggable;\r\n        if (draggable?.keyboardDragMode || draggable?.keyboardResizeMode) {\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Same idea for the transcript floating window (it also uses DraggableResizable).\r\n      const transcriptWindow = activeElement.closest('.vidply-transcript-window');\r\n      if (transcriptWindow) {\r\n        const draggable = this.player.transcriptManager?.draggableResizable;\r\n        if (draggable?.keyboardDragMode || draggable?.keyboardResizeMode) {\r\n          return;\r\n        }\r\n      }\r\n    }\r\n\r\n    const key = e.key;\r\n    let handled = false;\r\n\r\n    // Special handling for ESC key - exit fullscreen (especially for iOS pseudo-fullscreen)\r\n    if (key === 'Escape' && this.player.state.fullscreen) {\r\n      this.player.exitFullscreen();\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      return;\r\n    }\r\n\r\n    // Check each shortcut category\r\n    for (const [action, keys] of Object.entries(this.shortcuts)) {\r\n      if (keys.includes(key)) {\r\n        handled = this.executeAction(action, e);\r\n        if (handled) {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          this.announceAction(action);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Log unhandled keys for debugging (in development)\r\n    if (!handled && this.player.options.debug) {\r\n      console.log('[VidPly] Unhandled key:', e.key, 'code:', e.code, 'shiftKey:', e.shiftKey);\r\n    }\r\n  }\r\n\r\n  executeAction(action, event) {\r\n    switch (action) {\r\n      case 'play-pause':\r\n        this.player.toggle();\r\n        return true;\r\n\r\n      case 'volume-up':\r\n        this.player.setVolume(Math.min(1, this.player.state.volume + 0.1));\r\n        return true;\r\n\r\n      case 'volume-down':\r\n        this.player.setVolume(Math.max(0, this.player.state.volume - 0.1));\r\n        return true;\r\n\r\n      case 'seek-forward':\r\n        this.player.seekForward();\r\n        return true;\r\n\r\n      case 'seek-backward':\r\n        this.player.seekBackward();\r\n        return true;\r\n\r\n      case 'mute':\r\n        this.player.toggleMute();\r\n        return true;\r\n\r\n      case 'fullscreen':\r\n        this.player.toggleFullscreen();\r\n        return true;\r\n\r\n      case 'captions':\r\n        // If only one caption track, toggle on/off\r\n        // If multiple tracks, open caption menu\r\n        if (this.player.captionManager && this.player.captionManager.tracks.length > 1) {\r\n          // Get captions button from control bar\r\n          const captionsButton = this.player.controlBar && this.player.controlBar.controls.captions;\r\n          if (captionsButton) {\r\n            this.player.controlBar.showCaptionsMenu(captionsButton);\r\n          } else {\r\n            // Fallback to toggle if button doesn't exist\r\n            this.player.toggleCaptions();\r\n          }\r\n        } else {\r\n          this.player.toggleCaptions();\r\n        }\r\n        return true;\r\n\r\n      case 'caption-style-menu':\r\n        // Open caption style menu\r\n        if (this.player.controlBar && this.player.controlBar.controls.captionStyle) {\r\n          this.player.controlBar.showCaptionStyleMenu(this.player.controlBar.controls.captionStyle);\r\n          return true;\r\n        }\r\n        return false;\r\n\r\n      case 'speed-up':\r\n        this.player.setPlaybackSpeed(\r\n          Math.min(2, this.player.state.playbackSpeed + 0.25)\r\n        );\r\n        return true;\r\n\r\n      case 'speed-down':\r\n        this.player.setPlaybackSpeed(\r\n          Math.max(0.25, this.player.state.playbackSpeed - 0.25)\r\n        );\r\n        return true;\r\n\r\n      case 'speed-menu':\r\n        // Open speed menu\r\n        if (this.player.controlBar && this.player.controlBar.controls.speed) {\r\n          this.player.controlBar.showSpeedMenu(this.player.controlBar.controls.speed);\r\n          return true;\r\n        }\r\n        return false;\r\n\r\n      case 'quality-menu':\r\n        // Open quality menu\r\n        if (this.player.controlBar && this.player.controlBar.controls.quality) {\r\n          this.player.controlBar.showQualityMenu(this.player.controlBar.controls.quality);\r\n          return true;\r\n        }\r\n        return false;\r\n\r\n      case 'chapters-menu':\r\n        // Open chapters menu\r\n        if (this.player.controlBar && this.player.controlBar.controls.chapters) {\r\n          this.player.controlBar.showChaptersMenu(this.player.controlBar.controls.chapters);\r\n          return true;\r\n        }\r\n        return false;\r\n\r\n      case 'transcript-toggle':\r\n        // Toggle transcript\r\n        if (this.player.transcriptManager) {\r\n          this.player.transcriptManager.toggleTranscript();\r\n          return true;\r\n        }\r\n        return false;\r\n\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  announceAction(action) {\r\n    if (!this.player.options.screenReaderAnnouncements) return;\r\n\r\n    let message = '';\r\n\r\n    switch (action) {\r\n      case 'play-pause':\r\n        message = this.player.state.playing ? 'Playing' : 'Paused';\r\n        break;\r\n      case 'volume-up':\r\n        message = `Volume ${Math.round(this.player.state.volume * 100)}%`;\r\n        break;\r\n      case 'volume-down':\r\n        message = `Volume ${Math.round(this.player.state.volume * 100)}%`;\r\n        break;\r\n      case 'mute':\r\n        message = this.player.state.muted ? 'Muted' : 'Unmuted';\r\n        break;\r\n      case 'fullscreen':\r\n        message = this.player.state.fullscreen ? 'Fullscreen' : 'Exit fullscreen';\r\n        break;\r\n      case 'captions':\r\n        message = this.player.state.captionsEnabled ? 'Captions on' : 'Captions off';\r\n        break;\r\n      case 'speed-up':\r\n      case 'speed-down':\r\n        message = `Speed ${this.player.state.playbackSpeed}x`;\r\n        break;\r\n    }\r\n\r\n    if (message) {\r\n      this.announce(message);\r\n    }\r\n  }\r\n\r\n  announce(message, priority = 'polite') {\r\n    // Create or get announcement element\r\n    let announcer = document.getElementById('vidply-announcer');\r\n    \r\n    if (!announcer) {\r\n      announcer = document.createElement('div');\r\n      announcer.id = 'vidply-announcer';\r\n      announcer.className = 'vidply-sr-only';\r\n      announcer.setAttribute('aria-live', priority);\r\n      announcer.setAttribute('aria-atomic', 'true');\r\n      announcer.style.cssText = `\r\n        position: absolute;\r\n        left: -10000px;\r\n        width: 1px;\r\n        height: 1px;\r\n        overflow: hidden;\r\n      `;\r\n      document.body.appendChild(announcer);\r\n    }\r\n\r\n    // Clear and set new message\r\n    announcer.textContent = '';\r\n    setTimeout(() => {\r\n      announcer.textContent = message;\r\n    }, 100);\r\n  }\r\n\r\n  updateShortcut(action, keys) {\r\n    if (Array.isArray(keys)) {\r\n      this.shortcuts[action] = keys;\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    // Event listeners are automatically removed when the container is destroyed\r\n  }\r\n}\r\n\r\n", "/**\r\n * Audio Description Manager\r\n * Handles audio-described video source switching and caption track swapping\r\n */\r\n\r\nimport { CaptionManager } from '../controls/CaptionManager.js';\r\n\r\nexport class AudioDescriptionManager {\r\n    constructor(player) {\r\n        this.player = player;\r\n        \r\n        // State\r\n        this.enabled = false;\r\n        this.desiredState = false;\r\n        \r\n        // Sources\r\n        this.src = player.options.audioDescriptionSrc;\r\n        this.sourceElement = null;\r\n        this.originalSource = null;\r\n        this.captionTracks = [];\r\n    }\r\n\r\n    /**\r\n     * Initialize audio description from source elements\r\n     * Called during player initialization\r\n     */\r\n    initFromSourceElements(sourceElements, trackElements) {\r\n        // Check for source elements with audio description attributes\r\n        for (const sourceEl of sourceElements) {\r\n            const descSrc = sourceEl.getAttribute('data-desc-src');\r\n            const origSrc = sourceEl.getAttribute('data-orig-src');\r\n            \r\n            if (descSrc || origSrc) {\r\n                if (!this.sourceElement) {\r\n                    this.sourceElement = sourceEl;\r\n                }\r\n                \r\n                if (origSrc) {\r\n                    if (!this.originalSource) {\r\n                        this.originalSource = origSrc;\r\n                    }\r\n                    if (!this.player.originalSrc) {\r\n                        this.player.originalSrc = origSrc;\r\n                    }\r\n                } else {\r\n                    const currentSrcAttr = sourceEl.getAttribute('src');\r\n                    if (!this.originalSource && currentSrcAttr) {\r\n                        this.originalSource = currentSrcAttr;\r\n                    }\r\n                    if (!this.player.originalSrc && currentSrcAttr) {\r\n                        this.player.originalSrc = currentSrcAttr;\r\n                    }\r\n                }\r\n                \r\n                if (descSrc && !this.src) {\r\n                    this.src = descSrc;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Check for text tracks with audio description versions\r\n        trackElements.forEach(trackEl => {\r\n            const trackKind = trackEl.getAttribute('kind');\r\n            const trackDescSrc = trackEl.getAttribute('data-desc-src');\r\n            \r\n            if ((trackKind === 'captions' || trackKind === 'subtitles' || \r\n                 trackKind === 'chapters' || trackKind === 'descriptions') && trackDescSrc) {\r\n                this.captionTracks.push({\r\n                    trackElement: trackEl,\r\n                    originalSrc: trackEl.getAttribute('src'),\r\n                    describedSrc: trackDescSrc,\r\n                    originalTrackSrc: trackEl.getAttribute('data-orig-src') || trackEl.getAttribute('src'),\r\n                    explicit: true\r\n                });\r\n                this.player.log(`Found explicit described ${trackKind} track: ${trackEl.getAttribute('src')} -> ${trackDescSrc}`);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Check if audio description is available\r\n     */\r\n    isAvailable() {\r\n        const hasSourceElementsWithDesc = this.player.sourceElements.some(\r\n            el => el.getAttribute('data-desc-src')\r\n        );\r\n        return !!(this.src || hasSourceElementsWithDesc || this.captionTracks.length > 0);\r\n    }\r\n\r\n    /**\r\n     * Enable audio description\r\n     */\r\n    async enable() {\r\n        const hasSourceElementsWithDesc = this.player.sourceElements.some(\r\n            el => el.getAttribute('data-desc-src')\r\n        );\r\n        const hasTracksWithDesc = this.captionTracks.length > 0;\r\n        \r\n        if (!this.src && !hasSourceElementsWithDesc && !hasTracksWithDesc) {\r\n            console.warn('VidPly: No audio description source, source elements, or tracks provided');\r\n            return;\r\n        }\r\n\r\n        this.desiredState = true;\r\n\r\n        // Store current state for restoration\r\n        const currentTime = this.player.state.currentTime;\r\n        const wasPlaying = this.player.state.playing;\r\n        const posterValue = this.player.element.poster || \r\n                           this.player.element.getAttribute('poster') || \r\n                           this.player.options.poster;\r\n        const shouldKeepPoster = currentTime < 0.1 && !wasPlaying;\r\n\r\n        // Get current caption text for synchronization\r\n        const currentCaptionText = this._getCurrentCaptionText();\r\n\r\n        // Switch to audio-described version\r\n        if (this.sourceElement) {\r\n            await this._enableWithSourceElement(currentTime, wasPlaying, posterValue, shouldKeepPoster, currentCaptionText);\r\n        } else {\r\n            await this._enableWithDirectSrc(currentTime, wasPlaying, posterValue, shouldKeepPoster);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Disable audio description\r\n     */\r\n    async disable() {\r\n        if (!this.player.originalSrc) {\r\n            return;\r\n        }\r\n\r\n        this.desiredState = false;\r\n\r\n        // Store current state\r\n        const currentTime = this.player.state.currentTime;\r\n        const wasPlaying = this.player.state.playing;\r\n        const posterValue = this.player.element.poster || \r\n                           this.player.element.getAttribute('poster') || \r\n                           this.player.options.poster;\r\n        const shouldKeepPoster = currentTime < 0.1 && !wasPlaying;\r\n\r\n        // Get current caption for sync\r\n        const currentCaptionText = this._getCurrentCaptionText();\r\n\r\n        if (this.sourceElement) {\r\n            await this._disableWithSourceElement(currentTime, wasPlaying, posterValue, shouldKeepPoster, currentCaptionText);\r\n        } else {\r\n            await this._disableWithDirectSrc(currentTime, wasPlaying, posterValue);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Toggle audio description\r\n     */\r\n    async toggle() {\r\n        const descriptionTrack = this.player.findTextTrack('descriptions');\r\n        const hasAudioDescriptionSrc = this.isAvailable();\r\n        \r\n        if (descriptionTrack && !hasAudioDescriptionSrc) {\r\n            // Toggle description track playback\r\n            if (descriptionTrack.mode === 'showing') {\r\n                descriptionTrack.mode = 'hidden';\r\n                this.enabled = false;\r\n                this.player.emit('audiodescriptiondisabled');\r\n            } else {\r\n                descriptionTrack.mode = 'showing';\r\n                this.enabled = true;\r\n                this.player.emit('audiodescriptionenabled');\r\n            }\r\n        } else if (descriptionTrack && hasAudioDescriptionSrc) {\r\n            // Toggle both\r\n            if (this.enabled) {\r\n                this.desiredState = false;\r\n                await this.disable();\r\n            } else {\r\n                descriptionTrack.mode = 'showing';\r\n                this.desiredState = true;\r\n                await this.enable();\r\n            }\r\n        } else if (hasAudioDescriptionSrc) {\r\n            // Toggle source\r\n            if (this.enabled) {\r\n                this.desiredState = false;\r\n                await this.disable();\r\n            } else {\r\n                this.desiredState = true;\r\n                await this.enable();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get current caption text for synchronization\r\n     */\r\n    _getCurrentCaptionText() {\r\n        if (this.player.captionManager && \r\n            this.player.captionManager.currentTrack && \r\n            this.player.captionManager.currentCue) {\r\n            return this.player.captionManager.currentCue.text;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Validate that a track URL exists\r\n     */\r\n    async _validateTrackExists(url) {\r\n        try {\r\n            const response = await fetch(url, { method: 'HEAD' });\r\n            return response.ok;\r\n        } catch {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Swap caption tracks to described versions\r\n     */\r\n    async _swapCaptionTracks(toDescribed = true) {\r\n        if (this.captionTracks.length === 0) return [];\r\n        \r\n        const swappedTracks = [];\r\n        \r\n        const validationPromises = this.captionTracks.map(async (trackInfo) => {\r\n            if (trackInfo.trackElement && trackInfo.describedSrc) {\r\n                if (trackInfo.explicit === true) {\r\n                    try {\r\n                        const exists = await this._validateTrackExists(\r\n                            toDescribed ? trackInfo.describedSrc : trackInfo.originalSrc\r\n                        );\r\n                        return { trackInfo, exists };\r\n                    } catch {\r\n                        return { trackInfo, exists: false };\r\n                    }\r\n                }\r\n            }\r\n            return { trackInfo, exists: false };\r\n        });\r\n        \r\n        const validationResults = await Promise.all(validationPromises);\r\n        const tracksToSwap = validationResults.filter(result => result.exists);\r\n        \r\n        if (tracksToSwap.length > 0) {\r\n            // Store track modes before removing\r\n            const trackModes = new Map();\r\n            tracksToSwap.forEach(({ trackInfo }) => {\r\n                const textTrack = trackInfo.trackElement.track;\r\n                if (textTrack) {\r\n                    trackModes.set(trackInfo, {\r\n                        wasShowing: textTrack.mode === 'showing',\r\n                        wasHidden: textTrack.mode === 'hidden'\r\n                    });\r\n                } else {\r\n                    trackModes.set(trackInfo, { wasShowing: false, wasHidden: false });\r\n                }\r\n            });\r\n            \r\n            // Store track info and remove\r\n            const tracksToReadd = tracksToSwap.map(({ trackInfo }) => {\r\n                const attributes = {};\r\n                Array.from(trackInfo.trackElement.attributes).forEach(attr => {\r\n                    attributes[attr.name] = attr.value;\r\n                });\r\n                \r\n                const result = {\r\n                    trackInfo,\r\n                    oldSrc: trackInfo.trackElement.getAttribute('src'),\r\n                    parent: trackInfo.trackElement.parentNode,\r\n                    nextSibling: trackInfo.trackElement.nextSibling,\r\n                    attributes\r\n                };\r\n                \r\n                trackInfo.trackElement.remove();\r\n                return result;\r\n            });\r\n            \r\n            // Force browser to process removal\r\n            this.player.element.load();\r\n            \r\n            // Re-add tracks with new src\r\n            await new Promise(resolve => {\r\n                setTimeout(() => {\r\n                    tracksToReadd.forEach(({ trackInfo, parent, nextSibling, attributes }) => {\r\n                        swappedTracks.push(trackInfo);\r\n                        \r\n                        const newTrackElement = document.createElement('track');\r\n                        const newSrc = toDescribed ? trackInfo.describedSrc : trackInfo.originalSrc;\r\n                        newTrackElement.setAttribute('src', newSrc);\r\n                        \r\n                        Object.keys(attributes).forEach(attrName => {\r\n                            if (attrName !== 'src' && attrName !== 'data-desc-src') {\r\n                                newTrackElement.setAttribute(attrName, attributes[attrName]);\r\n                            }\r\n                        });\r\n                        \r\n                        // Use the player's video element as parent if the original parent is null\r\n                        const targetParent = parent || this.player.element;\r\n                        \r\n                        if (nextSibling && nextSibling.parentNode) {\r\n                            targetParent.insertBefore(newTrackElement, nextSibling);\r\n                        } else {\r\n                            targetParent.appendChild(newTrackElement);\r\n                        }\r\n                        \r\n                        trackInfo.trackElement = newTrackElement;\r\n                    });\r\n                    \r\n                    this.player.invalidateTrackCache();\r\n                    \r\n                    // Setup new tracks\r\n                    const setupNewTracks = () => {\r\n                        this.player.setManagedTimeout(() => {\r\n                            swappedTracks.forEach((trackInfo) => {\r\n                                const newTextTrack = trackInfo.trackElement.track;\r\n                                if (newTextTrack) {\r\n                                    const modeInfo = trackModes.get(trackInfo) || { wasShowing: false, wasHidden: false };\r\n                                    newTextTrack.mode = 'hidden';\r\n                                    \r\n                                    const restoreMode = () => {\r\n                                        if (modeInfo.wasShowing || modeInfo.wasHidden) {\r\n                                            newTextTrack.mode = 'hidden';\r\n                                        } else {\r\n                                            newTextTrack.mode = 'disabled';\r\n                                        }\r\n                                    };\r\n                                    \r\n                                    if (newTextTrack.readyState >= 2) {\r\n                                        restoreMode();\r\n                                    } else {\r\n                                        newTextTrack.addEventListener('load', restoreMode, { once: true });\r\n                                        newTextTrack.addEventListener('error', restoreMode, { once: true });\r\n                                    }\r\n                                }\r\n                            });\r\n                        }, 300);\r\n                    };\r\n                    \r\n                    if (this.player.element.readyState >= 1) {\r\n                        setTimeout(setupNewTracks, 200);\r\n                    } else {\r\n                        this.player.element.addEventListener('loadedmetadata', setupNewTracks, { once: true });\r\n                        setTimeout(setupNewTracks, 2000);\r\n                    }\r\n                    \r\n                    resolve();\r\n                }, 100);\r\n            });\r\n        }\r\n        \r\n        return swappedTracks;\r\n    }\r\n\r\n    /**\r\n     * Update source elements to described versions\r\n     */\r\n    _updateSourceElements(toDescribed = true) {\r\n        const sourceElements = this.player.sourceElements;\r\n        const sourcesToUpdate = [];\r\n        \r\n        sourceElements.forEach((sourceEl) => {\r\n            const descSrcAttr = sourceEl.getAttribute('data-desc-src');\r\n            const currentSrc = sourceEl.getAttribute('src');\r\n            \r\n            if (descSrcAttr) {\r\n                const type = sourceEl.getAttribute('type');\r\n                let origSrc = sourceEl.getAttribute('data-orig-src') || currentSrc;\r\n                \r\n                sourcesToUpdate.push({\r\n                    src: toDescribed ? descSrcAttr : origSrc,\r\n                    type,\r\n                    origSrc,\r\n                    descSrc: descSrcAttr\r\n                });\r\n            } else {\r\n                sourcesToUpdate.push({\r\n                    src: sourceEl.getAttribute('src'),\r\n                    type: sourceEl.getAttribute('type'),\r\n                    origSrc: null,\r\n                    descSrc: null\r\n                });\r\n            }\r\n        });\r\n        \r\n        // Remove src attribute if present\r\n        if (this.player.element.hasAttribute('src')) {\r\n            this.player.element.removeAttribute('src');\r\n        }\r\n        \r\n        // Remove all source elements\r\n        sourceElements.forEach(sourceEl => sourceEl.remove());\r\n        \r\n        // Re-add with updated src\r\n        sourcesToUpdate.forEach(sourceInfo => {\r\n            const newSource = document.createElement('source');\r\n            newSource.setAttribute('src', sourceInfo.src);\r\n            if (sourceInfo.type) {\r\n                newSource.setAttribute('type', sourceInfo.type);\r\n            }\r\n            if (sourceInfo.origSrc) {\r\n                newSource.setAttribute('data-orig-src', sourceInfo.origSrc);\r\n            }\r\n            if (sourceInfo.descSrc) {\r\n                newSource.setAttribute('data-desc-src', sourceInfo.descSrc);\r\n            }\r\n            \r\n            const firstTrack = this.player.element.querySelector('track');\r\n            if (firstTrack) {\r\n                this.player.element.insertBefore(newSource, firstTrack);\r\n            } else {\r\n                this.player.element.appendChild(newSource);\r\n            }\r\n        });\r\n        \r\n        this.player._sourceElementsDirty = true;\r\n        this.player._sourceElementsCache = null;\r\n    }\r\n\r\n    /**\r\n     * Wait for media to be ready\r\n     */\r\n    async _waitForMediaReady(needSeek = false) {\r\n        // Wait for metadata\r\n        await new Promise((resolve) => {\r\n            if (this.player.element.readyState >= 1) {\r\n                resolve();\r\n            } else {\r\n                const onLoad = () => {\r\n                    this.player.element.removeEventListener('loadedmetadata', onLoad);\r\n                    resolve();\r\n                };\r\n                this.player.element.addEventListener('loadedmetadata', onLoad);\r\n            }\r\n        });\r\n        \r\n        // Wait for tracks\r\n        await new Promise(resolve => setTimeout(resolve, 300));\r\n        \r\n        // Wait for playback if needed\r\n        if (needSeek) {\r\n            await new Promise((resolve) => {\r\n                if (this.player.element.readyState >= 3) {\r\n                    resolve();\r\n                } else {\r\n                    const onCanPlay = () => {\r\n                        this.player.element.removeEventListener('canplay', onCanPlay);\r\n                        this.player.element.removeEventListener('canplaythrough', onCanPlay);\r\n                        resolve();\r\n                    };\r\n                    this.player.element.addEventListener('canplay', onCanPlay, { once: true });\r\n                    this.player.element.addEventListener('canplaythrough', onCanPlay, { once: true });\r\n                    setTimeout(() => {\r\n                        this.player.element.removeEventListener('canplay', onCanPlay);\r\n                        this.player.element.removeEventListener('canplaythrough', onCanPlay);\r\n                        resolve();\r\n                    }, 3000);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Restore playback state after source change\r\n     */\r\n    async _restorePlaybackState(currentTime, wasPlaying, shouldKeepPoster, currentCaptionText) {\r\n        // Try to find matching caption for sync\r\n        let syncTime = currentTime;\r\n        if (currentCaptionText && this.player.captionManager && this.player.captionManager.tracks.length > 0) {\r\n            await new Promise(resolve => setTimeout(resolve, 500));\r\n            const matchingTime = this.player.findMatchingCaptionTime(\r\n                currentCaptionText, \r\n                this.player.captionManager.tracks\r\n            );\r\n            if (matchingTime !== null) {\r\n                syncTime = matchingTime;\r\n                if (this.player.options.debug) {\r\n                    this.player.log(`[VidPly] Syncing via caption: ${currentTime}s -> ${syncTime}s`);\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Seek\r\n        if (syncTime > 0) {\r\n            this.player.seek(syncTime);\r\n            await new Promise(resolve => setTimeout(resolve, 100));\r\n        }\r\n        \r\n        // Play/pause\r\n        if (wasPlaying) {\r\n            await this.player.play();\r\n            this.player.setManagedTimeout(() => {\r\n                this.player.hidePosterOverlay();\r\n            }, 100);\r\n        } else {\r\n            this.player.pause();\r\n            if (!shouldKeepPoster) {\r\n                this.player.hidePosterOverlay();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Enable with source element method\r\n     */\r\n    async _enableWithSourceElement(currentTime, wasPlaying, posterValue, shouldKeepPoster, currentCaptionText) {\r\n        // Swap caption tracks\r\n        await this._swapCaptionTracks(true);\r\n        \r\n        // Update source elements\r\n        this._updateSourceElements(true);\r\n        \r\n        // Preserve poster\r\n        if (posterValue && this.player.element.tagName === 'VIDEO') {\r\n            this.player.element.poster = posterValue;\r\n        }\r\n        \r\n        // Reload\r\n        this.player.element.load();\r\n        \r\n        // Wait for ready\r\n        await this._waitForMediaReady(currentTime > 0 || wasPlaying);\r\n        \r\n        // Restore playback\r\n        await this._restorePlaybackState(currentTime, wasPlaying, shouldKeepPoster, currentCaptionText);\r\n        \r\n        // Update state\r\n        if (!this.desiredState) return;\r\n        this.enabled = true;\r\n        this.player.state.audioDescriptionEnabled = true;\r\n        this.player.emit('audiodescriptionenabled');\r\n        \r\n        // Reload transcript if visible\r\n        this._reloadTranscript();\r\n    }\r\n\r\n    /**\r\n     * Enable with direct src method\r\n     */\r\n    async _enableWithDirectSrc(currentTime, wasPlaying, posterValue, shouldKeepPoster) {\r\n        // Swap caption tracks\r\n        await this._swapCaptionTracks(true);\r\n        \r\n        // Set poster\r\n        if (posterValue && this.player.element.tagName === 'VIDEO') {\r\n            this.player.element.poster = posterValue;\r\n        }\r\n        \r\n        // Set src\r\n        this.player.element.src = this.src;\r\n        \r\n        // Wait and restore\r\n        await this._waitForMediaReady(currentTime > 0 || wasPlaying);\r\n        \r\n        if (currentTime > 0) {\r\n            this.player.seek(currentTime);\r\n            await new Promise(resolve => setTimeout(resolve, 100));\r\n        }\r\n        \r\n        if (wasPlaying) {\r\n            await this.player.play();\r\n        } else {\r\n            this.player.pause();\r\n            if (!shouldKeepPoster) {\r\n                this.player.hidePosterOverlay();\r\n            }\r\n        }\r\n        \r\n        if (!this.desiredState) return;\r\n        this.enabled = true;\r\n        this.player.state.audioDescriptionEnabled = true;\r\n        this.player.emit('audiodescriptionenabled');\r\n        \r\n        // Reload transcript if visible\r\n        this._reloadTranscript();\r\n    }\r\n\r\n    /**\r\n     * Disable with source element method\r\n     */\r\n    async _disableWithSourceElement(currentTime, wasPlaying, posterValue, shouldKeepPoster, currentCaptionText) {\r\n        // Swap caption tracks back\r\n        await this._swapCaptionTracks(false);\r\n        \r\n        // Update source elements\r\n        this._updateSourceElements(false);\r\n        \r\n        // Preserve poster\r\n        if (posterValue && this.player.element.tagName === 'VIDEO') {\r\n            this.player.element.poster = posterValue;\r\n        }\r\n        \r\n        // Reload\r\n        this.player.element.load();\r\n        this.player.invalidateTrackCache();\r\n        \r\n        // Wait for ready\r\n        await this._waitForMediaReady(currentTime > 0 || wasPlaying);\r\n        \r\n        // Restore playback\r\n        await this._restorePlaybackState(currentTime, wasPlaying, shouldKeepPoster, currentCaptionText);\r\n        \r\n        // Reinitialize caption manager\r\n        if (this.player.captionManager) {\r\n            this.player.captionManager.destroy();\r\n            this.player.captionManager = new CaptionManager(this.player);\r\n        }\r\n        \r\n        // Update state\r\n        if (this.desiredState) return;\r\n        this.enabled = false;\r\n        this.player.state.audioDescriptionEnabled = false;\r\n        this.player.emit('audiodescriptiondisabled');\r\n        \r\n        // Reload transcript if visible\r\n        this._reloadTranscript();\r\n    }\r\n\r\n    /**\r\n     * Disable with direct src method\r\n     */\r\n    async _disableWithDirectSrc(currentTime, wasPlaying, posterValue) {\r\n        // Swap caption tracks back\r\n        await this._swapCaptionTracks(false);\r\n        \r\n        // Set poster\r\n        if (posterValue && this.player.element.tagName === 'VIDEO') {\r\n            this.player.element.poster = posterValue;\r\n        }\r\n        \r\n        // Restore original src\r\n        const originalSrcToUse = this.originalSource || this.player.originalSrc;\r\n        this.player.element.src = originalSrcToUse;\r\n        this.player.element.load();\r\n        \r\n        // Wait and restore\r\n        await this._waitForMediaReady(currentTime > 0 || wasPlaying);\r\n        \r\n        if (currentTime > 0) {\r\n            this.player.seek(currentTime);\r\n        }\r\n        \r\n        if (wasPlaying) {\r\n            await this.player.play();\r\n        }\r\n        \r\n        if (this.desiredState) return;\r\n        this.enabled = false;\r\n        this.player.state.audioDescriptionEnabled = false;\r\n        this.player.emit('audiodescriptiondisabled');\r\n        \r\n        // Reload transcript if visible\r\n        this._reloadTranscript();\r\n    }\r\n\r\n    /**\r\n     * Reload transcript after audio description state change\r\n     */\r\n    _reloadTranscript() {\r\n        if (this.player.transcriptManager && this.player.transcriptManager.isVisible) {\r\n            // Wait for tracks to load after source swap\r\n            this.player.setManagedTimeout(() => {\r\n                if (this.player.transcriptManager && this.player.transcriptManager.loadTranscriptData) {\r\n                    this.player.transcriptManager.loadTranscriptData();\r\n                }\r\n            }, 800);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update sources (called when playlist changes)\r\n     */\r\n    updateSources(audioDescriptionSrc) {\r\n        this.src = audioDescriptionSrc || null;\r\n        // Reset state for new playlist item\r\n        this.enabled = false;\r\n        this.desiredState = false;\r\n        this.sourceElement = null;\r\n        this.originalSource = null;\r\n        this.captionTracks = [];\r\n    }\r\n    \r\n    /**\r\n     * Reinitialize from current player elements (called after playlist loads new tracks)\r\n     */\r\n    reinitialize() {\r\n        this.player.invalidateTrackCache();\r\n        this.initFromSourceElements(this.player.sourceElements, this.player.trackElements);\r\n    }\r\n\r\n    /**\r\n     * Cleanup\r\n     */\r\n    destroy() {\r\n        this.enabled = false;\r\n        this.desiredState = false;\r\n        this.captionTracks = [];\r\n        this.sourceElement = null;\r\n        this.originalSource = null;\r\n    }\r\n}\r\n\r\n", "/**\n * Sign Language Video Manager\n * Handles picture-in-picture sign language video overlay\n */\n\nimport { DOMUtils } from '../utils/DOMUtils.js';\nimport { createIconElement } from '../icons/Icons.js';\nimport { i18n } from '../i18n/i18n.js';\nimport { DraggableResizable } from '../utils/DraggableResizable.js';\nimport { createMenuItem, attachMenuKeyboardNavigation, focusFirstMenuItem } from '../utils/MenuUtils.js';\nimport { createLabeledSelect, preventDragOnElement } from '../utils/FormUtils.js';\n\nexport class SignLanguageManager {\n    constructor(player) {\n        this.player = player;\n        \n        // Sources\n        this.src = player.options.signLanguageSrc;\n        this.sources = player.options.signLanguageSources || {};\n        this.currentLanguage = null;\n        this.desiredPosition = player.options.signLanguagePosition || 'bottom-right';\n        \n        // DOM elements\n        this.wrapper = null;\n        this.header = null;\n        this.video = null;\n        this.selector = null;\n        this.settingsButton = null;\n        this.settingsMenu = null;\n        this.resizeHandles = [];\n        \n        // State\n        this.enabled = false;\n        this.inMainView = false; // sign language shown in main video (src swap, like audio description)\n        this.mainViewOriginalSrc = null;\n        this.mainViewOriginalSources = null;\n        this._mainViewUsingSourceSwap = false;\n        this._mainViewMutedBefore = false;\n        this.settingsMenuVisible = false;\n        this.settingsMenuJustOpened = false;\n        this.documentClickHandlerAdded = false;\n        \n        // Handlers\n        this.handlers = null;\n        this.settingsHandlers = null;\n        this.interactionHandlers = null;\n        this.draggable = null;\n        this.documentClickHandler = null;\n        this.settingsMenuKeyHandler = null;\n        this.customKeyHandler = null;\n        \n        // Menu option references\n        this.dragOptionButton = null;\n        this.dragOptionText = null;\n        this.resizeOptionButton = null;\n        this.resizeOptionText = null;\n    }\n\n    /**\n     * Check if sign language is available\n     */\n    isAvailable() {\n        return Object.keys(this.sources).length > 0 || !!this.src;\n    }\n\n    /**\n     * Enable sign language video\n     */\n    enable() {\n        const hasMultipleSources = Object.keys(this.sources).length > 0;\n        const hasSingleSource = !!this.src;\n        \n        if (!hasMultipleSources && !hasSingleSource) {\n            console.warn('No sign language video source provided');\n            return;\n        }\n\n        if (this.wrapper) {\n            // Already exists, just show it\n            this.wrapper.style.display = 'block';\n            this.enabled = true;\n            this.player.state.signLanguageEnabled = true;\n            this.player.emit('signlanguageenabled');\n            \n            // Focus settings button\n            this.player.setManagedTimeout(() => {\n                if (this.settingsButton && document.contains(this.settingsButton)) {\n                    this.settingsButton.focus({ preventScroll: true });\n                }\n            }, 150);\n            return;\n        }\n        \n        // Determine initial language\n        let initialLang = null;\n        let initialSrc = null;\n        \n        if (hasMultipleSources) {\n            initialLang = this._determineInitialLanguage();\n            initialSrc = this.sources[initialLang];\n            this.currentLanguage = initialLang;\n        } else {\n            initialSrc = this.src;\n        }\n\n        // Create UI\n        this._createWrapper();\n        this._createHeader(hasMultipleSources, initialLang);\n        this._createVideo(initialSrc);\n        this._createResizeHandles();\n        \n        // Assemble\n        this.wrapper.appendChild(this.header);\n        this.wrapper.appendChild(this.video);\n        this.resizeHandles.forEach(handle => this.wrapper.appendChild(handle));\n        \n        // Set initial size\n        this._applyInitialSize();\n        \n        // Add to container\n        this.player.container.appendChild(this.wrapper);\n        \n        // Position\n        requestAnimationFrame(() => {\n            this.constrainPosition();\n        });\n        \n        // Sync with main video\n        this.video.currentTime = this.player.state.currentTime;\n        if (!this.player.state.paused) {\n            this.video.play();\n        }\n        \n        // Setup interaction\n        this._setupInteraction();\n        \n        // Setup event handlers\n        this._setupEventHandlers(hasMultipleSources);\n        \n        this.enabled = true;\n        this.player.state.signLanguageEnabled = true;\n        this.player.emit('signlanguageenabled');\n        \n        // Focus settings button\n        this.player.setManagedTimeout(() => {\n            if (this.settingsButton && document.contains(this.settingsButton)) {\n                this.settingsButton.focus({ preventScroll: true });\n            }\n        }, 150);\n    }\n\n    /**\n     * Disable sign language video\n     */\n    disable() {\n        if (this.settingsMenuVisible) {\n            this.hideSettingsMenu({ focusButton: false });\n        }\n        \n        if (this.wrapper) {\n            this.wrapper.style.display = 'none';\n        }\n        this.enabled = false;\n        this.player.state.signLanguageEnabled = false;\n        this.player.emit('signlanguagedisabled');\n    }\n\n    /**\n     * Toggle sign language video\n     */\n    toggle() {\n        if (this.enabled) {\n            this.disable();\n        } else {\n            this.enable();\n        }\n    }\n\n    /**\n     * Enable sign language in main view: replace main video src with sign language URL (like audio description).\n     * Same video element, different URL; no overlay.\n     */\n    async enableInMainView() {\n        const hasMultipleSources = Object.keys(this.sources).length > 0;\n        const hasSingleSource = !!this.src;\n        if (!hasMultipleSources && !hasSingleSource) return;\n        if (!this.player.element || this.player.element.tagName !== 'VIDEO') return;\n        if (this.inMainView) return;\n\n        let signSrc;\n        if (hasMultipleSources) {\n            const initialLang = this._determineInitialLanguage();\n            this.currentLanguage = initialLang;\n            signSrc = this.sources[initialLang];\n        } else {\n            signSrc = this.src;\n        }\n\n        const el = this.player.element;\n        const currentTime = this.player.state.currentTime;\n        const wasPlaying = this.player.state.playing;\n        const posterValue = el.poster || el.getAttribute('poster') || this.player.options.poster;\n        const shouldKeepPoster = currentTime < 0.1 && !wasPlaying;\n\n        const sourceElements = Array.from(el.querySelectorAll('source'));\n        const firstSource = sourceElements[0];\n        this.mainViewOriginalSrc = (el.currentSrc && el.currentSrc.length > 0)\n            ? el.currentSrc\n            : (el.src && el.src.length > 0)\n                ? el.src\n                : (firstSource && firstSource.getAttribute('src'))\n                    ? firstSource.getAttribute('src')\n                    : '';\n        this._mainViewMutedBefore = this.player.state.muted;\n\n        if (posterValue && shouldKeepPoster && el.tagName === 'VIDEO') {\n            el.poster = posterValue;\n        }\n        if (sourceElements.length > 0) {\n            this.mainViewOriginalSources = sourceElements;\n            this.mainViewOriginalSources.forEach(source => source.remove());\n            const signSource = document.createElement('source');\n            signSource.setAttribute('src', signSrc);\n            const type = this._inferVideoType(signSrc);\n            if (type) {\n                signSource.setAttribute('type', type);\n            }\n            const trackNode = el.querySelector('track');\n            if (trackNode) {\n                el.insertBefore(signSource, trackNode);\n            } else {\n                el.appendChild(signSource);\n            }\n            this._mainViewUsingSourceSwap = true;\n        } else {\n            el.src = signSrc;\n            this._mainViewUsingSourceSwap = false;\n        }\n        el.muted = true;\n        this.player.currentSource = signSrc;\n        if (typeof this.player.invalidateTrackCache === 'function') {\n            this.player.invalidateTrackCache();\n        }\n        el.load();\n\n        await this._waitForMediaReadyMainView(currentTime > 0 || wasPlaying);\n\n        if (currentTime > 0) {\n            this.player.seek(currentTime);\n            await new Promise(r => setTimeout(r, 100));\n        }\n        if (wasPlaying) {\n            await this.player.play();\n        } else {\n            this.player.pause();\n            if (!shouldKeepPoster && this.player.hidePosterOverlay) {\n                this.player.hidePosterOverlay();\n            }\n        }\n\n        this.inMainView = true;\n        this.player.state.signLanguageInMainView = true;\n        if (this.player.videoWrapper) {\n            this.player.videoWrapper.classList.add('vidply-sign-language-main-view-active');\n        }\n        this.player.emit('signlanguageinmainviewenabled');\n    }\n\n    /**\n     * Disable sign language in main view: restore main video src.\n     */\n    async disableInMainView() {\n        if (!this.inMainView) return;\n        if (!this.mainViewOriginalSrc && !this.mainViewOriginalSources) {\n            this.inMainView = false;\n            this.player.state.signLanguageInMainView = false;\n            if (this.player.videoWrapper) {\n                this.player.videoWrapper.classList.remove('vidply-sign-language-main-view-active');\n            }\n            this.player.emit('signlanguageinmainviewdisabled');\n            return;\n        }\n\n        const el = this.player.element;\n        const currentTime = this.player.state.currentTime;\n        const wasPlaying = this.player.state.playing;\n        const posterValue = el.poster || el.getAttribute('poster') || this.player.options.poster;\n\n        if (this._mainViewUsingSourceSwap && this.mainViewOriginalSources && this.mainViewOriginalSources.length > 0) {\n            Array.from(el.querySelectorAll('source')).forEach(source => source.remove());\n            const trackNode = el.querySelector('track');\n            this.mainViewOriginalSources.forEach(source => {\n                if (trackNode) {\n                    el.insertBefore(source, trackNode);\n                } else {\n                    el.appendChild(source);\n                }\n            });\n            this._mainViewUsingSourceSwap = false;\n        } else if (this.mainViewOriginalSrc) {\n            el.src = this.mainViewOriginalSrc;\n        }\n        el.muted = this._mainViewMutedBefore;\n        this.player.currentSource = this.mainViewOriginalSrc || (el.querySelector('source') && el.querySelector('source').src) || '';\n        if (typeof this.player.invalidateTrackCache === 'function') {\n            this.player.invalidateTrackCache();\n        }\n        el.load();\n\n        await this._waitForMediaReadyMainView(currentTime > 0 || wasPlaying);\n\n        if (currentTime > 0) {\n            this.player.seek(currentTime);\n        }\n        if (wasPlaying) {\n            try {\n                await this.player.play();\n            } catch (e) {\n                this.player.log?.('Sign language main view: play after restore failed', e, 'warn');\n            }\n        }\n\n        this.mainViewOriginalSrc = null;\n        this.mainViewOriginalSources = null;\n        this.inMainView = false;\n        this.player.state.signLanguageInMainView = false;\n        if (this.player.videoWrapper) {\n            this.player.videoWrapper.classList.remove('vidply-sign-language-main-view-active');\n        }\n        this.player.emit('signlanguageinmainviewdisabled');\n    }\n\n    /**\n     * Wait for media ready (like AudioDescriptionManager).\n     */\n    async _waitForMediaReadyMainView(needSeek = false) {\n        const el = this.player.element;\n        const loadedMetaPromise = new Promise((resolve) => {\n            if (el.readyState >= 1) {\n                resolve();\n                return;\n            }\n            const onLoad = () => {\n                el.removeEventListener('loadedmetadata', onLoad);\n                el.removeEventListener('error', onError);\n                resolve();\n            };\n            const onError = () => {\n                el.removeEventListener('loadedmetadata', onLoad);\n                el.removeEventListener('error', onError);\n                resolve();\n            };\n            el.addEventListener('loadedmetadata', onLoad);\n            el.addEventListener('error', onError, { once: true });\n        });\n        const timeoutPromise = new Promise(r => setTimeout(r, 10000));\n        await Promise.race([loadedMetaPromise, timeoutPromise]);\n        await new Promise(r => setTimeout(r, 300));\n        if (needSeek) {\n            await new Promise((resolve) => {\n                if (el.readyState >= 3) resolve();\n                else {\n                    const onCanPlay = () => {\n                        el.removeEventListener('canplay', onCanPlay);\n                        el.removeEventListener('canplaythrough', onCanPlay);\n                        resolve();\n                    };\n                    el.addEventListener('canplay', onCanPlay, { once: true });\n                    el.addEventListener('canplaythrough', onCanPlay, { once: true });\n                    setTimeout(() => {\n                        el.removeEventListener('canplay', onCanPlay);\n                        el.removeEventListener('canplaythrough', onCanPlay);\n                        resolve();\n                    }, 3000);\n                }\n            });\n        }\n    }\n\n    /**\n     * Toggle sign language in main view (src swap, like audio description).\n     */\n    toggleInMainView() {\n        if (this.inMainView) {\n            this.disableInMainView();\n        } else {\n            this.enableInMainView();\n        }\n    }\n\n    /**\n     * Switch to a different sign language\n     */\n    switchLanguage(langCode) {\n        if (!this.sources[langCode]) return;\n\n        this.currentLanguage = langCode;\n\n        if (this.video) {\n            const currentTime = this.video.currentTime;\n            const wasPlaying = !this.video.paused;\n            this.video.src = this.sources[langCode];\n            this.video.currentTime = currentTime;\n            if (wasPlaying) {\n                this.video.play().catch(() => {});\n            }\n        }\n\n        if (this.inMainView && this.player.element && this.player.element.tagName === 'VIDEO') {\n            const currentTime = this.player.state.currentTime;\n            const wasPlaying = this.player.state.playing;\n            if (this._mainViewUsingSourceSwap) {\n                const signSource = this.player.element.querySelector('source');\n                if (signSource) {\n                    signSource.setAttribute('src', this.sources[langCode]);\n                    const type = this._inferVideoType(this.sources[langCode]);\n                    if (type) {\n                        signSource.setAttribute('type', type);\n                    }\n                }\n            } else {\n                this.player.element.src = this.sources[langCode];\n            }\n            this.player.currentSource = this.sources[langCode];\n            if (typeof this.player.invalidateTrackCache === 'function') {\n                this.player.invalidateTrackCache();\n            }\n            this.player.element.load();\n            this._waitForMediaReadyMainView(true).then(() => {\n                if (currentTime > 0) this.player.seek(currentTime);\n                if (wasPlaying) this.player.play();\n            });\n        }\n\n        this.player.emit('signlanguagelanguagechanged', langCode);\n    }\n\n    _inferVideoType(url) {\n        if (!url) return '';\n        const cleanUrl = url.split('?')[0].toLowerCase();\n        if (cleanUrl.endsWith('.mp4')) return 'video/mp4';\n        if (cleanUrl.endsWith('.webm')) return 'video/webm';\n        if (cleanUrl.endsWith('.ogv') || cleanUrl.endsWith('.ogg')) return 'video/ogg';\n        return '';\n    }\n\n    /**\n     * Get language label\n     */\n    getLanguageLabel(langCode) {\n        const langNames = {\n            'en': 'English',\n            'de': 'Deutsch',\n            'es': 'Espaol',\n            'fr': 'Franais',\n            'it': 'Italiano',\n            'ja': '',\n            'pt': 'Portugus',\n            'ar': '',\n            'hi': ''\n        };\n        return langNames[langCode] || langCode.toUpperCase();\n    }\n\n    /**\n     * Determine initial sign language\n     */\n    _determineInitialLanguage() {\n        // Try caption language\n        if (this.player.captionManager && this.player.captionManager.currentTrack) {\n            const captionLang = this.player.captionManager.currentTrack.language?.toLowerCase().split('-')[0];\n            if (captionLang && this.sources[captionLang]) {\n                return captionLang;\n            }\n        }\n        \n        // Try player language\n        if (this.player.options.language) {\n            const playerLang = this.player.options.language.toLowerCase().split('-')[0];\n            if (this.sources[playerLang]) {\n                return playerLang;\n            }\n        }\n        \n        // First available\n        return Object.keys(this.sources)[0];\n    }\n\n    /**\n     * Create wrapper element\n     */\n    _createWrapper() {\n        this.wrapper = document.createElement('div');\n        this.wrapper.className = 'vidply-sign-language-wrapper';\n        this.wrapper.setAttribute('tabindex', '0');\n        this.wrapper.setAttribute('aria-label', i18n.t('player.signLanguageDragResize'));\n    }\n\n    /**\n     * Create header element\n     */\n    _createHeader(hasMultipleSources, initialLang) {\n        const classPrefix = this.player.options.classPrefix;\n        \n        this.header = DOMUtils.createElement('div', {\n            className: `${classPrefix}-sign-language-header`,\n            attributes: { 'tabindex': '0' }\n        });\n\n        const headerLeft = DOMUtils.createElement('div', {\n            className: `${classPrefix}-sign-language-header-left`\n        });\n\n        const title = DOMUtils.createElement('h3', {\n            textContent: i18n.t('player.signLanguageVideo')\n        });\n\n        // Settings button\n        this._createSettingsButton(headerLeft);\n\n        // Language selector\n        if (hasMultipleSources) {\n            this._createLanguageSelector(headerLeft, initialLang);\n        }\n\n        headerLeft.appendChild(title);\n        \n        // Close button\n        const closeButton = this._createCloseButton();\n        \n        this.header.appendChild(headerLeft);\n        this.header.appendChild(closeButton);\n        \n        // Initialize settings menu state\n        this.settingsMenuVisible = false;\n        this.settingsMenu = null;\n        this.settingsMenuJustOpened = false;\n    }\n\n    /**\n     * Create settings button\n     */\n    _createSettingsButton(container) {\n        const classPrefix = this.player.options.classPrefix;\n        const ariaLabel = i18n.t('player.signLanguageSettings');\n        \n        this.settingsButton = DOMUtils.createElement('button', {\n            className: `${classPrefix}-sign-language-settings`,\n            attributes: {\n                'type': 'button',\n                'aria-label': ariaLabel,\n                'aria-expanded': 'false'\n            }\n        });\n        this.settingsButton.appendChild(createIconElement('settings'));\n        DOMUtils.attachTooltip(this.settingsButton, ariaLabel, classPrefix);\n        \n        this.settingsHandlers = {\n            click: (e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                if (this.documentClickHandler) {\n                    this.settingsMenuJustOpened = true;\n                    setTimeout(() => { this.settingsMenuJustOpened = false; }, 100);\n                }\n                if (this.settingsMenuVisible) {\n                    this.hideSettingsMenu();\n                } else {\n                    this.showSettingsMenu();\n                }\n            },\n            keydown: (e) => {\n                if (e.key === 'd' || e.key === 'D') {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    this.toggleKeyboardDragMode();\n                } else if (e.key === 'r' || e.key === 'R') {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    this.toggleResizeMode();\n                } else if (e.key === 'Escape' && this.settingsMenuVisible) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    this.hideSettingsMenu();\n                }\n            }\n        };\n        \n        this.settingsButton.addEventListener('click', this.settingsHandlers.click);\n        this.settingsButton.addEventListener('keydown', this.settingsHandlers.keydown);\n        container.appendChild(this.settingsButton);\n    }\n\n    /**\n     * Create language selector\n     */\n    _createLanguageSelector(container, initialLang) {\n        const classPrefix = this.player.options.classPrefix;\n        const selectId = `${classPrefix}-sign-language-select-${Date.now()}`;\n        \n        const options = Object.keys(this.sources).map(langCode => ({\n            value: langCode,\n            text: this.getLanguageLabel(langCode),\n            selected: langCode === initialLang\n        }));\n        \n        const { label, select } = createLabeledSelect({\n            classPrefix,\n            labelClass: `${classPrefix}-sign-language-label`,\n            selectClass: `${classPrefix}-sign-language-select`,\n            labelText: 'settings.language',\n            selectId,\n            options,\n            onChange: (e) => {\n                e.stopPropagation();\n                this.switchLanguage(e.target.value);\n            }\n        });\n        \n        this.selector = select;\n        \n        const selectorWrapper = DOMUtils.createElement('div', {\n            className: `${classPrefix}-sign-language-selector-wrapper`\n        });\n        selectorWrapper.appendChild(label);\n        selectorWrapper.appendChild(this.selector);\n        \n        preventDragOnElement(selectorWrapper);\n        container.appendChild(selectorWrapper);\n    }\n\n    /**\n     * Create close button\n     */\n    _createCloseButton() {\n        const classPrefix = this.player.options.classPrefix;\n        const ariaLabel = i18n.t('player.closeSignLanguage');\n        \n        const closeButton = DOMUtils.createElement('button', {\n            className: `${classPrefix}-sign-language-close`,\n            attributes: {\n                'type': 'button',\n                'aria-label': ariaLabel\n            }\n        });\n        closeButton.appendChild(createIconElement('close'));\n        DOMUtils.attachTooltip(closeButton, ariaLabel, classPrefix);\n        \n        closeButton.addEventListener('click', () => {\n            this.disable();\n            if (this.player.controlBar?.controls?.signLanguage) {\n                setTimeout(() => {\n                    this.player.controlBar.controls.signLanguage.focus({ preventScroll: true });\n                }, 0);\n            }\n        });\n        \n        return closeButton;\n    }\n\n    /**\n     * Create video element\n     */\n    _createVideo(src) {\n        this.video = document.createElement('video');\n        this.video.className = 'vidply-sign-language-video';\n        this.video.src = src;\n        this.video.setAttribute('aria-label', i18n.t('player.signLanguage'));\n        this.video.muted = true;\n        this.video.setAttribute('playsinline', '');\n    }\n\n    /**\n     * Create resize handles\n     */\n    _createResizeHandles() {\n        const classPrefix = this.player.options.classPrefix;\n        \n        this.resizeHandles = ['n', 's', 'e', 'w', 'ne', 'nw', 'se', 'sw'].map(dir => {\n            const handle = DOMUtils.createElement('div', {\n                className: `${classPrefix}-sign-resize-handle ${classPrefix}-sign-resize-${dir}`,\n                attributes: {\n                    'data-direction': dir,\n                    'data-vidply-managed-resize': 'true',\n                    'aria-hidden': 'true'\n                }\n            });\n            handle.style.display = 'none';\n            return handle;\n        });\n    }\n\n    /**\n     * Apply initial size\n     */\n    _applyInitialSize() {\n        const saved = this.player.storage.getSignLanguagePreferences();\n        if (saved?.size?.width) {\n            this.wrapper.style.width = saved.size.width;\n        } else {\n            this.wrapper.style.width = '280px';\n        }\n        this.wrapper.style.height = 'auto';\n    }\n\n    /**\n     * Setup interaction (drag and resize)\n     */\n    _setupInteraction() {\n        const isMobile = window.innerWidth < 768;\n        const isFullscreen = this.player.state.fullscreen;\n\n        // Historically, drag/resize was disabled on mobile unless fullscreen to avoid scroll conflicts.\n        // Now that we support touch/pointer dragging with proper `touch-action` handling, enable it\n        // by default on iOS/Android as well. Allow opting out via option.\n        if (isMobile && !isFullscreen && this.player?.options?.signLanguageDragOnMobile === false) {\n            if (this.draggable) {\n                this.draggable.destroy();\n                this.draggable = null;\n            }\n            return;\n        }\n\n        if (this.draggable) return;\n\n        const classPrefix = this.player.options.classPrefix;\n        \n        this.draggable = new DraggableResizable(this.wrapper, {\n            // Allow dragging from anywhere on the sign-language window (better for touch).\n            // We still block dragging when interacting with controls via `onDragStart` below.\n            dragHandle: this.wrapper,\n            resizeHandles: this.resizeHandles,\n            constrainToViewport: true,\n            maintainAspectRatio: true,\n            minWidth: 150,\n            minHeight: 100,\n            classPrefix: `${classPrefix}-sign`,\n            keyboardDragKey: 'd',\n            keyboardResizeKey: 'r',\n            keyboardStep: 10,\n            keyboardStepLarge: 50,\n            pointerResizeIndicatorText: i18n.t('player.signLanguageResizeActive'),\n            onPointerResizeToggle: (enabled) => {\n                this.resizeHandles.forEach(handle => {\n                    handle.style.display = enabled ? 'block' : 'none';\n                });\n            },\n            onDragStart: (e) => {\n                if (e.target.closest(`.${classPrefix}-sign-language-close`) ||\n                    e.target.closest(`.${classPrefix}-sign-language-settings`) ||\n                    e.target.closest(`.${classPrefix}-sign-language-select`) ||\n                    e.target.closest(`.${classPrefix}-sign-language-label`) ||\n                    e.target.closest(`.${classPrefix}-sign-language-settings-menu`)) {\n                    return false;\n                }\n                return true;\n            }\n        });\n\n        this._setupCustomKeyHandler();\n        \n        this.interactionHandlers = {\n            draggable: this.draggable,\n            customKeyHandler: this.customKeyHandler\n        };\n    }\n\n    /**\n     * Setup custom keyboard handler\n     */\n    _setupCustomKeyHandler() {\n        this.customKeyHandler = (e) => {\n            const key = e.key.toLowerCase();\n            \n            if (this.settingsMenuVisible) return;\n            \n            if (key === 'home') {\n                e.preventDefault();\n                e.stopPropagation();\n                if (this.draggable) {\n                    if (this.draggable.pointerResizeMode) {\n                        this.draggable.disablePointerResizeMode();\n                    }\n                    this.draggable.manuallyPositioned = false;\n                    this.constrainPosition();\n                }\n                return;\n            }\n            \n            if (key === 'r') {\n                e.preventDefault();\n                e.stopPropagation();\n                if (this.toggleResizeMode()) {\n                    this.wrapper.focus({ preventScroll: true });\n                }\n                return;\n            }\n            \n            if (key === 'escape') {\n                e.preventDefault();\n                e.stopPropagation();\n                if (this.draggable?.pointerResizeMode) {\n                    this.draggable.disablePointerResizeMode();\n                    return;\n                }\n                if (this.draggable?.keyboardDragMode) {\n                    this.draggable.disableKeyboardDragMode();\n                    return;\n                }\n                this.disable();\n                if (this.player.controlBar?.controls?.signLanguage) {\n                    setTimeout(() => {\n                        this.player.controlBar.controls.signLanguage.focus({ preventScroll: true });\n                    }, 0);\n                }\n            }\n        };\n        \n        this.wrapper.addEventListener('keydown', this.customKeyHandler);\n    }\n\n    /**\n     * Setup event handlers\n     */\n    _setupEventHandlers(hasMultipleSources) {\n        this.handlers = {\n            play: () => { if (this.video) this.video.play(); },\n            pause: () => { if (this.video) this.video.pause(); },\n            timeupdate: () => {\n                if (this.video && Math.abs(this.video.currentTime - this.player.state.currentTime) > 0.5) {\n                    this.video.currentTime = this.player.state.currentTime;\n                }\n            },\n            ratechange: () => {\n                if (this.video) this.video.playbackRate = this.player.state.playbackSpeed;\n            }\n        };\n\n        this.player.on('play', this.handlers.play);\n        this.player.on('pause', this.handlers.pause);\n        this.player.on('timeupdate', this.handlers.timeupdate);\n        this.player.on('ratechange', this.handlers.ratechange);\n        \n        if (hasMultipleSources) {\n            this.handlers.captionChange = () => {\n                if (this.player.captionManager?.currentTrack && this.selector) {\n                    const captionLang = this.player.captionManager.currentTrack.language?.toLowerCase().split('-')[0];\n                    if (captionLang && this.sources[captionLang] && this.currentLanguage !== captionLang) {\n                        this.switchLanguage(captionLang);\n                        this.selector.value = captionLang;\n                    }\n                }\n            };\n            this.player.on('captionsenabled', this.handlers.captionChange);\n        }\n    }\n\n    /**\n     * Constrain position within video wrapper\n     */\n    constrainPosition() {\n        if (!this.wrapper || !this.player.videoWrapper) return;\n        \n        if (this.draggable?.manuallyPositioned) return;\n        \n        if (!this.wrapper.style.width) {\n            this.wrapper.style.width = '280px';\n        }\n        \n        const videoWrapperRect = this.player.videoWrapper.getBoundingClientRect();\n        const containerRect = this.player.container.getBoundingClientRect();\n        const wrapperRect = this.wrapper.getBoundingClientRect();\n        \n        const videoWrapperLeft = videoWrapperRect.left - containerRect.left;\n        const videoWrapperTop = videoWrapperRect.top - containerRect.top;\n        const videoWrapperWidth = videoWrapperRect.width;\n        const videoWrapperHeight = videoWrapperRect.height;\n        \n        let wrapperWidth = wrapperRect.width || 280;\n        let wrapperHeight = wrapperRect.height || ((280 * 9) / 16);\n        \n        let left, top;\n        const margin = 16;\n        const controlsHeight = 95;\n        \n        const position = this.desiredPosition || 'bottom-right';\n        \n        switch (position) {\n            case 'bottom-right':\n                left = videoWrapperLeft + videoWrapperWidth - wrapperWidth - margin;\n                top = videoWrapperTop + videoWrapperHeight - wrapperHeight - controlsHeight;\n                break;\n            case 'bottom-left':\n                left = videoWrapperLeft + margin;\n                top = videoWrapperTop + videoWrapperHeight - wrapperHeight - controlsHeight;\n                break;\n            case 'top-right':\n                left = videoWrapperLeft + videoWrapperWidth - wrapperWidth - margin;\n                top = videoWrapperTop + margin;\n                break;\n            case 'top-left':\n                left = videoWrapperLeft + margin;\n                top = videoWrapperTop + margin;\n                break;\n            default:\n                left = videoWrapperLeft + videoWrapperWidth - wrapperWidth - margin;\n                top = videoWrapperTop + videoWrapperHeight - wrapperHeight - controlsHeight;\n        }\n        \n        left = Math.max(videoWrapperLeft, Math.min(left, videoWrapperLeft + videoWrapperWidth - wrapperWidth));\n        top = Math.max(videoWrapperTop, Math.min(top, videoWrapperTop + videoWrapperHeight - wrapperHeight - controlsHeight));\n        \n        this.wrapper.style.left = `${left}px`;\n        this.wrapper.style.top = `${top}px`;\n        this.wrapper.style.right = 'auto';\n        this.wrapper.style.bottom = 'auto';\n    }\n\n    /**\n     * Show settings menu\n     */\n    showSettingsMenu() {\n        this.settingsMenuJustOpened = true;\n        setTimeout(() => { this.settingsMenuJustOpened = false; }, 350);\n        \n        this._addDocumentClickHandler();\n        \n        if (this.settingsMenu) {\n            this.settingsMenu.style.display = 'block';\n            this.settingsMenuVisible = true;\n            this.settingsButton?.setAttribute('aria-expanded', 'true');\n            this._attachMenuKeyboardNavigation();\n            this._positionSettingsMenu();\n            this._updateDragOptionState();\n            this._updateResizeOptionState();\n            focusFirstMenuItem(this.settingsMenu, `.${this.player.options.classPrefix}-sign-language-settings-item`);\n            return;\n        }\n        \n        this._createSettingsMenu();\n    }\n\n    /**\n     * Hide settings menu\n     */\n    hideSettingsMenu({ focusButton = true } = {}) {\n        if (this.settingsMenu) {\n            this.settingsMenu.style.display = 'none';\n            this.settingsMenuVisible = false;\n            this.settingsMenuJustOpened = false;\n            \n            if (this.settingsMenuKeyHandler) {\n                this.settingsMenu.removeEventListener('keydown', this.settingsMenuKeyHandler);\n                this.settingsMenuKeyHandler = null;\n            }\n            \n            const classPrefix = this.player.options.classPrefix;\n            const menuItems = Array.from(this.settingsMenu.querySelectorAll(`.${classPrefix}-sign-language-settings-item`));\n            menuItems.forEach(item => item.setAttribute('tabindex', '-1'));\n            \n            if (this.settingsButton) {\n                this.settingsButton.setAttribute('aria-expanded', 'false');\n                if (focusButton) {\n                    this.settingsButton.focus({ preventScroll: true });\n                }\n            }\n        }\n    }\n\n    /**\n     * Add document click handler\n     */\n    _addDocumentClickHandler() {\n        if (this.documentClickHandlerAdded) return;\n        \n        this.documentClickHandler = (e) => {\n            if (this.settingsMenuJustOpened) return;\n            \n            if (this.settingsButton && \n                (this.settingsButton === e.target || this.settingsButton.contains(e.target))) {\n                return;\n            }\n            \n            if (this.settingsMenu && this.settingsMenu.contains(e.target)) {\n                return;\n            }\n            \n            if (this.settingsMenuVisible) {\n                this.hideSettingsMenu();\n            }\n        };\n        \n        setTimeout(() => {\n            document.addEventListener('mousedown', this.documentClickHandler, true);\n            this.documentClickHandlerAdded = true;\n        }, 300);\n    }\n\n    /**\n     * Create settings menu\n     */\n    _createSettingsMenu() {\n        const classPrefix = this.player.options.classPrefix;\n        \n        this.settingsMenu = DOMUtils.createElement('div', {\n            className: `${classPrefix}-sign-language-settings-menu`,\n            attributes: { 'role': 'menu' }\n        });\n\n        // Drag option\n        const dragOption = createMenuItem({\n            classPrefix,\n            itemClass: `${classPrefix}-sign-language-settings-item`,\n            icon: 'move',\n            label: 'player.enableSignDragMode',\n            hasTextClass: true,\n            onClick: () => {\n                this.toggleKeyboardDragMode();\n                // Keep focus off the settings button so arrow keys go to the draggable overlay.\n                this.hideSettingsMenu({ focusButton: false });\n                // If we just enabled keyboard drag mode, focus the overlay.\n                if (this.draggable?.keyboardDragMode) {\n                    setTimeout(() => {\n                        this.wrapper?.focus?.({ preventScroll: true });\n                    }, 20);\n                }\n            }\n        });\n        // Allow CSS to hide this option on touch/mobile where dragging is always enabled\n        dragOption.setAttribute('data-setting', 'keyboard-drag');\n        dragOption.setAttribute('role', 'switch');\n        dragOption.setAttribute('aria-checked', 'false');\n        this._removeTooltipFromMenuItem(dragOption);\n        this.dragOptionButton = dragOption;\n        this.dragOptionText = dragOption.querySelector(`.${classPrefix}-settings-text`);\n        this._updateDragOptionState();\n\n        // Resize option\n        const resizeOption = createMenuItem({\n            classPrefix,\n            itemClass: `${classPrefix}-sign-language-settings-item`,\n            icon: 'resize',\n            label: 'player.enableSignResizeMode',\n            hasTextClass: true,\n            onClick: (event) => {\n                event.preventDefault();\n                event.stopPropagation();\n                \n                const enabled = this.toggleResizeMode({ focus: false });\n                \n                if (enabled) {\n                    this.hideSettingsMenu({ focusButton: false });\n                    setTimeout(() => {\n                        if (this.wrapper) this.wrapper.focus({ preventScroll: true });\n                    }, 20);\n                } else {\n                    this.hideSettingsMenu({ focusButton: true });\n                }\n            }\n        });\n        resizeOption.setAttribute('role', 'switch');\n        resizeOption.setAttribute('aria-checked', 'false');\n        this._removeTooltipFromMenuItem(resizeOption);\n        this.resizeOptionButton = resizeOption;\n        this.resizeOptionText = resizeOption.querySelector(`.${classPrefix}-settings-text`);\n        this._updateResizeOptionState();\n\n        // Close option\n        const closeOption = createMenuItem({\n            classPrefix,\n            itemClass: `${classPrefix}-sign-language-settings-item`,\n            icon: 'close',\n            label: 'transcript.closeMenu',\n            onClick: () => this.hideSettingsMenu()\n        });\n        this._removeTooltipFromMenuItem(closeOption);\n\n        this.settingsMenu.appendChild(dragOption);\n        this.settingsMenu.appendChild(resizeOption);\n        this.settingsMenu.appendChild(closeOption);\n\n        // Position and show\n        this.settingsMenu.style.visibility = 'hidden';\n        this.settingsMenu.style.display = 'block';\n        \n        if (this.settingsButton?.parentNode) {\n            this.settingsButton.insertAdjacentElement('afterend', this.settingsMenu);\n        } else if (this.wrapper) {\n            this.wrapper.appendChild(this.settingsMenu);\n        }\n        \n        this._positionSettingsMenuImmediate();\n        \n        requestAnimationFrame(() => {\n            if (this.settingsMenu) {\n                this.settingsMenu.style.visibility = 'visible';\n            }\n        });\n        \n        this._attachMenuKeyboardNavigation();\n        \n        this.settingsMenuVisible = true;\n        this.settingsButton?.setAttribute('aria-expanded', 'true');\n        this._updateDragOptionState();\n        this._updateResizeOptionState();\n        \n        focusFirstMenuItem(this.settingsMenu, `.${classPrefix}-sign-language-settings-item`);\n    }\n\n    /**\n     * Remove tooltip from menu item\n     */\n    _removeTooltipFromMenuItem(item) {\n        const classPrefix = this.player.options.classPrefix;\n        const tooltip = item.querySelector(`.${classPrefix}-tooltip`);\n        if (tooltip) tooltip.remove();\n        const buttonText = item.querySelector(`.${classPrefix}-button-text`);\n        if (buttonText) buttonText.remove();\n    }\n\n    /**\n     * Attach menu keyboard navigation\n     */\n    _attachMenuKeyboardNavigation() {\n        if (this.settingsMenuKeyHandler) {\n            this.settingsMenu.removeEventListener('keydown', this.settingsMenuKeyHandler);\n        }\n        \n        this.settingsMenuKeyHandler = attachMenuKeyboardNavigation(\n            this.settingsMenu,\n            this.settingsButton,\n            `.${this.player.options.classPrefix}-sign-language-settings-item`,\n            () => this.hideSettingsMenu({ focusButton: true })\n        );\n    }\n\n    /**\n     * Position settings menu immediately\n     */\n    _positionSettingsMenuImmediate() {\n        if (!this.settingsMenu || !this.settingsButton) return;\n        \n        const buttonRect = this.settingsButton.getBoundingClientRect();\n        const menuRect = this.settingsMenu.getBoundingClientRect();\n        const viewportWidth = window.innerWidth;\n        const viewportHeight = window.innerHeight;\n        \n        const parentContainer = this.settingsButton.parentElement;\n        if (!parentContainer) return;\n        \n        const parentRect = parentContainer.getBoundingClientRect();\n        \n        const buttonCenterX = buttonRect.left + buttonRect.width / 2 - parentRect.left;\n        const buttonBottom = buttonRect.bottom - parentRect.top;\n        const buttonTop = buttonRect.top - parentRect.top;\n        \n        const spaceAbove = buttonRect.top;\n        const spaceBelow = viewportHeight - buttonRect.bottom;\n        \n        let menuTop = buttonBottom + 8;\n        let menuBottom = null;\n        \n        if (spaceBelow < menuRect.height + 20 && spaceAbove > spaceBelow) {\n            menuTop = null;\n            const parentHeight = parentRect.bottom - parentRect.top;\n            menuBottom = parentHeight - buttonTop + 8;\n            this.settingsMenu.classList.add('vidply-menu-above');\n        } else {\n            this.settingsMenu.classList.remove('vidply-menu-above');\n        }\n        \n        let menuLeft = buttonCenterX - menuRect.width / 2;\n        let menuRight = 'auto';\n        let transformX = 'translateX(0)';\n        \n        const menuLeftAbsolute = buttonRect.left + buttonRect.width / 2 - menuRect.width / 2;\n        if (menuLeftAbsolute < 10) {\n            menuLeft = 0;\n        } else if (menuLeftAbsolute + menuRect.width > viewportWidth - 10) {\n            menuLeft = 'auto';\n            menuRight = 0;\n        } else {\n            menuLeft = buttonCenterX;\n            transformX = 'translateX(-50%)';\n        }\n        \n        if (menuTop !== null) {\n            this.settingsMenu.style.top = `${menuTop}px`;\n            this.settingsMenu.style.bottom = 'auto';\n        } else if (menuBottom !== null) {\n            this.settingsMenu.style.top = 'auto';\n            this.settingsMenu.style.bottom = `${menuBottom}px`;\n        }\n        \n        if (menuLeft !== 'auto') {\n            this.settingsMenu.style.left = `${menuLeft}px`;\n            this.settingsMenu.style.right = 'auto';\n        } else {\n            this.settingsMenu.style.left = 'auto';\n            this.settingsMenu.style.right = `${menuRight}px`;\n        }\n        \n        this.settingsMenu.style.transform = transformX;\n    }\n\n    /**\n     * Position settings menu with RAF\n     */\n    _positionSettingsMenu() {\n        requestAnimationFrame(() => {\n            setTimeout(() => {\n                this._positionSettingsMenuImmediate();\n            }, 10);\n        });\n    }\n\n    /**\n     * Toggle keyboard drag mode\n     */\n    toggleKeyboardDragMode() {\n        if (this.draggable) {\n            const wasEnabled = this.draggable.keyboardDragMode;\n            this.draggable.toggleKeyboardDragMode();\n            const isEnabled = this.draggable.keyboardDragMode;\n            if (!wasEnabled && isEnabled) {\n                this._enableMoveMode();\n            }\n            this._updateDragOptionState();\n        }\n    }\n\n    /**\n     * Enable move mode visual feedback\n     */\n    _enableMoveMode() {\n        this.wrapper.classList.add(`${this.player.options.classPrefix}-sign-move-mode`);\n        this._updateResizeOptionState();\n        setTimeout(() => {\n            this.wrapper.classList.remove(`${this.player.options.classPrefix}-sign-move-mode`);\n        }, 2000);\n    }\n\n    /**\n     * Toggle resize mode\n     */\n    toggleResizeMode({ focus = true } = {}) {\n        if (!this.draggable) return false;\n\n        if (this.draggable.pointerResizeMode) {\n            this.draggable.disablePointerResizeMode({ focus });\n            this._updateResizeOptionState();\n            return false;\n        }\n\n        this.draggable.enablePointerResizeMode({ focus });\n        this._updateResizeOptionState();\n        return true;\n    }\n\n    /**\n     * Update drag option state\n     */\n    _updateDragOptionState() {\n        if (!this.dragOptionButton) return;\n        \n        const isEnabled = !!(this.draggable?.keyboardDragMode);\n        const text = isEnabled\n            ? i18n.t('player.disableSignDragMode')\n            : i18n.t('player.enableSignDragMode');\n        const ariaLabel = isEnabled\n            ? i18n.t('player.disableSignDragModeAria')\n            : i18n.t('player.enableSignDragModeAria');\n\n        this.dragOptionButton.setAttribute('aria-checked', isEnabled ? 'true' : 'false');\n        this.dragOptionButton.setAttribute('aria-label', ariaLabel);\n\n        if (this.dragOptionText) {\n            this.dragOptionText.textContent = text;\n        }\n    }\n\n    /**\n     * Update resize option state\n     */\n    _updateResizeOptionState() {\n        if (!this.resizeOptionButton) return;\n        \n        const isEnabled = !!(this.draggable?.pointerResizeMode);\n        const text = isEnabled\n            ? i18n.t('player.disableSignResizeMode')\n            : i18n.t('player.enableSignResizeMode');\n        const ariaLabel = isEnabled\n            ? i18n.t('player.disableSignResizeModeAria')\n            : i18n.t('player.enableSignResizeModeAria');\n\n        this.resizeOptionButton.setAttribute('aria-checked', isEnabled ? 'true' : 'false');\n        this.resizeOptionButton.setAttribute('aria-label', ariaLabel);\n\n        if (this.resizeOptionText) {\n            this.resizeOptionText.textContent = text;\n        }\n    }\n\n    /**\n     * Save preferences\n     */\n    savePreferences() {\n        if (!this.wrapper) return;\n        \n        this.player.storage.saveSignLanguagePreferences({\n            size: { width: this.wrapper.style.width }\n        });\n    }\n\n    /**\n     * Update sources (called when playlist changes)\n     */\n    updateSources(signLanguageSrc, signLanguageSources) {\n        this.src = signLanguageSrc || null;\n        this.sources = signLanguageSources || {};\n        // Reset state for new playlist item (cleanup is called separately before this)\n        this.currentLanguage = null;\n    }\n\n    /**\n     * Cleanup\n     */\n    cleanup() {\n        if (this.inMainView && this.player.element) {\n            const el = this.player.element;\n            if (this._mainViewUsingSourceSwap && this.mainViewOriginalSources && this.mainViewOriginalSources.length > 0) {\n                Array.from(el.querySelectorAll('source')).forEach(source => source.remove());\n                const trackNode = el.querySelector('track');\n                this.mainViewOriginalSources.forEach(source => {\n                    if (trackNode) {\n                        el.insertBefore(source, trackNode);\n                    } else {\n                        el.appendChild(source);\n                    }\n                });\n                this._mainViewUsingSourceSwap = false;\n            } else if (this.mainViewOriginalSrc) {\n                el.src = this.mainViewOriginalSrc;\n            }\n            el.muted = this._mainViewMutedBefore;\n            if (typeof this.player.invalidateTrackCache === 'function') {\n                this.player.invalidateTrackCache();\n            }\n            el.load();\n            this.mainViewOriginalSrc = null;\n            this.mainViewOriginalSources = null;\n            this.inMainView = false;\n            this.player.state.signLanguageInMainView = false;\n            if (this.player.videoWrapper) {\n                this.player.videoWrapper.classList.remove('vidply-sign-language-main-view-active');\n            }\n            this.player.emit('signlanguageinmainviewdisabled');\n        }\n        if (this.settingsMenuVisible) {\n            this.hideSettingsMenu({ focusButton: false });\n        }\n        \n        // Remove document click handler\n        if (this.documentClickHandler && this.documentClickHandlerAdded) {\n            document.removeEventListener('mousedown', this.documentClickHandler, true);\n            this.documentClickHandlerAdded = false;\n            this.documentClickHandler = null;\n        }\n        \n        // Remove settings handlers\n        if (this.settingsHandlers && this.settingsButton) {\n            this.settingsButton.removeEventListener('click', this.settingsHandlers.click);\n            this.settingsButton.removeEventListener('keydown', this.settingsHandlers.keydown);\n        }\n        this.settingsHandlers = null;\n        \n        // Remove event handlers\n        if (this.handlers) {\n            this.player.off('play', this.handlers.play);\n            this.player.off('pause', this.handlers.pause);\n            this.player.off('timeupdate', this.handlers.timeupdate);\n            this.player.off('ratechange', this.handlers.ratechange);\n            if (this.handlers.captionChange) {\n                this.player.off('captionsenabled', this.handlers.captionChange);\n            }\n            this.handlers = null;\n        }\n\n        // Remove custom key handler\n        if (this.wrapper && this.customKeyHandler) {\n            this.wrapper.removeEventListener('keydown', this.customKeyHandler);\n        }\n\n        // Destroy draggable\n        if (this.draggable) {\n            if (this.draggable.pointerResizeMode) {\n                this.draggable.disablePointerResizeMode();\n            }\n            this.draggable.destroy();\n            this.draggable = null;\n        }\n        \n        this.interactionHandlers = null;\n\n        // Remove video and wrapper\n        if (this.wrapper?.parentNode) {\n            if (this.video) {\n                this.video.pause();\n                this.video.src = '';\n            }\n            this.wrapper.parentNode.removeChild(this.wrapper);\n        }\n        \n        this.wrapper = null;\n        this.video = null;\n        this.settingsButton = null;\n        this.settingsMenu = null;\n    }\n\n    /**\n     * Destroy\n     */\n    destroy() {\n        this.cleanup();\n        this.enabled = false;\n    }\n}\n\n", "/**\r\n * VidPly - Universal Video Player\r\n * Main Player Class\r\n */\r\n\r\nimport {EventEmitter} from '../utils/EventEmitter.js';\r\nimport {DOMUtils} from '../utils/DOMUtils.js';\r\nimport {ControlBar} from '../controls/ControlBar.js';\r\nimport {CaptionManager} from '../controls/CaptionManager.js';\r\nimport {KeyboardManager} from '../controls/KeyboardManager.js';\r\nimport {HTML5Renderer} from '../renderers/HTML5Renderer.js';\r\nimport {createPlayOverlay, createIconElement} from '../icons/Icons.js';\r\nimport {i18n} from '../i18n/i18n.js';\r\nimport {StorageManager} from '../utils/StorageManager.js';\r\nimport {DraggableResizable} from '../utils/DraggableResizable.js';\r\nimport {createMenuItem, attachMenuKeyboardNavigation, focusFirstMenuItem} from '../utils/MenuUtils.js';\r\nimport {createLabeledSelect, preventDragOnElement} from '../utils/FormUtils.js';\r\nimport {debounce, isMobile, rafWithTimeout} from '../utils/PerformanceUtils.js';\r\nimport {AudioDescriptionManager} from './AudioDescriptionManager.js';\r\nimport {SignLanguageManager} from './SignLanguageManager.js';\r\nimport {captureVideoFrame} from '../utils/VideoFrameCapture.js';\r\n\r\n// Static counter for unique player instances\r\nlet playerInstanceCounter = 0;\r\n\r\nexport class Player extends EventEmitter {\r\n    constructor(element, options = {}) {\r\n        super();\r\n\r\n        this.element = typeof element === 'string' ? document.querySelector(element) : element;\r\n        if (!this.element) {\r\n            throw new Error('VidPly: Element not found');\r\n        }\r\n\r\n        // Assign unique instance ID\r\n        playerInstanceCounter++;\r\n        this.instanceId = playerInstanceCounter;\r\n\r\n        // Auto-create media element if a non-media element is provided\r\n        if (this.element.tagName !== 'VIDEO' && this.element.tagName !== 'AUDIO') {\r\n            const mediaType = options.mediaType || 'video';\r\n            const mediaElement = document.createElement(mediaType);\r\n\r\n            // Copy attributes from the div to the media element\r\n            Array.from(this.element.attributes).forEach(attr => {\r\n                if (attr.name !== 'id' && attr.name !== 'class' && !attr.name.startsWith('data-')) {\r\n                    mediaElement.setAttribute(attr.name, attr.value);\r\n                }\r\n            });\r\n\r\n            // Copy any track elements from the div\r\n            const tracks = this.element.querySelectorAll('track');\r\n            tracks.forEach(track => {\r\n                mediaElement.appendChild(track.cloneNode(true));\r\n            });\r\n\r\n            // Clear the div and insert the media element\r\n            this.element.innerHTML = '';\r\n            this.element.appendChild(mediaElement);\r\n\r\n            // Update element reference to the actual media element\r\n            this.element = mediaElement;\r\n        }\r\n        \r\n        // Store original element reference for mixed media swapping\r\n        // This allows us to swap between video and audio elements in mixed playlists\r\n        this._originalElement = this.element;\r\n\r\n        // Default options\r\n        this.options = {\r\n            // Display\r\n            width: null,\r\n            height: null,\r\n            poster: null,\r\n            responsive: true,\r\n            fillContainer: false,\r\n\r\n            // Playback\r\n            autoplay: false,\r\n            loop: false,\r\n            muted: false,\r\n            volume: 0.8,\r\n            playbackSpeed: 1.0,\r\n            preload: 'metadata',\r\n            // Optional initial duration (seconds) so UI can show duration\r\n            // before media metadata is loaded (useful with deferLoad/preload=none).\r\n            initialDuration: 0,\r\n            // When enabled, VidPly will not start network loading during init().\r\n            // - HTML5: does not call element.load() until the first user-initiated play()\r\n            // - HLS (hls.js): does not load manifest/segments until the first play()\r\n            // This is useful for pages with many players to avoid high initial bandwidth.\r\n            deferLoad: false,\r\n            // When enabled, clicking Audio Description / Sign Language before playback will show\r\n            // a notice instead of implicitly starting playback/loading.\r\n            requirePlaybackForAccessibilityToggles: false,\r\n            startTime: 0,\r\n            playsInline: true, // Enable inline playback on iOS (prevents native fullscreen)\r\n\r\n            // Controls\r\n            controls: true,\r\n            hideControlsDelay: 3000,\r\n            playPauseButton: true,\r\n            progressBar: true,\r\n            currentTime: true,\r\n            duration: true,\r\n            volumeControl: true,\r\n            muteButton: true,\r\n            chaptersButton: true,\r\n            qualityButton: true,\r\n            captionStyleButton: true,\r\n            speedButton: true,\r\n            // When enabled, the playback speed UI is suppressed for ALL HLS streams (audio + video).\r\n            hideSpeedForHls: false,\r\n            // When enabled, the playback speed UI is suppressed for HLS *video* streams only.\r\n            // This is useful for live streams where speed controls don't make sense.\r\n            hideSpeedForHlsVideo: false,\r\n            captionsButton: true,\r\n            transcriptButton: true,\r\n            fullscreenButton: true,\r\n            pipButton: false,\r\n\r\n            // Seeking\r\n            seekInterval: 10,\r\n            seekIntervalLarge: 30,\r\n\r\n            // Captions\r\n            captions: true,\r\n            captionsDefault: false,\r\n            captionsFontSize: '100%',\r\n            captionsFontFamily: 'sans-serif',\r\n            captionsColor: '#FFFFFF',\r\n            captionsBackgroundColor: '#000000',\r\n            captionsOpacity: 0.8,\r\n\r\n            // Audio Description\r\n            audioDescription: true,\r\n            audioDescriptionSrc: null, // URL to audio-described version\r\n            audioDescriptionButton: true,\r\n\r\n            // Sign Language\r\n            signLanguage: true,\r\n            signLanguageSrc: null, // URL to sign language video\r\n            signLanguageButton: true,\r\n            signLanguagePosition: 'bottom-right', // Position: 'bottom-right', 'bottom-left', 'top-right', 'top-left'\r\n            signLanguageDisplayMode: 'both', // Display mode: 'pip' (overlay), 'main' (source swap), 'both'\r\n\r\n            // Transcripts\r\n            transcript: false,\r\n            transcriptPosition: 'external',\r\n            transcriptContainer: null,\r\n\r\n            // Keyboard\r\n            keyboard: true,\r\n            keyboardShortcuts: {\r\n                'play-pause': [' ', 'p', 'k'],\r\n                'volume-up': ['ArrowUp'],\r\n                'volume-down': ['ArrowDown'],\r\n                'seek-forward': ['ArrowRight'],\r\n                'seek-backward': ['ArrowLeft'],\r\n                'mute': ['m'],\r\n                'fullscreen': ['f'],\r\n                'captions': ['c'],\r\n                'caption-style-menu': ['a'],\r\n                'speed-up': ['>'],\r\n                'speed-down': ['<'],\r\n                'speed-menu': ['s'],\r\n                'quality-menu': ['q'],\r\n                'chapters-menu': ['j'],\r\n                'transcript-toggle': ['t']\r\n            },\r\n\r\n            // Accessibility\r\n            ariaLabels: {},\r\n            screenReaderAnnouncements: true,\r\n            highContrast: false,\r\n            focusHighlight: true,\r\n            metadataAlerts: {},\r\n            metadataHashtags: {},\r\n\r\n            // Languages\r\n            language: 'en',\r\n            languages: ['en'],\r\n\r\n            // Advanced\r\n            debug: false,\r\n            classPrefix: 'vidply',\r\n            iconType: 'svg',\r\n            pauseOthersOnPlay: true,\r\n\r\n            // Callbacks\r\n            onReady: null,\r\n            onPlay: null,\r\n            onPause: null,\r\n            onEnded: null,\r\n            onTimeUpdate: null,\r\n            onVolumeChange: null,\r\n            onError: null,\r\n\r\n            ...options\r\n        };\r\n\r\n        this.options.metadataAlerts = this.options.metadataAlerts || {};\r\n        this.options.metadataHashtags = this.options.metadataHashtags || {};\r\n\r\n        // Notice UI\r\n        this.noticeElement = null;\r\n        this.noticeTimeout = null;\r\n\r\n        // Storage manager\r\n        this.storage = new StorageManager('vidply');\r\n        \r\n        // Load saved player preferences\r\n        const savedPrefs = this.storage.getPlayerPreferences();\r\n        if (savedPrefs) {\r\n            if (savedPrefs.volume !== undefined) this.options.volume = savedPrefs.volume;\r\n            if (savedPrefs.playbackSpeed !== undefined) this.options.playbackSpeed = savedPrefs.playbackSpeed;\r\n            if (savedPrefs.muted !== undefined) this.options.muted = savedPrefs.muted;\r\n        }\r\n        \r\n        // State\r\n        this.state = {\r\n            ready: false,\r\n            playing: false,\r\n            paused: true,\r\n            ended: false,\r\n            buffering: false,\r\n            seeking: false,\r\n            hasStartedPlayback: false,\r\n            muted: this.options.muted,\r\n            volume: this.options.volume,\r\n            currentTime: 0,\r\n            duration: Number(this.options.initialDuration) > 0 ? Number(this.options.initialDuration) : 0,\r\n            playbackSpeed: this.options.playbackSpeed,\r\n            fullscreen: false,\r\n            pip: false,\r\n            captionsEnabled: this.options.captionsDefault,\r\n            currentCaption: null,\r\n            controlsVisible: true,\r\n            audioDescriptionEnabled: false,\r\n            signLanguageEnabled: false,\r\n            signLanguageInMainView: false\r\n        };\r\n\r\n        // Store original source for toggling\r\n        this.originalSrc = null;\r\n        this.audioDescriptionSrc = this.options.audioDescriptionSrc;\r\n        this.signLanguageSrc = this.options.signLanguageSrc;\r\n        this.signLanguageSources = this.options.signLanguageSources || {}; // Map of lang codes to video URLs\r\n        this.currentSignLanguage = null; // Current selected sign language code\r\n        this.signLanguageVideo = null;\r\n        // Store references to source elements with audio description attributes\r\n        this.audioDescriptionSourceElement = null;\r\n        this.originalAudioDescriptionSource = null;\r\n        // Store caption tracks that should be swapped for audio description\r\n        this.audioDescriptionCaptionTracks = [];\r\n        this._audioDescriptionDesiredState = false;\r\n\r\n        // DOM query cache (for performance optimization)\r\n        this._textTracksCache = null;\r\n        this._textTracksDirty = true;\r\n        this._sourceElementsCache = null;\r\n        this._sourceElementsDirty = true;\r\n        this._trackElementsCache = null;\r\n        this._trackElementsDirty = true;\r\n\r\n        // Timeout management (for cleanup)\r\n        this.timeouts = new Set();\r\n\r\n        // Components\r\n        this.container = null;\r\n        this.renderer = null;\r\n        this.controlBar = null;\r\n        this.captionManager = null;\r\n        this.keyboardManager = null;\r\n        this.settingsDialog = null;\r\n        \r\n        // Metadata handling\r\n        this.metadataCueChangeHandler = null;\r\n        this.metadataAlertHandlers = new Map();\r\n\r\n        // Feature managers (modular refactoring)\r\n        this.audioDescriptionManager = new AudioDescriptionManager(this);\r\n        this.signLanguageManager = new SignLanguageManager(this);\r\n\r\n        // Backward-compatible property aliases for SignLanguageManager\r\n        // These allow existing code to reference this.signLanguageWrapper, etc.\r\n        Object.defineProperties(this, {\r\n            signLanguageWrapper: {\r\n                get: () => this.signLanguageManager.wrapper,\r\n                set: (v) => { this.signLanguageManager.wrapper = v; }\r\n            },\r\n            signLanguageVideo: {\r\n                get: () => this.signLanguageManager.video,\r\n                set: (v) => { this.signLanguageManager.video = v; }\r\n            },\r\n            signLanguageHeader: {\r\n                get: () => this.signLanguageManager.header,\r\n                set: (v) => { this.signLanguageManager.header = v; }\r\n            },\r\n            signLanguageSettingsButton: {\r\n                get: () => this.signLanguageManager.settingsButton,\r\n                set: (v) => { this.signLanguageManager.settingsButton = v; }\r\n            },\r\n            signLanguageSettingsMenu: {\r\n                get: () => this.signLanguageManager.settingsMenu,\r\n                set: (v) => { this.signLanguageManager.settingsMenu = v; }\r\n            },\r\n            signLanguageSettingsMenuVisible: {\r\n                get: () => this.signLanguageManager.settingsMenuVisible,\r\n                set: (v) => { this.signLanguageManager.settingsMenuVisible = v; }\r\n            },\r\n            signLanguageDraggable: {\r\n                get: () => this.signLanguageManager.draggable,\r\n                set: (v) => { this.signLanguageManager.draggable = v; }\r\n            },\r\n            currentSignLanguage: {\r\n                get: () => this.signLanguageManager.currentLanguage,\r\n                set: (v) => { this.signLanguageManager.currentLanguage = v; }\r\n            }\r\n        });\r\n\r\n        // Initialize\r\n        this.init();\r\n    }\r\n\r\n    /**\r\n     * Show a small in-player notice (non-blocking), also announced to screen readers.\r\n     */\r\n    showNotice(message, { timeout = 2500, priority = 'polite' } = {}) {\r\n        try {\r\n            if (!message) return;\r\n            if (!this.container) return;\r\n\r\n            // Screen reader announcement (reuse KeyboardManager announcer if available)\r\n            if (this.keyboardManager?.announce) {\r\n                this.keyboardManager.announce(message, priority);\r\n            }\r\n\r\n            if (!this.noticeElement) {\r\n                const el = document.createElement('div');\r\n                el.className = `${this.options.classPrefix}-notice`;\r\n                el.setAttribute('role', 'status');\r\n                el.setAttribute('aria-live', priority);\r\n                el.setAttribute('aria-atomic', 'true');\r\n                // Inline styling to avoid requiring CSS rebuilds\r\n                el.style.position = 'absolute';\r\n                el.style.left = '0.75rem';\r\n                el.style.right = '0.75rem';\r\n                el.style.top = '0.75rem';\r\n                el.style.zIndex = '9999';\r\n                el.style.padding = '0.5rem 0.75rem';\r\n                el.style.borderRadius = '0.5rem';\r\n                el.style.background = 'rgba(0, 0, 0, 0.75)';\r\n                el.style.color = '#fff';\r\n                el.style.fontSize = '0.875rem';\r\n                el.style.lineHeight = '1.3';\r\n                el.style.pointerEvents = 'none';\r\n                this.noticeElement = el;\r\n                this.container.appendChild(el);\r\n            }\r\n\r\n            this.noticeElement.textContent = message;\r\n            this.noticeElement.style.display = 'block';\r\n\r\n            if (this.noticeTimeout) {\r\n                clearTimeout(this.noticeTimeout);\r\n                this.noticeTimeout = null;\r\n            }\r\n            this.noticeTimeout = setTimeout(() => {\r\n                if (this.noticeElement) {\r\n                    this.noticeElement.style.display = 'none';\r\n                }\r\n            }, timeout);\r\n        } catch (e) {\r\n            // ignore\r\n        }\r\n    }\r\n\r\n    async init() {\r\n        try {\r\n            this.log('Initializing VidPly player');\r\n\r\n            // Load custom language files if specified\r\n            if (this.options.languageFiles) {\r\n                try {\r\n                    await i18n.loadLanguagesFromUrls(this.options.languageFiles);\r\n                } catch (error) {\r\n                    console.warn('Failed to load some language files:', error);\r\n                }\r\n            }\r\n\r\n            // Load single language file if specified (for backwards compatibility)\r\n            if (this.options.languageFile && this.options.languageFileUrl) {\r\n                try {\r\n                    await i18n.loadLanguageFromUrl(this.options.languageFile, this.options.languageFileUrl);\r\n                    this.log(`Custom language file loaded for ${this.options.languageFile}`);\r\n                } catch (error) {\r\n                    console.warn(`Failed to load language file for ${this.options.languageFile}:`, error);\r\n                }\r\n            }\r\n\r\n            // Auto-detect language from HTML lang attribute if not explicitly set\r\n            if (!this.options.language || this.options.language === 'en') {\r\n                const htmlLang = this.detectHtmlLanguage();\r\n                if (htmlLang) {\r\n                    this.options.language = htmlLang;\r\n                    this.log(`Auto-detected language from HTML: ${htmlLang}`);\r\n                }\r\n            }\r\n\r\n            // Ensure we have a language set (default to 'en' if not set)\r\n            if (!this.options.language) {\r\n                this.options.language = 'en';\r\n            }\r\n\r\n            // Ensure requested language is available (loads built-ins on demand)\r\n            await i18n.ensureLanguage(this.options.language);\r\n\r\n            // Set language\r\n            i18n.setLanguage(this.options.language);\r\n\r\n            // Create container\r\n            this.createContainer();\r\n\r\n            // Detect and initialize renderer (only if source exists)\r\n            const src = this.element.src || this.element.querySelector('source')?.src;\r\n            if (src) {\r\n                await this.initializeRenderer();\r\n            } else {\r\n                this.log('No initial source - waiting for playlist or manual load');\r\n            }\r\n\r\n            // Create controls\r\n            if (this.options.controls) {\r\n                this.controlBar = new ControlBar(this);\r\n                this.videoWrapper.appendChild(this.controlBar.element);\r\n            }\r\n\r\n            // Initialize captions\r\n            if (this.options.captions) {\r\n                this.captionManager = new CaptionManager(this);\r\n            }\r\n\r\n            // Initialize transcript lazily unless explicitly requested\r\n            if (this.options.transcript) {\r\n                await this.ensureTranscriptManager();\r\n            }\r\n            \r\n            // Always set up metadata track handling (independent of transcript)\r\n            this.setupMetadataHandling();\r\n\r\n            // Initialize keyboard controls\r\n            if (this.options.keyboard) {\r\n                this.keyboardManager = new KeyboardManager(this);\r\n            }\r\n\r\n            // Setup responsive handlers\r\n            this.setupResponsiveHandlers();\r\n\r\n            // Set initial state\r\n            if (this.options.startTime > 0) {\r\n                this.seek(this.options.startTime);\r\n            }\r\n\r\n            // Apply volume and mute settings after renderer is initialized\r\n            // Use requestAnimationFrame to ensure renderer is fully ready\r\n            requestAnimationFrame(() => {\r\n                if (this.options.muted) {\r\n                    this.mute();\r\n                } else if (this.renderer && this.renderer.media) {\r\n                    // Ensure media element is not muted if options say it shouldn't be\r\n                    this.renderer.setMuted(false);\r\n                }\r\n\r\n                if (this.options.volume !== 0.8) {\r\n                    this.setVolume(this.options.volume);\r\n                } else if (this.renderer && this.renderer.media) {\r\n                    // Ensure volume is set even if it's the default\r\n                    this.renderer.setVolume(this.options.volume);\r\n                }\r\n            });\r\n\r\n            // Mark as ready\r\n            this.state.ready = true;\r\n            this.emit('ready');\r\n\r\n            if (this.options.onReady) {\r\n                this.options.onReady.call(this);\r\n            }\r\n\r\n            // Autoplay if enabled\r\n            if (this.options.autoplay) {\r\n                this.play();\r\n            }\r\n\r\n            this.log('Player initialized successfully');\r\n        } catch (error) {\r\n            this.handleError(error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Ensure the transcript manager is available, creating it on demand.\r\n     * This keeps initial load fast when transcripts are not needed.\r\n     */\r\n    async ensureTranscriptManager() {\r\n        if (this.transcriptManager) {\r\n            return this.transcriptManager;\r\n        }\r\n\r\n        if (!this.options.transcript && !this.options.transcriptButton) {\r\n            return null;\r\n        }\r\n\r\n        const module = await import('../controls/TranscriptManager.js');\r\n        const Manager = module.TranscriptManager || module.default;\r\n\r\n        if (!Manager) {\r\n            return null;\r\n        }\r\n\r\n        this.transcriptManager = new Manager(this);\r\n        return this.transcriptManager;\r\n    }\r\n\r\n    /**\r\n     * Toggle transcript visibility, lazily creating the manager if necessary.\r\n     */\r\n    async toggleTranscript() {\r\n        const manager = await this.ensureTranscriptManager();\r\n        if (!manager) return;\r\n\r\n        manager.toggleTranscript();\r\n        if (this.controlBar) {\r\n            this.controlBar.updateTranscriptButton();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Detect language from HTML lang attribute\r\n     * @returns {string|null} Language code if available in translations or as built-in, null otherwise\r\n     */\r\n    detectHtmlLanguage() {\r\n        // Try to get lang from html element\r\n        const htmlLang = document.documentElement.lang || document.documentElement.getAttribute('lang');\r\n\r\n        if (!htmlLang) {\r\n            return null;\r\n        }\r\n\r\n        // Normalize the language code (e.g., \"en-US\" -> \"en\", \"de-DE\" -> \"de\")\r\n        const normalizedLang = htmlLang.toLowerCase().split('-')[0];\r\n\r\n        // Check if this language is available in our translations (already loaded)\r\n        if (i18n.translations[normalizedLang]) {\r\n            return normalizedLang;\r\n        }\r\n\r\n        // Check if this language is available as a built-in that can be loaded on demand\r\n        if (i18n.builtInLanguageLoaders && i18n.builtInLanguageLoaders[normalizedLang]) {\r\n            return normalizedLang;\r\n        }\r\n\r\n        // Language not available, will fallback to English\r\n        this.log(`Language \"${htmlLang}\" not available, using English as fallback`);\r\n        return null; // Return null instead of 'en' to let the default language handling work\r\n    }\r\n\r\n    createContainer() {\r\n        // Create main container with unique label for multiple players on same page\r\n        const playerLabel = this.instanceId > 1 \r\n            ? `${i18n.t('player.label')} ${this.instanceId}`\r\n            : i18n.t('player.label');\r\n        \r\n        this.container = DOMUtils.createElement('div', {\r\n            className: `${this.options.classPrefix}-player`,\r\n            attributes: {\r\n                'role': 'application',\r\n                'aria-label': playerLabel,\r\n                'tabindex': '0'\r\n            }\r\n        });\r\n\r\n        // Add media type class\r\n        const mediaType = this.element.tagName.toLowerCase();\r\n        this.container.classList.add(`${this.options.classPrefix}-${mediaType}`);\r\n\r\n        // Add responsive class\r\n        if (this.options.responsive) {\r\n            this.container.classList.add(`${this.options.classPrefix}-responsive`);\r\n        }\r\n\r\n\r\n        // Create video wrapper (for proper positioning of controls)\r\n        this.videoWrapper = DOMUtils.createElement('div', {\r\n            className: `${this.options.classPrefix}-video-wrapper`\r\n        });\r\n\r\n        // Wrap original element\r\n        this.element.parentNode.insertBefore(this.container, this.element);\r\n        \r\n        // Create track artwork element for single audio files (before video wrapper)\r\n        // This shows the poster/artwork above the audio player (similar to playlists)\r\n        if (this.element.tagName === 'AUDIO' && this.options.poster) {\r\n            this.trackArtworkElement = DOMUtils.createElement('div', {\r\n                className: `${this.options.classPrefix}-track-artwork`,\r\n                attributes: {\r\n                    'aria-hidden': 'true'\r\n                }\r\n            });\r\n            this.trackArtworkElement.style.backgroundImage = `url(${this.options.poster})`;\r\n            this.container.appendChild(this.trackArtworkElement);\r\n        }\r\n        \r\n        this.container.appendChild(this.videoWrapper);\r\n        this.videoWrapper.appendChild(this.element);\r\n\r\n        // Hide native controls and set dimensions\r\n        this.element.controls = false;\r\n        this.element.removeAttribute('controls');\r\n        this.element.setAttribute('tabindex', '-1'); // Remove from tab order\r\n        this.element.style.width = '100%';\r\n        this.element.style.height = '100%';\r\n\r\n        // Enable inline playback on iOS (prevents native fullscreen)\r\n        // This allows custom controls to work on iOS devices\r\n        if (this.element.tagName === 'VIDEO' && this.options.playsInline) {\r\n            this.element.setAttribute('playsinline', '');\r\n            this.element.playsInline = true; // Property version\r\n        }\r\n\r\n        // Set dimensions\r\n        if (this.options.width) {\r\n            this.container.style.width = typeof this.options.width === 'number'\r\n                ? `${this.options.width}px`\r\n                : this.options.width;\r\n        }\r\n\r\n        if (this.options.height) {\r\n            this.container.style.height = typeof this.options.height === 'number'\r\n                ? `${this.options.height}px`\r\n                : this.options.height;\r\n        }\r\n\r\n        // Set poster (convert relative paths to absolute URLs)\r\n        if (this.options.poster && this.element.tagName === 'VIDEO') {\r\n            const resolvedPoster = this.resolvePosterPath(this.options.poster);\r\n            this.element.poster = resolvedPoster;\r\n        }\r\n\r\n        // Create centered play button overlay (only for video)\r\n        if (this.element.tagName === 'VIDEO') {\r\n            this.createPlayButtonOverlay();\r\n        }\r\n        \r\n        // Store reference to player on element for easy access\r\n        this.element.vidply = this;\r\n        \r\n        // Add to static instances array\r\n        Player.instances.push(this);\r\n\r\n        // Make video/audio element clickable to toggle play/pause\r\n        this.element.style.cursor = 'pointer';\r\n        this.element.addEventListener('click', (e) => {\r\n            // Prevent if clicking on native controls (shouldn't happen but just in case)\r\n            if (e.target === this.element) {\r\n                this.toggle();\r\n            }\r\n        });\r\n\r\n        this.on('play', () => {\r\n            this.state.hasStartedPlayback = true;\r\n            // Hide poster immediately when playing\r\n            this.hidePosterOverlay();\r\n        });\r\n\r\n        this.on('timeupdate', () => {\r\n            // Hide poster when video has started playing (currentTime > 0)\r\n            if (this.state.currentTime > 0) {\r\n                this.hidePosterOverlay();\r\n            }\r\n        });\r\n\r\n        // Also hide poster on loadeddata event (when first frame is loaded)\r\n        this.element.addEventListener('loadeddata', () => {\r\n            if (this.state.playing || this.state.currentTime > 0) {\r\n                this.hidePosterOverlay();\r\n            }\r\n        }, { once: true });\r\n    }\r\n\r\n    createPlayButtonOverlay() {\r\n        // Create complete SVG play button from Icons.js\r\n        this.playButtonOverlay = createPlayOverlay();\r\n\r\n        // Add click handler\r\n        this.playButtonOverlay.addEventListener('click', () => {\r\n            this.toggle();\r\n        });\r\n\r\n        // Add to video wrapper\r\n        this.videoWrapper.appendChild(this.playButtonOverlay);\r\n\r\n        // Show/hide based on play state\r\n        this.on('play', () => {\r\n            this.playButtonOverlay.style.opacity = '0';\r\n            this.playButtonOverlay.style.pointerEvents = 'none';\r\n        });\r\n\r\n        this.on('pause', () => {\r\n            this.playButtonOverlay.style.opacity = '1';\r\n            this.playButtonOverlay.style.pointerEvents = 'auto';\r\n            this.positionPlayOverlayOnMobile();\r\n        });\r\n\r\n        this.on('ended', () => {\r\n            this.playButtonOverlay.style.opacity = '1';\r\n            this.playButtonOverlay.style.pointerEvents = 'auto';\r\n            this.positionPlayOverlayOnMobile();\r\n        });\r\n        \r\n        // Debounced resize handler\r\n        this.debouncedPositionPlayOverlay = debounce(() => {\r\n            this.positionPlayOverlayOnMobile();\r\n        }, 150);\r\n        \r\n        window.addEventListener('resize', this.debouncedPositionPlayOverlay);\r\n        \r\n        this.on('loadedmetadata', () => {\r\n            this.positionPlayOverlayOnMobile();\r\n        });\r\n        \r\n        // Recalculate on fullscreen change with RAF\r\n        this.on('enterfullscreen', () => {\r\n            rafWithTimeout(() => this.positionPlayOverlayOnMobile(), 100);\r\n        });\r\n        \r\n        this.on('exitfullscreen', () => {\r\n            rafWithTimeout(() => this.positionPlayOverlayOnMobile(), 100);\r\n        });\r\n    }\r\n    \r\n    positionPlayOverlayOnMobile() {\r\n        if (!this.playButtonOverlay || this.element.tagName !== 'VIDEO') {\r\n            return;\r\n        }\r\n        \r\n        const mobile = isMobile();\r\n        \r\n        if (!mobile) {\r\n            // Reset to CSS defaults on desktop\r\n            this.playButtonOverlay.style.top = '';\r\n            return;\r\n        }\r\n        \r\n        const videoRect = this.element.getBoundingClientRect();\r\n        const wrapperRect = this.videoWrapper.getBoundingClientRect();\r\n        const videoCenter = (videoRect.top - wrapperRect.top) + (videoRect.height / 2);\r\n        \r\n        this.playButtonOverlay.style.top = `${videoCenter}px`;\r\n    }\r\n\r\n    async initializeRenderer() {\r\n        // Use pending source for external renderers, or get from element for HTML5\r\n        let src = this._pendingSource || this.element.src || this.element.querySelector('source')?.src;\r\n\r\n        if (!src) {\r\n            throw new Error('No media source found');\r\n        }\r\n        \r\n        // Store the current source for renderers to access\r\n        this.currentSource = src;\r\n        \r\n        // Clear pending source after using it\r\n        this._pendingSource = null;\r\n\r\n        // Initialize audio description sources from elements\r\n        this.audioDescriptionManager.initFromSourceElements(this.sourceElements, this.trackElements);\r\n        \r\n        // Store original source for audio description toggling (fallback if not set by manager)\r\n        if (!this.originalSrc) {\r\n            this.originalSrc = src;\r\n        }\r\n\r\n        // Detect media type and lazily load heavy renderers\r\n        let rendererClass = HTML5Renderer;\r\n\r\n        if (src.includes('youtube.com') || src.includes('youtu.be')) {\r\n            const module = await import('../renderers/YouTubeRenderer.js');\r\n            rendererClass = module.YouTubeRenderer || module.default;\r\n        } else if (src.includes('vimeo.com')) {\r\n            const module = await import('../renderers/VimeoRenderer.js');\r\n            rendererClass = module.VimeoRenderer || module.default;\r\n        } else if (src.includes('.m3u8')) {\r\n            const module = await import('../renderers/HLSRenderer.js');\r\n            rendererClass = module.HLSRenderer || module.default;\r\n        } else if (src.includes('soundcloud.com') || src.includes('api.soundcloud.com')) {\r\n            const module = await import('../renderers/SoundCloudRenderer.js');\r\n            rendererClass = module.SoundCloudRenderer || module.default;\r\n        }\r\n\r\n        this.log(`Using ${rendererClass?.name || 'HTML5Renderer'} renderer`);\r\n        this.renderer = new rendererClass(this);\r\n        await this.renderer.init();\r\n        \r\n        // Invalidate cache after renderer initialization (tracks may have changed)\r\n        this.invalidateTrackCache();\r\n    }\r\n\r\n    /**\r\n     * Get cached text tracks array\r\n     * @returns {Array} Array of text tracks\r\n     */\r\n    get textTracks() {\r\n        if (!this._textTracksCache || this._textTracksDirty) {\r\n            this._textTracksCache = Array.from(this.element.textTracks || []);\r\n            this._textTracksDirty = false;\r\n        }\r\n        return this._textTracksCache;\r\n    }\r\n\r\n    /**\r\n     * Get cached source elements array\r\n     * @returns {Array} Array of source elements\r\n     */\r\n    get sourceElements() {\r\n        if (!this._sourceElementsCache || this._sourceElementsDirty) {\r\n            this._sourceElementsCache = Array.from(this.element.querySelectorAll('source'));\r\n            this._sourceElementsDirty = false;\r\n        }\r\n        return this._sourceElementsCache;\r\n    }\r\n\r\n    /**\r\n     * Get cached track elements array\r\n     * @returns {Array} Array of track elements\r\n     */\r\n    get trackElements() {\r\n        if (!this._trackElementsCache || this._trackElementsDirty) {\r\n            this._trackElementsCache = Array.from(this.element.querySelectorAll('track'));\r\n            this._trackElementsDirty = false;\r\n        }\r\n        return this._trackElementsCache;\r\n    }\r\n\r\n    /**\r\n     * Invalidate DOM query cache (call when tracks/sources change)\r\n     */\r\n    invalidateTrackCache() {\r\n        this._textTracksDirty = true;\r\n        this._trackElementsDirty = true;\r\n        this._sourceElementsDirty = true;\r\n    }\r\n\r\n    /**\r\n     * Find a text track by kind and optionally language\r\n     * @param {string} kind - Track kind (captions, subtitles, descriptions, chapters, metadata)\r\n     * @param {string} [language] - Optional language code\r\n     * @returns {TextTrack|null} Found track or null\r\n     */\r\n    findTextTrack(kind, language = null) {\r\n        const tracks = this.textTracks;\r\n        if (language) {\r\n            return tracks.find(t => t.kind === kind && t.language === language);\r\n        }\r\n        return tracks.find(t => t.kind === kind);\r\n    }\r\n\r\n    /**\r\n     * Find a source element by attribute\r\n     * @param {string} attribute - Attribute name (e.g., 'data-desc-src')\r\n     * @param {string} [value] - Optional attribute value\r\n     * @returns {Element|null} Found source element or null\r\n     */\r\n    findSourceElement(attribute, value = null) {\r\n        const sources = this.sourceElements;\r\n        if (value) {\r\n            return sources.find(el => el.getAttribute(attribute) === value);\r\n        }\r\n        return sources.find(el => el.hasAttribute(attribute));\r\n    }\r\n\r\n    /**\r\n     * Find a track element by its associated TextTrack\r\n     * @param {TextTrack} track - The TextTrack object\r\n     * @returns {Element|null} Found track element or null\r\n     */\r\n    findTrackElement(track) {\r\n        return this.trackElements.find(el => el.track === track);\r\n    }\r\n\r\n    /**\r\n     * Convert relative poster path to absolute URL\r\n     * @param {string} posterPath - Poster path (relative or absolute)\r\n     * @returns {string} Absolute URL\r\n     */\r\n    resolvePosterPath(posterPath) {\r\n        if (!posterPath) {\r\n            return posterPath;\r\n        }\r\n        \r\n        // If already absolute (starts with http://, https://, or /), return as-is\r\n        if (posterPath.match(/^(https?:|\\/)/)) {\r\n            return posterPath;\r\n        }\r\n        \r\n        // Convert relative path to absolute URL\r\n        try {\r\n            const posterUrl = new URL(posterPath, window.location.href);\r\n            return posterUrl.href;\r\n        } catch (e) {\r\n            // If URL constructor fails, return as-is\r\n            return posterPath;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Generate a poster image from video frame at specified time\r\n     * @param {number} time - Time in seconds (default: 10)\r\n     * @returns {Promise<string|null>} Data URL of the poster image or null if failed\r\n     */\r\n    async generatePosterFromVideo(time = 10) {\r\n        // Only for HTML5 video\r\n        if (this.element.tagName !== 'VIDEO') {\r\n            return null;\r\n        }\r\n\r\n        // Check if renderer supports this (HTML5Renderer only)\r\n        const renderer = this.renderer;\r\n        if (!renderer || !renderer.media || renderer.media.tagName !== 'VIDEO') {\r\n            return null;\r\n        }\r\n\r\n        const video = renderer.media;\r\n        \r\n        // Check if video has enough duration\r\n        if (!video.duration || video.duration < time) {\r\n            // Use a smaller time if video is shorter\r\n            time = Math.min(time, Math.max(1, video.duration * 0.1));\r\n        }\r\n\r\n        // Try to use preview video from ControlBar if available (avoids interfering with playback)\r\n        let videoToUse = video;\r\n        if (this.controlBar && this.controlBar.previewVideo && this.controlBar.previewSupported) {\r\n            videoToUse = this.controlBar.previewVideo;\r\n        }\r\n\r\n        // Use shared frame capture utility\r\n        // For main video, restore state; for preview video, no need\r\n        const restoreState = videoToUse === video;\r\n        return await captureVideoFrame(videoToUse, time, {\r\n            restoreState,\r\n            quality: 0.9\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Auto-generate poster from video if none is provided\r\n     */\r\n    async autoGeneratePoster() {\r\n        // Check if poster already exists\r\n        const hasPoster = \r\n            this.element.getAttribute('poster') ||\r\n            this.element.poster ||\r\n            this.options.poster;\r\n\r\n        if (hasPoster) {\r\n            return;\r\n        }\r\n\r\n        // Only for HTML5 video\r\n        if (this.element.tagName !== 'VIDEO') {\r\n            return;\r\n        }\r\n\r\n        // Wait for metadata to be loaded\r\n        if (!this.state.duration || this.state.duration === 0) {\r\n            // Wait for loadedmetadata event\r\n            await new Promise((resolve) => {\r\n                const onLoadedMetadata = () => {\r\n                    this.element.removeEventListener('loadedmetadata', onLoadedMetadata);\r\n                    resolve();\r\n                };\r\n                \r\n                if (this.element.readyState >= 1) {\r\n                    resolve();\r\n                } else {\r\n                    this.element.addEventListener('loadedmetadata', onLoadedMetadata);\r\n                }\r\n            });\r\n        }\r\n\r\n        // Generate poster from second 10\r\n        const posterDataURL = await this.generatePosterFromVideo(10);\r\n        \r\n        if (posterDataURL) {\r\n            // Set as poster\r\n            this.element.poster = posterDataURL;\r\n            this.log('Auto-generated poster from video frame at 10 seconds', 'info');\r\n            \r\n            // Show the poster overlay\r\n            this.showPosterOverlay();\r\n        }\r\n    }\r\n\r\n    showPosterOverlay() {\r\n        if (!this.videoWrapper || this.element.tagName !== 'VIDEO') {\r\n            return;\r\n        }\r\n\r\n        const poster =\r\n            this.element.getAttribute('poster') ||\r\n            this.element.poster ||\r\n            this.options.poster;\r\n\r\n        if (!poster) {\r\n            return;\r\n        }\r\n\r\n        // Resolve relative paths to absolute URLs (skip for data URLs)\r\n        const resolvedPoster = poster.startsWith('data:') \r\n            ? poster \r\n            : this.resolvePosterPath(poster);\r\n        this.videoWrapper.style.setProperty('--vidply-poster-image', `url(\"${resolvedPoster}\")`);\r\n        this.videoWrapper.classList.add('vidply-forced-poster');\r\n        \r\n        // Apply audio content class (16:3 aspect ratio) for audio in video player\r\n        if (this._isAudioContent && this.container) {\r\n            this.container.classList.add('vidply-audio-content');\r\n        } else if (this.container) {\r\n            this.container.classList.remove('vidply-audio-content');\r\n        }\r\n    }\r\n\r\n    hidePosterOverlay() {\r\n        if (!this.videoWrapper) {\r\n            return;\r\n        }\r\n\r\n        this.videoWrapper.classList.remove('vidply-forced-poster');\r\n        this.videoWrapper.style.removeProperty('--vidply-poster-image');\r\n        \r\n        // Note: vidply-audio-content is not removed here because it should persist\r\n        // for the duration of audio content playback, not just poster display\r\n    }\r\n\r\n    /**\r\n     * Set a managed timeout that will be cleaned up on destroy\r\n     * @param {Function} callback - Callback function\r\n     * @param {number} delay - Delay in milliseconds\r\n     * @returns {number} Timeout ID\r\n     */\r\n    setManagedTimeout(callback, delay) {\r\n        const timeoutId = setTimeout(() => {\r\n            this.timeouts.delete(timeoutId);\r\n            callback();\r\n        }, delay);\r\n        this.timeouts.add(timeoutId);\r\n        return timeoutId;\r\n    }\r\n\r\n    /**\r\n     * Clear a managed timeout\r\n     * @param {number} timeoutId - Timeout ID to clear\r\n     */\r\n    clearManagedTimeout(timeoutId) {\r\n        if (timeoutId) {\r\n            clearTimeout(timeoutId);\r\n            this.timeouts.delete(timeoutId);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load new media source (for playlists)\r\n     * @param {Object} config - Media configuration\r\n     * @param {string} config.src - Media source URL\r\n     * @param {string} config.type - Media MIME type\r\n     * @param {string} [config.poster] - Poster image URL\r\n     * @param {Array} [config.tracks] - Text tracks (captions, chapters, etc.)\r\n     * @param {string} [config.audioDescriptionSrc] - Audio description video URL\r\n     * @param {string} [config.signLanguageSrc] - Sign language video URL\r\n     */\r\n    /**\r\n     * Check if a source URL requires an external renderer (YouTube, Vimeo, SoundCloud, HLS)\r\n     * @param {string} src - Source URL\r\n     * @returns {boolean}\r\n     */\r\n    isExternalRendererUrl(src) {\r\n        if (!src) return false;\r\n        return src.includes('youtube.com') || \r\n               src.includes('youtu.be') || \r\n               src.includes('vimeo.com') || \r\n               src.includes('soundcloud.com') || \r\n               src.includes('api.soundcloud.com') ||\r\n               src.includes('.m3u8');\r\n    }\r\n\r\n    async load(config) {\r\n        try {\r\n            this.log('Loading new media:', config.src);\r\n\r\n            // Pause current playback\r\n            if (this.renderer) {\r\n                this.pause();\r\n            }\r\n\r\n            // Save scroll position to prevent browser from auto-scrolling when loading new media\r\n            const scrollX = window.scrollX || window.pageXOffset;\r\n            const scrollY = window.scrollY || window.pageYOffset;\r\n\r\n            // Clear existing text tracks\r\n            const existingTracks = this.trackElements;\r\n            existingTracks.forEach(track => track.remove());\r\n            this.invalidateTrackCache();\r\n\r\n            // Check if this is an external renderer URL\r\n            const isExternalRenderer = this.isExternalRendererUrl(config.src);\r\n            \r\n            // Set flag early to suppress any errors that might fire during the transition\r\n            // This prevents HTML5 element errors from triggering playlist auto-advance\r\n            if (isExternalRenderer) {\r\n                this._switchingRenderer = true;\r\n            }\r\n\r\n            // Only set src on HTML5 element for non-external sources\r\n            // External renderers (YouTube, Vimeo, SoundCloud, HLS) handle their own media loading\r\n            if (!isExternalRenderer) {\r\n                this.element.src = config.src;\r\n\r\n                if (config.type) {\r\n                    this.element.type = config.type;\r\n                }\r\n            } else {\r\n                // For external renderers, clear the src to prevent HTML5 element errors\r\n                // but store the URL for the renderer to use\r\n                // DO NOT call load() here - it will trigger an error event on an element without a valid source\r\n                this.element.removeAttribute('src');\r\n                // Also clear any source elements to prevent errors\r\n                const sources = this.element.querySelectorAll('source');\r\n                sources.forEach(s => s.removeAttribute('src'));\r\n            }\r\n            \r\n            // Store the source URL for external renderers to access\r\n            this._pendingSource = config.src;\r\n            \r\n            // Track if current content is audio (for poster aspect ratio)\r\n            this._isAudioContent = config.type && config.type.startsWith('audio/');\r\n            \r\n            // Apply or remove audio content class (16:3 aspect ratio for audio in video player)\r\n            if (this.container) {\r\n                if (this._isAudioContent) {\r\n                    this.container.classList.add('vidply-audio-content');\r\n                } else {\r\n                    this.container.classList.remove('vidply-audio-content');\r\n                }\r\n            }\r\n            \r\n            // Handle poster display based on content type\r\n            if (config.poster && this.element.tagName === 'VIDEO') {\r\n                if (this._isAudioContent) {\r\n                    // For audio in video player: use CSS poster overlay with 16:3 aspect ratio\r\n                    this.element.removeAttribute('poster');\r\n                    if (this.videoWrapper) {\r\n                        const resolvedPoster = this.resolvePosterPath(config.poster);\r\n                        this.videoWrapper.style.setProperty('--vidply-poster-image', `url(\"${resolvedPoster}\")`);\r\n                        this.videoWrapper.classList.add('vidply-forced-poster');\r\n                    }\r\n                } else {\r\n                    // For video: use normal poster and remove overlay\r\n                    this.element.poster = this.resolvePosterPath(config.poster);\r\n                    if (this.videoWrapper) {\r\n                        this.videoWrapper.classList.remove('vidply-forced-poster');\r\n                        this.videoWrapper.style.removeProperty('--vidply-poster-image');\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Add new text tracks\r\n            if (config.tracks && config.tracks.length > 0) {\r\n                config.tracks.forEach(trackConfig => {\r\n                    const track = document.createElement('track');\r\n                    track.src = trackConfig.src;\r\n                    track.kind = trackConfig.kind || 'captions';\r\n                    track.srclang = trackConfig.srclang || 'en';\r\n                    track.label = trackConfig.label || trackConfig.srclang;\r\n\r\n                    if (trackConfig.default) {\r\n                        track.default = true;\r\n                    }\r\n                    \r\n                    // Support described track sources for audio description track swapping\r\n                    if (trackConfig.describedSrc) {\r\n                        track.setAttribute('data-desc-src', trackConfig.describedSrc);\r\n                    }\r\n\r\n                    // Insert tracks at the beginning (before any flow content) for HTML5 validity\r\n                    const firstChild = this.element.firstChild;\r\n                    if (firstChild && firstChild.nodeType === Node.ELEMENT_NODE && firstChild.tagName !== 'TRACK') {\r\n                        this.element.insertBefore(track, firstChild);\r\n                    } else {\r\n                        this.element.appendChild(track);\r\n                    }\r\n                });\r\n                this.invalidateTrackCache();\r\n            }\r\n            \r\n            // Remember accessibility feature states before switching tracks\r\n            const wasSignLanguageEnabled = this.state.signLanguageEnabled;\r\n            const wasAudioDescriptionEnabled = this.state.audioDescriptionEnabled;\r\n            \r\n            // Update sources from config FIRST (before hiding features)\r\n            this.audioDescriptionSrc = config.audioDescriptionSrc || null;\r\n            this.signLanguageSrc = config.signLanguageSrc || null;\r\n            \r\n            // Update original source for toggling\r\n            this.originalSrc = config.src;\r\n            \r\n            // Update manager sources for playlist changes\r\n            if (this.audioDescriptionManager) {\r\n                this.audioDescriptionManager.updateSources(config.audioDescriptionSrc);\r\n                // Reinitialize to pick up new track elements with data-desc-src attributes\r\n                this.audioDescriptionManager.reinitialize();\r\n            }\r\n            if (this.signLanguageManager) {\r\n                this.signLanguageManager.updateSources(config.signLanguageSrc, config.signLanguageSources);\r\n            }\r\n            \r\n            // Hide accessibility features that were enabled (must happen AFTER updating sources)\r\n            if (wasAudioDescriptionEnabled) {\r\n                this.disableAudioDescription();\r\n            }\r\n            if (wasSignLanguageEnabled) {\r\n                this.disableSignLanguage();\r\n            }\r\n\r\n            // Check if we need to change renderer type\r\n            const shouldChangeRenderer = this.shouldChangeRenderer(config.src);\r\n\r\n            // Destroy old renderer if changing types\r\n            if (shouldChangeRenderer && this.renderer) {\r\n                this.renderer.destroy();\r\n                this.renderer = null;\r\n            }\r\n\r\n            // Initialize or reinitialize renderer\r\n            if (!this.renderer || shouldChangeRenderer) {\r\n                await this.initializeRenderer();\r\n            } else {\r\n                // Just reload the current renderer with the updated element\r\n                this.renderer.media = this.element; // Update media reference\r\n                if (this.options.deferLoad) {\r\n                    try {\r\n                        // Keep configured preload behavior; actual network load is controlled\r\n                        // by ensureLoaded()/play() when deferLoad is enabled.\r\n                        this.element.preload = this.options.preload || 'metadata';\r\n                    } catch (e) {\r\n                        // ignore\r\n                    }\r\n                    // Reset renderer-level deferred flags if present (HTML5/HLS renderers)\r\n                    if (this.renderer) {\r\n                        if (typeof this.renderer._didDeferredLoad === 'boolean') {\r\n                            this.renderer._didDeferredLoad = false;\r\n                        }\r\n                        if (typeof this.renderer._hlsSourceLoaded === 'boolean') {\r\n                            this.renderer._hlsSourceLoaded = false;\r\n                        }\r\n                        if ('_pendingSrc' in this.renderer) {\r\n                            // For HLS, store pending src for the first play() call\r\n                            this.renderer._pendingSrc = this._pendingSource || this.currentSource || null;\r\n                        }\r\n                    }\r\n                } else {\r\n                    this.element.load();\r\n                }\r\n            }\r\n            \r\n            // Clear the renderer switching flag after a delay to catch async errors\r\n            // This prevents errors from the old renderer's event queue from causing issues\r\n            if (isExternalRenderer) {\r\n                setTimeout(() => {\r\n                    this._switchingRenderer = false;\r\n                }, 500);\r\n            } else {\r\n                this._switchingRenderer = false;\r\n            }\r\n            \r\n            // Restore scroll position immediately after loading to prevent auto-scroll\r\n            window.scrollTo(scrollX, scrollY);\r\n\r\n            // Reinitialize caption manager to pick up new tracks\r\n            if (this.captionManager) {\r\n                this.captionManager.destroy();\r\n                this.captionManager = new CaptionManager(this);\r\n            }\r\n            \r\n            // Reinitialize transcript manager to pick up new tracks\r\n            if (this.transcriptManager) {\r\n                const wasTranscriptVisible = this.transcriptManager.isVisible;\r\n                this.transcriptManager.destroy();\r\n                this.transcriptManager = null;\r\n\r\n                await this.ensureTranscriptManager();\r\n                \r\n                // Only restore transcript visibility if new track has captions\r\n                if (wasTranscriptVisible && this.controlBar && this.controlBar.hasCaptionTracks()) {\r\n                    this.transcriptManager?.showTranscript();\r\n                }\r\n            }\r\n            \r\n            // Update control bar to show/hide feature buttons based on new tracks\r\n            if (this.controlBar) {\r\n                this.updateControlBar();\r\n            }\r\n            \r\n            // Restore scroll position after control bar update (may have caused micro-scrolls)\r\n            window.scrollTo(scrollX, scrollY);\r\n            \r\n            // Restore accessibility features if they were enabled and available in new track\r\n            if (wasSignLanguageEnabled && this.signLanguageSrc) {\r\n                // Small delay to ensure player and control bar are ready\r\n                setTimeout(() => {\r\n                    this.enableSignLanguage();\r\n                    // Restore scroll after sign language is shown\r\n                    window.scrollTo(scrollX, scrollY);\r\n                }, 150);\r\n            }\r\n            \r\n            if (wasAudioDescriptionEnabled && this.audioDescriptionSrc) {\r\n                // Small delay to ensure player is ready\r\n                setTimeout(() => {\r\n                    this.enableAudioDescription();\r\n                    // Restore scroll after audio description is enabled\r\n                    window.scrollTo(scrollX, scrollY);\r\n                }, 150);\r\n            }\r\n\r\n            this.emit('sourcechange', config);\r\n            this.log('Media loaded successfully');\r\n\r\n        } catch (error) {\r\n            this.handleError(error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Ensure the current renderer has started its initial load (metadata/manifest)\r\n     * without starting playback. This is useful for playlists to behave like\r\n     * single videos on selection, while still keeping autoplay off.\r\n     */\r\n    ensureLoaded() {\r\n        try {\r\n            if (!this.renderer) return;\r\n            if (typeof this.renderer.ensureLoaded === 'function') {\r\n                this.renderer.ensureLoaded();\r\n            }\r\n        } catch (e) {\r\n            // ignore\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if we need to change renderer type\r\n     * @param {string} src - New source URL\r\n     * @returns {boolean}\r\n     */\r\n    /**\r\n     * Update control bar to refresh button visibility based on available features\r\n     */\r\n    updateControlBar() {\r\n        if (!this.controlBar) return;\r\n        \r\n        const controlBar = this.controlBar;\r\n        \r\n        // Clear existing controls content\r\n        controlBar.element.innerHTML = '';\r\n        \r\n        // Recreate controls with updated feature detection\r\n        controlBar.createControls();\r\n        \r\n        // Reattach events for the new controls\r\n        controlBar.attachEvents();\r\n        controlBar.setupAutoHide();\r\n        controlBar.setupOverflowDetection();\r\n    }\r\n    \r\n    shouldChangeRenderer(src) {\r\n        if (!this.renderer) return true;\r\n\r\n        const isYouTube = src.includes('youtube.com') || src.includes('youtu.be');\r\n        const isVimeo = src.includes('vimeo.com');\r\n        const isHLS = src.includes('.m3u8');\r\n        const isSoundCloud = src.includes('soundcloud.com') || src.includes('api.soundcloud.com');\r\n\r\n        const currentRendererName = this.renderer.constructor.name;\r\n\r\n        if (isYouTube && currentRendererName !== 'YouTubeRenderer') return true;\r\n        if (isVimeo && currentRendererName !== 'VimeoRenderer') return true;\r\n        if (isHLS && currentRendererName !== 'HLSRenderer') return true;\r\n        if (isSoundCloud && currentRendererName !== 'SoundCloudRenderer') return true;\r\n        if (!isYouTube && !isVimeo && !isHLS && !isSoundCloud && currentRendererName !== 'HTML5Renderer') return true;\r\n\r\n        return false;\r\n    }\r\n\r\n    // Playback controls\r\n    play() {\r\n        if (this.renderer) {\r\n            this.renderer.play();\r\n            return;\r\n        }\r\n\r\n        // Playlist support: if no renderer exists yet (no initial src),\r\n        // start playback via playlist selection.\r\n        if (this.playlistManager && Array.isArray(this.playlistManager.tracks) && this.playlistManager.tracks.length > 0) {\r\n            const index = this.playlistManager.currentIndex >= 0 ? this.playlistManager.currentIndex : 0;\r\n            this.playlistManager.play(index, true);\r\n        }\r\n    }\r\n\r\n    pause() {\r\n        if (this.renderer) {\r\n            this.renderer.pause();\r\n        }\r\n    }\r\n\r\n    stop() {\r\n        this.pause();\r\n        this.seek(0);\r\n    }\r\n\r\n    toggle() {\r\n        if (this.state.playing) {\r\n            this.pause();\r\n        } else {\r\n            this.play();\r\n        }\r\n    }\r\n\r\n    seek(time) {\r\n        if (this.renderer) {\r\n            this.renderer.seek(time);\r\n        }\r\n    }\r\n\r\n    seekForward(interval = this.options.seekInterval) {\r\n        this.seek(Math.min(this.state.currentTime + interval, this.state.duration));\r\n    }\r\n\r\n    seekBackward(interval = this.options.seekInterval) {\r\n        this.seek(Math.max(this.state.currentTime - interval, 0));\r\n    }\r\n\r\n    // Volume controls\r\n    setVolume(volume) {\r\n        const newVolume = Math.max(0, Math.min(1, volume));\r\n        if (this.renderer) {\r\n            this.renderer.setVolume(newVolume);\r\n        }\r\n        this.state.volume = newVolume;\r\n\r\n        // If volume is increased above 0 and currently muted, unmute\r\n        if (newVolume > 0 && this.state.muted) {\r\n            this.state.muted = false;\r\n            if (this.renderer) {\r\n                this.renderer.setMuted(false);\r\n            }\r\n            this.emit('volumechange');\r\n        }\r\n        \r\n        this.savePlayerPreferences();\r\n    }\r\n\r\n    getVolume() {\r\n        return this.state.volume;\r\n    }\r\n\r\n    mute() {\r\n        if (this.renderer) {\r\n            this.renderer.setMuted(true);\r\n        }\r\n        this.state.muted = true;\r\n        this.savePlayerPreferences();\r\n        this.emit('volumechange');\r\n    }\r\n\r\n    unmute() {\r\n        if (this.renderer) {\r\n            this.renderer.setMuted(false);\r\n        }\r\n        this.state.muted = false;\r\n        this.savePlayerPreferences();\r\n        this.emit('volumechange');\r\n    }\r\n\r\n    toggleMute() {\r\n        if (this.state.muted) {\r\n            this.unmute();\r\n        } else {\r\n            this.mute();\r\n        }\r\n    }\r\n\r\n    // Playback speed\r\n    setPlaybackSpeed(speed) {\r\n        const newSpeed = Math.max(0.25, Math.min(2, speed));\r\n        if (this.renderer) {\r\n            this.renderer.setPlaybackSpeed(newSpeed);\r\n        }\r\n        this.state.playbackSpeed = newSpeed;\r\n        this.savePlayerPreferences();\r\n        this.emit('playbackspeedchange', newSpeed);\r\n    }\r\n\r\n    getPlaybackSpeed() {\r\n        return this.state.playbackSpeed;\r\n    }\r\n    \r\n    // Save player preferences to localStorage\r\n    savePlayerPreferences() {\r\n        this.storage.savePlayerPreferences({\r\n            volume: this.state.volume,\r\n            muted: this.state.muted,\r\n            playbackSpeed: this.state.playbackSpeed\r\n        });\r\n    }\r\n\r\n    // Fullscreen\r\n    enterFullscreen() {\r\n        const elem = this.container;\r\n        let fullscreenPromise = null;\r\n\r\n        // Detect iOS/iPadOS to avoid native fullscreen conflicts\r\n        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || \r\n                     (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);\r\n        \r\n        // On iOS/iPadOS, always use pseudo-fullscreen to avoid video element native fullscreen\r\n        if (isIOS) {\r\n            this._enablePseudoFullscreen();\r\n            return;\r\n        }\r\n\r\n        // Try to use native Fullscreen API on other platforms\r\n        if (elem.requestFullscreen) {\r\n            fullscreenPromise = elem.requestFullscreen();\r\n        } else if (elem.webkitRequestFullscreen) {\r\n            fullscreenPromise = elem.webkitRequestFullscreen();\r\n        } else if (elem.mozRequestFullScreen) {\r\n            fullscreenPromise = elem.mozRequestFullScreen();\r\n        } else if (elem.msRequestFullscreen) {\r\n            fullscreenPromise = elem.msRequestFullscreen();\r\n        }\r\n\r\n        // Handle promise-based API (modern browsers)\r\n        if (fullscreenPromise && fullscreenPromise.catch) {\r\n            fullscreenPromise.catch((err) => {\r\n                // Fullscreen API failed, use pseudo-fullscreen fallback\r\n                this.log('Fullscreen API failed, using pseudo-fullscreen:', err.message);\r\n                this._enablePseudoFullscreen();\r\n            });\r\n        }\r\n\r\n        // For browsers without Fullscreen API support, use pseudo-fullscreen\r\n        if (!elem.requestFullscreen && !elem.webkitRequestFullscreen && \r\n            !elem.mozRequestFullScreen && !elem.msRequestFullscreen) {\r\n            this._enablePseudoFullscreen();\r\n        } else {\r\n            // Optimistically set state (will be corrected by fullscreenChangeHandler if it fails)\r\n            this.state.fullscreen = true;\r\n            this.container.classList.add(`${this.options.classPrefix}-fullscreen`);\r\n            this.emit('fullscreenchange', true);\r\n        }\r\n    }\r\n\r\n    exitFullscreen() {\r\n        // Check if we're in native fullscreen\r\n        const isInNativeFullscreen = !!(\r\n            document.fullscreenElement ||\r\n            document.webkitFullscreenElement ||\r\n            document.mozFullScreenElement ||\r\n            document.msFullscreenElement\r\n        );\r\n\r\n        if (isInNativeFullscreen) {\r\n            // Exit native fullscreen\r\n            if (document.exitFullscreen) {\r\n                document.exitFullscreen();\r\n            } else if (document.webkitExitFullscreen) {\r\n                document.webkitExitFullscreen();\r\n            } else if (document.mozCancelFullScreen) {\r\n                document.mozCancelFullScreen();\r\n            } else if (document.msExitFullscreen) {\r\n                document.msExitFullscreen();\r\n            }\r\n        } else {\r\n            // We're in pseudo-fullscreen, exit it manually\r\n            this._disablePseudoFullscreen();\r\n        }\r\n\r\n        this.state.fullscreen = false;\r\n        this.container.classList.remove(`${this.options.classPrefix}-fullscreen`);\r\n        this.emit('fullscreenchange', false);\r\n    }\r\n\r\n    toggleFullscreen() {\r\n        if (this.state.fullscreen) {\r\n            this.exitFullscreen();\r\n        } else {\r\n            this.enterFullscreen();\r\n        }\r\n    }\r\n\r\n    // Pseudo-fullscreen fallback for iOS and browsers without Fullscreen API\r\n    _enablePseudoFullscreen() {\r\n        this.state.fullscreen = true;\r\n        this.container.classList.add(`${this.options.classPrefix}-fullscreen`);\r\n        \r\n        // Add body class for CSS targeting (fallback for browsers without :has() support)\r\n        document.body.classList.add('vidply-fullscreen-active');\r\n        \r\n        // Store current scroll position for restoration later\r\n        this._originalScrollX = window.scrollX || window.pageXOffset;\r\n        this._originalScrollY = window.scrollY || window.pageYOffset;\r\n        \r\n        // Prevent body scrolling while in pseudo-fullscreen\r\n        this._originalBodyOverflow = document.body.style.overflow;\r\n        this._originalBodyPosition = document.body.style.position;\r\n        this._originalBodyWidth = document.body.style.width;\r\n        this._originalBodyHeight = document.body.style.height;\r\n        this._originalHtmlOverflow = document.documentElement.style.overflow;\r\n        this._originalBodyBackground = document.body.style.background;\r\n        this._originalHtmlBackground = document.documentElement.style.background;\r\n        \r\n        document.body.style.overflow = 'hidden';\r\n        document.body.style.width = '100%';\r\n        document.body.style.height = '100%';\r\n        document.body.style.background = '#000';\r\n        document.documentElement.style.overflow = 'hidden';\r\n        document.documentElement.style.background = '#000';\r\n        \r\n        // On iOS, also lock the viewport and scroll to top\r\n        this._originalViewport = document.querySelector('meta[name=\"viewport\"]')?.getAttribute('content');\r\n        const viewport = document.querySelector('meta[name=\"viewport\"]');\r\n        if (viewport) {\r\n            viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');\r\n        }\r\n        \r\n        // Scroll to top on iOS to prevent positioning issues\r\n        window.scrollTo(0, 0);\r\n        \r\n        // Make all other page content inert to prevent keyboard focus escaping to background\r\n        this._makeBackgroundInert();\r\n        \r\n        this.emit('fullscreenchange', true);\r\n        this.emit('enterfullscreen');\r\n    }\r\n    \r\n    /**\r\n     * Makes all page content except the fullscreen player inert (non-focusable)\r\n     * This prevents keyboard navigation from focusing on hidden background elements\r\n     */\r\n    _makeBackgroundInert() {\r\n        this._inertElements = [];\r\n        \r\n        // Find all siblings and ancestors' siblings that should be made inert\r\n        let current = this.container;\r\n        while (current && current !== document.body && current !== document.documentElement) {\r\n            const parent = current.parentElement;\r\n            if (parent) {\r\n                // Make all siblings inert\r\n                Array.from(parent.children).forEach(sibling => {\r\n                    if (sibling !== current && \r\n                        sibling.nodeType === Node.ELEMENT_NODE &&\r\n                        !sibling.hasAttribute('inert') &&\r\n                        sibling.tagName !== 'SCRIPT' &&\r\n                        sibling.tagName !== 'STYLE' &&\r\n                        sibling.tagName !== 'LINK' &&\r\n                        sibling.tagName !== 'META') {\r\n                        sibling.setAttribute('inert', '');\r\n                        this._inertElements.push(sibling);\r\n                    }\r\n                });\r\n            }\r\n            current = parent;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Restores interactivity to elements that were made inert during fullscreen\r\n     */\r\n    _restoreBackgroundInteractivity() {\r\n        if (this._inertElements) {\r\n            this._inertElements.forEach(el => {\r\n                el.removeAttribute('inert');\r\n            });\r\n            this._inertElements = [];\r\n        }\r\n    }\r\n\r\n    _disablePseudoFullscreen() {\r\n        // Remove body class for CSS targeting\r\n        document.body.classList.remove('vidply-fullscreen-active');\r\n        \r\n        // Restore interactivity to background elements\r\n        this._restoreBackgroundInteractivity();\r\n        \r\n        // Restore body scrolling\r\n        if (this._originalBodyOverflow !== undefined) {\r\n            document.body.style.overflow = this._originalBodyOverflow;\r\n            delete this._originalBodyOverflow;\r\n        }\r\n        if (this._originalBodyPosition !== undefined) {\r\n            document.body.style.position = this._originalBodyPosition;\r\n            delete this._originalBodyPosition;\r\n        }\r\n        if (this._originalBodyWidth !== undefined) {\r\n            document.body.style.width = this._originalBodyWidth;\r\n            delete this._originalBodyWidth;\r\n        }\r\n        if (this._originalBodyHeight !== undefined) {\r\n            document.body.style.height = this._originalBodyHeight;\r\n            delete this._originalBodyHeight;\r\n        }\r\n        if (this._originalHtmlOverflow !== undefined) {\r\n            document.documentElement.style.overflow = this._originalHtmlOverflow;\r\n            delete this._originalHtmlOverflow;\r\n        }\r\n        if (this._originalBodyBackground !== undefined) {\r\n            document.body.style.background = this._originalBodyBackground;\r\n            delete this._originalBodyBackground;\r\n        }\r\n        if (this._originalHtmlBackground !== undefined) {\r\n            document.documentElement.style.background = this._originalHtmlBackground;\r\n            delete this._originalHtmlBackground;\r\n        }\r\n        \r\n        // Restore viewport settings\r\n        if (this._originalViewport !== undefined) {\r\n            const viewport = document.querySelector('meta[name=\"viewport\"]');\r\n            if (viewport) {\r\n                viewport.setAttribute('content', this._originalViewport);\r\n            }\r\n            delete this._originalViewport;\r\n        }\r\n        \r\n        // Restore scroll position\r\n        if (this._originalScrollX !== undefined && this._originalScrollY !== undefined) {\r\n            window.scrollTo(this._originalScrollX, this._originalScrollY);\r\n            delete this._originalScrollX;\r\n            delete this._originalScrollY;\r\n        }\r\n        \r\n        this.emit('exitfullscreen');\r\n    }\r\n\r\n    // Picture-in-Picture\r\n    enterPiP() {\r\n        if (this.element.requestPictureInPicture) {\r\n            this.element.requestPictureInPicture();\r\n            this.state.pip = true;\r\n            this.emit('pipchange', true);\r\n        }\r\n    }\r\n\r\n    exitPiP() {\r\n        if (document.pictureInPictureElement) {\r\n            document.exitPictureInPicture();\r\n            this.state.pip = false;\r\n            this.emit('pipchange', false);\r\n        }\r\n    }\r\n\r\n    togglePiP() {\r\n        if (this.state.pip) {\r\n            this.exitPiP();\r\n        } else {\r\n            this.enterPiP();\r\n        }\r\n    }\r\n\r\n    // Captions\r\n    enableCaptions() {\r\n        if (this.captionManager) {\r\n            this.captionManager.enable();\r\n            this.state.captionsEnabled = true;\r\n        }\r\n    }\r\n\r\n    disableCaptions() {\r\n        if (this.captionManager) {\r\n            this.captionManager.disable();\r\n            this.state.captionsEnabled = false;\r\n        }\r\n    }\r\n\r\n    toggleCaptions() {\r\n        if (this.state.captionsEnabled) {\r\n            this.disableCaptions();\r\n        } else {\r\n            this.enableCaptions();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if a track file exists\r\n     * @param {string} url - Track file URL\r\n     * @returns {Promise<boolean>} - True if file exists\r\n     */\r\n    async validateTrackExists(url) {\r\n        try {\r\n            const response = await fetch(url, { method: 'HEAD', cache: 'no-cache' });\r\n            return response.ok;\r\n        } catch (error) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Strip VTT formatting tags from caption text\r\n     * @param {string} text - Caption text with VTT formatting\r\n     * @returns {string} Plain text without formatting\r\n     */\r\n    stripVTTFormatting(text) {\r\n        if (!text) return '';\r\n        return text\r\n            .replace(/<[^>]+>/g, '') // Remove all HTML/VTT tags\r\n            .replace(/\\n/g, ' ')      // Replace newlines with spaces\r\n            .trim()\r\n            .toLowerCase();           // Normalize to lowercase for comparison\r\n    }\r\n\r\n    /**\r\n     * Find matching caption time based on text content\r\n     * Useful for syncing between videos of different lengths (e.g., with/without audio description)\r\n     * @param {string} targetText - Caption text to search for\r\n     * @param {Array} tracks - Array of caption tracks to search in\r\n     * @returns {number|null} Start time of matching caption, or null if not found\r\n     */\r\n    findMatchingCaptionTime(targetText, tracks) {\r\n        if (!targetText || !tracks || tracks.length === 0) {\r\n            return null;\r\n        }\r\n\r\n        const normalizedTarget = this.stripVTTFormatting(targetText);\r\n        \r\n        // Search through all caption/subtitle tracks\r\n        for (const trackInfo of tracks) {\r\n            if (trackInfo.kind !== 'captions' && trackInfo.kind !== 'subtitles') {\r\n                continue;\r\n            }\r\n\r\n            const track = trackInfo.track;\r\n            if (!track || !track.cues) {\r\n                continue;\r\n            }\r\n\r\n            // Search through all cues in this track\r\n            for (let i = 0; i < track.cues.length; i++) {\r\n                const cue = track.cues[i];\r\n                const cueText = this.stripVTTFormatting(cue.text);\r\n                \r\n                // Check for exact match or very similar match (at least 80% of words match)\r\n                if (cueText === normalizedTarget) {\r\n                    return cue.startTime;\r\n                }\r\n                \r\n                // Fuzzy matching: check if most words match\r\n                const targetWords = normalizedTarget.split(/\\s+/).filter(w => w.length > 2);\r\n                const cueWords = cueText.split(/\\s+/).filter(w => w.length > 2);\r\n                \r\n                if (targetWords.length > 0 && cueWords.length > 0) {\r\n                    const matchingWords = targetWords.filter(word => cueWords.includes(word));\r\n                    const matchRatio = matchingWords.length / targetWords.length;\r\n                    \r\n                    // If 80% or more words match, consider it a match\r\n                    if (matchRatio >= 0.8) {\r\n                        return cue.startTime;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    // Audio Description (delegated to AudioDescriptionManager)\r\n    async enableAudioDescription() {\r\n        return this.audioDescriptionManager.enable();\r\n    }\r\n\r\n    // Legacy method body preserved for reference - can be removed after testing\r\n    async _legacyEnableAudioDescription() {\r\n        // Check if we have source elements with data-desc-src (even if audioDescriptionSrc is not set)\r\n        const hasSourceElementsWithDesc = this.sourceElements.some(el => el.getAttribute('data-desc-src'));\r\n        const hasTracksWithDesc = this.audioDescriptionCaptionTracks.length > 0;\r\n        \r\n        if (!this.audioDescriptionSrc && !hasSourceElementsWithDesc && !hasTracksWithDesc) {\r\n            console.warn('VidPly: No audio description source, source elements, or tracks provided');\r\n            return;\r\n        }\r\n\r\n        // Store current playback state\r\n        // Use element.currentTime directly, not state, as state may not be up-to-date\r\n        const currentTime = this.element.currentTime;\r\n        const wasPlaying = this.state.playing;\r\n        const shouldKeepPoster = !wasPlaying && currentTime === 0;\r\n        \r\n        // Try to find the current caption text for synchronization\r\n        // This helps when switching between videos of different lengths\r\n        let currentCaptionText = null;\r\n        if (this.captionManager && this.captionManager.currentTrack) {\r\n            const track = this.captionManager.currentTrack.track;\r\n            if (track && track.activeCues && track.activeCues.length > 0) {\r\n                const activeCue = track.activeCues[0];\r\n                currentCaptionText = this.stripVTTFormatting(activeCue.text);\r\n            }\r\n        }\r\n        \r\n        // Store poster to preserve it during source swap\r\n        // Convert relative paths to absolute URLs to prevent resolution issues\r\n        const posterValue = this.resolvePosterPath(\r\n            this.element.getAttribute('poster') || \r\n            this.element.poster || \r\n            this.options.poster\r\n        );\r\n\r\n        if (shouldKeepPoster) {\r\n            this.showPosterOverlay();\r\n        }\r\n\r\n        // Store swapped tracks for transcript reload (declare at function scope)\r\n        let swappedTracksForTranscript = [];\r\n\r\n        // Switch to audio-described version\r\n        // If we have a source element with audio description attributes, update that instead\r\n        if (this.audioDescriptionSourceElement) {\r\n            const currentSrc = this.element.currentSrc || this.element.src;\r\n            \r\n            // Find the source element that matches the currently active source\r\n            const sourceElements = this.sourceElements;\r\n            let sourceElementToUpdate = null;\r\n            let descSrc = this.audioDescriptionSrc;\r\n            \r\n            for (const sourceEl of sourceElements) {\r\n                const sourceSrc = sourceEl.getAttribute('src');\r\n                const descSrcAttr = sourceEl.getAttribute('data-desc-src');\r\n                \r\n                // Check if this source matches the current source (by filename)\r\n                // Match by full path or just filename\r\n                const sourceFilename = sourceSrc ? sourceSrc.split('/').pop() : '';\r\n                const currentFilename = currentSrc ? currentSrc.split('/').pop() : '';\r\n                \r\n                if (currentSrc && (currentSrc === sourceSrc || \r\n                    currentSrc.includes(sourceSrc) || \r\n                    currentSrc.includes(sourceFilename) ||\r\n                    (sourceFilename && currentFilename === sourceFilename))) {\r\n                    sourceElementToUpdate = sourceEl;\r\n                    if (descSrcAttr) {\r\n                        descSrc = descSrcAttr;\r\n                    } else if (sourceSrc) {\r\n                        // If no data-desc-src, try to construct it from the source\r\n                        // But prefer the stored audioDescriptionSrc if available\r\n                        descSrc = this.audioDescriptionSrc || descSrc;\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n            \r\n            // If we didn't find a match, use the stored source element\r\n            if (!sourceElementToUpdate) {\r\n                sourceElementToUpdate = this.audioDescriptionSourceElement;\r\n                // Ensure we have the correct descSrc from the stored element\r\n                const storedDescSrc = sourceElementToUpdate.getAttribute('data-desc-src');\r\n                if (storedDescSrc) {\r\n                    descSrc = storedDescSrc;\r\n                }\r\n            }\r\n            \r\n            // Swap caption tracks to described versions BEFORE loading\r\n            if (this.audioDescriptionCaptionTracks.length > 0) {\r\n                // Swap tracks: validate explicit tracks, but try auto-detected tracks without validation\r\n                // This avoids 404 errors while still allowing auto-detection to work\r\n                const validationPromises = this.audioDescriptionCaptionTracks.map(async (trackInfo) => {\r\n                    if (trackInfo.trackElement && trackInfo.describedSrc) {\r\n                        // Only validate explicitly defined tracks (to confirm they exist)\r\n                        // Auto-detected tracks are used without validation (browser will handle missing files gracefully)\r\n                        if (trackInfo.explicit === true) {\r\n                            try {\r\n                                const exists = await this.validateTrackExists(trackInfo.describedSrc);\r\n                                return { trackInfo, exists };\r\n                            } catch (error) {\r\n                                // Silently handle validation errors\r\n                                return { trackInfo, exists: false };\r\n                            }\r\n                        } else {\r\n                            // This shouldn't happen since auto-detection is disabled\r\n                            // But if it does, don't validate to avoid 404s\r\n                            return { trackInfo, exists: false };\r\n                        }\r\n                    }\r\n                    return { trackInfo, exists: false };\r\n                });\r\n                \r\n                const validationResults = await Promise.all(validationPromises);\r\n                const tracksToSwap = validationResults.filter(result => result.exists);\r\n                \r\n                if (tracksToSwap.length > 0) {\r\n                    // Store original track modes before removing tracks\r\n                    const trackModes = new Map();\r\n                    tracksToSwap.forEach(({ trackInfo }) => {\r\n                        const textTrack = trackInfo.trackElement.track;\r\n                        if (textTrack) {\r\n                            trackModes.set(trackInfo, {\r\n                                wasShowing: textTrack.mode === 'showing',\r\n                                wasHidden: textTrack.mode === 'hidden'\r\n                            });\r\n                        } else {\r\n                            trackModes.set(trackInfo, {\r\n                                wasShowing: false,\r\n                                wasHidden: false\r\n                            });\r\n                        }\r\n                    });\r\n                    \r\n                    // Store all track information before removing\r\n                    const tracksToReadd = tracksToSwap.map(({ trackInfo }) => {\r\n                        const oldSrc = trackInfo.trackElement.getAttribute('src');\r\n                        const parent = trackInfo.trackElement.parentNode;\r\n                        const nextSibling = trackInfo.trackElement.nextSibling;\r\n                        \r\n                        // Store all attributes from the old track\r\n                        const attributes = {};\r\n                        Array.from(trackInfo.trackElement.attributes).forEach(attr => {\r\n                            attributes[attr.name] = attr.value;\r\n                        });\r\n                        \r\n                        return {\r\n                            trackInfo,\r\n                            oldSrc,\r\n                            parent,\r\n                            nextSibling,\r\n                            attributes\r\n                        };\r\n                    });\r\n                    \r\n                    // Remove ALL old tracks first to force browser to clear TextTrack objects\r\n                    tracksToReadd.forEach(({ trackInfo }) => {\r\n                        trackInfo.trackElement.remove();\r\n                    });\r\n                    \r\n                    // Force browser to process the removal by calling load()\r\n                    this.element.load();\r\n                    \r\n                    // Wait for browser to process the removal, then add new tracks\r\n                    // Use await to ensure this completes before continuing\r\n                    await new Promise(resolve => {\r\n                        setTimeout(() => {\r\n                            tracksToReadd.forEach(({ trackInfo, oldSrc, parent, nextSibling, attributes }) => {\r\n                                swappedTracksForTranscript.push(trackInfo);\r\n                                \r\n                                // Create a completely new track element (not a clone) to force browser to create new TextTrack\r\n                                const newTrackElement = document.createElement('track');\r\n                                newTrackElement.setAttribute('src', trackInfo.describedSrc);\r\n                                \r\n                                // Copy all attributes except src and data-desc-src\r\n                                Object.keys(attributes).forEach(attrName => {\r\n                                    if (attrName !== 'src' && attrName !== 'data-desc-src') {\r\n                                        newTrackElement.setAttribute(attrName, attributes[attrName]);\r\n                                    }\r\n                                });\r\n                                \r\n                                // Insert new track element\r\n                                if (nextSibling && nextSibling.parentNode) {\r\n                                    parent.insertBefore(newTrackElement, nextSibling);\r\n                                } else {\r\n                                    parent.appendChild(newTrackElement);\r\n                                }\r\n                                \r\n                                // Update reference to the new track element\r\n                                trackInfo.trackElement = newTrackElement;\r\n                            });\r\n                            \r\n                            this.invalidateTrackCache();\r\n                            \r\n                            // Wait for loadedmetadata event before accessing new TextTrack objects\r\n                            const setupNewTracks = () => {\r\n                                // Wait a bit more for browser to fully process the new track elements\r\n                                this.setManagedTimeout(() => {\r\n                                    swappedTracksForTranscript.forEach((trackInfo) => {\r\n                                        const trackElement = trackInfo.trackElement;\r\n                                        const newTextTrack = trackElement.track;\r\n                                        \r\n                                        if (newTextTrack) {\r\n                                            // Get original mode from stored map\r\n                                            const modeInfo = trackModes.get(trackInfo) || { wasShowing: false, wasHidden: false };\r\n                                            \r\n                                            // Set mode to load the new track\r\n                                            newTextTrack.mode = 'hidden'; // Use hidden to load cues without showing\r\n                                            \r\n                                            // Restore original mode after track loads\r\n                                            // Note: CaptionManager will handle enabling captions separately\r\n                                            const restoreMode = () => {\r\n                                                if (modeInfo.wasShowing) {\r\n                                                    // Set to hidden - CaptionManager will set it to showing when it enables\r\n                                                    newTextTrack.mode = 'hidden';\r\n                                                } else if (modeInfo.wasHidden) {\r\n                                                    newTextTrack.mode = 'hidden';\r\n                                                } else {\r\n                                                    newTextTrack.mode = 'disabled';\r\n                                                }\r\n                                            };\r\n                                            \r\n                                            // Wait for track to load\r\n                                            if (newTextTrack.readyState >= 2) { // LOADED\r\n                                                restoreMode();\r\n                                            } else {\r\n                                                newTextTrack.addEventListener('load', restoreMode, { once: true });\r\n                                                newTextTrack.addEventListener('error', restoreMode, { once: true });\r\n                                            }\r\n                                        }\r\n                                    });\r\n                                }, 300); // Additional wait for browser to process track elements\r\n                            };\r\n                            \r\n                            // Wait for loadedmetadata event which fires when browser processes track elements\r\n                            if (this.element.readyState >= 1) { // HAVE_METADATA\r\n                                // Already loaded, wait a bit and setup\r\n                                setTimeout(setupNewTracks, 200);\r\n                            } else {\r\n                                this.element.addEventListener('loadedmetadata', setupNewTracks, { once: true });\r\n                                // Fallback timeout\r\n                                setTimeout(setupNewTracks, 2000);\r\n                            }\r\n                            \r\n                            resolve();\r\n                        }, 100);\r\n                    }); // Wait 100ms after first load() before adding new tracks\r\n                    \r\n                    const skippedCount = validationResults.length - tracksToSwap.length;\r\n                }\r\n            }\r\n            \r\n            // Update all source elements that have data-desc-src to their described versions\r\n            // Force browser to pick up changes by removing and re-adding source elements\r\n            // Get source elements (may have been defined in if block above, but get fresh list here)\r\n            const allSourceElements = this.sourceElements;\r\n            const sourcesToUpdate = [];\r\n            \r\n            allSourceElements.forEach((sourceEl) => {\r\n                const descSrcAttr = sourceEl.getAttribute('data-desc-src');\r\n                const currentSrc = sourceEl.getAttribute('src');\r\n                \r\n                if (descSrcAttr) {\r\n                    const type = sourceEl.getAttribute('type');\r\n                    let origSrc = sourceEl.getAttribute('data-orig-src');\r\n                    \r\n                    // Store current src as data-orig-src if not already set\r\n                    if (!origSrc) {\r\n                        origSrc = currentSrc;\r\n                    }\r\n                    \r\n                    // Store info for re-adding with described src\r\n                    sourcesToUpdate.push({\r\n                        src: descSrcAttr,  // Use described version\r\n                        type: type,\r\n                        origSrc: origSrc,\r\n                        descSrc: descSrcAttr\r\n                    });\r\n                } else {\r\n                    // Source element without data-desc-src - keep as-is\r\n                    const type = sourceEl.getAttribute('type');\r\n                    const src = sourceEl.getAttribute('src');\r\n                    sourcesToUpdate.push({\r\n                        src: src,\r\n                        type: type,\r\n                        origSrc: null,\r\n                        descSrc: null\r\n                    });\r\n                }\r\n            });\r\n            \r\n            // Remove src attribute if present (video with src can't have source elements per HTML spec)\r\n            const hasSrcAttribute = this.element.hasAttribute('src');\r\n            const srcValue = hasSrcAttribute ? this.element.getAttribute('src') : null;\r\n            if (hasSrcAttribute) {\r\n                this.element.removeAttribute('src');\r\n            }\r\n            \r\n            // Remove all source elements\r\n            allSourceElements.forEach(sourceEl => {\r\n                sourceEl.remove();\r\n            });\r\n            \r\n            // Re-add them with updated src attributes (described versions)\r\n            sourcesToUpdate.forEach(sourceInfo => {\r\n                const newSource = document.createElement('source');\r\n                newSource.setAttribute('src', sourceInfo.src);\r\n                if (sourceInfo.type) {\r\n                    newSource.setAttribute('type', sourceInfo.type);\r\n                }\r\n                if (sourceInfo.origSrc) {\r\n                    newSource.setAttribute('data-orig-src', sourceInfo.origSrc);\r\n                }\r\n                if (sourceInfo.descSrc) {\r\n                    newSource.setAttribute('data-desc-src', sourceInfo.descSrc);\r\n                }\r\n                const firstTrack = this.element.querySelector('track');\r\n                if (firstTrack) {\r\n                    this.element.insertBefore(newSource, firstTrack);\r\n                } else {\r\n                    this.element.appendChild(newSource);\r\n                }\r\n            });\r\n\r\n            // Ensure cached source references are refreshed after rebuilding the list\r\n            this._sourceElementsDirty = true;\r\n            this._sourceElementsCache = null;\r\n            \r\n            // Preserve poster before reload\r\n            if (posterValue && this.element.tagName === 'VIDEO') {\r\n                this.element.poster = posterValue;\r\n            }\r\n            \r\n            // Force reload by calling load() on the element\r\n            // This should pick up the new src attributes from the re-added source elements\r\n            // and also reload the track elements\r\n            this.element.load();\r\n            \r\n            // Wait for new source to load metadata\r\n            await new Promise((resolve) => {\r\n                const onLoadedMetadata = () => {\r\n                    this.element.removeEventListener('loadedmetadata', onLoadedMetadata);\r\n                    resolve();\r\n                };\r\n                \r\n                if (this.element.readyState >= 1) {\r\n                    // Metadata already loaded\r\n                    resolve();\r\n                } else {\r\n                    this.element.addEventListener('loadedmetadata', onLoadedMetadata);\r\n                }\r\n            });\r\n            \r\n            // Wait a bit more for tracks to be recognized and loaded after video metadata loads\r\n            await new Promise(resolve => setTimeout(resolve, 300));\r\n\r\n            // If we need to seek and/or play, wait for enough data to be loaded\r\n            if (currentTime > 0 || wasPlaying) {\r\n                await new Promise((resolve) => {\r\n                    const onCanPlay = () => {\r\n                        this.element.removeEventListener('canplay', onCanPlay);\r\n                        this.element.removeEventListener('canplaythrough', onCanPlay);\r\n                        resolve();\r\n                    };\r\n                    \r\n                    // Check if already ready\r\n                    if (this.element.readyState >= 3) { // HAVE_FUTURE_DATA or better\r\n                        resolve();\r\n                    } else {\r\n                        // Wait for canplay or canplaythrough\r\n                        this.element.addEventListener('canplay', onCanPlay, { once: true });\r\n                        this.element.addEventListener('canplaythrough', onCanPlay, { once: true });\r\n                        \r\n                        // Fallback timeout in case events don't fire\r\n                        setTimeout(() => {\r\n                            this.element.removeEventListener('canplay', onCanPlay);\r\n                            this.element.removeEventListener('canplaythrough', onCanPlay);\r\n                            resolve();\r\n                        }, 3000);\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Try to find matching caption in the new track for better synchronization\r\n            let syncTime = currentTime;\r\n            if (currentCaptionText && this.captionManager && this.captionManager.tracks.length > 0) {\r\n                // Wait a bit for tracks to load\r\n                await new Promise(resolve => setTimeout(resolve, 500));\r\n                \r\n                // Find the matching caption in the described video's track\r\n                const matchingTime = this.findMatchingCaptionTime(currentCaptionText, this.captionManager.tracks);\r\n                if (matchingTime !== null) {\r\n                    syncTime = matchingTime;\r\n                    if (this.options.debug) {\r\n                        console.log(`[VidPly] Syncing via caption: ${currentTime}s -> ${syncTime}s`);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Restore playback position (avoid forcing first frame if still at start)\r\n            if (syncTime > 0) {\r\n                this.seek(syncTime);\r\n                // Wait a bit for seek to complete\r\n                await new Promise(resolve => setTimeout(resolve, 100));\r\n            }\r\n\r\n            if (wasPlaying) {\r\n                await this.play();\r\n                // Hide poster when playing - use setTimeout to ensure play event has fired\r\n                this.setManagedTimeout(() => {\r\n                    this.hidePosterOverlay();\r\n                }, 100);\r\n            } else {\r\n                // Explicitly pause the video if it wasn't playing\r\n                // This ensures it's in a clean paused state after load()\r\n                this.pause();\r\n                if (!shouldKeepPoster) {\r\n                    this.hidePosterOverlay();\r\n                }\r\n            }\r\n\r\n            // Update state and emit event\r\n            if (!this._audioDescriptionDesiredState) {\r\n                return;\r\n            }\r\n            this.state.audioDescriptionEnabled = true;\r\n            this.emit('audiodescriptionenabled');\r\n        } else {\r\n            // Fallback to updating element src directly\r\n            // Swap caption tracks to described versions BEFORE loading\r\n            if (this.audioDescriptionCaptionTracks.length > 0) {\r\n                // Swap tracks: validate explicit tracks, but try auto-detected tracks without validation\r\n                const validationPromises = this.audioDescriptionCaptionTracks.map(async (trackInfo) => {\r\n                    if (trackInfo.trackElement && trackInfo.describedSrc) {\r\n                        // Only validate explicitly defined tracks\r\n                        // Auto-detected tracks are used without validation (no 404s)\r\n                        if (trackInfo.explicit === true) {\r\n                            try {\r\n                                const exists = await this.validateTrackExists(trackInfo.describedSrc);\r\n                                return { trackInfo, exists };\r\n                            } catch (error) {\r\n                                return { trackInfo, exists: false };\r\n                            }\r\n                        } else {\r\n                            // This shouldn't happen since auto-detection is disabled\r\n                            return { trackInfo, exists: false };\r\n                        }\r\n                    }\r\n                    return { trackInfo, exists: false };\r\n                });\r\n                \r\n                const validationResults = await Promise.all(validationPromises);\r\n                const tracksToSwap = validationResults.filter(result => result.exists);\r\n                \r\n                if (tracksToSwap.length > 0) {\r\n                    // Store original track modes before removing tracks\r\n                    const trackModes = new Map();\r\n                    tracksToSwap.forEach(({ trackInfo }) => {\r\n                        const textTrack = trackInfo.trackElement.track;\r\n                        if (textTrack) {\r\n                            trackModes.set(trackInfo, {\r\n                                wasShowing: textTrack.mode === 'showing',\r\n                                wasHidden: textTrack.mode === 'hidden'\r\n                            });\r\n                        } else {\r\n                            trackModes.set(trackInfo, {\r\n                                wasShowing: false,\r\n                                wasHidden: false\r\n                            });\r\n                        }\r\n                    });\r\n                    \r\n                    // Store all track information before removing\r\n                    const tracksToReadd = tracksToSwap.map(({ trackInfo }) => {\r\n                        const oldSrc = trackInfo.trackElement.getAttribute('src');\r\n                        const parent = trackInfo.trackElement.parentNode;\r\n                        const nextSibling = trackInfo.trackElement.nextSibling;\r\n                        \r\n                        // Store all attributes from the old track\r\n                        const attributes = {};\r\n                        Array.from(trackInfo.trackElement.attributes).forEach(attr => {\r\n                            attributes[attr.name] = attr.value;\r\n                        });\r\n                        \r\n                        return {\r\n                            trackInfo,\r\n                            oldSrc,\r\n                            parent,\r\n                            nextSibling,\r\n                            attributes\r\n                        };\r\n                    });\r\n                    \r\n                    // Remove ALL old tracks first to force browser to clear TextTrack objects\r\n                    tracksToReadd.forEach(({ trackInfo }) => {\r\n                        trackInfo.trackElement.remove();\r\n                    });\r\n                    \r\n                    // Force browser to process the removal by calling load()\r\n                    this.element.load();\r\n                    \r\n                    // Wait for browser to process the removal, then add new tracks\r\n                    setTimeout(() => {\r\n                        tracksToReadd.forEach(({ trackInfo, oldSrc, parent, nextSibling, attributes }) => {\r\n                            swappedTracksForTranscript.push(trackInfo);\r\n                            \r\n                            // Create a completely new track element (not a clone) to force browser to create new TextTrack\r\n                            const newTrackElement = document.createElement('track');\r\n                            newTrackElement.setAttribute('src', trackInfo.describedSrc);\r\n                            \r\n                            // Copy all attributes except src and data-desc-src\r\n                            Object.keys(attributes).forEach(attrName => {\r\n                                if (attrName !== 'src' && attrName !== 'data-desc-src') {\r\n                                    newTrackElement.setAttribute(attrName, attributes[attrName]);\r\n                                }\r\n                            });\r\n                            \r\n                            // Insert new track element at the beginning (before any flow content) for HTML5 validity\r\n                            const firstChild = parent.firstChild;\r\n                            if (firstChild && firstChild.nodeType === Node.ELEMENT_NODE && firstChild.tagName !== 'TRACK') {\r\n                                parent.insertBefore(newTrackElement, firstChild);\r\n                            } else if (nextSibling && nextSibling.parentNode) {\r\n                                parent.insertBefore(newTrackElement, nextSibling);\r\n                            } else {\r\n                                parent.appendChild(newTrackElement);\r\n                            }\r\n                            \r\n                            // Update reference to the new track element\r\n                            trackInfo.trackElement = newTrackElement;\r\n                        });\r\n                        \r\n                        // After all new tracks are added, force browser to reload media element again\r\n                        this.element.load();\r\n                        \r\n                        // Wait for loadedmetadata event before accessing new TextTrack objects\r\n                        const setupNewTracks = () => {\r\n                            // Wait a bit more for browser to fully process the new track elements\r\n                            setTimeout(() => {\r\n                                swappedTracksForTranscript.forEach((trackInfo) => {\r\n                                    const trackElement = trackInfo.trackElement;\r\n                                    const newTextTrack = trackElement.track;\r\n                                    \r\n                                    if (newTextTrack) {\r\n                                        // Get original mode from stored map\r\n                                        const modeInfo = trackModes.get(trackInfo) || { wasShowing: false, wasHidden: false };\r\n                                        \r\n                                        // Set mode to load the new track\r\n                                        newTextTrack.mode = 'hidden'; // Use hidden to load cues without showing\r\n                                        \r\n                                        // Restore original mode after track loads\r\n                                        const restoreMode = () => {\r\n                                            if (modeInfo.wasShowing) {\r\n                                                // Set to hidden - CaptionManager will set it to showing when it enables\r\n                                                newTextTrack.mode = 'hidden';\r\n                                            } else if (modeInfo.wasHidden) {\r\n                                                newTextTrack.mode = 'hidden';\r\n                                            } else {\r\n                                                newTextTrack.mode = 'disabled';\r\n                                            }\r\n                                        };\r\n                                        \r\n                                        // Wait for track to load\r\n                                        if (newTextTrack.readyState >= 2) { // LOADED\r\n                                            restoreMode();\r\n                                        } else {\r\n                                            newTextTrack.addEventListener('load', restoreMode, { once: true });\r\n                                            newTextTrack.addEventListener('error', restoreMode, { once: true });\r\n                                        }\r\n                                    }\r\n                                });\r\n                            }, 300); // Additional wait for browser to process track elements\r\n                        };\r\n                        \r\n                        // Wait for loadedmetadata event which fires when browser processes track elements\r\n                        if (this.element.readyState >= 1) { // HAVE_METADATA\r\n                            // Already loaded, wait a bit and setup\r\n                            setTimeout(setupNewTracks, 200);\r\n                        } else {\r\n                            this.element.addEventListener('loadedmetadata', setupNewTracks, { once: true });\r\n                            // Fallback timeout\r\n                            setTimeout(setupNewTracks, 2000);\r\n                        }\r\n                    }, 100); // Wait 100ms after first load() before adding new tracks\r\n                }\r\n            }\r\n            \r\n            // Check if we have source elements with data-desc-src (fallback method)\r\n            const fallbackSourceElements = this.sourceElements;\r\n            const hasSourceElementsWithDesc = fallbackSourceElements.some(el => el.getAttribute('data-desc-src'));\r\n            \r\n            if (hasSourceElementsWithDesc) {\r\n                const fallbackSourcesToUpdate = [];\r\n                \r\n                fallbackSourceElements.forEach((sourceEl) => {\r\n                    const descSrcAttr = sourceEl.getAttribute('data-desc-src');\r\n                    const currentSrc = sourceEl.getAttribute('src');\r\n                    \r\n                    if (descSrcAttr) {\r\n                        const type = sourceEl.getAttribute('type');\r\n                        let origSrc = sourceEl.getAttribute('data-orig-src');\r\n                        \r\n                        if (!origSrc) {\r\n                            origSrc = currentSrc;\r\n                        }\r\n                        \r\n                        fallbackSourcesToUpdate.push({\r\n                            src: descSrcAttr,\r\n                            type: type,\r\n                            origSrc: origSrc,\r\n                            descSrc: descSrcAttr\r\n                        });\r\n                    } else {\r\n                        const type = sourceEl.getAttribute('type');\r\n                        const src = sourceEl.getAttribute('src');\r\n                        fallbackSourcesToUpdate.push({\r\n                            src: src,\r\n                            type: type,\r\n                            origSrc: null,\r\n                            descSrc: null\r\n                        });\r\n                    }\r\n                });\r\n                \r\n                // Remove all source elements\r\n                fallbackSourceElements.forEach(sourceEl => {\r\n                    sourceEl.remove();\r\n                });\r\n                \r\n                // Re-add them with updated src attributes\r\n                fallbackSourcesToUpdate.forEach(sourceInfo => {\r\n                    const newSource = document.createElement('source');\r\n                    newSource.setAttribute('src', sourceInfo.src);\r\n                    if (sourceInfo.type) {\r\n                        newSource.setAttribute('type', sourceInfo.type);\r\n                    }\r\n                    if (sourceInfo.origSrc) {\r\n                        newSource.setAttribute('data-orig-src', sourceInfo.origSrc);\r\n                    }\r\n                    if (sourceInfo.descSrc) {\r\n                        newSource.setAttribute('data-desc-src', sourceInfo.descSrc);\r\n                    }\r\n                    this.element.appendChild(newSource);\r\n                });\r\n                \r\n                // Preserve poster before reload\r\n                if (posterValue && this.element.tagName === 'VIDEO') {\r\n                    this.element.poster = posterValue;\r\n                }\r\n                \r\n                // Force reload\r\n                this.element.load();\r\n                this.invalidateTrackCache();\r\n            } else {\r\n                // Fallback to updating element src directly (for videos without source elements)\r\n                // Preserve poster before changing src\r\n                if (posterValue && this.element.tagName === 'VIDEO') {\r\n                    this.element.poster = posterValue;\r\n                }\r\n                this.element.src = this.audioDescriptionSrc;\r\n            }\r\n        }\r\n\r\n        // Wait for new source to load metadata\r\n        await new Promise((resolve) => {\r\n            const onLoadedMetadata = () => {\r\n                this.element.removeEventListener('loadedmetadata', onLoadedMetadata);\r\n                resolve();\r\n            };\r\n            \r\n            if (this.element.readyState >= 1) {\r\n                // Metadata already loaded\r\n                resolve();\r\n            } else {\r\n                this.element.addEventListener('loadedmetadata', onLoadedMetadata);\r\n            }\r\n        });\r\n\r\n        // If we need to seek and/or play, wait for enough data to be loaded\r\n        if (currentTime > 0 || wasPlaying) {\r\n            await new Promise((resolve) => {\r\n                const onCanPlay = () => {\r\n                    this.element.removeEventListener('canplay', onCanPlay);\r\n                    this.element.removeEventListener('canplaythrough', onCanPlay);\r\n                    resolve();\r\n                };\r\n                \r\n                // Check if already ready\r\n                if (this.element.readyState >= 3) { // HAVE_FUTURE_DATA or better\r\n                    resolve();\r\n                } else {\r\n                    // Wait for canplay or canplaythrough\r\n                    this.element.addEventListener('canplay', onCanPlay, { once: true });\r\n                    this.element.addEventListener('canplaythrough', onCanPlay, { once: true });\r\n                    \r\n                    // Fallback timeout in case events don't fire\r\n                    setTimeout(() => {\r\n                        this.element.removeEventListener('canplay', onCanPlay);\r\n                        this.element.removeEventListener('canplaythrough', onCanPlay);\r\n                        resolve();\r\n                    }, 3000);\r\n                }\r\n            });\r\n        }\r\n\r\n        // Hide poster if video hasn't started yet (poster should hide when we seek or play)\r\n        if (this.element.tagName === 'VIDEO' && currentTime === 0 && !wasPlaying) {\r\n            // Force poster to hide by doing a minimal seek or loading first frame\r\n            // Setting readyState check or seeking to 0.001 seconds will hide the poster\r\n            if (this.element.readyState >= 1) { // HAVE_METADATA\r\n                // Seek to a tiny fraction to trigger poster hiding without actually moving\r\n                this.element.currentTime = 0.001;\r\n                // Then seek back to 0 after a brief moment to ensure poster stays hidden\r\n                this.setManagedTimeout(() => {\r\n                    this.element.currentTime = 0;\r\n                }, 10);\r\n            }\r\n        }\r\n\r\n        // Try to find matching caption in the new track for better synchronization\r\n        let syncTime = currentTime;\r\n        if (currentCaptionText && this.captionManager && this.captionManager.tracks.length > 0) {\r\n            // Wait a bit for tracks to load\r\n            await new Promise(resolve => setTimeout(resolve, 500));\r\n            \r\n            // Find the matching caption in the described video's track\r\n            const matchingTime = this.findMatchingCaptionTime(currentCaptionText, this.captionManager.tracks);\r\n            if (matchingTime !== null) {\r\n                syncTime = matchingTime;\r\n                if (this.options.debug) {\r\n                    console.log(`[VidPly] Syncing via caption: ${currentTime}s -> ${syncTime}s`);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Restore playback position (avoid forcing first frame if still at start)\r\n        if (syncTime > 0) {\r\n            this.seek(syncTime);\r\n            // Wait a bit for seek to complete\r\n            await new Promise(resolve => setTimeout(resolve, 100));\r\n        }\r\n\r\n        if (wasPlaying) {\r\n            await this.play();\r\n            // Hide poster when playing - use setTimeout to ensure play event has fired\r\n            this.setManagedTimeout(() => {\r\n                this.hidePosterOverlay();\r\n            }, 100);\r\n        } else {\r\n            // Explicitly pause the video if it wasn't playing\r\n            // This ensures it's in a clean paused state after load()\r\n            this.pause();\r\n            if (!shouldKeepPoster) {\r\n                this.hidePosterOverlay();\r\n            }\r\n        }\r\n\r\n        // Reload CaptionManager tracks if tracks were swapped (so it has fresh references)\r\n        if (swappedTracksForTranscript.length > 0 && this.captionManager) {\r\n            // Store if captions were enabled and which track\r\n            const wasCaptionsEnabled = this.state.captionsEnabled;\r\n            let currentTrackInfo = null;\r\n            if (this.captionManager.currentTrack) {\r\n                const currentTrackIndex = this.captionManager.tracks.findIndex(t => t.track === this.captionManager.currentTrack.track);\r\n                if (currentTrackIndex >= 0) {\r\n                    currentTrackInfo = {\r\n                        language: this.captionManager.tracks[currentTrackIndex].language,\r\n                        kind: this.captionManager.tracks[currentTrackIndex].kind\r\n                    };\r\n                }\r\n            }\r\n            \r\n            // Wait for new tracks to be available and loaded, then reload\r\n            // Use a longer timeout and wait for track load events\r\n            const reloadTracks = () => {\r\n                // Reload tracks to get fresh references to new TextTrack objects\r\n                this.captionManager.tracks = [];\r\n                this.captionManager.loadTracks();\r\n                \r\n                // Re-enable captions if they were enabled before\r\n                if (wasCaptionsEnabled && currentTrackInfo && this.captionManager.tracks.length > 0) {\r\n                    // Find the track by language and kind to match the swapped track\r\n                    const matchingTrackIndex = this.captionManager.tracks.findIndex(t => \r\n                        t.language === currentTrackInfo.language && t.kind === currentTrackInfo.kind\r\n                    );\r\n                    \r\n                    if (matchingTrackIndex >= 0) {\r\n                        const trackToEnable = this.captionManager.tracks[matchingTrackIndex];\r\n                        // Wait for track to load its cues before enabling\r\n                        if (trackToEnable.track.readyState >= 2) {\r\n                            // Track is already loaded\r\n                            this.captionManager.enable(matchingTrackIndex);\r\n                        } else {\r\n                            // Wait for track to load\r\n                            const onTrackLoad = () => {\r\n                                trackToEnable.track.removeEventListener('load', onTrackLoad);\r\n                                trackToEnable.track.removeEventListener('error', onTrackLoad);\r\n                                if (this.captionManager && this.captionManager.tracks.includes(trackToEnable)) {\r\n                                    this.captionManager.enable(matchingTrackIndex);\r\n                                }\r\n                            };\r\n                            trackToEnable.track.addEventListener('load', onTrackLoad, { once: true });\r\n                            trackToEnable.track.addEventListener('error', onTrackLoad, { once: true });\r\n                            // Set mode to 'hidden' to trigger loading\r\n                            trackToEnable.track.mode = 'hidden';\r\n                            // Fallback timeout\r\n                            setTimeout(() => {\r\n                                if (this.captionManager && this.captionManager.tracks.includes(trackToEnable)) {\r\n                                    this.captionManager.enable(matchingTrackIndex);\r\n                                }\r\n                            }, 1000);\r\n                        }\r\n                    } else if (this.captionManager.tracks.length > 0) {\r\n                        // Fallback: enable first track\r\n                        const firstTrack = this.captionManager.tracks[0];\r\n                        if (firstTrack.track.readyState >= 2) {\r\n                            this.captionManager.enable(0);\r\n                        } else {\r\n                            const onTrackLoad = () => {\r\n                                firstTrack.track.removeEventListener('load', onTrackLoad);\r\n                                firstTrack.track.removeEventListener('error', onTrackLoad);\r\n                                if (this.captionManager && this.captionManager.tracks.includes(firstTrack)) {\r\n                                    this.captionManager.enable(0);\r\n                                }\r\n                            };\r\n                            firstTrack.track.addEventListener('load', onTrackLoad, { once: true });\r\n                            firstTrack.track.addEventListener('error', onTrackLoad, { once: true });\r\n                            firstTrack.track.mode = 'hidden';\r\n                            setTimeout(() => {\r\n                                if (this.captionManager && this.captionManager.tracks.includes(firstTrack)) {\r\n                                    this.captionManager.enable(0);\r\n                                }\r\n                            }, 1000);\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            \r\n            // Wait for tracks to be processed by the browser\r\n            setTimeout(reloadTracks, 600);\r\n        }\r\n\r\n        // Reload transcript if visible (after video metadata loaded, tracks should be available)\r\n        // Reload regardless of whether caption tracks were swapped, in case tracks changed\r\n        if (this.transcriptManager && this.transcriptManager.isVisible) {\r\n            // Wait for tracks to load after source swap\r\n            // If tracks were swapped, wait for them to load; otherwise wait a bit for any track changes\r\n            const swappedTracks = typeof swappedTracksForTranscript !== 'undefined' ? swappedTracksForTranscript : [];\r\n            \r\n            if (swappedTracks.length > 0) {\r\n                // Wait for swapped tracks to load their new cues\r\n                // Since we re-added track elements and called load(), wait for loadedmetadata event\r\n                // which is when the browser processes track elements\r\n                const onMetadataLoaded = () => {\r\n                    // Get fresh track references from the video element's textTracks collection\r\n                    // This ensures we get the actual textTrack objects that the browser created\r\n                    // Invalidate cache first to get fresh tracks after swap\r\n                    this.invalidateTrackCache();\r\n                    const allTextTracks = this.textTracks;\r\n                    \r\n                    // Find the tracks that match our swapped tracks by language and kind\r\n                    // Match by checking the track element's src attribute\r\n                    const freshTracks = swappedTracks.map((trackInfo) => {\r\n                        const trackEl = trackInfo.trackElement;\r\n                        const expectedSrc = trackEl.getAttribute('src');\r\n                        const srclang = trackEl.getAttribute('srclang');\r\n                        const kind = trackEl.getAttribute('kind');\r\n                        \r\n                        // Find matching track in textTracks collection\r\n                        // First try to match by the track element reference\r\n                        let foundTrack = allTextTracks.find(track => trackEl.track === track);\r\n                        \r\n                        // If not found, try matching by language and kind, but verify src\r\n                        if (!foundTrack) {\r\n                            foundTrack = allTextTracks.find(track => {\r\n                                if (track.language === srclang && \r\n                                    (track.kind === kind || (kind === 'captions' && track.kind === 'subtitles'))) {\r\n                                    // Verify the src matches\r\n                                    const trackElementForTrack = this.findTrackElement(track);\r\n                                    if (trackElementForTrack) {\r\n                                        const actualSrc = trackElementForTrack.getAttribute('src');\r\n                                        if (actualSrc === expectedSrc) {\r\n                                            return true;\r\n                                        }\r\n                                    }\r\n                                }\r\n                                return false;\r\n                            });\r\n                        }\r\n                        \r\n                        // Verify the track element's src matches what we expect\r\n                        if (foundTrack) {\r\n                            const trackElement = this.findTrackElement(foundTrack);\r\n                            if (trackElement && trackElement.getAttribute('src') !== expectedSrc) {\r\n                                return null;\r\n                            }\r\n                        }\r\n                        \r\n                        return foundTrack;\r\n                    }).filter(Boolean);\r\n                    \r\n                    if (freshTracks.length === 0) {\r\n                        // Fallback: just reload after delay - transcript manager will find tracks itself\r\n                        this.setManagedTimeout(() => {\r\n                            if (this.transcriptManager && this.transcriptManager.loadTranscriptData) {\r\n                                this.transcriptManager.loadTranscriptData();\r\n                            }\r\n                        }, 1000);\r\n                        return;\r\n                    }\r\n                    \r\n                    // Ensure tracks are in hidden mode to load cues for transcript\r\n                    freshTracks.forEach(track => {\r\n                        if (track.mode === 'disabled') {\r\n                            track.mode = 'hidden';\r\n                        }\r\n                    });\r\n                    \r\n                    let loadedCount = 0;\r\n                    const checkLoaded = () => {\r\n                        loadedCount++;\r\n                        if (loadedCount >= freshTracks.length) {\r\n                            // Give a bit more time for cues to be fully parsed\r\n                            // Also ensure we're getting the latest TextTrack references\r\n                            this.setManagedTimeout(() => {\r\n                                if (this.transcriptManager && this.transcriptManager.loadTranscriptData) {\r\n                                    // Force transcript manager to get fresh track references\r\n                                    // Clear any cached track references by forcing a fresh read\r\n                                    // The transcript manager will find tracks from this.element.textTracks\r\n                                    // which should now have the new TextTrack objects with the described captions\r\n                                    \r\n                                    // Verify the tracks have the correct src before reloading transcript\r\n                                    this.invalidateTrackCache();\r\n                                    const allTextTracks = this.textTracks;\r\n                                    const swappedTrackSrcs = swappedTracks.map(t => t.describedSrc);\r\n                                    const hasCorrectTracks = freshTracks.some(track => {\r\n                                        const trackEl = this.findTrackElement(track);\r\n                                        return trackEl && swappedTrackSrcs.includes(trackEl.getAttribute('src'));\r\n                                    });\r\n                                    \r\n                                    if (hasCorrectTracks || freshTracks.length > 0) {\r\n                                        this.transcriptManager.loadTranscriptData();\r\n                                    }\r\n                                }\r\n                            }, 800); // Increased wait time to ensure cues are fully loaded\r\n                        }\r\n                    };\r\n                    \r\n                    freshTracks.forEach(track => {\r\n                        // Ensure track is in hidden mode to load cues (required for transcript)\r\n                        if (track.mode === 'disabled') {\r\n                            track.mode = 'hidden';\r\n                        }\r\n                        \r\n                        // Check if track has cues loaded\r\n                        // Verify the track element's src matches the expected described src\r\n                        const trackElementForTrack = this.findTrackElement(track);\r\n                        const actualSrc = trackElementForTrack ? trackElementForTrack.getAttribute('src') : null;\r\n                        \r\n                        // Find the expected src from swappedTracks\r\n                        const expectedTrackInfo = swappedTracks.find(t => {\r\n                            const tEl = t.trackElement;\r\n                            return tEl && (tEl.track === track || \r\n                                (tEl.getAttribute('srclang') === track.language && \r\n                                 tEl.getAttribute('kind') === track.kind));\r\n                        });\r\n                        const expectedSrc = expectedTrackInfo ? expectedTrackInfo.describedSrc : null;\r\n                        \r\n                        // Only proceed if the src matches (or we can't verify)\r\n                        if (expectedSrc && actualSrc && actualSrc !== expectedSrc) {\r\n                            // Wrong track, skip it\r\n                            checkLoaded(); // Count it as loaded to not block\r\n                            return;\r\n                        }\r\n                        \r\n                        if (track.readyState >= 2 && track.cues && track.cues.length > 0) { // LOADED with cues\r\n                            // Track already loaded with cues\r\n                            checkLoaded();\r\n                        } else {\r\n                            // Force track to load by setting mode\r\n                            if (track.mode === 'disabled') {\r\n                                track.mode = 'hidden';\r\n                            }\r\n                            \r\n                            // Wait for track to load\r\n                            const onTrackLoad = () => {\r\n                                // Wait a bit for cues to be fully parsed\r\n                                this.setManagedTimeout(checkLoaded, 300);\r\n                            };\r\n                            \r\n                            if (track.readyState >= 2) {\r\n                                // Already loaded, but might not have cues yet\r\n                                // Wait a bit and check again\r\n                                this.setManagedTimeout(() => {\r\n                                    if (track.cues && track.cues.length > 0) {\r\n                                        checkLoaded();\r\n                                    } else {\r\n                                        // Still no cues, wait for load event\r\n                                        track.addEventListener('load', onTrackLoad, { once: true });\r\n                                    }\r\n                                }, 100);\r\n                            } else {\r\n                                track.addEventListener('load', onTrackLoad, { once: true });\r\n                                track.addEventListener('error', () => {\r\n                                    // Even on error, try to reload transcript\r\n                                    checkLoaded();\r\n                                }, { once: true });\r\n                            }\r\n                        }\r\n                    });\r\n                };\r\n                \r\n                // Wait for loadedmetadata event which fires when browser processes track elements\r\n                // Also wait for the tracks to be fully processed after the second load()\r\n                const waitForTracks = () => {\r\n                        // Wait a bit more to ensure new TextTrack objects are created\r\n                        this.setManagedTimeout(() => {\r\n                            if (this.element.readyState >= 1) { // HAVE_METADATA\r\n                                onMetadataLoaded();\r\n                            } else {\r\n                                this.element.addEventListener('loadedmetadata', onMetadataLoaded, { once: true });\r\n                                // Fallback timeout\r\n                                this.setManagedTimeout(onMetadataLoaded, 2000);\r\n                            }\r\n                        }, 500); // Wait 500ms after second load() for tracks to be processed\r\n                };\r\n                \r\n                waitForTracks();\r\n                \r\n                // Fallback timeout - longer to ensure tracks are loaded\r\n                setTimeout(() => {\r\n                    if (this.transcriptManager && this.transcriptManager.loadTranscriptData) {\r\n                        this.transcriptManager.loadTranscriptData();\r\n                    }\r\n                }, 5000);\r\n            } else {\r\n                // No tracks swapped, just wait a bit and reload\r\n                setTimeout(() => {\r\n                    if (this.transcriptManager && this.transcriptManager.loadTranscriptData) {\r\n                        this.transcriptManager.loadTranscriptData();\r\n                    }\r\n                }, 800);\r\n            }\r\n        }\r\n\r\n        if (!shouldKeepPoster) {\r\n            this.hidePosterOverlay();\r\n        }\r\n\r\n        if (!this._audioDescriptionDesiredState) {\r\n            return;\r\n        }\r\n\r\n        this.state.audioDescriptionEnabled = true;\r\n        this.emit('audiodescriptionenabled');\r\n    }\r\n\r\n    async disableAudioDescription() {\r\n        return this.audioDescriptionManager.disable();\r\n    }\r\n\r\n    // Legacy method body preserved for reference - can be removed after testing\r\n    async _legacyDisableAudioDescription() {\r\n        if (!this.originalSrc) {\r\n            return;\r\n        }\r\n\r\n        // Store current playback state\r\n        // Use element.currentTime directly, not state, as state may not be up-to-date\r\n        const currentTime = this.element.currentTime;\r\n        const wasPlaying = this.state.playing;\r\n        \r\n        // Try to find the current caption text for synchronization\r\n        // This helps when switching between videos of different lengths\r\n        let currentCaptionText = null;\r\n        if (this.captionManager && this.captionManager.currentTrack) {\r\n            const track = this.captionManager.currentTrack.track;\r\n            if (track && track.activeCues && track.activeCues.length > 0) {\r\n                const activeCue = track.activeCues[0];\r\n                currentCaptionText = this.stripVTTFormatting(activeCue.text);\r\n            }\r\n        }\r\n        \r\n        // Store poster to preserve it during source swap\r\n        // Convert relative paths to absolute URLs to prevent resolution issues\r\n        const posterValue = this.resolvePosterPath(\r\n            this.element.getAttribute('poster') || \r\n            this.element.poster || \r\n            this.options.poster\r\n        );\r\n\r\n        // Swap caption/chapter tracks back to original versions BEFORE loading\r\n        // Store swapped tracks for transcript reload\r\n        let swappedTracksForTranscript = [];\r\n        if (this.audioDescriptionCaptionTracks.length > 0) {\r\n            // Store track information before removing\r\n            const tracksToRestore = this.audioDescriptionCaptionTracks.map((trackInfo) => {\r\n                const trackElement = trackInfo.trackElement;\r\n                if (!trackElement || !trackElement.parentNode) {\r\n                    return null;\r\n                }\r\n                \r\n                const parent = trackElement.parentNode;\r\n                const nextSibling = trackElement.nextSibling;\r\n                \r\n                // Store all attributes from the current track\r\n                const attributes = {};\r\n                Array.from(trackElement.attributes).forEach(attr => {\r\n                    attributes[attr.name] = attr.value;\r\n                });\r\n                \r\n                return {\r\n                    trackInfo,\r\n                    parent,\r\n                    nextSibling,\r\n                    attributes\r\n                };\r\n            }).filter(Boolean);\r\n            \r\n            // Remove all current track elements\r\n            tracksToRestore.forEach(({ trackInfo }) => {\r\n                if (trackInfo.trackElement && trackInfo.trackElement.parentNode) {\r\n                    trackInfo.trackElement.remove();\r\n                }\r\n            });\r\n            \r\n            // Force browser to process the removal\r\n            this.element.load();\r\n            \r\n            // Wait for browser to process the removal, then add original tracks back\r\n            // Use await instead of setTimeout to ensure this completes before continuing\r\n            await new Promise(resolve => {\r\n                setTimeout(() => {\r\n                    tracksToRestore.forEach(({ trackInfo, parent, nextSibling, attributes }) => {\r\n                        swappedTracksForTranscript.push(trackInfo);\r\n                        \r\n                        // Create a new track element with the original src\r\n                        const newTrackElement = document.createElement('track');\r\n                        newTrackElement.setAttribute('src', trackInfo.originalTrackSrc);\r\n                        \r\n                        // Copy all attributes except src and data-desc-src\r\n                        Object.keys(attributes).forEach(attrName => {\r\n                            if (attrName !== 'src' && attrName !== 'data-desc-src') {\r\n                                newTrackElement.setAttribute(attrName, attributes[attrName]);\r\n                            }\r\n                        });\r\n                        \r\n                        // Keep data-desc-src for future swaps\r\n                        if (trackInfo.describedSrc) {\r\n                            newTrackElement.setAttribute('data-desc-src', trackInfo.describedSrc);\r\n                        }\r\n                        \r\n                        // Insert new track element\r\n                        if (nextSibling && nextSibling.parentNode) {\r\n                            parent.insertBefore(newTrackElement, nextSibling);\r\n                        } else {\r\n                            parent.appendChild(newTrackElement);\r\n                        }\r\n                        \r\n                        // Update reference to the new track element\r\n                        trackInfo.trackElement = newTrackElement;\r\n                    });\r\n                    \r\n                    this.invalidateTrackCache();\r\n                    resolve();\r\n                }, 100);\r\n            });\r\n        }\r\n        \r\n        // Swap source elements back to original versions\r\n        // Check if we have source elements with data-orig-src\r\n        const allSourceElements = this.sourceElements;\r\n        const hasSourceElementsToSwap = allSourceElements.some(el => el.getAttribute('data-orig-src'));\r\n        \r\n        if (hasSourceElementsToSwap) {\r\n            const sourcesToRestore = [];\r\n            \r\n            allSourceElements.forEach((sourceEl) => {\r\n                const origSrcAttr = sourceEl.getAttribute('data-orig-src');\r\n                const descSrcAttr = sourceEl.getAttribute('data-desc-src');\r\n                \r\n                if (origSrcAttr) {\r\n                    // Swap back to original src\r\n                    const type = sourceEl.getAttribute('type');\r\n                    sourcesToRestore.push({\r\n                        src: origSrcAttr,  // Use original version\r\n                        type: type,\r\n                        origSrc: origSrcAttr,\r\n                        descSrc: descSrcAttr  // Keep data-desc-src for future swaps\r\n                    });\r\n                } else {\r\n                    // Keep as-is (no data-orig-src means it wasn't swapped)\r\n                    const type = sourceEl.getAttribute('type');\r\n                    const src = sourceEl.getAttribute('src');\r\n                    sourcesToRestore.push({\r\n                        src: src,\r\n                        type: type,\r\n                        origSrc: null,\r\n                        descSrc: descSrcAttr\r\n                    });\r\n                }\r\n            });\r\n            \r\n            // Remove src attribute if present (video with src can't have source elements per HTML spec)\r\n            const hasSrcAttribute = this.element.hasAttribute('src');\r\n            const srcValue = hasSrcAttribute ? this.element.getAttribute('src') : null;\r\n            if (hasSrcAttribute) {\r\n                this.element.removeAttribute('src');\r\n            }\r\n            \r\n            // Remove all source elements\r\n            allSourceElements.forEach(sourceEl => {\r\n                sourceEl.remove();\r\n            });\r\n            \r\n            // Re-add them with original src attributes\r\n            sourcesToRestore.forEach(sourceInfo => {\r\n                const newSource = document.createElement('source');\r\n                newSource.setAttribute('src', sourceInfo.src);\r\n                if (sourceInfo.type) {\r\n                    newSource.setAttribute('type', sourceInfo.type);\r\n                }\r\n                if (sourceInfo.origSrc) {\r\n                    newSource.setAttribute('data-orig-src', sourceInfo.origSrc);\r\n                }\r\n                if (sourceInfo.descSrc) {\r\n                    newSource.setAttribute('data-desc-src', sourceInfo.descSrc);\r\n                }\r\n                const firstTrack = this.element.querySelector('track');\r\n                if (firstTrack) {\r\n                    this.element.insertBefore(newSource, firstTrack);\r\n                } else {\r\n                    this.element.appendChild(newSource);\r\n                }\r\n            });\r\n\r\n            // Ensure cached source references are refreshed after rebuilding the list\r\n            this._sourceElementsDirty = true;\r\n            this._sourceElementsCache = null;\r\n            \r\n            // Preserve poster before reload\r\n            if (posterValue && this.element.tagName === 'VIDEO') {\r\n                this.element.poster = posterValue;\r\n            }\r\n            \r\n            // Force reload\r\n            this.element.load();\r\n        } else {\r\n            // Fallback to updating element src directly (for videos without source elements)\r\n            // Preserve poster before changing src\r\n            if (posterValue && this.element.tagName === 'VIDEO') {\r\n                this.element.poster = posterValue;\r\n            }\r\n            const originalSrcToUse = this.originalAudioDescriptionSource || this.originalSrc;\r\n            this.element.src = originalSrcToUse;\r\n            this.element.load();\r\n        }\r\n\r\n        // Wait for new source to load metadata\r\n        await new Promise((resolve) => {\r\n            const onLoadedMetadata = () => {\r\n                this.element.removeEventListener('loadedmetadata', onLoadedMetadata);\r\n                resolve();\r\n            };\r\n            \r\n            if (this.element.readyState >= 1) {\r\n                // Metadata already loaded\r\n                resolve();\r\n            } else {\r\n                this.element.addEventListener('loadedmetadata', onLoadedMetadata);\r\n            }\r\n        });\r\n\r\n        // If we need to seek and/or play, wait for enough data to be loaded\r\n        if (currentTime > 0 || wasPlaying) {\r\n            await new Promise((resolve) => {\r\n                const onCanPlay = () => {\r\n                    this.element.removeEventListener('canplay', onCanPlay);\r\n                    this.element.removeEventListener('canplaythrough', onCanPlay);\r\n                    resolve();\r\n                };\r\n                \r\n                // Check if already ready\r\n                if (this.element.readyState >= 3) { // HAVE_FUTURE_DATA or better\r\n                    resolve();\r\n                } else {\r\n                    // Wait for canplay or canplaythrough\r\n                    this.element.addEventListener('canplay', onCanPlay, { once: true });\r\n                    this.element.addEventListener('canplaythrough', onCanPlay, { once: true });\r\n                    \r\n                    // Fallback timeout in case events don't fire\r\n                    setTimeout(() => {\r\n                        this.element.removeEventListener('canplay', onCanPlay);\r\n                        this.element.removeEventListener('canplaythrough', onCanPlay);\r\n                        resolve();\r\n                    }, 3000);\r\n                }\r\n            });\r\n        }\r\n\r\n        // Try to find matching caption in the new track for better synchronization\r\n        let syncTime = currentTime;\r\n        if (currentCaptionText && this.captionManager && this.captionManager.tracks.length > 0) {\r\n            // Wait a bit for tracks to load\r\n            await new Promise(resolve => setTimeout(resolve, 500));\r\n            \r\n            // Find the matching caption in the regular video's track\r\n            const matchingTime = this.findMatchingCaptionTime(currentCaptionText, this.captionManager.tracks);\r\n            if (matchingTime !== null) {\r\n                syncTime = matchingTime;\r\n                if (this.options.debug) {\r\n                    console.log(`[VidPly] Syncing via caption: ${currentTime}s -> ${syncTime}s`);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (syncTime > 0) {\r\n            this.seek(syncTime);\r\n            // Wait a bit for seek to complete\r\n            await new Promise(resolve => setTimeout(resolve, 100));\r\n        }\r\n\r\n        if (wasPlaying) {\r\n            await this.play();\r\n            this.hidePosterOverlay();\r\n        } else {\r\n            // Explicitly pause the video if it wasn't playing\r\n            // This ensures it's in a clean paused state after load()\r\n            this.pause();\r\n            if (!wasPlaying && syncTime === 0) {\r\n                this.showPosterOverlay();\r\n            } else {\r\n                this.hidePosterOverlay();\r\n            }\r\n        }\r\n\r\n            // Reload CaptionManager tracks if tracks were swapped (so it has fresh references)\r\n            if (swappedTracksForTranscript.length > 0 && this.captionManager) {\r\n                // Store if captions were enabled and which track\r\n                const wasCaptionsEnabled = this.state.captionsEnabled;\r\n                let currentTrackInfo = null;\r\n                if (this.captionManager.currentTrack) {\r\n                    const currentTrackIndex = this.captionManager.tracks.findIndex(t => t.track === this.captionManager.currentTrack.track);\r\n                    if (currentTrackIndex >= 0) {\r\n                        currentTrackInfo = {\r\n                            language: this.captionManager.tracks[currentTrackIndex].language,\r\n                            kind: this.captionManager.tracks[currentTrackIndex].kind\r\n                        };\r\n                    }\r\n                }\r\n                \r\n                // Wait for tracks to be processed by the browser\r\n                const reloadTracks = () => {\r\n                    // Reload tracks to get fresh references to new TextTrack objects\r\n                    this.captionManager.tracks = [];\r\n                    this.captionManager.loadTracks();\r\n                    \r\n                    // Re-enable captions if they were enabled before\r\n                    if (wasCaptionsEnabled && currentTrackInfo && this.captionManager.tracks.length > 0) {\r\n                        // Find the track by language and kind to match the swapped track\r\n                        const matchingTrackIndex = this.captionManager.tracks.findIndex(t => \r\n                            t.language === currentTrackInfo.language && t.kind === currentTrackInfo.kind\r\n                        );\r\n                        \r\n                        if (matchingTrackIndex >= 0) {\r\n                            const trackToEnable = this.captionManager.tracks[matchingTrackIndex];\r\n                            // Wait for track to load its cues before enabling\r\n                            if (trackToEnable.track.readyState >= 2) {\r\n                                // Track is already loaded\r\n                                this.captionManager.enable(matchingTrackIndex);\r\n                            } else {\r\n                                // Wait for track to load\r\n                                const onTrackLoad = () => {\r\n                                    trackToEnable.track.removeEventListener('load', onTrackLoad);\r\n                                    trackToEnable.track.removeEventListener('error', onTrackLoad);\r\n                                    if (this.captionManager && this.captionManager.tracks.includes(trackToEnable)) {\r\n                                        this.captionManager.enable(matchingTrackIndex);\r\n                                    }\r\n                                };\r\n                                trackToEnable.track.addEventListener('load', onTrackLoad, { once: true });\r\n                                trackToEnable.track.addEventListener('error', onTrackLoad, { once: true });\r\n                                // Set mode to 'hidden' to trigger loading\r\n                                trackToEnable.track.mode = 'hidden';\r\n                                // Fallback timeout\r\n                                setTimeout(() => {\r\n                                    if (this.captionManager && this.captionManager.tracks.includes(trackToEnable)) {\r\n                                        this.captionManager.enable(matchingTrackIndex);\r\n                                    }\r\n                                }, 1000);\r\n                            }\r\n                        } else if (this.captionManager.tracks.length > 0) {\r\n                            // Fallback: enable first track\r\n                            const firstTrack = this.captionManager.tracks[0];\r\n                            if (firstTrack.track.readyState >= 2) {\r\n                                this.captionManager.enable(0);\r\n                            } else {\r\n                                const onTrackLoad = () => {\r\n                                    firstTrack.track.removeEventListener('load', onTrackLoad);\r\n                                    firstTrack.track.removeEventListener('error', onTrackLoad);\r\n                                    if (this.captionManager && this.captionManager.tracks.includes(firstTrack)) {\r\n                                        this.captionManager.enable(0);\r\n                                    }\r\n                                };\r\n                                firstTrack.track.addEventListener('load', onTrackLoad, { once: true });\r\n                                firstTrack.track.addEventListener('error', onTrackLoad, { once: true });\r\n                                firstTrack.track.mode = 'hidden';\r\n                                setTimeout(() => {\r\n                                    if (this.captionManager && this.captionManager.tracks.includes(firstTrack)) {\r\n                                        this.captionManager.enable(0);\r\n                                    }\r\n                                }, 1000);\r\n                            }\r\n                        }\r\n                    }\r\n                };\r\n                \r\n                // Wait for tracks to be processed by the browser\r\n                setTimeout(reloadTracks, 600);\r\n            }\r\n\r\n            // Reload transcript if visible (after video metadata loaded, tracks should be available)\r\n            // Reload regardless of whether caption tracks were swapped, in case tracks changed\r\n            if (this.transcriptManager && this.transcriptManager.isVisible) {\r\n                // Wait for tracks to load after source swap\r\n                this.setManagedTimeout(() => {\r\n                    if (this.transcriptManager && this.transcriptManager.loadTranscriptData) {\r\n                        this.transcriptManager.loadTranscriptData();\r\n                    }\r\n                }, 500);\r\n            }\r\n\r\n        if (this._audioDescriptionDesiredState) {\r\n            return;\r\n        }\r\n\r\n        this.state.audioDescriptionEnabled = false;\r\n        this.emit('audiodescriptiondisabled');\r\n    }\r\n\r\n    async toggleAudioDescription() {\r\n        if (this.options.requirePlaybackForAccessibilityToggles && !this.renderer && this.playlistManager?.tracks?.length) {\r\n            this.showNotice(i18n.t('player.startPlaybackForAudioDescription'));\r\n            return;\r\n        }\r\n\r\n        // If user toggles audio description before the first track has been loaded,\r\n        // remember desired state and start playback so the described source is loaded.\r\n        if (!this.renderer && this.playlistManager && this.playlistManager.tracks?.length) {\r\n            this.audioDescriptionManager.desiredState = !this.audioDescriptionManager.desiredState;\r\n            this.state.audioDescriptionEnabled = this.audioDescriptionManager.desiredState;\r\n            this.emit(this.audioDescriptionManager.desiredState ? 'audiodescriptionenabled' : 'audiodescriptiondisabled');\r\n            // Start playback (PlaylistManager.play() will honor desiredState and load described src)\r\n            this.play();\r\n            return;\r\n        }\r\n\r\n        return this.audioDescriptionManager.toggle();\r\n    }\r\n\r\n    // Sign Language (delegated to SignLanguageManager)\r\n    enableSignLanguage() {\r\n        return this.signLanguageManager.enable();\r\n    }\r\n\r\n    // Legacy method body preserved for reference - can be removed after testing\r\n    _legacyEnableSignLanguage() {\r\n        // Determine available sign language sources\r\n        const hasMultipleSources = Object.keys(this.signLanguageSources).length > 0;\r\n        const hasSingleSource = !!this.signLanguageSrc;\r\n        \r\n        if (!hasMultipleSources && !hasSingleSource) {\r\n            console.warn('No sign language video source provided');\r\n            return;\r\n        }\r\n\r\n        if (this.signLanguageWrapper) {\r\n            // Already exists, just show it\r\n            this.signLanguageWrapper.style.display = 'block';\r\n            this.state.signLanguageEnabled = true;\r\n            this.emit('signlanguageenabled');\r\n            \r\n            // Focus the settings button after wrapper is shown\r\n            // Use setManagedTimeout to ensure it's properly scheduled\r\n            this.setManagedTimeout(() => {\r\n                if (this.signLanguageSettingsButton && document.contains(this.signLanguageSettingsButton)) {\r\n                    this.signLanguageSettingsButton.focus({ preventScroll: true });\r\n                }\r\n            }, 150);\r\n            return;\r\n        }\r\n        \r\n        // Determine initial sign language\r\n        let initialLang = null;\r\n        let initialSrc = null;\r\n        \r\n        if (hasMultipleSources) {\r\n            // Try to sync with current caption language\r\n            if (this.captionManager && this.captionManager.currentTrack) {\r\n                const captionLang = this.captionManager.currentTrack.language?.toLowerCase().split('-')[0];\r\n                if (captionLang && this.signLanguageSources[captionLang]) {\r\n                    initialLang = captionLang;\r\n                    initialSrc = this.signLanguageSources[captionLang];\r\n                }\r\n            }\r\n            \r\n            // If no match, try player language\r\n            if (!initialLang && this.options.language) {\r\n                const playerLang = this.options.language.toLowerCase().split('-')[0];\r\n                if (this.signLanguageSources[playerLang]) {\r\n                    initialLang = playerLang;\r\n                    initialSrc = this.signLanguageSources[playerLang];\r\n                }\r\n            }\r\n            \r\n            // If still no match, use first available\r\n            if (!initialLang) {\r\n                initialLang = Object.keys(this.signLanguageSources)[0];\r\n                initialSrc = this.signLanguageSources[initialLang];\r\n            }\r\n            \r\n            this.currentSignLanguage = initialLang;\r\n        } else {\r\n            // Single source fallback\r\n            initialSrc = this.signLanguageSrc;\r\n        }\r\n\r\n        // Create wrapper container\r\n        this.signLanguageWrapper = document.createElement('div');\r\n        this.signLanguageWrapper.className = 'vidply-sign-language-wrapper';\r\n        this.signLanguageWrapper.setAttribute('tabindex', '0');\r\n        this.signLanguageWrapper.setAttribute('aria-label', i18n.t('player.signLanguageDragResize'));\r\n\r\n        // Create header (draggable)\r\n        this.signLanguageHeader = DOMUtils.createElement('div', {\r\n            className: `${this.options.classPrefix}-sign-language-header`,\r\n            attributes: {\r\n                'tabindex': '0'\r\n            }\r\n        });\r\n\r\n        // Header left side (title)\r\n        const headerLeft = DOMUtils.createElement('div', {\r\n            className: `${this.options.classPrefix}-sign-language-header-left`\r\n        });\r\n\r\n        const title = DOMUtils.createElement('h3', {\r\n            textContent: i18n.t('player.signLanguageVideo')\r\n        });\r\n\r\n        // Settings button (before language selector)\r\n        const settingsAriaLabel = i18n.t('player.signLanguageSettings');\r\n        this.signLanguageSettingsButton = DOMUtils.createElement('button', {\r\n            className: `${this.options.classPrefix}-sign-language-settings`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': settingsAriaLabel,\r\n                'aria-expanded': 'false'\r\n            }\r\n        });\r\n        this.signLanguageSettingsButton.appendChild(createIconElement('settings'));\r\n        DOMUtils.attachTooltip(this.signLanguageSettingsButton, settingsAriaLabel, this.options.classPrefix);\r\n        this.signLanguageSettingsHandlers = {\r\n            settingsClick: (e) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                // Stop the document click handler from interfering\r\n                if (this.signLanguageDocumentClickHandler) {\r\n                    // Temporarily disable document click handler\r\n                    const wasJustOpened = this.signLanguageSettingsMenuJustOpened;\r\n                    this.signLanguageSettingsMenuJustOpened = true;\r\n                    setTimeout(() => {\r\n                        this.signLanguageSettingsMenuJustOpened = wasJustOpened;\r\n                    }, 100);\r\n                }\r\n                if (this.signLanguageSettingsMenuVisible) {\r\n                    this.hideSignLanguageSettingsMenu();\r\n                } else {\r\n                    this.showSignLanguageSettingsMenu();\r\n                }\r\n            },\r\n            settingsKeydown: (e) => {\r\n                // D key to toggle keyboard drag mode\r\n                if (e.key === 'd' || e.key === 'D') {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    this.toggleSignLanguageKeyboardDragMode();\r\n                }\r\n                // R key to toggle resize mode\r\n                else if (e.key === 'r' || e.key === 'R') {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    this.toggleSignLanguageResizeMode();\r\n                }\r\n                // Escape to close menu if open\r\n                else if (e.key === 'Escape' && this.signLanguageSettingsMenuVisible) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    this.hideSignLanguageSettingsMenu();\r\n                }\r\n            }\r\n        };\r\n        this.signLanguageSettingsButton.addEventListener('click', this.signLanguageSettingsHandlers.settingsClick);\r\n        this.signLanguageSettingsButton.addEventListener('keydown', this.signLanguageSettingsHandlers.settingsKeydown);\r\n        headerLeft.appendChild(this.signLanguageSettingsButton);\r\n\r\n        // Language selector (if multiple sources available)\r\n        this.signLanguageSelector = null;\r\n        if (hasMultipleSources) {\r\n            const selectId = `${this.options.classPrefix}-sign-language-select-${Date.now()}`;\r\n            \r\n            // Create options array\r\n            const options = Object.keys(this.signLanguageSources).map(langCode => ({\r\n                value: langCode,\r\n                text: this.getSignLanguageLabel(langCode),\r\n                selected: langCode === initialLang\r\n            }));\r\n            \r\n            const { label: signLanguageLabel, select: signLanguageSelector } = createLabeledSelect({\r\n                classPrefix: this.options.classPrefix,\r\n                labelClass: `${this.options.classPrefix}-sign-language-label`,\r\n                selectClass: `${this.options.classPrefix}-sign-language-select`,\r\n                labelText: 'settings.language',\r\n                selectId: selectId,\r\n                options: options,\r\n                onChange: (e) => {\r\n                    e.stopPropagation(); // Prevent event from bubbling\r\n                    const selectedLang = e.target.value;\r\n                    this.switchSignLanguage(selectedLang);\r\n                }\r\n            });\r\n            \r\n            this.signLanguageSelector = signLanguageSelector;\r\n            \r\n            // Wrap label and select in a container for horizontal layout\r\n            const signLanguageSelectorWrapper = DOMUtils.createElement('div', {\r\n                className: `${this.options.classPrefix}-sign-language-selector-wrapper`\r\n            });\r\n            signLanguageSelectorWrapper.appendChild(signLanguageLabel);\r\n            signLanguageSelectorWrapper.appendChild(this.signLanguageSelector);\r\n            \r\n            // Prevent drag when interacting with wrapper\r\n            preventDragOnElement(signLanguageSelectorWrapper);\r\n            \r\n            headerLeft.appendChild(signLanguageSelectorWrapper);\r\n        }\r\n\r\n        headerLeft.appendChild(title);\r\n        \r\n        // Close button\r\n        const closeAriaLabel = i18n.t('player.closeSignLanguage');\r\n        const closeButton = DOMUtils.createElement('button', {\r\n            className: `${this.options.classPrefix}-sign-language-close`,\r\n            attributes: {\r\n                'type': 'button',\r\n                'aria-label': closeAriaLabel\r\n            }\r\n        });\r\n        closeButton.appendChild(createIconElement('close'));\r\n        DOMUtils.attachTooltip(closeButton, closeAriaLabel, this.options.classPrefix);\r\n        closeButton.addEventListener('click', () => {\r\n            this.disableSignLanguage();\r\n            // Return focus to sign language button if available\r\n            if (this.controlBar && this.controlBar.controls && this.controlBar.controls.signLanguage) {\r\n                setTimeout(() => {\r\n                    this.controlBar.controls.signLanguage.focus({ preventScroll: true });\r\n                }, 0);\r\n            }\r\n        });\r\n\r\n        this.signLanguageHeader.appendChild(headerLeft);\r\n        this.signLanguageHeader.appendChild(closeButton);\r\n        \r\n        // Initialize settings menu state\r\n        this.signLanguageSettingsMenuVisible = false;\r\n        this.signLanguageSettingsMenu = null;\r\n        this.signLanguageSettingsMenuJustOpened = false;\r\n        this.signLanguageResizeOptionButton = null;\r\n        this.signLanguageResizeOptionText = null;\r\n        this.signLanguageDragOptionButton = null;\r\n        this.signLanguageDragOptionText = null;\r\n        this.signLanguageDocumentClickHandler = null;\r\n        this.signLanguageDocumentClickHandlerAdded = false;\r\n\r\n        // Create sign language video element\r\n        this.signLanguageVideo = document.createElement('video');\r\n        this.signLanguageVideo.className = 'vidply-sign-language-video';\r\n        this.signLanguageVideo.src = initialSrc;\r\n        this.signLanguageVideo.setAttribute('aria-label', i18n.t('player.signLanguage'));\r\n        this.signLanguageVideo.muted = true; // Sign language video should be muted\r\n        \r\n        // Enable inline playback on iOS (prevents native fullscreen)\r\n        this.signLanguageVideo.setAttribute('playsinline', '');\r\n\r\n        // Create resize handles (8 directions like transcript)\r\n        this.signLanguageResizeHandles = ['n', 's', 'e', 'w', 'ne', 'nw', 'se', 'sw'].map(dir => {\r\n            const handle = DOMUtils.createElement('div', {\r\n                className: `${this.options.classPrefix}-sign-resize-handle ${this.options.classPrefix}-sign-resize-${dir}`,\r\n                attributes: {\r\n                    'data-direction': dir,\r\n                    'data-vidply-managed-resize': 'true',\r\n                    'aria-hidden': 'true'\r\n                }\r\n            });\r\n            handle.style.display = 'none';\r\n            return handle;\r\n        });\r\n\r\n        // Append header, video and handles to wrapper\r\n        this.signLanguageWrapper.appendChild(this.signLanguageHeader);\r\n        this.signLanguageWrapper.appendChild(this.signLanguageVideo);\r\n        this.signLanguageResizeHandles.forEach(handle => this.signLanguageWrapper.appendChild(handle));\r\n\r\n        // Set width FIRST to ensure proper dimensions\r\n        const saved = this.storage.getSignLanguagePreferences();\r\n        if (saved && saved.size && saved.size.width) {\r\n            this.signLanguageWrapper.style.width = saved.size.width;\r\n        } else {\r\n            this.signLanguageWrapper.style.width = '280px'; // Default width\r\n        }\r\n        // Height is always auto to maintain aspect ratio\r\n        this.signLanguageWrapper.style.height = 'auto';\r\n        \r\n        // Position is always calculated fresh - use option or default to bottom-right\r\n        this.signLanguageDesiredPosition = this.options.signLanguagePosition || 'bottom-right';\r\n\r\n        // Add to main player container (NOT videoWrapper) to avoid overflow:hidden clipping\r\n        this.container.appendChild(this.signLanguageWrapper);\r\n\r\n        // Set position immediately after appending\r\n        requestAnimationFrame(() => {\r\n            this.constrainSignLanguagePosition();\r\n        });\r\n\r\n        // Sync with main video\r\n        this.signLanguageVideo.currentTime = this.state.currentTime;\r\n        if (!this.state.paused) {\r\n            this.signLanguageVideo.play();\r\n        }\r\n\r\n        // Setup drag and resize\r\n        this.setupSignLanguageInteraction();\r\n\r\n        // Create bound handlers to store references for cleanup\r\n        this.signLanguageHandlers = {\r\n            play: () => {\r\n                if (this.signLanguageVideo) {\r\n                    this.signLanguageVideo.play();\r\n                }\r\n            },\r\n            pause: () => {\r\n                if (this.signLanguageVideo) {\r\n                    this.signLanguageVideo.pause();\r\n                }\r\n            },\r\n            timeupdate: () => {\r\n                if (this.signLanguageVideo && Math.abs(this.signLanguageVideo.currentTime - this.state.currentTime) > 0.5) {\r\n                    this.signLanguageVideo.currentTime = this.state.currentTime;\r\n                }\r\n            },\r\n            ratechange: () => {\r\n                if (this.signLanguageVideo) {\r\n                    this.signLanguageVideo.playbackRate = this.state.playbackSpeed;\r\n                }\r\n            }\r\n        };\r\n\r\n        // Sync playback\r\n        this.on('play', this.signLanguageHandlers.play);\r\n        this.on('pause', this.signLanguageHandlers.pause);\r\n        this.on('timeupdate', this.signLanguageHandlers.timeupdate);\r\n        this.on('ratechange', this.signLanguageHandlers.ratechange);\r\n        \r\n        // Sync sign language when captions change (if multiple sources available)\r\n        if (hasMultipleSources) {\r\n            this.signLanguageHandlers.captionChange = () => {\r\n                if (this.captionManager && this.captionManager.currentTrack && this.signLanguageSelector) {\r\n                    const captionLang = this.captionManager.currentTrack.language?.toLowerCase().split('-')[0];\r\n                    if (captionLang && this.signLanguageSources[captionLang] && this.currentSignLanguage !== captionLang) {\r\n                        this.switchSignLanguage(captionLang);\r\n                        // Update selector\r\n                        this.signLanguageSelector.value = captionLang;\r\n                    }\r\n                }\r\n            };\r\n            // Listen to captionsenabled which fires when a track is enabled (including when switching)\r\n            this.on('captionsenabled', this.signLanguageHandlers.captionChange);\r\n        }\r\n\r\n        this.state.signLanguageEnabled = true;\r\n        this.emit('signlanguageenabled');\r\n        \r\n        // Focus the settings button after wrapper is appended to DOM\r\n        // Use setManagedTimeout to ensure it's properly scheduled\r\n        this.setManagedTimeout(() => {\r\n            if (this.signLanguageSettingsButton && document.contains(this.signLanguageSettingsButton)) {\r\n                this.signLanguageSettingsButton.focus({ preventScroll: true });\r\n            }\r\n        }, 150);\r\n    }\r\n\r\n    disableSignLanguage() {\r\n        return this.signLanguageManager.disable();\r\n    }\r\n\r\n    toggleSignLanguage() {\r\n        if (this.options.requirePlaybackForAccessibilityToggles && !this.renderer && this.playlistManager?.tracks?.length) {\r\n            this.showNotice(i18n.t('player.startPlaybackForSignLanguage'));\r\n            return;\r\n        }\r\n\r\n        // If user toggles sign language before the first track has been loaded,\r\n        // enable the overlay and start playback so sign language video sync begins.\r\n        if (!this.renderer && this.playlistManager && this.playlistManager.tracks?.length) {\r\n            const wasEnabled = this.signLanguageManager.enabled;\r\n            const result = this.signLanguageManager.toggle();\r\n            if (!wasEnabled && this.signLanguageManager.enabled) {\r\n                this.play();\r\n            }\r\n            return result;\r\n        }\r\n\r\n        return this.signLanguageManager.toggle();\r\n    }\r\n\r\n    setupSignLanguageInteraction() {\r\n        return this.signLanguageManager._setupInteraction();\r\n    }\r\n\r\n    // Legacy method preserved for reference\r\n    _legacySetupSignLanguageInteraction() {\r\n        if (!this.signLanguageWrapper) return;\r\n\r\n        // Check if we're on mobile and not in fullscreen\r\n        const isMobile = window.innerWidth < 768;\r\n        const isFullscreen = this.state.fullscreen;\r\n        \r\n        // On mobile devices (< 768px), only enable drag/resize in fullscreen\r\n        // On desktop/tablets (>= 768px), always enable drag/resize\r\n        if (isMobile && !isFullscreen) {\r\n            // Destroy existing instance if exiting fullscreen on mobile\r\n            if (this.signLanguageDraggable) {\r\n                this.signLanguageDraggable.destroy();\r\n                this.signLanguageDraggable = null;\r\n            }\r\n            return; // No drag/resize on mobile when not in fullscreen\r\n        }\r\n\r\n        // If already initialized, don't re-initialize\r\n        if (this.signLanguageDraggable) {\r\n            return;\r\n        }\r\n\r\n        // Create DraggableResizable utility with touch support\r\n        // Use header as drag handle instead of video\r\n        this.signLanguageDraggable = new DraggableResizable(this.signLanguageWrapper, {\r\n            dragHandle: this.signLanguageHeader,\r\n            resizeHandles: this.signLanguageResizeHandles,\r\n            constrainToViewport: true,\r\n            maintainAspectRatio: true,\r\n            minWidth: 150,\r\n            minHeight: 100,\r\n            classPrefix: `${this.options.classPrefix}-sign`,\r\n            keyboardDragKey: 'd',\r\n            keyboardResizeKey: 'r',\r\n            keyboardStep: 10,\r\n            keyboardStepLarge: 50,\r\n            pointerResizeIndicatorText: i18n.t('player.signLanguageResizeActive'),\r\n            onPointerResizeToggle: (enabled) => {\r\n                // Update resize handles visibility\r\n                this.signLanguageResizeHandles.forEach(handle => {\r\n                    handle.style.display = enabled ? 'block' : 'none';\r\n                });\r\n            },\r\n            onDragStart: (e) => {\r\n                // Don't drag if clicking on close button, settings button, language selector, or settings menu\r\n                if (e.target.closest(`.${this.options.classPrefix}-sign-language-close`) ||\r\n                    e.target.closest(`.${this.options.classPrefix}-sign-language-settings`) ||\r\n                    e.target.closest(`.${this.options.classPrefix}-sign-language-select`) ||\r\n                    e.target.closest(`.${this.options.classPrefix}-sign-language-label`) ||\r\n                    e.target.closest(`.${this.options.classPrefix}-sign-language-settings-menu`)) {\r\n                    return false; // Prevent drag\r\n                }\r\n                return true; // Allow drag\r\n            }\r\n        });\r\n\r\n        // Add custom keyboard handler for special keys (Escape, Home)\r\n        this.signLanguageCustomKeyHandler = (e) => {\r\n            const key = e.key.toLowerCase();\r\n            \r\n            // Don't handle keys if settings menu is open (let menu handle them)\r\n            if (this.signLanguageSettingsMenuVisible) {\r\n                return;\r\n            }\r\n            \r\n            if (key === 'home') {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                if (this.signLanguageDraggable) {\r\n                    if (this.signLanguageDraggable.pointerResizeMode) {\r\n                        this.signLanguageDraggable.disablePointerResizeMode();\r\n                    }\r\n                    this.signLanguageDraggable.manuallyPositioned = false;\r\n                    this.constrainSignLanguagePosition();\r\n                }\r\n                return;\r\n            }\r\n            \r\n            if (key === 'r') {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                const enabled = this.toggleSignLanguageResizeMode();\r\n                if (enabled) {\r\n                    this.signLanguageWrapper.focus({ preventScroll: true });\r\n                }\r\n                return;\r\n            }\r\n            \r\n            if (key === 'escape') {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                // Exit resize mode if active\r\n                if (this.signLanguageDraggable && this.signLanguageDraggable.pointerResizeMode) {\r\n                    this.signLanguageDraggable.disablePointerResizeMode();\r\n                    return;\r\n                }\r\n                // Exit keyboard drag mode if active\r\n                if (this.signLanguageDraggable && this.signLanguageDraggable.keyboardDragMode) {\r\n                    this.signLanguageDraggable.disableKeyboardDragMode();\r\n                    return;\r\n                }\r\n                // Close video if no modes are active\r\n                this.disableSignLanguage();\r\n                // Return focus to sign language button if available\r\n                if (this.controlBar && this.controlBar.controls && this.controlBar.controls.signLanguage) {\r\n                    setTimeout(() => {\r\n                        this.controlBar.controls.signLanguage.focus({ preventScroll: true });\r\n                    }, 0);\r\n                }\r\n                return;\r\n            }\r\n        };\r\n        \r\n        this.signLanguageWrapper.addEventListener('keydown', this.signLanguageCustomKeyHandler);\r\n\r\n        // Store for cleanup\r\n        this.signLanguageInteractionHandlers = {\r\n            draggable: this.signLanguageDraggable,\r\n            headerKeyHandler: this.signLanguageHeaderKeyHandler,\r\n            customKeyHandler: this.signLanguageCustomKeyHandler\r\n        };\r\n    }\r\n\r\n    toggleSignLanguageKeyboardDragMode() {\r\n        if (this.signLanguageDraggable) {\r\n            const wasEnabled = this.signLanguageDraggable.keyboardDragMode;\r\n            this.signLanguageDraggable.toggleKeyboardDragMode();\r\n            const isEnabled = this.signLanguageDraggable.keyboardDragMode;\r\n            if (!wasEnabled && isEnabled) {\r\n                this.enableSignLanguageMoveMode();\r\n            }\r\n            // Update drag option state\r\n            this.updateSignLanguageDragOptionState();\r\n        }\r\n    }\r\n\r\n    enableSignLanguageMoveMode() {\r\n        // Add visual feedback for move mode\r\n        this.signLanguageWrapper.classList.add(`${this.options.classPrefix}-sign-move-mode`);\r\n        \r\n        // Update resize option state in case menu is open\r\n        this.updateSignLanguageResizeOptionState();\r\n        \r\n        // Remove after 2 seconds\r\n        setTimeout(() => {\r\n            this.signLanguageWrapper.classList.remove(`${this.options.classPrefix}-sign-move-mode`);\r\n        }, 2000);\r\n    }\r\n\r\n    toggleSignLanguageResizeMode({ focus = true } = {}) {\r\n        if (!this.signLanguageDraggable) {\r\n            return false;\r\n        }\r\n\r\n        if (this.signLanguageDraggable.pointerResizeMode) {\r\n            this.signLanguageDraggable.disablePointerResizeMode({ focus });\r\n            this.updateSignLanguageResizeOptionState();\r\n            return false;\r\n        }\r\n\r\n        this.signLanguageDraggable.enablePointerResizeMode({ focus });\r\n        this.updateSignLanguageResizeOptionState();\r\n        return true;\r\n    }\r\n\r\n    getSignLanguageLabel(langCode) {\r\n        // Get language label from i18n or use language code\r\n        const langNames = {\r\n            'en': 'English',\r\n            'de': 'Deutsch',\r\n            'es': 'Espaol',\r\n            'fr': 'Franais',\r\n            'it': 'Italiano',\r\n            'ja': '',\r\n            'pt': 'Portugus',\r\n            'ar': '',\r\n            'hi': ''\r\n        };\r\n        return langNames[langCode] || langCode.toUpperCase();\r\n    }\r\n\r\n    switchSignLanguage(langCode) {\r\n        return this.signLanguageManager.switchLanguage(langCode);\r\n    }\r\n\r\n    // Legacy method preserved for reference\r\n    _legacySwitchSignLanguage(langCode) {\r\n        if (!this.signLanguageSources[langCode] || !this.signLanguageVideo) {\r\n            return;\r\n        }\r\n        \r\n        const currentTime = this.signLanguageVideo.currentTime;\r\n        const wasPlaying = !this.signLanguageVideo.paused;\r\n        \r\n        this.signLanguageVideo.src = this.signLanguageSources[langCode];\r\n        this.currentSignLanguage = langCode;\r\n        \r\n        // Restore playback state\r\n        this.signLanguageVideo.currentTime = currentTime;\r\n        if (wasPlaying) {\r\n            this.signLanguageVideo.play().catch(() => {\r\n                // Ignore play errors\r\n            });\r\n        }\r\n        \r\n        this.emit('signlanguagelanguagechanged', langCode);\r\n    }\r\n\r\n    showSignLanguageSettingsMenu() {\r\n        return this.signLanguageManager.showSettingsMenu();\r\n    }\r\n\r\n    // Legacy method preserved for reference\r\n    _legacyShowSignLanguageSettingsMenu() {\r\n        // Set flag to prevent immediate closing\r\n        this.signLanguageSettingsMenuJustOpened = true;\r\n        setTimeout(() => {\r\n            this.signLanguageSettingsMenuJustOpened = false;\r\n        }, 350);\r\n        \r\n        // Add document click handler on FIRST menu open (not at window creation)\r\n        if (!this.signLanguageDocumentClickHandlerAdded) {\r\n            this.signLanguageDocumentClickHandler = (e) => {\r\n                // Ignore if menu was just opened (prevents immediate closing)\r\n                if (this.signLanguageSettingsMenuJustOpened) {\r\n                    return;\r\n                }\r\n                \r\n                // Ignore clicks on the settings button itself or its children\r\n                if (this.signLanguageSettingsButton && \r\n                    (this.signLanguageSettingsButton === e.target || this.signLanguageSettingsButton.contains(e.target))) {\r\n                    return;\r\n                }\r\n                \r\n                // Ignore clicks on the settings menu items\r\n                if (this.signLanguageSettingsMenu && this.signLanguageSettingsMenu.contains(e.target)) {\r\n                    return;\r\n                }\r\n                \r\n                // Close menu if clicking outside\r\n                if (this.signLanguageSettingsMenuVisible) {\r\n                    this.hideSignLanguageSettingsMenu();\r\n                }\r\n            };\r\n            setTimeout(() => {\r\n                document.addEventListener('mousedown', this.signLanguageDocumentClickHandler, true); // Use mousedown in capture phase\r\n                this.signLanguageDocumentClickHandlerAdded = true;\r\n            }, 300);\r\n        }\r\n        \r\n        if (this.signLanguageSettingsMenu) {\r\n            this.signLanguageSettingsMenu.style.display = 'block';\r\n            this.signLanguageSettingsMenuVisible = true;\r\n            if (this.signLanguageSettingsButton) {\r\n                this.signLanguageSettingsButton.setAttribute('aria-expanded', 'true');\r\n            }\r\n            // Always re-attach keyboard navigation handler when reopening\r\n            this.signLanguageSettingsMenuKeyHandler = attachMenuKeyboardNavigation(\r\n                this.signLanguageSettingsMenu,\r\n                this.signLanguageSettingsButton,\r\n                `.${this.options.classPrefix}-sign-language-settings-item`,\r\n                () => this.hideSignLanguageSettingsMenu({ focusButton: true })\r\n            );\r\n            // Reposition menu in case window was moved (async for repositioning)\r\n            this.positionSignLanguageSettingsMenu();\r\n            this.updateSignLanguageDragOptionState();\r\n            this.updateSignLanguageResizeOptionState();\r\n            focusFirstMenuItem(this.signLanguageSettingsMenu, `.${this.options.classPrefix}-sign-language-settings-item`);\r\n            return;\r\n        }\r\n        \r\n        // Create settings menu\r\n        this.signLanguageSettingsMenu = DOMUtils.createElement('div', {\r\n            className: `${this.options.classPrefix}-sign-language-settings-menu`,\r\n            attributes: {\r\n                'role': 'menu'\r\n            }\r\n        });\r\n\r\n        // Keyboard drag option\r\n        const keyboardDragOption = createMenuItem({\r\n            classPrefix: this.options.classPrefix,\r\n            itemClass: `${this.options.classPrefix}-sign-language-settings-item`,\r\n            icon: 'move',\r\n            label: 'player.enableSignDragMode',\r\n            hasTextClass: true,\r\n            onClick: () => {\r\n                this.toggleSignLanguageKeyboardDragMode();\r\n                this.hideSignLanguageSettingsMenu();\r\n            }\r\n        });\r\n        keyboardDragOption.setAttribute('role', 'switch');\r\n        keyboardDragOption.setAttribute('aria-checked', 'false');\r\n        // Remove any tooltips from menu items (they have visible text)\r\n        const dragTooltip = keyboardDragOption.querySelector(`.${this.options.classPrefix}-tooltip`);\r\n        if (dragTooltip) dragTooltip.remove();\r\n        const dragButtonText = keyboardDragOption.querySelector(`.${this.options.classPrefix}-button-text`);\r\n        if (dragButtonText) dragButtonText.remove();\r\n        this.signLanguageDragOptionButton = keyboardDragOption;\r\n        this.signLanguageDragOptionText = keyboardDragOption.querySelector(`.${this.options.classPrefix}-settings-text`);\r\n        this.updateSignLanguageDragOptionState();\r\n\r\n        // Resize option\r\n        const resizeOption = createMenuItem({\r\n            classPrefix: this.options.classPrefix,\r\n            itemClass: `${this.options.classPrefix}-sign-language-settings-item`,\r\n            icon: 'resize',\r\n            label: 'player.enableSignResizeMode',\r\n            hasTextClass: true,\r\n            onClick: (event) => {\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n                \r\n                const enabled = this.toggleSignLanguageResizeMode({ focus: false });\r\n                \r\n                if (enabled) {\r\n                    this.hideSignLanguageSettingsMenu({ focusButton: false });\r\n                    // Focus sign language wrapper after handles appear\r\n                    setTimeout(() => {\r\n                        if (this.signLanguageWrapper) {\r\n                            this.signLanguageWrapper.focus({ preventScroll: true });\r\n                        }\r\n                    }, 20);\r\n                } else {\r\n                    this.hideSignLanguageSettingsMenu({ focusButton: true });\r\n                }\r\n            }\r\n        });\r\n        resizeOption.setAttribute('role', 'switch');\r\n        resizeOption.setAttribute('aria-checked', 'false');\r\n        // Remove any tooltips from menu items (they have visible text)\r\n        const resizeTooltip = resizeOption.querySelector(`.${this.options.classPrefix}-tooltip`);\r\n        if (resizeTooltip) resizeTooltip.remove();\r\n        const resizeButtonText = resizeOption.querySelector(`.${this.options.classPrefix}-button-text`);\r\n        if (resizeButtonText) resizeButtonText.remove();\r\n        this.signLanguageResizeOptionButton = resizeOption;\r\n        this.signLanguageResizeOptionText = resizeOption.querySelector(`.${this.options.classPrefix}-settings-text`);\r\n        this.updateSignLanguageResizeOptionState();\r\n\r\n        // Close option\r\n        const closeOption = createMenuItem({\r\n            classPrefix: this.options.classPrefix,\r\n            itemClass: `${this.options.classPrefix}-sign-language-settings-item`,\r\n            icon: 'close',\r\n            label: 'transcript.closeMenu',\r\n            onClick: () => {\r\n                this.hideSignLanguageSettingsMenu();\r\n            }\r\n        });\r\n        // Remove any tooltips from menu items (they have visible text)\r\n        const closeTooltip = closeOption.querySelector(`.${this.options.classPrefix}-tooltip`);\r\n        if (closeTooltip) closeTooltip.remove();\r\n        const closeButtonText = closeOption.querySelector(`.${this.options.classPrefix}-button-text`);\r\n        if (closeButtonText) closeButtonText.remove();\r\n\r\n        this.signLanguageSettingsMenu.appendChild(keyboardDragOption);\r\n        this.signLanguageSettingsMenu.appendChild(resizeOption);\r\n        this.signLanguageSettingsMenu.appendChild(closeOption);\r\n\r\n        // Position menu first (before it's visible) to prevent jumping\r\n        // Set menu to invisible temporarily\r\n        this.signLanguageSettingsMenu.style.visibility = 'hidden';\r\n        this.signLanguageSettingsMenu.style.display = 'block';\r\n        \r\n        // Insert menu right after the button in the DOM (like control bar menus)\r\n        if (this.signLanguageSettingsButton && this.signLanguageSettingsButton.parentNode) {\r\n            this.signLanguageSettingsButton.insertAdjacentElement('afterend', this.signLanguageSettingsMenu);\r\n        } else if (this.signLanguageWrapper) {\r\n            // Fallback: append to wrapper if button parent not available\r\n            this.signLanguageWrapper.appendChild(this.signLanguageSettingsMenu);\r\n        }\r\n        \r\n        // Position the menu relative to the settings button (immediately while hidden)\r\n        this.positionSignLanguageSettingsMenuImmediate();\r\n        \r\n        // Make menu visible after positioning\r\n        requestAnimationFrame(() => {\r\n            if (this.signLanguageSettingsMenu) {\r\n                this.signLanguageSettingsMenu.style.visibility = 'visible';\r\n            }\r\n        });\r\n        \r\n        // Add keyboard navigation\r\n        this.signLanguageSettingsMenuKeyHandler = attachMenuKeyboardNavigation(\r\n            this.signLanguageSettingsMenu,\r\n            this.signLanguageSettingsButton,\r\n            `.${this.options.classPrefix}-sign-language-settings-item`,\r\n            () => this.hideSignLanguageSettingsMenu({ focusButton: true })\r\n        );\r\n        \r\n        // Set the menu as visible and display it\r\n        this.signLanguageSettingsMenuVisible = true;\r\n        // this.signLanguageSettingsMenu.style.display = 'block'; // Already set above\r\n        \r\n        // Update aria-expanded\r\n        if (this.signLanguageSettingsButton) {\r\n            this.signLanguageSettingsButton.setAttribute('aria-expanded', 'true');\r\n        }\r\n        this.updateSignLanguageDragOptionState();\r\n        this.updateSignLanguageResizeOptionState();\r\n        \r\n        // Focus first menu item\r\n        focusFirstMenuItem(this.signLanguageSettingsMenu, `.${this.options.classPrefix}-sign-language-settings-item`);\r\n    }\r\n\r\n    hideSignLanguageSettingsMenu({ focusButton = true } = {}) {\r\n        return this.signLanguageManager.hideSettingsMenu({ focusButton });\r\n    }\r\n\r\n    positionSignLanguageSettingsMenuImmediate() {\r\n        if (!this.signLanguageSettingsMenu || !this.signLanguageSettingsButton) return;\r\n        \r\n        // Position immediately (synchronously) - used when menu is first shown\r\n        const buttonRect = this.signLanguageSettingsButton.getBoundingClientRect();\r\n        const menuRect = this.signLanguageSettingsMenu.getBoundingClientRect();\r\n        const viewportWidth = window.innerWidth;\r\n        const viewportHeight = window.innerHeight;\r\n        \r\n        // Get the parent container (headerLeft) as the positioning container (like control bar menus)\r\n        const parentContainer = this.signLanguageSettingsButton.parentElement;\r\n        if (!parentContainer) return;\r\n        \r\n        const parentRect = parentContainer.getBoundingClientRect();\r\n        \r\n        // Calculate position relative to parent container\r\n        const buttonCenterX = buttonRect.left + buttonRect.width / 2 - parentRect.left;\r\n        const buttonBottom = buttonRect.bottom - parentRect.top;\r\n        const buttonTop = buttonRect.top - parentRect.top;\r\n        \r\n        const spaceAbove = buttonRect.top;\r\n        const spaceBelow = viewportHeight - buttonRect.bottom;\r\n        \r\n        // Position menu below button by default\r\n        let menuTop = buttonBottom + 8;\r\n        let menuBottom = null;\r\n        \r\n        // Prefer below, but switch to above if not enough space\r\n        if (spaceBelow < menuRect.height + 20 && spaceAbove > spaceBelow) {\r\n            menuTop = null;\r\n            const parentHeight = parentRect.bottom - parentRect.top;\r\n            menuBottom = parentHeight - buttonTop + 8;\r\n            this.signLanguageSettingsMenu.classList.add('vidply-menu-above');\r\n        } else {\r\n            this.signLanguageSettingsMenu.classList.remove('vidply-menu-above');\r\n        }\r\n        \r\n        // Calculate horizontal position (center on button)\r\n        let menuLeft = buttonCenterX - menuRect.width / 2;\r\n        let menuRight = 'auto';\r\n        let transformX = 'translateX(0)';\r\n        \r\n        const menuLeftAbsolute = buttonRect.left + buttonRect.width / 2 - menuRect.width / 2;\r\n        if (menuLeftAbsolute < 10) {\r\n            menuLeft = 0;\r\n            transformX = 'translateX(0)';\r\n        } else if (menuLeftAbsolute + menuRect.width > viewportWidth - 10) {\r\n            menuLeft = 'auto';\r\n            menuRight = 0;\r\n            transformX = 'translateX(0)';\r\n        } else {\r\n            menuLeft = buttonCenterX;\r\n            transformX = 'translateX(-50%)';\r\n        }\r\n        \r\n        // Apply calculated positions\r\n        if (menuTop !== null) {\r\n            this.signLanguageSettingsMenu.style.top = `${menuTop}px`;\r\n            this.signLanguageSettingsMenu.style.bottom = 'auto';\r\n        } else if (menuBottom !== null) {\r\n            this.signLanguageSettingsMenu.style.top = 'auto';\r\n            this.signLanguageSettingsMenu.style.bottom = `${menuBottom}px`;\r\n        }\r\n        \r\n        if (menuLeft !== 'auto') {\r\n            this.signLanguageSettingsMenu.style.left = `${menuLeft}px`;\r\n            this.signLanguageSettingsMenu.style.right = 'auto';\r\n        } else {\r\n            this.signLanguageSettingsMenu.style.left = 'auto';\r\n            this.signLanguageSettingsMenu.style.right = `${menuRight}px`;\r\n        }\r\n        \r\n        this.signLanguageSettingsMenu.style.transform = transformX;\r\n    }\r\n    \r\n    positionSignLanguageSettingsMenu() {\r\n        if (!this.signLanguageSettingsMenu || !this.signLanguageSettingsButton || !this.signLanguageWrapper) return;\r\n        \r\n        // Use requestAnimationFrame to ensure layout is stable before positioning (for repositioning)\r\n        requestAnimationFrame(() => {\r\n            setTimeout(() => {\r\n                this.positionSignLanguageSettingsMenuImmediate();\r\n            }, 10); // Small delay to ensure layout is stable\r\n        });\r\n    }\r\n\r\n    attachSignLanguageSettingsMenuKeyboardNavigation() {\r\n        if (!this.signLanguageSettingsMenu) return;\r\n        \r\n        // Remove existing handler if any\r\n        if (this.signLanguageSettingsMenuKeyHandler) {\r\n            this.signLanguageSettingsMenu.removeEventListener('keydown', this.signLanguageSettingsMenuKeyHandler);\r\n        }\r\n        \r\n        this.signLanguageSettingsMenuKeyHandler = attachMenuKeyboardNavigation(\r\n            this.signLanguageSettingsMenu,\r\n            this.signLanguageSettingsButton,\r\n            `.${this.options.classPrefix}-sign-language-settings-item`,\r\n            () => this.hideSignLanguageSettingsMenu({ focusButton: true })\r\n        );\r\n    }\r\n\r\n    updateSignLanguageDragOptionState() {\r\n        if (!this.signLanguageDragOptionButton) {\r\n            return;\r\n        }\r\n        \r\n        const isEnabled = !!(this.signLanguageDraggable && this.signLanguageDraggable.keyboardDragMode);\r\n        const text = isEnabled\r\n            ? i18n.t('player.disableSignDragMode')\r\n            : i18n.t('player.enableSignDragMode');\r\n        const ariaLabel = isEnabled\r\n            ? i18n.t('player.disableSignDragModeAria')\r\n            : i18n.t('player.enableSignDragModeAria');\r\n\r\n        this.signLanguageDragOptionButton.setAttribute('aria-checked', isEnabled ? 'true' : 'false');\r\n        this.signLanguageDragOptionButton.setAttribute('aria-label', ariaLabel);\r\n\r\n        if (this.signLanguageDragOptionText) {\r\n            this.signLanguageDragOptionText.textContent = text;\r\n        }\r\n    }\r\n\r\n    updateSignLanguageResizeOptionState() {\r\n        if (!this.signLanguageResizeOptionButton) {\r\n            return;\r\n        }\r\n        \r\n        const isEnabled = !!(this.signLanguageDraggable && this.signLanguageDraggable.pointerResizeMode);\r\n        const text = isEnabled\r\n            ? i18n.t('player.disableSignResizeMode')\r\n            : i18n.t('player.enableSignResizeMode');\r\n        const ariaLabel = isEnabled\r\n            ? i18n.t('player.disableSignResizeModeAria')\r\n            : i18n.t('player.enableSignResizeModeAria');\r\n\r\n        this.signLanguageResizeOptionButton.setAttribute('aria-checked', isEnabled ? 'true' : 'false');\r\n        this.signLanguageResizeOptionButton.setAttribute('aria-label', ariaLabel);\r\n\r\n        if (this.signLanguageResizeOptionText) {\r\n            this.signLanguageResizeOptionText.textContent = text;\r\n        }\r\n    }\r\n\r\n    constrainSignLanguagePosition() {\r\n        return this.signLanguageManager.constrainPosition();\r\n    }\r\n\r\n    saveSignLanguagePreferences() {\r\n        return this.signLanguageManager.savePreferences();\r\n    }\r\n\r\n    // Legacy methods preserved for reference - can be removed after testing\r\n    _legacyConstrainSignLanguagePosition() {\r\n        if (!this.signLanguageWrapper || !this.videoWrapper) return;\r\n        \r\n        // Don't auto-position if user has manually positioned it\r\n        if (this.signLanguageDraggable && this.signLanguageDraggable.manuallyPositioned) {\r\n            return;\r\n        }\r\n        \r\n        // Ensure width is set\r\n        if (!this.signLanguageWrapper.style.width || this.signLanguageWrapper.style.width === '') {\r\n            this.signLanguageWrapper.style.width = '280px'; // Default width\r\n        }\r\n        \r\n        // Get videoWrapper position relative to the player CONTAINER (where sign language video is attached)\r\n        const videoWrapperRect = this.videoWrapper.getBoundingClientRect();\r\n        const containerRect = this.container.getBoundingClientRect();\r\n        const wrapperRect = this.signLanguageWrapper.getBoundingClientRect();\r\n        \r\n        // Calculate videoWrapper's position and dimensions relative to container\r\n        const videoWrapperLeft = videoWrapperRect.left - containerRect.left;\r\n        const videoWrapperTop = videoWrapperRect.top - containerRect.top;\r\n        const videoWrapperWidth = videoWrapperRect.width;\r\n        const videoWrapperHeight = videoWrapperRect.height;\r\n        \r\n        // Use estimated height if video hasn't loaded yet (16:9 aspect ratio)\r\n        let wrapperWidth = wrapperRect.width || 280;\r\n        let wrapperHeight = wrapperRect.height || ((280 * 9) / 16); // Estimate based on 16:9 aspect ratio\r\n        \r\n        let left, top;\r\n        const margin = 16; // Margin from edges\r\n        const controlsHeight = 95; // Height of controls when visible\r\n        \r\n        // Always calculate fresh position based on desired location (relative to videoWrapper)\r\n        const position = this.signLanguageDesiredPosition || 'bottom-right';\r\n        \r\n        switch (position) {\r\n            case 'bottom-right':\r\n                left = videoWrapperLeft + videoWrapperWidth - wrapperWidth - margin;\r\n                top = videoWrapperTop + videoWrapperHeight - wrapperHeight - controlsHeight;\r\n                break;\r\n            case 'bottom-left':\r\n                left = videoWrapperLeft + margin;\r\n                top = videoWrapperTop + videoWrapperHeight - wrapperHeight - controlsHeight;\r\n                break;\r\n            case 'top-right':\r\n                left = videoWrapperLeft + videoWrapperWidth - wrapperWidth - margin;\r\n                top = videoWrapperTop + margin;\r\n                break;\r\n            case 'top-left':\r\n                left = videoWrapperLeft + margin;\r\n                top = videoWrapperTop + margin;\r\n                break;\r\n            default:\r\n                left = videoWrapperLeft + videoWrapperWidth - wrapperWidth - margin;\r\n                top = videoWrapperTop + videoWrapperHeight - wrapperHeight - controlsHeight;\r\n        }\r\n        \r\n        // Constrain to videoWrapper bounds (ensuring it stays above controls)\r\n        left = Math.max(videoWrapperLeft, Math.min(left, videoWrapperLeft + videoWrapperWidth - wrapperWidth));\r\n        top = Math.max(videoWrapperTop, Math.min(top, videoWrapperTop + videoWrapperHeight - wrapperHeight - controlsHeight));\r\n        \r\n        // Apply constrained position\r\n        this.signLanguageWrapper.style.left = `${left}px`;\r\n        this.signLanguageWrapper.style.top = `${top}px`;\r\n        this.signLanguageWrapper.style.right = 'auto';\r\n        this.signLanguageWrapper.style.bottom = 'auto';\r\n        // Remove position classes if any were applied\r\n        this.signLanguageWrapper.classList.remove(...Array.from(this.signLanguageWrapper.classList).filter(c => c.startsWith('vidply-sign-position-')));\r\n    }\r\n\r\n    _legacySaveSignLanguagePreferences() {\r\n        if (!this.signLanguageWrapper) return;\r\n        \r\n        // Only save width - position is always calculated fresh to bottom-right\r\n        this.storage.saveSignLanguagePreferences({\r\n            size: {\r\n                width: this.signLanguageWrapper.style.width\r\n                // Height is auto - maintained by aspect ratio\r\n            }\r\n        });\r\n    }\r\n\r\n    cleanupSignLanguage() {\r\n        return this.signLanguageManager.cleanup();\r\n    }\r\n\r\n    // Settings\r\n    // Settings dialog removed - using individual control buttons instead\r\n    showSettings() {\r\n        console.warn('[VidPly] Settings dialog has been removed. Use individual control buttons (speed, captions, etc.)');\r\n    }\r\n\r\n    hideSettings() {\r\n        // No-op - settings dialog removed\r\n    }\r\n\r\n    // Utility methods\r\n    getCurrentTime() {\r\n        return this.state.currentTime;\r\n    }\r\n\r\n    getDuration() {\r\n        return this.state.duration;\r\n    }\r\n\r\n    isPlaying() {\r\n        return this.state.playing;\r\n    }\r\n\r\n    isPaused() {\r\n        return this.state.paused;\r\n    }\r\n\r\n    isEnded() {\r\n        return this.state.ended;\r\n    }\r\n\r\n    isMuted() {\r\n        return this.state.muted;\r\n    }\r\n\r\n    isFullscreen() {\r\n        return this.state.fullscreen;\r\n    }\r\n\r\n    // Error handling\r\n    handleError(error) {\r\n        // Suppress errors during renderer switching\r\n        // This prevents cascade of errors when HTML5 element is cleared for external renderers\r\n        if (this._switchingRenderer) {\r\n            this.log('Suppressing error during renderer switch:', error, 'debug');\r\n            return;\r\n        }\r\n        \r\n        this.log('Error:', error, 'error');\r\n        this.emit('error', error);\r\n\r\n        if (this.options.onError) {\r\n            this.options.onError.call(this, error);\r\n        }\r\n    }\r\n\r\n    // Logging\r\n    log(...messages) {\r\n        if (!this.options.debug) {\r\n            return;\r\n        }\r\n\r\n        let type = 'log';\r\n        if (messages.length > 0) {\r\n            const potentialType = messages[messages.length - 1];\r\n            if (typeof potentialType === 'string' && console[potentialType]) {\r\n                type = potentialType;\r\n                messages = messages.slice(0, -1);\r\n            }\r\n        }\r\n\r\n        if (messages.length === 0) {\r\n            messages = [''];\r\n        }\r\n\r\n        if (typeof console[type] === 'function') {\r\n            console[type]('[VidPly]', ...messages);\r\n        } else {\r\n            console.log('[VidPly]', ...messages);\r\n        }\r\n    }\r\n\r\n    // Setup responsive handlers\r\n    setupResponsiveHandlers() {\r\n        // Use ResizeObserver for efficient resize tracking\r\n        if (typeof ResizeObserver !== 'undefined') {\r\n            this.resizeObserver = new ResizeObserver((entries) => {\r\n                for (const entry of entries) {\r\n                    const width = entry.contentRect.width;\r\n\r\n                    // Update control bar for viewport\r\n                    if (this.controlBar && typeof this.controlBar.updateControlsForViewport === 'function') {\r\n                        this.controlBar.updateControlsForViewport(width);\r\n                    }\r\n\r\n                    // Update transcript positioning\r\n                    if (this.transcriptManager && this.transcriptManager.isVisible) {\r\n                        this.transcriptManager.positionTranscript();\r\n                    }\r\n                }\r\n            });\r\n\r\n            this.resizeObserver.observe(this.container);\r\n        } else {\r\n            // Fallback to window resize event\r\n            this.resizeHandler = () => {\r\n                const width = this.container.clientWidth;\r\n\r\n                if (this.controlBar && typeof this.controlBar.updateControlsForViewport === 'function') {\r\n                    this.controlBar.updateControlsForViewport(width);\r\n                }\r\n\r\n                if (this.transcriptManager && this.transcriptManager.isVisible) {\r\n                    // Only auto-position if user hasn't manually moved it\r\n                    if (!this.transcriptManager.draggableResizable || !this.transcriptManager.draggableResizable.manuallyPositioned) {\r\n                        this.transcriptManager.positionTranscript();\r\n                    }\r\n                }\r\n            };\r\n\r\n            window.addEventListener('resize', this.resizeHandler);\r\n        }\r\n\r\n        // Also listen for orientation changes on mobile\r\n        if (window.matchMedia) {\r\n            this.orientationHandler = (e) => {\r\n                // Wait for layout to settle\r\n                setTimeout(() => {\r\n                    if (this.transcriptManager && this.transcriptManager.isVisible) {\r\n                        // Only auto-position if user hasn't manually moved it\r\n                        if (!this.transcriptManager.draggableResizable || !this.transcriptManager.draggableResizable.manuallyPositioned) {\r\n                            this.transcriptManager.positionTranscript();\r\n                        }\r\n                    }\r\n                }, 100);\r\n            };\r\n\r\n            const orientationQuery = window.matchMedia('(orientation: portrait)');\r\n            if (orientationQuery.addEventListener) {\r\n                orientationQuery.addEventListener('change', this.orientationHandler);\r\n            } else if (orientationQuery.addListener) {\r\n                // Fallback for older browsers\r\n                orientationQuery.addListener(this.orientationHandler);\r\n            }\r\n\r\n            this.orientationQuery = orientationQuery;\r\n        }\r\n\r\n        // Listen for native fullscreen change events (e.g., when user presses ESC)\r\n        this.fullscreenChangeHandler = () => {\r\n            const isFullscreen = !!(\r\n                document.fullscreenElement ||\r\n                document.webkitFullscreenElement ||\r\n                document.mozFullScreenElement ||\r\n                document.msFullscreenElement\r\n            );\r\n\r\n            // Only update if state has changed\r\n            if (this.state.fullscreen !== isFullscreen) {\r\n                this.state.fullscreen = isFullscreen;\r\n                \r\n                if (isFullscreen) {\r\n                    this.container.classList.add(`${this.options.classPrefix}-fullscreen`);\r\n                    // Add body class for CSS targeting (fallback for browsers without :has() support)\r\n                    document.body.classList.add('vidply-fullscreen-active');\r\n                    // Make background content inert to prevent keyboard focus escaping\r\n                    this._makeBackgroundInert();\r\n                } else {\r\n                    this.container.classList.remove(`${this.options.classPrefix}-fullscreen`);\r\n                    // Remove body class for CSS targeting\r\n                    document.body.classList.remove('vidply-fullscreen-active');\r\n                    // Restore background interactivity\r\n                    this._restoreBackgroundInteractivity();\r\n                    // Clean up pseudo-fullscreen state when exiting\r\n                    this._disablePseudoFullscreen();\r\n                }\r\n                \r\n                this.emit('fullscreenchange', isFullscreen);\r\n                \r\n                // Update fullscreen button icon\r\n                if (this.controlBar) {\r\n                    this.controlBar.updateFullscreenButton();\r\n                }\r\n                \r\n                // Reposition sign language video after fullscreen transition\r\n                if (this.signLanguageWrapper && this.signLanguageWrapper.style.display !== 'none') {\r\n                    // Re-setup drag/drop when entering/exiting fullscreen on mobile devices\r\n                    // This enables drag/resize when entering fullscreen on mobile\r\n                    const isMobile = window.innerWidth < 768;\r\n                    if (isMobile) {\r\n                        this.setupSignLanguageInteraction();\r\n                    }\r\n                    \r\n                    // Use setTimeout to ensure layout has updated after fullscreen transition\r\n                    // Longer delay to account for CSS transition animations and layout recalculation\r\n                    this.setManagedTimeout(() => {\r\n                        // Use requestAnimationFrame to ensure the browser has fully rendered the layout\r\n                        requestAnimationFrame(() => {\r\n                            // Clear saved size and reset to default for the new container size\r\n                            this.storage.saveSignLanguagePreferences({ size: null });\r\n                            this.signLanguageDesiredPosition = 'bottom-right';\r\n                            // Reset to default width for the new container\r\n                            this.signLanguageWrapper.style.width = isFullscreen ? '400px' : '280px';\r\n                            this.constrainSignLanguagePosition();\r\n                        });\r\n                    }, 500);\r\n                }\r\n            }\r\n        };\r\n\r\n        // Add listeners for all vendor-prefixed fullscreenchange events\r\n        document.addEventListener('fullscreenchange', this.fullscreenChangeHandler);\r\n        document.addEventListener('webkitfullscreenchange', this.fullscreenChangeHandler);\r\n        document.addEventListener('mozfullscreenchange', this.fullscreenChangeHandler);\r\n        document.addEventListener('MSFullscreenChange', this.fullscreenChangeHandler);\r\n    }\r\n\r\n    // Cleanup\r\n    destroy() {\r\n        this.log('Destroying player');\r\n\r\n        if (this.renderer) {\r\n            this.renderer.destroy();\r\n        }\r\n\r\n        if (this.controlBar) {\r\n            this.controlBar.destroy();\r\n        }\r\n\r\n        if (this.captionManager) {\r\n            this.captionManager.destroy();\r\n        }\r\n\r\n        if (this.keyboardManager) {\r\n            this.keyboardManager.destroy();\r\n        }\r\n\r\n        if (this.transcriptManager) {\r\n            this.transcriptManager.destroy();\r\n        }\r\n\r\n        // Cleanup sign language video and listeners\r\n        this.cleanupSignLanguage();\r\n\r\n        // Cleanup play overlay button\r\n        if (this.playButtonOverlay && this.playButtonOverlay.parentNode) {\r\n            this.playButtonOverlay.remove();\r\n            this.playButtonOverlay = null;\r\n        }\r\n\r\n        // Cleanup resize observer\r\n        if (this.resizeObserver) {\r\n            this.resizeObserver.disconnect();\r\n            this.resizeObserver = null;\r\n        }\r\n\r\n        // Cleanup window resize handler\r\n        if (this.resizeHandler) {\r\n            window.removeEventListener('resize', this.resizeHandler);\r\n            this.resizeHandler = null;\r\n        }\r\n\r\n        // Cleanup orientation change handler\r\n        if (this.orientationQuery && this.orientationHandler) {\r\n            if (this.orientationQuery.removeEventListener) {\r\n                this.orientationQuery.removeEventListener('change', this.orientationHandler);\r\n            } else if (this.orientationQuery.removeListener) {\r\n                this.orientationQuery.removeListener(this.orientationHandler);\r\n            }\r\n            this.orientationQuery = null;\r\n            this.orientationHandler = null;\r\n        }\r\n\r\n        // Cleanup fullscreen change handler\r\n        if (this.fullscreenChangeHandler) {\r\n            document.removeEventListener('fullscreenchange', this.fullscreenChangeHandler);\r\n            document.removeEventListener('webkitfullscreenchange', this.fullscreenChangeHandler);\r\n            document.removeEventListener('mozfullscreenchange', this.fullscreenChangeHandler);\r\n            document.removeEventListener('MSFullscreenChange', this.fullscreenChangeHandler);\r\n            this.fullscreenChangeHandler = null;\r\n        }\r\n\r\n        // Cleanup all managed timeouts\r\n        this.timeouts.forEach(timeoutId => clearTimeout(timeoutId));\r\n        this.timeouts.clear();\r\n\r\n        // Cleanup metadata handling\r\n        if (this.metadataCueChangeHandler) {\r\n            const textTracks = this.textTracks;\r\n            const metadataTrack = textTracks.find(track => track.kind === 'metadata');\r\n            if (metadataTrack) {\r\n                metadataTrack.removeEventListener('cuechange', this.metadataCueChangeHandler);\r\n            }\r\n            this.metadataCueChangeHandler = null;\r\n        }\r\n\r\n        if (this.metadataAlertHandlers && this.metadataAlertHandlers.size > 0) {\r\n            this.metadataAlertHandlers.forEach(({ button, handler }) => {\r\n                if (button && handler) {\r\n                    button.removeEventListener('click', handler);\r\n                }\r\n            });\r\n            this.metadataAlertHandlers.clear();\r\n        }\r\n\r\n        // Remove container\r\n        if (this.container && this.container.parentNode) {\r\n            this.container.parentNode.insertBefore(this.element, this.container);\r\n            this.container.parentNode.removeChild(this.container);\r\n        }\r\n\r\n        this.removeAllListeners();\r\n    }\r\n\r\n    /**\r\n     * Setup metadata track handling\r\n     * This enables metadata tracks and listens for cue changes to trigger actions\r\n     */\r\n    setupMetadataHandling() {\r\n        const setupMetadata = () => {\r\n            const textTracks = this.textTracks;\r\n            const metadataTrack = textTracks.find(track => track.kind === 'metadata');\r\n            \r\n            if (metadataTrack) {\r\n                // Enable the metadata track so cuechange events fire\r\n                // Use 'hidden' mode so it doesn't display anything, but events still work\r\n                if (metadataTrack.mode === 'disabled') {\r\n                    metadataTrack.mode = 'hidden';\r\n                }\r\n                \r\n                // Remove existing listener if any\r\n                if (this.metadataCueChangeHandler) {\r\n                    metadataTrack.removeEventListener('cuechange', this.metadataCueChangeHandler);\r\n                }\r\n                \r\n                // Add event listener for cue changes\r\n                this.metadataCueChangeHandler = () => {\r\n                    const activeCues = Array.from(metadataTrack.activeCues || []);\r\n                    if (activeCues.length > 0) {\r\n                        // Debug logging\r\n                        if (this.options.debug) {\r\n                            this.log('[Metadata] Active cues:', activeCues.map(c => ({\r\n                                start: c.startTime,\r\n                                end: c.endTime,\r\n                                text: c.text\r\n                            })));\r\n                        }\r\n                    }\r\n                    activeCues.forEach(cue => {\r\n                        this.handleMetadataCue(cue);\r\n                    });\r\n                };\r\n                \r\n                metadataTrack.addEventListener('cuechange', this.metadataCueChangeHandler);\r\n                \r\n                // Debug: Log metadata track setup\r\n                if (this.options.debug) {\r\n                    const cueCount = metadataTrack.cues ? metadataTrack.cues.length : 0;\r\n                    this.log('[Metadata] Track enabled,', cueCount, 'cues available');\r\n                }\r\n            } else if (this.options.debug) {\r\n                this.log('[Metadata] No metadata track found');\r\n            }\r\n        };\r\n        \r\n        // Try immediately\r\n        setupMetadata();\r\n        \r\n        // Also try after loadedmetadata event (tracks might not be ready yet)\r\n        this.on('loadedmetadata', setupMetadata);\r\n    }\r\n\r\n    normalizeMetadataSelector(selector) {\r\n        if (!selector) {\r\n            return null;\r\n        }\r\n        const trimmed = selector.trim();\r\n        if (!trimmed) {\r\n            return null;\r\n        }\r\n        if (trimmed.startsWith('#') || trimmed.startsWith('.') || trimmed.startsWith('[')) {\r\n            return trimmed;\r\n        }\r\n        return `#${trimmed}`;\r\n    }\r\n\r\n    resolveMetadataConfig(map, key) {\r\n        if (!map || !key) {\r\n            return null;\r\n        }\r\n        if (Object.prototype.hasOwnProperty.call(map, key)) {\r\n            return map[key];\r\n        }\r\n        const withoutHash = key.replace(/^#/, '');\r\n        if (Object.prototype.hasOwnProperty.call(map, withoutHash)) {\r\n            return map[withoutHash];\r\n        }\r\n        return null;\r\n    }\r\n\r\n    cacheMetadataAlertContent(element, config = {}) {\r\n        if (!element) {\r\n            return;\r\n        }\r\n        const titleSelector = config.titleSelector || '[data-vidply-alert-title], h3, header';\r\n        const messageSelector = config.messageSelector || '[data-vidply-alert-message], p';\r\n\r\n        const titleEl = element.querySelector(titleSelector);\r\n        if (titleEl && !titleEl.dataset.vidplyAlertTitleOriginal) {\r\n            titleEl.dataset.vidplyAlertTitleOriginal = titleEl.textContent.trim();\r\n        }\r\n\r\n        const messageEl = element.querySelector(messageSelector);\r\n        if (messageEl && !messageEl.dataset.vidplyAlertMessageOriginal) {\r\n            messageEl.dataset.vidplyAlertMessageOriginal = messageEl.textContent.trim();\r\n        }\r\n    }\r\n\r\n    restoreMetadataAlertContent(element, config = {}) {\r\n        if (!element) {\r\n            return;\r\n        }\r\n        const titleSelector = config.titleSelector || '[data-vidply-alert-title], h3, header';\r\n        const messageSelector = config.messageSelector || '[data-vidply-alert-message], p';\r\n\r\n        const titleEl = element.querySelector(titleSelector);\r\n        if (titleEl && titleEl.dataset.vidplyAlertTitleOriginal) {\r\n            titleEl.textContent = titleEl.dataset.vidplyAlertTitleOriginal;\r\n        }\r\n\r\n        const messageEl = element.querySelector(messageSelector);\r\n        if (messageEl && messageEl.dataset.vidplyAlertMessageOriginal) {\r\n            messageEl.textContent = messageEl.dataset.vidplyAlertMessageOriginal;\r\n        }\r\n    }\r\n\r\n    focusMetadataTarget(target, fallbackElement = null) {\r\n        if (!target || target === 'none') {\r\n            return;\r\n        }\r\n\r\n        if (target === 'alert' && fallbackElement) {\r\n            fallbackElement.focus({ preventScroll: true });\r\n            return;\r\n        }\r\n\r\n        if (target === 'player') {\r\n            if (this.container) {\r\n                this.container.focus({ preventScroll: true });\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (target === 'media') {\r\n            this.element.focus({ preventScroll: true });\r\n            return;\r\n        }\r\n\r\n        if (target === 'playButton') {\r\n            const playButton = this.controlBar?.controls?.playPause;\r\n            if (playButton) {\r\n                playButton.focus({ preventScroll: true });\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (typeof target === 'string') {\r\n            const targetElement = document.querySelector(target);\r\n            if (targetElement) {\r\n                if (targetElement.tabIndex === -1 && !targetElement.hasAttribute('tabindex')) {\r\n                    targetElement.setAttribute('tabindex', '-1');\r\n                }\r\n                targetElement.focus({ preventScroll: true });\r\n            }\r\n        }\r\n    }\r\n\r\n    handleMetadataAlert(selector, options = {}) {\r\n        if (!selector) {\r\n            return;\r\n        }\r\n\r\n        const config = this.resolveMetadataConfig(this.options.metadataAlerts, selector) || {};\r\n        const element = options.element || document.querySelector(selector);\r\n\r\n        if (!element) {\r\n            if (this.options.debug) {\r\n                this.log('[Metadata] Alert element not found:', selector);\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (this.options.debug) {\r\n            this.log('[Metadata] Handling alert', selector, { reason: options.reason, config });\r\n        }\r\n\r\n        this.cacheMetadataAlertContent(element, config);\r\n\r\n        if (!element.dataset.vidplyAlertOriginalDisplay) {\r\n            element.dataset.vidplyAlertOriginalDisplay = element.style.display || '';\r\n        }\r\n\r\n        if (!element.dataset.vidplyAlertDisplay) {\r\n            element.dataset.vidplyAlertDisplay = config.display || 'block';\r\n        }\r\n\r\n        const shouldShow = options.show !== undefined ? options.show : (config.show !== false);\r\n        if (shouldShow) {\r\n            const displayValue = config.display || element.dataset.vidplyAlertDisplay || 'block';\r\n            element.style.display = displayValue;\r\n            element.hidden = false;\r\n            element.removeAttribute('hidden');\r\n            element.setAttribute('aria-hidden', 'false');\r\n            element.setAttribute('data-vidply-alert-active', 'true');\r\n        }\r\n\r\n        const shouldReset = config.resetContent !== false && options.reason === 'focus';\r\n        if (shouldReset) {\r\n            this.restoreMetadataAlertContent(element, config);\r\n        }\r\n\r\n        const shouldFocus = options.focus !== undefined\r\n            ? options.focus\r\n            : (config.focusOnShow ?? (options.reason !== 'focus'));\r\n\r\n        if (shouldShow && shouldFocus) {\r\n            if (element.tabIndex === -1 && !element.hasAttribute('tabindex')) {\r\n                element.setAttribute('tabindex', '-1');\r\n            }\r\n            element.focus({ preventScroll: true });\r\n        }\r\n\r\n        if (shouldShow && config.autoScroll !== false && options.autoScroll !== false) {\r\n            element.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\r\n        }\r\n\r\n        const continueSelector = config.continueButton;\r\n        if (continueSelector) {\r\n            let continueButton = null;\r\n            if (continueSelector === 'self') {\r\n                continueButton = element;\r\n            } else if (element.matches(continueSelector)) {\r\n                continueButton = element;\r\n            } else {\r\n                continueButton = element.querySelector(continueSelector) || document.querySelector(continueSelector);\r\n            }\r\n\r\n            if (continueButton && !this.metadataAlertHandlers.has(selector)) {\r\n                const handler = () => {\r\n                    const hideOnContinue = config.hideOnContinue !== false;\r\n                    if (hideOnContinue) {\r\n                        const originalDisplay = element.dataset.vidplyAlertOriginalDisplay || '';\r\n                        element.style.display = config.hideDisplay || originalDisplay || 'none';\r\n                        element.setAttribute('aria-hidden', 'true');\r\n                        element.removeAttribute('data-vidply-alert-active');\r\n                    }\r\n\r\n                    if (config.resume !== false && this.state.paused) {\r\n                        this.play();\r\n                    }\r\n\r\n                    const focusTarget = config.focusTarget || 'playButton';\r\n                    this.setManagedTimeout(() => {\r\n                        this.focusMetadataTarget(focusTarget, element);\r\n                    }, config.focusDelay ?? 100);\r\n                };\r\n\r\n                continueButton.addEventListener('click', handler);\r\n                this.metadataAlertHandlers.set(selector, { button: continueButton, handler });\r\n            }\r\n        }\r\n\r\n        return element;\r\n    }\r\n\r\n    handleMetadataHashtags(hashtags) {\r\n        if (!Array.isArray(hashtags) || hashtags.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const configMap = this.options.metadataHashtags;\r\n        if (!configMap) {\r\n            return;\r\n        }\r\n\r\n        hashtags.forEach(tag => {\r\n            const config = this.resolveMetadataConfig(configMap, tag);\r\n            if (!config) {\r\n                return;\r\n            }\r\n\r\n            const selector = this.normalizeMetadataSelector(config.alert || config.selector || config.target);\r\n            if (!selector) {\r\n                return;\r\n            }\r\n\r\n            const element = document.querySelector(selector);\r\n            if (!element) {\r\n                if (this.options.debug) {\r\n                    this.log('[Metadata] Hashtag target not found:', selector);\r\n                }\r\n                return;\r\n            }\r\n\r\n        if (this.options.debug) {\r\n            this.log('[Metadata] Handling hashtag', tag, { selector, config });\r\n        }\r\n\r\n            this.cacheMetadataAlertContent(element, config);\r\n\r\n            if (config.title) {\r\n                const titleSelector = config.titleSelector || '[data-vidply-alert-title], h3, header';\r\n                const titleEl = element.querySelector(titleSelector);\r\n                if (titleEl) {\r\n                    titleEl.textContent = config.title;\r\n                }\r\n            }\r\n\r\n            if (config.message) {\r\n                const messageSelector = config.messageSelector || '[data-vidply-alert-message], p';\r\n                const messageEl = element.querySelector(messageSelector);\r\n                if (messageEl) {\r\n                    messageEl.textContent = config.message;\r\n                }\r\n            }\r\n\r\n            const show = config.show !== false;\r\n            const focus = config.focus !== undefined ? config.focus : false;\r\n\r\n            this.handleMetadataAlert(selector, {\r\n                element,\r\n                show,\r\n                focus,\r\n                autoScroll: config.autoScroll,\r\n                reason: 'hashtag'\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Handle individual metadata cues\r\n     * Parses metadata text and emits events or triggers actions\r\n     */\r\n    handleMetadataCue(cue) {\r\n        const text = cue.text.trim();\r\n        \r\n        // Debug logging\r\n        if (this.options.debug) {\r\n            this.log('[Metadata] Processing cue:', {\r\n                time: cue.startTime,\r\n                text: text\r\n            });\r\n        }\r\n        \r\n        // Emit a generic metadata event that developers can listen to\r\n        this.emit('metadata', {\r\n            time: cue.startTime,\r\n            endTime: cue.endTime,\r\n            text: text,\r\n            cue: cue\r\n        });\r\n\r\n        // Parse for specific commands (examples based on wwa_meta.vtt format)\r\n        if (text.includes('PAUSE')) {\r\n            // Automatically pause the video\r\n            if (!this.state.paused) {\r\n                if (this.options.debug) {\r\n                    this.log('[Metadata] Pausing video at', cue.startTime);\r\n                }\r\n                this.pause();\r\n            }\r\n            // Also emit event for developers who want to listen\r\n            this.emit('metadata:pause', { time: cue.startTime, text: text });\r\n        }\r\n\r\n        // Parse for focus directives\r\n        const focusMatch = text.match(/FOCUS:([\\w#-]+)/);\r\n        if (focusMatch) {\r\n            const targetSelector = focusMatch[1];\r\n            const normalizedSelector = this.normalizeMetadataSelector(targetSelector);\r\n            // Automatically focus the target element\r\n            const targetElement = normalizedSelector ? document.querySelector(normalizedSelector) : null;\r\n            if (targetElement) {\r\n                if (this.options.debug) {\r\n                    this.log('[Metadata] Focusing element:', normalizedSelector);\r\n                }\r\n                // Make element focusable if it isn't already\r\n                if (targetElement.tabIndex === -1 && !targetElement.hasAttribute('tabindex')) {\r\n                    targetElement.setAttribute('tabindex', '-1');\r\n                }\r\n                // Use setTimeout to ensure DOM is ready\r\n                this.setManagedTimeout(() => {\r\n                    targetElement.focus({ preventScroll: true });\r\n                }, 10);\r\n            } else if (this.options.debug) {\r\n                this.log('[Metadata] Element not found:', normalizedSelector || targetSelector);\r\n            }\r\n            // Also emit event for developers who want to listen\r\n            this.emit('metadata:focus', { \r\n                time: cue.startTime, \r\n                target: targetSelector,\r\n                selector: normalizedSelector,\r\n                element: targetElement,\r\n                text: text \r\n            });\r\n\r\n            if (normalizedSelector) {\r\n                this.handleMetadataAlert(normalizedSelector, {\r\n                    element: targetElement,\r\n                    reason: 'focus'\r\n                });\r\n            }\r\n        }\r\n\r\n        // Parse for hashtag references\r\n        const hashtags = text.match(/#[\\w-]+/g);\r\n        if (hashtags) {\r\n            if (this.options.debug) {\r\n                this.log('[Metadata] Hashtags found:', hashtags);\r\n            }\r\n            this.emit('metadata:hashtags', {\r\n                time: cue.startTime,\r\n                hashtags: hashtags,\r\n                text: text\r\n            });\r\n\r\n            this.handleMetadataHashtags(hashtags);\r\n        }\r\n    }\r\n}\r\n\r\n// Static instances tracker for pause others functionality\r\nPlayer.instances = [];\r\n\r\n", "/**\r\n * VidPly Playlist Manager\r\n * Manages playlists for audio and video content\r\n */\r\n\r\nimport { DOMUtils } from '../utils/DOMUtils.js';\r\nimport { createIconElement } from '../icons/Icons.js';\r\nimport { i18n } from '../i18n/i18n.js';\r\nimport { TimeUtils } from '../utils/TimeUtils.js';\r\n\r\n// Static counter for unique IDs\r\nlet playlistInstanceCounter = 0;\r\n\r\nexport class PlaylistManager {\r\n  constructor(player, options = {}) {\r\n    this.player = player;\r\n    this.tracks = [];\r\n    this.initialTracks = Array.isArray(options.tracks) ? options.tracks : [];\r\n    this.currentIndex = -1;\r\n    \r\n    // Generate unique instance ID for this playlist\r\n    this.instanceId = ++playlistInstanceCounter;\r\n    this.uniqueId = `vidply-playlist-${this.instanceId}`;\r\n    \r\n    // Options\r\n    this.options = {\r\n      autoAdvance: options.autoAdvance !== false, // Default true\r\n      autoPlayFirst: options.autoPlayFirst !== false, // Default true - auto-play first track on load\r\n      loop: options.loop || false,\r\n      showPanel: options.showPanel !== false, // Default true\r\n      recreatePlayers: options.recreatePlayers || false, // New: recreate player for each track type\r\n      ...options\r\n    };\r\n    \r\n    // UI elements\r\n    this.container = null;\r\n    this.playlistPanel = null;\r\n    this.trackInfoElement = null;\r\n    this.navigationFeedback = null; // Live region for keyboard navigation feedback\r\n    this.isPanelVisible = this.options.showPanel !== false;\r\n    \r\n    // Track change guard to prevent cascade of next() calls\r\n    this.isChangingTrack = false;\r\n    \r\n    // Store the host element for player recreation\r\n    this.hostElement = options.hostElement || null;\r\n    this.PlayerClass = options.PlayerClass || null;\r\n    \r\n    // Bind methods\r\n    this.handleTrackEnd = this.handleTrackEnd.bind(this);\r\n    this.handleTrackError = this.handleTrackError.bind(this);\r\n    \r\n    // Register this playlist manager with the player\r\n    this.player.playlistManager = this;\r\n    \r\n    // Initialize\r\n    this.init();\r\n    \r\n    // Update controls to add playlist buttons\r\n    this.updatePlayerControls();\r\n    \r\n    // Load tracks if provided in options (after UI is ready)\r\n    if (this.initialTracks.length > 0) {\r\n      this.loadPlaylist(this.initialTracks);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Determine the media type for a track\r\n   * @param {Object} track - Track object\r\n   * @returns {string} - 'audio', 'video', 'youtube', 'vimeo', 'soundcloud', 'hls'\r\n   */\r\n  getTrackMediaType(track) {\r\n    const src = track.src || '';\r\n    \r\n    if (src.includes('youtube.com') || src.includes('youtu.be')) {\r\n      return 'youtube';\r\n    }\r\n    if (src.includes('vimeo.com')) {\r\n      return 'vimeo';\r\n    }\r\n    if (src.includes('soundcloud.com') || src.includes('api.soundcloud.com')) {\r\n      return 'soundcloud';\r\n    }\r\n    if (src.includes('.m3u8')) {\r\n      return 'hls';\r\n    }\r\n    if (track.type && track.type.startsWith('audio/')) {\r\n      return 'audio';\r\n    }\r\n    // Default to video for video types or unknown\r\n    return 'video';\r\n  }\r\n  \r\n  /**\r\n   * Recreate the player with the appropriate element type for the track\r\n   * @param {Object} track - Track to load\r\n   * @param {boolean} autoPlay - Whether to auto-play after creation\r\n   */\r\n  async recreatePlayerForTrack(track, autoPlay = false) {\r\n    if (!this.hostElement || !this.PlayerClass) {\r\n      console.warn('VidPly Playlist: Cannot recreate player - missing hostElement or PlayerClass');\r\n      return false;\r\n    }\r\n    \r\n    const mediaType = this.getTrackMediaType(track);\r\n    // SoundCloud uses an iframe widget, so it doesn't need an audio element\r\n    // Only local audio files need an actual <audio> element\r\n    const elementType = (mediaType === 'audio') ? 'audio' : 'video';\r\n    \r\n    // Store playlist panel state\r\n    const wasVisible = this.isPanelVisible;\r\n    const savedTracks = [...this.tracks]; // Keep track data\r\n    const savedIndex = this.currentIndex;\r\n    \r\n    // Detach all playlist UI elements from DOM (keep references)\r\n    // These will be reattached to the new player container\r\n    if (this.trackArtworkElement && this.trackArtworkElement.parentNode) {\r\n      this.trackArtworkElement.parentNode.removeChild(this.trackArtworkElement);\r\n    }\r\n    if (this.trackInfoElement && this.trackInfoElement.parentNode) {\r\n      this.trackInfoElement.parentNode.removeChild(this.trackInfoElement);\r\n    }\r\n    if (this.navigationFeedback && this.navigationFeedback.parentNode) {\r\n      this.navigationFeedback.parentNode.removeChild(this.navigationFeedback);\r\n    }\r\n    if (this.playlistPanel && this.playlistPanel.parentNode) {\r\n      this.playlistPanel.parentNode.removeChild(this.playlistPanel);\r\n    }\r\n    \r\n    // Preserve existing player options so recreated players behave consistently\r\n    const preservedPlayerOptions = this.player?.options ? { ...this.player.options } : {};\r\n\r\n    // Remove event listeners before destroying\r\n    if (this.player) {\r\n      this.player.off('ended', this.handleTrackEnd);\r\n      this.player.off('error', this.handleTrackError);\r\n      this.player.destroy();\r\n    }\r\n    \r\n    // Clear the host element\r\n    this.hostElement.innerHTML = '';\r\n    \r\n    // Create new media element with appropriate type\r\n    const mediaElement = document.createElement(elementType);\r\n    // Respect configured preload (playlists should behave like single videos even with deferLoad)\r\n    const preloadValue = preservedPlayerOptions.preload || 'metadata';\r\n    mediaElement.setAttribute('preload', preloadValue);\r\n    \r\n    // For video elements with local media, set poster\r\n    if (elementType === 'video' && track.poster && \r\n        (mediaType === 'video' || mediaType === 'hls')) {\r\n      mediaElement.setAttribute('poster', track.poster);\r\n    }\r\n    \r\n    // For external renderers (YouTube, Vimeo, SoundCloud, HLS), don't add source\r\n    // The renderer will handle the source directly\r\n    const isExternalRenderer = ['youtube', 'vimeo', 'soundcloud', 'hls'].includes(mediaType);\r\n    \r\n    if (!isExternalRenderer) {\r\n      // Add source for HTML5 media\r\n      const source = document.createElement('source');\r\n      source.src = track.src;\r\n      if (track.type) {\r\n        source.type = track.type;\r\n      }\r\n      mediaElement.appendChild(source);\r\n      \r\n      // Add tracks (captions, chapters, etc.)\r\n      if (track.tracks && track.tracks.length > 0) {\r\n        track.tracks.forEach(trackConfig => {\r\n          const trackEl = document.createElement('track');\r\n          trackEl.src = trackConfig.src;\r\n          trackEl.kind = trackConfig.kind || 'captions';\r\n          trackEl.srclang = trackConfig.srclang || 'en';\r\n          trackEl.label = trackConfig.label || trackConfig.srclang;\r\n          if (trackConfig.default) {\r\n            trackEl.default = true;\r\n          }\r\n          mediaElement.appendChild(trackEl);\r\n        });\r\n      }\r\n    }\r\n    \r\n    this.hostElement.appendChild(mediaElement);\r\n    \r\n    // Create new player with the media element\r\n    // Pass the source for external renderers via options\r\n    const playerOptions = {\r\n      mediaType: elementType,\r\n      poster: track.poster,\r\n      audioDescriptionSrc: track.audioDescriptionSrc || null,\r\n      audioDescriptionDuration: track.audioDescriptionDuration || null,\r\n      signLanguageSrc: track.signLanguageSrc || null\r\n    };\r\n    // Merge back preserved options (so deferLoad/preload/etc remain active)\r\n    Object.assign(playerOptions, preservedPlayerOptions);\r\n    \r\n    this.player = new this.PlayerClass(mediaElement, playerOptions);\r\n    \r\n    // Re-register playlist manager\r\n    this.player.playlistManager = this;\r\n    \r\n    // Wait for player to be ready\r\n    await new Promise(resolve => {\r\n      this.player.on('ready', resolve);\r\n    });\r\n    \r\n    // Re-attach event listeners\r\n    this.player.on('ended', this.handleTrackEnd);\r\n    this.player.on('error', this.handleTrackError);\r\n    \r\n    // Re-attach all playlist UI elements to the new player's container\r\n    if (this.player.container) {\r\n      // Track artwork goes before video wrapper\r\n      if (this.trackArtworkElement) {\r\n        const videoWrapper = this.player.container.querySelector('.vidply-video-wrapper');\r\n        if (videoWrapper) {\r\n          this.player.container.insertBefore(this.trackArtworkElement, videoWrapper);\r\n        } else {\r\n          this.player.container.appendChild(this.trackArtworkElement);\r\n        }\r\n      }\r\n      // Track info\r\n      if (this.trackInfoElement) {\r\n        this.player.container.appendChild(this.trackInfoElement);\r\n      }\r\n      // Navigation feedback (screen reader only)\r\n      if (this.navigationFeedback) {\r\n        this.player.container.appendChild(this.navigationFeedback);\r\n      }\r\n      // Playlist panel\r\n      if (this.playlistPanel) {\r\n        this.player.container.appendChild(this.playlistPanel);\r\n      }\r\n    }\r\n    \r\n    // Update container reference\r\n    this.container = this.player.container;\r\n    \r\n    // Update controls (adds playlist prev/next buttons)\r\n    this.updatePlayerControls();\r\n    \r\n    // Restore tracks data (we kept it during recreation)\r\n    this.tracks = savedTracks;\r\n    this.currentIndex = savedIndex;\r\n    \r\n    // Update playlist UI to reflect current state\r\n    this.updatePlaylistUI();\r\n    \r\n    // Restore playlist panel visibility\r\n    this.isPanelVisible = wasVisible;\r\n    if (this.playlistPanel) {\r\n      this.playlistPanel.style.display = wasVisible ? '' : 'none';\r\n    }\r\n    \r\n    // For external renderers, load the track via player.load()\r\n    // For HTML5, the source is already set on the element\r\n    if (isExternalRenderer) {\r\n      this.player.load({\r\n        src: track.src,\r\n        type: track.type,\r\n        poster: track.poster,\r\n        tracks: track.tracks || [],\r\n        audioDescriptionSrc: track.audioDescriptionSrc || null,\r\n        signLanguageSrc: track.signLanguageSrc || null\r\n      });\r\n    } else {\r\n      // For HTML5 media, also load to set up accessibility features\r\n      this.player.load({\r\n        src: track.src,\r\n        type: track.type,\r\n        poster: track.poster,\r\n        tracks: track.tracks || [],\r\n        audioDescriptionSrc: track.audioDescriptionSrc || null,\r\n        signLanguageSrc: track.signLanguageSrc || null\r\n      });\r\n    }\r\n    \r\n    // Auto-play if requested\r\n    if (autoPlay) {\r\n      setTimeout(() => {\r\n        this.player.play();\r\n      }, 100);\r\n    }\r\n    \r\n    return true;\r\n  }\r\n  \r\n  init() {\r\n    // Listen for track end\r\n    this.player.on('ended', this.handleTrackEnd);\r\n    this.player.on('error', this.handleTrackError);\r\n    \r\n    // Listen for playback state changes to show/hide playlist in fullscreen\r\n    this.player.on('play', this.handlePlaybackStateChange.bind(this));\r\n    this.player.on('pause', this.handlePlaybackStateChange.bind(this));\r\n    this.player.on('ended', this.handlePlaybackStateChange.bind(this));\r\n    // Use fullscreenchange event which is what the player actually emits\r\n    this.player.on('fullscreenchange', this.handleFullscreenChange.bind(this));\r\n    \r\n    // Listen for audio description state changes to update duration displays\r\n    this.player.on('audiodescriptionenabled', this.handleAudioDescriptionChange.bind(this));\r\n    this.player.on('audiodescriptiondisabled', this.handleAudioDescriptionChange.bind(this));\r\n    \r\n    // Create UI if needed\r\n    if (this.options.showPanel) {\r\n      this.createUI();\r\n    }\r\n    \r\n    // Check for data-playlist attribute on player container (only if tracks weren't provided in options)\r\n    if (this.tracks.length === 0 && this.initialTracks.length === 0) {\r\n      this.loadPlaylistFromAttribute();\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Load playlist from data-playlist attribute if present\r\n   */\r\n  loadPlaylistFromAttribute() {\r\n    // Check the original wrapper element for data-playlist\r\n    // Structure: #audio-player -> .vidply-player -> .vidply-video-wrapper -> <audio>\r\n    // So we need to go up 3 levels\r\n    if (!this.player.element || !this.player.element.parentElement) {\r\n      console.log('VidPly Playlist: No player element found');\r\n      return;\r\n    }\r\n    \r\n    const videoWrapper = this.player.element.parentElement; // .vidply-video-wrapper\r\n    const playerContainer = videoWrapper.parentElement; // .vidply-player\r\n    const originalElement = playerContainer ? playerContainer.parentElement : null; // #audio-player (original div)\r\n    \r\n    if (!originalElement) {\r\n      console.log('VidPly Playlist: No original element found');\r\n      return;\r\n    }\r\n    \r\n    // Load playlist options from data attributes\r\n    this.loadOptionsFromAttributes(originalElement);\r\n    \r\n    const playlistData = originalElement.getAttribute('data-playlist');\r\n    if (!playlistData) {\r\n      console.log('VidPly Playlist: No data-playlist attribute found');\r\n      return;\r\n    }\r\n    \r\n    console.log('VidPly Playlist: Found data-playlist attribute, parsing...');\r\n    try {\r\n      const tracks = JSON.parse(playlistData);\r\n      if (Array.isArray(tracks) && tracks.length > 0) {\r\n        console.log(`VidPly Playlist: Loaded ${tracks.length} tracks from data-playlist`);\r\n        this.loadPlaylist(tracks);\r\n      } else {\r\n        console.warn('VidPly Playlist: data-playlist is not a valid array or is empty');\r\n      }\r\n    } catch (error) {\r\n      console.error('VidPly Playlist: Failed to parse data-playlist attribute', error);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Load playlist options from data attributes\r\n   * @param {HTMLElement} element - Element to read attributes from\r\n   */\r\n  loadOptionsFromAttributes(element) {\r\n    // data-playlist-auto-advance\r\n    const autoAdvance = element.getAttribute('data-playlist-auto-advance');\r\n    if (autoAdvance !== null) {\r\n      this.options.autoAdvance = autoAdvance === 'true';\r\n    }\r\n    \r\n    // data-playlist-auto-play-first\r\n    const autoPlayFirst = element.getAttribute('data-playlist-auto-play-first');\r\n    if (autoPlayFirst !== null) {\r\n      this.options.autoPlayFirst = autoPlayFirst === 'true';\r\n    }\r\n    \r\n    // data-playlist-loop\r\n    const loop = element.getAttribute('data-playlist-loop');\r\n    if (loop !== null) {\r\n      this.options.loop = loop === 'true';\r\n    }\r\n    \r\n    // data-playlist-show-panel\r\n    const showPanel = element.getAttribute('data-playlist-show-panel');\r\n    if (showPanel !== null) {\r\n      this.options.showPanel = showPanel === 'true';\r\n    }\r\n    \r\n    console.log('VidPly Playlist: Options from attributes:', this.options);\r\n  }\r\n  \r\n  /**\r\n   * Update player controls to add playlist navigation buttons\r\n   */\r\n  updatePlayerControls() {\r\n    if (!this.player.controlBar) return;\r\n    \r\n    const controlBar = this.player.controlBar;\r\n    \r\n    // Clear existing controls content (except the element itself)\r\n    controlBar.element.innerHTML = '';\r\n    \r\n    // Recreate controls with playlist buttons now available\r\n    controlBar.createControls();\r\n    \r\n    // Reattach events for the new controls\r\n    controlBar.attachEvents();\r\n    controlBar.setupAutoHide();\r\n  }\r\n  \r\n  /**\r\n   * Load a playlist\r\n   * @param {Array} tracks - Array of track objects\r\n   */\r\n  loadPlaylist(tracks) {\r\n    this.tracks = tracks;\r\n    this.currentIndex = -1;\r\n    \r\n    // Add playlist class to container\r\n    if (this.container) {\r\n      this.container.classList.add('vidply-has-playlist');\r\n    }\r\n    \r\n    // Update UI\r\n    if (this.playlistPanel) {\r\n      this.renderPlaylist();\r\n    }\r\n    \r\n    // Auto-play first track (if enabled)\r\n    if (tracks.length > 0) {\r\n      if (this.options.autoPlayFirst) {\r\n        this.play(0);\r\n      } else {\r\n        // Behave like a single video: load the first track (metadata/manifest)\r\n        // but do not start playback.\r\n        void this.loadTrack(0).catch(() => {\r\n          // ignore\r\n        });\r\n      }\r\n    }\r\n    \r\n    // Update visibility based on current state\r\n    this.updatePlaylistVisibilityInFullscreen();\r\n  }\r\n  \r\n  /**\r\n   * Load a track without playing\r\n   * This is the playlist equivalent of a \"single video initialized but not started yet\":\r\n   * it updates UI selection and loads the media into the player so metadata/manifests\r\n   * and feature managers can be ready, but it does not start playback.\r\n   * @param {number} index - Track index\r\n   */\r\n  async loadTrack(index) {\r\n    if (index < 0 || index >= this.tracks.length) {\r\n      console.warn('VidPly Playlist: Invalid track index', index);\r\n      return;\r\n    }\r\n    \r\n    const track = this.tracks[index];\r\n    \r\n    // Always update UI immediately (poster, buttons, duration, etc.).\r\n    // Note: this is UI-only; actual media loading is performed by player.load() below.\r\n    this.selectTrack(index);\r\n    \r\n    // Set guard flag to prevent cascade of next() calls during track change\r\n    this.isChangingTrack = true;\r\n    \r\n    // Check if we should recreate the player for this track type\r\n    if (this.options.recreatePlayers && this.hostElement && this.PlayerClass) {\r\n      const currentMediaType = this.player ? \r\n        (this.player.element.tagName === 'AUDIO' ? 'audio' : 'video') : null;\r\n      const newMediaType = this.getTrackMediaType(track);\r\n      const newElementType = (newMediaType === 'audio' || newMediaType === 'soundcloud') ? 'audio' : 'video';\r\n      \r\n      // Recreate if element type is different\r\n      if (currentMediaType !== newElementType) {\r\n        await this.recreatePlayerForTrack(track, false);\r\n        // Re-apply selection to the newly created player (poster/tracks/buttons)\r\n        this.selectTrack(index);\r\n        \r\n        // Emit event\r\n        this.player.emit('playlisttrackchange', {\r\n          index: index,\r\n          item: track,\r\n          total: this.tracks.length\r\n        });\r\n        \r\n        // Clear guard flag\r\n        setTimeout(() => {\r\n          this.isChangingTrack = false;\r\n        }, 150);\r\n        return;\r\n      }\r\n    }\r\n    \r\n    // Load track into player (normal path)\r\n    const loadPromise = this.player.load({\r\n      src: track.src,\r\n      type: track.type,\r\n      poster: track.poster,\r\n      tracks: track.tracks || [],\r\n      audioDescriptionSrc: track.audioDescriptionSrc || null,\r\n      signLanguageSrc: track.signLanguageSrc || null,\r\n      signLanguageSources: track.signLanguageSources || {}\r\n    });\r\n\r\n    // For playlist UX parity with single videos: fetch metadata/manifest now,\r\n    // but do not start playback.\r\n    if (this.player?.options?.deferLoad && typeof this.player.ensureLoaded === 'function') {\r\n      Promise.resolve(loadPromise)\r\n        .then(() => this.player?.ensureLoaded?.())\r\n        .catch(() => {\r\n          // ignore\r\n        });\r\n    }\r\n    \r\n    // Emit event\r\n    this.player.emit('playlisttrackchange', {\r\n      index: index,\r\n      item: track,\r\n      total: this.tracks.length\r\n    });\r\n    \r\n    // Clear guard flag after a short delay to ensure track is loaded\r\n    setTimeout(() => {\r\n      this.isChangingTrack = false;\r\n    }, 150);\r\n  }\r\n\r\n  /**\r\n   * Select a track (UI/selection only; does NOT set the media src / does NOT initialize renderer)\r\n   *\r\n   * In \"B always\" playlist mode, you typically want `loadTrack()` on selection so the\r\n   * selected item behaves like a single video (metadata/manifest loaded, features ready)\r\n   * without auto-playing.\r\n   * @param {number} index - Track index\r\n   */\r\n  selectTrack(index) {\r\n    if (index < 0 || index >= this.tracks.length) {\r\n      console.warn('VidPly Playlist: Invalid track index', index);\r\n      return;\r\n    }\r\n\r\n    const track = this.tracks[index];\r\n    this.currentIndex = index;\r\n\r\n    // Apply per-track metadata without touching the media source.\r\n    // This ensures poster + feature buttons (chapters/captions/transcript/sign-language)\r\n    // can be updated instantly even before any media network activity happens.\r\n    try {\r\n      // Poster for video element\r\n      if (this.player?.element?.tagName === 'VIDEO') {\r\n        if (track.poster) {\r\n          const posterUrl = typeof this.player.resolvePosterPath === 'function'\r\n            ? this.player.resolvePosterPath(track.poster)\r\n            : track.poster;\r\n          this.player.element.poster = posterUrl;\r\n          this.player.applyPosterAspectRatio?.(posterUrl);\r\n        } else {\r\n          this.player.element.removeAttribute('poster');\r\n        }\r\n      }\r\n\r\n      // Update sign language / audio description sources (used for button visibility)\r\n      this.player.audioDescriptionSrc = track.audioDescriptionSrc || null;\r\n      this.player.signLanguageSrc = track.signLanguageSrc || null;\r\n      this.player.signLanguageSources = track.signLanguageSources || {};\r\n\r\n      // Fill duration early for UI (progress/time display) without loading media\r\n      if (track.duration && Number(track.duration) > 0) {\r\n        this.player.state.duration = Number(track.duration);\r\n      }\r\n      // Also sync feature managers (they keep their own copy of sources)\r\n      if (this.player.audioDescriptionManager) {\r\n        this.player.audioDescriptionManager.src = track.audioDescriptionSrc || null;\r\n        // Remember original (non-described) source for switching back later\r\n        this.player.audioDescriptionManager.originalSource = track.src || this.player.originalSrc || null;\r\n      }\r\n      if (this.player.signLanguageManager) {\r\n        this.player.signLanguageManager.src = track.signLanguageSrc || null;\r\n        this.player.signLanguageManager.sources = track.signLanguageSources || {};\r\n        this.player.signLanguageManager.currentLanguage = null;\r\n      }\r\n\r\n      // For audio description switching, remember original source even before first play\r\n      if (track.src && !this.player.originalSrc) {\r\n        this.player.originalSrc = track.src;\r\n      }\r\n\r\n      // Replace <track> elements so captions/chapters/transcript can be detected/loaded\r\n      const existing = Array.from(this.player.element.querySelectorAll('track'));\r\n      existing.forEach(t => t.remove());\r\n\r\n      if (Array.isArray(track.tracks)) {\r\n        track.tracks.forEach(tc => {\r\n          if (!tc?.src) return;\r\n          const el = document.createElement('track');\r\n          el.src = tc.src;\r\n          el.kind = tc.kind || 'captions';\r\n          el.srclang = tc.srclang || 'en';\r\n          el.label = tc.label || tc.srclang || 'Track';\r\n          if (tc.default) el.default = true;\r\n          if (tc.describedSrc) {\r\n            el.setAttribute('data-desc-src', tc.describedSrc);\r\n          }\r\n          this.player.element.appendChild(el);\r\n        });\r\n      }\r\n\r\n      if (typeof this.player.invalidateTrackCache === 'function') {\r\n        this.player.invalidateTrackCache();\r\n      }\r\n\r\n      // Re-scan described-track metadata for AudioDescriptionManager\r\n      if (this.player.audioDescriptionManager && typeof this.player.audioDescriptionManager.initFromSourceElements === 'function') {\r\n        try {\r\n          this.player.audioDescriptionManager.captionTracks = [];\r\n          this.player.audioDescriptionManager.initFromSourceElements(this.player.sourceElements, this.player.trackElements);\r\n        } catch (e) {\r\n          // ignore\r\n        }\r\n      }\r\n\r\n      // Refresh caption/transcript managers so menus reflect newly injected <track> elements\r\n      // (important when we defer MP4/MP3 loading but still want VTT-based UI to work).\r\n      if (this.player.captionManager && typeof this.player.captionManager.loadTracks === 'function') {\r\n        try {\r\n          this.player.captionManager.tracks = [];\r\n          this.player.captionManager.currentTrack = null;\r\n          this.player.captionManager.loadTracks();\r\n        } catch (e) {\r\n          // ignore\r\n        }\r\n      }\r\n\r\n      // TranscriptManager reads from TextTracks too; it will be correct after media starts.\r\n      // For now, we just ensure control bar is rebuilt so the button is present.\r\n\r\n      // Rebuild controls so feature buttons appear immediately\r\n      if (typeof this.player.updateControlBar === 'function') {\r\n        this.player.updateControlBar();\r\n      }\r\n    } catch (e) {\r\n      // ignore preview errors; selection should still work\r\n    }\r\n\r\n    this.updateTrackInfo(track);\r\n    this.updatePlaylistUI();\r\n\r\n    this.player.emit('playlisttrackselect', {\r\n      index,\r\n      item: track,\r\n      total: this.tracks.length\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Play a specific track\r\n   * @param {number} index - Track index\r\n   * @param {boolean} userInitiated - Whether this was triggered by user action (default: false)\r\n   */\r\n  async play(index, userInitiated = false) {\r\n    if (index < 0 || index >= this.tracks.length) {\r\n      console.warn('VidPly Playlist: Invalid track index', index);\r\n      return;\r\n    }\r\n    \r\n    const track = this.tracks[index];\r\n    \r\n    // Set guard flag to prevent cascade of next() calls during track change\r\n    this.isChangingTrack = true;\r\n    \r\n    // Update current index\r\n    this.currentIndex = index;\r\n    \r\n    // Check if we should recreate the player for this track type\r\n    if (this.options.recreatePlayers && this.hostElement && this.PlayerClass) {\r\n      const currentMediaType = this.player ? \r\n        (this.player.element.tagName === 'AUDIO' ? 'audio' : 'video') : null;\r\n      const newMediaType = this.getTrackMediaType(track);\r\n      const newElementType = (newMediaType === 'audio' || newMediaType === 'soundcloud') ? 'audio' : 'video';\r\n      \r\n      // Recreate if element type is different\r\n      if (currentMediaType !== newElementType) {\r\n        await this.recreatePlayerForTrack(track, true); // true = autoPlay\r\n        // Update UI after recreation\r\n        this.updateTrackInfo(track);\r\n        this.updatePlaylistUI();\r\n        \r\n        // Emit event\r\n        this.player.emit('playlisttrackchange', {\r\n          index: index,\r\n          item: track,\r\n          total: this.tracks.length\r\n        });\r\n        \r\n        // Clear guard flag\r\n        setTimeout(() => {\r\n          this.isChangingTrack = false;\r\n        }, 150);\r\n        return;\r\n      }\r\n    }\r\n    \r\n    // Load track into player (normal path)\r\n    // If audio description was toggled before the first play, load the described source directly.\r\n    let srcToLoad = track.src;\r\n    if (this.player?.audioDescriptionManager?.desiredState && track.audioDescriptionSrc) {\r\n      // Preserve original for later toggling back\r\n      this.player.originalSrc = track.src;\r\n      this.player.audioDescriptionManager.originalSource = track.src;\r\n      this.player.audioDescriptionManager.src = track.audioDescriptionSrc;\r\n      srcToLoad = track.audioDescriptionSrc;\r\n    }\r\n\r\n    this.player.load({\r\n      src: srcToLoad,\r\n      type: track.type,\r\n      poster: track.poster,\r\n      tracks: track.tracks || [],\r\n      audioDescriptionSrc: track.audioDescriptionSrc || null,\r\n      signLanguageSrc: track.signLanguageSrc || null,\r\n      signLanguageSources: track.signLanguageSources || {}\r\n    });\r\n    \r\n    // Update UI\r\n    this.updateTrackInfo(track);\r\n    this.updatePlaylistUI();\r\n    \r\n    // Emit event\r\n    this.player.emit('playlisttrackchange', {\r\n      index: index,\r\n      item: track,\r\n      total: this.tracks.length\r\n    });\r\n    \r\n    // Auto-play and clear guard flag after playback starts\r\n    setTimeout(() => {\r\n      this.player.play();\r\n      // Clear guard flag after a short delay to ensure track has started\r\n      setTimeout(() => {\r\n        this.isChangingTrack = false;\r\n      }, 50);\r\n    }, 100);\r\n  }\r\n  \r\n  /**\r\n   * Play next track\r\n   */\r\n  next() {\r\n    let nextIndex = this.currentIndex + 1;\r\n    \r\n    if (nextIndex >= this.tracks.length) {\r\n      if (this.options.loop) {\r\n        nextIndex = 0;\r\n      } else {\r\n        return;\r\n      }\r\n    }\r\n    \r\n    this.play(nextIndex);\r\n  }\r\n  \r\n  /**\r\n   * Play previous track\r\n   */\r\n  previous() {\r\n    let prevIndex = this.currentIndex - 1;\r\n    \r\n    if (prevIndex < 0) {\r\n      if (this.options.loop) {\r\n        prevIndex = this.tracks.length - 1;\r\n      } else {\r\n        return;\r\n      }\r\n    }\r\n    \r\n    this.play(prevIndex);\r\n  }\r\n  \r\n  /**\r\n   * Handle track end\r\n   */\r\n  handleTrackEnd() {\r\n    // Don't auto-advance if we're already in the process of changing tracks\r\n    // This prevents a cascade of next() calls when loading a new track triggers an 'ended' event\r\n    if (this.isChangingTrack) {\r\n      return;\r\n    }\r\n    \r\n    if (this.options.autoAdvance) {\r\n      this.next();\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Check if a source URL requires an external renderer\r\n   * @param {string} src - Source URL\r\n   * @returns {boolean}\r\n   */\r\n  isExternalRendererUrl(src) {\r\n    if (!src) return false;\r\n    return src.includes('youtube.com') || \r\n           src.includes('youtu.be') || \r\n           src.includes('vimeo.com') || \r\n           src.includes('soundcloud.com') || \r\n           src.includes('api.soundcloud.com') ||\r\n           src.includes('.m3u8');\r\n  }\r\n\r\n  /**\r\n   * Handle track error\r\n   */\r\n  handleTrackError(e) {\r\n    // Don't auto-advance for external renderer tracks\r\n    // External renderers (YouTube, Vimeo, SoundCloud, HLS) may trigger HTML5 errors\r\n    // that should be ignored since the external renderer handles playback\r\n    const currentTrack = this.getCurrentTrack();\r\n    if (currentTrack && currentTrack.src && this.isExternalRendererUrl(currentTrack.src)) {\r\n      // Silently ignore errors for external renderer tracks\r\n      return;\r\n    }\r\n    \r\n    // Don't auto-advance if we're in the process of changing tracks\r\n    // This prevents a cascade of next() calls when switching between renderer types\r\n    if (this.isChangingTrack) {\r\n      return;\r\n    }\r\n    \r\n    console.error('VidPly Playlist: Track error', e);\r\n    \r\n    // Try next track\r\n    if (this.options.autoAdvance) {\r\n      setTimeout(() => {\r\n        this.next();\r\n      }, 1000);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Handle playback state changes (for fullscreen playlist visibility)\r\n   */\r\n  handlePlaybackStateChange() {\r\n    this.updatePlaylistVisibilityInFullscreen();\r\n  }\r\n  \r\n  /**\r\n   * Handle fullscreen state changes\r\n   */\r\n  handleFullscreenChange() {\r\n    // Use a small delay to ensure fullscreen state is fully applied\r\n    setTimeout(() => {\r\n      this.updatePlaylistVisibilityInFullscreen();\r\n    }, 50);\r\n  }\r\n  \r\n  /**\r\n   * Handle audio description state changes\r\n   * Updates duration displays to show audio-described version duration when AD is enabled\r\n   */\r\n  handleAudioDescriptionChange() {\r\n    const currentTrack = this.getCurrentTrack();\r\n    if (!currentTrack) return;\r\n    \r\n    // Update the track info display with the appropriate duration\r\n    this.updateTrackInfo(currentTrack);\r\n    \r\n    // Update the playlist UI to reflect duration changes (aria-labels)\r\n    this.updatePlaylistUI();\r\n    \r\n    // Update visual duration elements in playlist panel\r\n    this.updatePlaylistDurations();\r\n  }\r\n  \r\n  /**\r\n   * Update the visual duration displays in the playlist panel\r\n   * Called when audio description state changes\r\n   */\r\n  updatePlaylistDurations() {\r\n    if (!this.playlistPanel) return;\r\n    \r\n    const items = this.playlistPanel.querySelectorAll('.vidply-playlist-item');\r\n    \r\n    items.forEach((item, index) => {\r\n      const track = this.tracks[index];\r\n      if (!track) return;\r\n      \r\n      const effectiveDuration = this.getEffectiveDuration(track);\r\n      const trackDuration = effectiveDuration ? TimeUtils.formatTime(effectiveDuration) : '';\r\n      \r\n      // Update duration badge on thumbnail (if exists)\r\n      const durationBadge = item.querySelector('.vidply-playlist-duration-badge');\r\n      if (durationBadge) {\r\n        durationBadge.textContent = trackDuration;\r\n      }\r\n      \r\n      // Update inline duration (if exists)\r\n      const inlineDuration = item.querySelector('.vidply-playlist-item-duration');\r\n      if (inlineDuration) {\r\n        inlineDuration.textContent = trackDuration;\r\n      }\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Get the effective duration for a track based on audio description state\r\n   * @param {Object} track - Track object\r\n   * @returns {number|null} - Duration in seconds or null if not available\r\n   */\r\n  getEffectiveDuration(track) {\r\n    if (!track) return null;\r\n    \r\n    const isAudioDescriptionEnabled = this.player.state.audioDescriptionEnabled;\r\n    \r\n    // If audio description is enabled and track has audioDescriptionDuration, use it\r\n    if (isAudioDescriptionEnabled && track.audioDescriptionDuration) {\r\n      return track.audioDescriptionDuration;\r\n    }\r\n    \r\n    // Otherwise use regular duration\r\n    return track.duration || null;\r\n  }\r\n  \r\n  /**\r\n   * Update playlist visibility based on fullscreen and playback state\r\n   * In fullscreen: show when paused/not started, hide when playing\r\n   * Outside fullscreen: respect original panel visibility setting\r\n   */\r\n  updatePlaylistVisibilityInFullscreen() {\r\n    if (!this.playlistPanel || !this.tracks.length) return;\r\n    \r\n    const isFullscreen = this.player.state.fullscreen;\r\n    const isPlaying = this.player.state.playing;\r\n    \r\n    if (isFullscreen) {\r\n      // In fullscreen: show only when not playing (paused or not started)\r\n      // Check playing state explicitly since paused might not be set initially\r\n      if (!isPlaying) {\r\n        this.playlistPanel.classList.add('vidply-playlist-fullscreen-visible');\r\n        this.playlistPanel.style.display = 'block';\r\n      } else {\r\n        this.playlistPanel.classList.remove('vidply-playlist-fullscreen-visible');\r\n        // Add a smooth fade out with delay to match CSS transition\r\n        setTimeout(() => {\r\n          // Double-check state hasn't changed before hiding\r\n          if (this.player.state.playing && this.player.state.fullscreen) {\r\n            this.playlistPanel.style.display = 'none';\r\n          }\r\n        }, 300); // Match CSS transition duration\r\n      }\r\n    } else {\r\n      // Outside fullscreen: restore original behavior\r\n      this.playlistPanel.classList.remove('vidply-playlist-fullscreen-visible');\r\n      if (this.isPanelVisible && this.tracks.length > 0) {\r\n        this.playlistPanel.style.display = 'block';\r\n      } else {\r\n        this.playlistPanel.style.display = 'none';\r\n      }\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Create playlist UI\r\n   */\r\n  createUI() {\r\n    // Find player container\r\n    this.container = this.player.container;\r\n    \r\n    if (!this.container) {\r\n      console.warn('VidPly Playlist: No container found');\r\n      return;\r\n    }\r\n    \r\n    // Track artwork element (shows album art/poster for audio tracks).\r\n    // Important: in mixed playlists the player may start as <video> and later recreate to <audio>,\r\n    // so we create this lazily in `updateTrackArtwork()` when we actually have an audio element.\r\n    \r\n    // Create track info element (shows current track)\r\n    this.trackInfoElement = DOMUtils.createElement('div', {\r\n      className: 'vidply-track-info',\r\n      attributes: {\r\n        role: 'status'\r\n      }\r\n    });\r\n    this.trackInfoElement.style.display = 'none';\r\n    \r\n    this.container.appendChild(this.trackInfoElement);\r\n    \r\n    // Create navigation feedback live region\r\n    this.navigationFeedback = DOMUtils.createElement('div', {\r\n      className: 'vidply-sr-only',\r\n      attributes: {\r\n        role: 'status',\r\n        'aria-live': 'polite',\r\n        'aria-atomic': 'true'\r\n      }\r\n    });\r\n    this.container.appendChild(this.navigationFeedback);\r\n    \r\n    // Create playlist panel with proper landmark\r\n    this.playlistPanel = DOMUtils.createElement('div', {\r\n      className: 'vidply-playlist-panel',\r\n      attributes: {\r\n        id: `${this.uniqueId}-panel`,\r\n        role: 'region',\r\n        'aria-label': i18n.t('playlist.title'),\r\n        'aria-labelledby': `${this.uniqueId}-heading`\r\n      }\r\n    });\r\n    this.playlistPanel.style.display = this.isPanelVisible ? 'none' : 'none'; // Will be shown when playlist is loaded\r\n    \r\n    this.container.appendChild(this.playlistPanel);\r\n  }\r\n  \r\n  /**\r\n   * Update track info display\r\n   */\r\n  updateTrackInfo(track) {\r\n    if (!this.trackInfoElement) return;\r\n    \r\n    const trackNumber = this.currentIndex + 1;\r\n    const totalTracks = this.tracks.length;\r\n    const trackTitle = track.title || i18n.t('playlist.untitled');\r\n    const trackArtist = track.artist || '';\r\n    \r\n    // Use effective duration (audio description duration when AD is enabled)\r\n    const effectiveDuration = this.getEffectiveDuration(track);\r\n    const trackDuration = effectiveDuration ? TimeUtils.formatTime(effectiveDuration) : '';\r\n    const trackDurationReadable = effectiveDuration ? TimeUtils.formatDuration(effectiveDuration) : '';\r\n    \r\n    // Screen reader announcement - include duration if available\r\n    const artistPart = trackArtist ? i18n.t('playlist.by') + trackArtist : '';\r\n    const durationPart = trackDurationReadable ? `. ${trackDurationReadable}` : '';\r\n    const announcement = i18n.t('playlist.nowPlaying', {\r\n      current: trackNumber,\r\n      total: totalTracks,\r\n      title: trackTitle,\r\n      artist: artistPart\r\n    }) + durationPart;\r\n    \r\n    const trackOfText = i18n.t('playlist.trackOf', {\r\n      current: trackNumber,\r\n      total: totalTracks\r\n    });\r\n    \r\n    // Build duration HTML if available\r\n    const durationHtml = trackDuration \r\n      ? `<span class=\"vidply-track-duration\" aria-hidden=\"true\">${DOMUtils.escapeHTML(trackDuration)}</span>` \r\n      : '';\r\n    \r\n    // Get description if available\r\n    const trackDescription = track.description || '';\r\n    \r\n    this.trackInfoElement.innerHTML = `\r\n      <span class=\"vidply-sr-only\">${DOMUtils.escapeHTML(announcement)}</span>\r\n      <div class=\"vidply-track-header\" aria-hidden=\"true\">\r\n        <span class=\"vidply-track-number\">${DOMUtils.escapeHTML(trackOfText)}</span>\r\n        ${durationHtml}\r\n      </div>\r\n      <div class=\"vidply-track-title\" aria-hidden=\"true\">${DOMUtils.escapeHTML(trackTitle)}</div>\r\n      ${trackArtist ? `<div class=\"vidply-track-artist\" aria-hidden=\"true\">${DOMUtils.escapeHTML(trackArtist)}</div>` : ''}\r\n      ${trackDescription ? `<div class=\"vidply-track-description\" aria-hidden=\"true\">${DOMUtils.escapeHTML(trackDescription)}</div>` : ''}\r\n    `;\r\n    \r\n    this.trackInfoElement.style.display = 'block';\r\n    \r\n    // Update track artwork if available (for audio playlists)\r\n    this.updateTrackArtwork(track);\r\n  }\r\n  \r\n  /**\r\n   * Update track artwork display (for audio playlists)\r\n   */\r\n  updateTrackArtwork(track) {\r\n    // Only show artwork for audio players.\r\n    // In mixed playlists we may recreate from <video> -> <audio> later, so ensure the element exists lazily.\r\n    if (this.player?.element?.tagName !== 'AUDIO') {\r\n      if (this.trackArtworkElement) {\r\n        this.trackArtworkElement.style.display = 'none';\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Lazily create artwork element once we have an audio element/container.\r\n    if (!this.trackArtworkElement && this.container) {\r\n      this.trackArtworkElement = DOMUtils.createElement('div', {\r\n        className: 'vidply-track-artwork',\r\n        attributes: {\r\n          'aria-hidden': 'true'\r\n        }\r\n      });\r\n      this.trackArtworkElement.style.display = 'none';\r\n\r\n      // Insert before video wrapper (if present) for consistent layout.\r\n      const videoWrapper = this.container.querySelector('.vidply-video-wrapper');\r\n      if (videoWrapper) {\r\n        this.container.insertBefore(this.trackArtworkElement, videoWrapper);\r\n      } else {\r\n        this.container.appendChild(this.trackArtworkElement);\r\n      }\r\n    }\r\n\r\n    if (!this.trackArtworkElement) return;\r\n    \r\n    // If track has a poster/artwork, show it\r\n    if (track.poster) {\r\n      this.trackArtworkElement.style.backgroundImage = `url(${track.poster})`;\r\n      this.trackArtworkElement.style.display = 'block';\r\n    } else {\r\n      // No artwork available, hide the element\r\n      this.trackArtworkElement.style.display = 'none';\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Render playlist\r\n   */\r\n  renderPlaylist() {\r\n    if (!this.playlistPanel) return;\r\n    \r\n    // Clear existing\r\n    this.playlistPanel.innerHTML = '';\r\n    \r\n    // Create header\r\n    const header = DOMUtils.createElement('h2', {\r\n      className: 'vidply-playlist-header',\r\n      attributes: {\r\n        id: `${this.uniqueId}-heading`\r\n      }\r\n    });\r\n    header.textContent = `${i18n.t('playlist.title')} (${this.tracks.length})`;\r\n    this.playlistPanel.appendChild(header);\r\n    \r\n    // Add keyboard instructions (visually hidden)\r\n    const instructions = DOMUtils.createElement('div', {\r\n      className: 'vidply-sr-only',\r\n      attributes: {\r\n        id: `${this.uniqueId}-keyboard-instructions`\r\n      }\r\n    });\r\n    instructions.textContent = i18n.t('playlist.keyboardInstructions');\r\n    this.playlistPanel.appendChild(instructions);\r\n    \r\n    // Create list (proper ul element)\r\n    const list = DOMUtils.createElement('ul', {\r\n      className: 'vidply-playlist-list',\r\n      attributes: {\r\n        role: 'listbox',\r\n        'aria-labelledby': `${this.uniqueId}-heading`,\r\n        'aria-describedby': `${this.uniqueId}-keyboard-instructions`\r\n      }\r\n    });\r\n    \r\n    this.tracks.forEach((track, index) => {\r\n      const item = this.createPlaylistItem(track, index);\r\n      list.appendChild(item);\r\n    });\r\n    \r\n    this.playlistPanel.appendChild(list);\r\n    \r\n    // Show panel if it should be visible\r\n    if (this.isPanelVisible) {\r\n      this.playlistPanel.style.display = 'block';\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Create playlist item element\r\n   */\r\n  createPlaylistItem(track, index) {\r\n    const trackPosition = i18n.t('playlist.trackOf', {\r\n      current: index + 1,\r\n      total: this.tracks.length\r\n    });\r\n    const trackTitle = track.title || i18n.t('playlist.trackUntitled', { number: index + 1 });\r\n    const trackArtist = track.artist ? i18n.t('playlist.by') + track.artist : '';\r\n    \r\n    // Use effective duration (audio description duration when AD is enabled)\r\n    const effectiveDuration = this.getEffectiveDuration(track);\r\n    const trackDuration = effectiveDuration ? TimeUtils.formatTime(effectiveDuration) : '';\r\n    const trackDurationReadable = effectiveDuration ? TimeUtils.formatDuration(effectiveDuration) : '';\r\n    const isActive = index === this.currentIndex;\r\n    \r\n    // Build accessible label for screen readers\r\n    // With role=\"option\" and aria-checked, screen reader will announce selection state\r\n    // Position is already announced via aria-posinset/aria-setsize\r\n    // Format: \"Title by Artist. 3 minutes, 45 seconds.\"\r\n    let ariaLabel = `${trackTitle}${trackArtist}`;\r\n    if (trackDurationReadable) {\r\n      ariaLabel += `. ${trackDurationReadable}`;\r\n    }\r\n    \r\n    // Create list item container (semantic HTML)\r\n    const item = DOMUtils.createElement('li', {\r\n      className: isActive ? 'vidply-playlist-item vidply-playlist-item-active' : 'vidply-playlist-item',\r\n      attributes: {\r\n        'data-playlist-index': index\r\n      }\r\n    });\r\n    \r\n    // Create button wrapper for interactive content\r\n    const button = DOMUtils.createElement('button', {\r\n      className: 'vidply-playlist-item-button',\r\n      attributes: {\r\n        type: 'button',\r\n        role: 'option',\r\n        tabIndex: index === 0 ? 0 : -1, // Only first item is in tab order initially\r\n        'aria-label': ariaLabel,\r\n        'aria-posinset': index + 1,\r\n        'aria-setsize': this.tracks.length,\r\n        'aria-checked': isActive ? 'true' : 'false'\r\n      }\r\n    });\r\n    \r\n    // Add aria-current if active\r\n    if (isActive) {\r\n      button.setAttribute('aria-current', 'true');\r\n      button.setAttribute('tabIndex', '0'); // Active item should always be tabbable\r\n    }\r\n    \r\n    // Thumbnail container with optional duration badge\r\n    const thumbnailContainer = DOMUtils.createElement('span', {\r\n      className: 'vidply-playlist-thumbnail-container',\r\n      attributes: {\r\n        'aria-hidden': 'true'\r\n      }\r\n    });\r\n    \r\n    // Thumbnail or icon\r\n    const thumbnail = DOMUtils.createElement('span', {\r\n      className: 'vidply-playlist-thumbnail'\r\n    });\r\n    \r\n    if (track.poster) {\r\n      thumbnail.style.backgroundImage = `url(${track.poster})`;\r\n    } else {\r\n      // Show music/speaker icon for audio tracks\r\n      const icon = createIconElement('music');\r\n      icon.classList.add('vidply-playlist-thumbnail-icon');\r\n      thumbnail.appendChild(icon);\r\n    }\r\n    \r\n    thumbnailContainer.appendChild(thumbnail);\r\n    \r\n    // Duration badge on thumbnail (like YouTube) - only show if there's a poster\r\n    if (trackDuration && track.poster) {\r\n      const durationBadge = DOMUtils.createElement('span', {\r\n        className: 'vidply-playlist-duration-badge'\r\n      });\r\n      durationBadge.textContent = trackDuration;\r\n      thumbnailContainer.appendChild(durationBadge);\r\n    }\r\n    \r\n    button.appendChild(thumbnailContainer);\r\n    \r\n    // Info section (title, artist, description)\r\n    const info = DOMUtils.createElement('span', {\r\n      className: 'vidply-playlist-item-info',\r\n      attributes: {\r\n        'aria-hidden': 'true'\r\n      }\r\n    });\r\n    \r\n    // Title row with optional inline duration (for when no thumbnail)\r\n    const titleRow = DOMUtils.createElement('span', {\r\n      className: 'vidply-playlist-item-title-row'\r\n    });\r\n    \r\n    const title = DOMUtils.createElement('span', {\r\n      className: 'vidply-playlist-item-title'\r\n    });\r\n    title.textContent = trackTitle;\r\n    titleRow.appendChild(title);\r\n    \r\n    // Inline duration (shown when no poster/thumbnail)\r\n    if (trackDuration && !track.poster) {\r\n      const inlineDuration = DOMUtils.createElement('span', {\r\n        className: 'vidply-playlist-item-duration'\r\n      });\r\n      inlineDuration.textContent = trackDuration;\r\n      titleRow.appendChild(inlineDuration);\r\n    }\r\n    \r\n    info.appendChild(titleRow);\r\n    \r\n    // Artist\r\n    if (track.artist) {\r\n      const artist = DOMUtils.createElement('span', {\r\n        className: 'vidply-playlist-item-artist'\r\n      });\r\n      artist.textContent = track.artist;\r\n      info.appendChild(artist);\r\n    }\r\n    \r\n    // Description (truncated)\r\n    if (track.description) {\r\n      const description = DOMUtils.createElement('span', {\r\n        className: 'vidply-playlist-item-description'\r\n      });\r\n      description.textContent = track.description;\r\n      info.appendChild(description);\r\n    }\r\n    \r\n    button.appendChild(info);\r\n    \r\n    // Play icon\r\n    const playIcon = createIconElement('play');\r\n    playIcon.classList.add('vidply-playlist-item-icon');\r\n    playIcon.setAttribute('aria-hidden', 'true');\r\n    button.appendChild(playIcon);\r\n    \r\n    // Click handler\r\n    button.addEventListener('click', () => {\r\n      const track = this.tracks[index];\r\n      const isExternalRenderer = this.isExternalRendererUrl(track?.src);\r\n      \r\n      // Exit fullscreen for external renderer tracks (YouTube, Vimeo, SoundCloud)\r\n      // These have their own native controls that work better outside vidply's fullscreen\r\n      if (isExternalRenderer && this.player.state.fullscreen) {\r\n        this.player.exitFullscreen();\r\n        // Small delay to let fullscreen exit before loading\r\n        setTimeout(() => {\r\n          this.play(index, true);\r\n        }, 100);\r\n      } else {\r\n        this.play(index, true); // User-initiated\r\n      }\r\n    });\r\n    \r\n    // Keyboard handler\r\n    button.addEventListener('keydown', (e) => {\r\n      this.handlePlaylistItemKeydown(e, index);\r\n    });\r\n    \r\n    // Append button to list item\r\n    item.appendChild(button);\r\n    \r\n    return item;\r\n  }\r\n  \r\n  /**\r\n   * Handle keyboard navigation in playlist items\r\n   */\r\n  handlePlaylistItemKeydown(e, index) {\r\n    const buttons = Array.from(this.playlistPanel.querySelectorAll('.vidply-playlist-item-button'));\r\n    let newIndex = -1;\r\n    let announcement = '';\r\n    \r\n    switch(e.key) {\r\n      case 'Enter':\r\n      case ' ':\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        {\r\n          const track = this.tracks[index];\r\n          const isExternalRenderer = this.isExternalRendererUrl(track?.src);\r\n          \r\n          // Exit fullscreen for external renderer tracks (YouTube, Vimeo, SoundCloud)\r\n          if (isExternalRenderer && this.player.state.fullscreen) {\r\n            this.player.exitFullscreen();\r\n            setTimeout(() => {\r\n              this.play(index, true);\r\n            }, 100);\r\n          } else {\r\n            this.play(index, true); // User-initiated\r\n          }\r\n        }\r\n        return; // No need to move focus\r\n        \r\n      case 'ArrowDown':\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        // Move to next item\r\n        if (index < buttons.length - 1) {\r\n          newIndex = index + 1;\r\n        } else {\r\n          // At the end, announce boundary\r\n          announcement = i18n.t('playlist.endOfPlaylist', { current: buttons.length, total: buttons.length });\r\n        }\r\n        break;\r\n\r\n      case 'ArrowUp':\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        // Move to previous item\r\n        if (index > 0) {\r\n          newIndex = index - 1;\r\n        } else {\r\n          // At the beginning, announce boundary\r\n          announcement = i18n.t('playlist.beginningOfPlaylist', { total: buttons.length });\r\n        }\r\n        break;\r\n\r\n      case 'PageDown':\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        // Move 5 items down (or to end)\r\n        newIndex = Math.min(index + 5, buttons.length - 1);\r\n        if (newIndex === buttons.length - 1 && index !== newIndex) {\r\n          announcement = i18n.t('playlist.jumpedToLastTrack', { current: newIndex + 1, total: buttons.length });\r\n        }\r\n        break;\r\n\r\n      case 'PageUp':\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        // Move 5 items up (or to beginning)\r\n        newIndex = Math.max(index - 5, 0);\r\n        if (newIndex === 0 && index !== newIndex) {\r\n          announcement = i18n.t('playlist.jumpedToFirstTrack', { total: buttons.length });\r\n        }\r\n        break;\r\n\r\n      case 'Home':\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        // Move to first item\r\n        newIndex = 0;\r\n        if (index !== 0) {\r\n          announcement = i18n.t('playlist.firstTrack', { total: buttons.length });\r\n        }\r\n        break;\r\n\r\n      case 'End':\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        // Move to last item\r\n        newIndex = buttons.length - 1;\r\n        if (index !== buttons.length - 1) {\r\n          announcement = i18n.t('playlist.lastTrack', { current: buttons.length, total: buttons.length });\r\n        }\r\n        break;\r\n    }\r\n    \r\n    // Update tab indices for roving tabindex pattern\r\n    if (newIndex !== -1 && newIndex !== index) {\r\n      buttons[index].setAttribute('tabIndex', '-1');\r\n      buttons[newIndex].setAttribute('tabIndex', '0');\r\n      buttons[newIndex].focus({ preventScroll: false });\r\n      \r\n      // Scroll the focused item into view (same behavior as mouse interaction)\r\n      const item = buttons[newIndex].closest('.vidply-playlist-item');\r\n      if (item) {\r\n        item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\r\n      }\r\n    }\r\n    \r\n    // Announce navigation feedback\r\n    if (announcement && this.navigationFeedback) {\r\n      this.navigationFeedback.textContent = announcement;\r\n      // Clear after a short delay to allow for repeated announcements\r\n      setTimeout(() => {\r\n        if (this.navigationFeedback) {\r\n          this.navigationFeedback.textContent = '';\r\n        }\r\n      }, 1000);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Update playlist UI (highlight current track)\r\n   */\r\n  updatePlaylistUI() {\r\n    if (!this.playlistPanel) return;\r\n    \r\n    const items = this.playlistPanel.querySelectorAll('.vidply-playlist-item');\r\n    const buttons = this.playlistPanel.querySelectorAll('.vidply-playlist-item-button');\r\n    \r\n    items.forEach((item, index) => {\r\n      const button = buttons[index];\r\n      if (!button) return;\r\n      \r\n      const track = this.tracks[index];\r\n      const trackPosition = i18n.t('playlist.trackOf', {\r\n        current: index + 1,\r\n        total: this.tracks.length\r\n      });\r\n      const trackTitle = track.title || i18n.t('playlist.trackUntitled', { number: index + 1 });\r\n      const trackArtist = track.artist ? i18n.t('playlist.by') + track.artist : '';\r\n      \r\n      // Use effective duration (audio description duration when AD is enabled)\r\n      const effectiveDuration = this.getEffectiveDuration(track);\r\n      const trackDurationReadable = effectiveDuration ? TimeUtils.formatDuration(effectiveDuration) : '';\r\n      \r\n      if (index === this.currentIndex) {\r\n        // Update list item styling\r\n        item.classList.add('vidply-playlist-item-active');\r\n        \r\n        // Update button ARIA attributes\r\n        button.setAttribute('aria-current', 'true');\r\n        button.setAttribute('aria-checked', 'true');\r\n        button.setAttribute('tabIndex', '0'); // Active item should be tabbable\r\n        \r\n        // Simplified aria-label - status and actions are announced via ARIA roles\r\n        let ariaLabel = `${trackTitle}${trackArtist}`;\r\n        if (trackDurationReadable) {\r\n          ariaLabel += `. ${trackDurationReadable}`;\r\n        }\r\n        button.setAttribute('aria-label', ariaLabel);\r\n        \r\n        // Scroll into view within playlist panel (uses 'nearest' to minimize page scroll)\r\n        item.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\r\n      } else {\r\n        // Update list item styling\r\n        item.classList.remove('vidply-playlist-item-active');\r\n        \r\n        // Update button ARIA attributes\r\n        button.removeAttribute('aria-current');\r\n        button.setAttribute('aria-checked', 'false');\r\n        button.setAttribute('tabIndex', '-1'); // Remove from tab order (use arrow keys)\r\n        \r\n        // Simplified aria-label - status and actions are announced via ARIA roles\r\n        let ariaLabel = `${trackTitle}${trackArtist}`;\r\n        if (trackDurationReadable) {\r\n          ariaLabel += `. ${trackDurationReadable}`;\r\n        }\r\n        button.setAttribute('aria-label', ariaLabel);\r\n      }\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Get current track\r\n   */\r\n  getCurrentTrack() {\r\n    return this.tracks[this.currentIndex] || null;\r\n  }\r\n  \r\n  /**\r\n   * Get playlist info\r\n   */\r\n  getPlaylistInfo() {\r\n    return {\r\n      currentIndex: this.currentIndex,\r\n      totalTracks: this.tracks.length,\r\n      currentTrack: this.getCurrentTrack(),\r\n      hasNext: this.hasNext(),\r\n      hasPrevious: this.hasPrevious()\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Check if there is a next track\r\n   */\r\n  hasNext() {\r\n    if (this.options.loop) return true;\r\n    return this.currentIndex < this.tracks.length - 1;\r\n  }\r\n  \r\n  /**\r\n   * Check if there is a previous track\r\n   */\r\n  hasPrevious() {\r\n    if (this.options.loop) return true;\r\n    return this.currentIndex > 0;\r\n  }\r\n  \r\n  /**\r\n   * Add track to playlist\r\n   */\r\n  addTrack(track) {\r\n    this.tracks.push(track);\r\n    \r\n    if (this.playlistPanel) {\r\n      this.renderPlaylist();\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Remove track from playlist\r\n   */\r\n  removeTrack(index) {\r\n    if (index < 0 || index >= this.tracks.length) return;\r\n    \r\n    this.tracks.splice(index, 1);\r\n    \r\n    // Adjust current index if needed\r\n    if (index < this.currentIndex) {\r\n      this.currentIndex--;\r\n    } else if (index === this.currentIndex) {\r\n      // Current track was removed, play next or stop\r\n      if (this.currentIndex >= this.tracks.length) {\r\n        this.currentIndex = this.tracks.length - 1;\r\n      }\r\n      \r\n      if (this.currentIndex >= 0) {\r\n        this.play(this.currentIndex);\r\n      }\r\n    }\r\n    \r\n    if (this.playlistPanel) {\r\n      this.renderPlaylist();\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Clear playlist\r\n   */\r\n  clear() {\r\n    this.tracks = [];\r\n    this.currentIndex = -1;\r\n    \r\n    if (this.playlistPanel) {\r\n      this.playlistPanel.innerHTML = '';\r\n      this.playlistPanel.style.display = 'none';\r\n    }\r\n    \r\n    if (this.trackInfoElement) {\r\n      this.trackInfoElement.innerHTML = '';\r\n      this.trackInfoElement.style.display = 'none';\r\n    }\r\n    \r\n    if (this.trackArtworkElement) {\r\n      this.trackArtworkElement.style.backgroundImage = '';\r\n      this.trackArtworkElement.style.display = 'none';\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Toggle playlist panel visibility\r\n   * @param {boolean} show - Optional: force show (true) or hide (false)\r\n   * @returns {boolean} - New visibility state\r\n   */\r\n  togglePanel(show) {\r\n    if (!this.playlistPanel) return false;\r\n    \r\n    // Determine new state\r\n    const shouldShow = show !== undefined ? show : this.playlistPanel.style.display === 'none';\r\n    \r\n    if (shouldShow) {\r\n      this.playlistPanel.style.display = 'block';\r\n      this.isPanelVisible = true;\r\n      \r\n      // Focus first item if playlist has tracks\r\n      if (this.tracks.length > 0) {\r\n        setTimeout(() => {\r\n          const firstItem = this.playlistPanel.querySelector('.vidply-playlist-item[tabindex=\"0\"]');\r\n          if (firstItem) {\r\n            firstItem.focus({ preventScroll: true });\r\n          }\r\n        }, 100);\r\n      }\r\n      \r\n      // Update toggle button state if it exists\r\n      if (this.player.controlBar && this.player.controlBar.controls.playlistToggle) {\r\n        this.player.controlBar.controls.playlistToggle.setAttribute('aria-expanded', 'true');\r\n        this.player.controlBar.controls.playlistToggle.setAttribute('aria-pressed', 'true');\r\n      }\r\n    } else {\r\n      this.playlistPanel.style.display = 'none';\r\n      this.isPanelVisible = false;\r\n      \r\n      // Update toggle button state if it exists\r\n      if (this.player.controlBar && this.player.controlBar.controls.playlistToggle) {\r\n        this.player.controlBar.controls.playlistToggle.setAttribute('aria-expanded', 'false');\r\n        this.player.controlBar.controls.playlistToggle.setAttribute('aria-pressed', 'false');\r\n        \r\n        // Return focus to toggle button\r\n        this.player.controlBar.controls.playlistToggle.focus({ preventScroll: true });\r\n      }\r\n    }\r\n    \r\n    return this.isPanelVisible;\r\n  }\r\n  \r\n  /**\r\n   * Show playlist panel\r\n   */\r\n  showPanel() {\r\n    return this.togglePanel(true);\r\n  }\r\n  \r\n  /**\r\n   * Hide playlist panel\r\n   */\r\n  hidePanel() {\r\n    return this.togglePanel(false);\r\n  }\r\n  \r\n  /**\r\n   * Destroy playlist manager\r\n   */\r\n  destroy() {\r\n    // Remove event listeners\r\n    this.player.off('ended', this.handleTrackEnd);\r\n    this.player.off('error', this.handleTrackError);\r\n    \r\n    // Remove UI\r\n    if (this.trackArtworkElement) {\r\n      this.trackArtworkElement.remove();\r\n    }\r\n    \r\n    if (this.trackInfoElement) {\r\n      this.trackInfoElement.remove();\r\n    }\r\n    \r\n    if (this.playlistPanel) {\r\n      this.playlistPanel.remove();\r\n    }\r\n    \r\n    // Clear data\r\n    this.clear();\r\n  }\r\n}\r\n\r\nexport default PlaylistManager;\r\n", "/**\r\n * VidPly - Universal Video Player\r\n * Main Entry Point\r\n */\r\n\r\nimport { Player } from './core/Player.js';\r\nimport { PlaylistManager } from './features/PlaylistManager.js';\r\n\r\n// Auto-initialize players\r\nfunction initializePlayers() {\r\n  const elements = document.querySelectorAll('[data-vidply]');\r\n  \r\n  elements.forEach(element => {\r\n    // Parse options from data attribute (JSON format)\r\n    const options = element.dataset.vidplyOptions \r\n      ? JSON.parse(element.dataset.vidplyOptions)\r\n      : {};\r\n    \r\n    // Parse individual data attributes and merge with options\r\n    // This allows for easier HTML-based configuration\r\n    const dataOptions = parseDataAttributes(element.dataset);\r\n    const mergedOptions = { ...dataOptions, ...options };\r\n    \r\n    // Create player instance\r\n    new Player(element, mergedOptions);\r\n  });\r\n}\r\n\r\n// Helper function to parse data attributes into options\r\nfunction parseDataAttributes(dataset) {\r\n  const options = {};\r\n  \r\n  // Map of data attribute names to option keys (camelCase conversion)\r\n  const attributeMap = {\r\n    // Sign Language\r\n    'signLanguageSrc': 'signLanguageSrc',\r\n    'signLanguageButton': 'signLanguageButton',\r\n    'signLanguagePosition': 'signLanguagePosition',\r\n    'signLanguageDisplayMode': 'signLanguageDisplayMode',\r\n    \r\n    // Audio Description\r\n    'audioDescriptionSrc': 'audioDescriptionSrc',\r\n    'audioDescriptionButton': 'audioDescriptionButton',\r\n    \r\n    // Other common options\r\n    'autoplay': 'autoplay',\r\n    'loop': 'loop',\r\n    'muted': 'muted',\r\n    'controls': 'controls',\r\n    'poster': 'poster',\r\n    'width': 'width',\r\n    'height': 'height',\r\n    'language': 'language',\r\n    'captions': 'captions',\r\n    'captionsDefault': 'captionsDefault',\r\n    'transcript': 'transcript',\r\n    'transcriptButton': 'transcriptButton',\r\n    'keyboard': 'keyboard',\r\n    'responsive': 'responsive',\r\n    'pipButton': 'pipButton',\r\n    'fullscreenButton': 'fullscreenButton',\r\n\r\n    // Layout\r\n  };\r\n  \r\n  // Parse each data attribute\r\n  Object.keys(attributeMap).forEach(dataKey => {\r\n    const optionKey = attributeMap[dataKey];\r\n    const value = dataset[dataKey];\r\n    \r\n    if (value !== undefined) {\r\n      // Convert string values to appropriate types\r\n      if (value === 'true') {\r\n        options[optionKey] = true;\r\n      } else if (value === 'false') {\r\n        options[optionKey] = false;\r\n      } else if (!isNaN(value) && value !== '') {\r\n        options[optionKey] = Number(value);\r\n      } else {\r\n        options[optionKey] = value;\r\n      }\r\n    }\r\n  });\r\n  \r\n  // Parse sign language sources with language codes (e.g., data-sign-language-src-en, data-sign-language-src-de)\r\n  // In dataset, hyphens become camelCase: data-sign-language-src-en -> signLanguageSrcEn\r\n  const signLanguageSources = {};\r\n  Object.keys(dataset).forEach(key => {\r\n    if (key.startsWith('signLanguageSrc') && key !== 'signLanguageSrc') {\r\n      // Extract language code from key (e.g., 'signLanguageSrcEn' -> 'en', 'signLanguageSrcDe' -> 'de')\r\n      // Handle both single and multi-word language codes\r\n      const langMatch = key.match(/^signLanguageSrc([A-Z][a-z]*)$/);\r\n      if (langMatch) {\r\n        const langCode = langMatch[1].toLowerCase();\r\n        signLanguageSources[langCode] = dataset[key];\r\n      }\r\n    }\r\n  });\r\n  \r\n  if (Object.keys(signLanguageSources).length > 0) {\r\n    options.signLanguageSources = signLanguageSources;\r\n    // If there's also a single signLanguageSrc, use it as default/fallback\r\n    if (dataset.signLanguageSrc && !options.signLanguageSrc) {\r\n      options.signLanguageSrc = dataset.signLanguageSrc;\r\n    }\r\n  }\r\n  \r\n  // Handle language file attributes\r\n  // Support for multiple language files: data-vidply-language-files='{\"pt\": \"path/to/pt.json\", \"it\": \"path/to/it.json\"}'\r\n  if (dataset.vidplyLanguageFiles) {\r\n    try {\r\n      options.languageFiles = JSON.parse(dataset.vidplyLanguageFiles);\r\n    } catch (e) {\r\n      console.warn('Invalid JSON in data-vidply-language-files:', e);\r\n    }\r\n  }\r\n  \r\n  // Support for single language file: data-vidply-language-file='{\"pt\": \"path/to/pt.json\"}'\r\n  // or data-vidply-language-file-code=\"pt\" + data-vidply-language-file-url=\"path/to/pt.json\"\r\n  if (dataset.vidplyLanguageFile) {\r\n    try {\r\n      const parsed = JSON.parse(dataset.vidplyLanguageFile);\r\n      // If it's an object, treat it as languageFiles\r\n      if (typeof parsed === 'object' && parsed !== null) {\r\n        options.languageFiles = parsed;\r\n      }\r\n    } catch (e) {\r\n      // If parsing fails, check for separate code and URL attributes\r\n      if (dataset.vidplyLanguageFileCode && dataset.vidplyLanguageFileUrl) {\r\n        options.languageFile = dataset.vidplyLanguageFileCode;\r\n        options.languageFileUrl = dataset.vidplyLanguageFileUrl;\r\n      }\r\n    }\r\n  } else if (dataset.vidplyLanguageFileCode && dataset.vidplyLanguageFileUrl) {\r\n    // Support separate attributes for single language file\r\n    options.languageFile = dataset.vidplyLanguageFileCode;\r\n    options.languageFileUrl = dataset.vidplyLanguageFileUrl;\r\n  }\r\n  \r\n  return options;\r\n}\r\n\r\n// Auto-initialize on DOM ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', initializePlayers);\r\n} else {\r\n  initializePlayers();\r\n}\r\n\r\n// Export for manual initialization\r\nexport { Player, PlaylistManager };\r\nexport default Player;\r\n\r\n"],
  "mappings": "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",
  "names": ["currentTime", "isSmallScreen", "isMobile", "currentSrc", "syncTime", "hasSourceElementsWithDesc", "allTextTracks", "isMobile", "track"]
}
