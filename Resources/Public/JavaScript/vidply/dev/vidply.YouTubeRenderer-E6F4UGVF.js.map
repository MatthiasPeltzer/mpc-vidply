{
  "version": 3,
  "sources": ["../../src/renderers/YouTubeRenderer.js"],
  "sourcesContent": ["/**\r\n * YouTube Renderer\r\n */\r\n\r\nexport class YouTubeRenderer {\r\n  constructor(player) {\r\n    this.player = player;\r\n    this.youtube = null;\r\n    this.videoId = null;\r\n    this.isReady = false;\r\n    this.iframe = null;\r\n  }\r\n\r\n  async init() {\r\n    // Extract video ID from URL - use currentSource which works for external renderers\r\n    const src = this.player.currentSource || this.player.element.src;\r\n    this.videoId = this.extractVideoId(src);\r\n    \r\n    if (!this.videoId) {\r\n      throw new Error('Invalid YouTube URL');\r\n    }\r\n\r\n    // Load YouTube IFrame API\r\n    await this.loadYouTubeAPI();\r\n\r\n    // Create iframe\r\n    this.createIframe();\r\n\r\n    // Initialize player\r\n    await this.initializePlayer();\r\n  }\r\n\r\n  extractVideoId(url) {\r\n    const patterns = [\r\n      /(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([^&\\s]+)/,\r\n      /youtube\\.com\\/embed\\/([^&\\s]+)/\r\n    ];\r\n\r\n    for (const pattern of patterns) {\r\n      const match = url.match(pattern);\r\n      if (match && match[1]) {\r\n        return match[1];\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  async loadYouTubeAPI() {\r\n    // Check if API is already loaded\r\n    if (window.YT && window.YT.Player) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      // Check if script is already being loaded\r\n      if (window.onYouTubeIframeAPIReady) {\r\n        const originalCallback = window.onYouTubeIframeAPIReady;\r\n        window.onYouTubeIframeAPIReady = () => {\r\n          originalCallback();\r\n          resolve();\r\n        };\r\n        return;\r\n      }\r\n\r\n      // Load the API script\r\n      const tag = document.createElement('script');\r\n      tag.src = 'https://www.youtube.com/iframe_api';\r\n      \r\n      window.onYouTubeIframeAPIReady = () => {\r\n        resolve();\r\n      };\r\n\r\n      tag.onerror = () => reject(new Error('Failed to load YouTube API'));\r\n      \r\n      const firstScriptTag = document.getElementsByTagName('script')[0];\r\n      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\r\n    });\r\n  }\r\n\r\n  createIframe() {\r\n    // Hide original element\r\n    this.player.element.style.display = 'none';\r\n\r\n    // Create container for iframe\r\n    this.iframe = document.createElement('div');\r\n    this.iframe.id = `youtube-player-${Math.random().toString(36).substr(2, 9)}`;\r\n    this.iframe.style.width = '100%';\r\n    this.iframe.style.maxHeight = '100%';\r\n    \r\n    this.player.element.parentNode.insertBefore(this.iframe, this.player.element);\r\n  }\r\n\r\n  async initializePlayer() {\r\n    return new Promise((resolve) => {\r\n      this.youtube = new window.YT.Player(this.iframe.id, {\r\n        videoId: this.videoId,\r\n        width: '100%',\r\n        height: '100%',\r\n        playerVars: {\r\n          controls: 1, // Use YouTube native controls\r\n          disablekb: 0, // Allow keyboard controls\r\n          fs: 1, // Allow fullscreen\r\n          modestbranding: 1,\r\n          rel: 0,\r\n          showinfo: 0,\r\n          iv_load_policy: 3,\r\n          autoplay: this.player.options.autoplay ? 1 : 0,\r\n          mute: this.player.options.muted ? 1 : 0,\r\n          start: this.player.options.startTime || 0\r\n        },\r\n        events: {\r\n          onReady: (event) => {\r\n            this.isReady = true;\r\n            this.attachEvents();\r\n            // Hide VidPly controls - YouTube has its own\r\n            if (this.player.container) {\r\n              this.player.container.classList.add('vidply-external-controls');\r\n            }\r\n            resolve();\r\n          },\r\n          onStateChange: (event) => this.handleStateChange(event),\r\n          onError: (event) => this.handleError(event)\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  attachEvents() {\r\n    // Set up polling for time updates (YouTube doesn't provide timeupdate events)\r\n    this.timeUpdateInterval = setInterval(() => {\r\n      if (this.isReady && this.youtube) {\r\n        const currentTime = this.youtube.getCurrentTime();\r\n        const duration = this.youtube.getDuration();\r\n        \r\n        this.player.state.currentTime = currentTime;\r\n        this.player.state.duration = duration;\r\n        \r\n        this.player.emit('timeupdate', currentTime);\r\n      }\r\n    }, 250);\r\n\r\n    // Initial metadata\r\n    if (this.youtube.getDuration) {\r\n      this.player.state.duration = this.youtube.getDuration();\r\n      this.player.emit('loadedmetadata');\r\n    }\r\n  }\r\n\r\n  handleStateChange(event) {\r\n    const states = window.YT.PlayerState;\r\n\r\n    switch (event.data) {\r\n      case states.PLAYING:\r\n        this.player.state.playing = true;\r\n        this.player.state.paused = false;\r\n        this.player.state.ended = false;\r\n        this.player.state.buffering = false;\r\n        this.player.emit('play');\r\n        this.player.emit('playing');\r\n        \r\n        if (this.player.options.onPlay) {\r\n          this.player.options.onPlay.call(this.player);\r\n        }\r\n        break;\r\n\r\n      case states.PAUSED:\r\n        this.player.state.playing = false;\r\n        this.player.state.paused = true;\r\n        this.player.emit('pause');\r\n        \r\n        if (this.player.options.onPause) {\r\n          this.player.options.onPause.call(this.player);\r\n        }\r\n        break;\r\n\r\n      case states.ENDED:\r\n        this.player.state.playing = false;\r\n        this.player.state.paused = true;\r\n        this.player.state.ended = true;\r\n        this.player.emit('ended');\r\n        \r\n        if (this.player.options.onEnded) {\r\n          this.player.options.onEnded.call(this.player);\r\n        }\r\n        \r\n        if (this.player.options.loop) {\r\n          this.youtube.seekTo(0);\r\n          this.youtube.playVideo();\r\n        }\r\n        break;\r\n\r\n      case states.BUFFERING:\r\n        this.player.state.buffering = true;\r\n        this.player.emit('waiting');\r\n        break;\r\n\r\n      case states.CUED:\r\n        this.player.emit('loadedmetadata');\r\n        break;\r\n    }\r\n  }\r\n\r\n  handleError(event) {\r\n    const errors = {\r\n      2: 'Invalid video ID',\r\n      5: 'HTML5 player error',\r\n      100: 'Video not found',\r\n      101: 'Video not allowed to be played in embedded players',\r\n      150: 'Video not allowed to be played in embedded players'\r\n    };\r\n\r\n    const error = new Error(errors[event.data] || 'YouTube player error');\r\n    this.player.handleError(error);\r\n  }\r\n\r\n  play() {\r\n    if (this.isReady && this.youtube) {\r\n      // Save scroll position to prevent browser from scrolling to video\r\n      const scrollX = window.scrollX;\r\n      const scrollY = window.scrollY;\r\n      \r\n      this.youtube.playVideo();\r\n      \r\n      // Restore scroll position immediately to prevent auto-scroll\r\n      window.scrollTo(scrollX, scrollY);\r\n    }\r\n  }\r\n\r\n  pause() {\r\n    if (this.isReady && this.youtube) {\r\n      this.youtube.pauseVideo();\r\n    }\r\n  }\r\n\r\n  seek(time) {\r\n    if (this.isReady && this.youtube) {\r\n      this.youtube.seekTo(time, true);\r\n    }\r\n  }\r\n\r\n  setVolume(volume) {\r\n    if (this.isReady && this.youtube) {\r\n      this.youtube.setVolume(volume * 100);\r\n      this.player.state.volume = volume;\r\n    }\r\n  }\r\n\r\n  setMuted(muted) {\r\n    if (this.isReady && this.youtube) {\r\n      if (muted) {\r\n        this.youtube.mute();\r\n      } else {\r\n        this.youtube.unMute();\r\n      }\r\n      this.player.state.muted = muted;\r\n    }\r\n  }\r\n\r\n  setPlaybackSpeed(speed) {\r\n    if (this.isReady && this.youtube) {\r\n      this.youtube.setPlaybackRate(speed);\r\n      this.player.state.playbackSpeed = speed;\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    if (this.timeUpdateInterval) {\r\n      clearInterval(this.timeUpdateInterval);\r\n    }\r\n\r\n    if (this.youtube && this.youtube.destroy) {\r\n      this.youtube.destroy();\r\n    }\r\n\r\n    if (this.iframe && this.iframe.parentNode) {\r\n      this.iframe.parentNode.removeChild(this.iframe);\r\n    }\r\n\r\n    // Show original element\r\n    if (this.player.element) {\r\n      this.player.element.style.display = '';\r\n    }\r\n  }\r\n}\r\n\r\n"],
  "mappings": "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",
  "names": []
}
