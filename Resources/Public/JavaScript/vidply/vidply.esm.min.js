/*!
 * Universal, Accessible Video Player
 * (c) 2025 Matthias Peltzer
 * Released under GPL-2.0-or-later License
 */
import{a as re}from"./vidply.chunk-34RH2THY.min.js";import{a as p,b as y,c as x,d as T,e as ae,f as ie,g as ne,h as W,i as K,j as O,k as V,l as R,m as U,n as Q}from"./vidply.chunk-LGTJRPUL.min.js";var X=class{constructor(){this.events={}}on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),this}once(e,t){let i=(...s)=>{t(...s),this.off(e,i)};return this.on(e,i)}off(e,t){return this.events[e]?(t?this.events[e]=this.events[e].filter(i=>i!==t):delete this.events[e],this):this}emit(e,...t){return this.events[e]?(this.events[e].forEach(i=>{i(...t)}),this):this}removeAllListeners(){return this.events={},this}};function j(L,e=100){let t;return function(...s){let a=()=>{clearTimeout(t),L(...s)};clearTimeout(t),t=setTimeout(a,e)}}function N(L=768){return window.innerWidth<L}function _(L,e=100){let t=!1,i=()=>{t||(t=!0,L())};requestAnimationFrame(i),setTimeout(i,e)}async function J(L,e,t={}){if(!L||L.tagName!=="VIDEO")return null;let{restoreState:i=!0,quality:s=.9,maxWidth:a,maxHeight:n}=t,c=!L.paused,u=L.currentTime,o=L.muted;return i&&(L.muted=!0),new Promise(r=>{let l=()=>{try{let h=L.videoWidth||640,f=L.videoHeight||360;if(a&&h>a){let b=a/h;h=a,f=Math.round(f*b)}if(n&&f>n){let b=n/f;f=n,h=Math.round(h*b)}let v=document.createElement("canvas");v.width=h,v.height=f,v.getContext("2d").drawImage(L,0,0,h,f);let M=v.toDataURL("image/jpeg",s);i&&(L.currentTime=u,L.muted=o,c&&!L.paused&&L.play().catch(()=>{})),r(M)}catch{i&&(L.currentTime=u,L.muted=o,c&&!L.paused&&L.play().catch(()=>{})),r(null)}},g=()=>{L.removeEventListener("seeked",g),requestAnimationFrame(()=>{requestAnimationFrame(l)})};if(Math.abs(L.currentTime-e)<.1&&L.readyState>=2)l();else if(L.readyState>=1)L.addEventListener("seeked",g),L.currentTime=e;else{let h=()=>{L.removeEventListener("loadedmetadata",h),L.addEventListener("seeked",g),L.currentTime=e};L.addEventListener("loadedmetadata",h)}})}var Y=class{constructor(e){this.player=e,this.element=null,this.controls={},this.hideTimeout=null,this.isDraggingProgress=!1,this.isDraggingVolume=!1,this.openMenu=null,this.openMenuButton=null,this.init()}init(){this.createElement(),this.createControls(),this.attachEvents(),this.setupAutoHide(),this.setupOverflowDetection()}isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}positionMenu(e,t,i=!1){let s=N(),a=e.classList.contains(`${this.player.options.classPrefix}-overflow-menu-list`);if(this.player.state.fullscreen&&e.parentElement===this.player.container){let u=()=>{let o=t.getBoundingClientRect(),r=e.getBoundingClientRect(),l=this.player.container.getBoundingClientRect(),g=window.innerHeight,d=o.left+o.width/2-l.left,h=o.top-l.top,f=o.bottom-l.top,v=o.top-l.top,m=l.bottom-o.bottom;if(v>=r.height+20||v>m?(e.style.bottom=`${l.height-h+8}px`,e.style.top="auto",e.classList.remove("vidply-menu-below")):(e.style.top=`${f+8}px`,e.style.bottom="auto",e.classList.add("vidply-menu-below")),a){let M=o.right-l.left;e.style.right=`${l.width-M}px`,e.style.left="auto",e.style.transform="none"}else e.style.left=`${d}px`,e.style.right="auto",e.style.transform="translateX(-50%)"};i?u():requestAnimationFrame(u);return}if(s){let u=e.classList.contains(`${this.player.options.classPrefix}-volume-menu`),o=()=>{let r=t.parentElement;if(!r)return;let l=t.getBoundingClientRect(),g=r.getBoundingClientRect(),d=e.getBoundingClientRect(),h=window.innerWidth,f=window.innerHeight;if(u){let v=l.left+l.width/2-g.left;e.style.left=`${v}px`,e.style.right="auto",e.style.transform="translateX(-50%)";return}d.right>h&&(e.style.left="auto",e.style.right="10px",e.style.transform="none"),d.left<0&&(e.style.left="10px",e.style.right="auto",e.style.transform="none"),d.top<10&&(e.style.top="10px"),d.bottom>f-10&&(e.style.bottom="10px",e.style.top="auto")};i?o():requestAnimationFrame(o);return}let c=()=>{let u=t.getBoundingClientRect(),o=e.getBoundingClientRect(),r=window.innerWidth,l=window.innerHeight,g=t.parentElement;if(!g)return;let d=g.getBoundingClientRect(),h=u.left+u.width/2-d.left,f=u.bottom-d.top,v=u.top-d.top,m=u.top,M=l-u.bottom,b=v-o.height-8,w=null;m<o.height+20&&M>m?(b=null,w=d.bottom-d.top-f+8,e.classList.add("vidply-menu-below")):e.classList.remove("vidply-menu-below");let E="auto",S="auto",k="translateX(0)";if(a)E="auto",S=0,k="translateX(0)";else{E=h-o.width/2;let C=u.left+u.width/2-o.width/2;C<10?(E=0,k="translateX(0)"):C+o.width>r-10?(E="auto",S=0,k="translateX(0)"):(E=h,k="translateX(-50%)")}b!==null?(e.style.top=`${b}px`,e.style.bottom="auto"):w!==null&&(e.style.top="auto",e.style.bottom=`${w}px`),E!=="auto"?(e.style.left=`${E}px`,e.style.right="auto"):(e.style.left="auto",e.style.right=`${S}px`),e.style.transform=k};i?c():requestAnimationFrame(()=>{setTimeout(c,10)})}insertMenuIntoDOM(e,t){e.id||(e.id=`vidply-menu-${Math.random().toString(36).substr(2,9)}`),t.setAttribute("aria-controls",e.id),t.setAttribute("aria-haspopup","true"),this.player.state.fullscreen?(this.player.container.appendChild(e),e.dataset.triggerButton=t.getAttribute("aria-label")||"button"):t.insertAdjacentElement("afterend",e)}attachMenuCloseHandler(e,t,i=!1){this.openMenu&&this.openMenu!==e&&this.openMenuButton&&(this.openMenuButton._vidplyBlurHandler&&(this.openMenuButton.removeEventListener("blur",this.openMenuButton._vidplyBlurHandler),delete this.openMenuButton._vidplyBlurHandler),this.openMenuButton._vidplyMousedownHandler&&(this.openMenuButton.removeEventListener("mousedown",this.openMenuButton._vidplyMousedownHandler),delete this.openMenuButton._vidplyMousedownHandler),this.openMenu&&document.contains(this.openMenu)?this.openMenu.remove():this.openMenu&&this.openMenu.parentNode&&this.openMenu.parentNode.removeChild(this.openMenu),this.openMenuButton&&this.openMenuButton.setAttribute("aria-expanded","false")),this.openMenu=e,this.openMenuButton=t,this.positionMenu(e,t),t&&t.setAttribute("aria-expanded","true");let s=!1,a=!0,n=()=>{s=!0,a=!1,setTimeout(()=>{s=!1,a=!0},200)};t.addEventListener("mousedown",n),t._vidplyMousedownHandler=n;let c=l=>{if(!a||s||this.openMenu!==e)return;let g=l.relatedTarget;requestAnimationFrame(()=>{setTimeout(()=>{if(!a||this.openMenu!==e)return;let d=document.activeElement;if(e.contains(d))return;let h=this.player.signLanguageWrapper,f=this.player.transcriptManager?.transcriptWindow;if(h&&h.contains(d)||f&&f.contains(d))return;let v=this.element.querySelectorAll("button"),m=Array.from(v).includes(d)&&d!==t,M=g&&Array.from(v).includes(g)&&g!==t;if(m||M){if(this.openMenu!==e)return;e&&document.contains(e)?e.remove():e&&e.parentNode&&e.parentNode.removeChild(e),t&&t.setAttribute("aria-expanded","false"),this.openMenu===e&&(this.openMenu=null,this.openMenuButton=null),t.removeEventListener("blur",c),t.removeEventListener("mousedown",n),delete t._vidplyBlurHandler,delete t._vidplyMousedownHandler}},10)})};t.addEventListener("blur",c),t._vidplyBlurHandler=c;let u=()=>{this.closeMenuAndReturnFocus(e,t)},o=null,r=null;setTimeout(()=>{o=l=>{i&&e.contains(l.target)||this.openMenu===e&&!e.contains(l.target)&&!t.contains(l.target)&&(u(),o&&document.removeEventListener("click",o),r&&document.removeEventListener("keydown",r))},r=l=>{l.key==="Escape"&&this.openMenu===e&&(l.preventDefault(),l.stopPropagation(),this.closeMenuAndReturnFocus(e,t,!0),o&&document.removeEventListener("click",o),r&&document.removeEventListener("keydown",r))},document.addEventListener("click",o),document.addEventListener("keydown",r)},100)}closeMenuAndReturnFocus(e,t,i=!0){e&&(document.contains(e)?e.remove():e.parentNode&&e.parentNode.removeChild(e)),t&&(t.setAttribute("aria-expanded","false"),e&&e.id&&t.removeAttribute("aria-controls"),i&&requestAnimationFrame(()=>{setTimeout(()=>{t&&document.contains(t)&&t.focus({preventScroll:!0})},0)})),this.openMenu===e&&(this.openMenu=null,this.openMenuButton=null)}closeOpenMenu(){this.openMenu&&this.openMenuButton&&(this.openMenu&&document.contains(this.openMenu)?this.openMenu.remove():this.openMenu&&this.openMenu.parentNode&&this.openMenu.parentNode.removeChild(this.openMenu),this.openMenuButton&&this.openMenuButton.setAttribute("aria-expanded","false"),this.openMenu=null,this.openMenuButton=null)}attachMenuKeyboardNavigation(e,t){let i=Array.from(e.querySelectorAll(`.${this.player.options.classPrefix}-menu-item`));if(i.length===0)return;let s=a=>{let n=i.indexOf(document.activeElement);switch(a.key){case"ArrowDown":a.preventDefault(),a.stopPropagation();let c=(n+1)%i.length;i[c].focus({preventScroll:!1}),i[c].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"ArrowUp":a.preventDefault(),a.stopPropagation();let u=(n-1+i.length)%i.length;i[u].focus({preventScroll:!1}),i[u].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"ArrowLeft":case"ArrowRight":a.preventDefault(),a.stopPropagation();break;case"Home":a.preventDefault(),a.stopPropagation(),i[0].focus({preventScroll:!1}),i[0].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"End":a.preventDefault(),a.stopPropagation(),i[i.length-1].focus({preventScroll:!1}),i[i.length-1].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"Enter":case" ":a.preventDefault(),a.stopPropagation(),document.activeElement&&i.includes(document.activeElement)&&(document.activeElement.click(),ie(t,{delay:0}));break;case"Escape":a.preventDefault(),a.stopPropagation(),this.closeMenuAndReturnFocus(e,t,!0);break}};e.addEventListener("keydown",s)}createElement(){this.element=p.createElement("div",{className:`${this.player.options.classPrefix}-controls`,attributes:{role:"region","aria-label":y.t("player.label")+" controls"}})}createControls(){let e=p.createElement("div",{className:`${this.player.options.classPrefix}-progress-time-wrapper`});this.player.options.progressBar&&(this.createProgressBar(),e.appendChild(this.controls.progress)),(this.player.options.currentTime||this.player.options.duration)&&e.appendChild(this.createTimeDisplay()),this.element.appendChild(e);let t=p.createElement("div",{className:`${this.player.options.classPrefix}-controls-buttons`}),i=p.createElement("div",{className:`${this.player.options.classPrefix}-controls-left`});this.player.playlistManager&&i.appendChild(this.createPreviousButton()),this.player.options.playPauseButton&&i.appendChild(this.createPlayPauseButton()),i.appendChild(this.createRestartButton()),this.player.playlistManager&&i.appendChild(this.createNextButton()),this.player.playlistManager||i.appendChild(this.createRewindButton()),this.player.playlistManager||i.appendChild(this.createForwardButton()),this.player.options.volumeControl&&(this.isTouchDevice()?i.appendChild(this.createMuteButton()):i.appendChild(this.createVolumeControl())),this.rightButtons=p.createElement("div",{className:`${this.player.options.classPrefix}-controls-right`});let s=this.hasChapterTracks(),a=this.hasCaptionTracks(),n=this.hasQualityLevels(),c=this.hasAudioDescription();if(this.player.options.chaptersButton&&s){let h=this.createChaptersButton();h.dataset.overflowPriority="3",h.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(h)}if(this.player.options.captionsButton&&a){let h=this.createCaptionsButton();h.dataset.overflowPriority="1",h.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(h)}if(this.player.options.captionStyleButton&&a){let h=this.createCaptionStyleButton();h.dataset.overflowPriority="3",h.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(h)}let u=this.player.currentSource||this.player.element?.getAttribute?.("src")||this.player.element?.currentSrc||this.player.element?.src||this.player.element?.querySelector?.("source")?.getAttribute?.("src")||this.player.element?.querySelector?.("source")?.src||"",o=typeof u=="string"&&u.includes(".m3u8"),r=this.player.element?.tagName?.toLowerCase()==="video",l=!!this.player.options.hideSpeedForHls&&o||!!this.player.options.hideSpeedForHlsVideo&&o&&r;if(this.player.options.speedButton&&!l){let h=this.createSpeedButton();h.dataset.overflowPriority="1",h.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(h)}if(this.player.options.audioDescriptionButton&&c){let h=this.createAudioDescriptionButton();h.dataset.overflowPriority="2",h.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(h)}if(this.player.options.transcriptButton&&a){let h=this.createTranscriptButton();h.dataset.overflowPriority="3",h.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(h)}if(this.player.playlistManager&&this.player.options.playlistToggleButton!==!1){let h=this.createPlaylistToggleButton();h.dataset.overflowPriority="2",h.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(h)}let g=this.hasSignLanguage();if(this.player.options.signLanguageButton&&g){let h=this.createSignLanguageButton();h.dataset.overflowPriority="3",h.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(h)}if(this.player.options.qualityButton&&n){let h=this.createQualityButton();h.dataset.overflowPriority="2",h.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(h)}if(this.player.options.pipButton&&"pictureInPictureEnabled"in document){let h=this.createPipButton();h.dataset.overflowPriority="3",h.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(h)}let d=this.player.element.tagName.toLowerCase()==="audio";if(this.player.options.fullscreenButton&&!d){let h=this.createFullscreenButton();h.dataset.overflowPriority="1",h.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(h)}this.overflowMenuButton=this.createOverflowMenuButton(),this.overflowMenuButton.style.display="none",this.rightButtons.appendChild(this.overflowMenuButton),t.appendChild(i),t.appendChild(this.rightButtons),this.element.appendChild(t),this.ensureButtonTooltips(t)}ensureButtonTooltips(e){e.querySelectorAll("button").forEach(i=>{if(i.querySelector(`.${this.player.options.classPrefix}-tooltip`)||i.querySelector(`.${this.player.options.classPrefix}-button-text`)||i.getAttribute("role")==="menuitem"||i.classList.contains(`${this.player.options.classPrefix}-settings-item`)||i.classList.contains(`${this.player.options.classPrefix}-menu-item`)||i.classList.contains(`${this.player.options.classPrefix}-transcript-settings-item`)||i.classList.contains(`${this.player.options.classPrefix}-sign-language-settings-item`)||i.classList.contains(`${this.player.options.classPrefix}-popup-settings-item`))return;let s=i.getAttribute("aria-label");s&&p.attachTooltip(i,s,this.player.options.classPrefix)})}hasChapterTracks(){let e=this.player.element.textTracks;for(let t=0;t<e.length;t++)if(e[t].kind==="chapters")return!0;return!1}hasCaptionTracks(){let e=this.player.element.textTracks;for(let t=0;t<e.length;t++)if(e[t].kind==="captions"||e[t].kind==="subtitles")return!0;return!1}hasQualityLevels(){if(this.player.renderer&&this.player.renderer.getQualities){let e=this.player.renderer.getQualities();return e&&e.length>1}return!1}hasAudioDescription(){return this.player.audioDescriptionSrc&&this.player.audioDescriptionSrc.length>0?!0:Array.from(this.player.element.textTracks||[]).some(t=>t.kind==="descriptions")}hasSignLanguage(){let e=this.player.signLanguageSrc&&this.player.signLanguageSrc.length>0,t=this.player.signLanguageSources&&Object.keys(this.player.signLanguageSources).length>0;return e||t}createProgressBar(){let e=p.createElement("div",{className:`${this.player.options.classPrefix}-progress-container`,attributes:{role:"slider","aria-label":y.t("player.progress"),"aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":"0",tabindex:"0"}});this.controls.buffered=p.createElement("div",{className:`${this.player.options.classPrefix}-progress-buffered`}),this.controls.played=p.createElement("div",{className:`${this.player.options.classPrefix}-progress-played`}),this.controls.progressHandle=p.createElement("div",{className:`${this.player.options.classPrefix}-progress-handle`}),this.controls.progressTooltip=p.createElement("div",{className:`${this.player.options.classPrefix}-progress-tooltip`}),this.controls.progressPreview=p.createElement("div",{className:`${this.player.options.classPrefix}-progress-preview`,attributes:{"aria-hidden":"true"}}),this.controls.progressTooltip.appendChild(this.controls.progressPreview),this.controls.progressTooltipTime=p.createElement("div",{className:`${this.player.options.classPrefix}-progress-tooltip-time`}),this.controls.progressTooltip.appendChild(this.controls.progressTooltipTime),e.appendChild(this.controls.buffered),e.appendChild(this.controls.played),this.controls.played.appendChild(this.controls.progressHandle),e.appendChild(this.controls.progressTooltip),this.controls.progress=e,this.initPreviewThumbnail(),this.setupProgressBarEvents()}initPreviewThumbnail(){if(this.previewThumbnailCache=new Map,this.previewVideo=null,this.currentPreviewTime=null,this.previewThumbnailTimeout=null,this.previewSupported=!1,!(this.player.element&&this.player.element.tagName==="VIDEO"))return;let t=this.player.renderer,i=t&&t.media&&t.media.tagName==="VIDEO",s=i&&t.media===this.player.element&&!t.hls&&typeof t.seek=="function";if(this.previewSupported=s&&i,this.previewSupported){this.previewVideo=document.createElement("video"),this.previewVideo.muted=!0,this.previewVideo.preload="auto",this.previewVideo.playsInline=!0,this.previewVideo.style.position="absolute",this.previewVideo.style.visibility="hidden",this.previewVideo.style.width="1px",this.previewVideo.style.height="1px",this.previewVideo.style.top="-9999px";let a=t.media||this.player.element,n=null;if(a.src)n=a.src;else{let c=a.querySelector("source");c&&(n=c.src)}if(!n){this.player.log("No video source found for preview","warn"),this.previewSupported=!1;return}a.crossOrigin&&(this.previewVideo.crossOrigin=a.crossOrigin),this.previewVideo.addEventListener("error",c=>{this.player.log("Preview video failed to load:",c,"warn"),this.previewSupported=!1}),this.previewVideo.addEventListener("loadedmetadata",()=>{this.previewVideoReady=!0},{once:!0}),this.player.container&&this.player.container.appendChild(this.previewVideo),this.previewVideo.src=n,this.previewVideoReady=!1}}async generatePreviewThumbnail(e){if(!this.previewSupported||!this.previewVideo)return null;this.previewVideoReady||(this.previewVideo.readyState<2?await new Promise((s,a)=>{let n=setTimeout(()=>{a(new Error("Preview video data load timeout"))},1e4),c=()=>{clearTimeout(n),this.previewVideo.removeEventListener("loadeddata",u),this.previewVideo.removeEventListener("canplay",u),this.previewVideo.removeEventListener("error",o)},u=()=>{this.previewVideo.readyState>=2&&(c(),this.previewVideoReady=!0,s())},o=()=>{c(),a(new Error("Preview video failed to load"))};this.previewVideo.readyState>=1&&this.previewVideo.addEventListener("loadeddata",u),this.previewVideo.addEventListener("canplay",u),this.previewVideo.addEventListener("error",o),this.previewVideo.readyState>=2&&u()}).catch(()=>(this.previewSupported=!1,null)):this.previewVideoReady=!0);let t=Math.floor(e);if(this.previewThumbnailCache.has(t))return this.previewThumbnailCache.get(t);let i=await J(this.previewVideo,e,{restoreState:!1,quality:.8,maxWidth:160,maxHeight:90});if(i){if(this.previewThumbnailCache.size>=20){let s=this.previewThumbnailCache.keys().next().value;this.previewThumbnailCache.delete(s)}this.previewThumbnailCache.set(t,i)}return i}async updatePreviewThumbnail(e){!this.previewSupported||!this.controls.progressPreview||(this.previewThumbnailTimeout&&clearTimeout(this.previewThumbnailTimeout),this.previewThumbnailTimeout=setTimeout(async()=>{try{let t=await this.generatePreviewThumbnail(e);t&&this.controls.progressPreview?(this.controls.progressPreview.style.backgroundImage=`url("${t}")`,this.controls.progressPreview.style.display="block",this.controls.progressPreview.style.backgroundRepeat="no-repeat",this.controls.progressPreview.style.backgroundPosition="center"):this.controls.progressPreview&&(this.controls.progressPreview.style.display="none"),this.currentPreviewTime=e}catch(t){this.player.log("Preview thumbnail update failed:",t,"warn"),this.controls.progressPreview&&(this.controls.progressPreview.style.display="none")}},100))}setupProgressBarEvents(){let e=this.controls.progress,t=i=>{let s=e.getBoundingClientRect(),a=s.width>0?Math.max(0,Math.min(1,(i-s.left)/s.width)):0,n=this.player.state.duration||0,c=a*n;return{percent:a,time:c}};e.addEventListener("mousedown",i=>{this.isDraggingProgress=!0;let{time:s}=t(i.clientX);this.player.seek(s)}),document.addEventListener("mousemove",i=>{if(this.isDraggingProgress){let{time:s}=t(i.clientX);this.player.seek(s)}}),document.addEventListener("mouseup",()=>{this.isDraggingProgress=!1}),e.addEventListener("mousemove",i=>{if(!this.isDraggingProgress){let{time:s}=t(i.clientX),a=e.getBoundingClientRect(),n=i.clientX-a.left;this.controls.progressTooltipTime.textContent=x.formatTime(s),this.controls.progressTooltip.style.left=`${n}px`,this.controls.progressTooltip.style.display="block",this.previewSupported&&this.updatePreviewThumbnail(s)}}),e.addEventListener("mouseleave",()=>{this.controls.progressTooltip.style.display="none",this.previewThumbnailTimeout&&clearTimeout(this.previewThumbnailTimeout)}),e.addEventListener("keydown",i=>{i.key==="ArrowLeft"?(i.preventDefault(),this.player.seekBackward(5)):i.key==="ArrowRight"&&(i.preventDefault(),this.player.seekForward(5))}),e.addEventListener("touchstart",i=>{this.isDraggingProgress=!0;let s=i.touches[0],{time:a}=t(s.clientX);this.player.seek(a)}),e.addEventListener("touchmove",i=>{if(this.isDraggingProgress){i.preventDefault();let s=i.touches[0],{time:a}=t(s.clientX);this.player.seek(a)}}),e.addEventListener("touchend",()=>{this.isDraggingProgress=!1})}createPlayPauseButton(){let e=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-play-pause`,attributes:{type:"button","aria-label":y.t("player.play")}});return e.appendChild(T("play")),e.addEventListener("click",()=>{this.player.toggle()}),this.controls.playPause=e,e}createRestartButton(){let e=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-restart`,attributes:{type:"button","aria-label":y.t("player.restart")}});return e.appendChild(T("restart")),e.addEventListener("click",()=>{this.player.seek(0),this.player.play()}),e}createPreviousButton(){let e=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-previous`,attributes:{type:"button","aria-label":y.t("player.previous")}});e.appendChild(T("skipPrevious")),e.addEventListener("click",()=>{this.player.playlistManager&&this.player.playlistManager.previous()});let t=()=>{this.player.playlistManager&&(e.disabled=!this.player.playlistManager.hasPrevious()&&!this.player.playlistManager.options.loop)};return this.player.on("playlisttrackchange",t),t(),this.controls.previous=e,e}createNextButton(){let e=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-next`,attributes:{type:"button","aria-label":y.t("player.next")}});e.appendChild(T("skipNext")),e.addEventListener("click",()=>{this.player.playlistManager&&this.player.playlistManager.next()});let t=()=>{this.player.playlistManager&&(e.disabled=!this.player.playlistManager.hasNext()&&!this.player.playlistManager.options.loop)};return this.player.on("playlisttrackchange",t),t(),this.controls.next=e,e}createPlaylistToggleButton(){let e=this.player.playlistManager?`${this.player.playlistManager.uniqueId}-panel`:"vidply-playlist-panel",t=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-playlist-toggle`,attributes:{type:"button","aria-label":y.t("player.playlist"),"aria-expanded":"false","aria-pressed":"false","aria-controls":e}});return t.appendChild(T("playlist")),t.addEventListener("click",()=>{this.player.playlistManager&&this.player.playlistManager.togglePanel()}),this.controls.playlistToggle=t,t}createRewindButton(){let e=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-rewind`,attributes:{type:"button","aria-label":y.t("player.rewindSeconds",{seconds:15})}});return e.appendChild(T("rewind")),e.addEventListener("click",()=>{this.player.seekBackward(15)}),e}createForwardButton(){let e=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-forward`,attributes:{type:"button","aria-label":y.t("player.forwardSeconds",{seconds:15})}});return e.appendChild(T("forward")),e.addEventListener("click",()=>{this.player.seekForward(15)}),e}createMuteButton(){let e=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-mute`,attributes:{type:"button","aria-label":y.t("player.mute")}});return e.appendChild(T("volumeHigh")),e.addEventListener("click",()=>{this.player.toggleMute()}),this.controls.mute=e,e}createVolumeControl(){let e=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-mute`,attributes:{type:"button","aria-label":y.t("player.volume"),"aria-expanded":"false"}});return e.appendChild(T("volumeHigh")),e.addEventListener("contextmenu",t=>{t.preventDefault(),this.player.toggleMute()}),e.addEventListener("click",()=>{this.showVolumeSlider(e)}),this.controls.mute=e,e}showVolumeSlider(e){let t=document.querySelector(`.${this.player.options.classPrefix}-volume-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false");return}let i=p.createElement("div",{className:`${this.player.options.classPrefix}-volume-menu ${this.player.options.classPrefix}-menu`}),s=p.createElement("div",{className:`${this.player.options.classPrefix}-volume-slider`,attributes:{role:"slider","aria-label":y.t("player.volume"),"aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":String(Math.round(this.player.state.volume*100)),tabindex:"0"}}),a=p.createElement("div",{className:`${this.player.options.classPrefix}-volume-track`}),n=p.createElement("div",{className:`${this.player.options.classPrefix}-volume-fill`}),c=this.player.state.volume*100;n.style.height=`${c}%`;let u=p.createElement("div",{className:`${this.player.options.classPrefix}-volume-handle`});a.appendChild(n),n.appendChild(u),s.appendChild(a),i.appendChild(s);let o=r=>{let l=a.getBoundingClientRect(),g=Math.max(0,Math.min(1,1-(r-l.top)/l.height));this.player.setVolume(g)};s.addEventListener("mousedown",r=>{r.stopPropagation(),r.preventDefault(),this.isDraggingVolume=!0,o(r.clientY)}),document.addEventListener("mousemove",r=>{this.isDraggingVolume&&o(r.clientY)}),document.addEventListener("mouseup",()=>{this.isDraggingVolume=!1}),s.addEventListener("touchstart",r=>{r.stopPropagation(),r.preventDefault(),this.isDraggingVolume=!0;let l=r.touches[0];o(l.clientY)},{passive:!1}),s.addEventListener("touchmove",r=>{if(this.isDraggingVolume){r.preventDefault();let l=r.touches[0];o(l.clientY)}},{passive:!1}),s.addEventListener("touchend",r=>{r.stopPropagation(),r.preventDefault(),this.isDraggingVolume=!1},{passive:!1}),s.addEventListener("touchcancel",()=>{this.isDraggingVolume=!1}),s.addEventListener("keydown",r=>{r.key==="ArrowUp"?(r.preventDefault(),this.player.setVolume(Math.min(1,this.player.state.volume+.1))):r.key==="ArrowDown"?(r.preventDefault(),this.player.setVolume(Math.max(0,this.player.state.volume-.1))):r.key==="Escape"&&(r.preventDefault(),r.stopPropagation(),this.closeMenuAndReturnFocus(i,e,!0))}),i.addEventListener("click",r=>{r.stopPropagation()}),i.addEventListener("touchstart",r=>{r.stopPropagation()}),i.addEventListener("touchmove",r=>{r.stopPropagation()}),i.addEventListener("touchend",r=>{r.stopPropagation()}),i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.controls.volumeSlider=s,this.controls.volumeFill=n,ie(s,{delay:50}),this.attachMenuCloseHandler(i,e,!0)}createTimeDisplay(){let e=p.createElement("div",{className:`${this.player.options.classPrefix}-time`,attributes:{role:"group","aria-label":y.t("time.display")}});this.controls.currentTimeDisplay=p.createElement("span",{className:`${this.player.options.classPrefix}-current-time`});let t=p.createElement("span",{textContent:"00:00",attributes:{"aria-hidden":"true"}}),i=p.createElement("span",{className:"vidply-sr-only",textContent:y.t("time.seconds",{count:0})});this.controls.currentTimeDisplay.appendChild(t),this.controls.currentTimeDisplay.appendChild(i),this.controls.currentTimeVisual=t,this.controls.currentTimeAccessible=i;let s=p.createElement("span",{textContent:" / ",attributes:{"aria-hidden":"true"}});this.controls.durationDisplay=p.createElement("span",{className:`${this.player.options.classPrefix}-duration`});let a=p.createElement("span",{textContent:"00:00",attributes:{"aria-hidden":"true"}}),n=p.createElement("span",{className:"vidply-sr-only",textContent:y.t("time.durationPrefix")+y.t("time.seconds",{count:0})});return this.controls.durationDisplay.appendChild(a),this.controls.durationDisplay.appendChild(n),this.controls.durationVisual=a,this.controls.durationAccessible=n,e.appendChild(this.controls.currentTimeDisplay),e.appendChild(s),e.appendChild(this.controls.durationDisplay),e}createChaptersButton(){let e=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-chapters`,attributes:{type:"button","aria-label":y.t("player.chapters"),"aria-expanded":"false"}});return e.appendChild(T("chapters")),e.addEventListener("click",()=>{this.showChaptersMenu(e)}),this.controls.chapters=e,e}showChaptersMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-chapters-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=p.createElement("div",{className:`${this.player.options.classPrefix}-chapters-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu","aria-label":y.t("player.chapters")}}),s=Array.from(this.player.element.textTracks).filter(a=>a.kind==="chapters");if(s.length===0){let a=p.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:y.t("player.noChapters"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(a)}else{let a=s[0];if(a.mode==="disabled"&&(a.mode="hidden"),!a.cues||a.cues.length===0){let n=p.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:y.t("player.loadingChapters"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(n);let c=()=>{i.remove(),this.showChaptersMenu(e)};a.addEventListener("load",c,{once:!0}),setTimeout(()=>{a.cues&&a.cues.length>0&&document.contains(i)&&(i.remove(),this.showChaptersMenu(e))},500)}else{let n=a.cues;for(let c=0;c<n.length;c++){let u=n[c],o=p.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,attributes:{type:"button",role:"menuitem",tabindex:"-1"}}),r=p.createElement("span",{className:`${this.player.options.classPrefix}-chapter-time`,textContent:x.formatTime(u.startTime),attributes:{"aria-label":x.formatDuration(u.startTime)}}),l=p.createElement("span",{className:`${this.player.options.classPrefix}-chapter-title`,textContent:u.text});o.appendChild(r),o.appendChild(document.createTextNode(" ")),o.appendChild(l),o.addEventListener("click",()=>{this.player.seek(u.startTime),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(o)}this.attachMenuKeyboardNavigation(i,e),setTimeout(()=>{let c=i.querySelector(`.${this.player.options.classPrefix}-menu-item`);c&&c.focus({preventScroll:!0})},0)}}i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e)}createQualityButton(){let e=y.t("player.quality"),t=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-quality`,attributes:{type:"button","aria-label":e,"aria-expanded":"false"}});t.appendChild(T("hd")),p.attachTooltip(t,e,this.player.options.classPrefix);let i=p.createElement("span",{className:`${this.player.options.classPrefix}-quality-text`,textContent:""});return t.appendChild(i),t.addEventListener("click",()=>{this.showQualityMenu(t)}),this.controls.quality=t,this.controls.qualityText=i,setTimeout(()=>this.updateQualityIndicator(),500),t}showQualityMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-quality-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=p.createElement("div",{className:`${this.player.options.classPrefix}-quality-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu","aria-label":y.t("player.quality")}});if(this.player.renderer&&this.player.renderer.getQualities){let s=this.player.renderer.getQualities(),a=this.player.renderer.getCurrentQuality?this.player.renderer.getCurrentQuality():-1,n=this.player.renderer.hls!==void 0;if(s.length===0){let c=p.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:y.t("player.autoQuality"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(c)}else{let c=null;if(n){let u=p.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:y.t("player.auto"),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});this.player.renderer.hls&&this.player.renderer.hls.currentLevel===-1&&(u.classList.add(`${this.player.options.classPrefix}-menu-item-active`),u.appendChild(T("check")),c=u),u.addEventListener("click",()=>{this.player.renderer.switchQuality&&this.player.renderer.switchQuality(-1),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(u)}s.forEach(u=>{let o=p.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:u.name||`${u.height}p`,attributes:{type:"button",role:"menuitem",tabindex:"-1"}});u.index===a&&(o.classList.add(`${this.player.options.classPrefix}-menu-item-active`),o.appendChild(T("check")),c=o),o.addEventListener("click",()=>{this.player.renderer.switchQuality&&this.player.renderer.switchQuality(u.index),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(o)}),this.attachMenuKeyboardNavigation(i,e),setTimeout(()=>{let u=c||i.querySelector(`.${this.player.options.classPrefix}-menu-item`);u&&u.focus({preventScroll:!0})},0)}}else{let s=p.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:y.t("player.noQuality"),style:{opacity:"0.5",cursor:"default"}});i.appendChild(s)}i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e)}createCaptionStyleButton(){let e=y.t("player.captionStyling"),t=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-caption-style`,attributes:{type:"button","aria-label":e,"aria-expanded":"false"}}),i=p.createElement("span",{textContent:"Aa",style:{fontSize:"14px",fontWeight:"bold"}});return t.appendChild(i),p.attachTooltip(t,e,this.player.options.classPrefix),t.addEventListener("click",()=>{this.showCaptionStyleMenu(t)}),this.controls.captionStyle=t,t}showCaptionStyleMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-caption-style-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=p.createElement("div",{className:`${this.player.options.classPrefix}-caption-style-menu ${this.player.options.classPrefix}-menu ${this.player.options.classPrefix}-settings-menu`,attributes:{role:"menu","aria-label":y.t("player.captionStyling")}});if(i.addEventListener("click",o=>{o.stopPropagation()}),!this.player.captionManager||this.player.captionManager.tracks.length===0){let o=p.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:y.t("player.noCaptions"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default",padding:"12px 16px"}});i.appendChild(o),i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e,!0);return}let s=this.createStyleControl(y.t("styleLabels.fontSize"),"captionsFontSize",[{label:y.t("fontSizes.small"),value:"87.5%"},{label:y.t("fontSizes.normal"),value:"100%"},{label:y.t("fontSizes.large"),value:"125%"},{label:y.t("fontSizes.xlarge"),value:"150%"}]);i.appendChild(s);let a=this.createStyleControl(y.t("styleLabels.font"),"captionsFontFamily",[{label:y.t("fontFamilies.sansSerif"),value:"sans-serif"},{label:y.t("fontFamilies.serif"),value:"serif"},{label:y.t("fontFamilies.monospace"),value:"monospace"}]);i.appendChild(a);let n=this.createColorControl(y.t("styleLabels.textColor"),"captionsColor");i.appendChild(n);let c=this.createColorControl(y.t("styleLabels.background"),"captionsBackgroundColor");i.appendChild(c);let u=this.createOpacityControl(y.t("styleLabels.opacity"),"captionsOpacity");i.appendChild(u),i.style.minWidth="220px",i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e,!0),ne(i,`.${this.player.options.classPrefix}-style-select`)}createStyleControl(e,t,i){let s=p.createElement("div",{className:`${this.player.options.classPrefix}-style-group`}),a=`${this.player.options.classPrefix}-${t}-${Date.now()}`,n=p.createElement("label",{textContent:e,attributes:{for:a},style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"rgba(255,255,255,0.7)"}});s.appendChild(n);let c=p.createElement("select",{className:`${this.player.options.classPrefix}-style-select`,attributes:{id:a},style:{width:"100%",padding:"6px",background:"var(--vidply-white)",border:"1px solid var(--vidply-white-10)",borderRadius:"4px",color:"var(--vidply-black)",fontSize:"13px"}}),u=this.player.options[t];return i.forEach(o=>{let r=p.createElement("option",{textContent:o.label,attributes:{value:o.value}});o.value===u&&(r.selected=!0),c.appendChild(r)}),c.addEventListener("mousedown",o=>{o.stopPropagation()}),c.addEventListener("click",o=>{o.stopPropagation()}),c.addEventListener("change",o=>{o.stopPropagation(),this.player.options[t]=o.target.value,this.player.captionManager&&this.player.captionManager.setCaptionStyle(t.replace("captions","").charAt(0).toLowerCase()+t.replace("captions","").slice(1),o.target.value)}),s.appendChild(c),s}createColorControl(e,t){let i=p.createElement("div",{className:`${this.player.options.classPrefix}-style-group`}),s=`${this.player.options.classPrefix}-${t}-${Date.now()}`,a=p.createElement("label",{textContent:e,attributes:{for:s},style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"rgba(255,255,255,0.7)"}});i.appendChild(a);let n=p.createElement("input",{attributes:{id:s,type:"color",value:this.player.options[t]},style:{width:"100%",height:"32px",padding:"2px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"4px",cursor:"pointer"}});return n.addEventListener("mousedown",c=>{c.stopPropagation()}),n.addEventListener("click",c=>{c.stopPropagation()}),n.addEventListener("change",c=>{c.stopPropagation(),this.player.options[t]=c.target.value,this.player.captionManager&&this.player.captionManager.setCaptionStyle(t.replace("captions","").charAt(0).toLowerCase()+t.replace("captions","").slice(1),c.target.value)}),i.appendChild(n),i}createOpacityControl(e,t){let i=p.createElement("div",{className:`${this.player.options.classPrefix}-style-group`}),s=`${this.player.options.classPrefix}-${t}-${Date.now()}`,a=p.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"}}),n=p.createElement("label",{textContent:e,attributes:{for:s},style:{fontSize:"12px",color:"rgba(255,255,255,0.7)"}}),c=p.createElement("span",{textContent:Math.round(this.player.options[t]*100)+"%",style:{fontSize:"12px",color:"rgba(255,255,255,0.7)"}});a.appendChild(n),a.appendChild(c),i.appendChild(a);let u=p.createElement("input",{attributes:{id:s,type:"range",min:"0",max:"1",step:"0.1",value:String(this.player.options[t])},style:{width:"100%",cursor:"pointer"}});return u.addEventListener("mousedown",o=>{o.stopPropagation()}),u.addEventListener("click",o=>{o.stopPropagation()}),u.addEventListener("input",o=>{o.stopPropagation();let r=parseFloat(o.target.value);c.textContent=Math.round(r*100)+"%",this.player.options[t]=r,this.player.captionManager&&this.player.captionManager.setCaptionStyle(t.replace("captions","").charAt(0).toLowerCase()+t.replace("captions","").slice(1),r)}),i.appendChild(u),i}createSpeedButton(){let e=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-speed`,attributes:{type:"button","aria-label":y.t("player.speed"),"aria-expanded":"false"}});e.appendChild(T("speed"));let t=p.createElement("span",{className:`${this.player.options.classPrefix}-speed-text`,textContent:"1x"});return e.appendChild(t),e.addEventListener("click",()=>{this.showSpeedMenu(e)}),this.controls.speed=e,this.controls.speedText=t,e}formatSpeedLabel(e){return e===1?y.t("speeds.normal"):`${e.toLocaleString(y.getLanguage(),{minimumFractionDigits:0,maximumFractionDigits:2})}Ã—`}showSpeedMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-speed-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=p.createElement("div",{className:`${this.player.options.classPrefix}-speed-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu"}}),s=[.25,.5,.75,1,1.25,1.5,1.75,2],a=null;s.forEach(n=>{let c=p.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:this.formatSpeedLabel(n),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});n===this.player.state.playbackSpeed&&(c.classList.add(`${this.player.options.classPrefix}-menu-item-active`),c.appendChild(T("check")),a=c),c.addEventListener("click",()=>{this.player.setPlaybackSpeed(n),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(c)}),i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuKeyboardNavigation(i,e),this.attachMenuCloseHandler(i,e),setTimeout(()=>{let n=a||i.querySelector(`.${this.player.options.classPrefix}-menu-item`);n&&n.focus({preventScroll:!0})},0)}createCaptionsButton(){let e=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-captions-button`,attributes:{type:"button","aria-label":y.t("player.captions"),"aria-expanded":"false"}});return e.appendChild(T("captionsOff")),e.addEventListener("click",()=>{this.showCaptionsMenu(e)}),this.controls.captions=e,e}showCaptionsMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-captions-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=p.createElement("div",{className:`${this.player.options.classPrefix}-captions-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu","aria-label":y.t("captions.select")}});if(!this.player.captionManager||this.player.captionManager.tracks.length===0){let c=p.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:y.t("player.noCaptions"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(c),this.insertMenuIntoDOM(i,e),this.attachMenuCloseHandler(i,e);return}let s=null,a=p.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:y.t("captions.off"),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});this.player.state.captionsEnabled||(a.classList.add(`${this.player.options.classPrefix}-menu-item-active`),a.appendChild(T("check")),s=a),a.addEventListener("click",()=>{this.player.disableCaptions(),this.updateCaptionsButton(),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(a),this.player.captionManager.getAvailableTracks().forEach(c=>{let u=p.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:c.label,attributes:{type:"button",role:"menuitem",lang:c.language,tabindex:"-1"}});this.player.state.captionsEnabled&&this.player.captionManager.currentTrack===this.player.captionManager.tracks[c.index]&&(u.classList.add(`${this.player.options.classPrefix}-menu-item-active`),u.appendChild(T("check")),s=u),u.addEventListener("click",()=>{this.player.captionManager.switchTrack(c.index),this.updateCaptionsButton(),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(u)}),this.insertMenuIntoDOM(i,e),this.attachMenuKeyboardNavigation(i,e),this.attachMenuCloseHandler(i,e),setTimeout(()=>{let c=s||i.querySelector(`.${this.player.options.classPrefix}-menu-item`);c&&c.focus({preventScroll:!0})},0)}updateCaptionsButton(){if(!this.controls.captions)return;let e=this.controls.captions.querySelector(".vidply-icon"),t=this.player.state.captionsEnabled;e.innerHTML=t?T("captions").innerHTML:T("captionsOff").innerHTML}createTranscriptButton(){let e=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-transcript`,attributes:{type:"button","aria-label":y.t("player.transcript"),"aria-expanded":"false"}});return e.appendChild(T("transcript")),e.addEventListener("click",async()=>{await this.player.toggleTranscript(),this.updateTranscriptButton()}),this.controls.transcript=e,e}updateTranscriptButton(){if(!this.controls.transcript)return;let e=this.player.transcriptManager&&this.player.transcriptManager.isVisible;this.controls.transcript.setAttribute("aria-expanded",e?"true":"false")}createAudioDescriptionButton(){let e=y.t("player.audioDescription"),t=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-audio-description`,attributes:{type:"button","aria-label":e,role:"switch","aria-checked":"false"}});return t.appendChild(T("audioDescription")),p.attachTooltip(t,e,this.player.options.classPrefix),t.addEventListener("click",async()=>{await this.player.toggleAudioDescription(),this.updateAudioDescriptionButton()}),this.controls.audioDescription=t,t}updateAudioDescriptionButton(){if(!this.controls.audioDescription)return;let e=this.controls.audioDescription.querySelector(".vidply-icon"),t=this.player.state.audioDescriptionEnabled;e.innerHTML=t?T("audioDescriptionOn").innerHTML:T("audioDescription").innerHTML,this.controls.audioDescription.setAttribute("aria-checked",t?"true":"false")}createSignLanguageButton(){let e=y.t("player.signLanguage"),t=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-sign-language`,attributes:{type:"button","aria-label":e,"aria-expanded":"false"}});return t.appendChild(T("signLanguage")),p.attachTooltip(t,e,this.player.options.classPrefix),t.addEventListener("click",()=>{this.player.toggleSignLanguage(),this.updateSignLanguageButton()}),this.controls.signLanguage=t,t}updateSignLanguageButton(){if(!this.controls.signLanguage)return;let e=this.controls.signLanguage.querySelector(".vidply-icon"),t=this.player.state.signLanguageEnabled;e.innerHTML=t?T("signLanguageOn").innerHTML:T("signLanguage").innerHTML,this.controls.signLanguage.setAttribute("aria-expanded",t?"true":"false"),this.controls.signLanguage.setAttribute("aria-label",t?y.t("signLanguage.hide"):y.t("signLanguage.show"))}updateAccessibilityButtons(){let e=this.hasAudioDescription(),t=this.hasSignLanguage();if(e){if(!this.controls.audioDescription&&this.player.options.audioDescriptionButton!==!1){let i=this.createAudioDescriptionButton();i.dataset.overflowPriority="2",i.dataset.overflowPriorityMobile="3";let s=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-transcript`),a=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-playlist-toggle`),n=s||a||null;n?this.rightButtons.insertBefore(i,n):this.rightButtons.appendChild(i),this.setupOverflowMenu()}this.controls.audioDescription&&(this.controls.audioDescription.style.display="")}else this.controls.audioDescription&&(this.controls.audioDescription.style.display="none");if(t){if(!this.controls.signLanguage&&this.player.options.signLanguageButton!==!1){let i=this.createSignLanguageButton();i.dataset.overflowPriority="3",i.dataset.overflowPriorityMobile="3";let s=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-quality`),a=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-fullscreen`),n=s||a||null;n?this.rightButtons.insertBefore(i,n):this.rightButtons.appendChild(i),this.setupOverflowMenu()}this.controls.signLanguage&&(this.controls.signLanguage.style.display="")}else this.controls.signLanguage&&(this.controls.signLanguage.style.display="none")}createSettingsButton(){let e=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-settings`,attributes:{type:"button","aria-label":y.t("player.settings")}});return e.appendChild(T("settings")),e.addEventListener("click",()=>{this.player.showSettings()}),e}createPipButton(){let e=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-pip`,attributes:{type:"button","aria-label":y.t("player.pip")}});return e.appendChild(T("pip")),e.addEventListener("click",()=>{this.player.togglePiP()}),e}createFullscreenButton(){let e=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-fullscreen`,attributes:{type:"button","aria-label":y.t("player.fullscreen")}});return e.appendChild(T("fullscreen")),e.addEventListener("click",()=>{this.player.toggleFullscreen()}),this.controls.fullscreen=e,e}attachEvents(){this.player.on("play",()=>this.updatePlayPauseButton()),this.player.on("pause",()=>this.updatePlayPauseButton()),this.player.on("timeupdate",()=>this.updateProgress()),this.player.on("loadedmetadata",()=>{this.updateDuration(),this.ensureQualityButton(),this.updateQualityIndicator(),this.updatePreviewVideoSource()}),this.player.on("sourcechange",()=>{this.updatePreviewVideoSource()}),this.player.on("volumechange",()=>this.updateVolumeDisplay()),this.player.on("progress",()=>this.updateBuffered()),this.player.on("playbackspeedchange",()=>this.updateSpeedDisplay()),this.player.on("fullscreenchange",()=>this.updateFullscreenButton()),this.player.on("captionsenabled",()=>this.updateCaptionsButton()),this.player.on("captionsdisabled",()=>this.updateCaptionsButton()),this.player.on("audiodescriptionenabled",()=>this.updateAudioDescriptionButton()),this.player.on("audiodescriptiondisabled",()=>this.updateAudioDescriptionButton()),this.player.on("signlanguageenabled",()=>this.updateSignLanguageButton()),this.player.on("signlanguagedisabled",()=>this.updateSignLanguageButton()),this.player.on("qualitychange",()=>this.updateQualityIndicator()),this.player.on("hlslevelswitched",()=>this.updateQualityIndicator()),this.player.on("hlsmanifestparsed",()=>{this.ensureQualityButton(),this.updateQualityIndicator()})}updatePlayPauseButton(){if(!this.controls.playPause)return;let e=this.controls.playPause.querySelector(".vidply-icon"),t=this.player.state.playing;e.innerHTML=t?T("pause").innerHTML:T("play").innerHTML;let i=t?y.t("player.pause"):y.t("player.play");this.controls.playPause.setAttribute("aria-label",i),p.attachTooltip(this.controls.playPause,i,this.player.options.classPrefix)}updateProgress(){if(!this.controls.played)return;let e=this.player.state.currentTime||0,t=this.player.state.duration||0,i=t>0?Math.min(100,Math.max(0,e/t*100)):0;this.controls.played.style.width=`${i}%`,this.controls.progress.setAttribute("aria-valuenow",String(Math.round(i)));let s=x.formatDuration(this.player.state.currentTime),a=x.formatDuration(this.player.state.duration);if(this.controls.progress.setAttribute("aria-valuetext",`${Math.round(i)}%, ${s} ${y.t("time.of")} ${a}`),this.controls.currentTimeVisual){let n=this.player.state.currentTime;this.controls.currentTimeVisual.textContent=x.formatTime(n),this.controls.currentTimeAccessible&&(this.controls.currentTimeAccessible.textContent=x.formatDuration(n))}}updateDuration(){if(this.controls.durationVisual){let e=this.player.state.duration;this.controls.durationVisual.textContent=x.formatTime(e),this.controls.durationAccessible&&(this.controls.durationAccessible.textContent=y.t("time.durationPrefix")+x.formatDuration(e))}}updateVolumeDisplay(){let e=this.player.state.volume*100;if(this.controls.volumeFill&&(this.controls.volumeFill.style.height=`${e}%`),this.controls.volumeSlider&&this.controls.volumeSlider.setAttribute("aria-valuenow",String(Math.round(e))),this.controls.mute){let t=this.controls.mute.querySelector(".vidply-icon");if(t){let i;this.player.state.muted||this.player.state.volume===0?i="volumeMuted":this.player.state.volume<.3?i="volumeLow":this.player.state.volume<.7?i="volumeMedium":i="volumeHigh",t.innerHTML=T(i).innerHTML;let s=this.player.state.muted?y.t("player.unmute"):y.t("player.mute");this.controls.mute.setAttribute("aria-label",s),p.attachTooltip(this.controls.mute,s,this.player.options.classPrefix)}}this.controls.volumeSlider&&this.controls.volumeSlider.setAttribute("aria-valuenow",String(Math.round(e)))}updateBuffered(){if(!this.controls.buffered||!this.player.element.buffered||this.player.element.buffered.length===0)return;let t=this.player.element.buffered.end(this.player.element.buffered.length-1)/this.player.state.duration*100;this.controls.buffered.style.width=`${t}%`}updateSpeedDisplay(){this.controls.speedText&&(this.controls.speedText.textContent=`${this.player.state.playbackSpeed}x`)}updateFullscreenButton(){if(!this.controls.fullscreen)return;let e=this.controls.fullscreen.querySelector(".vidply-icon"),t=this.player.state.fullscreen;e.innerHTML=t?T("fullscreenExit").innerHTML:T("fullscreen").innerHTML,this.controls.fullscreen.setAttribute("aria-label",t?y.t("player.exitFullscreen"):y.t("player.fullscreen"))}ensureQualityButton(){if(!this.player.options.qualityButton||this.controls.quality||!this.hasQualityLevels())return;let e=this.createQualityButton(),t=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-speed`),s=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-caption-style`)||t;s?this.rightButtons.insertBefore(e,s):this.rightButtons.insertBefore(e,this.rightButtons.firstChild),this.player.log("Quality button added dynamically","info")}updateQualityIndicator(){if(!this.controls.qualityText||!this.player.renderer||!this.player.renderer.getQualities)return;let e=this.player.renderer.getQualities();if(e.length===0){this.controls.qualityText.textContent="";return}let t="";if(this.player.renderer.hls&&this.player.renderer.hls.currentLevel===-1)t="Auto";else if(this.player.renderer.getCurrentQuality){let i=this.player.renderer.getCurrentQuality(),s=e.find(a=>a.index===i);s&&(t=s.height?`${s.height}p`:"")}this.controls.qualityText.textContent=t}setupAutoHide(){if(this.player.element.tagName!=="VIDEO")return;let e=()=>{if(this.element.classList.add(`${this.player.options.classPrefix}-controls-visible`),this.player.container.classList.add(`${this.player.options.classPrefix}-controls-visible`),this.player.state.controlsVisible=!0,clearTimeout(this.hideTimeout),this.player.state.playing){let t=this.player.state.fullscreen?this.player.options.hideControlsDelay*1.5:this.player.options.hideControlsDelay;this.hideTimeout=setTimeout(()=>{this.element.classList.remove(`${this.player.options.classPrefix}-controls-visible`),this.player.container.classList.remove(`${this.player.options.classPrefix}-controls-visible`),this.player.state.controlsVisible=!1},t)}};this.player.container.addEventListener("mousemove",e),this.player.container.addEventListener("touchstart",e),this.player.container.addEventListener("touchmove",e),this.player.container.addEventListener("click",e),this.player.container.addEventListener("tap",e),this.element.addEventListener("focusin",e),this.player.on("pause",()=>{e(),clearTimeout(this.hideTimeout)}),this.player.on("play",()=>{e()}),this.player.on("enterfullscreen",()=>{e(),this.player.state.fullscreen&&(clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(()=>{this.player.state.playing&&(this.element.classList.remove(`${this.player.options.classPrefix}-controls-visible`),this.player.container.classList.remove(`${this.player.options.classPrefix}-controls-visible`),this.player.state.controlsVisible=!1)},this.player.options.hideControlsDelay*2))}),e()}createOverflowMenuButton(){let e=y.t("player.moreOptions"),t=p.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-overflow-menu`,attributes:{type:"button","aria-label":e,"aria-expanded":"false"}});return t.appendChild(T("moreVertical")),p.attachTooltip(t,e,this.player.options.classPrefix),t.addEventListener("click",()=>{this.showOverflowMenu(t)}),this.controls.overflowMenu=t,t}showOverflowMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-overflow-menu-list`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=p.createElement("div",{className:`${this.player.options.classPrefix}-overflow-menu-list ${this.player.options.classPrefix}-menu`,attributes:{role:"menu","aria-label":y.t("player.moreOptions")}}),s=Array.from(this.rightButtons.querySelectorAll('button[data-in-overflow="true"]'));if(s.length===0){let a=p.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:y.t("player.noMoreOptions"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(a)}else s.forEach(a=>{let n=p.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,attributes:{type:"button",role:"menuitem",tabindex:"-1"}}),c=a.getAttribute("aria-label")||a.getAttribute("title")||"",u=a.querySelector(".vidply-icon");if(u){let r=u.cloneNode(!0);n.appendChild(r)}else{let r=a.querySelector("span");if(r&&r.textContent&&r.textContent.length<=3){let l=r.cloneNode(!0);l.classList.add("vidply-icon"),n.appendChild(l)}}let o=p.createElement("span",{textContent:c});n.appendChild(o),n.addEventListener("click",r=>{this._overflowMenuItemRef=n;let l=a.style.display;a.style.display="",a.style.visibility="hidden",a.click(),setTimeout(()=>{a.style.display=l,a.style.visibility="",this._overflowMenuItemRef=null},100),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(n)}),this.attachMenuKeyboardNavigation(i,e),setTimeout(()=>{let a=i.querySelector(`.${this.player.options.classPrefix}-menu-item`);a&&a.tagName==="BUTTON"&&a.focus({preventScroll:!0})},0);i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e)}setupOverflowDetection(){let e=()=>{let i=window.innerWidth>=768,s=window.innerHeight<window.innerWidth,a=this.player.state.fullscreen,n=s&&a;if(!this.rightButtons||this.rightButtons.children.length===0){this.overflowMenuButton&&(this.overflowMenuButton.style.display="none");return}let c=Array.from(this.rightButtons.children).filter(m=>!m.classList.contains(`${this.player.options.classPrefix}-overflow-menu`));if(c.length===0){this.overflowMenuButton&&(this.overflowMenuButton.style.display="none");return}let u=!i&&!s;if(this.player.options.debug&&console.log("Overflow detection:",{isDesktop:i,isFullscreen:a,isLandscape:s,isLandscapeFullscreen:n,shouldUseOverflow:u,width:window.innerWidth,height:window.innerHeight}),!u){c.forEach(m=>{m.dataset.inOverflow="false",m.style.display=""}),this.overflowMenuButton&&(this.overflowMenuButton.style.display="none"),this.player.options.debug&&console.log("No overflow menu needed - all buttons visible, overflow button hidden");return}this.player.options.debug&&console.log("Mobile portrait - checking for overflow..."),c.forEach(m=>{m.style.display=""});let o=this.rightButtons.offsetWidth,l=o-50,g=0,d=c.map(m=>{let M=getComputedStyle(m),b=m.offsetWidth+parseInt(M.marginLeft||0)+parseInt(M.marginRight||0);return g+=b,{btn:m,width:b}});g+=(c.length-1)*8;let f=window.innerWidth<768,v=g>l||f||n&&!i;if(this.player.options.debug&&console.log("Overflow detection:",{containerWidth:o,availableWidth:l,totalWidth:g,needsOverflow:v,isSmallScreen:f,reason:f?"mobile screen":g>l?"not enough space":"enough space",buttonCount:c.length}),v){let m=window.innerWidth<768,M=m?"overflowPriorityMobile":"overflowPriority";this.player.options.debug&&console.log(`Using ${m?"mobile":"desktop"} priorities (width: ${window.innerWidth}px)`);let b=d.sort((S,k)=>{let C=parseInt(S.btn.dataset[M]||S.btn.dataset.overflowPriority||"1");return parseInt(k.btn.dataset[M]||k.btn.dataset.overflowPriority||"1")-C}),w=g,E=0;for(let{btn:S,width:k}of b){let C=parseInt(S.dataset[M]||S.dataset.overflowPriority||"1"),P=S.getAttribute("aria-label")||"unknown";if(C===1){S.dataset.inOverflow="false",S.style.display="";continue}(m?C>1:w>l)?(S.dataset.inOverflow="true",S.style.display="none",w-=k,E++,this.player.options.debug&&console.log(`  â†’ Hiding button: ${P} (priority ${C}, ${m?"mobile":"desktop"})`)):(S.dataset.inOverflow="false",S.style.display="")}if(this.player.options.debug&&console.log("Overflow button exists?",!!this.overflowMenuButton),!this.overflowMenuButton){console.error("Overflow menu button not found!");return}E>0?(this.overflowMenuButton.style.display="",this.player.options.debug&&console.log("Showing overflow menu button -",E,"buttons moved")):(this.overflowMenuButton.style.display="none",this.player.options.debug&&console.log("Hiding overflow menu button - all buttons fit"))}else c.forEach(m=>{m.dataset.inOverflow="false",m.style.display=""}),this.overflowMenuButton.style.display="none"},t=new ResizeObserver(()=>{requestAnimationFrame(e)});t.observe(this.rightButtons),window.addEventListener("resize",()=>{requestAnimationFrame(e)}),this.player.on("fullscreenchange",()=>{setTimeout(()=>{requestAnimationFrame(e)},50)}),requestAnimationFrame(()=>{e(),setTimeout(()=>e(),100),setTimeout(()=>e(),300),setTimeout(()=>e(),500)}),document.fonts&&document.fonts.ready&&document.fonts.ready.then(()=>{requestAnimationFrame(e)}),this.overflowResizeObserver=t}show(){this.element.style.display=""}hide(){this.element.style.display="none"}updatePreviewVideoSource(){let e=this.player.renderer;if(!e||!e.media||e.media.tagName!=="VIDEO"||(!this.previewSupported&&!this.previewVideo&&this.initPreviewThumbnail(),!this.previewSupported||!this.previewVideo))return;let t=e.media,i=t.src||t.querySelector("source")?.src;i&&this.previewVideo.src!==i?(this.previewThumbnailCache.clear(),this.previewVideoReady=!1,this.previewVideo.src=i,t.crossOrigin&&(this.previewVideo.crossOrigin=t.crossOrigin),this.previewVideo.addEventListener("loadedmetadata",()=>{this.previewVideoReady=!0},{once:!0})):i&&!this.previewVideoReady&&this.previewVideo.readyState>=1&&(this.previewVideoReady=!0)}cleanupPreviewThumbnail(){this.previewThumbnailTimeout&&(clearTimeout(this.previewThumbnailTimeout),this.previewThumbnailTimeout=null),this.previewVideo&&this.previewVideo.parentNode&&(this.previewVideo.parentNode.removeChild(this.previewVideo),this.previewVideo=null),this.previewThumbnailCache.clear()}destroy(){this.hideTimeout&&clearTimeout(this.hideTimeout),this.overflowResizeObserver&&this.overflowResizeObserver.disconnect(),this.cleanupPreviewThumbnail(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}};var H=class{constructor(e){this.player=e,this.element=null,this.tracks=[],this.currentTrack=null,this.currentCue=null,this.storage=new W("vidply"),this.loadSavedPreferences(),this.init()}loadSavedPreferences(){let e=this.storage.getCaptionPreferences();e&&(e.fontSize&&(this.player.options.captionsFontSize=e.fontSize),e.fontFamily&&(this.player.options.captionsFontFamily=e.fontFamily),e.color&&(this.player.options.captionsColor=e.color),e.backgroundColor&&(this.player.options.captionsBackgroundColor=e.backgroundColor),e.opacity!==void 0&&(this.player.options.captionsOpacity=e.opacity))}saveCaptionPreferences(){this.storage.saveCaptionPreferences({fontSize:this.player.options.captionsFontSize,fontFamily:this.player.options.captionsFontFamily,color:this.player.options.captionsColor,backgroundColor:this.player.options.captionsBackgroundColor,opacity:this.player.options.captionsOpacity})}init(){this.createElement(),this.loadTracks(),this.attachEvents(),this.player.options.captionsDefault&&this.tracks.length>0&&!this.currentTrack&&this.enable()}createElement(){this.element=p.createElement("div",{className:`${this.player.options.classPrefix}-captions`,attributes:{role:"region","aria-label":y.t("player.captions")}}),this.updateStyles(),(this.player.videoWrapper||this.player.container).appendChild(this.element)}loadTracks(){let e=this.player.element.textTracks,t=-1;for(let i=0;i<e.length;i++){let s=e[i];if(s.kind==="subtitles"||s.kind==="captions"){let a=this.player.findTrackElement(s),n=a&&a.hasAttribute("default");this.tracks.push({track:s,language:s.language,label:s.label,kind:s.kind,index:i,isDefault:n}),s.mode==="showing"||s.mode,s.mode="hidden",n&&(t=this.tracks.length-1)}}t>=0&&requestAnimationFrame(()=>{this.enable(t)})}attachEvents(){this.player.on("timeupdate",()=>{this.updateCaptions()}),this.player.on("captionschange",()=>{this.updateStyles()}),this.debouncedPositionCaptions=j(()=>{this.positionCaptionsOnMobile()},150),window.addEventListener("resize",this.debouncedPositionCaptions),this.player.on("enterfullscreen",()=>{_(()=>this.positionCaptionsOnMobile(),100)}),this.player.on("exitfullscreen",()=>{_(()=>this.positionCaptionsOnMobile(),100)})}enable(e=0){if(this.tracks.length===0)return;this.currentTrack&&this.currentTrack.track&&(this.cueChangeHandler&&this.currentTrack.track.removeEventListener("cuechange",this.cueChangeHandler),this.currentTrack.track.mode="hidden");let t=this.tracks[e];if(t&&t.track){t.track.mode="hidden",this.currentTrack=t,this.player.state.captionsEnabled=!0,t.language&&this.element.setAttribute("lang",t.language),this.cueChangeHandler&&t.track.removeEventListener("cuechange",this.cueChangeHandler),this.cueChangeHandler=()=>{this.updateCaptions()},t.track.addEventListener("cuechange",this.cueChangeHandler);let i=()=>{if(t.track.readyState<2){let s=()=>{t.track.removeEventListener("load",s),t.track.removeEventListener("error",s),requestAnimationFrame(()=>{this.currentTrack&&this.currentTrack.track===t.track&&this.updateCaptions()})};t.track.addEventListener("load",s,{once:!0}),t.track.addEventListener("error",s,{once:!0})}else requestAnimationFrame(()=>{this.currentTrack&&this.currentTrack.track===t.track&&this.updateCaptions()})};requestAnimationFrame(()=>{this.currentTrack&&this.currentTrack.track===t.track&&i()}),this.player.emit("captionsenabled",t)}}disable(){this.currentTrack&&(this.currentTrack.track.mode="hidden",this.currentTrack=null),this.element.style.display="none",this.element.innerHTML="",this.element.removeAttribute("lang"),this.currentCue=null,this.player.state.captionsEnabled=!1,this.player.emit("captionsdisabled")}updateCaptions(){if(!this.currentTrack||!this.currentTrack.track)return;if(this.currentTrack.track.mode==="disabled"&&(this.currentTrack.track.mode="hidden"),this.currentTrack.track.mode==="showing"&&(this.currentTrack.track.mode="hidden"),!this.currentTrack.track.activeCues){this.currentTrack.track.cues&&this.currentTrack.track.cues.length>0&&this.currentCue&&(this.element.innerHTML="",this.element.style.display="none",this.currentCue=null);return}let e=this.currentTrack.track.activeCues,t=this.player.element.tagName.toLowerCase()==="audio";if(e.length>0){let i=e[0];if(this.currentCue!==i){this.currentCue=i;let s=i.text;if(s=this.parseVTTFormatting(s),t){this.element.querySelectorAll(`.${this.player.options.classPrefix}-caption-cue`).forEach(u=>u.classList.remove(`${this.player.options.classPrefix}-caption-active`));let n=`cue-${i.startTime}-${i.endTime}`,c=this.element.querySelector(`[data-cue-id="${n}"]`);c||(c=document.createElement("div"),c.className=`${this.player.options.classPrefix}-caption-cue`,c.setAttribute("data-cue-id",n),c.innerHTML=p.sanitizeHTML(s),this.element.appendChild(c)),c.classList.add(`${this.player.options.classPrefix}-caption-active`),requestAnimationFrame(()=>{c&&c.scrollIntoView({behavior:"smooth",block:"center"})})}else this.element.innerHTML=p.sanitizeHTML(s);this.element.style.display="block",this.positionCaptionsOnMobile(),this.player.emit("captionchange",i)}}else this.currentCue&&(t||(this.element.innerHTML="",this.element.style.display="none"),this.currentCue=null)}positionCaptionsOnMobile(){if(!this.element||this.element.style.display==="none")return;let e=this.player.state?.fullscreen||!1,t=N();if(!t&&!e){this.element.style.bottom="";return}let i=this.player.controlBar?.element;i&&requestAnimationFrame(()=>{if(!this.element||this.element.style.display==="none")return;let s=i.getBoundingClientRect(),n=this.player.videoWrapper.getBoundingClientRect().bottom-s.top+16;this.element.style.bottom=`${n}px`,this.player.options.debug&&console.log("[VidPly] Caption position:",{mobile:t,isFullscreen:e,controlsHeight:s.height,bottomOffset:`${n}px`})})}parseVTTFormatting(e){return e=e.replace(/<c[^>]*>(.*?)<\/c>/g,'<span class="caption-class">$1</span>'),e=e.replace(/<b>(.*?)<\/b>/g,"<strong>$1</strong>"),e=e.replace(/<i>(.*?)<\/i>/g,"<em>$1</em>"),e=e.replace(/<u>(.*?)<\/u>/g,"<u>$1</u>"),e=e.replace(/<v\s+([^>]+)>(.*?)<\/v>/g,'<span class="caption-voice" data-voice="$1">$2</span>'),e}updateStyles(){if(!this.element)return;let e=this.player.options;this.element.style.fontSize=e.captionsFontSize,this.element.style.fontFamily=e.captionsFontFamily,this.element.style.color=e.captionsColor,this.element.style.backgroundColor=this.hexToRgba(e.captionsBackgroundColor,e.captionsOpacity)}hexToRgba(e,t){let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?`rgba(${parseInt(i[1],16)}, ${parseInt(i[2],16)}, ${parseInt(i[3],16)}, ${t})`:e}setCaptionStyle(e,t){switch(e){case"fontSize":this.player.options.captionsFontSize=t;break;case"fontFamily":this.player.options.captionsFontFamily=t;break;case"color":this.player.options.captionsColor=t;break;case"backgroundColor":this.player.options.captionsBackgroundColor=t;break;case"opacity":this.player.options.captionsOpacity=t;break}this.updateStyles(),this.saveCaptionPreferences(),this.player.emit("captionschange")}getAvailableTracks(){return this.tracks.map((e,t)=>({index:t,language:e.language,label:e.label||e.language,kind:e.kind}))}switchTrack(e){e>=0&&e<this.tracks.length&&(this.disable(),this.enable(e))}destroy(){this.disable(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}};var G=class{constructor(e){this.player=e,this.shortcuts=e.options.keyboardShortcuts,this.init()}init(){this.attachEvents()}attachEvents(){this.player.container.addEventListener("keydown",e=>{this.handleKeydown(e)},!0),this.player.container.hasAttribute("tabindex")||this.player.container.setAttribute("tabindex","0")}handleKeydown(e){if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||e.target.tagName==="SELECT")return;let t=document.activeElement;if(t&&(t.closest('.vidply-menu, [role="menu"]')||t.closest(".vidply-playlist-item-button")))return;let i=e.key,s=!1;if(i==="Escape"&&this.player.state.fullscreen){this.player.exitFullscreen(),e.preventDefault(),e.stopPropagation();return}for(let[a,n]of Object.entries(this.shortcuts))if(n.includes(i)&&(s=this.executeAction(a,e),s)){e.preventDefault(),e.stopPropagation(),this.announceAction(a);break}!s&&this.player.options.debug&&console.log("[VidPly] Unhandled key:",e.key,"code:",e.code,"shiftKey:",e.shiftKey)}executeAction(e,t){switch(e){case"play-pause":return this.player.toggle(),!0;case"volume-up":return this.player.setVolume(Math.min(1,this.player.state.volume+.1)),!0;case"volume-down":return this.player.setVolume(Math.max(0,this.player.state.volume-.1)),!0;case"seek-forward":return this.player.seekForward(),!0;case"seek-backward":return this.player.seekBackward(),!0;case"mute":return this.player.toggleMute(),!0;case"fullscreen":return this.player.toggleFullscreen(),!0;case"captions":if(this.player.captionManager&&this.player.captionManager.tracks.length>1){let i=this.player.controlBar&&this.player.controlBar.controls.captions;i?this.player.controlBar.showCaptionsMenu(i):this.player.toggleCaptions()}else this.player.toggleCaptions();return!0;case"caption-style-menu":return this.player.controlBar&&this.player.controlBar.controls.captionStyle?(this.player.controlBar.showCaptionStyleMenu(this.player.controlBar.controls.captionStyle),!0):!1;case"speed-up":return this.player.setPlaybackSpeed(Math.min(2,this.player.state.playbackSpeed+.25)),!0;case"speed-down":return this.player.setPlaybackSpeed(Math.max(.25,this.player.state.playbackSpeed-.25)),!0;case"speed-menu":return this.player.controlBar&&this.player.controlBar.controls.speed?(this.player.controlBar.showSpeedMenu(this.player.controlBar.controls.speed),!0):!1;case"quality-menu":return this.player.controlBar&&this.player.controlBar.controls.quality?(this.player.controlBar.showQualityMenu(this.player.controlBar.controls.quality),!0):!1;case"chapters-menu":return this.player.controlBar&&this.player.controlBar.controls.chapters?(this.player.controlBar.showChaptersMenu(this.player.controlBar.controls.chapters),!0):!1;case"transcript-toggle":return this.player.transcriptManager?(this.player.transcriptManager.toggleTranscript(),!0):!1;default:return!1}}announceAction(e){if(!this.player.options.screenReaderAnnouncements)return;let t="";switch(e){case"play-pause":t=this.player.state.playing?"Playing":"Paused";break;case"volume-up":t=`Volume ${Math.round(this.player.state.volume*100)}%`;break;case"volume-down":t=`Volume ${Math.round(this.player.state.volume*100)}%`;break;case"mute":t=this.player.state.muted?"Muted":"Unmuted";break;case"fullscreen":t=this.player.state.fullscreen?"Fullscreen":"Exit fullscreen";break;case"captions":t=this.player.state.captionsEnabled?"Captions on":"Captions off";break;case"speed-up":case"speed-down":t=`Speed ${this.player.state.playbackSpeed}x`;break}t&&this.announce(t)}announce(e,t="polite"){let i=document.getElementById("vidply-announcer");i||(i=document.createElement("div"),i.id="vidply-announcer",i.className="vidply-sr-only",i.setAttribute("aria-live",t),i.setAttribute("aria-atomic","true"),i.style.cssText=`
        position: absolute;
        left: -10000px;
        width: 1px;
        height: 1px;
        overflow: hidden;
      `,document.body.appendChild(i)),i.textContent="",setTimeout(()=>{i.textContent=e},100)}updateShortcut(e,t){Array.isArray(t)&&(this.shortcuts[e]=t)}destroy(){}};var Z=class{constructor(e){this.player=e,this.enabled=!1,this.desiredState=!1,this.src=e.options.audioDescriptionSrc,this.sourceElement=null,this.originalSource=null,this.captionTracks=[]}initFromSourceElements(e,t){for(let i of e){let s=i.getAttribute("data-desc-src"),a=i.getAttribute("data-orig-src");if(s||a){if(this.sourceElement||(this.sourceElement=i),a)this.originalSource||(this.originalSource=a),this.player.originalSrc||(this.player.originalSrc=a);else{let n=i.getAttribute("src");!this.originalSource&&n&&(this.originalSource=n),!this.player.originalSrc&&n&&(this.player.originalSrc=n)}s&&!this.src&&(this.src=s)}}t.forEach(i=>{let s=i.getAttribute("kind"),a=i.getAttribute("data-desc-src");(s==="captions"||s==="subtitles"||s==="chapters"||s==="descriptions")&&a&&(this.captionTracks.push({trackElement:i,originalSrc:i.getAttribute("src"),describedSrc:a,originalTrackSrc:i.getAttribute("data-orig-src")||i.getAttribute("src"),explicit:!0}),this.player.log(`Found explicit described ${s} track: ${i.getAttribute("src")} -> ${a}`))})}isAvailable(){let e=this.player.sourceElements.some(t=>t.getAttribute("data-desc-src"));return!!(this.src||e||this.captionTracks.length>0)}async enable(){let e=this.player.sourceElements.some(u=>u.getAttribute("data-desc-src")),t=this.captionTracks.length>0;if(!this.src&&!e&&!t){console.warn("VidPly: No audio description source, source elements, or tracks provided");return}this.desiredState=!0;let i=this.player.state.currentTime,s=this.player.state.playing,a=this.player.element.poster||this.player.element.getAttribute("poster")||this.player.options.poster,n=i<.1&&!s,c=this._getCurrentCaptionText();this.sourceElement?await this._enableWithSourceElement(i,s,a,n,c):await this._enableWithDirectSrc(i,s,a,n)}async disable(){if(!this.player.originalSrc)return;this.desiredState=!1;let e=this.player.state.currentTime,t=this.player.state.playing,i=this.player.element.poster||this.player.element.getAttribute("poster")||this.player.options.poster,s=e<.1&&!t,a=this._getCurrentCaptionText();this.sourceElement?await this._disableWithSourceElement(e,t,i,s,a):await this._disableWithDirectSrc(e,t,i)}async toggle(){let e=this.player.findTextTrack("descriptions"),t=this.isAvailable();e&&!t?e.mode==="showing"?(e.mode="hidden",this.enabled=!1,this.player.emit("audiodescriptiondisabled")):(e.mode="showing",this.enabled=!0,this.player.emit("audiodescriptionenabled")):e&&t?this.enabled?(this.desiredState=!1,await this.disable()):(e.mode="showing",this.desiredState=!0,await this.enable()):t&&(this.enabled?(this.desiredState=!1,await this.disable()):(this.desiredState=!0,await this.enable()))}_getCurrentCaptionText(){return this.player.captionManager&&this.player.captionManager.currentTrack&&this.player.captionManager.currentCue?this.player.captionManager.currentCue.text:null}async _validateTrackExists(e){try{return(await fetch(e,{method:"HEAD"})).ok}catch{return!1}}async _swapCaptionTracks(e=!0){if(this.captionTracks.length===0)return[];let t=[],i=this.captionTracks.map(async n=>{if(n.trackElement&&n.describedSrc&&n.explicit===!0)try{let c=await this._validateTrackExists(e?n.describedSrc:n.originalSrc);return{trackInfo:n,exists:c}}catch{return{trackInfo:n,exists:!1}}return{trackInfo:n,exists:!1}}),a=(await Promise.all(i)).filter(n=>n.exists);if(a.length>0){let n=new Map;a.forEach(({trackInfo:u})=>{let o=u.trackElement.track;o?n.set(u,{wasShowing:o.mode==="showing",wasHidden:o.mode==="hidden"}):n.set(u,{wasShowing:!1,wasHidden:!1})});let c=a.map(({trackInfo:u})=>{let o={};Array.from(u.trackElement.attributes).forEach(l=>{o[l.name]=l.value});let r={trackInfo:u,oldSrc:u.trackElement.getAttribute("src"),parent:u.trackElement.parentNode,nextSibling:u.trackElement.nextSibling,attributes:o};return u.trackElement.remove(),r});this.player.element.load(),await new Promise(u=>{setTimeout(()=>{c.forEach(({trackInfo:r,parent:l,nextSibling:g,attributes:d})=>{t.push(r);let h=document.createElement("track"),f=e?r.describedSrc:r.originalSrc;h.setAttribute("src",f),Object.keys(d).forEach(m=>{m!=="src"&&m!=="data-desc-src"&&h.setAttribute(m,d[m])});let v=l||this.player.element;g&&g.parentNode?v.insertBefore(h,g):v.appendChild(h),r.trackElement=h}),this.player.invalidateTrackCache();let o=()=>{this.player.setManagedTimeout(()=>{t.forEach(r=>{let l=r.trackElement.track;if(l){let g=n.get(r)||{wasShowing:!1,wasHidden:!1};l.mode="hidden";let d=()=>{g.wasShowing||g.wasHidden?l.mode="hidden":l.mode="disabled"};l.readyState>=2?d():(l.addEventListener("load",d,{once:!0}),l.addEventListener("error",d,{once:!0}))}})},300)};this.player.element.readyState>=1?setTimeout(o,200):(this.player.element.addEventListener("loadedmetadata",o,{once:!0}),setTimeout(o,2e3)),u()},100)})}return t}_updateSourceElements(e=!0){let t=this.player.sourceElements,i=[];t.forEach(s=>{let a=s.getAttribute("data-desc-src"),n=s.getAttribute("src");if(a){let c=s.getAttribute("type"),u=s.getAttribute("data-orig-src")||n;i.push({src:e?a:u,type:c,origSrc:u,descSrc:a})}else i.push({src:s.getAttribute("src"),type:s.getAttribute("type"),origSrc:null,descSrc:null})}),this.player.element.hasAttribute("src")&&this.player.element.removeAttribute("src"),t.forEach(s=>s.remove()),i.forEach(s=>{let a=document.createElement("source");a.setAttribute("src",s.src),s.type&&a.setAttribute("type",s.type),s.origSrc&&a.setAttribute("data-orig-src",s.origSrc),s.descSrc&&a.setAttribute("data-desc-src",s.descSrc);let n=this.player.element.querySelector("track");n?this.player.element.insertBefore(a,n):this.player.element.appendChild(a)}),this.player._sourceElementsDirty=!0,this.player._sourceElementsCache=null}async _waitForMediaReady(e=!1){await new Promise(t=>{if(this.player.element.readyState>=1)t();else{let i=()=>{this.player.element.removeEventListener("loadedmetadata",i),t()};this.player.element.addEventListener("loadedmetadata",i)}}),await new Promise(t=>setTimeout(t,300)),e&&await new Promise(t=>{if(this.player.element.readyState>=3)t();else{let i=()=>{this.player.element.removeEventListener("canplay",i),this.player.element.removeEventListener("canplaythrough",i),t()};this.player.element.addEventListener("canplay",i,{once:!0}),this.player.element.addEventListener("canplaythrough",i,{once:!0}),setTimeout(()=>{this.player.element.removeEventListener("canplay",i),this.player.element.removeEventListener("canplaythrough",i),t()},3e3)}})}async _restorePlaybackState(e,t,i,s){let a=e;if(s&&this.player.captionManager&&this.player.captionManager.tracks.length>0){await new Promise(c=>setTimeout(c,500));let n=this.player.findMatchingCaptionTime(s,this.player.captionManager.tracks);n!==null&&(a=n,this.player.options.debug&&this.player.log(`[VidPly] Syncing via caption: ${e}s -> ${a}s`))}a>0&&(this.player.seek(a),await new Promise(n=>setTimeout(n,100))),t?(await this.player.play(),this.player.setManagedTimeout(()=>{this.player.hidePosterOverlay()},100)):(this.player.pause(),i||this.player.hidePosterOverlay())}async _enableWithSourceElement(e,t,i,s,a){await this._swapCaptionTracks(!0),this._updateSourceElements(!0),i&&this.player.element.tagName==="VIDEO"&&(this.player.element.poster=i),this.player.element.load(),await this._waitForMediaReady(e>0||t),await this._restorePlaybackState(e,t,s,a),this.desiredState&&(this.enabled=!0,this.player.state.audioDescriptionEnabled=!0,this.player.emit("audiodescriptionenabled"),this._reloadTranscript())}async _enableWithDirectSrc(e,t,i,s){await this._swapCaptionTracks(!0),i&&this.player.element.tagName==="VIDEO"&&(this.player.element.poster=i),this.player.element.src=this.src,await this._waitForMediaReady(e>0||t),e>0&&(this.player.seek(e),await new Promise(a=>setTimeout(a,100))),t?await this.player.play():(this.player.pause(),s||this.player.hidePosterOverlay()),this.desiredState&&(this.enabled=!0,this.player.state.audioDescriptionEnabled=!0,this.player.emit("audiodescriptionenabled"),this._reloadTranscript())}async _disableWithSourceElement(e,t,i,s,a){await this._swapCaptionTracks(!1),this._updateSourceElements(!1),i&&this.player.element.tagName==="VIDEO"&&(this.player.element.poster=i),this.player.element.load(),this.player.invalidateTrackCache(),await this._waitForMediaReady(e>0||t),await this._restorePlaybackState(e,t,s,a),this.player.captionManager&&(this.player.captionManager.destroy(),this.player.captionManager=new H(this.player)),!this.desiredState&&(this.enabled=!1,this.player.state.audioDescriptionEnabled=!1,this.player.emit("audiodescriptiondisabled"),this._reloadTranscript())}async _disableWithDirectSrc(e,t,i){await this._swapCaptionTracks(!1),i&&this.player.element.tagName==="VIDEO"&&(this.player.element.poster=i);let s=this.originalSource||this.player.originalSrc;this.player.element.src=s,this.player.element.load(),await this._waitForMediaReady(e>0||t),e>0&&this.player.seek(e),t&&await this.player.play(),!this.desiredState&&(this.enabled=!1,this.player.state.audioDescriptionEnabled=!1,this.player.emit("audiodescriptiondisabled"),this._reloadTranscript())}_reloadTranscript(){this.player.transcriptManager&&this.player.transcriptManager.isVisible&&this.player.setManagedTimeout(()=>{this.player.transcriptManager&&this.player.transcriptManager.loadTranscriptData&&this.player.transcriptManager.loadTranscriptData()},800)}updateSources(e){this.src=e||null,this.enabled=!1,this.desiredState=!1,this.sourceElement=null,this.originalSource=null,this.captionTracks=[]}reinitialize(){this.player.invalidateTrackCache(),this.initFromSourceElements(this.player.sourceElements,this.player.trackElements)}destroy(){this.enabled=!1,this.desiredState=!1,this.captionTracks=[],this.sourceElement=null,this.originalSource=null}};var ee=class{constructor(e){this.player=e,this.src=e.options.signLanguageSrc,this.sources=e.options.signLanguageSources||{},this.currentLanguage=null,this.desiredPosition=e.options.signLanguagePosition||"bottom-right",this.wrapper=null,this.header=null,this.video=null,this.selector=null,this.settingsButton=null,this.settingsMenu=null,this.resizeHandles=[],this.enabled=!1,this.settingsMenuVisible=!1,this.settingsMenuJustOpened=!1,this.documentClickHandlerAdded=!1,this.handlers=null,this.settingsHandlers=null,this.interactionHandlers=null,this.draggable=null,this.documentClickHandler=null,this.settingsMenuKeyHandler=null,this.customKeyHandler=null,this.dragOptionButton=null,this.dragOptionText=null,this.resizeOptionButton=null,this.resizeOptionText=null}isAvailable(){return Object.keys(this.sources).length>0||!!this.src}enable(){let e=Object.keys(this.sources).length>0,t=!!this.src;if(!e&&!t){console.warn("No sign language video source provided");return}if(this.wrapper){this.wrapper.style.display="block",this.enabled=!0,this.player.state.signLanguageEnabled=!0,this.player.emit("signlanguageenabled"),this.player.setManagedTimeout(()=>{this.settingsButton&&document.contains(this.settingsButton)&&this.settingsButton.focus({preventScroll:!0})},150);return}let i=null,s=null;e?(i=this._determineInitialLanguage(),s=this.sources[i],this.currentLanguage=i):s=this.src,this._createWrapper(),this._createHeader(e,i),this._createVideo(s),this._createResizeHandles(),this.wrapper.appendChild(this.header),this.wrapper.appendChild(this.video),this.resizeHandles.forEach(a=>this.wrapper.appendChild(a)),this._applyInitialSize(),this.player.container.appendChild(this.wrapper),requestAnimationFrame(()=>{this.constrainPosition()}),this.video.currentTime=this.player.state.currentTime,this.player.state.paused||this.video.play(),this._setupInteraction(),this._setupEventHandlers(e),this.enabled=!0,this.player.state.signLanguageEnabled=!0,this.player.emit("signlanguageenabled"),this.player.setManagedTimeout(()=>{this.settingsButton&&document.contains(this.settingsButton)&&this.settingsButton.focus({preventScroll:!0})},150)}disable(){this.settingsMenuVisible&&this.hideSettingsMenu({focusButton:!1}),this.wrapper&&(this.wrapper.style.display="none"),this.enabled=!1,this.player.state.signLanguageEnabled=!1,this.player.emit("signlanguagedisabled")}toggle(){this.enabled?this.disable():this.enable()}switchLanguage(e){if(!this.sources[e]||!this.video)return;let t=this.video.currentTime,i=!this.video.paused;this.video.src=this.sources[e],this.currentLanguage=e,this.video.currentTime=t,i&&this.video.play().catch(()=>{}),this.player.emit("signlanguagelanguagechanged",e)}getLanguageLabel(e){return{en:"English",de:"Deutsch",es:"EspaÃ±ol",fr:"FranÃ§ais",it:"Italiano",ja:"æ—¥æœ¬èªž",pt:"PortuguÃªs",ar:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",hi:"à¤¹à¤¿à¤¨à¥à¤¦à¥€"}[e]||e.toUpperCase()}_determineInitialLanguage(){if(this.player.captionManager&&this.player.captionManager.currentTrack){let e=this.player.captionManager.currentTrack.language?.toLowerCase().split("-")[0];if(e&&this.sources[e])return e}if(this.player.options.language){let e=this.player.options.language.toLowerCase().split("-")[0];if(this.sources[e])return e}return Object.keys(this.sources)[0]}_createWrapper(){this.wrapper=document.createElement("div"),this.wrapper.className="vidply-sign-language-wrapper",this.wrapper.setAttribute("tabindex","0"),this.wrapper.setAttribute("aria-label",y.t("player.signLanguageDragResize"))}_createHeader(e,t){let i=this.player.options.classPrefix;this.header=p.createElement("div",{className:`${i}-sign-language-header`,attributes:{tabindex:"0"}});let s=p.createElement("div",{className:`${i}-sign-language-header-left`}),a=p.createElement("h3",{textContent:y.t("player.signLanguageVideo")});this._createSettingsButton(s),e&&this._createLanguageSelector(s,t),s.appendChild(a);let n=this._createCloseButton();this.header.appendChild(s),this.header.appendChild(n),this.settingsMenuVisible=!1,this.settingsMenu=null,this.settingsMenuJustOpened=!1}_createSettingsButton(e){let t=this.player.options.classPrefix,i=y.t("player.signLanguageSettings");this.settingsButton=p.createElement("button",{className:`${t}-sign-language-settings`,attributes:{type:"button","aria-label":i,"aria-expanded":"false"}}),this.settingsButton.appendChild(T("settings")),p.attachTooltip(this.settingsButton,i,t),this.settingsHandlers={click:s=>{s.preventDefault(),s.stopPropagation(),this.documentClickHandler&&(this.settingsMenuJustOpened=!0,setTimeout(()=>{this.settingsMenuJustOpened=!1},100)),this.settingsMenuVisible?this.hideSettingsMenu():this.showSettingsMenu()},keydown:s=>{s.key==="d"||s.key==="D"?(s.preventDefault(),s.stopPropagation(),this.toggleKeyboardDragMode()):s.key==="r"||s.key==="R"?(s.preventDefault(),s.stopPropagation(),this.toggleResizeMode()):s.key==="Escape"&&this.settingsMenuVisible&&(s.preventDefault(),s.stopPropagation(),this.hideSettingsMenu())}},this.settingsButton.addEventListener("click",this.settingsHandlers.click),this.settingsButton.addEventListener("keydown",this.settingsHandlers.keydown),e.appendChild(this.settingsButton)}_createLanguageSelector(e,t){let i=this.player.options.classPrefix,s=`${i}-sign-language-select-${Date.now()}`,a=Object.keys(this.sources).map(o=>({value:o,text:this.getLanguageLabel(o),selected:o===t})),{label:n,select:c}=U({classPrefix:i,labelClass:`${i}-sign-language-label`,selectClass:`${i}-sign-language-select`,labelText:"settings.language",selectId:s,options:a,onChange:o=>{o.stopPropagation(),this.switchLanguage(o.target.value)}});this.selector=c;let u=p.createElement("div",{className:`${i}-sign-language-selector-wrapper`});u.appendChild(n),u.appendChild(this.selector),Q(u),e.appendChild(u)}_createCloseButton(){let e=this.player.options.classPrefix,t=y.t("player.closeSignLanguage"),i=p.createElement("button",{className:`${e}-sign-language-close`,attributes:{type:"button","aria-label":t}});return i.appendChild(T("close")),p.attachTooltip(i,t,e),i.addEventListener("click",()=>{this.disable(),this.player.controlBar?.controls?.signLanguage&&setTimeout(()=>{this.player.controlBar.controls.signLanguage.focus({preventScroll:!0})},0)}),i}_createVideo(e){this.video=document.createElement("video"),this.video.className="vidply-sign-language-video",this.video.src=e,this.video.setAttribute("aria-label",y.t("player.signLanguage")),this.video.muted=!0,this.video.setAttribute("playsinline","")}_createResizeHandles(){let e=this.player.options.classPrefix;this.resizeHandles=["n","s","e","w","ne","nw","se","sw"].map(t=>{let i=p.createElement("div",{className:`${e}-sign-resize-handle ${e}-sign-resize-${t}`,attributes:{"data-direction":t,"data-vidply-managed-resize":"true","aria-hidden":"true"}});return i.style.display="none",i})}_applyInitialSize(){let e=this.player.storage.getSignLanguagePreferences();e?.size?.width?this.wrapper.style.width=e.size.width:this.wrapper.style.width="280px",this.wrapper.style.height="auto"}_setupInteraction(){let e=window.innerWidth<768,t=this.player.state.fullscreen;if(e&&!t){this.draggable&&(this.draggable.destroy(),this.draggable=null);return}if(this.draggable)return;let i=this.player.options.classPrefix;this.draggable=new K(this.wrapper,{dragHandle:this.header,resizeHandles:this.resizeHandles,constrainToViewport:!0,maintainAspectRatio:!0,minWidth:150,minHeight:100,classPrefix:`${i}-sign`,keyboardDragKey:"d",keyboardResizeKey:"r",keyboardStep:10,keyboardStepLarge:50,pointerResizeIndicatorText:y.t("player.signLanguageResizeActive"),onPointerResizeToggle:s=>{this.resizeHandles.forEach(a=>{a.style.display=s?"block":"none"})},onDragStart:s=>!(s.target.closest(`.${i}-sign-language-close`)||s.target.closest(`.${i}-sign-language-settings`)||s.target.closest(`.${i}-sign-language-select`)||s.target.closest(`.${i}-sign-language-label`)||s.target.closest(`.${i}-sign-language-settings-menu`))}),this._setupCustomKeyHandler(),this.interactionHandlers={draggable:this.draggable,customKeyHandler:this.customKeyHandler}}_setupCustomKeyHandler(){this.customKeyHandler=e=>{let t=e.key.toLowerCase();if(!this.settingsMenuVisible){if(t==="home"){e.preventDefault(),e.stopPropagation(),this.draggable&&(this.draggable.pointerResizeMode&&this.draggable.disablePointerResizeMode(),this.draggable.manuallyPositioned=!1,this.constrainPosition());return}if(t==="r"){e.preventDefault(),e.stopPropagation(),this.toggleResizeMode()&&this.wrapper.focus({preventScroll:!0});return}if(t==="escape"){if(e.preventDefault(),e.stopPropagation(),this.draggable?.pointerResizeMode){this.draggable.disablePointerResizeMode();return}if(this.draggable?.keyboardDragMode){this.draggable.disableKeyboardDragMode();return}this.disable(),this.player.controlBar?.controls?.signLanguage&&setTimeout(()=>{this.player.controlBar.controls.signLanguage.focus({preventScroll:!0})},0)}}},this.wrapper.addEventListener("keydown",this.customKeyHandler)}_setupEventHandlers(e){this.handlers={play:()=>{this.video&&this.video.play()},pause:()=>{this.video&&this.video.pause()},timeupdate:()=>{this.video&&Math.abs(this.video.currentTime-this.player.state.currentTime)>.5&&(this.video.currentTime=this.player.state.currentTime)},ratechange:()=>{this.video&&(this.video.playbackRate=this.player.state.playbackSpeed)}},this.player.on("play",this.handlers.play),this.player.on("pause",this.handlers.pause),this.player.on("timeupdate",this.handlers.timeupdate),this.player.on("ratechange",this.handlers.ratechange),e&&(this.handlers.captionChange=()=>{if(this.player.captionManager?.currentTrack&&this.selector){let t=this.player.captionManager.currentTrack.language?.toLowerCase().split("-")[0];t&&this.sources[t]&&this.currentLanguage!==t&&(this.switchLanguage(t),this.selector.value=t)}},this.player.on("captionsenabled",this.handlers.captionChange))}constrainPosition(){if(!this.wrapper||!this.player.videoWrapper||this.draggable?.manuallyPositioned)return;this.wrapper.style.width||(this.wrapper.style.width="280px");let e=this.player.videoWrapper.getBoundingClientRect(),t=this.player.container.getBoundingClientRect(),i=this.wrapper.getBoundingClientRect(),s=e.left-t.left,a=e.top-t.top,n=e.width,c=e.height,u=i.width||280,o=i.height||280*9/16,r,l,g=16,d=95;switch(this.desiredPosition||"bottom-right"){case"bottom-right":r=s+n-u-g,l=a+c-o-d;break;case"bottom-left":r=s+g,l=a+c-o-d;break;case"top-right":r=s+n-u-g,l=a+g;break;case"top-left":r=s+g,l=a+g;break;default:r=s+n-u-g,l=a+c-o-d}r=Math.max(s,Math.min(r,s+n-u)),l=Math.max(a,Math.min(l,a+c-o-d)),this.wrapper.style.left=`${r}px`,this.wrapper.style.top=`${l}px`,this.wrapper.style.right="auto",this.wrapper.style.bottom="auto"}showSettingsMenu(){if(this.settingsMenuJustOpened=!0,setTimeout(()=>{this.settingsMenuJustOpened=!1},350),this._addDocumentClickHandler(),this.settingsMenu){this.settingsMenu.style.display="block",this.settingsMenuVisible=!0,this.settingsButton?.setAttribute("aria-expanded","true"),this._attachMenuKeyboardNavigation(),this._positionSettingsMenu(),this._updateDragOptionState(),this._updateResizeOptionState(),R(this.settingsMenu,`.${this.player.options.classPrefix}-sign-language-settings-item`);return}this._createSettingsMenu()}hideSettingsMenu({focusButton:e=!0}={}){if(this.settingsMenu){this.settingsMenu.style.display="none",this.settingsMenuVisible=!1,this.settingsMenuJustOpened=!1,this.settingsMenuKeyHandler&&(this.settingsMenu.removeEventListener("keydown",this.settingsMenuKeyHandler),this.settingsMenuKeyHandler=null);let t=this.player.options.classPrefix;Array.from(this.settingsMenu.querySelectorAll(`.${t}-sign-language-settings-item`)).forEach(s=>s.setAttribute("tabindex","-1")),this.settingsButton&&(this.settingsButton.setAttribute("aria-expanded","false"),e&&this.settingsButton.focus({preventScroll:!0}))}}_addDocumentClickHandler(){this.documentClickHandlerAdded||(this.documentClickHandler=e=>{this.settingsMenuJustOpened||this.settingsButton&&(this.settingsButton===e.target||this.settingsButton.contains(e.target))||this.settingsMenu&&this.settingsMenu.contains(e.target)||this.settingsMenuVisible&&this.hideSettingsMenu()},setTimeout(()=>{document.addEventListener("mousedown",this.documentClickHandler,!0),this.documentClickHandlerAdded=!0},300))}_createSettingsMenu(){let e=this.player.options.classPrefix;this.settingsMenu=p.createElement("div",{className:`${e}-sign-language-settings-menu`,attributes:{role:"menu"}});let t=O({classPrefix:e,itemClass:`${e}-sign-language-settings-item`,icon:"move",label:"player.enableSignDragMode",hasTextClass:!0,onClick:()=>{this.toggleKeyboardDragMode(),this.hideSettingsMenu()}});t.setAttribute("role","switch"),t.setAttribute("aria-checked","false"),this._removeTooltipFromMenuItem(t),this.dragOptionButton=t,this.dragOptionText=t.querySelector(`.${e}-settings-text`),this._updateDragOptionState();let i=O({classPrefix:e,itemClass:`${e}-sign-language-settings-item`,icon:"resize",label:"player.enableSignResizeMode",hasTextClass:!0,onClick:a=>{a.preventDefault(),a.stopPropagation(),this.toggleResizeMode({focus:!1})?(this.hideSettingsMenu({focusButton:!1}),setTimeout(()=>{this.wrapper&&this.wrapper.focus({preventScroll:!0})},20)):this.hideSettingsMenu({focusButton:!0})}});i.setAttribute("role","switch"),i.setAttribute("aria-checked","false"),this._removeTooltipFromMenuItem(i),this.resizeOptionButton=i,this.resizeOptionText=i.querySelector(`.${e}-settings-text`),this._updateResizeOptionState();let s=O({classPrefix:e,itemClass:`${e}-sign-language-settings-item`,icon:"close",label:"transcript.closeMenu",onClick:()=>this.hideSettingsMenu()});this._removeTooltipFromMenuItem(s),this.settingsMenu.appendChild(t),this.settingsMenu.appendChild(i),this.settingsMenu.appendChild(s),this.settingsMenu.style.visibility="hidden",this.settingsMenu.style.display="block",this.settingsButton?.parentNode?this.settingsButton.insertAdjacentElement("afterend",this.settingsMenu):this.wrapper&&this.wrapper.appendChild(this.settingsMenu),this._positionSettingsMenuImmediate(),requestAnimationFrame(()=>{this.settingsMenu&&(this.settingsMenu.style.visibility="visible")}),this._attachMenuKeyboardNavigation(),this.settingsMenuVisible=!0,this.settingsButton?.setAttribute("aria-expanded","true"),this._updateDragOptionState(),this._updateResizeOptionState(),R(this.settingsMenu,`.${e}-sign-language-settings-item`)}_removeTooltipFromMenuItem(e){let t=this.player.options.classPrefix,i=e.querySelector(`.${t}-tooltip`);i&&i.remove();let s=e.querySelector(`.${t}-button-text`);s&&s.remove()}_attachMenuKeyboardNavigation(){this.settingsMenuKeyHandler&&this.settingsMenu.removeEventListener("keydown",this.settingsMenuKeyHandler),this.settingsMenuKeyHandler=V(this.settingsMenu,this.settingsButton,`.${this.player.options.classPrefix}-sign-language-settings-item`,()=>this.hideSettingsMenu({focusButton:!0}))}_positionSettingsMenuImmediate(){if(!this.settingsMenu||!this.settingsButton)return;let e=this.settingsButton.getBoundingClientRect(),t=this.settingsMenu.getBoundingClientRect(),i=window.innerWidth,s=window.innerHeight,a=this.settingsButton.parentElement;if(!a)return;let n=a.getBoundingClientRect(),c=e.left+e.width/2-n.left,u=e.bottom-n.top,o=e.top-n.top,r=e.top,l=s-e.bottom,g=u+8,d=null;l<t.height+20&&r>l?(g=null,d=n.bottom-n.top-o+8,this.settingsMenu.classList.add("vidply-menu-above")):this.settingsMenu.classList.remove("vidply-menu-above");let h=c-t.width/2,f="auto",v="translateX(0)",m=e.left+e.width/2-t.width/2;m<10?h=0:m+t.width>i-10?(h="auto",f=0):(h=c,v="translateX(-50%)"),g!==null?(this.settingsMenu.style.top=`${g}px`,this.settingsMenu.style.bottom="auto"):d!==null&&(this.settingsMenu.style.top="auto",this.settingsMenu.style.bottom=`${d}px`),h!=="auto"?(this.settingsMenu.style.left=`${h}px`,this.settingsMenu.style.right="auto"):(this.settingsMenu.style.left="auto",this.settingsMenu.style.right=`${f}px`),this.settingsMenu.style.transform=v}_positionSettingsMenu(){requestAnimationFrame(()=>{setTimeout(()=>{this._positionSettingsMenuImmediate()},10)})}toggleKeyboardDragMode(){if(this.draggable){let e=this.draggable.keyboardDragMode;this.draggable.toggleKeyboardDragMode();let t=this.draggable.keyboardDragMode;!e&&t&&this._enableMoveMode(),this._updateDragOptionState()}}_enableMoveMode(){this.wrapper.classList.add(`${this.player.options.classPrefix}-sign-move-mode`),this._updateResizeOptionState(),setTimeout(()=>{this.wrapper.classList.remove(`${this.player.options.classPrefix}-sign-move-mode`)},2e3)}toggleResizeMode({focus:e=!0}={}){return this.draggable?this.draggable.pointerResizeMode?(this.draggable.disablePointerResizeMode({focus:e}),this._updateResizeOptionState(),!1):(this.draggable.enablePointerResizeMode({focus:e}),this._updateResizeOptionState(),!0):!1}_updateDragOptionState(){if(!this.dragOptionButton)return;let e=!!this.draggable?.keyboardDragMode,t=e?y.t("player.disableSignDragMode"):y.t("player.enableSignDragMode"),i=e?y.t("player.disableSignDragModeAria"):y.t("player.enableSignDragModeAria");this.dragOptionButton.setAttribute("aria-checked",e?"true":"false"),this.dragOptionButton.setAttribute("aria-label",i),this.dragOptionText&&(this.dragOptionText.textContent=t)}_updateResizeOptionState(){if(!this.resizeOptionButton)return;let e=!!this.draggable?.pointerResizeMode,t=e?y.t("player.disableSignResizeMode"):y.t("player.enableSignResizeMode"),i=e?y.t("player.disableSignResizeModeAria"):y.t("player.enableSignResizeModeAria");this.resizeOptionButton.setAttribute("aria-checked",e?"true":"false"),this.resizeOptionButton.setAttribute("aria-label",i),this.resizeOptionText&&(this.resizeOptionText.textContent=t)}savePreferences(){this.wrapper&&this.player.storage.saveSignLanguagePreferences({size:{width:this.wrapper.style.width}})}updateSources(e,t){this.src=e||null,this.sources=t||{},this.currentLanguage=null}cleanup(){this.settingsMenuVisible&&this.hideSettingsMenu({focusButton:!1}),this.documentClickHandler&&this.documentClickHandlerAdded&&(document.removeEventListener("mousedown",this.documentClickHandler,!0),this.documentClickHandlerAdded=!1,this.documentClickHandler=null),this.settingsHandlers&&this.settingsButton&&(this.settingsButton.removeEventListener("click",this.settingsHandlers.click),this.settingsButton.removeEventListener("keydown",this.settingsHandlers.keydown)),this.settingsHandlers=null,this.handlers&&(this.player.off("play",this.handlers.play),this.player.off("pause",this.handlers.pause),this.player.off("timeupdate",this.handlers.timeupdate),this.player.off("ratechange",this.handlers.ratechange),this.handlers.captionChange&&this.player.off("captionsenabled",this.handlers.captionChange),this.handlers=null),this.wrapper&&this.customKeyHandler&&this.wrapper.removeEventListener("keydown",this.customKeyHandler),this.draggable&&(this.draggable.pointerResizeMode&&this.draggable.disablePointerResizeMode(),this.draggable.destroy(),this.draggable=null),this.interactionHandlers=null,this.wrapper?.parentNode&&(this.video&&(this.video.pause(),this.video.src=""),this.wrapper.parentNode.removeChild(this.wrapper)),this.wrapper=null,this.video=null,this.settingsButton=null,this.settingsMenu=null}destroy(){this.cleanup(),this.enabled=!1}};var oe=0,z=class L extends X{constructor(e,t={}){if(super(),this.element=typeof e=="string"?document.querySelector(e):e,!this.element)throw new Error("VidPly: Element not found");if(oe++,this.instanceId=oe,this.element.tagName!=="VIDEO"&&this.element.tagName!=="AUDIO"){let s=t.mediaType||"video",a=document.createElement(s);Array.from(this.element.attributes).forEach(c=>{c.name!=="id"&&c.name!=="class"&&!c.name.startsWith("data-")&&a.setAttribute(c.name,c.value)}),this.element.querySelectorAll("track").forEach(c=>{a.appendChild(c.cloneNode(!0))}),this.element.innerHTML="",this.element.appendChild(a),this.element=a}this._originalElement=this.element,this.options={width:null,height:null,poster:null,responsive:!0,fillContainer:!1,autoplay:!1,loop:!1,muted:!1,volume:.8,playbackSpeed:1,preload:"metadata",startTime:0,playsInline:!0,controls:!0,hideControlsDelay:3e3,playPauseButton:!0,progressBar:!0,currentTime:!0,duration:!0,volumeControl:!0,muteButton:!0,chaptersButton:!0,qualityButton:!0,captionStyleButton:!0,speedButton:!0,hideSpeedForHls:!1,hideSpeedForHlsVideo:!1,captionsButton:!0,transcriptButton:!0,fullscreenButton:!0,pipButton:!1,seekInterval:10,seekIntervalLarge:30,captions:!0,captionsDefault:!1,captionsFontSize:"100%",captionsFontFamily:"sans-serif",captionsColor:"#FFFFFF",captionsBackgroundColor:"#000000",captionsOpacity:.8,audioDescription:!0,audioDescriptionSrc:null,audioDescriptionButton:!0,signLanguage:!0,signLanguageSrc:null,signLanguageButton:!0,signLanguagePosition:"bottom-right",transcript:!1,transcriptPosition:"external",transcriptContainer:null,keyboard:!0,keyboardShortcuts:{"play-pause":[" ","p","k"],"volume-up":["ArrowUp"],"volume-down":["ArrowDown"],"seek-forward":["ArrowRight"],"seek-backward":["ArrowLeft"],mute:["m"],fullscreen:["f"],captions:["c"],"caption-style-menu":["a"],"speed-up":[">"],"speed-down":["<"],"speed-menu":["s"],"quality-menu":["q"],"chapters-menu":["j"],"transcript-toggle":["t"]},ariaLabels:{},screenReaderAnnouncements:!0,highContrast:!1,focusHighlight:!0,metadataAlerts:{},metadataHashtags:{},language:"en",languages:["en"],debug:!1,classPrefix:"vidply",iconType:"svg",pauseOthersOnPlay:!0,onReady:null,onPlay:null,onPause:null,onEnded:null,onTimeUpdate:null,onVolumeChange:null,onError:null,...t},this.options.metadataAlerts=this.options.metadataAlerts||{},this.options.metadataHashtags=this.options.metadataHashtags||{},this.storage=new W("vidply");let i=this.storage.getPlayerPreferences();i&&(i.volume!==void 0&&(this.options.volume=i.volume),i.playbackSpeed!==void 0&&(this.options.playbackSpeed=i.playbackSpeed),i.muted!==void 0&&(this.options.muted=i.muted)),this.state={ready:!1,playing:!1,paused:!0,ended:!1,buffering:!1,seeking:!1,muted:this.options.muted,volume:this.options.volume,currentTime:0,duration:0,playbackSpeed:this.options.playbackSpeed,fullscreen:!1,pip:!1,captionsEnabled:this.options.captionsDefault,currentCaption:null,controlsVisible:!0,audioDescriptionEnabled:!1,signLanguageEnabled:!1},this.originalSrc=null,this.audioDescriptionSrc=this.options.audioDescriptionSrc,this.signLanguageSrc=this.options.signLanguageSrc,this.signLanguageSources=this.options.signLanguageSources||{},this.currentSignLanguage=null,this.signLanguageVideo=null,this.audioDescriptionSourceElement=null,this.originalAudioDescriptionSource=null,this.audioDescriptionCaptionTracks=[],this._audioDescriptionDesiredState=!1,this._textTracksCache=null,this._textTracksDirty=!0,this._sourceElementsCache=null,this._sourceElementsDirty=!0,this._trackElementsCache=null,this._trackElementsDirty=!0,this.timeouts=new Set,this.container=null,this.renderer=null,this.controlBar=null,this.captionManager=null,this.keyboardManager=null,this.settingsDialog=null,this.metadataCueChangeHandler=null,this.metadataAlertHandlers=new Map,this.audioDescriptionManager=new Z(this),this.signLanguageManager=new ee(this),Object.defineProperties(this,{signLanguageWrapper:{get:()=>this.signLanguageManager.wrapper,set:s=>{this.signLanguageManager.wrapper=s}},signLanguageVideo:{get:()=>this.signLanguageManager.video,set:s=>{this.signLanguageManager.video=s}},signLanguageHeader:{get:()=>this.signLanguageManager.header,set:s=>{this.signLanguageManager.header=s}},signLanguageSettingsButton:{get:()=>this.signLanguageManager.settingsButton,set:s=>{this.signLanguageManager.settingsButton=s}},signLanguageSettingsMenu:{get:()=>this.signLanguageManager.settingsMenu,set:s=>{this.signLanguageManager.settingsMenu=s}},signLanguageSettingsMenuVisible:{get:()=>this.signLanguageManager.settingsMenuVisible,set:s=>{this.signLanguageManager.settingsMenuVisible=s}},signLanguageDraggable:{get:()=>this.signLanguageManager.draggable,set:s=>{this.signLanguageManager.draggable=s}},currentSignLanguage:{get:()=>this.signLanguageManager.currentLanguage,set:s=>{this.signLanguageManager.currentLanguage=s}}}),this.init()}async init(){try{if(this.log("Initializing VidPly player"),this.options.languageFiles)try{await y.loadLanguagesFromUrls(this.options.languageFiles)}catch(t){console.warn("Failed to load some language files:",t)}if(this.options.languageFile&&this.options.languageFileUrl)try{await y.loadLanguageFromUrl(this.options.languageFile,this.options.languageFileUrl),this.log(`Custom language file loaded for ${this.options.languageFile}`)}catch(t){console.warn(`Failed to load language file for ${this.options.languageFile}:`,t)}if(!this.options.language||this.options.language==="en"){let t=this.detectHtmlLanguage();t&&(this.options.language=t,this.log(`Auto-detected language from HTML: ${t}`))}this.options.language||(this.options.language="en"),await y.ensureLanguage(this.options.language),y.setLanguage(this.options.language),this.createContainer(),this.element.src||this.element.querySelector("source")?.src?await this.initializeRenderer():this.log("No initial source - waiting for playlist or manual load"),this.options.controls&&(this.controlBar=new Y(this),this.videoWrapper.appendChild(this.controlBar.element)),this.options.captions&&(this.captionManager=new H(this)),this.options.transcript&&await this.ensureTranscriptManager(),this.setupMetadataHandling(),this.options.keyboard&&(this.keyboardManager=new G(this)),this.setupResponsiveHandlers(),this.options.startTime>0&&this.seek(this.options.startTime),requestAnimationFrame(()=>{this.options.muted?this.mute():this.renderer&&this.renderer.media&&this.renderer.setMuted(!1),this.options.volume!==.8?this.setVolume(this.options.volume):this.renderer&&this.renderer.media&&this.renderer.setVolume(this.options.volume)}),this.state.ready=!0,this.emit("ready"),this.options.onReady&&this.options.onReady.call(this),this.options.autoplay&&this.play(),this.log("Player initialized successfully")}catch(e){this.handleError(e)}}async ensureTranscriptManager(){if(this.transcriptManager)return this.transcriptManager;if(!this.options.transcript&&!this.options.transcriptButton)return null;let e=await import("./vidply.TranscriptManager-WFZSW6NR.min.js"),t=e.TranscriptManager||e.default;return t?(this.transcriptManager=new t(this),this.transcriptManager):null}async toggleTranscript(){let e=await this.ensureTranscriptManager();e&&(e.toggleTranscript(),this.controlBar&&this.controlBar.updateTranscriptButton())}detectHtmlLanguage(){let e=document.documentElement.lang||document.documentElement.getAttribute("lang");if(!e)return null;let t=e.toLowerCase().split("-")[0];return y.translations[t]||y.builtInLanguageLoaders&&y.builtInLanguageLoaders[t]?t:(this.log(`Language "${e}" not available, using English as fallback`),null)}createContainer(){let e=this.instanceId>1?`${y.t("player.label")} ${this.instanceId}`:y.t("player.label");this.container=p.createElement("div",{className:`${this.options.classPrefix}-player`,attributes:{role:"application","aria-label":e,tabindex:"0"}});let t=this.element.tagName.toLowerCase();this.container.classList.add(`${this.options.classPrefix}-${t}`),this.options.responsive&&this.container.classList.add(`${this.options.classPrefix}-responsive`),this.videoWrapper=p.createElement("div",{className:`${this.options.classPrefix}-video-wrapper`}),this.element.parentNode.insertBefore(this.container,this.element),this.element.tagName==="AUDIO"&&this.options.poster&&(this.trackArtworkElement=p.createElement("div",{className:`${this.options.classPrefix}-track-artwork`,attributes:{"aria-hidden":"true"}}),this.trackArtworkElement.style.backgroundImage=`url(${this.options.poster})`,this.container.appendChild(this.trackArtworkElement)),this.container.appendChild(this.videoWrapper),this.videoWrapper.appendChild(this.element),this.element.controls=!1,this.element.removeAttribute("controls"),this.element.setAttribute("tabindex","-1"),this.element.style.width="100%",this.element.style.height="100%",this.element.tagName==="VIDEO"&&this.options.playsInline&&(this.element.setAttribute("playsinline",""),this.element.playsInline=!0),this.options.width&&(this.container.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width),this.options.height&&(this.container.style.height=typeof this.options.height=="number"?`${this.options.height}px`:this.options.height),this.options.poster&&this.element.tagName==="VIDEO"&&(this.element.poster=this.resolvePosterPath(this.options.poster)),this.element.tagName==="VIDEO"&&this.createPlayButtonOverlay(),this.element.vidply=this,L.instances.push(this),this.element.style.cursor="pointer",this.element.addEventListener("click",i=>{i.target===this.element&&this.toggle()}),this.on("play",()=>{this.hidePosterOverlay()}),this.on("timeupdate",()=>{this.state.currentTime>0&&this.hidePosterOverlay()}),this.element.addEventListener("loadeddata",()=>{(this.state.playing||this.state.currentTime>0)&&this.hidePosterOverlay()},{once:!0})}createPlayButtonOverlay(){this.playButtonOverlay=ae(),this.playButtonOverlay.addEventListener("click",()=>{this.toggle()}),this.videoWrapper.appendChild(this.playButtonOverlay),this.on("play",()=>{this.playButtonOverlay.style.opacity="0",this.playButtonOverlay.style.pointerEvents="none"}),this.on("pause",()=>{this.playButtonOverlay.style.opacity="1",this.playButtonOverlay.style.pointerEvents="auto",this.positionPlayOverlayOnMobile()}),this.on("ended",()=>{this.playButtonOverlay.style.opacity="1",this.playButtonOverlay.style.pointerEvents="auto",this.positionPlayOverlayOnMobile()}),this.debouncedPositionPlayOverlay=j(()=>{this.positionPlayOverlayOnMobile()},150),window.addEventListener("resize",this.debouncedPositionPlayOverlay),this.on("loadedmetadata",()=>{this.positionPlayOverlayOnMobile()}),this.on("enterfullscreen",()=>{_(()=>this.positionPlayOverlayOnMobile(),100)}),this.on("exitfullscreen",()=>{_(()=>this.positionPlayOverlayOnMobile(),100)})}positionPlayOverlayOnMobile(){if(!this.playButtonOverlay||this.element.tagName!=="VIDEO")return;if(!N()){this.playButtonOverlay.style.top="";return}let t=this.element.getBoundingClientRect(),i=this.videoWrapper.getBoundingClientRect(),s=t.top-i.top+t.height/2;this.playButtonOverlay.style.top=`${s}px`}async initializeRenderer(){let e=this._pendingSource||this.element.src||this.element.querySelector("source")?.src;if(!e)throw new Error("No media source found");this.currentSource=e,this._pendingSource=null,this.audioDescriptionManager.initFromSourceElements(this.sourceElements,this.trackElements),this.originalSrc||(this.originalSrc=e);let t=re;if(e.includes("youtube.com")||e.includes("youtu.be")){let i=await import("./vidply.YouTubeRenderer-MFC2GMAC.min.js");t=i.YouTubeRenderer||i.default}else if(e.includes("vimeo.com")){let i=await import("./vidply.VimeoRenderer-3HBMM2WR.min.js");t=i.VimeoRenderer||i.default}else if(e.includes(".m3u8")){let i=await import("./vidply.HLSRenderer-VWNJD2CB.min.js");t=i.HLSRenderer||i.default}else if(e.includes("soundcloud.com")||e.includes("api.soundcloud.com")){let i=await import("./vidply.SoundCloudRenderer-MOR2CUFH.min.js");t=i.SoundCloudRenderer||i.default}this.log(`Using ${t?.name||"HTML5Renderer"} renderer`),this.renderer=new t(this),await this.renderer.init(),this.invalidateTrackCache()}get textTracks(){return(!this._textTracksCache||this._textTracksDirty)&&(this._textTracksCache=Array.from(this.element.textTracks||[]),this._textTracksDirty=!1),this._textTracksCache}get sourceElements(){return(!this._sourceElementsCache||this._sourceElementsDirty)&&(this._sourceElementsCache=Array.from(this.element.querySelectorAll("source")),this._sourceElementsDirty=!1),this._sourceElementsCache}get trackElements(){return(!this._trackElementsCache||this._trackElementsDirty)&&(this._trackElementsCache=Array.from(this.element.querySelectorAll("track")),this._trackElementsDirty=!1),this._trackElementsCache}invalidateTrackCache(){this._textTracksDirty=!0,this._trackElementsDirty=!0,this._sourceElementsDirty=!0}findTextTrack(e,t=null){let i=this.textTracks;return t?i.find(s=>s.kind===e&&s.language===t):i.find(s=>s.kind===e)}findSourceElement(e,t=null){let i=this.sourceElements;return t?i.find(s=>s.getAttribute(e)===t):i.find(s=>s.hasAttribute(e))}findTrackElement(e){return this.trackElements.find(t=>t.track===e)}resolvePosterPath(e){if(!e||e.match(/^(https?:|\/)/))return e;try{return new URL(e,window.location.href).href}catch{return e}}async generatePosterFromVideo(e=10){if(this.element.tagName!=="VIDEO")return null;let t=this.renderer;if(!t||!t.media||t.media.tagName!=="VIDEO")return null;let i=t.media;(!i.duration||i.duration<e)&&(e=Math.min(e,Math.max(1,i.duration*.1)));let s=i;return this.controlBar&&this.controlBar.previewVideo&&this.controlBar.previewSupported&&(s=this.controlBar.previewVideo),await J(s,e,{restoreState:s===i,quality:.9})}async autoGeneratePoster(){if(this.element.getAttribute("poster")||this.element.poster||this.options.poster||this.element.tagName!=="VIDEO")return;(!this.state.duration||this.state.duration===0)&&await new Promise(i=>{let s=()=>{this.element.removeEventListener("loadedmetadata",s),i()};this.element.readyState>=1?i():this.element.addEventListener("loadedmetadata",s)});let t=await this.generatePosterFromVideo(10);t&&(this.element.poster=t,this.log("Auto-generated poster from video frame at 10 seconds","info"),this.showPosterOverlay())}showPosterOverlay(){if(!this.videoWrapper||this.element.tagName!=="VIDEO")return;let e=this.element.getAttribute("poster")||this.element.poster||this.options.poster;if(!e)return;let t=e.startsWith("data:")?e:this.resolvePosterPath(e);this.videoWrapper.style.setProperty("--vidply-poster-image",`url("${t}")`),this.videoWrapper.classList.add("vidply-forced-poster"),this._isAudioContent&&this.container?this.container.classList.add("vidply-audio-content"):this.container&&this.container.classList.remove("vidply-audio-content")}hidePosterOverlay(){this.videoWrapper&&(this.videoWrapper.classList.remove("vidply-forced-poster"),this.videoWrapper.style.removeProperty("--vidply-poster-image"))}setManagedTimeout(e,t){let i=setTimeout(()=>{this.timeouts.delete(i),e()},t);return this.timeouts.add(i),i}clearManagedTimeout(e){e&&(clearTimeout(e),this.timeouts.delete(e))}isExternalRendererUrl(e){return e?e.includes("youtube.com")||e.includes("youtu.be")||e.includes("vimeo.com")||e.includes("soundcloud.com")||e.includes("api.soundcloud.com")||e.includes(".m3u8"):!1}async load(e){try{this.log("Loading new media:",e.src),this.renderer&&this.pause();let t=window.scrollX||window.pageXOffset,i=window.scrollY||window.pageYOffset;this.trackElements.forEach(o=>o.remove()),this.invalidateTrackCache();let a=this.isExternalRendererUrl(e.src);if(a&&(this._switchingRenderer=!0),a?(this.element.removeAttribute("src"),this.element.querySelectorAll("source").forEach(r=>r.removeAttribute("src"))):(this.element.src=e.src,e.type&&(this.element.type=e.type)),this._pendingSource=e.src,this._isAudioContent=e.type&&e.type.startsWith("audio/"),this.container&&(this._isAudioContent?this.container.classList.add("vidply-audio-content"):this.container.classList.remove("vidply-audio-content")),e.poster&&this.element.tagName==="VIDEO")if(this._isAudioContent){if(this.element.removeAttribute("poster"),this.videoWrapper){let o=this.resolvePosterPath(e.poster);this.videoWrapper.style.setProperty("--vidply-poster-image",`url("${o}")`),this.videoWrapper.classList.add("vidply-forced-poster")}}else this.element.poster=this.resolvePosterPath(e.poster),this.videoWrapper&&(this.videoWrapper.classList.remove("vidply-forced-poster"),this.videoWrapper.style.removeProperty("--vidply-poster-image"));e.tracks&&e.tracks.length>0&&(e.tracks.forEach(o=>{let r=document.createElement("track");r.src=o.src,r.kind=o.kind||"captions",r.srclang=o.srclang||"en",r.label=o.label||o.srclang,o.default&&(r.default=!0),o.describedSrc&&r.setAttribute("data-desc-src",o.describedSrc);let l=this.element.firstChild;l&&l.nodeType===Node.ELEMENT_NODE&&l.tagName!=="TRACK"?this.element.insertBefore(r,l):this.element.appendChild(r)}),this.invalidateTrackCache());let n=this.state.signLanguageEnabled,c=this.state.audioDescriptionEnabled;this.audioDescriptionSrc=e.audioDescriptionSrc||null,this.signLanguageSrc=e.signLanguageSrc||null,this.originalSrc=e.src,this.audioDescriptionManager&&(this.audioDescriptionManager.updateSources(e.audioDescriptionSrc),this.audioDescriptionManager.reinitialize()),this.signLanguageManager&&this.signLanguageManager.updateSources(e.signLanguageSrc,e.signLanguageSources),c&&this.disableAudioDescription(),n&&this.disableSignLanguage();let u=this.shouldChangeRenderer(e.src);if(u&&this.renderer&&(this.renderer.destroy(),this.renderer=null),!this.renderer||u?await this.initializeRenderer():(this.renderer.media=this.element,this.element.load()),a?setTimeout(()=>{this._switchingRenderer=!1},500):this._switchingRenderer=!1,window.scrollTo(t,i),this.captionManager&&(this.captionManager.destroy(),this.captionManager=new H(this)),this.transcriptManager){let o=this.transcriptManager.isVisible;this.transcriptManager.destroy(),this.transcriptManager=null,await this.ensureTranscriptManager(),o&&this.controlBar&&this.controlBar.hasCaptionTracks()&&this.transcriptManager?.showTranscript()}this.controlBar&&this.updateControlBar(),window.scrollTo(t,i),n&&this.signLanguageSrc&&setTimeout(()=>{this.enableSignLanguage(),window.scrollTo(t,i)},150),c&&this.audioDescriptionSrc&&setTimeout(()=>{this.enableAudioDescription(),window.scrollTo(t,i)},150),this.emit("sourcechange",e),this.log("Media loaded successfully")}catch(t){this.handleError(t)}}updateControlBar(){if(!this.controlBar)return;let e=this.controlBar;e.element.innerHTML="",e.createControls(),e.attachEvents(),e.setupAutoHide(),e.setupOverflowDetection()}shouldChangeRenderer(e){if(!this.renderer)return!0;let t=e.includes("youtube.com")||e.includes("youtu.be"),i=e.includes("vimeo.com"),s=e.includes(".m3u8"),a=e.includes("soundcloud.com")||e.includes("api.soundcloud.com"),n=this.renderer.constructor.name;return!!(t&&n!=="YouTubeRenderer"||i&&n!=="VimeoRenderer"||s&&n!=="HLSRenderer"||a&&n!=="SoundCloudRenderer"||!t&&!i&&!s&&!a&&n!=="HTML5Renderer")}play(){this.renderer&&this.renderer.play()}pause(){this.renderer&&this.renderer.pause()}stop(){this.pause(),this.seek(0)}toggle(){this.state.playing?this.pause():this.play()}seek(e){this.renderer&&this.renderer.seek(e)}seekForward(e=this.options.seekInterval){this.seek(Math.min(this.state.currentTime+e,this.state.duration))}seekBackward(e=this.options.seekInterval){this.seek(Math.max(this.state.currentTime-e,0))}setVolume(e){let t=Math.max(0,Math.min(1,e));this.renderer&&this.renderer.setVolume(t),this.state.volume=t,t>0&&this.state.muted&&(this.state.muted=!1,this.renderer&&this.renderer.setMuted(!1),this.emit("volumechange")),this.savePlayerPreferences()}getVolume(){return this.state.volume}mute(){this.renderer&&this.renderer.setMuted(!0),this.state.muted=!0,this.savePlayerPreferences(),this.emit("volumechange")}unmute(){this.renderer&&this.renderer.setMuted(!1),this.state.muted=!1,this.savePlayerPreferences(),this.emit("volumechange")}toggleMute(){this.state.muted?this.unmute():this.mute()}setPlaybackSpeed(e){let t=Math.max(.25,Math.min(2,e));this.renderer&&this.renderer.setPlaybackSpeed(t),this.state.playbackSpeed=t,this.savePlayerPreferences(),this.emit("playbackspeedchange",t)}getPlaybackSpeed(){return this.state.playbackSpeed}savePlayerPreferences(){this.storage.savePlayerPreferences({volume:this.state.volume,muted:this.state.muted,playbackSpeed:this.state.playbackSpeed})}enterFullscreen(){let e=this.container,t=null;if(/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1){this._enablePseudoFullscreen();return}e.requestFullscreen?t=e.requestFullscreen():e.webkitRequestFullscreen?t=e.webkitRequestFullscreen():e.mozRequestFullScreen?t=e.mozRequestFullScreen():e.msRequestFullscreen&&(t=e.msRequestFullscreen()),t&&t.catch&&t.catch(s=>{this.log("Fullscreen API failed, using pseudo-fullscreen:",s.message),this._enablePseudoFullscreen()}),!e.requestFullscreen&&!e.webkitRequestFullscreen&&!e.mozRequestFullScreen&&!e.msRequestFullscreen?this._enablePseudoFullscreen():(this.state.fullscreen=!0,this.container.classList.add(`${this.options.classPrefix}-fullscreen`),this.emit("fullscreenchange",!0))}exitFullscreen(){!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():this._disablePseudoFullscreen(),this.state.fullscreen=!1,this.container.classList.remove(`${this.options.classPrefix}-fullscreen`),this.emit("fullscreenchange",!1)}toggleFullscreen(){this.state.fullscreen?this.exitFullscreen():this.enterFullscreen()}_enablePseudoFullscreen(){this.state.fullscreen=!0,this.container.classList.add(`${this.options.classPrefix}-fullscreen`),this._originalScrollX=window.scrollX||window.pageXOffset,this._originalScrollY=window.scrollY||window.pageYOffset,this._originalBodyOverflow=document.body.style.overflow,this._originalBodyPosition=document.body.style.position,this._originalBodyWidth=document.body.style.width,this._originalBodyHeight=document.body.style.height,this._originalHtmlOverflow=document.documentElement.style.overflow,document.body.style.overflow="hidden",document.body.style.width="100%",document.body.style.height="100%",document.documentElement.style.overflow="hidden",this._originalViewport=document.querySelector('meta[name="viewport"]')?.getAttribute("content");let e=document.querySelector('meta[name="viewport"]');e&&e.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"),window.scrollTo(0,0),this.emit("fullscreenchange",!0),this.emit("enterfullscreen")}_disablePseudoFullscreen(){if(this._originalBodyOverflow!==void 0&&(document.body.style.overflow=this._originalBodyOverflow,delete this._originalBodyOverflow),this._originalBodyPosition!==void 0&&(document.body.style.position=this._originalBodyPosition,delete this._originalBodyPosition),this._originalBodyWidth!==void 0&&(document.body.style.width=this._originalBodyWidth,delete this._originalBodyWidth),this._originalBodyHeight!==void 0&&(document.body.style.height=this._originalBodyHeight,delete this._originalBodyHeight),this._originalHtmlOverflow!==void 0&&(document.documentElement.style.overflow=this._originalHtmlOverflow,delete this._originalHtmlOverflow),this._originalViewport!==void 0){let e=document.querySelector('meta[name="viewport"]');e&&e.setAttribute("content",this._originalViewport),delete this._originalViewport}this._originalScrollX!==void 0&&this._originalScrollY!==void 0&&(window.scrollTo(this._originalScrollX,this._originalScrollY),delete this._originalScrollX,delete this._originalScrollY),this.emit("exitfullscreen")}enterPiP(){this.element.requestPictureInPicture&&(this.element.requestPictureInPicture(),this.state.pip=!0,this.emit("pipchange",!0))}exitPiP(){document.pictureInPictureElement&&(document.exitPictureInPicture(),this.state.pip=!1,this.emit("pipchange",!1))}togglePiP(){this.state.pip?this.exitPiP():this.enterPiP()}enableCaptions(){this.captionManager&&(this.captionManager.enable(),this.state.captionsEnabled=!0)}disableCaptions(){this.captionManager&&(this.captionManager.disable(),this.state.captionsEnabled=!1)}toggleCaptions(){this.state.captionsEnabled?this.disableCaptions():this.enableCaptions()}async validateTrackExists(e){try{return(await fetch(e,{method:"HEAD",cache:"no-cache"})).ok}catch{return!1}}stripVTTFormatting(e){return e?e.replace(/<[^>]+>/g,"").replace(/\n/g," ").trim().toLowerCase():""}findMatchingCaptionTime(e,t){if(!e||!t||t.length===0)return null;let i=this.stripVTTFormatting(e);for(let s of t){if(s.kind!=="captions"&&s.kind!=="subtitles")continue;let a=s.track;if(!(!a||!a.cues))for(let n=0;n<a.cues.length;n++){let c=a.cues[n],u=this.stripVTTFormatting(c.text);if(u===i)return c.startTime;let o=i.split(/\s+/).filter(l=>l.length>2),r=u.split(/\s+/).filter(l=>l.length>2);if(o.length>0&&r.length>0&&o.filter(d=>r.includes(d)).length/o.length>=.8)return c.startTime}}return null}async enableAudioDescription(){return this.audioDescriptionManager.enable()}async _legacyEnableAudioDescription(){let e=this.sourceElements.some(r=>r.getAttribute("data-desc-src")),t=this.audioDescriptionCaptionTracks.length>0;if(!this.audioDescriptionSrc&&!e&&!t){console.warn("VidPly: No audio description source, source elements, or tracks provided");return}let i=this.element.currentTime,s=this.state.playing,a=!s&&i===0,n=null;if(this.captionManager&&this.captionManager.currentTrack){let r=this.captionManager.currentTrack.track;if(r&&r.activeCues&&r.activeCues.length>0){let l=r.activeCues[0];n=this.stripVTTFormatting(l.text)}}let c=this.resolvePosterPath(this.element.getAttribute("poster")||this.element.poster||this.options.poster);a&&this.showPosterOverlay();let u=[];if(this.audioDescriptionSourceElement){let r=this.element.currentSrc||this.element.src,l=this.sourceElements,g=null,d=this.audioDescriptionSrc;for(let b of l){let w=b.getAttribute("src"),E=b.getAttribute("data-desc-src"),S=w?w.split("/").pop():"",k=r?r.split("/").pop():"";if(r&&(r===w||r.includes(w)||r.includes(S)||S&&k===S)){g=b,E?d=E:w&&(d=this.audioDescriptionSrc||d);break}}if(!g){g=this.audioDescriptionSourceElement;let b=g.getAttribute("data-desc-src");b&&(d=b)}if(this.audioDescriptionCaptionTracks.length>0){let b=this.audioDescriptionCaptionTracks.map(async S=>{if(S.trackElement&&S.describedSrc)if(S.explicit===!0)try{let k=await this.validateTrackExists(S.describedSrc);return{trackInfo:S,exists:k}}catch{return{trackInfo:S,exists:!1}}else return{trackInfo:S,exists:!1};return{trackInfo:S,exists:!1}}),w=await Promise.all(b),E=w.filter(S=>S.exists);if(E.length>0){let S=new Map;E.forEach(({trackInfo:P})=>{let B=P.trackElement.track;B?S.set(P,{wasShowing:B.mode==="showing",wasHidden:B.mode==="hidden"}):S.set(P,{wasShowing:!1,wasHidden:!1})});let k=E.map(({trackInfo:P})=>{let B=P.trackElement.getAttribute("src"),$=P.trackElement.parentNode,te=P.trackElement.nextSibling,A={};return Array.from(P.trackElement.attributes).forEach(D=>{A[D.name]=D.value}),{trackInfo:P,oldSrc:B,parent:$,nextSibling:te,attributes:A}});k.forEach(({trackInfo:P})=>{P.trackElement.remove()}),this.element.load(),await new Promise(P=>{setTimeout(()=>{k.forEach(({trackInfo:$,oldSrc:te,parent:A,nextSibling:D,attributes:F})=>{u.push($);let I=document.createElement("track");I.setAttribute("src",$.describedSrc),Object.keys(F).forEach(q=>{q!=="src"&&q!=="data-desc-src"&&I.setAttribute(q,F[q])}),D&&D.parentNode?A.insertBefore(I,D):A.appendChild(I),$.trackElement=I}),this.invalidateTrackCache();let B=()=>{this.setManagedTimeout(()=>{u.forEach($=>{let A=$.trackElement.track;if(A){let D=S.get($)||{wasShowing:!1,wasHidden:!1};A.mode="hidden";let F=()=>{D.wasShowing||D.wasHidden?A.mode="hidden":A.mode="disabled"};A.readyState>=2?F():(A.addEventListener("load",F,{once:!0}),A.addEventListener("error",F,{once:!0}))}})},300)};this.element.readyState>=1?setTimeout(B,200):(this.element.addEventListener("loadedmetadata",B,{once:!0}),setTimeout(B,2e3)),P()},100)});let C=w.length-E.length}}let h=this.sourceElements,f=[];h.forEach(b=>{let w=b.getAttribute("data-desc-src"),E=b.getAttribute("src");if(w){let S=b.getAttribute("type"),k=b.getAttribute("data-orig-src");k||(k=E),f.push({src:w,type:S,origSrc:k,descSrc:w})}else{let S=b.getAttribute("type"),k=b.getAttribute("src");f.push({src:k,type:S,origSrc:null,descSrc:null})}});let v=this.element.hasAttribute("src"),m=v?this.element.getAttribute("src"):null;v&&this.element.removeAttribute("src"),h.forEach(b=>{b.remove()}),f.forEach(b=>{let w=document.createElement("source");w.setAttribute("src",b.src),b.type&&w.setAttribute("type",b.type),b.origSrc&&w.setAttribute("data-orig-src",b.origSrc),b.descSrc&&w.setAttribute("data-desc-src",b.descSrc);let E=this.element.querySelector("track");E?this.element.insertBefore(w,E):this.element.appendChild(w)}),this._sourceElementsDirty=!0,this._sourceElementsCache=null,c&&this.element.tagName==="VIDEO"&&(this.element.poster=c),this.element.load(),await new Promise(b=>{let w=()=>{this.element.removeEventListener("loadedmetadata",w),b()};this.element.readyState>=1?b():this.element.addEventListener("loadedmetadata",w)}),await new Promise(b=>setTimeout(b,300)),(i>0||s)&&await new Promise(b=>{let w=()=>{this.element.removeEventListener("canplay",w),this.element.removeEventListener("canplaythrough",w),b()};this.element.readyState>=3?b():(this.element.addEventListener("canplay",w,{once:!0}),this.element.addEventListener("canplaythrough",w,{once:!0}),setTimeout(()=>{this.element.removeEventListener("canplay",w),this.element.removeEventListener("canplaythrough",w),b()},3e3))});let M=i;if(n&&this.captionManager&&this.captionManager.tracks.length>0){await new Promise(w=>setTimeout(w,500));let b=this.findMatchingCaptionTime(n,this.captionManager.tracks);b!==null&&(M=b,this.options.debug&&console.log(`[VidPly] Syncing via caption: ${i}s -> ${M}s`))}if(M>0&&(this.seek(M),await new Promise(b=>setTimeout(b,100))),s?(await this.play(),this.setManagedTimeout(()=>{this.hidePosterOverlay()},100)):(this.pause(),a||this.hidePosterOverlay()),!this._audioDescriptionDesiredState)return;this.state.audioDescriptionEnabled=!0,this.emit("audiodescriptionenabled")}else{if(this.audioDescriptionCaptionTracks.length>0){let g=this.audioDescriptionCaptionTracks.map(async f=>{if(f.trackElement&&f.describedSrc)if(f.explicit===!0)try{let v=await this.validateTrackExists(f.describedSrc);return{trackInfo:f,exists:v}}catch{return{trackInfo:f,exists:!1}}else return{trackInfo:f,exists:!1};return{trackInfo:f,exists:!1}}),h=(await Promise.all(g)).filter(f=>f.exists);if(h.length>0){let f=new Map;h.forEach(({trackInfo:m})=>{let M=m.trackElement.track;M?f.set(m,{wasShowing:M.mode==="showing",wasHidden:M.mode==="hidden"}):f.set(m,{wasShowing:!1,wasHidden:!1})});let v=h.map(({trackInfo:m})=>{let M=m.trackElement.getAttribute("src"),b=m.trackElement.parentNode,w=m.trackElement.nextSibling,E={};return Array.from(m.trackElement.attributes).forEach(S=>{E[S.name]=S.value}),{trackInfo:m,oldSrc:M,parent:b,nextSibling:w,attributes:E}});v.forEach(({trackInfo:m})=>{m.trackElement.remove()}),this.element.load(),setTimeout(()=>{v.forEach(({trackInfo:M,oldSrc:b,parent:w,nextSibling:E,attributes:S})=>{u.push(M);let k=document.createElement("track");k.setAttribute("src",M.describedSrc),Object.keys(S).forEach(P=>{P!=="src"&&P!=="data-desc-src"&&k.setAttribute(P,S[P])});let C=w.firstChild;C&&C.nodeType===Node.ELEMENT_NODE&&C.tagName!=="TRACK"?w.insertBefore(k,C):E&&E.parentNode?w.insertBefore(k,E):w.appendChild(k),M.trackElement=k}),this.element.load();let m=()=>{setTimeout(()=>{u.forEach(M=>{let w=M.trackElement.track;if(w){let E=f.get(M)||{wasShowing:!1,wasHidden:!1};w.mode="hidden";let S=()=>{E.wasShowing||E.wasHidden?w.mode="hidden":w.mode="disabled"};w.readyState>=2?S():(w.addEventListener("load",S,{once:!0}),w.addEventListener("error",S,{once:!0}))}})},300)};this.element.readyState>=1?setTimeout(m,200):(this.element.addEventListener("loadedmetadata",m,{once:!0}),setTimeout(m,2e3))},100)}}let r=this.sourceElements;if(r.some(g=>g.getAttribute("data-desc-src"))){let g=[];r.forEach(d=>{let h=d.getAttribute("data-desc-src"),f=d.getAttribute("src");if(h){let v=d.getAttribute("type"),m=d.getAttribute("data-orig-src");m||(m=f),g.push({src:h,type:v,origSrc:m,descSrc:h})}else{let v=d.getAttribute("type"),m=d.getAttribute("src");g.push({src:m,type:v,origSrc:null,descSrc:null})}}),r.forEach(d=>{d.remove()}),g.forEach(d=>{let h=document.createElement("source");h.setAttribute("src",d.src),d.type&&h.setAttribute("type",d.type),d.origSrc&&h.setAttribute("data-orig-src",d.origSrc),d.descSrc&&h.setAttribute("data-desc-src",d.descSrc),this.element.appendChild(h)}),c&&this.element.tagName==="VIDEO"&&(this.element.poster=c),this.element.load(),this.invalidateTrackCache()}else c&&this.element.tagName==="VIDEO"&&(this.element.poster=c),this.element.src=this.audioDescriptionSrc}await new Promise(r=>{let l=()=>{this.element.removeEventListener("loadedmetadata",l),r()};this.element.readyState>=1?r():this.element.addEventListener("loadedmetadata",l)}),(i>0||s)&&await new Promise(r=>{let l=()=>{this.element.removeEventListener("canplay",l),this.element.removeEventListener("canplaythrough",l),r()};this.element.readyState>=3?r():(this.element.addEventListener("canplay",l,{once:!0}),this.element.addEventListener("canplaythrough",l,{once:!0}),setTimeout(()=>{this.element.removeEventListener("canplay",l),this.element.removeEventListener("canplaythrough",l),r()},3e3))}),this.element.tagName==="VIDEO"&&i===0&&!s&&this.element.readyState>=1&&(this.element.currentTime=.001,this.setManagedTimeout(()=>{this.element.currentTime=0},10));let o=i;if(n&&this.captionManager&&this.captionManager.tracks.length>0){await new Promise(l=>setTimeout(l,500));let r=this.findMatchingCaptionTime(n,this.captionManager.tracks);r!==null&&(o=r,this.options.debug&&console.log(`[VidPly] Syncing via caption: ${i}s -> ${o}s`))}if(o>0&&(this.seek(o),await new Promise(r=>setTimeout(r,100))),s?(await this.play(),this.setManagedTimeout(()=>{this.hidePosterOverlay()},100)):(this.pause(),a||this.hidePosterOverlay()),u.length>0&&this.captionManager){let r=this.state.captionsEnabled,l=null;if(this.captionManager.currentTrack){let d=this.captionManager.tracks.findIndex(h=>h.track===this.captionManager.currentTrack.track);d>=0&&(l={language:this.captionManager.tracks[d].language,kind:this.captionManager.tracks[d].kind})}setTimeout(()=>{if(this.captionManager.tracks=[],this.captionManager.loadTracks(),r&&l&&this.captionManager.tracks.length>0){let d=this.captionManager.tracks.findIndex(h=>h.language===l.language&&h.kind===l.kind);if(d>=0){let h=this.captionManager.tracks[d];if(h.track.readyState>=2)this.captionManager.enable(d);else{let f=()=>{h.track.removeEventListener("load",f),h.track.removeEventListener("error",f),this.captionManager&&this.captionManager.tracks.includes(h)&&this.captionManager.enable(d)};h.track.addEventListener("load",f,{once:!0}),h.track.addEventListener("error",f,{once:!0}),h.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(h)&&this.captionManager.enable(d)},1e3)}}else if(this.captionManager.tracks.length>0){let h=this.captionManager.tracks[0];if(h.track.readyState>=2)this.captionManager.enable(0);else{let f=()=>{h.track.removeEventListener("load",f),h.track.removeEventListener("error",f),this.captionManager&&this.captionManager.tracks.includes(h)&&this.captionManager.enable(0)};h.track.addEventListener("load",f,{once:!0}),h.track.addEventListener("error",f,{once:!0}),h.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(h)&&this.captionManager.enable(0)},1e3)}}}},600)}if(this.transcriptManager&&this.transcriptManager.isVisible){let r=typeof u<"u"?u:[];if(r.length>0){let l=()=>{this.invalidateTrackCache();let d=this.textTracks,h=r.map(m=>{let M=m.trackElement,b=M.getAttribute("src"),w=M.getAttribute("srclang"),E=M.getAttribute("kind"),S=d.find(k=>M.track===k);if(S||(S=d.find(k=>{if(k.language===w&&(k.kind===E||E==="captions"&&k.kind==="subtitles")){let C=this.findTrackElement(k);if(C&&C.getAttribute("src")===b)return!0}return!1})),S){let k=this.findTrackElement(S);if(k&&k.getAttribute("src")!==b)return null}return S}).filter(Boolean);if(h.length===0){this.setManagedTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},1e3);return}h.forEach(m=>{m.mode==="disabled"&&(m.mode="hidden")});let f=0,v=()=>{f++,f>=h.length&&this.setManagedTimeout(()=>{if(this.transcriptManager&&this.transcriptManager.loadTranscriptData){this.invalidateTrackCache();let m=this.textTracks,M=r.map(w=>w.describedSrc);(h.some(w=>{let E=this.findTrackElement(w);return E&&M.includes(E.getAttribute("src"))})||h.length>0)&&this.transcriptManager.loadTranscriptData()}},800)};h.forEach(m=>{m.mode==="disabled"&&(m.mode="hidden");let M=this.findTrackElement(m),b=M?M.getAttribute("src"):null,w=r.find(S=>{let k=S.trackElement;return k&&(k.track===m||k.getAttribute("srclang")===m.language&&k.getAttribute("kind")===m.kind)}),E=w?w.describedSrc:null;if(E&&b&&b!==E){v();return}if(m.readyState>=2&&m.cues&&m.cues.length>0)v();else{m.mode==="disabled"&&(m.mode="hidden");let S=()=>{this.setManagedTimeout(v,300)};m.readyState>=2?this.setManagedTimeout(()=>{m.cues&&m.cues.length>0?v():m.addEventListener("load",S,{once:!0})},100):(m.addEventListener("load",S,{once:!0}),m.addEventListener("error",()=>{v()},{once:!0}))}})};this.setManagedTimeout(()=>{this.element.readyState>=1?l():(this.element.addEventListener("loadedmetadata",l,{once:!0}),this.setManagedTimeout(l,2e3))},500),setTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},5e3)}else setTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},800)}a||this.hidePosterOverlay(),this._audioDescriptionDesiredState&&(this.state.audioDescriptionEnabled=!0,this.emit("audiodescriptionenabled"))}async disableAudioDescription(){return this.audioDescriptionManager.disable()}async _legacyDisableAudioDescription(){if(!this.originalSrc)return;let e=this.element.currentTime,t=this.state.playing,i=null;if(this.captionManager&&this.captionManager.currentTrack){let o=this.captionManager.currentTrack.track;if(o&&o.activeCues&&o.activeCues.length>0){let r=o.activeCues[0];i=this.stripVTTFormatting(r.text)}}let s=this.resolvePosterPath(this.element.getAttribute("poster")||this.element.poster||this.options.poster),a=[];if(this.audioDescriptionCaptionTracks.length>0){let o=this.audioDescriptionCaptionTracks.map(r=>{let l=r.trackElement;if(!l||!l.parentNode)return null;let g=l.parentNode,d=l.nextSibling,h={};return Array.from(l.attributes).forEach(f=>{h[f.name]=f.value}),{trackInfo:r,parent:g,nextSibling:d,attributes:h}}).filter(Boolean);o.forEach(({trackInfo:r})=>{r.trackElement&&r.trackElement.parentNode&&r.trackElement.remove()}),this.element.load(),await new Promise(r=>{setTimeout(()=>{o.forEach(({trackInfo:l,parent:g,nextSibling:d,attributes:h})=>{a.push(l);let f=document.createElement("track");f.setAttribute("src",l.originalTrackSrc),Object.keys(h).forEach(v=>{v!=="src"&&v!=="data-desc-src"&&f.setAttribute(v,h[v])}),l.describedSrc&&f.setAttribute("data-desc-src",l.describedSrc),d&&d.parentNode?g.insertBefore(f,d):g.appendChild(f),l.trackElement=f}),this.invalidateTrackCache(),r()},100)})}let n=this.sourceElements;if(n.some(o=>o.getAttribute("data-orig-src"))){let o=[];n.forEach(g=>{let d=g.getAttribute("data-orig-src"),h=g.getAttribute("data-desc-src");if(d){let f=g.getAttribute("type");o.push({src:d,type:f,origSrc:d,descSrc:h})}else{let f=g.getAttribute("type"),v=g.getAttribute("src");o.push({src:v,type:f,origSrc:null,descSrc:h})}});let r=this.element.hasAttribute("src"),l=r?this.element.getAttribute("src"):null;r&&this.element.removeAttribute("src"),n.forEach(g=>{g.remove()}),o.forEach(g=>{let d=document.createElement("source");d.setAttribute("src",g.src),g.type&&d.setAttribute("type",g.type),g.origSrc&&d.setAttribute("data-orig-src",g.origSrc),g.descSrc&&d.setAttribute("data-desc-src",g.descSrc);let h=this.element.querySelector("track");h?this.element.insertBefore(d,h):this.element.appendChild(d)}),this._sourceElementsDirty=!0,this._sourceElementsCache=null,s&&this.element.tagName==="VIDEO"&&(this.element.poster=s),this.element.load()}else{s&&this.element.tagName==="VIDEO"&&(this.element.poster=s);let o=this.originalAudioDescriptionSource||this.originalSrc;this.element.src=o,this.element.load()}await new Promise(o=>{let r=()=>{this.element.removeEventListener("loadedmetadata",r),o()};this.element.readyState>=1?o():this.element.addEventListener("loadedmetadata",r)}),(e>0||t)&&await new Promise(o=>{let r=()=>{this.element.removeEventListener("canplay",r),this.element.removeEventListener("canplaythrough",r),o()};this.element.readyState>=3?o():(this.element.addEventListener("canplay",r,{once:!0}),this.element.addEventListener("canplaythrough",r,{once:!0}),setTimeout(()=>{this.element.removeEventListener("canplay",r),this.element.removeEventListener("canplaythrough",r),o()},3e3))});let u=e;if(i&&this.captionManager&&this.captionManager.tracks.length>0){await new Promise(r=>setTimeout(r,500));let o=this.findMatchingCaptionTime(i,this.captionManager.tracks);o!==null&&(u=o,this.options.debug&&console.log(`[VidPly] Syncing via caption: ${e}s -> ${u}s`))}if(u>0&&(this.seek(u),await new Promise(o=>setTimeout(o,100))),t?(await this.play(),this.hidePosterOverlay()):(this.pause(),!t&&u===0?this.showPosterOverlay():this.hidePosterOverlay()),a.length>0&&this.captionManager){let o=this.state.captionsEnabled,r=null;if(this.captionManager.currentTrack){let g=this.captionManager.tracks.findIndex(d=>d.track===this.captionManager.currentTrack.track);g>=0&&(r={language:this.captionManager.tracks[g].language,kind:this.captionManager.tracks[g].kind})}setTimeout(()=>{if(this.captionManager.tracks=[],this.captionManager.loadTracks(),o&&r&&this.captionManager.tracks.length>0){let g=this.captionManager.tracks.findIndex(d=>d.language===r.language&&d.kind===r.kind);if(g>=0){let d=this.captionManager.tracks[g];if(d.track.readyState>=2)this.captionManager.enable(g);else{let h=()=>{d.track.removeEventListener("load",h),d.track.removeEventListener("error",h),this.captionManager&&this.captionManager.tracks.includes(d)&&this.captionManager.enable(g)};d.track.addEventListener("load",h,{once:!0}),d.track.addEventListener("error",h,{once:!0}),d.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(d)&&this.captionManager.enable(g)},1e3)}}else if(this.captionManager.tracks.length>0){let d=this.captionManager.tracks[0];if(d.track.readyState>=2)this.captionManager.enable(0);else{let h=()=>{d.track.removeEventListener("load",h),d.track.removeEventListener("error",h),this.captionManager&&this.captionManager.tracks.includes(d)&&this.captionManager.enable(0)};d.track.addEventListener("load",h,{once:!0}),d.track.addEventListener("error",h,{once:!0}),d.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(d)&&this.captionManager.enable(0)},1e3)}}}},600)}this.transcriptManager&&this.transcriptManager.isVisible&&this.setManagedTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},500),!this._audioDescriptionDesiredState&&(this.state.audioDescriptionEnabled=!1,this.emit("audiodescriptiondisabled"))}async toggleAudioDescription(){return this.audioDescriptionManager.toggle()}enableSignLanguage(){return this.signLanguageManager.enable()}_legacyEnableSignLanguage(){let e=Object.keys(this.signLanguageSources).length>0,t=!!this.signLanguageSrc;if(!e&&!t){console.warn("No sign language video source provided");return}if(this.signLanguageWrapper){this.signLanguageWrapper.style.display="block",this.state.signLanguageEnabled=!0,this.emit("signlanguageenabled"),this.setManagedTimeout(()=>{this.signLanguageSettingsButton&&document.contains(this.signLanguageSettingsButton)&&this.signLanguageSettingsButton.focus({preventScroll:!0})},150);return}let i=null,s=null;if(e){if(this.captionManager&&this.captionManager.currentTrack){let l=this.captionManager.currentTrack.language?.toLowerCase().split("-")[0];l&&this.signLanguageSources[l]&&(i=l,s=this.signLanguageSources[l])}if(!i&&this.options.language){let l=this.options.language.toLowerCase().split("-")[0];this.signLanguageSources[l]&&(i=l,s=this.signLanguageSources[l])}i||(i=Object.keys(this.signLanguageSources)[0],s=this.signLanguageSources[i]),this.currentSignLanguage=i}else s=this.signLanguageSrc;this.signLanguageWrapper=document.createElement("div"),this.signLanguageWrapper.className="vidply-sign-language-wrapper",this.signLanguageWrapper.setAttribute("tabindex","0"),this.signLanguageWrapper.setAttribute("aria-label",y.t("player.signLanguageDragResize")),this.signLanguageHeader=p.createElement("div",{className:`${this.options.classPrefix}-sign-language-header`,attributes:{tabindex:"0"}});let a=p.createElement("div",{className:`${this.options.classPrefix}-sign-language-header-left`}),n=p.createElement("h3",{textContent:y.t("player.signLanguageVideo")}),c=y.t("player.signLanguageSettings");if(this.signLanguageSettingsButton=p.createElement("button",{className:`${this.options.classPrefix}-sign-language-settings`,attributes:{type:"button","aria-label":c,"aria-expanded":"false"}}),this.signLanguageSettingsButton.appendChild(T("settings")),p.attachTooltip(this.signLanguageSettingsButton,c,this.options.classPrefix),this.signLanguageSettingsHandlers={settingsClick:l=>{if(l.preventDefault(),l.stopPropagation(),this.signLanguageDocumentClickHandler){let g=this.signLanguageSettingsMenuJustOpened;this.signLanguageSettingsMenuJustOpened=!0,setTimeout(()=>{this.signLanguageSettingsMenuJustOpened=g},100)}this.signLanguageSettingsMenuVisible?this.hideSignLanguageSettingsMenu():this.showSignLanguageSettingsMenu()},settingsKeydown:l=>{l.key==="d"||l.key==="D"?(l.preventDefault(),l.stopPropagation(),this.toggleSignLanguageKeyboardDragMode()):l.key==="r"||l.key==="R"?(l.preventDefault(),l.stopPropagation(),this.toggleSignLanguageResizeMode()):l.key==="Escape"&&this.signLanguageSettingsMenuVisible&&(l.preventDefault(),l.stopPropagation(),this.hideSignLanguageSettingsMenu())}},this.signLanguageSettingsButton.addEventListener("click",this.signLanguageSettingsHandlers.settingsClick),this.signLanguageSettingsButton.addEventListener("keydown",this.signLanguageSettingsHandlers.settingsKeydown),a.appendChild(this.signLanguageSettingsButton),this.signLanguageSelector=null,e){let l=`${this.options.classPrefix}-sign-language-select-${Date.now()}`,g=Object.keys(this.signLanguageSources).map(v=>({value:v,text:this.getSignLanguageLabel(v),selected:v===i})),{label:d,select:h}=U({classPrefix:this.options.classPrefix,labelClass:`${this.options.classPrefix}-sign-language-label`,selectClass:`${this.options.classPrefix}-sign-language-select`,labelText:"settings.language",selectId:l,options:g,onChange:v=>{v.stopPropagation();let m=v.target.value;this.switchSignLanguage(m)}});this.signLanguageSelector=h;let f=p.createElement("div",{className:`${this.options.classPrefix}-sign-language-selector-wrapper`});f.appendChild(d),f.appendChild(this.signLanguageSelector),Q(f),a.appendChild(f)}a.appendChild(n);let u=y.t("player.closeSignLanguage"),o=p.createElement("button",{className:`${this.options.classPrefix}-sign-language-close`,attributes:{type:"button","aria-label":u}});o.appendChild(T("close")),p.attachTooltip(o,u,this.options.classPrefix),o.addEventListener("click",()=>{this.disableSignLanguage(),this.controlBar&&this.controlBar.controls&&this.controlBar.controls.signLanguage&&setTimeout(()=>{this.controlBar.controls.signLanguage.focus({preventScroll:!0})},0)}),this.signLanguageHeader.appendChild(a),this.signLanguageHeader.appendChild(o),this.signLanguageSettingsMenuVisible=!1,this.signLanguageSettingsMenu=null,this.signLanguageSettingsMenuJustOpened=!1,this.signLanguageResizeOptionButton=null,this.signLanguageResizeOptionText=null,this.signLanguageDragOptionButton=null,this.signLanguageDragOptionText=null,this.signLanguageDocumentClickHandler=null,this.signLanguageDocumentClickHandlerAdded=!1,this.signLanguageVideo=document.createElement("video"),this.signLanguageVideo.className="vidply-sign-language-video",this.signLanguageVideo.src=s,this.signLanguageVideo.setAttribute("aria-label",y.t("player.signLanguage")),this.signLanguageVideo.muted=!0,this.signLanguageVideo.setAttribute("playsinline",""),this.signLanguageResizeHandles=["n","s","e","w","ne","nw","se","sw"].map(l=>{let g=p.createElement("div",{className:`${this.options.classPrefix}-sign-resize-handle ${this.options.classPrefix}-sign-resize-${l}`,attributes:{"data-direction":l,"data-vidply-managed-resize":"true","aria-hidden":"true"}});return g.style.display="none",g}),this.signLanguageWrapper.appendChild(this.signLanguageHeader),this.signLanguageWrapper.appendChild(this.signLanguageVideo),this.signLanguageResizeHandles.forEach(l=>this.signLanguageWrapper.appendChild(l));let r=this.storage.getSignLanguagePreferences();r&&r.size&&r.size.width?this.signLanguageWrapper.style.width=r.size.width:this.signLanguageWrapper.style.width="280px",this.signLanguageWrapper.style.height="auto",this.signLanguageDesiredPosition=this.options.signLanguagePosition||"bottom-right",this.container.appendChild(this.signLanguageWrapper),requestAnimationFrame(()=>{this.constrainSignLanguagePosition()}),this.signLanguageVideo.currentTime=this.state.currentTime,this.state.paused||this.signLanguageVideo.play(),this.setupSignLanguageInteraction(),this.signLanguageHandlers={play:()=>{this.signLanguageVideo&&this.signLanguageVideo.play()},pause:()=>{this.signLanguageVideo&&this.signLanguageVideo.pause()},timeupdate:()=>{this.signLanguageVideo&&Math.abs(this.signLanguageVideo.currentTime-this.state.currentTime)>.5&&(this.signLanguageVideo.currentTime=this.state.currentTime)},ratechange:()=>{this.signLanguageVideo&&(this.signLanguageVideo.playbackRate=this.state.playbackSpeed)}},this.on("play",this.signLanguageHandlers.play),this.on("pause",this.signLanguageHandlers.pause),this.on("timeupdate",this.signLanguageHandlers.timeupdate),this.on("ratechange",this.signLanguageHandlers.ratechange),e&&(this.signLanguageHandlers.captionChange=()=>{if(this.captionManager&&this.captionManager.currentTrack&&this.signLanguageSelector){let l=this.captionManager.currentTrack.language?.toLowerCase().split("-")[0];l&&this.signLanguageSources[l]&&this.currentSignLanguage!==l&&(this.switchSignLanguage(l),this.signLanguageSelector.value=l)}},this.on("captionsenabled",this.signLanguageHandlers.captionChange)),this.state.signLanguageEnabled=!0,this.emit("signlanguageenabled"),this.setManagedTimeout(()=>{this.signLanguageSettingsButton&&document.contains(this.signLanguageSettingsButton)&&this.signLanguageSettingsButton.focus({preventScroll:!0})},150)}disableSignLanguage(){return this.signLanguageManager.disable()}toggleSignLanguage(){return this.signLanguageManager.toggle()}setupSignLanguageInteraction(){return this.signLanguageManager._setupInteraction()}_legacySetupSignLanguageInteraction(){if(!this.signLanguageWrapper)return;let e=window.innerWidth<768,t=this.state.fullscreen;if(e&&!t){this.signLanguageDraggable&&(this.signLanguageDraggable.destroy(),this.signLanguageDraggable=null);return}this.signLanguageDraggable||(this.signLanguageDraggable=new K(this.signLanguageWrapper,{dragHandle:this.signLanguageHeader,resizeHandles:this.signLanguageResizeHandles,constrainToViewport:!0,maintainAspectRatio:!0,minWidth:150,minHeight:100,classPrefix:`${this.options.classPrefix}-sign`,keyboardDragKey:"d",keyboardResizeKey:"r",keyboardStep:10,keyboardStepLarge:50,pointerResizeIndicatorText:y.t("player.signLanguageResizeActive"),onPointerResizeToggle:i=>{this.signLanguageResizeHandles.forEach(s=>{s.style.display=i?"block":"none"})},onDragStart:i=>!(i.target.closest(`.${this.options.classPrefix}-sign-language-close`)||i.target.closest(`.${this.options.classPrefix}-sign-language-settings`)||i.target.closest(`.${this.options.classPrefix}-sign-language-select`)||i.target.closest(`.${this.options.classPrefix}-sign-language-label`)||i.target.closest(`.${this.options.classPrefix}-sign-language-settings-menu`))}),this.signLanguageCustomKeyHandler=i=>{let s=i.key.toLowerCase();if(!this.signLanguageSettingsMenuVisible){if(s==="home"){i.preventDefault(),i.stopPropagation(),this.signLanguageDraggable&&(this.signLanguageDraggable.pointerResizeMode&&this.signLanguageDraggable.disablePointerResizeMode(),this.signLanguageDraggable.manuallyPositioned=!1,this.constrainSignLanguagePosition());return}if(s==="r"){i.preventDefault(),i.stopPropagation(),this.toggleSignLanguageResizeMode()&&this.signLanguageWrapper.focus({preventScroll:!0});return}if(s==="escape"){if(i.preventDefault(),i.stopPropagation(),this.signLanguageDraggable&&this.signLanguageDraggable.pointerResizeMode){this.signLanguageDraggable.disablePointerResizeMode();return}if(this.signLanguageDraggable&&this.signLanguageDraggable.keyboardDragMode){this.signLanguageDraggable.disableKeyboardDragMode();return}this.disableSignLanguage(),this.controlBar&&this.controlBar.controls&&this.controlBar.controls.signLanguage&&setTimeout(()=>{this.controlBar.controls.signLanguage.focus({preventScroll:!0})},0);return}}},this.signLanguageWrapper.addEventListener("keydown",this.signLanguageCustomKeyHandler),this.signLanguageInteractionHandlers={draggable:this.signLanguageDraggable,headerKeyHandler:this.signLanguageHeaderKeyHandler,customKeyHandler:this.signLanguageCustomKeyHandler})}toggleSignLanguageKeyboardDragMode(){if(this.signLanguageDraggable){let e=this.signLanguageDraggable.keyboardDragMode;this.signLanguageDraggable.toggleKeyboardDragMode();let t=this.signLanguageDraggable.keyboardDragMode;!e&&t&&this.enableSignLanguageMoveMode(),this.updateSignLanguageDragOptionState()}}enableSignLanguageMoveMode(){this.signLanguageWrapper.classList.add(`${this.options.classPrefix}-sign-move-mode`),this.updateSignLanguageResizeOptionState(),setTimeout(()=>{this.signLanguageWrapper.classList.remove(`${this.options.classPrefix}-sign-move-mode`)},2e3)}toggleSignLanguageResizeMode({focus:e=!0}={}){return this.signLanguageDraggable?this.signLanguageDraggable.pointerResizeMode?(this.signLanguageDraggable.disablePointerResizeMode({focus:e}),this.updateSignLanguageResizeOptionState(),!1):(this.signLanguageDraggable.enablePointerResizeMode({focus:e}),this.updateSignLanguageResizeOptionState(),!0):!1}getSignLanguageLabel(e){return{en:"English",de:"Deutsch",es:"EspaÃ±ol",fr:"FranÃ§ais",it:"Italiano",ja:"æ—¥æœ¬èªž",pt:"PortuguÃªs",ar:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",hi:"à¤¹à¤¿à¤¨à¥à¤¦à¥€"}[e]||e.toUpperCase()}switchSignLanguage(e){return this.signLanguageManager.switchLanguage(e)}_legacySwitchSignLanguage(e){if(!this.signLanguageSources[e]||!this.signLanguageVideo)return;let t=this.signLanguageVideo.currentTime,i=!this.signLanguageVideo.paused;this.signLanguageVideo.src=this.signLanguageSources[e],this.currentSignLanguage=e,this.signLanguageVideo.currentTime=t,i&&this.signLanguageVideo.play().catch(()=>{}),this.emit("signlanguagelanguagechanged",e)}showSignLanguageSettingsMenu(){return this.signLanguageManager.showSettingsMenu()}_legacyShowSignLanguageSettingsMenu(){if(this.signLanguageSettingsMenuJustOpened=!0,setTimeout(()=>{this.signLanguageSettingsMenuJustOpened=!1},350),this.signLanguageDocumentClickHandlerAdded||(this.signLanguageDocumentClickHandler=r=>{this.signLanguageSettingsMenuJustOpened||this.signLanguageSettingsButton&&(this.signLanguageSettingsButton===r.target||this.signLanguageSettingsButton.contains(r.target))||this.signLanguageSettingsMenu&&this.signLanguageSettingsMenu.contains(r.target)||this.signLanguageSettingsMenuVisible&&this.hideSignLanguageSettingsMenu()},setTimeout(()=>{document.addEventListener("mousedown",this.signLanguageDocumentClickHandler,!0),this.signLanguageDocumentClickHandlerAdded=!0},300)),this.signLanguageSettingsMenu){this.signLanguageSettingsMenu.style.display="block",this.signLanguageSettingsMenuVisible=!0,this.signLanguageSettingsButton&&this.signLanguageSettingsButton.setAttribute("aria-expanded","true"),this.signLanguageSettingsMenuKeyHandler=V(this.signLanguageSettingsMenu,this.signLanguageSettingsButton,`.${this.options.classPrefix}-sign-language-settings-item`,()=>this.hideSignLanguageSettingsMenu({focusButton:!0})),this.positionSignLanguageSettingsMenu(),this.updateSignLanguageDragOptionState(),this.updateSignLanguageResizeOptionState(),R(this.signLanguageSettingsMenu,`.${this.options.classPrefix}-sign-language-settings-item`);return}this.signLanguageSettingsMenu=p.createElement("div",{className:`${this.options.classPrefix}-sign-language-settings-menu`,attributes:{role:"menu"}});let e=O({classPrefix:this.options.classPrefix,itemClass:`${this.options.classPrefix}-sign-language-settings-item`,icon:"move",label:"player.enableSignDragMode",hasTextClass:!0,onClick:()=>{this.toggleSignLanguageKeyboardDragMode(),this.hideSignLanguageSettingsMenu()}});e.setAttribute("role","switch"),e.setAttribute("aria-checked","false");let t=e.querySelector(`.${this.options.classPrefix}-tooltip`);t&&t.remove();let i=e.querySelector(`.${this.options.classPrefix}-button-text`);i&&i.remove(),this.signLanguageDragOptionButton=e,this.signLanguageDragOptionText=e.querySelector(`.${this.options.classPrefix}-settings-text`),this.updateSignLanguageDragOptionState();let s=O({classPrefix:this.options.classPrefix,itemClass:`${this.options.classPrefix}-sign-language-settings-item`,icon:"resize",label:"player.enableSignResizeMode",hasTextClass:!0,onClick:r=>{r.preventDefault(),r.stopPropagation(),this.toggleSignLanguageResizeMode({focus:!1})?(this.hideSignLanguageSettingsMenu({focusButton:!1}),setTimeout(()=>{this.signLanguageWrapper&&this.signLanguageWrapper.focus({preventScroll:!0})},20)):this.hideSignLanguageSettingsMenu({focusButton:!0})}});s.setAttribute("role","switch"),s.setAttribute("aria-checked","false");let a=s.querySelector(`.${this.options.classPrefix}-tooltip`);a&&a.remove();let n=s.querySelector(`.${this.options.classPrefix}-button-text`);n&&n.remove(),this.signLanguageResizeOptionButton=s,this.signLanguageResizeOptionText=s.querySelector(`.${this.options.classPrefix}-settings-text`),this.updateSignLanguageResizeOptionState();let c=O({classPrefix:this.options.classPrefix,itemClass:`${this.options.classPrefix}-sign-language-settings-item`,icon:"close",label:"transcript.closeMenu",onClick:()=>{this.hideSignLanguageSettingsMenu()}}),u=c.querySelector(`.${this.options.classPrefix}-tooltip`);u&&u.remove();let o=c.querySelector(`.${this.options.classPrefix}-button-text`);o&&o.remove(),this.signLanguageSettingsMenu.appendChild(e),this.signLanguageSettingsMenu.appendChild(s),this.signLanguageSettingsMenu.appendChild(c),this.signLanguageSettingsMenu.style.visibility="hidden",this.signLanguageSettingsMenu.style.display="block",this.signLanguageSettingsButton&&this.signLanguageSettingsButton.parentNode?this.signLanguageSettingsButton.insertAdjacentElement("afterend",this.signLanguageSettingsMenu):this.signLanguageWrapper&&this.signLanguageWrapper.appendChild(this.signLanguageSettingsMenu),this.positionSignLanguageSettingsMenuImmediate(),requestAnimationFrame(()=>{this.signLanguageSettingsMenu&&(this.signLanguageSettingsMenu.style.visibility="visible")}),this.signLanguageSettingsMenuKeyHandler=V(this.signLanguageSettingsMenu,this.signLanguageSettingsButton,`.${this.options.classPrefix}-sign-language-settings-item`,()=>this.hideSignLanguageSettingsMenu({focusButton:!0})),this.signLanguageSettingsMenuVisible=!0,this.signLanguageSettingsButton&&this.signLanguageSettingsButton.setAttribute("aria-expanded","true"),this.updateSignLanguageDragOptionState(),this.updateSignLanguageResizeOptionState(),R(this.signLanguageSettingsMenu,`.${this.options.classPrefix}-sign-language-settings-item`)}hideSignLanguageSettingsMenu({focusButton:e=!0}={}){return this.signLanguageManager.hideSettingsMenu({focusButton:e})}positionSignLanguageSettingsMenuImmediate(){if(!this.signLanguageSettingsMenu||!this.signLanguageSettingsButton)return;let e=this.signLanguageSettingsButton.getBoundingClientRect(),t=this.signLanguageSettingsMenu.getBoundingClientRect(),i=window.innerWidth,s=window.innerHeight,a=this.signLanguageSettingsButton.parentElement;if(!a)return;let n=a.getBoundingClientRect(),c=e.left+e.width/2-n.left,u=e.bottom-n.top,o=e.top-n.top,r=e.top,l=s-e.bottom,g=u+8,d=null;l<t.height+20&&r>l?(g=null,d=n.bottom-n.top-o+8,this.signLanguageSettingsMenu.classList.add("vidply-menu-above")):this.signLanguageSettingsMenu.classList.remove("vidply-menu-above");let h=c-t.width/2,f="auto",v="translateX(0)",m=e.left+e.width/2-t.width/2;m<10?(h=0,v="translateX(0)"):m+t.width>i-10?(h="auto",f=0,v="translateX(0)"):(h=c,v="translateX(-50%)"),g!==null?(this.signLanguageSettingsMenu.style.top=`${g}px`,this.signLanguageSettingsMenu.style.bottom="auto"):d!==null&&(this.signLanguageSettingsMenu.style.top="auto",this.signLanguageSettingsMenu.style.bottom=`${d}px`),h!=="auto"?(this.signLanguageSettingsMenu.style.left=`${h}px`,this.signLanguageSettingsMenu.style.right="auto"):(this.signLanguageSettingsMenu.style.left="auto",this.signLanguageSettingsMenu.style.right=`${f}px`),this.signLanguageSettingsMenu.style.transform=v}positionSignLanguageSettingsMenu(){!this.signLanguageSettingsMenu||!this.signLanguageSettingsButton||!this.signLanguageWrapper||requestAnimationFrame(()=>{setTimeout(()=>{this.positionSignLanguageSettingsMenuImmediate()},10)})}attachSignLanguageSettingsMenuKeyboardNavigation(){this.signLanguageSettingsMenu&&(this.signLanguageSettingsMenuKeyHandler&&this.signLanguageSettingsMenu.removeEventListener("keydown",this.signLanguageSettingsMenuKeyHandler),this.signLanguageSettingsMenuKeyHandler=V(this.signLanguageSettingsMenu,this.signLanguageSettingsButton,`.${this.options.classPrefix}-sign-language-settings-item`,()=>this.hideSignLanguageSettingsMenu({focusButton:!0})))}updateSignLanguageDragOptionState(){if(!this.signLanguageDragOptionButton)return;let e=!!(this.signLanguageDraggable&&this.signLanguageDraggable.keyboardDragMode),t=e?y.t("player.disableSignDragMode"):y.t("player.enableSignDragMode"),i=e?y.t("player.disableSignDragModeAria"):y.t("player.enableSignDragModeAria");this.signLanguageDragOptionButton.setAttribute("aria-checked",e?"true":"false"),this.signLanguageDragOptionButton.setAttribute("aria-label",i),this.signLanguageDragOptionText&&(this.signLanguageDragOptionText.textContent=t)}updateSignLanguageResizeOptionState(){if(!this.signLanguageResizeOptionButton)return;let e=!!(this.signLanguageDraggable&&this.signLanguageDraggable.pointerResizeMode),t=e?y.t("player.disableSignResizeMode"):y.t("player.enableSignResizeMode"),i=e?y.t("player.disableSignResizeModeAria"):y.t("player.enableSignResizeModeAria");this.signLanguageResizeOptionButton.setAttribute("aria-checked",e?"true":"false"),this.signLanguageResizeOptionButton.setAttribute("aria-label",i),this.signLanguageResizeOptionText&&(this.signLanguageResizeOptionText.textContent=t)}constrainSignLanguagePosition(){return this.signLanguageManager.constrainPosition()}saveSignLanguagePreferences(){return this.signLanguageManager.savePreferences()}_legacyConstrainSignLanguagePosition(){if(!this.signLanguageWrapper||!this.videoWrapper||this.signLanguageDraggable&&this.signLanguageDraggable.manuallyPositioned)return;(!this.signLanguageWrapper.style.width||this.signLanguageWrapper.style.width==="")&&(this.signLanguageWrapper.style.width="280px");let e=this.videoWrapper.getBoundingClientRect(),t=this.container.getBoundingClientRect(),i=this.signLanguageWrapper.getBoundingClientRect(),s=e.left-t.left,a=e.top-t.top,n=e.width,c=e.height,u=i.width||280,o=i.height||280*9/16,r,l,g=16,d=95;switch(this.signLanguageDesiredPosition||"bottom-right"){case"bottom-right":r=s+n-u-g,l=a+c-o-d;break;case"bottom-left":r=s+g,l=a+c-o-d;break;case"top-right":r=s+n-u-g,l=a+g;break;case"top-left":r=s+g,l=a+g;break;default:r=s+n-u-g,l=a+c-o-d}r=Math.max(s,Math.min(r,s+n-u)),l=Math.max(a,Math.min(l,a+c-o-d)),this.signLanguageWrapper.style.left=`${r}px`,this.signLanguageWrapper.style.top=`${l}px`,this.signLanguageWrapper.style.right="auto",this.signLanguageWrapper.style.bottom="auto",this.signLanguageWrapper.classList.remove(...Array.from(this.signLanguageWrapper.classList).filter(f=>f.startsWith("vidply-sign-position-")))}_legacySaveSignLanguagePreferences(){this.signLanguageWrapper&&this.storage.saveSignLanguagePreferences({size:{width:this.signLanguageWrapper.style.width}})}cleanupSignLanguage(){return this.signLanguageManager.cleanup()}showSettings(){console.warn("[VidPly] Settings dialog has been removed. Use individual control buttons (speed, captions, etc.)")}hideSettings(){}getCurrentTime(){return this.state.currentTime}getDuration(){return this.state.duration}isPlaying(){return this.state.playing}isPaused(){return this.state.paused}isEnded(){return this.state.ended}isMuted(){return this.state.muted}isFullscreen(){return this.state.fullscreen}handleError(e){if(this._switchingRenderer){this.log("Suppressing error during renderer switch:",e,"debug");return}this.log("Error:",e,"error"),this.emit("error",e),this.options.onError&&this.options.onError.call(this,e)}log(...e){if(!this.options.debug)return;let t="log";if(e.length>0){let i=e[e.length-1];typeof i=="string"&&console[i]&&(t=i,e=e.slice(0,-1))}e.length===0&&(e=[""]),typeof console[t]=="function"?console[t]("[VidPly]",...e):console.log("[VidPly]",...e)}setupResponsiveHandlers(){if(typeof ResizeObserver<"u"?(this.resizeObserver=new ResizeObserver(e=>{for(let t of e){let i=t.contentRect.width;this.controlBar&&typeof this.controlBar.updateControlsForViewport=="function"&&this.controlBar.updateControlsForViewport(i),this.transcriptManager&&this.transcriptManager.isVisible&&this.transcriptManager.positionTranscript()}}),this.resizeObserver.observe(this.container)):(this.resizeHandler=()=>{let e=this.container.clientWidth;this.controlBar&&typeof this.controlBar.updateControlsForViewport=="function"&&this.controlBar.updateControlsForViewport(e),this.transcriptManager&&this.transcriptManager.isVisible&&(!this.transcriptManager.draggableResizable||!this.transcriptManager.draggableResizable.manuallyPositioned)&&this.transcriptManager.positionTranscript()},window.addEventListener("resize",this.resizeHandler)),window.matchMedia){this.orientationHandler=t=>{setTimeout(()=>{this.transcriptManager&&this.transcriptManager.isVisible&&(!this.transcriptManager.draggableResizable||!this.transcriptManager.draggableResizable.manuallyPositioned)&&this.transcriptManager.positionTranscript()},100)};let e=window.matchMedia("(orientation: portrait)");e.addEventListener?e.addEventListener("change",this.orientationHandler):e.addListener&&e.addListener(this.orientationHandler),this.orientationQuery=e}this.fullscreenChangeHandler=()=>{let e=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);this.state.fullscreen!==e&&(this.state.fullscreen=e,e?this.container.classList.add(`${this.options.classPrefix}-fullscreen`):(this.container.classList.remove(`${this.options.classPrefix}-fullscreen`),this._disablePseudoFullscreen()),this.emit("fullscreenchange",e),this.controlBar&&this.controlBar.updateFullscreenButton(),this.signLanguageWrapper&&this.signLanguageWrapper.style.display!=="none"&&(window.innerWidth<768&&this.setupSignLanguageInteraction(),this.setManagedTimeout(()=>{requestAnimationFrame(()=>{this.storage.saveSignLanguagePreferences({size:null}),this.signLanguageDesiredPosition="bottom-right",this.signLanguageWrapper.style.width=e?"400px":"280px",this.constrainSignLanguagePosition()})},500)))},document.addEventListener("fullscreenchange",this.fullscreenChangeHandler),document.addEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),document.addEventListener("mozfullscreenchange",this.fullscreenChangeHandler),document.addEventListener("MSFullscreenChange",this.fullscreenChangeHandler)}destroy(){if(this.log("Destroying player"),this.renderer&&this.renderer.destroy(),this.controlBar&&this.controlBar.destroy(),this.captionManager&&this.captionManager.destroy(),this.keyboardManager&&this.keyboardManager.destroy(),this.transcriptManager&&this.transcriptManager.destroy(),this.cleanupSignLanguage(),this.playButtonOverlay&&this.playButtonOverlay.parentNode&&(this.playButtonOverlay.remove(),this.playButtonOverlay=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),this.orientationQuery&&this.orientationHandler&&(this.orientationQuery.removeEventListener?this.orientationQuery.removeEventListener("change",this.orientationHandler):this.orientationQuery.removeListener&&this.orientationQuery.removeListener(this.orientationHandler),this.orientationQuery=null,this.orientationHandler=null),this.fullscreenChangeHandler&&(document.removeEventListener("fullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("mozfullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("MSFullscreenChange",this.fullscreenChangeHandler),this.fullscreenChangeHandler=null),this.timeouts.forEach(e=>clearTimeout(e)),this.timeouts.clear(),this.metadataCueChangeHandler){let t=this.textTracks.find(i=>i.kind==="metadata");t&&t.removeEventListener("cuechange",this.metadataCueChangeHandler),this.metadataCueChangeHandler=null}this.metadataAlertHandlers&&this.metadataAlertHandlers.size>0&&(this.metadataAlertHandlers.forEach(({button:e,handler:t})=>{e&&t&&e.removeEventListener("click",t)}),this.metadataAlertHandlers.clear()),this.container&&this.container.parentNode&&(this.container.parentNode.insertBefore(this.element,this.container),this.container.parentNode.removeChild(this.container)),this.removeAllListeners()}setupMetadataHandling(){let e=()=>{let i=this.textTracks.find(s=>s.kind==="metadata");if(i){if(i.mode==="disabled"&&(i.mode="hidden"),this.metadataCueChangeHandler&&i.removeEventListener("cuechange",this.metadataCueChangeHandler),this.metadataCueChangeHandler=()=>{let s=Array.from(i.activeCues||[]);s.length>0&&this.options.debug&&this.log("[Metadata] Active cues:",s.map(a=>({start:a.startTime,end:a.endTime,text:a.text}))),s.forEach(a=>{this.handleMetadataCue(a)})},i.addEventListener("cuechange",this.metadataCueChangeHandler),this.options.debug){let s=i.cues?i.cues.length:0;this.log("[Metadata] Track enabled,",s,"cues available")}}else this.options.debug&&this.log("[Metadata] No metadata track found")};e(),this.on("loadedmetadata",e)}normalizeMetadataSelector(e){if(!e)return null;let t=e.trim();return t?t.startsWith("#")||t.startsWith(".")||t.startsWith("[")?t:`#${t}`:null}resolveMetadataConfig(e,t){if(!e||!t)return null;if(Object.prototype.hasOwnProperty.call(e,t))return e[t];let i=t.replace(/^#/,"");return Object.prototype.hasOwnProperty.call(e,i)?e[i]:null}cacheMetadataAlertContent(e,t={}){if(!e)return;let i=t.titleSelector||"[data-vidply-alert-title], h3, header",s=t.messageSelector||"[data-vidply-alert-message], p",a=e.querySelector(i);a&&!a.dataset.vidplyAlertTitleOriginal&&(a.dataset.vidplyAlertTitleOriginal=a.textContent.trim());let n=e.querySelector(s);n&&!n.dataset.vidplyAlertMessageOriginal&&(n.dataset.vidplyAlertMessageOriginal=n.textContent.trim())}restoreMetadataAlertContent(e,t={}){if(!e)return;let i=t.titleSelector||"[data-vidply-alert-title], h3, header",s=t.messageSelector||"[data-vidply-alert-message], p",a=e.querySelector(i);a&&a.dataset.vidplyAlertTitleOriginal&&(a.textContent=a.dataset.vidplyAlertTitleOriginal);let n=e.querySelector(s);n&&n.dataset.vidplyAlertMessageOriginal&&(n.textContent=n.dataset.vidplyAlertMessageOriginal)}focusMetadataTarget(e,t=null){if(!(!e||e==="none")){if(e==="alert"&&t){t.focus({preventScroll:!0});return}if(e==="player"){this.container&&this.container.focus({preventScroll:!0});return}if(e==="media"){this.element.focus({preventScroll:!0});return}if(e==="playButton"){let i=this.controlBar?.controls?.playPause;i&&i.focus({preventScroll:!0});return}if(typeof e=="string"){let i=document.querySelector(e);i&&(i.tabIndex===-1&&!i.hasAttribute("tabindex")&&i.setAttribute("tabindex","-1"),i.focus({preventScroll:!0}))}}}handleMetadataAlert(e,t={}){if(!e)return;let i=this.resolveMetadataConfig(this.options.metadataAlerts,e)||{},s=t.element||document.querySelector(e);if(!s){this.options.debug&&this.log("[Metadata] Alert element not found:",e);return}this.options.debug&&this.log("[Metadata] Handling alert",e,{reason:t.reason,config:i}),this.cacheMetadataAlertContent(s,i),s.dataset.vidplyAlertOriginalDisplay||(s.dataset.vidplyAlertOriginalDisplay=s.style.display||""),s.dataset.vidplyAlertDisplay||(s.dataset.vidplyAlertDisplay=i.display||"block");let a=t.show!==void 0?t.show:i.show!==!1;if(a){let o=i.display||s.dataset.vidplyAlertDisplay||"block";s.style.display=o,s.hidden=!1,s.removeAttribute("hidden"),s.setAttribute("aria-hidden","false"),s.setAttribute("data-vidply-alert-active","true")}i.resetContent!==!1&&t.reason==="focus"&&this.restoreMetadataAlertContent(s,i);let c=t.focus!==void 0?t.focus:i.focusOnShow??t.reason!=="focus";a&&c&&(s.tabIndex===-1&&!s.hasAttribute("tabindex")&&s.setAttribute("tabindex","-1"),s.focus({preventScroll:!0})),a&&i.autoScroll!==!1&&t.autoScroll!==!1&&s.scrollIntoView({behavior:"smooth",block:"nearest"});let u=i.continueButton;if(u){let o=null;if(u==="self"||s.matches(u)?o=s:o=s.querySelector(u)||document.querySelector(u),o&&!this.metadataAlertHandlers.has(e)){let r=()=>{if(i.hideOnContinue!==!1){let d=s.dataset.vidplyAlertOriginalDisplay||"";s.style.display=i.hideDisplay||d||"none",s.setAttribute("aria-hidden","true"),s.removeAttribute("data-vidply-alert-active")}i.resume!==!1&&this.state.paused&&this.play();let g=i.focusTarget||"playButton";this.setManagedTimeout(()=>{this.focusMetadataTarget(g,s)},i.focusDelay??100)};o.addEventListener("click",r),this.metadataAlertHandlers.set(e,{button:o,handler:r})}}return s}handleMetadataHashtags(e){if(!Array.isArray(e)||e.length===0)return;let t=this.options.metadataHashtags;t&&e.forEach(i=>{let s=this.resolveMetadataConfig(t,i);if(!s)return;let a=this.normalizeMetadataSelector(s.alert||s.selector||s.target);if(!a)return;let n=document.querySelector(a);if(!n){this.options.debug&&this.log("[Metadata] Hashtag target not found:",a);return}if(this.options.debug&&this.log("[Metadata] Handling hashtag",i,{selector:a,config:s}),this.cacheMetadataAlertContent(n,s),s.title){let o=s.titleSelector||"[data-vidply-alert-title], h3, header",r=n.querySelector(o);r&&(r.textContent=s.title)}if(s.message){let o=s.messageSelector||"[data-vidply-alert-message], p",r=n.querySelector(o);r&&(r.textContent=s.message)}let c=s.show!==!1,u=s.focus!==void 0?s.focus:!1;this.handleMetadataAlert(a,{element:n,show:c,focus:u,autoScroll:s.autoScroll,reason:"hashtag"})})}handleMetadataCue(e){let t=e.text.trim();this.options.debug&&this.log("[Metadata] Processing cue:",{time:e.startTime,text:t}),this.emit("metadata",{time:e.startTime,endTime:e.endTime,text:t,cue:e}),t.includes("PAUSE")&&(this.state.paused||(this.options.debug&&this.log("[Metadata] Pausing video at",e.startTime),this.pause()),this.emit("metadata:pause",{time:e.startTime,text:t}));let i=t.match(/FOCUS:([\w#-]+)/);if(i){let a=i[1],n=this.normalizeMetadataSelector(a),c=n?document.querySelector(n):null;c?(this.options.debug&&this.log("[Metadata] Focusing element:",n),c.tabIndex===-1&&!c.hasAttribute("tabindex")&&c.setAttribute("tabindex","-1"),this.setManagedTimeout(()=>{c.focus({preventScroll:!0})},10)):this.options.debug&&this.log("[Metadata] Element not found:",n||a),this.emit("metadata:focus",{time:e.startTime,target:a,selector:n,element:c,text:t}),n&&this.handleMetadataAlert(n,{element:c,reason:"focus"})}let s=t.match(/#[\w-]+/g);s&&(this.options.debug&&this.log("[Metadata] Hashtags found:",s),this.emit("metadata:hashtags",{time:e.startTime,hashtags:s,text:t}),this.handleMetadataHashtags(s))}};z.instances=[];var ce=0,se=class{constructor(e,t={}){this.player=e,this.tracks=[],this.initialTracks=Array.isArray(t.tracks)?t.tracks:[],this.currentIndex=-1,this.instanceId=++ce,this.uniqueId=`vidply-playlist-${this.instanceId}`,this.options={autoAdvance:t.autoAdvance!==!1,autoPlayFirst:t.autoPlayFirst!==!1,loop:t.loop||!1,showPanel:t.showPanel!==!1,recreatePlayers:t.recreatePlayers||!1,...t},this.container=null,this.playlistPanel=null,this.trackInfoElement=null,this.navigationFeedback=null,this.isPanelVisible=this.options.showPanel!==!1,this.isChangingTrack=!1,this.hostElement=t.hostElement||null,this.PlayerClass=t.PlayerClass||null,this.handleTrackEnd=this.handleTrackEnd.bind(this),this.handleTrackError=this.handleTrackError.bind(this),this.player.playlistManager=this,this.init(),this.updatePlayerControls(),this.initialTracks.length>0&&this.loadPlaylist(this.initialTracks)}getTrackMediaType(e){let t=e.src||"";return t.includes("youtube.com")||t.includes("youtu.be")?"youtube":t.includes("vimeo.com")?"vimeo":t.includes("soundcloud.com")||t.includes("api.soundcloud.com")?"soundcloud":t.includes(".m3u8")?"hls":e.type&&e.type.startsWith("audio/")?"audio":"video"}async recreatePlayerForTrack(e,t=!1){if(!this.hostElement||!this.PlayerClass)return console.warn("VidPly Playlist: Cannot recreate player - missing hostElement or PlayerClass"),!1;let i=this.getTrackMediaType(e),s=i==="audio"?"audio":"video",a=this.isPanelVisible,n=[...this.tracks],c=this.currentIndex;this.trackArtworkElement&&this.trackArtworkElement.parentNode&&this.trackArtworkElement.parentNode.removeChild(this.trackArtworkElement),this.trackInfoElement&&this.trackInfoElement.parentNode&&this.trackInfoElement.parentNode.removeChild(this.trackInfoElement),this.navigationFeedback&&this.navigationFeedback.parentNode&&this.navigationFeedback.parentNode.removeChild(this.navigationFeedback),this.playlistPanel&&this.playlistPanel.parentNode&&this.playlistPanel.parentNode.removeChild(this.playlistPanel),this.player&&(this.player.off("ended",this.handleTrackEnd),this.player.off("error",this.handleTrackError),this.player.destroy()),this.hostElement.innerHTML="";let u=document.createElement(s);u.setAttribute("preload","metadata"),s==="video"&&e.poster&&(i==="video"||i==="hls")&&u.setAttribute("poster",e.poster);let o=["youtube","vimeo","soundcloud","hls"].includes(i);if(!o){let l=document.createElement("source");l.src=e.src,e.type&&(l.type=e.type),u.appendChild(l),e.tracks&&e.tracks.length>0&&e.tracks.forEach(g=>{let d=document.createElement("track");d.src=g.src,d.kind=g.kind||"captions",d.srclang=g.srclang||"en",d.label=g.label||g.srclang,g.default&&(d.default=!0),u.appendChild(d)})}this.hostElement.appendChild(u);let r={mediaType:s,poster:e.poster,audioDescriptionSrc:e.audioDescriptionSrc||null,audioDescriptionDuration:e.audioDescriptionDuration||null,signLanguageSrc:e.signLanguageSrc||null};if(this.player=new this.PlayerClass(u,r),this.player.playlistManager=this,await new Promise(l=>{this.player.on("ready",l)}),this.player.on("ended",this.handleTrackEnd),this.player.on("error",this.handleTrackError),this.player.container){if(this.trackArtworkElement){let l=this.player.container.querySelector(".vidply-video-wrapper");l?this.player.container.insertBefore(this.trackArtworkElement,l):this.player.container.appendChild(this.trackArtworkElement)}this.trackInfoElement&&this.player.container.appendChild(this.trackInfoElement),this.navigationFeedback&&this.player.container.appendChild(this.navigationFeedback),this.playlistPanel&&this.player.container.appendChild(this.playlistPanel)}return this.container=this.player.container,this.updatePlayerControls(),this.tracks=n,this.currentIndex=c,this.updatePlaylistUI(),this.isPanelVisible=a,this.playlistPanel&&(this.playlistPanel.style.display=a?"":"none"),o?this.player.load({src:e.src,type:e.type,poster:e.poster,tracks:e.tracks||[],audioDescriptionSrc:e.audioDescriptionSrc||null,signLanguageSrc:e.signLanguageSrc||null}):this.player.load({src:e.src,type:e.type,poster:e.poster,tracks:e.tracks||[],audioDescriptionSrc:e.audioDescriptionSrc||null,signLanguageSrc:e.signLanguageSrc||null}),t&&setTimeout(()=>{this.player.play()},100),!0}init(){this.player.on("ended",this.handleTrackEnd),this.player.on("error",this.handleTrackError),this.player.on("play",this.handlePlaybackStateChange.bind(this)),this.player.on("pause",this.handlePlaybackStateChange.bind(this)),this.player.on("ended",this.handlePlaybackStateChange.bind(this)),this.player.on("fullscreenchange",this.handleFullscreenChange.bind(this)),this.player.on("audiodescriptionenabled",this.handleAudioDescriptionChange.bind(this)),this.player.on("audiodescriptiondisabled",this.handleAudioDescriptionChange.bind(this)),this.options.showPanel&&this.createUI(),this.tracks.length===0&&this.initialTracks.length===0&&this.loadPlaylistFromAttribute()}loadPlaylistFromAttribute(){if(!this.player.element||!this.player.element.parentElement){console.log("VidPly Playlist: No player element found");return}let t=this.player.element.parentElement.parentElement,i=t?t.parentElement:null;if(!i){console.log("VidPly Playlist: No original element found");return}this.loadOptionsFromAttributes(i);let s=i.getAttribute("data-playlist");if(!s){console.log("VidPly Playlist: No data-playlist attribute found");return}console.log("VidPly Playlist: Found data-playlist attribute, parsing...");try{let a=JSON.parse(s);Array.isArray(a)&&a.length>0?(console.log(`VidPly Playlist: Loaded ${a.length} tracks from data-playlist`),this.loadPlaylist(a)):console.warn("VidPly Playlist: data-playlist is not a valid array or is empty")}catch(a){console.error("VidPly Playlist: Failed to parse data-playlist attribute",a)}}loadOptionsFromAttributes(e){let t=e.getAttribute("data-playlist-auto-advance");t!==null&&(this.options.autoAdvance=t==="true");let i=e.getAttribute("data-playlist-auto-play-first");i!==null&&(this.options.autoPlayFirst=i==="true");let s=e.getAttribute("data-playlist-loop");s!==null&&(this.options.loop=s==="true");let a=e.getAttribute("data-playlist-show-panel");a!==null&&(this.options.showPanel=a==="true"),console.log("VidPly Playlist: Options from attributes:",this.options)}updatePlayerControls(){if(!this.player.controlBar)return;let e=this.player.controlBar;e.element.innerHTML="",e.createControls(),e.attachEvents(),e.setupAutoHide()}loadPlaylist(e){this.tracks=e,this.currentIndex=-1,this.container&&this.container.classList.add("vidply-has-playlist"),this.playlistPanel&&this.renderPlaylist(),e.length>0&&(this.options.autoPlayFirst?this.play(0):this.loadTrack(0)),this.updatePlaylistVisibilityInFullscreen()}async loadTrack(e){if(e<0||e>=this.tracks.length){console.warn("VidPly Playlist: Invalid track index",e);return}let t=this.tracks[e];if(this.isChangingTrack=!0,this.currentIndex=e,this.options.recreatePlayers&&this.hostElement&&this.PlayerClass){let i=this.player?this.player.element.tagName==="AUDIO"?"audio":"video":null,s=this.getTrackMediaType(t);if(i!==(s==="audio"||s==="soundcloud"?"audio":"video")){await this.recreatePlayerForTrack(t,!1),this.updateTrackInfo(t),this.updatePlaylistUI(),this.player.emit("playlisttrackchange",{index:e,item:t,total:this.tracks.length}),setTimeout(()=>{this.isChangingTrack=!1},150);return}}this.player.load({src:t.src,type:t.type,poster:t.poster,tracks:t.tracks||[],audioDescriptionSrc:t.audioDescriptionSrc||null,signLanguageSrc:t.signLanguageSrc||null}),this.updateTrackInfo(t),this.updatePlaylistUI(),this.player.emit("playlisttrackchange",{index:e,item:t,total:this.tracks.length}),setTimeout(()=>{this.isChangingTrack=!1},150)}async play(e,t=!1){if(e<0||e>=this.tracks.length){console.warn("VidPly Playlist: Invalid track index",e);return}let i=this.tracks[e];if(this.isChangingTrack=!0,this.currentIndex=e,this.options.recreatePlayers&&this.hostElement&&this.PlayerClass){let s=this.player?this.player.element.tagName==="AUDIO"?"audio":"video":null,a=this.getTrackMediaType(i);if(s!==(a==="audio"||a==="soundcloud"?"audio":"video")){await this.recreatePlayerForTrack(i,!0),this.updateTrackInfo(i),this.updatePlaylistUI(),this.player.emit("playlisttrackchange",{index:e,item:i,total:this.tracks.length}),setTimeout(()=>{this.isChangingTrack=!1},150);return}}this.player.load({src:i.src,type:i.type,poster:i.poster,tracks:i.tracks||[],audioDescriptionSrc:i.audioDescriptionSrc||null,signLanguageSrc:i.signLanguageSrc||null}),this.updateTrackInfo(i),this.updatePlaylistUI(),this.player.emit("playlisttrackchange",{index:e,item:i,total:this.tracks.length}),setTimeout(()=>{this.player.play(),setTimeout(()=>{this.isChangingTrack=!1},50)},100)}next(){let e=this.currentIndex+1;if(e>=this.tracks.length)if(this.options.loop)e=0;else return;this.play(e)}previous(){let e=this.currentIndex-1;if(e<0)if(this.options.loop)e=this.tracks.length-1;else return;this.play(e)}handleTrackEnd(){this.isChangingTrack||this.options.autoAdvance&&this.next()}isExternalRendererUrl(e){return e?e.includes("youtube.com")||e.includes("youtu.be")||e.includes("vimeo.com")||e.includes("soundcloud.com")||e.includes("api.soundcloud.com")||e.includes(".m3u8"):!1}handleTrackError(e){let t=this.getCurrentTrack();t&&t.src&&this.isExternalRendererUrl(t.src)||this.isChangingTrack||(console.error("VidPly Playlist: Track error",e),this.options.autoAdvance&&setTimeout(()=>{this.next()},1e3))}handlePlaybackStateChange(){this.updatePlaylistVisibilityInFullscreen()}handleFullscreenChange(){setTimeout(()=>{this.updatePlaylistVisibilityInFullscreen()},50)}handleAudioDescriptionChange(){let e=this.getCurrentTrack();e&&(this.updateTrackInfo(e),this.updatePlaylistUI(),this.updatePlaylistDurations())}updatePlaylistDurations(){if(!this.playlistPanel)return;this.playlistPanel.querySelectorAll(".vidply-playlist-item").forEach((t,i)=>{let s=this.tracks[i];if(!s)return;let a=this.getEffectiveDuration(s),n=a?x.formatTime(a):"",c=t.querySelector(".vidply-playlist-duration-badge");c&&(c.textContent=n);let u=t.querySelector(".vidply-playlist-item-duration");u&&(u.textContent=n)})}getEffectiveDuration(e){return e?this.player.state.audioDescriptionEnabled&&e.audioDescriptionDuration?e.audioDescriptionDuration:e.duration||null:null}updatePlaylistVisibilityInFullscreen(){if(!this.playlistPanel||!this.tracks.length)return;let e=this.player.state.fullscreen,t=this.player.state.playing;e?t?(this.playlistPanel.classList.remove("vidply-playlist-fullscreen-visible"),setTimeout(()=>{this.player.state.playing&&this.player.state.fullscreen&&(this.playlistPanel.style.display="none")},300)):(this.playlistPanel.classList.add("vidply-playlist-fullscreen-visible"),this.playlistPanel.style.display="block"):(this.playlistPanel.classList.remove("vidply-playlist-fullscreen-visible"),this.isPanelVisible&&this.tracks.length>0?this.playlistPanel.style.display="block":this.playlistPanel.style.display="none")}createUI(){if(this.container=this.player.container,!this.container){console.warn("VidPly Playlist: No container found");return}if(this.player.element.tagName==="AUDIO"){this.trackArtworkElement=p.createElement("div",{className:"vidply-track-artwork",attributes:{"aria-hidden":"true"}}),this.trackArtworkElement.style.display="none";let e=this.container.querySelector(".vidply-video-wrapper");e?this.container.insertBefore(this.trackArtworkElement,e):this.container.appendChild(this.trackArtworkElement)}this.trackInfoElement=p.createElement("div",{className:"vidply-track-info",attributes:{role:"status"}}),this.trackInfoElement.style.display="none",this.container.appendChild(this.trackInfoElement),this.navigationFeedback=p.createElement("div",{className:"vidply-sr-only",attributes:{role:"status","aria-live":"polite","aria-atomic":"true"}}),this.container.appendChild(this.navigationFeedback),this.playlistPanel=p.createElement("div",{className:"vidply-playlist-panel",attributes:{id:`${this.uniqueId}-panel`,role:"region","aria-label":y.t("playlist.title"),"aria-labelledby":`${this.uniqueId}-heading`}}),this.playlistPanel.style.display=(this.isPanelVisible,"none"),this.container.appendChild(this.playlistPanel)}updateTrackInfo(e){if(!this.trackInfoElement)return;let t=this.currentIndex+1,i=this.tracks.length,s=e.title||y.t("playlist.untitled"),a=e.artist||"",n=this.getEffectiveDuration(e),c=n?x.formatTime(n):"",u=n?x.formatDuration(n):"",o=a?y.t("playlist.by")+a:"",r=u?`. ${u}`:"",l=y.t("playlist.nowPlaying",{current:t,total:i,title:s,artist:o})+r,g=y.t("playlist.trackOf",{current:t,total:i}),d=c?`<span class="vidply-track-duration" aria-hidden="true">${p.escapeHTML(c)}</span>`:"",h=e.description||"";this.trackInfoElement.innerHTML=`
      <span class="vidply-sr-only">${p.escapeHTML(l)}</span>
      <div class="vidply-track-header" aria-hidden="true">
        <span class="vidply-track-number">${p.escapeHTML(g)}</span>
        ${d}
      </div>
      <div class="vidply-track-title" aria-hidden="true">${p.escapeHTML(s)}</div>
      ${a?`<div class="vidply-track-artist" aria-hidden="true">${p.escapeHTML(a)}</div>`:""}
      ${h?`<div class="vidply-track-description" aria-hidden="true">${p.escapeHTML(h)}</div>`:""}
    `,this.trackInfoElement.style.display="block",this.updateTrackArtwork(e)}updateTrackArtwork(e){this.trackArtworkElement&&(e.poster?(this.trackArtworkElement.style.backgroundImage=`url(${e.poster})`,this.trackArtworkElement.style.display="block"):this.trackArtworkElement.style.display="none")}renderPlaylist(){if(!this.playlistPanel)return;this.playlistPanel.innerHTML="";let e=p.createElement("h2",{className:"vidply-playlist-header",attributes:{id:`${this.uniqueId}-heading`}});e.textContent=`${y.t("playlist.title")} (${this.tracks.length})`,this.playlistPanel.appendChild(e);let t=p.createElement("div",{className:"vidply-sr-only",attributes:{id:`${this.uniqueId}-keyboard-instructions`}});t.textContent=y.t("playlist.keyboardInstructions"),this.playlistPanel.appendChild(t);let i=p.createElement("ul",{className:"vidply-playlist-list",attributes:{role:"listbox","aria-labelledby":`${this.uniqueId}-heading`,"aria-describedby":`${this.uniqueId}-keyboard-instructions`}});this.tracks.forEach((s,a)=>{let n=this.createPlaylistItem(s,a);i.appendChild(n)}),this.playlistPanel.appendChild(i),this.isPanelVisible&&(this.playlistPanel.style.display="block")}createPlaylistItem(e,t){let i=y.t("playlist.trackOf",{current:t+1,total:this.tracks.length}),s=e.title||y.t("playlist.trackUntitled",{number:t+1}),a=e.artist?y.t("playlist.by")+e.artist:"",n=this.getEffectiveDuration(e),c=n?x.formatTime(n):"",u=n?x.formatDuration(n):"",o=t===this.currentIndex,r=`${s}${a}`;u&&(r+=`. ${u}`);let l=p.createElement("li",{className:o?"vidply-playlist-item vidply-playlist-item-active":"vidply-playlist-item",attributes:{"data-playlist-index":t}}),g=p.createElement("button",{className:"vidply-playlist-item-button",attributes:{type:"button",role:"option",tabIndex:t===0?0:-1,"aria-label":r,"aria-posinset":t+1,"aria-setsize":this.tracks.length,"aria-checked":o?"true":"false"}});o&&(g.setAttribute("aria-current","true"),g.setAttribute("tabIndex","0"));let d=p.createElement("span",{className:"vidply-playlist-thumbnail-container",attributes:{"aria-hidden":"true"}}),h=p.createElement("span",{className:"vidply-playlist-thumbnail"});if(e.poster)h.style.backgroundImage=`url(${e.poster})`;else{let b=T("music");b.classList.add("vidply-playlist-thumbnail-icon"),h.appendChild(b)}if(d.appendChild(h),c&&e.poster){let b=p.createElement("span",{className:"vidply-playlist-duration-badge"});b.textContent=c,d.appendChild(b)}g.appendChild(d);let f=p.createElement("span",{className:"vidply-playlist-item-info",attributes:{"aria-hidden":"true"}}),v=p.createElement("span",{className:"vidply-playlist-item-title-row"}),m=p.createElement("span",{className:"vidply-playlist-item-title"});if(m.textContent=s,v.appendChild(m),c&&!e.poster){let b=p.createElement("span",{className:"vidply-playlist-item-duration"});b.textContent=c,v.appendChild(b)}if(f.appendChild(v),e.artist){let b=p.createElement("span",{className:"vidply-playlist-item-artist"});b.textContent=e.artist,f.appendChild(b)}if(e.description){let b=p.createElement("span",{className:"vidply-playlist-item-description"});b.textContent=e.description,f.appendChild(b)}g.appendChild(f);let M=T("play");return M.classList.add("vidply-playlist-item-icon"),M.setAttribute("aria-hidden","true"),g.appendChild(M),g.addEventListener("click",()=>{this.play(t,!0)}),g.addEventListener("keydown",b=>{this.handlePlaylistItemKeydown(b,t)}),l.appendChild(g),l}handlePlaylistItemKeydown(e,t){let i=Array.from(this.playlistPanel.querySelectorAll(".vidply-playlist-item-button")),s=-1,a="";switch(e.key){case"Enter":case" ":e.preventDefault(),e.stopPropagation(),this.play(t,!0);return;case"ArrowDown":e.preventDefault(),e.stopPropagation(),t<i.length-1?s=t+1:a=y.t("playlist.endOfPlaylist",{current:i.length,total:i.length});break;case"ArrowUp":e.preventDefault(),e.stopPropagation(),t>0?s=t-1:a=y.t("playlist.beginningOfPlaylist",{total:i.length});break;case"PageDown":e.preventDefault(),e.stopPropagation(),s=Math.min(t+5,i.length-1),s===i.length-1&&t!==s&&(a=y.t("playlist.jumpedToLastTrack",{current:s+1,total:i.length}));break;case"PageUp":e.preventDefault(),e.stopPropagation(),s=Math.max(t-5,0),s===0&&t!==s&&(a=y.t("playlist.jumpedToFirstTrack",{total:i.length}));break;case"Home":e.preventDefault(),e.stopPropagation(),s=0,t!==0&&(a=y.t("playlist.firstTrack",{total:i.length}));break;case"End":e.preventDefault(),e.stopPropagation(),s=i.length-1,t!==i.length-1&&(a=y.t("playlist.lastTrack",{current:i.length,total:i.length}));break}if(s!==-1&&s!==t){i[t].setAttribute("tabIndex","-1"),i[s].setAttribute("tabIndex","0"),i[s].focus({preventScroll:!1});let n=i[s].closest(".vidply-playlist-item");n&&n.scrollIntoView({behavior:"smooth",block:"nearest"})}a&&this.navigationFeedback&&(this.navigationFeedback.textContent=a,setTimeout(()=>{this.navigationFeedback&&(this.navigationFeedback.textContent="")},1e3))}updatePlaylistUI(){if(!this.playlistPanel)return;let e=this.playlistPanel.querySelectorAll(".vidply-playlist-item"),t=this.playlistPanel.querySelectorAll(".vidply-playlist-item-button");e.forEach((i,s)=>{let a=t[s];if(!a)return;let n=this.tracks[s],c=y.t("playlist.trackOf",{current:s+1,total:this.tracks.length}),u=n.title||y.t("playlist.trackUntitled",{number:s+1}),o=n.artist?y.t("playlist.by")+n.artist:"",r=this.getEffectiveDuration(n),l=r?x.formatDuration(r):"";if(s===this.currentIndex){i.classList.add("vidply-playlist-item-active"),a.setAttribute("aria-current","true"),a.setAttribute("aria-checked","true"),a.setAttribute("tabIndex","0");let g=`${u}${o}`;l&&(g+=`. ${l}`),a.setAttribute("aria-label",g),i.scrollIntoView({behavior:"smooth",block:"nearest"})}else{i.classList.remove("vidply-playlist-item-active"),a.removeAttribute("aria-current"),a.setAttribute("aria-checked","false"),a.setAttribute("tabIndex","-1");let g=`${u}${o}`;l&&(g+=`. ${l}`),a.setAttribute("aria-label",g)}})}getCurrentTrack(){return this.tracks[this.currentIndex]||null}getPlaylistInfo(){return{currentIndex:this.currentIndex,totalTracks:this.tracks.length,currentTrack:this.getCurrentTrack(),hasNext:this.hasNext(),hasPrevious:this.hasPrevious()}}hasNext(){return this.options.loop?!0:this.currentIndex<this.tracks.length-1}hasPrevious(){return this.options.loop?!0:this.currentIndex>0}addTrack(e){this.tracks.push(e),this.playlistPanel&&this.renderPlaylist()}removeTrack(e){e<0||e>=this.tracks.length||(this.tracks.splice(e,1),e<this.currentIndex?this.currentIndex--:e===this.currentIndex&&(this.currentIndex>=this.tracks.length&&(this.currentIndex=this.tracks.length-1),this.currentIndex>=0&&this.play(this.currentIndex)),this.playlistPanel&&this.renderPlaylist())}clear(){this.tracks=[],this.currentIndex=-1,this.playlistPanel&&(this.playlistPanel.innerHTML="",this.playlistPanel.style.display="none"),this.trackInfoElement&&(this.trackInfoElement.innerHTML="",this.trackInfoElement.style.display="none"),this.trackArtworkElement&&(this.trackArtworkElement.style.backgroundImage="",this.trackArtworkElement.style.display="none")}togglePanel(e){return this.playlistPanel?((e!==void 0?e:this.playlistPanel.style.display==="none")?(this.playlistPanel.style.display="block",this.isPanelVisible=!0,this.tracks.length>0&&setTimeout(()=>{let i=this.playlistPanel.querySelector('.vidply-playlist-item[tabindex="0"]');i&&i.focus({preventScroll:!0})},100),this.player.controlBar&&this.player.controlBar.controls.playlistToggle&&(this.player.controlBar.controls.playlistToggle.setAttribute("aria-expanded","true"),this.player.controlBar.controls.playlistToggle.setAttribute("aria-pressed","true"))):(this.playlistPanel.style.display="none",this.isPanelVisible=!1,this.player.controlBar&&this.player.controlBar.controls.playlistToggle&&(this.player.controlBar.controls.playlistToggle.setAttribute("aria-expanded","false"),this.player.controlBar.controls.playlistToggle.setAttribute("aria-pressed","false"),this.player.controlBar.controls.playlistToggle.focus({preventScroll:!0}))),this.isPanelVisible):!1}showPanel(){return this.togglePanel(!0)}hidePanel(){return this.togglePanel(!1)}destroy(){this.player.off("ended",this.handleTrackEnd),this.player.off("error",this.handleTrackError),this.trackArtworkElement&&this.trackArtworkElement.remove(),this.trackInfoElement&&this.trackInfoElement.remove(),this.playlistPanel&&this.playlistPanel.remove(),this.clear()}};function le(){document.querySelectorAll("[data-vidply]").forEach(e=>{let t=e.dataset.vidplyOptions?JSON.parse(e.dataset.vidplyOptions):{},s={...ue(e.dataset),...t};new z(e,s)})}function ue(L){let e={},t={signLanguageSrc:"signLanguageSrc",signLanguageButton:"signLanguageButton",signLanguagePosition:"signLanguagePosition",audioDescriptionSrc:"audioDescriptionSrc",audioDescriptionButton:"audioDescriptionButton",autoplay:"autoplay",loop:"loop",muted:"muted",controls:"controls",poster:"poster",width:"width",height:"height",language:"language",captions:"captions",captionsDefault:"captionsDefault",transcript:"transcript",transcriptButton:"transcriptButton",keyboard:"keyboard",responsive:"responsive",pipButton:"pipButton",fullscreenButton:"fullscreenButton"};Object.keys(t).forEach(s=>{let a=t[s],n=L[s];n!==void 0&&(n==="true"?e[a]=!0:n==="false"?e[a]=!1:!isNaN(n)&&n!==""?e[a]=Number(n):e[a]=n)});let i={};if(Object.keys(L).forEach(s=>{if(s.startsWith("signLanguageSrc")&&s!=="signLanguageSrc"){let a=s.match(/^signLanguageSrc([A-Z][a-z]*)$/);if(a){let n=a[1].toLowerCase();i[n]=L[s]}}}),Object.keys(i).length>0&&(e.signLanguageSources=i,L.signLanguageSrc&&!e.signLanguageSrc&&(e.signLanguageSrc=L.signLanguageSrc)),L.vidplyLanguageFiles)try{e.languageFiles=JSON.parse(L.vidplyLanguageFiles)}catch(s){console.warn("Invalid JSON in data-vidply-language-files:",s)}if(L.vidplyLanguageFile)try{let s=JSON.parse(L.vidplyLanguageFile);typeof s=="object"&&s!==null&&(e.languageFiles=s)}catch{L.vidplyLanguageFileCode&&L.vidplyLanguageFileUrl&&(e.languageFile=L.vidplyLanguageFileCode,e.languageFileUrl=L.vidplyLanguageFileUrl)}else L.vidplyLanguageFileCode&&L.vidplyLanguageFileUrl&&(e.languageFile=L.vidplyLanguageFileCode,e.languageFileUrl=L.vidplyLanguageFileUrl);return e}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",le):le();var ot=z;export{z as Player,se as PlaylistManager,ot as default};
