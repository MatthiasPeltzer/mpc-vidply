/*!
 * Universal, Accessible Video Player
 * (c) 2025 Matthias Peltzer
 * Released under GPL-2.0-or-later License
 */
import{a as ee}from"./vidply.chunk-OXXPY2XB.min.js";import{a as u,b as d,c as x,d as w,e as G,f as j,g as Z,h as V,i as te,j as q,k as W,l as Y,m as ie,n as se}from"./vidply.chunk-5DWTMWEO.min.js";var z=class{constructor(){this.events={}}on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),this}once(e,t){let i=(...s)=>{t(...s),this.off(e,i)};return this.on(e,i)}off(e,t){return this.events[e]?(t?this.events[e]=this.events[e].filter(i=>i!==t):delete this.events[e],this):this}emit(e,...t){return this.events[e]?(this.events[e].forEach(i=>{i(...t)}),this):this}removeAllListeners(){return this.events={},this}};var _=class{constructor(e){this.player=e,this.element=null,this.controls={},this.hideTimeout=null,this.isDraggingProgress=!1,this.isDraggingVolume=!1,this.openMenu=null,this.openMenuButton=null,this.init()}init(){this.createElement(),this.createControls(),this.attachEvents(),this.setupAutoHide(),this.setupOverflowDetection()}isMobile(){return window.innerWidth<768}isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}positionMenu(e,t,i=!1){let s=this.isMobile(),n=e.classList.contains(`${this.player.options.classPrefix}-overflow-menu-list`);if(this.player.state.fullscreen&&e.parentElement===this.player.container){let h=()=>{let o=t.getBoundingClientRect(),a=e.getBoundingClientRect(),l=this.player.container.getBoundingClientRect(),g=window.innerHeight,p=o.left+o.width/2-l.left,y=o.top-l.top,b=o.bottom-l.top,k=o.top-l.top,m=l.bottom-o.bottom;if(k>=a.height+20||k>m?(e.style.bottom=`${l.height-y+8}px`,e.style.top="auto",e.classList.remove("vidply-menu-below")):(e.style.top=`${b+8}px`,e.style.bottom="auto",e.classList.add("vidply-menu-below")),n){let M=o.right-l.left;e.style.right=`${l.width-M}px`,e.style.left="auto",e.style.transform="none"}else e.style.left=`${p}px`,e.style.right="auto",e.style.transform="translateX(-50%)"};i?h():requestAnimationFrame(h);return}if(s){let h=e.classList.contains(`${this.player.options.classPrefix}-volume-menu`),o=()=>{let a=t.parentElement;if(!a)return;let l=t.getBoundingClientRect(),g=a.getBoundingClientRect(),p=e.getBoundingClientRect(),y=window.innerWidth,b=window.innerHeight;if(h){let k=l.left+l.width/2-g.left;e.style.left=`${k}px`,e.style.right="auto",e.style.transform="translateX(-50%)";return}p.right>y&&(e.style.left="auto",e.style.right="10px",e.style.transform="none"),p.left<0&&(e.style.left="10px",e.style.right="auto",e.style.transform="none"),p.top<10&&(e.style.top="10px"),p.bottom>b-10&&(e.style.bottom="10px",e.style.top="auto")};i?o():requestAnimationFrame(o);return}let c=()=>{let h=t.getBoundingClientRect(),o=e.getBoundingClientRect(),a=window.innerWidth,l=window.innerHeight,g=t.parentElement;if(!g)return;let p=g.getBoundingClientRect(),y=h.left+h.width/2-p.left,b=h.bottom-p.top,k=h.top-p.top,m=h.top,M=l-h.bottom,f=k-o.height-8,v=null;m<o.height+20&&M>m?(f=null,v=p.bottom-p.top-b+8,e.classList.add("vidply-menu-below")):e.classList.remove("vidply-menu-below");let E="auto",L="auto",S="translateX(0)";if(n)E="auto",L=0,S="translateX(0)";else{E=y-o.width/2;let C=h.left+h.width/2-o.width/2;C<10?(E=0,S="translateX(0)"):C+o.width>a-10?(E="auto",L=0,S="translateX(0)"):(E=y,S="translateX(-50%)")}f!==null?(e.style.top=`${f}px`,e.style.bottom="auto"):v!==null&&(e.style.top="auto",e.style.bottom=`${v}px`),E!=="auto"?(e.style.left=`${E}px`,e.style.right="auto"):(e.style.left="auto",e.style.right=`${L}px`),e.style.transform=S};i?c():requestAnimationFrame(()=>{setTimeout(c,10)})}insertMenuIntoDOM(e,t){e.id||(e.id=`vidply-menu-${Math.random().toString(36).substr(2,9)}`),t.setAttribute("aria-controls",e.id),t.setAttribute("aria-haspopup","true"),this.player.state.fullscreen?(this.player.container.appendChild(e),e.dataset.triggerButton=t.getAttribute("aria-label")||"button"):t.insertAdjacentElement("afterend",e)}attachMenuCloseHandler(e,t,i=!1){this.openMenu&&this.openMenu!==e&&this.openMenuButton&&(this.openMenuButton._vidplyBlurHandler&&(this.openMenuButton.removeEventListener("blur",this.openMenuButton._vidplyBlurHandler),delete this.openMenuButton._vidplyBlurHandler),this.openMenuButton._vidplyMousedownHandler&&(this.openMenuButton.removeEventListener("mousedown",this.openMenuButton._vidplyMousedownHandler),delete this.openMenuButton._vidplyMousedownHandler),this.openMenu&&document.contains(this.openMenu)?this.openMenu.remove():this.openMenu&&this.openMenu.parentNode&&this.openMenu.parentNode.removeChild(this.openMenu),this.openMenuButton&&this.openMenuButton.setAttribute("aria-expanded","false")),this.openMenu=e,this.openMenuButton=t,this.positionMenu(e,t),t&&t.setAttribute("aria-expanded","true");let s=!1,n=!0,r=()=>{s=!0,n=!1,setTimeout(()=>{s=!1,n=!0},200)};t.addEventListener("mousedown",r),t._vidplyMousedownHandler=r;let c=l=>{if(!n||s||this.openMenu!==e)return;let g=l.relatedTarget;requestAnimationFrame(()=>{setTimeout(()=>{if(!n||this.openMenu!==e)return;let p=document.activeElement;if(e.contains(p))return;let y=this.player.signLanguageWrapper,b=this.player.transcriptManager?.transcriptWindow;if(y&&y.contains(p)||b&&b.contains(p))return;let k=this.element.querySelectorAll("button"),m=Array.from(k).includes(p)&&p!==t,M=g&&Array.from(k).includes(g)&&g!==t;if(m||M){if(this.openMenu!==e)return;e&&document.contains(e)?e.remove():e&&e.parentNode&&e.parentNode.removeChild(e),t&&t.setAttribute("aria-expanded","false"),this.openMenu===e&&(this.openMenu=null,this.openMenuButton=null),t.removeEventListener("blur",c),t.removeEventListener("mousedown",r),delete t._vidplyBlurHandler,delete t._vidplyMousedownHandler}},10)})};t.addEventListener("blur",c),t._vidplyBlurHandler=c;let h=()=>{this.closeMenuAndReturnFocus(e,t)},o=null,a=null;setTimeout(()=>{o=l=>{i&&e.contains(l.target)||this.openMenu===e&&!e.contains(l.target)&&!t.contains(l.target)&&(h(),o&&document.removeEventListener("click",o),a&&document.removeEventListener("keydown",a))},a=l=>{l.key==="Escape"&&this.openMenu===e&&(l.preventDefault(),l.stopPropagation(),this.closeMenuAndReturnFocus(e,t,!0),o&&document.removeEventListener("click",o),a&&document.removeEventListener("keydown",a))},document.addEventListener("click",o),document.addEventListener("keydown",a)},100)}closeMenuAndReturnFocus(e,t,i=!0){e&&(document.contains(e)?e.remove():e.parentNode&&e.parentNode.removeChild(e)),t&&(t.setAttribute("aria-expanded","false"),e&&e.id&&t.removeAttribute("aria-controls"),i&&requestAnimationFrame(()=>{setTimeout(()=>{t&&document.contains(t)&&t.focus({preventScroll:!0})},0)})),this.openMenu===e&&(this.openMenu=null,this.openMenuButton=null)}closeOpenMenu(){this.openMenu&&this.openMenuButton&&(this.openMenu&&document.contains(this.openMenu)?this.openMenu.remove():this.openMenu&&this.openMenu.parentNode&&this.openMenu.parentNode.removeChild(this.openMenu),this.openMenuButton&&this.openMenuButton.setAttribute("aria-expanded","false"),this.openMenu=null,this.openMenuButton=null)}attachMenuKeyboardNavigation(e,t){let i=Array.from(e.querySelectorAll(`.${this.player.options.classPrefix}-menu-item`));if(i.length===0)return;let s=n=>{let r=i.indexOf(document.activeElement);switch(n.key){case"ArrowDown":n.preventDefault(),n.stopPropagation();let c=(r+1)%i.length;i[c].focus({preventScroll:!1}),i[c].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"ArrowUp":n.preventDefault(),n.stopPropagation();let h=(r-1+i.length)%i.length;i[h].focus({preventScroll:!1}),i[h].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"ArrowLeft":case"ArrowRight":n.preventDefault(),n.stopPropagation();break;case"Home":n.preventDefault(),n.stopPropagation(),i[0].focus({preventScroll:!1}),i[0].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"End":n.preventDefault(),n.stopPropagation(),i[i.length-1].focus({preventScroll:!1}),i[i.length-1].scrollIntoView({behavior:"smooth",block:"nearest"});break;case"Enter":case" ":n.preventDefault(),n.stopPropagation(),document.activeElement&&i.includes(document.activeElement)&&(document.activeElement.click(),j(t,{delay:0}));break;case"Escape":n.preventDefault(),n.stopPropagation(),this.closeMenuAndReturnFocus(e,t,!0);break}};e.addEventListener("keydown",s)}createElement(){this.element=u.createElement("div",{className:`${this.player.options.classPrefix}-controls`,attributes:{role:"region","aria-label":d.t("player.label")+" controls"}})}createControls(){let e=u.createElement("div",{className:`${this.player.options.classPrefix}-progress-time-wrapper`});this.player.options.progressBar&&(this.createProgressBar(),e.appendChild(this.controls.progress)),(this.player.options.currentTime||this.player.options.duration)&&e.appendChild(this.createTimeDisplay()),this.element.appendChild(e);let t=u.createElement("div",{className:`${this.player.options.classPrefix}-controls-buttons`}),i=u.createElement("div",{className:`${this.player.options.classPrefix}-controls-left`});this.player.playlistManager&&i.appendChild(this.createPreviousButton()),this.player.options.playPauseButton&&i.appendChild(this.createPlayPauseButton()),i.appendChild(this.createRestartButton()),this.player.playlistManager&&i.appendChild(this.createNextButton()),this.player.playlistManager||i.appendChild(this.createRewindButton()),this.player.playlistManager||i.appendChild(this.createForwardButton()),this.player.options.volumeControl&&(this.isTouchDevice()?i.appendChild(this.createMuteButton()):i.appendChild(this.createVolumeControl())),this.rightButtons=u.createElement("div",{className:`${this.player.options.classPrefix}-controls-right`});let s=this.hasChapterTracks(),n=this.hasCaptionTracks(),r=this.hasQualityLevels(),c=this.hasAudioDescription();if(this.player.options.chaptersButton&&s){let a=this.createChaptersButton();a.dataset.overflowPriority="3",a.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(a)}if(this.player.options.captionsButton&&n){let a=this.createCaptionsButton();a.dataset.overflowPriority="1",a.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(a)}if(this.player.options.captionStyleButton&&n){let a=this.createCaptionStyleButton();a.dataset.overflowPriority="3",a.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(a)}if(this.player.options.speedButton){let a=this.createSpeedButton();a.dataset.overflowPriority="1",a.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(a)}if(this.player.options.audioDescriptionButton&&c){let a=this.createAudioDescriptionButton();a.dataset.overflowPriority="2",a.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(a)}if(this.player.options.transcriptButton&&n){let a=this.createTranscriptButton();a.dataset.overflowPriority="3",a.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(a)}if(this.player.playlistManager&&this.player.options.playlistToggleButton!==!1){let a=this.createPlaylistToggleButton();a.dataset.overflowPriority="2",a.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(a)}let h=this.hasSignLanguage();if(this.player.options.signLanguageButton&&h){let a=this.createSignLanguageButton();a.dataset.overflowPriority="3",a.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(a)}if(this.player.options.qualityButton&&r){let a=this.createQualityButton();a.dataset.overflowPriority="2",a.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(a)}if(this.player.options.pipButton&&"pictureInPictureEnabled"in document){let a=this.createPipButton();a.dataset.overflowPriority="3",a.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(a)}let o=this.player.element.tagName.toLowerCase()==="audio";if(this.player.options.fullscreenButton&&!o){let a=this.createFullscreenButton();a.dataset.overflowPriority="1",a.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(a)}this.overflowMenuButton=this.createOverflowMenuButton(),this.overflowMenuButton.style.display="none",this.rightButtons.appendChild(this.overflowMenuButton),t.appendChild(i),t.appendChild(this.rightButtons),this.element.appendChild(t),this.ensureButtonTooltips(t)}ensureButtonTooltips(e){e.querySelectorAll("button").forEach(i=>{if(i.querySelector(`.${this.player.options.classPrefix}-tooltip`)||i.querySelector(`.${this.player.options.classPrefix}-button-text`)||i.getAttribute("role")==="menuitem"||i.classList.contains(`${this.player.options.classPrefix}-settings-item`)||i.classList.contains(`${this.player.options.classPrefix}-menu-item`)||i.classList.contains(`${this.player.options.classPrefix}-transcript-settings-item`)||i.classList.contains(`${this.player.options.classPrefix}-sign-language-settings-item`)||i.classList.contains(`${this.player.options.classPrefix}-popup-settings-item`))return;let s=i.getAttribute("aria-label");s&&u.attachTooltip(i,s,this.player.options.classPrefix)})}hasChapterTracks(){let e=this.player.element.textTracks;for(let t=0;t<e.length;t++)if(e[t].kind==="chapters")return!0;return!1}hasCaptionTracks(){let e=this.player.element.textTracks;for(let t=0;t<e.length;t++)if(e[t].kind==="captions"||e[t].kind==="subtitles")return!0;return!1}hasQualityLevels(){if(this.player.renderer&&this.player.renderer.getQualities){let e=this.player.renderer.getQualities();return e&&e.length>1}return!1}hasAudioDescription(){return this.player.audioDescriptionSrc&&this.player.audioDescriptionSrc.length>0?!0:Array.from(this.player.element.textTracks||[]).some(t=>t.kind==="descriptions")}hasSignLanguage(){let e=this.player.signLanguageSrc&&this.player.signLanguageSrc.length>0,t=this.player.signLanguageSources&&Object.keys(this.player.signLanguageSources).length>0;return e||t}createProgressBar(){let e=u.createElement("div",{className:`${this.player.options.classPrefix}-progress-container`,attributes:{role:"slider","aria-label":d.t("player.progress"),"aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":"0",tabindex:"0"}});this.controls.buffered=u.createElement("div",{className:`${this.player.options.classPrefix}-progress-buffered`}),this.controls.played=u.createElement("div",{className:`${this.player.options.classPrefix}-progress-played`}),this.controls.progressHandle=u.createElement("div",{className:`${this.player.options.classPrefix}-progress-handle`}),this.controls.progressTooltip=u.createElement("div",{className:`${this.player.options.classPrefix}-progress-tooltip`}),e.appendChild(this.controls.buffered),e.appendChild(this.controls.played),this.controls.played.appendChild(this.controls.progressHandle),e.appendChild(this.controls.progressTooltip),this.controls.progress=e,this.setupProgressBarEvents()}setupProgressBarEvents(){let e=this.controls.progress,t=i=>{let s=e.getBoundingClientRect(),n=s.width>0?Math.max(0,Math.min(1,(i-s.left)/s.width)):0,r=this.player.state.duration||0,c=n*r;return{percent:n,time:c}};e.addEventListener("mousedown",i=>{this.isDraggingProgress=!0;let{time:s}=t(i.clientX);this.player.seek(s)}),document.addEventListener("mousemove",i=>{if(this.isDraggingProgress){let{time:s}=t(i.clientX);this.player.seek(s)}}),document.addEventListener("mouseup",()=>{this.isDraggingProgress=!1}),e.addEventListener("mousemove",i=>{if(!this.isDraggingProgress){let{time:s}=t(i.clientX);this.controls.progressTooltip.textContent=x.formatTime(s),this.controls.progressTooltip.style.left=`${i.clientX-e.getBoundingClientRect().left}px`,this.controls.progressTooltip.style.display="block"}}),e.addEventListener("mouseleave",()=>{this.controls.progressTooltip.style.display="none"}),e.addEventListener("keydown",i=>{i.key==="ArrowLeft"?(i.preventDefault(),this.player.seekBackward(5)):i.key==="ArrowRight"&&(i.preventDefault(),this.player.seekForward(5))}),e.addEventListener("touchstart",i=>{this.isDraggingProgress=!0;let s=i.touches[0],{time:n}=t(s.clientX);this.player.seek(n)}),e.addEventListener("touchmove",i=>{if(this.isDraggingProgress){i.preventDefault();let s=i.touches[0],{time:n}=t(s.clientX);this.player.seek(n)}}),e.addEventListener("touchend",()=>{this.isDraggingProgress=!1})}createPlayPauseButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-play-pause`,attributes:{type:"button","aria-label":d.t("player.play")}});return e.appendChild(w("play")),e.addEventListener("click",()=>{this.player.toggle()}),this.controls.playPause=e,e}createRestartButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-restart`,attributes:{type:"button","aria-label":d.t("player.restart")}});return e.appendChild(w("restart")),e.addEventListener("click",()=>{this.player.seek(0),this.player.play()}),e}createPreviousButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-previous`,attributes:{type:"button","aria-label":d.t("player.previous")}});e.appendChild(w("skipPrevious")),e.addEventListener("click",()=>{this.player.playlistManager&&this.player.playlistManager.previous()});let t=()=>{this.player.playlistManager&&(e.disabled=!this.player.playlistManager.hasPrevious()&&!this.player.playlistManager.options.loop)};return this.player.on("playlisttrackchange",t),t(),this.controls.previous=e,e}createNextButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-next`,attributes:{type:"button","aria-label":d.t("player.next")}});e.appendChild(w("skipNext")),e.addEventListener("click",()=>{this.player.playlistManager&&this.player.playlistManager.next()});let t=()=>{this.player.playlistManager&&(e.disabled=!this.player.playlistManager.hasNext()&&!this.player.playlistManager.options.loop)};return this.player.on("playlisttrackchange",t),t(),this.controls.next=e,e}createPlaylistToggleButton(){let e=this.player.playlistManager?`${this.player.playlistManager.uniqueId}-panel`:"vidply-playlist-panel",t=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-playlist-toggle`,attributes:{type:"button","aria-label":d.t("player.playlist"),"aria-expanded":"false","aria-pressed":"false","aria-controls":e}});return t.appendChild(w("playlist")),t.addEventListener("click",()=>{this.player.playlistManager&&this.player.playlistManager.togglePanel()}),this.controls.playlistToggle=t,t}createRewindButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-rewind`,attributes:{type:"button","aria-label":d.t("player.rewindSeconds",{seconds:15})}});return e.appendChild(w("rewind")),e.addEventListener("click",()=>{this.player.seekBackward(15)}),e}createForwardButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-forward`,attributes:{type:"button","aria-label":d.t("player.forwardSeconds",{seconds:15})}});return e.appendChild(w("forward")),e.addEventListener("click",()=>{this.player.seekForward(15)}),e}createMuteButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-mute`,attributes:{type:"button","aria-label":d.t("player.mute")}});return e.appendChild(w("volumeHigh")),e.addEventListener("click",()=>{this.player.toggleMute()}),this.controls.mute=e,e}createVolumeControl(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-mute`,attributes:{type:"button","aria-label":d.t("player.volume"),"aria-expanded":"false"}});return e.appendChild(w("volumeHigh")),e.addEventListener("contextmenu",t=>{t.preventDefault(),this.player.toggleMute()}),e.addEventListener("click",()=>{this.showVolumeSlider(e)}),this.controls.mute=e,e}showVolumeSlider(e){let t=document.querySelector(`.${this.player.options.classPrefix}-volume-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false");return}let i=u.createElement("div",{className:`${this.player.options.classPrefix}-volume-menu ${this.player.options.classPrefix}-menu`}),s=u.createElement("div",{className:`${this.player.options.classPrefix}-volume-slider`,attributes:{role:"slider","aria-label":d.t("player.volume"),"aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":String(Math.round(this.player.state.volume*100)),tabindex:"0"}}),n=u.createElement("div",{className:`${this.player.options.classPrefix}-volume-track`}),r=u.createElement("div",{className:`${this.player.options.classPrefix}-volume-fill`}),c=this.player.state.volume*100;r.style.height=`${c}%`;let h=u.createElement("div",{className:`${this.player.options.classPrefix}-volume-handle`});n.appendChild(r),r.appendChild(h),s.appendChild(n),i.appendChild(s);let o=a=>{let l=n.getBoundingClientRect(),g=Math.max(0,Math.min(1,1-(a-l.top)/l.height));this.player.setVolume(g)};s.addEventListener("mousedown",a=>{a.stopPropagation(),a.preventDefault(),this.isDraggingVolume=!0,o(a.clientY)}),document.addEventListener("mousemove",a=>{this.isDraggingVolume&&o(a.clientY)}),document.addEventListener("mouseup",()=>{this.isDraggingVolume=!1}),s.addEventListener("touchstart",a=>{a.stopPropagation(),a.preventDefault(),this.isDraggingVolume=!0;let l=a.touches[0];o(l.clientY)},{passive:!1}),s.addEventListener("touchmove",a=>{if(this.isDraggingVolume){a.preventDefault();let l=a.touches[0];o(l.clientY)}},{passive:!1}),s.addEventListener("touchend",a=>{a.stopPropagation(),a.preventDefault(),this.isDraggingVolume=!1},{passive:!1}),s.addEventListener("touchcancel",()=>{this.isDraggingVolume=!1}),s.addEventListener("keydown",a=>{a.key==="ArrowUp"?(a.preventDefault(),this.player.setVolume(Math.min(1,this.player.state.volume+.1))):a.key==="ArrowDown"?(a.preventDefault(),this.player.setVolume(Math.max(0,this.player.state.volume-.1))):a.key==="Escape"&&(a.preventDefault(),a.stopPropagation(),this.closeMenuAndReturnFocus(i,e,!0))}),i.addEventListener("click",a=>{a.stopPropagation()}),i.addEventListener("touchstart",a=>{a.stopPropagation()}),i.addEventListener("touchmove",a=>{a.stopPropagation()}),i.addEventListener("touchend",a=>{a.stopPropagation()}),i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.controls.volumeSlider=s,this.controls.volumeFill=r,j(s,{delay:50}),this.attachMenuCloseHandler(i,e,!0)}createTimeDisplay(){let e=u.createElement("div",{className:`${this.player.options.classPrefix}-time`,attributes:{role:"group","aria-label":d.t("time.display")}});this.controls.currentTimeDisplay=u.createElement("span",{className:`${this.player.options.classPrefix}-current-time`});let t=u.createElement("span",{textContent:"00:00",attributes:{"aria-hidden":"true"}}),i=u.createElement("span",{className:"vidply-sr-only",textContent:d.t("time.seconds",{count:0})});this.controls.currentTimeDisplay.appendChild(t),this.controls.currentTimeDisplay.appendChild(i),this.controls.currentTimeVisual=t,this.controls.currentTimeAccessible=i;let s=u.createElement("span",{textContent:" / ",attributes:{"aria-hidden":"true"}});this.controls.durationDisplay=u.createElement("span",{className:`${this.player.options.classPrefix}-duration`});let n=u.createElement("span",{textContent:"00:00",attributes:{"aria-hidden":"true"}}),r=u.createElement("span",{className:"vidply-sr-only",textContent:d.t("time.durationPrefix")+d.t("time.seconds",{count:0})});return this.controls.durationDisplay.appendChild(n),this.controls.durationDisplay.appendChild(r),this.controls.durationVisual=n,this.controls.durationAccessible=r,e.appendChild(this.controls.currentTimeDisplay),e.appendChild(s),e.appendChild(this.controls.durationDisplay),e}createChaptersButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-chapters`,attributes:{type:"button","aria-label":d.t("player.chapters"),"aria-expanded":"false"}});return e.appendChild(w("chapters")),e.addEventListener("click",()=>{this.showChaptersMenu(e)}),this.controls.chapters=e,e}showChaptersMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-chapters-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=u.createElement("div",{className:`${this.player.options.classPrefix}-chapters-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu","aria-label":d.t("player.chapters")}}),s=Array.from(this.player.element.textTracks).filter(n=>n.kind==="chapters");if(s.length===0){let n=u.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:d.t("player.noChapters"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(n)}else{let n=s[0];if(n.mode==="disabled"&&(n.mode="hidden"),!n.cues||n.cues.length===0){let r=u.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:d.t("player.loadingChapters"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(r);let c=()=>{i.remove(),this.showChaptersMenu(e)};n.addEventListener("load",c,{once:!0}),setTimeout(()=>{n.cues&&n.cues.length>0&&document.contains(i)&&(i.remove(),this.showChaptersMenu(e))},500)}else{let r=n.cues;for(let c=0;c<r.length;c++){let h=r[c],o=u.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,attributes:{type:"button",role:"menuitem",tabindex:"-1"}}),a=u.createElement("span",{className:`${this.player.options.classPrefix}-chapter-time`,textContent:x.formatTime(h.startTime),attributes:{"aria-label":x.formatDuration(h.startTime)}}),l=u.createElement("span",{className:`${this.player.options.classPrefix}-chapter-title`,textContent:h.text});o.appendChild(a),o.appendChild(document.createTextNode(" ")),o.appendChild(l),o.addEventListener("click",()=>{this.player.seek(h.startTime),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(o)}this.attachMenuKeyboardNavigation(i,e),setTimeout(()=>{let c=i.querySelector(`.${this.player.options.classPrefix}-menu-item`);c&&c.focus({preventScroll:!0})},0)}}i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e)}createQualityButton(){let e=d.t("player.quality"),t=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-quality`,attributes:{type:"button","aria-label":e,"aria-expanded":"false"}});t.appendChild(w("hd")),u.attachTooltip(t,e,this.player.options.classPrefix);let i=u.createElement("span",{className:`${this.player.options.classPrefix}-quality-text`,textContent:""});return t.appendChild(i),t.addEventListener("click",()=>{this.showQualityMenu(t)}),this.controls.quality=t,this.controls.qualityText=i,setTimeout(()=>this.updateQualityIndicator(),500),t}showQualityMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-quality-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=u.createElement("div",{className:`${this.player.options.classPrefix}-quality-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu","aria-label":d.t("player.quality")}});if(this.player.renderer&&this.player.renderer.getQualities){let s=this.player.renderer.getQualities(),n=this.player.renderer.getCurrentQuality?this.player.renderer.getCurrentQuality():-1,r=this.player.renderer.hls!==void 0;if(s.length===0){let c=u.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:d.t("player.autoQuality"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(c)}else{let c=null;if(r){let h=u.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:d.t("player.auto"),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});this.player.renderer.hls&&this.player.renderer.hls.currentLevel===-1&&(h.classList.add(`${this.player.options.classPrefix}-menu-item-active`),h.appendChild(w("check")),c=h),h.addEventListener("click",()=>{this.player.renderer.switchQuality&&this.player.renderer.switchQuality(-1),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(h)}s.forEach(h=>{let o=u.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:h.name||`${h.height}p`,attributes:{type:"button",role:"menuitem",tabindex:"-1"}});h.index===n&&(o.classList.add(`${this.player.options.classPrefix}-menu-item-active`),o.appendChild(w("check")),c=o),o.addEventListener("click",()=>{this.player.renderer.switchQuality&&this.player.renderer.switchQuality(h.index),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(o)}),this.attachMenuKeyboardNavigation(i,e),setTimeout(()=>{let h=c||i.querySelector(`.${this.player.options.classPrefix}-menu-item`);h&&h.focus({preventScroll:!0})},0)}}else{let s=u.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:d.t("player.noQuality"),style:{opacity:"0.5",cursor:"default"}});i.appendChild(s)}i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e)}createCaptionStyleButton(){let e=d.t("player.captionStyling"),t=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-caption-style`,attributes:{type:"button","aria-label":e,"aria-expanded":"false"}}),i=u.createElement("span",{textContent:"Aa",style:{fontSize:"14px",fontWeight:"bold"}});return t.appendChild(i),u.attachTooltip(t,e,this.player.options.classPrefix),t.addEventListener("click",()=>{this.showCaptionStyleMenu(t)}),this.controls.captionStyle=t,t}showCaptionStyleMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-caption-style-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=u.createElement("div",{className:`${this.player.options.classPrefix}-caption-style-menu ${this.player.options.classPrefix}-menu ${this.player.options.classPrefix}-settings-menu`,attributes:{role:"menu","aria-label":d.t("player.captionStyling")}});if(i.addEventListener("click",o=>{o.stopPropagation()}),!this.player.captionManager||this.player.captionManager.tracks.length===0){let o=u.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:d.t("player.noCaptions"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default",padding:"12px 16px"}});i.appendChild(o),i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e,!0);return}let s=this.createStyleControl(d.t("styleLabels.fontSize"),"captionsFontSize",[{label:d.t("fontSizes.small"),value:"87.5%"},{label:d.t("fontSizes.normal"),value:"100%"},{label:d.t("fontSizes.large"),value:"125%"},{label:d.t("fontSizes.xlarge"),value:"150%"}]);i.appendChild(s);let n=this.createStyleControl(d.t("styleLabels.font"),"captionsFontFamily",[{label:d.t("fontFamilies.sansSerif"),value:"sans-serif"},{label:d.t("fontFamilies.serif"),value:"serif"},{label:d.t("fontFamilies.monospace"),value:"monospace"}]);i.appendChild(n);let r=this.createColorControl(d.t("styleLabels.textColor"),"captionsColor");i.appendChild(r);let c=this.createColorControl(d.t("styleLabels.background"),"captionsBackgroundColor");i.appendChild(c);let h=this.createOpacityControl(d.t("styleLabels.opacity"),"captionsOpacity");i.appendChild(h),i.style.minWidth="220px",i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e,!0),Z(i,`.${this.player.options.classPrefix}-style-select`)}createStyleControl(e,t,i){let s=u.createElement("div",{className:`${this.player.options.classPrefix}-style-group`}),n=`${this.player.options.classPrefix}-${t}-${Date.now()}`,r=u.createElement("label",{textContent:e,attributes:{for:n},style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"rgba(255,255,255,0.7)"}});s.appendChild(r);let c=u.createElement("select",{className:`${this.player.options.classPrefix}-style-select`,attributes:{id:n},style:{width:"100%",padding:"6px",background:"var(--vidply-white)",border:"1px solid var(--vidply-white-10)",borderRadius:"4px",color:"var(--vidply-black)",fontSize:"13px"}}),h=this.player.options[t];return i.forEach(o=>{let a=u.createElement("option",{textContent:o.label,attributes:{value:o.value}});o.value===h&&(a.selected=!0),c.appendChild(a)}),c.addEventListener("mousedown",o=>{o.stopPropagation()}),c.addEventListener("click",o=>{o.stopPropagation()}),c.addEventListener("change",o=>{o.stopPropagation(),this.player.options[t]=o.target.value,this.player.captionManager&&this.player.captionManager.setCaptionStyle(t.replace("captions","").charAt(0).toLowerCase()+t.replace("captions","").slice(1),o.target.value)}),s.appendChild(c),s}createColorControl(e,t){let i=u.createElement("div",{className:`${this.player.options.classPrefix}-style-group`}),s=`${this.player.options.classPrefix}-${t}-${Date.now()}`,n=u.createElement("label",{textContent:e,attributes:{for:s},style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"rgba(255,255,255,0.7)"}});i.appendChild(n);let r=u.createElement("input",{attributes:{id:s,type:"color",value:this.player.options[t]},style:{width:"100%",height:"32px",padding:"2px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"4px",cursor:"pointer"}});return r.addEventListener("mousedown",c=>{c.stopPropagation()}),r.addEventListener("click",c=>{c.stopPropagation()}),r.addEventListener("change",c=>{c.stopPropagation(),this.player.options[t]=c.target.value,this.player.captionManager&&this.player.captionManager.setCaptionStyle(t.replace("captions","").charAt(0).toLowerCase()+t.replace("captions","").slice(1),c.target.value)}),i.appendChild(r),i}createOpacityControl(e,t){let i=u.createElement("div",{className:`${this.player.options.classPrefix}-style-group`}),s=`${this.player.options.classPrefix}-${t}-${Date.now()}`,n=u.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"}}),r=u.createElement("label",{textContent:e,attributes:{for:s},style:{fontSize:"12px",color:"rgba(255,255,255,0.7)"}}),c=u.createElement("span",{textContent:Math.round(this.player.options[t]*100)+"%",style:{fontSize:"12px",color:"rgba(255,255,255,0.7)"}});n.appendChild(r),n.appendChild(c),i.appendChild(n);let h=u.createElement("input",{attributes:{id:s,type:"range",min:"0",max:"1",step:"0.1",value:String(this.player.options[t])},style:{width:"100%",cursor:"pointer"}});return h.addEventListener("mousedown",o=>{o.stopPropagation()}),h.addEventListener("click",o=>{o.stopPropagation()}),h.addEventListener("input",o=>{o.stopPropagation();let a=parseFloat(o.target.value);c.textContent=Math.round(a*100)+"%",this.player.options[t]=a,this.player.captionManager&&this.player.captionManager.setCaptionStyle(t.replace("captions","").charAt(0).toLowerCase()+t.replace("captions","").slice(1),a)}),i.appendChild(h),i}createSpeedButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-speed`,attributes:{type:"button","aria-label":d.t("player.speed"),"aria-expanded":"false"}});e.appendChild(w("speed"));let t=u.createElement("span",{className:`${this.player.options.classPrefix}-speed-text`,textContent:"1x"});return e.appendChild(t),e.addEventListener("click",()=>{this.showSpeedMenu(e)}),this.controls.speed=e,this.controls.speedText=t,e}formatSpeedLabel(e){return e===1?d.t("speeds.normal"):`${e.toLocaleString(d.getLanguage(),{minimumFractionDigits:0,maximumFractionDigits:2})}Ã—`}showSpeedMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-speed-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=u.createElement("div",{className:`${this.player.options.classPrefix}-speed-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu"}}),s=[.25,.5,.75,1,1.25,1.5,1.75,2],n=null;s.forEach(r=>{let c=u.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:this.formatSpeedLabel(r),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});r===this.player.state.playbackSpeed&&(c.classList.add(`${this.player.options.classPrefix}-menu-item-active`),c.appendChild(w("check")),n=c),c.addEventListener("click",()=>{this.player.setPlaybackSpeed(r),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(c)}),i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuKeyboardNavigation(i,e),this.attachMenuCloseHandler(i,e),setTimeout(()=>{let r=n||i.querySelector(`.${this.player.options.classPrefix}-menu-item`);r&&r.focus({preventScroll:!0})},0)}createCaptionsButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-captions-button`,attributes:{type:"button","aria-label":d.t("player.captions"),"aria-expanded":"false"}});return e.appendChild(w("captionsOff")),e.addEventListener("click",()=>{this.showCaptionsMenu(e)}),this.controls.captions=e,e}showCaptionsMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-captions-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=u.createElement("div",{className:`${this.player.options.classPrefix}-captions-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu","aria-label":d.t("captions.select")}});if(!this.player.captionManager||this.player.captionManager.tracks.length===0){let c=u.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:d.t("player.noCaptions"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(c),this.insertMenuIntoDOM(i,e),this.attachMenuCloseHandler(i,e);return}let s=null,n=u.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:d.t("captions.off"),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});this.player.state.captionsEnabled||(n.classList.add(`${this.player.options.classPrefix}-menu-item-active`),n.appendChild(w("check")),s=n),n.addEventListener("click",()=>{this.player.disableCaptions(),this.updateCaptionsButton(),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(n),this.player.captionManager.getAvailableTracks().forEach(c=>{let h=u.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:c.label,attributes:{type:"button",role:"menuitem",lang:c.language,tabindex:"-1"}});this.player.state.captionsEnabled&&this.player.captionManager.currentTrack===this.player.captionManager.tracks[c.index]&&(h.classList.add(`${this.player.options.classPrefix}-menu-item-active`),h.appendChild(w("check")),s=h),h.addEventListener("click",()=>{this.player.captionManager.switchTrack(c.index),this.updateCaptionsButton(),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(h)}),this.insertMenuIntoDOM(i,e),this.attachMenuKeyboardNavigation(i,e),this.attachMenuCloseHandler(i,e),setTimeout(()=>{let c=s||i.querySelector(`.${this.player.options.classPrefix}-menu-item`);c&&c.focus({preventScroll:!0})},0)}updateCaptionsButton(){if(!this.controls.captions)return;let e=this.controls.captions.querySelector(".vidply-icon"),t=this.player.state.captionsEnabled;e.innerHTML=t?w("captions").innerHTML:w("captionsOff").innerHTML}createTranscriptButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-transcript`,attributes:{type:"button","aria-label":d.t("player.transcript"),"aria-expanded":"false"}});return e.appendChild(w("transcript")),e.addEventListener("click",async()=>{await this.player.toggleTranscript(),this.updateTranscriptButton()}),this.controls.transcript=e,e}updateTranscriptButton(){if(!this.controls.transcript)return;let e=this.player.transcriptManager&&this.player.transcriptManager.isVisible;this.controls.transcript.setAttribute("aria-expanded",e?"true":"false")}createAudioDescriptionButton(){let e=d.t("player.audioDescription"),t=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-audio-description`,attributes:{type:"button","aria-label":e,role:"switch","aria-checked":"false"}});return t.appendChild(w("audioDescription")),u.attachTooltip(t,e,this.player.options.classPrefix),t.addEventListener("click",async()=>{await this.player.toggleAudioDescription(),this.updateAudioDescriptionButton()}),this.controls.audioDescription=t,t}updateAudioDescriptionButton(){if(!this.controls.audioDescription)return;let e=this.controls.audioDescription.querySelector(".vidply-icon"),t=this.player.state.audioDescriptionEnabled;e.innerHTML=t?w("audioDescriptionOn").innerHTML:w("audioDescription").innerHTML,this.controls.audioDescription.setAttribute("aria-checked",t?"true":"false")}createSignLanguageButton(){let e=d.t("player.signLanguage"),t=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-sign-language`,attributes:{type:"button","aria-label":e,"aria-expanded":"false"}});return t.appendChild(w("signLanguage")),u.attachTooltip(t,e,this.player.options.classPrefix),t.addEventListener("click",()=>{this.player.toggleSignLanguage(),this.updateSignLanguageButton()}),this.controls.signLanguage=t,t}updateSignLanguageButton(){if(!this.controls.signLanguage)return;let e=this.controls.signLanguage.querySelector(".vidply-icon"),t=this.player.state.signLanguageEnabled;e.innerHTML=t?w("signLanguageOn").innerHTML:w("signLanguage").innerHTML,this.controls.signLanguage.setAttribute("aria-expanded",t?"true":"false"),this.controls.signLanguage.setAttribute("aria-label",t?d.t("signLanguage.hide"):d.t("signLanguage.show"))}updateAccessibilityButtons(){let e=this.hasAudioDescription(),t=this.hasSignLanguage();if(e){if(!this.controls.audioDescription&&this.player.options.audioDescriptionButton!==!1){let i=this.createAudioDescriptionButton();i.dataset.overflowPriority="2",i.dataset.overflowPriorityMobile="3";let s=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-transcript`),n=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-playlist-toggle`),r=s||n||null;r?this.rightButtons.insertBefore(i,r):this.rightButtons.appendChild(i),this.setupOverflowMenu()}this.controls.audioDescription&&(this.controls.audioDescription.style.display="")}else this.controls.audioDescription&&(this.controls.audioDescription.style.display="none");if(t){if(!this.controls.signLanguage&&this.player.options.signLanguageButton!==!1){let i=this.createSignLanguageButton();i.dataset.overflowPriority="3",i.dataset.overflowPriorityMobile="3";let s=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-quality`),n=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-fullscreen`),r=s||n||null;r?this.rightButtons.insertBefore(i,r):this.rightButtons.appendChild(i),this.setupOverflowMenu()}this.controls.signLanguage&&(this.controls.signLanguage.style.display="")}else this.controls.signLanguage&&(this.controls.signLanguage.style.display="none")}createSettingsButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-settings`,attributes:{type:"button","aria-label":d.t("player.settings")}});return e.appendChild(w("settings")),e.addEventListener("click",()=>{this.player.showSettings()}),e}createPipButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-pip`,attributes:{type:"button","aria-label":d.t("player.pip")}});return e.appendChild(w("pip")),e.addEventListener("click",()=>{this.player.togglePiP()}),e}createFullscreenButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-fullscreen`,attributes:{type:"button","aria-label":d.t("player.fullscreen")}});return e.appendChild(w("fullscreen")),e.addEventListener("click",()=>{this.player.toggleFullscreen()}),this.controls.fullscreen=e,e}attachEvents(){this.player.on("play",()=>this.updatePlayPauseButton()),this.player.on("pause",()=>this.updatePlayPauseButton()),this.player.on("timeupdate",()=>this.updateProgress()),this.player.on("loadedmetadata",()=>{this.updateDuration(),this.ensureQualityButton(),this.updateQualityIndicator()}),this.player.on("volumechange",()=>this.updateVolumeDisplay()),this.player.on("progress",()=>this.updateBuffered()),this.player.on("playbackspeedchange",()=>this.updateSpeedDisplay()),this.player.on("fullscreenchange",()=>this.updateFullscreenButton()),this.player.on("captionsenabled",()=>this.updateCaptionsButton()),this.player.on("captionsdisabled",()=>this.updateCaptionsButton()),this.player.on("audiodescriptionenabled",()=>this.updateAudioDescriptionButton()),this.player.on("audiodescriptiondisabled",()=>this.updateAudioDescriptionButton()),this.player.on("signlanguageenabled",()=>this.updateSignLanguageButton()),this.player.on("signlanguagedisabled",()=>this.updateSignLanguageButton()),this.player.on("qualitychange",()=>this.updateQualityIndicator()),this.player.on("hlslevelswitched",()=>this.updateQualityIndicator()),this.player.on("hlsmanifestparsed",()=>{this.ensureQualityButton(),this.updateQualityIndicator()})}updatePlayPauseButton(){if(!this.controls.playPause)return;let e=this.controls.playPause.querySelector(".vidply-icon"),t=this.player.state.playing;e.innerHTML=t?w("pause").innerHTML:w("play").innerHTML;let i=t?d.t("player.pause"):d.t("player.play");this.controls.playPause.setAttribute("aria-label",i),u.attachTooltip(this.controls.playPause,i,this.player.options.classPrefix)}updateProgress(){if(!this.controls.played)return;let e=this.player.state.currentTime||0,t=this.player.state.duration||0,i=t>0?Math.min(100,Math.max(0,e/t*100)):0;this.controls.played.style.width=`${i}%`,this.controls.progress.setAttribute("aria-valuenow",String(Math.round(i)));let s=x.formatDuration(this.player.state.currentTime),n=x.formatDuration(this.player.state.duration);if(this.controls.progress.setAttribute("aria-valuetext",`${Math.round(i)}%, ${s} ${d.t("time.of")} ${n}`),this.controls.currentTimeVisual){let r=this.player.state.currentTime;this.controls.currentTimeVisual.textContent=x.formatTime(r),this.controls.currentTimeAccessible&&(this.controls.currentTimeAccessible.textContent=x.formatDuration(r))}}updateDuration(){if(this.controls.durationVisual){let e=this.player.state.duration;this.controls.durationVisual.textContent=x.formatTime(e),this.controls.durationAccessible&&(this.controls.durationAccessible.textContent=d.t("time.durationPrefix")+x.formatDuration(e))}}updateVolumeDisplay(){let e=this.player.state.volume*100;if(this.controls.volumeFill&&(this.controls.volumeFill.style.height=`${e}%`),this.controls.volumeSlider&&this.controls.volumeSlider.setAttribute("aria-valuenow",String(Math.round(e))),this.controls.mute){let t=this.controls.mute.querySelector(".vidply-icon");if(t){let i;this.player.state.muted||this.player.state.volume===0?i="volumeMuted":this.player.state.volume<.3?i="volumeLow":this.player.state.volume<.7?i="volumeMedium":i="volumeHigh",t.innerHTML=w(i).innerHTML;let s=this.player.state.muted?d.t("player.unmute"):d.t("player.mute");this.controls.mute.setAttribute("aria-label",s),u.attachTooltip(this.controls.mute,s,this.player.options.classPrefix)}}this.controls.volumeSlider&&this.controls.volumeSlider.setAttribute("aria-valuenow",String(Math.round(e)))}updateBuffered(){if(!this.controls.buffered||!this.player.element.buffered||this.player.element.buffered.length===0)return;let t=this.player.element.buffered.end(this.player.element.buffered.length-1)/this.player.state.duration*100;this.controls.buffered.style.width=`${t}%`}updateSpeedDisplay(){this.controls.speedText&&(this.controls.speedText.textContent=`${this.player.state.playbackSpeed}x`)}updateFullscreenButton(){if(!this.controls.fullscreen)return;let e=this.controls.fullscreen.querySelector(".vidply-icon"),t=this.player.state.fullscreen;e.innerHTML=t?w("fullscreenExit").innerHTML:w("fullscreen").innerHTML,this.controls.fullscreen.setAttribute("aria-label",t?d.t("player.exitFullscreen"):d.t("player.fullscreen"))}ensureQualityButton(){if(!this.player.options.qualityButton||this.controls.quality||!this.hasQualityLevels())return;let e=this.createQualityButton(),t=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-speed`),s=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-caption-style`)||t;s?this.rightButtons.insertBefore(e,s):this.rightButtons.insertBefore(e,this.rightButtons.firstChild),this.player.log("Quality button added dynamically","info")}updateQualityIndicator(){if(!this.controls.qualityText||!this.player.renderer||!this.player.renderer.getQualities)return;let e=this.player.renderer.getQualities();if(e.length===0){this.controls.qualityText.textContent="";return}let t="";if(this.player.renderer.hls&&this.player.renderer.hls.currentLevel===-1)t="Auto";else if(this.player.renderer.getCurrentQuality){let i=this.player.renderer.getCurrentQuality(),s=e.find(n=>n.index===i);s&&(t=s.height?`${s.height}p`:"")}this.controls.qualityText.textContent=t}setupAutoHide(){if(this.player.element.tagName!=="VIDEO")return;let e=()=>{if(this.element.classList.add(`${this.player.options.classPrefix}-controls-visible`),this.player.container.classList.add(`${this.player.options.classPrefix}-controls-visible`),this.player.state.controlsVisible=!0,clearTimeout(this.hideTimeout),this.player.state.playing){let t=this.player.state.fullscreen?this.player.options.hideControlsDelay*1.5:this.player.options.hideControlsDelay;this.hideTimeout=setTimeout(()=>{this.element.classList.remove(`${this.player.options.classPrefix}-controls-visible`),this.player.container.classList.remove(`${this.player.options.classPrefix}-controls-visible`),this.player.state.controlsVisible=!1},t)}};this.player.container.addEventListener("mousemove",e),this.player.container.addEventListener("touchstart",e),this.player.container.addEventListener("touchmove",e),this.player.container.addEventListener("click",e),this.player.container.addEventListener("tap",e),this.element.addEventListener("focusin",e),this.player.on("pause",()=>{e(),clearTimeout(this.hideTimeout)}),this.player.on("play",()=>{e()}),this.player.on("enterfullscreen",()=>{e(),this.player.state.fullscreen&&(clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(()=>{this.player.state.playing&&(this.element.classList.remove(`${this.player.options.classPrefix}-controls-visible`),this.player.container.classList.remove(`${this.player.options.classPrefix}-controls-visible`),this.player.state.controlsVisible=!1)},this.player.options.hideControlsDelay*2))}),e()}createOverflowMenuButton(){let e=d.t("player.moreOptions"),t=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-overflow-menu`,attributes:{type:"button","aria-label":e,"aria-expanded":"false"}});return t.appendChild(w("moreVertical")),u.attachTooltip(t,e,this.player.options.classPrefix),t.addEventListener("click",()=>{this.showOverflowMenu(t)}),this.controls.overflowMenu=t,t}showOverflowMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-overflow-menu-list`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=u.createElement("div",{className:`${this.player.options.classPrefix}-overflow-menu-list ${this.player.options.classPrefix}-menu`,attributes:{role:"menu","aria-label":d.t("player.moreOptions")}}),s=Array.from(this.rightButtons.querySelectorAll('button[data-in-overflow="true"]'));if(s.length===0){let n=u.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:d.t("player.noMoreOptions"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(n)}else s.forEach(n=>{let r=u.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,attributes:{type:"button",role:"menuitem",tabindex:"-1"}}),c=n.getAttribute("aria-label")||n.getAttribute("title")||"",h=n.querySelector(".vidply-icon");if(h){let a=h.cloneNode(!0);r.appendChild(a)}else{let a=n.querySelector("span");if(a&&a.textContent&&a.textContent.length<=3){let l=a.cloneNode(!0);l.classList.add("vidply-icon"),r.appendChild(l)}}let o=u.createElement("span",{textContent:c});r.appendChild(o),r.addEventListener("click",a=>{this._overflowMenuItemRef=r;let l=n.style.display;n.style.display="",n.style.visibility="hidden",n.click(),setTimeout(()=>{n.style.display=l,n.style.visibility="",this._overflowMenuItemRef=null},100),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(r)}),this.attachMenuKeyboardNavigation(i,e),setTimeout(()=>{let n=i.querySelector(`.${this.player.options.classPrefix}-menu-item`);n&&n.tagName==="BUTTON"&&n.focus({preventScroll:!0})},0);i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e)}setupOverflowDetection(){let e=()=>{let i=window.innerWidth>=768,s=window.innerHeight<window.innerWidth,n=this.player.state.fullscreen,r=s&&n;if(!this.rightButtons||this.rightButtons.children.length===0){this.overflowMenuButton&&(this.overflowMenuButton.style.display="none");return}let c=Array.from(this.rightButtons.children).filter(m=>!m.classList.contains(`${this.player.options.classPrefix}-overflow-menu`));if(c.length===0){this.overflowMenuButton&&(this.overflowMenuButton.style.display="none");return}let h=!i&&!s;if(this.player.options.debug&&console.log("Overflow detection:",{isDesktop:i,isFullscreen:n,isLandscape:s,isLandscapeFullscreen:r,shouldUseOverflow:h,width:window.innerWidth,height:window.innerHeight}),!h){c.forEach(m=>{m.dataset.inOverflow="false",m.style.display=""}),this.overflowMenuButton&&(this.overflowMenuButton.style.display="none"),this.player.options.debug&&console.log("No overflow menu needed - all buttons visible, overflow button hidden");return}this.player.options.debug&&console.log("Mobile portrait - checking for overflow..."),c.forEach(m=>{m.style.display=""});let o=this.rightButtons.offsetWidth,l=o-50,g=0,p=c.map(m=>{let M=getComputedStyle(m),f=m.offsetWidth+parseInt(M.marginLeft||0)+parseInt(M.marginRight||0);return g+=f,{btn:m,width:f}});g+=(c.length-1)*8;let b=window.innerWidth<768,k=g>l||b||r&&!i;if(this.player.options.debug&&console.log("Overflow detection:",{containerWidth:o,availableWidth:l,totalWidth:g,needsOverflow:k,isSmallScreen:b,reason:b?"mobile screen":g>l?"not enough space":"enough space",buttonCount:c.length}),k){let m=window.innerWidth<768,M=m?"overflowPriorityMobile":"overflowPriority";this.player.options.debug&&console.log(`Using ${m?"mobile":"desktop"} priorities (width: ${window.innerWidth}px)`);let f=p.sort((L,S)=>{let C=parseInt(L.btn.dataset[M]||L.btn.dataset.overflowPriority||"1");return parseInt(S.btn.dataset[M]||S.btn.dataset.overflowPriority||"1")-C}),v=g,E=0;for(let{btn:L,width:S}of f){let C=parseInt(L.dataset[M]||L.dataset.overflowPriority||"1"),P=L.getAttribute("aria-label")||"unknown";if(C===1){L.dataset.inOverflow="false",L.style.display="";continue}(m?C>1:v>l)?(L.dataset.inOverflow="true",L.style.display="none",v-=S,E++,this.player.options.debug&&console.log(`  â†’ Hiding button: ${P} (priority ${C}, ${m?"mobile":"desktop"})`)):(L.dataset.inOverflow="false",L.style.display="")}if(this.player.options.debug&&console.log("Overflow button exists?",!!this.overflowMenuButton),!this.overflowMenuButton){console.error("Overflow menu button not found!");return}E>0?(this.overflowMenuButton.style.display="",this.player.options.debug&&console.log("Showing overflow menu button -",E,"buttons moved")):(this.overflowMenuButton.style.display="none",this.player.options.debug&&console.log("Hiding overflow menu button - all buttons fit"))}else c.forEach(m=>{m.dataset.inOverflow="false",m.style.display=""}),this.overflowMenuButton.style.display="none"},t=new ResizeObserver(()=>{requestAnimationFrame(e)});t.observe(this.rightButtons),window.addEventListener("resize",()=>{requestAnimationFrame(e)}),this.player.on("fullscreenchange",()=>{setTimeout(()=>{requestAnimationFrame(e)},50)}),requestAnimationFrame(()=>{e(),setTimeout(()=>e(),100),setTimeout(()=>e(),300),setTimeout(()=>e(),500)}),document.fonts&&document.fonts.ready&&document.fonts.ready.then(()=>{requestAnimationFrame(e)}),this.overflowResizeObserver=t}show(){this.element.style.display=""}hide(){this.element.style.display="none"}destroy(){this.hideTimeout&&clearTimeout(this.hideTimeout),this.overflowResizeObserver&&this.overflowResizeObserver.disconnect(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}};function U(T,e=100){let t;return function(...s){let n=()=>{clearTimeout(t),T(...s)};clearTimeout(t),t=setTimeout(n,e)}}function Q(T=768){return window.innerWidth<T}function O(T,e=100){let t=!1,i=()=>{t||(t=!0,T())};requestAnimationFrame(i),setTimeout(i,e)}var R=class{constructor(e){this.player=e,this.element=null,this.tracks=[],this.currentTrack=null,this.currentCue=null,this.storage=new V("vidply"),this.loadSavedPreferences(),this.init()}loadSavedPreferences(){let e=this.storage.getCaptionPreferences();e&&(e.fontSize&&(this.player.options.captionsFontSize=e.fontSize),e.fontFamily&&(this.player.options.captionsFontFamily=e.fontFamily),e.color&&(this.player.options.captionsColor=e.color),e.backgroundColor&&(this.player.options.captionsBackgroundColor=e.backgroundColor),e.opacity!==void 0&&(this.player.options.captionsOpacity=e.opacity))}saveCaptionPreferences(){this.storage.saveCaptionPreferences({fontSize:this.player.options.captionsFontSize,fontFamily:this.player.options.captionsFontFamily,color:this.player.options.captionsColor,backgroundColor:this.player.options.captionsBackgroundColor,opacity:this.player.options.captionsOpacity})}init(){this.createElement(),this.loadTracks(),this.attachEvents(),this.player.options.captionsDefault&&this.tracks.length>0&&!this.currentTrack&&this.enable()}createElement(){this.element=u.createElement("div",{className:`${this.player.options.classPrefix}-captions`,attributes:{role:"region","aria-label":d.t("player.captions")}}),this.updateStyles(),(this.player.videoWrapper||this.player.container).appendChild(this.element)}loadTracks(){let e=this.player.element.textTracks,t=-1;for(let i=0;i<e.length;i++){let s=e[i];if(s.kind==="subtitles"||s.kind==="captions"){let n=this.player.findTrackElement(s),r=n&&n.hasAttribute("default");this.tracks.push({track:s,language:s.language,label:s.label,kind:s.kind,index:i,isDefault:r}),s.mode==="showing"||s.mode,s.mode="hidden",r&&(t=this.tracks.length-1)}}t>=0&&requestAnimationFrame(()=>{this.enable(t)})}attachEvents(){this.player.on("timeupdate",()=>{this.updateCaptions()}),this.player.on("captionschange",()=>{this.updateStyles()}),this.debouncedPositionCaptions=U(()=>{this.positionCaptionsOnMobile()},150),window.addEventListener("resize",this.debouncedPositionCaptions),this.player.on("enterfullscreen",()=>{O(()=>this.positionCaptionsOnMobile(),100)}),this.player.on("exitfullscreen",()=>{O(()=>this.positionCaptionsOnMobile(),100)})}enable(e=0){if(this.tracks.length===0)return;this.currentTrack&&this.currentTrack.track&&(this.cueChangeHandler&&this.currentTrack.track.removeEventListener("cuechange",this.cueChangeHandler),this.currentTrack.track.mode="hidden");let t=this.tracks[e];if(t&&t.track){t.track.mode="hidden",this.currentTrack=t,this.player.state.captionsEnabled=!0,t.language&&this.element.setAttribute("lang",t.language),this.cueChangeHandler&&t.track.removeEventListener("cuechange",this.cueChangeHandler),this.cueChangeHandler=()=>{this.updateCaptions()},t.track.addEventListener("cuechange",this.cueChangeHandler);let i=()=>{if(t.track.readyState<2){let s=()=>{t.track.removeEventListener("load",s),t.track.removeEventListener("error",s),requestAnimationFrame(()=>{this.currentTrack&&this.currentTrack.track===t.track&&this.updateCaptions()})};t.track.addEventListener("load",s,{once:!0}),t.track.addEventListener("error",s,{once:!0})}else requestAnimationFrame(()=>{this.currentTrack&&this.currentTrack.track===t.track&&this.updateCaptions()})};requestAnimationFrame(()=>{this.currentTrack&&this.currentTrack.track===t.track&&i()}),this.player.emit("captionsenabled",t)}}disable(){this.currentTrack&&(this.currentTrack.track.mode="hidden",this.currentTrack=null),this.element.style.display="none",this.element.innerHTML="",this.element.removeAttribute("lang"),this.currentCue=null,this.player.state.captionsEnabled=!1,this.player.emit("captionsdisabled")}updateCaptions(){if(!this.currentTrack||!this.currentTrack.track)return;if(this.currentTrack.track.mode==="disabled"&&(this.currentTrack.track.mode="hidden"),this.currentTrack.track.mode==="showing"&&(this.currentTrack.track.mode="hidden"),!this.currentTrack.track.activeCues){this.currentTrack.track.cues&&this.currentTrack.track.cues.length>0&&this.currentCue&&(this.element.innerHTML="",this.element.style.display="none",this.currentCue=null);return}let e=this.currentTrack.track.activeCues,t=this.player.element.tagName.toLowerCase()==="audio";if(e.length>0){let i=e[0];if(this.currentCue!==i){this.currentCue=i;let s=i.text;if(s=this.parseVTTFormatting(s),t){this.element.querySelectorAll(`.${this.player.options.classPrefix}-caption-cue`).forEach(h=>h.classList.remove(`${this.player.options.classPrefix}-caption-active`));let r=`cue-${i.startTime}-${i.endTime}`,c=this.element.querySelector(`[data-cue-id="${r}"]`);c||(c=document.createElement("div"),c.className=`${this.player.options.classPrefix}-caption-cue`,c.setAttribute("data-cue-id",r),c.innerHTML=u.sanitizeHTML(s),this.element.appendChild(c)),c.classList.add(`${this.player.options.classPrefix}-caption-active`),requestAnimationFrame(()=>{c&&c.scrollIntoView({behavior:"smooth",block:"center"})})}else this.element.innerHTML=u.sanitizeHTML(s);this.element.style.display="block",this.positionCaptionsOnMobile(),this.player.emit("captionchange",i)}}else this.currentCue&&(t||(this.element.innerHTML="",this.element.style.display="none"),this.currentCue=null)}positionCaptionsOnMobile(){if(!this.element||this.element.style.display==="none")return;let e=this.player.state?.fullscreen||!1,t=Q();if(!t&&!e){this.element.style.bottom="";return}let i=this.player.controlBar?.element;i&&requestAnimationFrame(()=>{if(!this.element||this.element.style.display==="none")return;let s=i.getBoundingClientRect(),r=this.player.videoWrapper.getBoundingClientRect().bottom-s.top+16;this.element.style.bottom=`${r}px`,this.player.options.debug&&console.log("[VidPly] Caption position:",{mobile:t,isFullscreen:e,controlsHeight:s.height,bottomOffset:`${r}px`})})}parseVTTFormatting(e){return e=e.replace(/<c[^>]*>(.*?)<\/c>/g,'<span class="caption-class">$1</span>'),e=e.replace(/<b>(.*?)<\/b>/g,"<strong>$1</strong>"),e=e.replace(/<i>(.*?)<\/i>/g,"<em>$1</em>"),e=e.replace(/<u>(.*?)<\/u>/g,"<u>$1</u>"),e=e.replace(/<v\s+([^>]+)>(.*?)<\/v>/g,'<span class="caption-voice" data-voice="$1">$2</span>'),e}updateStyles(){if(!this.element)return;let e=this.player.options;this.element.style.fontSize=e.captionsFontSize,this.element.style.fontFamily=e.captionsFontFamily,this.element.style.color=e.captionsColor,this.element.style.backgroundColor=this.hexToRgba(e.captionsBackgroundColor,e.captionsOpacity)}hexToRgba(e,t){let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?`rgba(${parseInt(i[1],16)}, ${parseInt(i[2],16)}, ${parseInt(i[3],16)}, ${t})`:e}setCaptionStyle(e,t){switch(e){case"fontSize":this.player.options.captionsFontSize=t;break;case"fontFamily":this.player.options.captionsFontFamily=t;break;case"color":this.player.options.captionsColor=t;break;case"backgroundColor":this.player.options.captionsBackgroundColor=t;break;case"opacity":this.player.options.captionsOpacity=t;break}this.updateStyles(),this.saveCaptionPreferences(),this.player.emit("captionschange")}getAvailableTracks(){return this.tracks.map((e,t)=>({index:t,language:e.language,label:e.label||e.language,kind:e.kind}))}switchTrack(e){e>=0&&e<this.tracks.length&&(this.disable(),this.enable(e))}destroy(){this.disable(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}};var K=class{constructor(e){this.player=e,this.shortcuts=e.options.keyboardShortcuts,this.init()}init(){this.attachEvents()}attachEvents(){this.player.container.addEventListener("keydown",e=>{this.handleKeydown(e)},!0),this.player.container.hasAttribute("tabindex")||this.player.container.setAttribute("tabindex","0")}handleKeydown(e){if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||e.target.tagName==="SELECT")return;let t=document.activeElement;if(t&&(t.closest('.vidply-menu, [role="menu"]')||t.closest(".vidply-playlist-item-button")))return;let i=e.key,s=!1;if(i==="Escape"&&this.player.state.fullscreen){this.player.exitFullscreen(),e.preventDefault(),e.stopPropagation();return}for(let[n,r]of Object.entries(this.shortcuts))if(r.includes(i)&&(s=this.executeAction(n,e),s)){e.preventDefault(),e.stopPropagation(),this.announceAction(n);break}!s&&this.player.options.debug&&console.log("[VidPly] Unhandled key:",e.key,"code:",e.code,"shiftKey:",e.shiftKey)}executeAction(e,t){switch(e){case"play-pause":return this.player.toggle(),!0;case"volume-up":return this.player.setVolume(Math.min(1,this.player.state.volume+.1)),!0;case"volume-down":return this.player.setVolume(Math.max(0,this.player.state.volume-.1)),!0;case"seek-forward":return this.player.seekForward(),!0;case"seek-backward":return this.player.seekBackward(),!0;case"mute":return this.player.toggleMute(),!0;case"fullscreen":return this.player.toggleFullscreen(),!0;case"captions":if(this.player.captionManager&&this.player.captionManager.tracks.length>1){let i=this.player.controlBar&&this.player.controlBar.controls.captions;i?this.player.controlBar.showCaptionsMenu(i):this.player.toggleCaptions()}else this.player.toggleCaptions();return!0;case"caption-style-menu":return this.player.controlBar&&this.player.controlBar.controls.captionStyle?(this.player.controlBar.showCaptionStyleMenu(this.player.controlBar.controls.captionStyle),!0):!1;case"speed-up":return this.player.setPlaybackSpeed(Math.min(2,this.player.state.playbackSpeed+.25)),!0;case"speed-down":return this.player.setPlaybackSpeed(Math.max(.25,this.player.state.playbackSpeed-.25)),!0;case"speed-menu":return this.player.controlBar&&this.player.controlBar.controls.speed?(this.player.controlBar.showSpeedMenu(this.player.controlBar.controls.speed),!0):!1;case"quality-menu":return this.player.controlBar&&this.player.controlBar.controls.quality?(this.player.controlBar.showQualityMenu(this.player.controlBar.controls.quality),!0):!1;case"chapters-menu":return this.player.controlBar&&this.player.controlBar.controls.chapters?(this.player.controlBar.showChaptersMenu(this.player.controlBar.controls.chapters),!0):!1;case"transcript-toggle":return this.player.transcriptManager?(this.player.transcriptManager.toggleTranscript(),!0):!1;default:return!1}}announceAction(e){if(!this.player.options.screenReaderAnnouncements)return;let t="";switch(e){case"play-pause":t=this.player.state.playing?"Playing":"Paused";break;case"volume-up":t=`Volume ${Math.round(this.player.state.volume*100)}%`;break;case"volume-down":t=`Volume ${Math.round(this.player.state.volume*100)}%`;break;case"mute":t=this.player.state.muted?"Muted":"Unmuted";break;case"fullscreen":t=this.player.state.fullscreen?"Fullscreen":"Exit fullscreen";break;case"captions":t=this.player.state.captionsEnabled?"Captions on":"Captions off";break;case"speed-up":case"speed-down":t=`Speed ${this.player.state.playbackSpeed}x`;break}t&&this.announce(t)}announce(e,t="polite"){let i=document.getElementById("vidply-announcer");i||(i=document.createElement("div"),i.id="vidply-announcer",i.className="vidply-sr-only",i.setAttribute("aria-live",t),i.setAttribute("aria-atomic","true"),i.style.cssText=`
        position: absolute;
        left: -10000px;
        width: 1px;
        height: 1px;
        overflow: hidden;
      `,document.body.appendChild(i)),i.textContent="",setTimeout(()=>{i.textContent=e},100)}updateShortcut(e,t){Array.isArray(t)&&(this.shortcuts[e]=t)}destroy(){}};var ne=0,F=class T extends z{constructor(e,t={}){if(super(),this.element=typeof e=="string"?document.querySelector(e):e,!this.element)throw new Error("VidPly: Element not found");if(ne++,this.instanceId=ne,this.element.tagName!=="VIDEO"&&this.element.tagName!=="AUDIO"){let s=t.mediaType||"video",n=document.createElement(s);Array.from(this.element.attributes).forEach(c=>{c.name!=="id"&&c.name!=="class"&&!c.name.startsWith("data-")&&n.setAttribute(c.name,c.value)}),this.element.querySelectorAll("track").forEach(c=>{n.appendChild(c.cloneNode(!0))}),this.element.innerHTML="",this.element.appendChild(n),this.element=n}this._originalElement=this.element,this.options={width:null,height:null,poster:null,responsive:!0,fillContainer:!1,autoplay:!1,loop:!1,muted:!1,volume:.8,playbackSpeed:1,preload:"metadata",startTime:0,playsInline:!0,controls:!0,hideControlsDelay:3e3,playPauseButton:!0,progressBar:!0,currentTime:!0,duration:!0,volumeControl:!0,muteButton:!0,chaptersButton:!0,qualityButton:!0,captionStyleButton:!0,speedButton:!0,captionsButton:!0,transcriptButton:!0,fullscreenButton:!0,pipButton:!1,seekInterval:10,seekIntervalLarge:30,captions:!0,captionsDefault:!1,captionsFontSize:"100%",captionsFontFamily:"sans-serif",captionsColor:"#FFFFFF",captionsBackgroundColor:"#000000",captionsOpacity:.8,audioDescription:!0,audioDescriptionSrc:null,audioDescriptionButton:!0,signLanguage:!0,signLanguageSrc:null,signLanguageButton:!0,signLanguagePosition:"bottom-right",transcript:!1,transcriptPosition:"external",transcriptContainer:null,keyboard:!0,keyboardShortcuts:{"play-pause":[" ","p","k"],"volume-up":["ArrowUp"],"volume-down":["ArrowDown"],"seek-forward":["ArrowRight"],"seek-backward":["ArrowLeft"],mute:["m"],fullscreen:["f"],captions:["c"],"caption-style-menu":["a"],"speed-up":[">"],"speed-down":["<"],"speed-menu":["s"],"quality-menu":["q"],"chapters-menu":["j"],"transcript-toggle":["t"]},ariaLabels:{},screenReaderAnnouncements:!0,highContrast:!1,focusHighlight:!0,metadataAlerts:{},metadataHashtags:{},language:"en",languages:["en"],debug:!1,classPrefix:"vidply",iconType:"svg",pauseOthersOnPlay:!0,onReady:null,onPlay:null,onPause:null,onEnded:null,onTimeUpdate:null,onVolumeChange:null,onError:null,...t},this.options.metadataAlerts=this.options.metadataAlerts||{},this.options.metadataHashtags=this.options.metadataHashtags||{},this.storage=new V("vidply");let i=this.storage.getPlayerPreferences();i&&(i.volume!==void 0&&(this.options.volume=i.volume),i.playbackSpeed!==void 0&&(this.options.playbackSpeed=i.playbackSpeed),i.muted!==void 0&&(this.options.muted=i.muted)),this.state={ready:!1,playing:!1,paused:!0,ended:!1,buffering:!1,seeking:!1,muted:this.options.muted,volume:this.options.volume,currentTime:0,duration:0,playbackSpeed:this.options.playbackSpeed,fullscreen:!1,pip:!1,captionsEnabled:this.options.captionsDefault,currentCaption:null,controlsVisible:!0,audioDescriptionEnabled:!1,signLanguageEnabled:!1},this.originalSrc=null,this.audioDescriptionSrc=this.options.audioDescriptionSrc,this.signLanguageSrc=this.options.signLanguageSrc,this.signLanguageSources=this.options.signLanguageSources||{},this.currentSignLanguage=null,this.signLanguageVideo=null,this.audioDescriptionSourceElement=null,this.originalAudioDescriptionSource=null,this.audioDescriptionCaptionTracks=[],this._audioDescriptionDesiredState=!1,this._textTracksCache=null,this._textTracksDirty=!0,this._sourceElementsCache=null,this._sourceElementsDirty=!0,this._trackElementsCache=null,this._trackElementsDirty=!0,this.timeouts=new Set,this.container=null,this.renderer=null,this.controlBar=null,this.captionManager=null,this.keyboardManager=null,this.settingsDialog=null,this.metadataCueChangeHandler=null,this.metadataAlertHandlers=new Map,this.init()}async init(){try{if(this.log("Initializing VidPly player"),this.options.languageFiles)try{await d.loadLanguagesFromUrls(this.options.languageFiles)}catch(t){console.warn("Failed to load some language files:",t)}if(this.options.languageFile&&this.options.languageFileUrl)try{await d.loadLanguageFromUrl(this.options.languageFile,this.options.languageFileUrl),this.log(`Custom language file loaded for ${this.options.languageFile}`)}catch(t){console.warn(`Failed to load language file for ${this.options.languageFile}:`,t)}if(!this.options.language||this.options.language==="en"){let t=this.detectHtmlLanguage();t&&(this.options.language=t,this.log(`Auto-detected language from HTML: ${t}`))}this.options.language||(this.options.language="en"),await d.ensureLanguage(this.options.language),d.setLanguage(this.options.language),this.createContainer(),this.element.src||this.element.querySelector("source")?.src?await this.initializeRenderer():this.log("No initial source - waiting for playlist or manual load"),this.options.controls&&(this.controlBar=new _(this),this.videoWrapper.appendChild(this.controlBar.element)),this.options.captions&&(this.captionManager=new R(this)),this.options.transcript&&await this.ensureTranscriptManager(),this.setupMetadataHandling(),this.options.keyboard&&(this.keyboardManager=new K(this)),this.setupResponsiveHandlers(),this.options.startTime>0&&this.seek(this.options.startTime),requestAnimationFrame(()=>{this.options.muted?this.mute():this.renderer&&this.renderer.media&&this.renderer.setMuted(!1),this.options.volume!==.8?this.setVolume(this.options.volume):this.renderer&&this.renderer.media&&this.renderer.setVolume(this.options.volume)}),this.state.ready=!0,this.emit("ready"),this.options.onReady&&this.options.onReady.call(this),this.options.autoplay&&this.play(),this.log("Player initialized successfully")}catch(e){this.handleError(e)}}async ensureTranscriptManager(){if(this.transcriptManager)return this.transcriptManager;if(!this.options.transcript&&!this.options.transcriptButton)return null;let e=await import("./vidply.TranscriptManager-DZ2WZU3K.min.js"),t=e.TranscriptManager||e.default;return t?(this.transcriptManager=new t(this),this.transcriptManager):null}async toggleTranscript(){let e=await this.ensureTranscriptManager();e&&(e.toggleTranscript(),this.controlBar&&this.controlBar.updateTranscriptButton())}detectHtmlLanguage(){let e=document.documentElement.lang||document.documentElement.getAttribute("lang");if(!e)return null;let t=e.toLowerCase().split("-")[0];return d.translations[t]||d.builtInLanguageLoaders&&d.builtInLanguageLoaders[t]?t:(this.log(`Language "${e}" not available, using English as fallback`),null)}createContainer(){let e=this.instanceId>1?`${d.t("player.label")} ${this.instanceId}`:d.t("player.label");this.container=u.createElement("div",{className:`${this.options.classPrefix}-player`,attributes:{role:"application","aria-label":e,tabindex:"0"}});let t=this.element.tagName.toLowerCase();this.container.classList.add(`${this.options.classPrefix}-${t}`),this.options.responsive&&this.container.classList.add(`${this.options.classPrefix}-responsive`),this.videoWrapper=u.createElement("div",{className:`${this.options.classPrefix}-video-wrapper`}),this.element.parentNode.insertBefore(this.container,this.element),this.element.tagName==="AUDIO"&&this.options.poster&&(this.trackArtworkElement=u.createElement("div",{className:`${this.options.classPrefix}-track-artwork`,attributes:{"aria-hidden":"true"}}),this.trackArtworkElement.style.backgroundImage=`url(${this.options.poster})`,this.container.appendChild(this.trackArtworkElement)),this.container.appendChild(this.videoWrapper),this.videoWrapper.appendChild(this.element),this.element.controls=!1,this.element.removeAttribute("controls"),this.element.setAttribute("tabindex","-1"),this.element.style.width="100%",this.element.style.height="100%",this.element.tagName==="VIDEO"&&this.options.playsInline&&(this.element.setAttribute("playsinline",""),this.element.playsInline=!0),this.options.width&&(this.container.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width),this.options.height&&(this.container.style.height=typeof this.options.height=="number"?`${this.options.height}px`:this.options.height),this.options.poster&&this.element.tagName==="VIDEO"&&(this.element.poster=this.resolvePosterPath(this.options.poster)),this.element.tagName==="VIDEO"&&this.createPlayButtonOverlay(),this.element.vidply=this,T.instances.push(this),this.element.style.cursor="pointer",this.element.addEventListener("click",i=>{i.target===this.element&&this.toggle()}),this.on("play",()=>{this.hidePosterOverlay()}),this.on("timeupdate",()=>{this.state.currentTime>0&&this.hidePosterOverlay()}),this.element.addEventListener("loadeddata",()=>{(this.state.playing||this.state.currentTime>0)&&this.hidePosterOverlay()},{once:!0})}createPlayButtonOverlay(){this.playButtonOverlay=G(),this.playButtonOverlay.addEventListener("click",()=>{this.toggle()}),this.videoWrapper.appendChild(this.playButtonOverlay),this.on("play",()=>{this.playButtonOverlay.style.opacity="0",this.playButtonOverlay.style.pointerEvents="none"}),this.on("pause",()=>{this.playButtonOverlay.style.opacity="1",this.playButtonOverlay.style.pointerEvents="auto",this.positionPlayOverlayOnMobile()}),this.on("ended",()=>{this.playButtonOverlay.style.opacity="1",this.playButtonOverlay.style.pointerEvents="auto",this.positionPlayOverlayOnMobile()}),this.debouncedPositionPlayOverlay=U(()=>{this.positionPlayOverlayOnMobile()},150),window.addEventListener("resize",this.debouncedPositionPlayOverlay),this.on("loadedmetadata",()=>{this.positionPlayOverlayOnMobile()}),this.on("enterfullscreen",()=>{O(()=>this.positionPlayOverlayOnMobile(),100)}),this.on("exitfullscreen",()=>{O(()=>this.positionPlayOverlayOnMobile(),100)})}positionPlayOverlayOnMobile(){if(!this.playButtonOverlay||this.element.tagName!=="VIDEO")return;if(!Q()){this.playButtonOverlay.style.top="";return}let t=this.element.getBoundingClientRect(),i=this.videoWrapper.getBoundingClientRect(),s=t.top-i.top+t.height/2;this.playButtonOverlay.style.top=`${s}px`}async initializeRenderer(){let e=this._pendingSource||this.element.src||this.element.querySelector("source")?.src;if(!e)throw new Error("No media source found");this.currentSource=e,this._pendingSource=null;let t=this.sourceElements;for(let n of t){let r=n.getAttribute("data-desc-src"),c=n.getAttribute("data-orig-src");if(r||c){if(this.audioDescriptionSourceElement||(this.audioDescriptionSourceElement=n),c)this.originalAudioDescriptionSource||(this.originalAudioDescriptionSource=c),this.originalSrc||(this.originalSrc=c);else{let h=n.getAttribute("src");!this.originalAudioDescriptionSource&&h&&(this.originalAudioDescriptionSource=h),!this.originalSrc&&h&&(this.originalSrc=h)}r&&!this.audioDescriptionSrc&&(this.audioDescriptionSrc=r)}}this.trackElements.forEach(n=>{let r=n.getAttribute("kind"),c=n.getAttribute("data-desc-src");(r==="captions"||r==="subtitles"||r==="chapters")&&c&&(this.audioDescriptionCaptionTracks.push({trackElement:n,originalSrc:n.getAttribute("src"),describedSrc:c,originalTrackSrc:n.getAttribute("data-orig-src")||n.getAttribute("src"),explicit:!0}),this.log(`Found explicit described ${r} track: ${n.getAttribute("src")} -> ${c}`))}),this.originalSrc||(this.originalSrc=e);let s=ee;if(e.includes("youtube.com")||e.includes("youtu.be")){let n=await import("./vidply.YouTubeRenderer-MFC2GMAC.min.js");s=n.YouTubeRenderer||n.default}else if(e.includes("vimeo.com")){let n=await import("./vidply.VimeoRenderer-3HBMM2WR.min.js");s=n.VimeoRenderer||n.default}else if(e.includes(".m3u8")){let n=await import("./vidply.HLSRenderer-CBXZ4RF2.min.js");s=n.HLSRenderer||n.default}else if(e.includes("soundcloud.com")||e.includes("api.soundcloud.com")){let n=await import("./vidply.SoundCloudRenderer-MOR2CUFH.min.js");s=n.SoundCloudRenderer||n.default}this.log(`Using ${s?.name||"HTML5Renderer"} renderer`),this.renderer=new s(this),await this.renderer.init(),this.invalidateTrackCache()}get textTracks(){return(!this._textTracksCache||this._textTracksDirty)&&(this._textTracksCache=Array.from(this.element.textTracks||[]),this._textTracksDirty=!1),this._textTracksCache}get sourceElements(){return(!this._sourceElementsCache||this._sourceElementsDirty)&&(this._sourceElementsCache=Array.from(this.element.querySelectorAll("source")),this._sourceElementsDirty=!1),this._sourceElementsCache}get trackElements(){return(!this._trackElementsCache||this._trackElementsDirty)&&(this._trackElementsCache=Array.from(this.element.querySelectorAll("track")),this._trackElementsDirty=!1),this._trackElementsCache}invalidateTrackCache(){this._textTracksDirty=!0,this._trackElementsDirty=!0,this._sourceElementsDirty=!0}findTextTrack(e,t=null){let i=this.textTracks;return t?i.find(s=>s.kind===e&&s.language===t):i.find(s=>s.kind===e)}findSourceElement(e,t=null){let i=this.sourceElements;return t?i.find(s=>s.getAttribute(e)===t):i.find(s=>s.hasAttribute(e))}findTrackElement(e){return this.trackElements.find(t=>t.track===e)}resolvePosterPath(e){if(!e||e.match(/^(https?:|\/)/))return e;try{return new URL(e,window.location.href).href}catch{return e}}showPosterOverlay(){if(!this.videoWrapper||this.element.tagName!=="VIDEO")return;let e=this.element.getAttribute("poster")||this.element.poster||this.options.poster;if(!e)return;let t=this.resolvePosterPath(e);this.videoWrapper.style.setProperty("--vidply-poster-image",`url("${t}")`),this.videoWrapper.classList.add("vidply-forced-poster"),this._isAudioContent&&this.container?this.container.classList.add("vidply-audio-content"):this.container&&this.container.classList.remove("vidply-audio-content")}hidePosterOverlay(){this.videoWrapper&&(this.videoWrapper.classList.remove("vidply-forced-poster"),this.videoWrapper.style.removeProperty("--vidply-poster-image"))}setManagedTimeout(e,t){let i=setTimeout(()=>{this.timeouts.delete(i),e()},t);return this.timeouts.add(i),i}clearManagedTimeout(e){e&&(clearTimeout(e),this.timeouts.delete(e))}isExternalRendererUrl(e){return e?e.includes("youtube.com")||e.includes("youtu.be")||e.includes("vimeo.com")||e.includes("soundcloud.com")||e.includes("api.soundcloud.com")||e.includes(".m3u8"):!1}async load(e){try{this.log("Loading new media:",e.src),this.renderer&&this.pause();let t=window.scrollX||window.pageXOffset,i=window.scrollY||window.pageYOffset;this.trackElements.forEach(o=>o.remove()),this.invalidateTrackCache();let n=this.isExternalRendererUrl(e.src);if(n&&(this._switchingRenderer=!0),n?(this.element.removeAttribute("src"),this.element.querySelectorAll("source").forEach(a=>a.removeAttribute("src"))):(this.element.src=e.src,e.type&&(this.element.type=e.type)),this._pendingSource=e.src,this._isAudioContent=e.type&&e.type.startsWith("audio/"),this.container&&(this._isAudioContent?this.container.classList.add("vidply-audio-content"):this.container.classList.remove("vidply-audio-content")),e.poster&&this.element.tagName==="VIDEO")if(this._isAudioContent){if(this.element.removeAttribute("poster"),this.videoWrapper){let o=this.resolvePosterPath(e.poster);this.videoWrapper.style.setProperty("--vidply-poster-image",`url("${o}")`),this.videoWrapper.classList.add("vidply-forced-poster")}}else this.element.poster=this.resolvePosterPath(e.poster),this.videoWrapper&&(this.videoWrapper.classList.remove("vidply-forced-poster"),this.videoWrapper.style.removeProperty("--vidply-poster-image"));e.tracks&&e.tracks.length>0&&(e.tracks.forEach(o=>{let a=document.createElement("track");a.src=o.src,a.kind=o.kind||"captions",a.srclang=o.srclang||"en",a.label=o.label||o.srclang,o.default&&(a.default=!0);let l=this.element.firstChild;l&&l.nodeType===Node.ELEMENT_NODE&&l.tagName!=="TRACK"?this.element.insertBefore(a,l):this.element.appendChild(a)}),this.invalidateTrackCache());let r=this.state.signLanguageEnabled,c=this.state.audioDescriptionEnabled;this.audioDescriptionSrc=e.audioDescriptionSrc||null,this.signLanguageSrc=e.signLanguageSrc||null,this.originalSrc=e.src,c&&this.disableAudioDescription(),r&&this.disableSignLanguage();let h=this.shouldChangeRenderer(e.src);if(h&&this.renderer&&(this.renderer.destroy(),this.renderer=null),!this.renderer||h?await this.initializeRenderer():(this.renderer.media=this.element,this.element.load()),n?setTimeout(()=>{this._switchingRenderer=!1},500):this._switchingRenderer=!1,window.scrollTo(t,i),this.captionManager&&(this.captionManager.destroy(),this.captionManager=new R(this)),this.transcriptManager){let o=this.transcriptManager.isVisible;this.transcriptManager.destroy(),this.transcriptManager=null,await this.ensureTranscriptManager(),o&&this.controlBar&&this.controlBar.hasCaptionTracks()&&this.transcriptManager?.showTranscript()}this.controlBar&&this.updateControlBar(),window.scrollTo(t,i),r&&this.signLanguageSrc&&setTimeout(()=>{this.enableSignLanguage(),window.scrollTo(t,i)},150),c&&this.audioDescriptionSrc&&setTimeout(()=>{this.enableAudioDescription(),window.scrollTo(t,i)},150),this.emit("sourcechange",e),this.log("Media loaded successfully")}catch(t){this.handleError(t)}}updateControlBar(){if(!this.controlBar)return;let e=this.controlBar;e.element.innerHTML="",e.createControls(),e.attachEvents(),e.setupAutoHide(),e.setupOverflowDetection()}shouldChangeRenderer(e){if(!this.renderer)return!0;let t=e.includes("youtube.com")||e.includes("youtu.be"),i=e.includes("vimeo.com"),s=e.includes(".m3u8"),n=e.includes("soundcloud.com")||e.includes("api.soundcloud.com"),r=this.renderer.constructor.name;return!!(t&&r!=="YouTubeRenderer"||i&&r!=="VimeoRenderer"||s&&r!=="HLSRenderer"||n&&r!=="SoundCloudRenderer"||!t&&!i&&!s&&!n&&r!=="HTML5Renderer")}play(){this.renderer&&this.renderer.play()}pause(){this.renderer&&this.renderer.pause()}stop(){this.pause(),this.seek(0)}toggle(){this.state.playing?this.pause():this.play()}seek(e){this.renderer&&this.renderer.seek(e)}seekForward(e=this.options.seekInterval){this.seek(Math.min(this.state.currentTime+e,this.state.duration))}seekBackward(e=this.options.seekInterval){this.seek(Math.max(this.state.currentTime-e,0))}setVolume(e){let t=Math.max(0,Math.min(1,e));this.renderer&&this.renderer.setVolume(t),this.state.volume=t,t>0&&this.state.muted&&(this.state.muted=!1,this.renderer&&this.renderer.setMuted(!1),this.emit("volumechange")),this.savePlayerPreferences()}getVolume(){return this.state.volume}mute(){this.renderer&&this.renderer.setMuted(!0),this.state.muted=!0,this.savePlayerPreferences(),this.emit("volumechange")}unmute(){this.renderer&&this.renderer.setMuted(!1),this.state.muted=!1,this.savePlayerPreferences(),this.emit("volumechange")}toggleMute(){this.state.muted?this.unmute():this.mute()}setPlaybackSpeed(e){let t=Math.max(.25,Math.min(2,e));this.renderer&&this.renderer.setPlaybackSpeed(t),this.state.playbackSpeed=t,this.savePlayerPreferences(),this.emit("playbackspeedchange",t)}getPlaybackSpeed(){return this.state.playbackSpeed}savePlayerPreferences(){this.storage.savePlayerPreferences({volume:this.state.volume,muted:this.state.muted,playbackSpeed:this.state.playbackSpeed})}enterFullscreen(){let e=this.container,t=null;if(/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1){this._enablePseudoFullscreen();return}e.requestFullscreen?t=e.requestFullscreen():e.webkitRequestFullscreen?t=e.webkitRequestFullscreen():e.mozRequestFullScreen?t=e.mozRequestFullScreen():e.msRequestFullscreen&&(t=e.msRequestFullscreen()),t&&t.catch&&t.catch(s=>{this.log("Fullscreen API failed, using pseudo-fullscreen:",s.message),this._enablePseudoFullscreen()}),!e.requestFullscreen&&!e.webkitRequestFullscreen&&!e.mozRequestFullScreen&&!e.msRequestFullscreen?this._enablePseudoFullscreen():(this.state.fullscreen=!0,this.container.classList.add(`${this.options.classPrefix}-fullscreen`),this.emit("fullscreenchange",!0))}exitFullscreen(){!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():this._disablePseudoFullscreen(),this.state.fullscreen=!1,this.container.classList.remove(`${this.options.classPrefix}-fullscreen`),this.emit("fullscreenchange",!1)}toggleFullscreen(){this.state.fullscreen?this.exitFullscreen():this.enterFullscreen()}_enablePseudoFullscreen(){this.state.fullscreen=!0,this.container.classList.add(`${this.options.classPrefix}-fullscreen`),this._originalScrollX=window.scrollX||window.pageXOffset,this._originalScrollY=window.scrollY||window.pageYOffset,this._originalBodyOverflow=document.body.style.overflow,this._originalBodyPosition=document.body.style.position,this._originalBodyWidth=document.body.style.width,this._originalBodyHeight=document.body.style.height,this._originalHtmlOverflow=document.documentElement.style.overflow,document.body.style.overflow="hidden",document.body.style.width="100%",document.body.style.height="100%",document.documentElement.style.overflow="hidden",this._originalViewport=document.querySelector('meta[name="viewport"]')?.getAttribute("content");let e=document.querySelector('meta[name="viewport"]');e&&e.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"),window.scrollTo(0,0),this.emit("fullscreenchange",!0),this.emit("enterfullscreen")}_disablePseudoFullscreen(){if(this._originalBodyOverflow!==void 0&&(document.body.style.overflow=this._originalBodyOverflow,delete this._originalBodyOverflow),this._originalBodyPosition!==void 0&&(document.body.style.position=this._originalBodyPosition,delete this._originalBodyPosition),this._originalBodyWidth!==void 0&&(document.body.style.width=this._originalBodyWidth,delete this._originalBodyWidth),this._originalBodyHeight!==void 0&&(document.body.style.height=this._originalBodyHeight,delete this._originalBodyHeight),this._originalHtmlOverflow!==void 0&&(document.documentElement.style.overflow=this._originalHtmlOverflow,delete this._originalHtmlOverflow),this._originalViewport!==void 0){let e=document.querySelector('meta[name="viewport"]');e&&e.setAttribute("content",this._originalViewport),delete this._originalViewport}this._originalScrollX!==void 0&&this._originalScrollY!==void 0&&(window.scrollTo(this._originalScrollX,this._originalScrollY),delete this._originalScrollX,delete this._originalScrollY),this.emit("exitfullscreen")}enterPiP(){this.element.requestPictureInPicture&&(this.element.requestPictureInPicture(),this.state.pip=!0,this.emit("pipchange",!0))}exitPiP(){document.pictureInPictureElement&&(document.exitPictureInPicture(),this.state.pip=!1,this.emit("pipchange",!1))}togglePiP(){this.state.pip?this.exitPiP():this.enterPiP()}enableCaptions(){this.captionManager&&(this.captionManager.enable(),this.state.captionsEnabled=!0)}disableCaptions(){this.captionManager&&(this.captionManager.disable(),this.state.captionsEnabled=!1)}toggleCaptions(){this.state.captionsEnabled?this.disableCaptions():this.enableCaptions()}async validateTrackExists(e){try{return(await fetch(e,{method:"HEAD",cache:"no-cache"})).ok}catch{return!1}}stripVTTFormatting(e){return e?e.replace(/<[^>]+>/g,"").replace(/\n/g," ").trim().toLowerCase():""}findMatchingCaptionTime(e,t){if(!e||!t||t.length===0)return null;let i=this.stripVTTFormatting(e);for(let s of t){if(s.kind!=="captions"&&s.kind!=="subtitles")continue;let n=s.track;if(!(!n||!n.cues))for(let r=0;r<n.cues.length;r++){let c=n.cues[r],h=this.stripVTTFormatting(c.text);if(h===i)return c.startTime;let o=i.split(/\s+/).filter(l=>l.length>2),a=h.split(/\s+/).filter(l=>l.length>2);if(o.length>0&&a.length>0&&o.filter(p=>a.includes(p)).length/o.length>=.8)return c.startTime}}return null}async enableAudioDescription(){let e=this.sourceElements.some(a=>a.getAttribute("data-desc-src")),t=this.audioDescriptionCaptionTracks.length>0;if(!this.audioDescriptionSrc&&!e&&!t){console.warn("VidPly: No audio description source, source elements, or tracks provided");return}let i=this.element.currentTime,s=this.state.playing,n=!s&&i===0,r=null;if(this.captionManager&&this.captionManager.currentTrack){let a=this.captionManager.currentTrack.track;if(a&&a.activeCues&&a.activeCues.length>0){let l=a.activeCues[0];r=this.stripVTTFormatting(l.text)}}let c=this.resolvePosterPath(this.element.getAttribute("poster")||this.element.poster||this.options.poster);n&&this.showPosterOverlay();let h=[];if(this.audioDescriptionSourceElement){let a=this.element.currentSrc||this.element.src,l=this.sourceElements,g=null,p=this.audioDescriptionSrc;for(let f of l){let v=f.getAttribute("src"),E=f.getAttribute("data-desc-src"),L=v?v.split("/").pop():"",S=a?a.split("/").pop():"";if(a&&(a===v||a.includes(v)||a.includes(L)||L&&S===L)){g=f,E?p=E:v&&(p=this.audioDescriptionSrc||p);break}}if(!g){g=this.audioDescriptionSourceElement;let f=g.getAttribute("data-desc-src");f&&(p=f)}if(this.audioDescriptionCaptionTracks.length>0){let f=this.audioDescriptionCaptionTracks.map(async L=>{if(L.trackElement&&L.describedSrc)if(L.explicit===!0)try{let S=await this.validateTrackExists(L.describedSrc);return{trackInfo:L,exists:S}}catch{return{trackInfo:L,exists:!1}}else return{trackInfo:L,exists:!1};return{trackInfo:L,exists:!1}}),v=await Promise.all(f),E=v.filter(L=>L.exists);if(E.length>0){let L=new Map;E.forEach(({trackInfo:P})=>{let B=P.trackElement.track;B?L.set(P,{wasShowing:B.mode==="showing",wasHidden:B.mode==="hidden"}):L.set(P,{wasShowing:!1,wasHidden:!1})});let S=E.map(({trackInfo:P})=>{let B=P.trackElement.getAttribute("src"),$=P.trackElement.parentNode,X=P.trackElement.nextSibling,A={};return Array.from(P.trackElement.attributes).forEach(D=>{A[D.name]=D.value}),{trackInfo:P,oldSrc:B,parent:$,nextSibling:X,attributes:A}});S.forEach(({trackInfo:P})=>{P.trackElement.remove()}),this.element.load(),await new Promise(P=>{setTimeout(()=>{S.forEach(({trackInfo:$,oldSrc:X,parent:A,nextSibling:D,attributes:H})=>{h.push($);let N=document.createElement("track");N.setAttribute("src",$.describedSrc),Object.keys(H).forEach(I=>{I!=="src"&&I!=="data-desc-src"&&N.setAttribute(I,H[I])}),D&&D.parentNode?A.insertBefore(N,D):A.appendChild(N),$.trackElement=N}),this.invalidateTrackCache();let B=()=>{this.setManagedTimeout(()=>{h.forEach($=>{let A=$.trackElement.track;if(A){let D=L.get($)||{wasShowing:!1,wasHidden:!1};A.mode="hidden";let H=()=>{D.wasShowing||D.wasHidden?A.mode="hidden":A.mode="disabled"};A.readyState>=2?H():(A.addEventListener("load",H,{once:!0}),A.addEventListener("error",H,{once:!0}))}})},300)};this.element.readyState>=1?setTimeout(B,200):(this.element.addEventListener("loadedmetadata",B,{once:!0}),setTimeout(B,2e3)),P()},100)});let C=v.length-E.length}}let y=this.sourceElements,b=[];y.forEach(f=>{let v=f.getAttribute("data-desc-src"),E=f.getAttribute("src");if(v){let L=f.getAttribute("type"),S=f.getAttribute("data-orig-src");S||(S=E),b.push({src:v,type:L,origSrc:S,descSrc:v})}else{let L=f.getAttribute("type"),S=f.getAttribute("src");b.push({src:S,type:L,origSrc:null,descSrc:null})}});let k=this.element.hasAttribute("src"),m=k?this.element.getAttribute("src"):null;k&&this.element.removeAttribute("src"),y.forEach(f=>{f.remove()}),b.forEach(f=>{let v=document.createElement("source");v.setAttribute("src",f.src),f.type&&v.setAttribute("type",f.type),f.origSrc&&v.setAttribute("data-orig-src",f.origSrc),f.descSrc&&v.setAttribute("data-desc-src",f.descSrc);let E=this.element.querySelector("track");E?this.element.insertBefore(v,E):this.element.appendChild(v)}),this._sourceElementsDirty=!0,this._sourceElementsCache=null,c&&this.element.tagName==="VIDEO"&&(this.element.poster=c),this.element.load(),await new Promise(f=>{let v=()=>{this.element.removeEventListener("loadedmetadata",v),f()};this.element.readyState>=1?f():this.element.addEventListener("loadedmetadata",v)}),await new Promise(f=>setTimeout(f,300)),(i>0||s)&&await new Promise(f=>{let v=()=>{this.element.removeEventListener("canplay",v),this.element.removeEventListener("canplaythrough",v),f()};this.element.readyState>=3?f():(this.element.addEventListener("canplay",v,{once:!0}),this.element.addEventListener("canplaythrough",v,{once:!0}),setTimeout(()=>{this.element.removeEventListener("canplay",v),this.element.removeEventListener("canplaythrough",v),f()},3e3))});let M=i;if(r&&this.captionManager&&this.captionManager.tracks.length>0){await new Promise(v=>setTimeout(v,500));let f=this.findMatchingCaptionTime(r,this.captionManager.tracks);f!==null&&(M=f,this.options.debug&&console.log(`[VidPly] Syncing via caption: ${i}s -> ${M}s`))}if(M>0&&(this.seek(M),await new Promise(f=>setTimeout(f,100))),s?(await this.play(),this.setManagedTimeout(()=>{this.hidePosterOverlay()},100)):(this.pause(),n||this.hidePosterOverlay()),!this._audioDescriptionDesiredState)return;this.state.audioDescriptionEnabled=!0,this.emit("audiodescriptionenabled")}else{if(this.audioDescriptionCaptionTracks.length>0){let g=this.audioDescriptionCaptionTracks.map(async b=>{if(b.trackElement&&b.describedSrc)if(b.explicit===!0)try{let k=await this.validateTrackExists(b.describedSrc);return{trackInfo:b,exists:k}}catch{return{trackInfo:b,exists:!1}}else return{trackInfo:b,exists:!1};return{trackInfo:b,exists:!1}}),y=(await Promise.all(g)).filter(b=>b.exists);if(y.length>0){let b=new Map;y.forEach(({trackInfo:m})=>{let M=m.trackElement.track;M?b.set(m,{wasShowing:M.mode==="showing",wasHidden:M.mode==="hidden"}):b.set(m,{wasShowing:!1,wasHidden:!1})});let k=y.map(({trackInfo:m})=>{let M=m.trackElement.getAttribute("src"),f=m.trackElement.parentNode,v=m.trackElement.nextSibling,E={};return Array.from(m.trackElement.attributes).forEach(L=>{E[L.name]=L.value}),{trackInfo:m,oldSrc:M,parent:f,nextSibling:v,attributes:E}});k.forEach(({trackInfo:m})=>{m.trackElement.remove()}),this.element.load(),setTimeout(()=>{k.forEach(({trackInfo:M,oldSrc:f,parent:v,nextSibling:E,attributes:L})=>{h.push(M);let S=document.createElement("track");S.setAttribute("src",M.describedSrc),Object.keys(L).forEach(P=>{P!=="src"&&P!=="data-desc-src"&&S.setAttribute(P,L[P])});let C=v.firstChild;C&&C.nodeType===Node.ELEMENT_NODE&&C.tagName!=="TRACK"?v.insertBefore(S,C):E&&E.parentNode?v.insertBefore(S,E):v.appendChild(S),M.trackElement=S}),this.element.load();let m=()=>{setTimeout(()=>{h.forEach(M=>{let v=M.trackElement.track;if(v){let E=b.get(M)||{wasShowing:!1,wasHidden:!1};v.mode="hidden";let L=()=>{E.wasShowing||E.wasHidden?v.mode="hidden":v.mode="disabled"};v.readyState>=2?L():(v.addEventListener("load",L,{once:!0}),v.addEventListener("error",L,{once:!0}))}})},300)};this.element.readyState>=1?setTimeout(m,200):(this.element.addEventListener("loadedmetadata",m,{once:!0}),setTimeout(m,2e3))},100)}}let a=this.sourceElements;if(a.some(g=>g.getAttribute("data-desc-src"))){let g=[];a.forEach(p=>{let y=p.getAttribute("data-desc-src"),b=p.getAttribute("src");if(y){let k=p.getAttribute("type"),m=p.getAttribute("data-orig-src");m||(m=b),g.push({src:y,type:k,origSrc:m,descSrc:y})}else{let k=p.getAttribute("type"),m=p.getAttribute("src");g.push({src:m,type:k,origSrc:null,descSrc:null})}}),a.forEach(p=>{p.remove()}),g.forEach(p=>{let y=document.createElement("source");y.setAttribute("src",p.src),p.type&&y.setAttribute("type",p.type),p.origSrc&&y.setAttribute("data-orig-src",p.origSrc),p.descSrc&&y.setAttribute("data-desc-src",p.descSrc),this.element.appendChild(y)}),c&&this.element.tagName==="VIDEO"&&(this.element.poster=c),this.element.load(),this.invalidateTrackCache()}else c&&this.element.tagName==="VIDEO"&&(this.element.poster=c),this.element.src=this.audioDescriptionSrc}await new Promise(a=>{let l=()=>{this.element.removeEventListener("loadedmetadata",l),a()};this.element.readyState>=1?a():this.element.addEventListener("loadedmetadata",l)}),(i>0||s)&&await new Promise(a=>{let l=()=>{this.element.removeEventListener("canplay",l),this.element.removeEventListener("canplaythrough",l),a()};this.element.readyState>=3?a():(this.element.addEventListener("canplay",l,{once:!0}),this.element.addEventListener("canplaythrough",l,{once:!0}),setTimeout(()=>{this.element.removeEventListener("canplay",l),this.element.removeEventListener("canplaythrough",l),a()},3e3))}),this.element.tagName==="VIDEO"&&i===0&&!s&&this.element.readyState>=1&&(this.element.currentTime=.001,this.setManagedTimeout(()=>{this.element.currentTime=0},10));let o=i;if(r&&this.captionManager&&this.captionManager.tracks.length>0){await new Promise(l=>setTimeout(l,500));let a=this.findMatchingCaptionTime(r,this.captionManager.tracks);a!==null&&(o=a,this.options.debug&&console.log(`[VidPly] Syncing via caption: ${i}s -> ${o}s`))}if(o>0&&(this.seek(o),await new Promise(a=>setTimeout(a,100))),s?(await this.play(),this.setManagedTimeout(()=>{this.hidePosterOverlay()},100)):(this.pause(),n||this.hidePosterOverlay()),h.length>0&&this.captionManager){let a=this.state.captionsEnabled,l=null;if(this.captionManager.currentTrack){let p=this.captionManager.tracks.findIndex(y=>y.track===this.captionManager.currentTrack.track);p>=0&&(l={language:this.captionManager.tracks[p].language,kind:this.captionManager.tracks[p].kind})}setTimeout(()=>{if(this.captionManager.tracks=[],this.captionManager.loadTracks(),a&&l&&this.captionManager.tracks.length>0){let p=this.captionManager.tracks.findIndex(y=>y.language===l.language&&y.kind===l.kind);if(p>=0){let y=this.captionManager.tracks[p];if(y.track.readyState>=2)this.captionManager.enable(p);else{let b=()=>{y.track.removeEventListener("load",b),y.track.removeEventListener("error",b),this.captionManager&&this.captionManager.tracks.includes(y)&&this.captionManager.enable(p)};y.track.addEventListener("load",b,{once:!0}),y.track.addEventListener("error",b,{once:!0}),y.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(y)&&this.captionManager.enable(p)},1e3)}}else if(this.captionManager.tracks.length>0){let y=this.captionManager.tracks[0];if(y.track.readyState>=2)this.captionManager.enable(0);else{let b=()=>{y.track.removeEventListener("load",b),y.track.removeEventListener("error",b),this.captionManager&&this.captionManager.tracks.includes(y)&&this.captionManager.enable(0)};y.track.addEventListener("load",b,{once:!0}),y.track.addEventListener("error",b,{once:!0}),y.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(y)&&this.captionManager.enable(0)},1e3)}}}},600)}if(this.transcriptManager&&this.transcriptManager.isVisible){let a=typeof h<"u"?h:[];if(a.length>0){let l=()=>{this.invalidateTrackCache();let p=this.textTracks,y=a.map(m=>{let M=m.trackElement,f=M.getAttribute("src"),v=M.getAttribute("srclang"),E=M.getAttribute("kind"),L=p.find(S=>M.track===S);if(L||(L=p.find(S=>{if(S.language===v&&(S.kind===E||E==="captions"&&S.kind==="subtitles")){let C=this.findTrackElement(S);if(C&&C.getAttribute("src")===f)return!0}return!1})),L){let S=this.findTrackElement(L);if(S&&S.getAttribute("src")!==f)return null}return L}).filter(Boolean);if(y.length===0){this.setManagedTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},1e3);return}y.forEach(m=>{m.mode==="disabled"&&(m.mode="hidden")});let b=0,k=()=>{b++,b>=y.length&&this.setManagedTimeout(()=>{if(this.transcriptManager&&this.transcriptManager.loadTranscriptData){this.invalidateTrackCache();let m=this.textTracks,M=a.map(v=>v.describedSrc);(y.some(v=>{let E=this.findTrackElement(v);return E&&M.includes(E.getAttribute("src"))})||y.length>0)&&this.transcriptManager.loadTranscriptData()}},800)};y.forEach(m=>{m.mode==="disabled"&&(m.mode="hidden");let M=this.findTrackElement(m),f=M?M.getAttribute("src"):null,v=a.find(L=>{let S=L.trackElement;return S&&(S.track===m||S.getAttribute("srclang")===m.language&&S.getAttribute("kind")===m.kind)}),E=v?v.describedSrc:null;if(E&&f&&f!==E){k();return}if(m.readyState>=2&&m.cues&&m.cues.length>0)k();else{m.mode==="disabled"&&(m.mode="hidden");let L=()=>{this.setManagedTimeout(k,300)};m.readyState>=2?this.setManagedTimeout(()=>{m.cues&&m.cues.length>0?k():m.addEventListener("load",L,{once:!0})},100):(m.addEventListener("load",L,{once:!0}),m.addEventListener("error",()=>{k()},{once:!0}))}})};this.setManagedTimeout(()=>{this.element.readyState>=1?l():(this.element.addEventListener("loadedmetadata",l,{once:!0}),this.setManagedTimeout(l,2e3))},500),setTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},5e3)}else setTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},800)}n||this.hidePosterOverlay(),this._audioDescriptionDesiredState&&(this.state.audioDescriptionEnabled=!0,this.emit("audiodescriptionenabled"))}async disableAudioDescription(){if(!this.originalSrc)return;let e=this.element.currentTime,t=this.state.playing,i=null;if(this.captionManager&&this.captionManager.currentTrack){let o=this.captionManager.currentTrack.track;if(o&&o.activeCues&&o.activeCues.length>0){let a=o.activeCues[0];i=this.stripVTTFormatting(a.text)}}let s=this.resolvePosterPath(this.element.getAttribute("poster")||this.element.poster||this.options.poster),n=[];if(this.audioDescriptionCaptionTracks.length>0){let o=this.audioDescriptionCaptionTracks.map(a=>{let l=a.trackElement;if(!l||!l.parentNode)return null;let g=l.parentNode,p=l.nextSibling,y={};return Array.from(l.attributes).forEach(b=>{y[b.name]=b.value}),{trackInfo:a,parent:g,nextSibling:p,attributes:y}}).filter(Boolean);o.forEach(({trackInfo:a})=>{a.trackElement&&a.trackElement.parentNode&&a.trackElement.remove()}),this.element.load(),await new Promise(a=>{setTimeout(()=>{o.forEach(({trackInfo:l,parent:g,nextSibling:p,attributes:y})=>{n.push(l);let b=document.createElement("track");b.setAttribute("src",l.originalTrackSrc),Object.keys(y).forEach(k=>{k!=="src"&&k!=="data-desc-src"&&b.setAttribute(k,y[k])}),l.describedSrc&&b.setAttribute("data-desc-src",l.describedSrc),p&&p.parentNode?g.insertBefore(b,p):g.appendChild(b),l.trackElement=b}),this.invalidateTrackCache(),a()},100)})}let r=this.sourceElements;if(r.some(o=>o.getAttribute("data-orig-src"))){let o=[];r.forEach(g=>{let p=g.getAttribute("data-orig-src"),y=g.getAttribute("data-desc-src");if(p){let b=g.getAttribute("type");o.push({src:p,type:b,origSrc:p,descSrc:y})}else{let b=g.getAttribute("type"),k=g.getAttribute("src");o.push({src:k,type:b,origSrc:null,descSrc:y})}});let a=this.element.hasAttribute("src"),l=a?this.element.getAttribute("src"):null;a&&this.element.removeAttribute("src"),r.forEach(g=>{g.remove()}),o.forEach(g=>{let p=document.createElement("source");p.setAttribute("src",g.src),g.type&&p.setAttribute("type",g.type),g.origSrc&&p.setAttribute("data-orig-src",g.origSrc),g.descSrc&&p.setAttribute("data-desc-src",g.descSrc);let y=this.element.querySelector("track");y?this.element.insertBefore(p,y):this.element.appendChild(p)}),this._sourceElementsDirty=!0,this._sourceElementsCache=null,s&&this.element.tagName==="VIDEO"&&(this.element.poster=s),this.element.load()}else{s&&this.element.tagName==="VIDEO"&&(this.element.poster=s);let o=this.originalAudioDescriptionSource||this.originalSrc;this.element.src=o,this.element.load()}await new Promise(o=>{let a=()=>{this.element.removeEventListener("loadedmetadata",a),o()};this.element.readyState>=1?o():this.element.addEventListener("loadedmetadata",a)}),(e>0||t)&&await new Promise(o=>{let a=()=>{this.element.removeEventListener("canplay",a),this.element.removeEventListener("canplaythrough",a),o()};this.element.readyState>=3?o():(this.element.addEventListener("canplay",a,{once:!0}),this.element.addEventListener("canplaythrough",a,{once:!0}),setTimeout(()=>{this.element.removeEventListener("canplay",a),this.element.removeEventListener("canplaythrough",a),o()},3e3))});let h=e;if(i&&this.captionManager&&this.captionManager.tracks.length>0){await new Promise(a=>setTimeout(a,500));let o=this.findMatchingCaptionTime(i,this.captionManager.tracks);o!==null&&(h=o,this.options.debug&&console.log(`[VidPly] Syncing via caption: ${e}s -> ${h}s`))}if(h>0&&(this.seek(h),await new Promise(o=>setTimeout(o,100))),t?(await this.play(),this.hidePosterOverlay()):(this.pause(),!t&&h===0?this.showPosterOverlay():this.hidePosterOverlay()),n.length>0&&this.captionManager){let o=this.state.captionsEnabled,a=null;if(this.captionManager.currentTrack){let g=this.captionManager.tracks.findIndex(p=>p.track===this.captionManager.currentTrack.track);g>=0&&(a={language:this.captionManager.tracks[g].language,kind:this.captionManager.tracks[g].kind})}setTimeout(()=>{if(this.captionManager.tracks=[],this.captionManager.loadTracks(),o&&a&&this.captionManager.tracks.length>0){let g=this.captionManager.tracks.findIndex(p=>p.language===a.language&&p.kind===a.kind);if(g>=0){let p=this.captionManager.tracks[g];if(p.track.readyState>=2)this.captionManager.enable(g);else{let y=()=>{p.track.removeEventListener("load",y),p.track.removeEventListener("error",y),this.captionManager&&this.captionManager.tracks.includes(p)&&this.captionManager.enable(g)};p.track.addEventListener("load",y,{once:!0}),p.track.addEventListener("error",y,{once:!0}),p.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(p)&&this.captionManager.enable(g)},1e3)}}else if(this.captionManager.tracks.length>0){let p=this.captionManager.tracks[0];if(p.track.readyState>=2)this.captionManager.enable(0);else{let y=()=>{p.track.removeEventListener("load",y),p.track.removeEventListener("error",y),this.captionManager&&this.captionManager.tracks.includes(p)&&this.captionManager.enable(0)};p.track.addEventListener("load",y,{once:!0}),p.track.addEventListener("error",y,{once:!0}),p.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(p)&&this.captionManager.enable(0)},1e3)}}}},600)}this.transcriptManager&&this.transcriptManager.isVisible&&this.setManagedTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},500),!this._audioDescriptionDesiredState&&(this.state.audioDescriptionEnabled=!1,this.emit("audiodescriptiondisabled"))}async toggleAudioDescription(){let e=this.findTextTrack("descriptions"),t=this.audioDescriptionSrc||this.sourceElements.some(i=>i.getAttribute("data-desc-src"));if(e&&t)if(this.state.audioDescriptionEnabled)this._audioDescriptionDesiredState=!1,e.mode="hidden",await this.disableAudioDescription();else{this._audioDescriptionDesiredState=!0,await this.enableAudioDescription();let i=()=>{this.invalidateTrackCache();let s=this.findTextTrack("descriptions");s?s.mode==="disabled"?(s.mode="hidden",this.setManagedTimeout(()=>{s.mode="showing"},50)):s.mode="showing":this.element.readyState<2&&this.setManagedTimeout(i,100)};this.element.readyState>=1?this.setManagedTimeout(i,200):this.element.addEventListener("loadedmetadata",()=>{this.setManagedTimeout(i,200)},{once:!0})}else e?e.mode==="showing"?(this._audioDescriptionDesiredState=!1,e.mode="hidden",this.state.audioDescriptionEnabled=!1,this.emit("audiodescriptiondisabled")):(this._audioDescriptionDesiredState=!0,e.mode="showing",this.state.audioDescriptionEnabled=!0,this.emit("audiodescriptionenabled")):t&&(this.state.audioDescriptionEnabled?(this._audioDescriptionDesiredState=!1,await this.disableAudioDescription()):(this._audioDescriptionDesiredState=!0,await this.enableAudioDescription()))}enableSignLanguage(){let e=Object.keys(this.signLanguageSources).length>0,t=!!this.signLanguageSrc;if(!e&&!t){console.warn("No sign language video source provided");return}if(this.signLanguageWrapper){this.signLanguageWrapper.style.display="block",this.state.signLanguageEnabled=!0,this.emit("signlanguageenabled"),this.setManagedTimeout(()=>{this.signLanguageSettingsButton&&document.contains(this.signLanguageSettingsButton)&&this.signLanguageSettingsButton.focus({preventScroll:!0})},150);return}let i=null,s=null;if(e){if(this.captionManager&&this.captionManager.currentTrack){let l=this.captionManager.currentTrack.language?.toLowerCase().split("-")[0];l&&this.signLanguageSources[l]&&(i=l,s=this.signLanguageSources[l])}if(!i&&this.options.language){let l=this.options.language.toLowerCase().split("-")[0];this.signLanguageSources[l]&&(i=l,s=this.signLanguageSources[l])}i||(i=Object.keys(this.signLanguageSources)[0],s=this.signLanguageSources[i]),this.currentSignLanguage=i}else s=this.signLanguageSrc;this.signLanguageWrapper=document.createElement("div"),this.signLanguageWrapper.className="vidply-sign-language-wrapper",this.signLanguageWrapper.setAttribute("tabindex","0"),this.signLanguageWrapper.setAttribute("aria-label",d.t("player.signLanguageDragResize")),this.signLanguageHeader=u.createElement("div",{className:`${this.options.classPrefix}-sign-language-header`,attributes:{tabindex:"0"}});let n=u.createElement("div",{className:`${this.options.classPrefix}-sign-language-header-left`}),r=u.createElement("h3",{textContent:d.t("player.signLanguageVideo")}),c=d.t("player.signLanguageSettings");if(this.signLanguageSettingsButton=u.createElement("button",{className:`${this.options.classPrefix}-sign-language-settings`,attributes:{type:"button","aria-label":c,"aria-expanded":"false"}}),this.signLanguageSettingsButton.appendChild(w("settings")),u.attachTooltip(this.signLanguageSettingsButton,c,this.options.classPrefix),this.signLanguageSettingsHandlers={settingsClick:l=>{if(l.preventDefault(),l.stopPropagation(),this.signLanguageDocumentClickHandler){let g=this.signLanguageSettingsMenuJustOpened;this.signLanguageSettingsMenuJustOpened=!0,setTimeout(()=>{this.signLanguageSettingsMenuJustOpened=g},100)}this.signLanguageSettingsMenuVisible?this.hideSignLanguageSettingsMenu():this.showSignLanguageSettingsMenu()},settingsKeydown:l=>{l.key==="d"||l.key==="D"?(l.preventDefault(),l.stopPropagation(),this.toggleSignLanguageKeyboardDragMode()):l.key==="r"||l.key==="R"?(l.preventDefault(),l.stopPropagation(),this.toggleSignLanguageResizeMode()):l.key==="Escape"&&this.signLanguageSettingsMenuVisible&&(l.preventDefault(),l.stopPropagation(),this.hideSignLanguageSettingsMenu())}},this.signLanguageSettingsButton.addEventListener("click",this.signLanguageSettingsHandlers.settingsClick),this.signLanguageSettingsButton.addEventListener("keydown",this.signLanguageSettingsHandlers.settingsKeydown),n.appendChild(this.signLanguageSettingsButton),this.signLanguageSelector=null,e){let l=`${this.options.classPrefix}-sign-language-select-${Date.now()}`,g=Object.keys(this.signLanguageSources).map(k=>({value:k,text:this.getSignLanguageLabel(k),selected:k===i})),{label:p,select:y}=ie({classPrefix:this.options.classPrefix,labelClass:`${this.options.classPrefix}-sign-language-label`,selectClass:`${this.options.classPrefix}-sign-language-select`,labelText:"settings.language",selectId:l,options:g,onChange:k=>{k.stopPropagation();let m=k.target.value;this.switchSignLanguage(m)}});this.signLanguageSelector=y;let b=u.createElement("div",{className:`${this.options.classPrefix}-sign-language-selector-wrapper`});b.appendChild(p),b.appendChild(this.signLanguageSelector),se(b),n.appendChild(b)}n.appendChild(r);let h=d.t("player.closeSignLanguage"),o=u.createElement("button",{className:`${this.options.classPrefix}-sign-language-close`,attributes:{type:"button","aria-label":h}});o.appendChild(w("close")),u.attachTooltip(o,h,this.options.classPrefix),o.addEventListener("click",()=>{this.disableSignLanguage(),this.controlBar&&this.controlBar.controls&&this.controlBar.controls.signLanguage&&setTimeout(()=>{this.controlBar.controls.signLanguage.focus({preventScroll:!0})},0)}),this.signLanguageHeader.appendChild(n),this.signLanguageHeader.appendChild(o),this.signLanguageSettingsMenuVisible=!1,this.signLanguageSettingsMenu=null,this.signLanguageSettingsMenuJustOpened=!1,this.signLanguageResizeOptionButton=null,this.signLanguageResizeOptionText=null,this.signLanguageDragOptionButton=null,this.signLanguageDragOptionText=null,this.signLanguageDocumentClickHandler=null,this.signLanguageDocumentClickHandlerAdded=!1,this.signLanguageVideo=document.createElement("video"),this.signLanguageVideo.className="vidply-sign-language-video",this.signLanguageVideo.src=s,this.signLanguageVideo.setAttribute("aria-label",d.t("player.signLanguage")),this.signLanguageVideo.muted=!0,this.signLanguageVideo.setAttribute("playsinline",""),this.signLanguageResizeHandles=["n","s","e","w","ne","nw","se","sw"].map(l=>{let g=u.createElement("div",{className:`${this.options.classPrefix}-sign-resize-handle ${this.options.classPrefix}-sign-resize-${l}`,attributes:{"data-direction":l,"data-vidply-managed-resize":"true","aria-hidden":"true"}});return g.style.display="none",g}),this.signLanguageWrapper.appendChild(this.signLanguageHeader),this.signLanguageWrapper.appendChild(this.signLanguageVideo),this.signLanguageResizeHandles.forEach(l=>this.signLanguageWrapper.appendChild(l));let a=this.storage.getSignLanguagePreferences();a&&a.size&&a.size.width?this.signLanguageWrapper.style.width=a.size.width:this.signLanguageWrapper.style.width="280px",this.signLanguageWrapper.style.height="auto",this.signLanguageDesiredPosition=this.options.signLanguagePosition||"bottom-right",this.container.appendChild(this.signLanguageWrapper),requestAnimationFrame(()=>{this.constrainSignLanguagePosition()}),this.signLanguageVideo.currentTime=this.state.currentTime,this.state.paused||this.signLanguageVideo.play(),this.setupSignLanguageInteraction(),this.signLanguageHandlers={play:()=>{this.signLanguageVideo&&this.signLanguageVideo.play()},pause:()=>{this.signLanguageVideo&&this.signLanguageVideo.pause()},timeupdate:()=>{this.signLanguageVideo&&Math.abs(this.signLanguageVideo.currentTime-this.state.currentTime)>.5&&(this.signLanguageVideo.currentTime=this.state.currentTime)},ratechange:()=>{this.signLanguageVideo&&(this.signLanguageVideo.playbackRate=this.state.playbackSpeed)}},this.on("play",this.signLanguageHandlers.play),this.on("pause",this.signLanguageHandlers.pause),this.on("timeupdate",this.signLanguageHandlers.timeupdate),this.on("ratechange",this.signLanguageHandlers.ratechange),e&&(this.signLanguageHandlers.captionChange=()=>{if(this.captionManager&&this.captionManager.currentTrack&&this.signLanguageSelector){let l=this.captionManager.currentTrack.language?.toLowerCase().split("-")[0];l&&this.signLanguageSources[l]&&this.currentSignLanguage!==l&&(this.switchSignLanguage(l),this.signLanguageSelector.value=l)}},this.on("captionsenabled",this.signLanguageHandlers.captionChange)),this.state.signLanguageEnabled=!0,this.emit("signlanguageenabled"),this.setManagedTimeout(()=>{this.signLanguageSettingsButton&&document.contains(this.signLanguageSettingsButton)&&this.signLanguageSettingsButton.focus({preventScroll:!0})},150)}disableSignLanguage(){this.signLanguageSettingsMenuVisible&&this.hideSignLanguageSettingsMenu({focusButton:!1}),this.signLanguageWrapper&&(this.signLanguageWrapper.style.display="none"),this.state.signLanguageEnabled=!1,this.emit("signlanguagedisabled")}toggleSignLanguage(){this.state.signLanguageEnabled?this.disableSignLanguage():this.enableSignLanguage()}setupSignLanguageInteraction(){if(!this.signLanguageWrapper)return;let e=window.innerWidth<768,t=this.state.fullscreen;if(e&&!t){this.signLanguageDraggable&&(this.signLanguageDraggable.destroy(),this.signLanguageDraggable=null);return}this.signLanguageDraggable||(this.signLanguageDraggable=new te(this.signLanguageWrapper,{dragHandle:this.signLanguageHeader,resizeHandles:this.signLanguageResizeHandles,constrainToViewport:!0,maintainAspectRatio:!0,minWidth:150,minHeight:100,classPrefix:`${this.options.classPrefix}-sign`,keyboardDragKey:"d",keyboardResizeKey:"r",keyboardStep:10,keyboardStepLarge:50,pointerResizeIndicatorText:d.t("player.signLanguageResizeActive"),onPointerResizeToggle:i=>{this.signLanguageResizeHandles.forEach(s=>{s.style.display=i?"block":"none"})},onDragStart:i=>!(i.target.closest(`.${this.options.classPrefix}-sign-language-close`)||i.target.closest(`.${this.options.classPrefix}-sign-language-settings`)||i.target.closest(`.${this.options.classPrefix}-sign-language-select`)||i.target.closest(`.${this.options.classPrefix}-sign-language-label`)||i.target.closest(`.${this.options.classPrefix}-sign-language-settings-menu`))}),this.signLanguageCustomKeyHandler=i=>{let s=i.key.toLowerCase();if(!this.signLanguageSettingsMenuVisible){if(s==="home"){i.preventDefault(),i.stopPropagation(),this.signLanguageDraggable&&(this.signLanguageDraggable.pointerResizeMode&&this.signLanguageDraggable.disablePointerResizeMode(),this.signLanguageDraggable.manuallyPositioned=!1,this.constrainSignLanguagePosition());return}if(s==="r"){i.preventDefault(),i.stopPropagation(),this.toggleSignLanguageResizeMode()&&this.signLanguageWrapper.focus({preventScroll:!0});return}if(s==="escape"){if(i.preventDefault(),i.stopPropagation(),this.signLanguageDraggable&&this.signLanguageDraggable.pointerResizeMode){this.signLanguageDraggable.disablePointerResizeMode();return}if(this.signLanguageDraggable&&this.signLanguageDraggable.keyboardDragMode){this.signLanguageDraggable.disableKeyboardDragMode();return}this.disableSignLanguage(),this.controlBar&&this.controlBar.controls&&this.controlBar.controls.signLanguage&&setTimeout(()=>{this.controlBar.controls.signLanguage.focus({preventScroll:!0})},0);return}}},this.signLanguageWrapper.addEventListener("keydown",this.signLanguageCustomKeyHandler),this.signLanguageInteractionHandlers={draggable:this.signLanguageDraggable,headerKeyHandler:this.signLanguageHeaderKeyHandler,customKeyHandler:this.signLanguageCustomKeyHandler})}toggleSignLanguageKeyboardDragMode(){if(this.signLanguageDraggable){let e=this.signLanguageDraggable.keyboardDragMode;this.signLanguageDraggable.toggleKeyboardDragMode();let t=this.signLanguageDraggable.keyboardDragMode;!e&&t&&this.enableSignLanguageMoveMode(),this.updateSignLanguageDragOptionState()}}enableSignLanguageMoveMode(){this.signLanguageWrapper.classList.add(`${this.options.classPrefix}-sign-move-mode`),this.updateSignLanguageResizeOptionState(),setTimeout(()=>{this.signLanguageWrapper.classList.remove(`${this.options.classPrefix}-sign-move-mode`)},2e3)}toggleSignLanguageResizeMode({focus:e=!0}={}){return this.signLanguageDraggable?this.signLanguageDraggable.pointerResizeMode?(this.signLanguageDraggable.disablePointerResizeMode({focus:e}),this.updateSignLanguageResizeOptionState(),!1):(this.signLanguageDraggable.enablePointerResizeMode({focus:e}),this.updateSignLanguageResizeOptionState(),!0):!1}getSignLanguageLabel(e){return{en:"English",de:"Deutsch",es:"EspaÃ±ol",fr:"FranÃ§ais",it:"Italiano",ja:"æ—¥æœ¬èªž",pt:"PortuguÃªs",ar:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",hi:"à¤¹à¤¿à¤¨à¥à¤¦à¥€"}[e]||e.toUpperCase()}switchSignLanguage(e){if(!this.signLanguageSources[e]||!this.signLanguageVideo)return;let t=this.signLanguageVideo.currentTime,i=!this.signLanguageVideo.paused;this.signLanguageVideo.src=this.signLanguageSources[e],this.currentSignLanguage=e,this.signLanguageVideo.currentTime=t,i&&this.signLanguageVideo.play().catch(()=>{}),this.emit("signlanguagelanguagechanged",e)}showSignLanguageSettingsMenu(){if(this.signLanguageSettingsMenuJustOpened=!0,setTimeout(()=>{this.signLanguageSettingsMenuJustOpened=!1},350),this.signLanguageDocumentClickHandlerAdded||(this.signLanguageDocumentClickHandler=a=>{this.signLanguageSettingsMenuJustOpened||this.signLanguageSettingsButton&&(this.signLanguageSettingsButton===a.target||this.signLanguageSettingsButton.contains(a.target))||this.signLanguageSettingsMenu&&this.signLanguageSettingsMenu.contains(a.target)||this.signLanguageSettingsMenuVisible&&this.hideSignLanguageSettingsMenu()},setTimeout(()=>{document.addEventListener("mousedown",this.signLanguageDocumentClickHandler,!0),this.signLanguageDocumentClickHandlerAdded=!0},300)),this.signLanguageSettingsMenu){this.signLanguageSettingsMenu.style.display="block",this.signLanguageSettingsMenuVisible=!0,this.signLanguageSettingsButton&&this.signLanguageSettingsButton.setAttribute("aria-expanded","true"),this.signLanguageSettingsMenuKeyHandler=W(this.signLanguageSettingsMenu,this.signLanguageSettingsButton,`.${this.options.classPrefix}-sign-language-settings-item`,()=>this.hideSignLanguageSettingsMenu({focusButton:!0})),this.positionSignLanguageSettingsMenu(),this.updateSignLanguageDragOptionState(),this.updateSignLanguageResizeOptionState(),Y(this.signLanguageSettingsMenu,`.${this.options.classPrefix}-sign-language-settings-item`);return}this.signLanguageSettingsMenu=u.createElement("div",{className:`${this.options.classPrefix}-sign-language-settings-menu`,attributes:{role:"menu"}});let e=q({classPrefix:this.options.classPrefix,itemClass:`${this.options.classPrefix}-sign-language-settings-item`,icon:"move",label:"player.enableSignDragMode",hasTextClass:!0,onClick:()=>{this.toggleSignLanguageKeyboardDragMode(),this.hideSignLanguageSettingsMenu()}});e.setAttribute("role","switch"),e.setAttribute("aria-checked","false");let t=e.querySelector(`.${this.options.classPrefix}-tooltip`);t&&t.remove();let i=e.querySelector(`.${this.options.classPrefix}-button-text`);i&&i.remove(),this.signLanguageDragOptionButton=e,this.signLanguageDragOptionText=e.querySelector(`.${this.options.classPrefix}-settings-text`),this.updateSignLanguageDragOptionState();let s=q({classPrefix:this.options.classPrefix,itemClass:`${this.options.classPrefix}-sign-language-settings-item`,icon:"resize",label:"player.enableSignResizeMode",hasTextClass:!0,onClick:a=>{a.preventDefault(),a.stopPropagation(),this.toggleSignLanguageResizeMode({focus:!1})?(this.hideSignLanguageSettingsMenu({focusButton:!1}),setTimeout(()=>{this.signLanguageWrapper&&this.signLanguageWrapper.focus({preventScroll:!0})},20)):this.hideSignLanguageSettingsMenu({focusButton:!0})}});s.setAttribute("role","switch"),s.setAttribute("aria-checked","false");let n=s.querySelector(`.${this.options.classPrefix}-tooltip`);n&&n.remove();let r=s.querySelector(`.${this.options.classPrefix}-button-text`);r&&r.remove(),this.signLanguageResizeOptionButton=s,this.signLanguageResizeOptionText=s.querySelector(`.${this.options.classPrefix}-settings-text`),this.updateSignLanguageResizeOptionState();let c=q({classPrefix:this.options.classPrefix,itemClass:`${this.options.classPrefix}-sign-language-settings-item`,icon:"close",label:"transcript.closeMenu",onClick:()=>{this.hideSignLanguageSettingsMenu()}}),h=c.querySelector(`.${this.options.classPrefix}-tooltip`);h&&h.remove();let o=c.querySelector(`.${this.options.classPrefix}-button-text`);o&&o.remove(),this.signLanguageSettingsMenu.appendChild(e),this.signLanguageSettingsMenu.appendChild(s),this.signLanguageSettingsMenu.appendChild(c),this.signLanguageSettingsMenu.style.visibility="hidden",this.signLanguageSettingsMenu.style.display="block",this.signLanguageSettingsButton&&this.signLanguageSettingsButton.parentNode?this.signLanguageSettingsButton.insertAdjacentElement("afterend",this.signLanguageSettingsMenu):this.signLanguageWrapper&&this.signLanguageWrapper.appendChild(this.signLanguageSettingsMenu),this.positionSignLanguageSettingsMenuImmediate(),requestAnimationFrame(()=>{this.signLanguageSettingsMenu&&(this.signLanguageSettingsMenu.style.visibility="visible")}),this.signLanguageSettingsMenuKeyHandler=W(this.signLanguageSettingsMenu,this.signLanguageSettingsButton,`.${this.options.classPrefix}-sign-language-settings-item`,()=>this.hideSignLanguageSettingsMenu({focusButton:!0})),this.signLanguageSettingsMenuVisible=!0,this.signLanguageSettingsButton&&this.signLanguageSettingsButton.setAttribute("aria-expanded","true"),this.updateSignLanguageDragOptionState(),this.updateSignLanguageResizeOptionState(),Y(this.signLanguageSettingsMenu,`.${this.options.classPrefix}-sign-language-settings-item`)}hideSignLanguageSettingsMenu({focusButton:e=!0}={}){this.signLanguageSettingsMenu&&(this.signLanguageSettingsMenu.style.display="none",this.signLanguageSettingsMenuVisible=!1,this.signLanguageSettingsMenuJustOpened=!1,this.signLanguageSettingsMenuKeyHandler&&(this.signLanguageSettingsMenu.removeEventListener("keydown",this.signLanguageSettingsMenuKeyHandler),this.signLanguageSettingsMenuKeyHandler=null),Array.from(this.signLanguageSettingsMenu.querySelectorAll(`.${this.options.classPrefix}-sign-language-settings-item`)).forEach(i=>{i.setAttribute("tabindex","-1")}),this.signLanguageSettingsButton&&(this.signLanguageSettingsButton.setAttribute("aria-expanded","false"),e&&this.signLanguageSettingsButton.focus({preventScroll:!0})))}positionSignLanguageSettingsMenuImmediate(){if(!this.signLanguageSettingsMenu||!this.signLanguageSettingsButton)return;let e=this.signLanguageSettingsButton.getBoundingClientRect(),t=this.signLanguageSettingsMenu.getBoundingClientRect(),i=window.innerWidth,s=window.innerHeight,n=this.signLanguageSettingsButton.parentElement;if(!n)return;let r=n.getBoundingClientRect(),c=e.left+e.width/2-r.left,h=e.bottom-r.top,o=e.top-r.top,a=e.top,l=s-e.bottom,g=h+8,p=null;l<t.height+20&&a>l?(g=null,p=r.bottom-r.top-o+8,this.signLanguageSettingsMenu.classList.add("vidply-menu-above")):this.signLanguageSettingsMenu.classList.remove("vidply-menu-above");let y=c-t.width/2,b="auto",k="translateX(0)",m=e.left+e.width/2-t.width/2;m<10?(y=0,k="translateX(0)"):m+t.width>i-10?(y="auto",b=0,k="translateX(0)"):(y=c,k="translateX(-50%)"),g!==null?(this.signLanguageSettingsMenu.style.top=`${g}px`,this.signLanguageSettingsMenu.style.bottom="auto"):p!==null&&(this.signLanguageSettingsMenu.style.top="auto",this.signLanguageSettingsMenu.style.bottom=`${p}px`),y!=="auto"?(this.signLanguageSettingsMenu.style.left=`${y}px`,this.signLanguageSettingsMenu.style.right="auto"):(this.signLanguageSettingsMenu.style.left="auto",this.signLanguageSettingsMenu.style.right=`${b}px`),this.signLanguageSettingsMenu.style.transform=k}positionSignLanguageSettingsMenu(){!this.signLanguageSettingsMenu||!this.signLanguageSettingsButton||!this.signLanguageWrapper||requestAnimationFrame(()=>{setTimeout(()=>{this.positionSignLanguageSettingsMenuImmediate()},10)})}attachSignLanguageSettingsMenuKeyboardNavigation(){this.signLanguageSettingsMenu&&(this.signLanguageSettingsMenuKeyHandler&&this.signLanguageSettingsMenu.removeEventListener("keydown",this.signLanguageSettingsMenuKeyHandler),this.signLanguageSettingsMenuKeyHandler=W(this.signLanguageSettingsMenu,this.signLanguageSettingsButton,`.${this.options.classPrefix}-sign-language-settings-item`,()=>this.hideSignLanguageSettingsMenu({focusButton:!0})))}updateSignLanguageDragOptionState(){if(!this.signLanguageDragOptionButton)return;let e=!!(this.signLanguageDraggable&&this.signLanguageDraggable.keyboardDragMode),t=e?d.t("player.disableSignDragMode"):d.t("player.enableSignDragMode"),i=e?d.t("player.disableSignDragModeAria"):d.t("player.enableSignDragModeAria");this.signLanguageDragOptionButton.setAttribute("aria-checked",e?"true":"false"),this.signLanguageDragOptionButton.setAttribute("aria-label",i),this.signLanguageDragOptionText&&(this.signLanguageDragOptionText.textContent=t)}updateSignLanguageResizeOptionState(){if(!this.signLanguageResizeOptionButton)return;let e=!!(this.signLanguageDraggable&&this.signLanguageDraggable.pointerResizeMode),t=e?d.t("player.disableSignResizeMode"):d.t("player.enableSignResizeMode"),i=e?d.t("player.disableSignResizeModeAria"):d.t("player.enableSignResizeModeAria");this.signLanguageResizeOptionButton.setAttribute("aria-checked",e?"true":"false"),this.signLanguageResizeOptionButton.setAttribute("aria-label",i),this.signLanguageResizeOptionText&&(this.signLanguageResizeOptionText.textContent=t)}constrainSignLanguagePosition(){if(!this.signLanguageWrapper||!this.videoWrapper||this.signLanguageDraggable&&this.signLanguageDraggable.manuallyPositioned)return;(!this.signLanguageWrapper.style.width||this.signLanguageWrapper.style.width==="")&&(this.signLanguageWrapper.style.width="280px");let e=this.videoWrapper.getBoundingClientRect(),t=this.container.getBoundingClientRect(),i=this.signLanguageWrapper.getBoundingClientRect(),s=e.left-t.left,n=e.top-t.top,r=e.width,c=e.height,h=i.width||280,o=i.height||280*9/16,a,l,g=16,p=95;switch(this.signLanguageDesiredPosition||"bottom-right"){case"bottom-right":a=s+r-h-g,l=n+c-o-p;break;case"bottom-left":a=s+g,l=n+c-o-p;break;case"top-right":a=s+r-h-g,l=n+g;break;case"top-left":a=s+g,l=n+g;break;default:a=s+r-h-g,l=n+c-o-p}a=Math.max(s,Math.min(a,s+r-h)),l=Math.max(n,Math.min(l,n+c-o-p)),this.signLanguageWrapper.style.left=`${a}px`,this.signLanguageWrapper.style.top=`${l}px`,this.signLanguageWrapper.style.right="auto",this.signLanguageWrapper.style.bottom="auto",this.signLanguageWrapper.classList.remove(...Array.from(this.signLanguageWrapper.classList).filter(b=>b.startsWith("vidply-sign-position-")))}saveSignLanguagePreferences(){this.signLanguageWrapper&&this.storage.saveSignLanguagePreferences({size:{width:this.signLanguageWrapper.style.width}})}cleanupSignLanguage(){this.signLanguageSettingsMenuVisible&&this.hideSignLanguageSettingsMenu({focusButton:!1}),this.signLanguageDocumentClickHandler&&this.signLanguageDocumentClickHandlerAdded&&(document.removeEventListener("mousedown",this.signLanguageDocumentClickHandler,!0),this.signLanguageDocumentClickHandlerAdded=!1,this.signLanguageDocumentClickHandler=null),this.signLanguageSettingsHandlers&&(this.signLanguageSettingsButton&&(this.signLanguageSettingsButton.removeEventListener("click",this.signLanguageSettingsHandlers.settingsClick),this.signLanguageSettingsButton.removeEventListener("keydown",this.signLanguageSettingsHandlers.settingsKeydown)),this.signLanguageSettingsHandlers=null),this.signLanguageHandlers&&(this.off("play",this.signLanguageHandlers.play),this.off("pause",this.signLanguageHandlers.pause),this.off("timeupdate",this.signLanguageHandlers.timeupdate),this.off("ratechange",this.signLanguageHandlers.ratechange),this.signLanguageHandlers.captionChange&&this.off("captionsenabled",this.signLanguageHandlers.captionChange),this.signLanguageHandlers=null),this.signLanguageInteractionHandlers&&(this.signLanguageHeader&&this.signLanguageInteractionHandlers.headerKeyHandler&&this.signLanguageHeader.removeEventListener("keydown",this.signLanguageInteractionHandlers.headerKeyHandler),this.signLanguageWrapper&&this.signLanguageInteractionHandlers.customKeyHandler&&this.signLanguageWrapper.removeEventListener("keydown",this.signLanguageInteractionHandlers.customKeyHandler)),this.signLanguageDraggable&&(this.signLanguageDraggable.pointerResizeMode&&this.signLanguageDraggable.disablePointerResizeMode(),this.signLanguageDraggable.destroy(),this.signLanguageDraggable=null),this.signLanguageInteractionHandlers=null,this.signLanguageWrapper&&this.signLanguageWrapper.parentNode&&(this.signLanguageVideo&&(this.signLanguageVideo.pause(),this.signLanguageVideo.src=""),this.signLanguageWrapper.parentNode.removeChild(this.signLanguageWrapper)),this.signLanguageWrapper=null,this.signLanguageVideo=null,this.signLanguageSettingsButton=null,this.signLanguageSettingsMenu=null}showSettings(){console.warn("[VidPly] Settings dialog has been removed. Use individual control buttons (speed, captions, etc.)")}hideSettings(){}getCurrentTime(){return this.state.currentTime}getDuration(){return this.state.duration}isPlaying(){return this.state.playing}isPaused(){return this.state.paused}isEnded(){return this.state.ended}isMuted(){return this.state.muted}isFullscreen(){return this.state.fullscreen}handleError(e){if(this._switchingRenderer){this.log("Suppressing error during renderer switch:",e,"debug");return}this.log("Error:",e,"error"),this.emit("error",e),this.options.onError&&this.options.onError.call(this,e)}log(...e){if(!this.options.debug)return;let t="log";if(e.length>0){let i=e[e.length-1];typeof i=="string"&&console[i]&&(t=i,e=e.slice(0,-1))}e.length===0&&(e=[""]),typeof console[t]=="function"?console[t]("[VidPly]",...e):console.log("[VidPly]",...e)}setupResponsiveHandlers(){if(typeof ResizeObserver<"u"?(this.resizeObserver=new ResizeObserver(e=>{for(let t of e){let i=t.contentRect.width;this.controlBar&&typeof this.controlBar.updateControlsForViewport=="function"&&this.controlBar.updateControlsForViewport(i),this.transcriptManager&&this.transcriptManager.isVisible&&this.transcriptManager.positionTranscript()}}),this.resizeObserver.observe(this.container)):(this.resizeHandler=()=>{let e=this.container.clientWidth;this.controlBar&&typeof this.controlBar.updateControlsForViewport=="function"&&this.controlBar.updateControlsForViewport(e),this.transcriptManager&&this.transcriptManager.isVisible&&(!this.transcriptManager.draggableResizable||!this.transcriptManager.draggableResizable.manuallyPositioned)&&this.transcriptManager.positionTranscript()},window.addEventListener("resize",this.resizeHandler)),window.matchMedia){this.orientationHandler=t=>{setTimeout(()=>{this.transcriptManager&&this.transcriptManager.isVisible&&(!this.transcriptManager.draggableResizable||!this.transcriptManager.draggableResizable.manuallyPositioned)&&this.transcriptManager.positionTranscript()},100)};let e=window.matchMedia("(orientation: portrait)");e.addEventListener?e.addEventListener("change",this.orientationHandler):e.addListener&&e.addListener(this.orientationHandler),this.orientationQuery=e}this.fullscreenChangeHandler=()=>{let e=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);this.state.fullscreen!==e&&(this.state.fullscreen=e,e?this.container.classList.add(`${this.options.classPrefix}-fullscreen`):(this.container.classList.remove(`${this.options.classPrefix}-fullscreen`),this._disablePseudoFullscreen()),this.emit("fullscreenchange",e),this.controlBar&&this.controlBar.updateFullscreenButton(),this.signLanguageWrapper&&this.signLanguageWrapper.style.display!=="none"&&(window.innerWidth<768&&this.setupSignLanguageInteraction(),this.setManagedTimeout(()=>{requestAnimationFrame(()=>{this.storage.saveSignLanguagePreferences({size:null}),this.signLanguageDesiredPosition="bottom-right",this.signLanguageWrapper.style.width=e?"400px":"280px",this.constrainSignLanguagePosition()})},500)))},document.addEventListener("fullscreenchange",this.fullscreenChangeHandler),document.addEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),document.addEventListener("mozfullscreenchange",this.fullscreenChangeHandler),document.addEventListener("MSFullscreenChange",this.fullscreenChangeHandler)}destroy(){if(this.log("Destroying player"),this.renderer&&this.renderer.destroy(),this.controlBar&&this.controlBar.destroy(),this.captionManager&&this.captionManager.destroy(),this.keyboardManager&&this.keyboardManager.destroy(),this.transcriptManager&&this.transcriptManager.destroy(),this.cleanupSignLanguage(),this.playButtonOverlay&&this.playButtonOverlay.parentNode&&(this.playButtonOverlay.remove(),this.playButtonOverlay=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),this.orientationQuery&&this.orientationHandler&&(this.orientationQuery.removeEventListener?this.orientationQuery.removeEventListener("change",this.orientationHandler):this.orientationQuery.removeListener&&this.orientationQuery.removeListener(this.orientationHandler),this.orientationQuery=null,this.orientationHandler=null),this.fullscreenChangeHandler&&(document.removeEventListener("fullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("mozfullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("MSFullscreenChange",this.fullscreenChangeHandler),this.fullscreenChangeHandler=null),this.timeouts.forEach(e=>clearTimeout(e)),this.timeouts.clear(),this.metadataCueChangeHandler){let t=this.textTracks.find(i=>i.kind==="metadata");t&&t.removeEventListener("cuechange",this.metadataCueChangeHandler),this.metadataCueChangeHandler=null}this.metadataAlertHandlers&&this.metadataAlertHandlers.size>0&&(this.metadataAlertHandlers.forEach(({button:e,handler:t})=>{e&&t&&e.removeEventListener("click",t)}),this.metadataAlertHandlers.clear()),this.container&&this.container.parentNode&&(this.container.parentNode.insertBefore(this.element,this.container),this.container.parentNode.removeChild(this.container)),this.removeAllListeners()}setupMetadataHandling(){let e=()=>{let i=this.textTracks.find(s=>s.kind==="metadata");if(i){if(i.mode==="disabled"&&(i.mode="hidden"),this.metadataCueChangeHandler&&i.removeEventListener("cuechange",this.metadataCueChangeHandler),this.metadataCueChangeHandler=()=>{let s=Array.from(i.activeCues||[]);s.length>0&&this.options.debug&&this.log("[Metadata] Active cues:",s.map(n=>({start:n.startTime,end:n.endTime,text:n.text}))),s.forEach(n=>{this.handleMetadataCue(n)})},i.addEventListener("cuechange",this.metadataCueChangeHandler),this.options.debug){let s=i.cues?i.cues.length:0;this.log("[Metadata] Track enabled,",s,"cues available")}}else this.options.debug&&this.log("[Metadata] No metadata track found")};e(),this.on("loadedmetadata",e)}normalizeMetadataSelector(e){if(!e)return null;let t=e.trim();return t?t.startsWith("#")||t.startsWith(".")||t.startsWith("[")?t:`#${t}`:null}resolveMetadataConfig(e,t){if(!e||!t)return null;if(Object.prototype.hasOwnProperty.call(e,t))return e[t];let i=t.replace(/^#/,"");return Object.prototype.hasOwnProperty.call(e,i)?e[i]:null}cacheMetadataAlertContent(e,t={}){if(!e)return;let i=t.titleSelector||"[data-vidply-alert-title], h3, header",s=t.messageSelector||"[data-vidply-alert-message], p",n=e.querySelector(i);n&&!n.dataset.vidplyAlertTitleOriginal&&(n.dataset.vidplyAlertTitleOriginal=n.textContent.trim());let r=e.querySelector(s);r&&!r.dataset.vidplyAlertMessageOriginal&&(r.dataset.vidplyAlertMessageOriginal=r.textContent.trim())}restoreMetadataAlertContent(e,t={}){if(!e)return;let i=t.titleSelector||"[data-vidply-alert-title], h3, header",s=t.messageSelector||"[data-vidply-alert-message], p",n=e.querySelector(i);n&&n.dataset.vidplyAlertTitleOriginal&&(n.textContent=n.dataset.vidplyAlertTitleOriginal);let r=e.querySelector(s);r&&r.dataset.vidplyAlertMessageOriginal&&(r.textContent=r.dataset.vidplyAlertMessageOriginal)}focusMetadataTarget(e,t=null){if(!(!e||e==="none")){if(e==="alert"&&t){t.focus({preventScroll:!0});return}if(e==="player"){this.container&&this.container.focus({preventScroll:!0});return}if(e==="media"){this.element.focus({preventScroll:!0});return}if(e==="playButton"){let i=this.controlBar?.controls?.playPause;i&&i.focus({preventScroll:!0});return}if(typeof e=="string"){let i=document.querySelector(e);i&&(i.tabIndex===-1&&!i.hasAttribute("tabindex")&&i.setAttribute("tabindex","-1"),i.focus({preventScroll:!0}))}}}handleMetadataAlert(e,t={}){if(!e)return;let i=this.resolveMetadataConfig(this.options.metadataAlerts,e)||{},s=t.element||document.querySelector(e);if(!s){this.options.debug&&this.log("[Metadata] Alert element not found:",e);return}this.options.debug&&this.log("[Metadata] Handling alert",e,{reason:t.reason,config:i}),this.cacheMetadataAlertContent(s,i),s.dataset.vidplyAlertOriginalDisplay||(s.dataset.vidplyAlertOriginalDisplay=s.style.display||""),s.dataset.vidplyAlertDisplay||(s.dataset.vidplyAlertDisplay=i.display||"block");let n=t.show!==void 0?t.show:i.show!==!1;if(n){let o=i.display||s.dataset.vidplyAlertDisplay||"block";s.style.display=o,s.hidden=!1,s.removeAttribute("hidden"),s.setAttribute("aria-hidden","false"),s.setAttribute("data-vidply-alert-active","true")}i.resetContent!==!1&&t.reason==="focus"&&this.restoreMetadataAlertContent(s,i);let c=t.focus!==void 0?t.focus:i.focusOnShow??t.reason!=="focus";n&&c&&(s.tabIndex===-1&&!s.hasAttribute("tabindex")&&s.setAttribute("tabindex","-1"),s.focus({preventScroll:!0})),n&&i.autoScroll!==!1&&t.autoScroll!==!1&&s.scrollIntoView({behavior:"smooth",block:"nearest"});let h=i.continueButton;if(h){let o=null;if(h==="self"||s.matches(h)?o=s:o=s.querySelector(h)||document.querySelector(h),o&&!this.metadataAlertHandlers.has(e)){let a=()=>{if(i.hideOnContinue!==!1){let p=s.dataset.vidplyAlertOriginalDisplay||"";s.style.display=i.hideDisplay||p||"none",s.setAttribute("aria-hidden","true"),s.removeAttribute("data-vidply-alert-active")}i.resume!==!1&&this.state.paused&&this.play();let g=i.focusTarget||"playButton";this.setManagedTimeout(()=>{this.focusMetadataTarget(g,s)},i.focusDelay??100)};o.addEventListener("click",a),this.metadataAlertHandlers.set(e,{button:o,handler:a})}}return s}handleMetadataHashtags(e){if(!Array.isArray(e)||e.length===0)return;let t=this.options.metadataHashtags;t&&e.forEach(i=>{let s=this.resolveMetadataConfig(t,i);if(!s)return;let n=this.normalizeMetadataSelector(s.alert||s.selector||s.target);if(!n)return;let r=document.querySelector(n);if(!r){this.options.debug&&this.log("[Metadata] Hashtag target not found:",n);return}if(this.options.debug&&this.log("[Metadata] Handling hashtag",i,{selector:n,config:s}),this.cacheMetadataAlertContent(r,s),s.title){let o=s.titleSelector||"[data-vidply-alert-title], h3, header",a=r.querySelector(o);a&&(a.textContent=s.title)}if(s.message){let o=s.messageSelector||"[data-vidply-alert-message], p",a=r.querySelector(o);a&&(a.textContent=s.message)}let c=s.show!==!1,h=s.focus!==void 0?s.focus:!1;this.handleMetadataAlert(n,{element:r,show:c,focus:h,autoScroll:s.autoScroll,reason:"hashtag"})})}handleMetadataCue(e){let t=e.text.trim();this.options.debug&&this.log("[Metadata] Processing cue:",{time:e.startTime,text:t}),this.emit("metadata",{time:e.startTime,endTime:e.endTime,text:t,cue:e}),t.includes("PAUSE")&&(this.state.paused||(this.options.debug&&this.log("[Metadata] Pausing video at",e.startTime),this.pause()),this.emit("metadata:pause",{time:e.startTime,text:t}));let i=t.match(/FOCUS:([\w#-]+)/);if(i){let n=i[1],r=this.normalizeMetadataSelector(n),c=r?document.querySelector(r):null;c?(this.options.debug&&this.log("[Metadata] Focusing element:",r),c.tabIndex===-1&&!c.hasAttribute("tabindex")&&c.setAttribute("tabindex","-1"),this.setManagedTimeout(()=>{c.focus({preventScroll:!0})},10)):this.options.debug&&this.log("[Metadata] Element not found:",r||n),this.emit("metadata:focus",{time:e.startTime,target:n,selector:r,element:c,text:t}),r&&this.handleMetadataAlert(r,{element:c,reason:"focus"})}let s=t.match(/#[\w-]+/g);s&&(this.options.debug&&this.log("[Metadata] Hashtags found:",s),this.emit("metadata:hashtags",{time:e.startTime,hashtags:s,text:t}),this.handleMetadataHashtags(s))}};F.instances=[];var re=0,J=class{constructor(e,t={}){this.player=e,this.tracks=[],this.initialTracks=Array.isArray(t.tracks)?t.tracks:[],this.currentIndex=-1,this.instanceId=++re,this.uniqueId=`vidply-playlist-${this.instanceId}`,this.options={autoAdvance:t.autoAdvance!==!1,autoPlayFirst:t.autoPlayFirst!==!1,loop:t.loop||!1,showPanel:t.showPanel!==!1,recreatePlayers:t.recreatePlayers||!1,...t},this.container=null,this.playlistPanel=null,this.trackInfoElement=null,this.navigationFeedback=null,this.isPanelVisible=this.options.showPanel!==!1,this.isChangingTrack=!1,this.hostElement=t.hostElement||null,this.PlayerClass=t.PlayerClass||null,this.handleTrackEnd=this.handleTrackEnd.bind(this),this.handleTrackError=this.handleTrackError.bind(this),this.player.playlistManager=this,this.init(),this.updatePlayerControls(),this.initialTracks.length>0&&this.loadPlaylist(this.initialTracks)}getTrackMediaType(e){let t=e.src||"";return t.includes("youtube.com")||t.includes("youtu.be")?"youtube":t.includes("vimeo.com")?"vimeo":t.includes("soundcloud.com")||t.includes("api.soundcloud.com")?"soundcloud":t.includes(".m3u8")?"hls":e.type&&e.type.startsWith("audio/")?"audio":"video"}async recreatePlayerForTrack(e,t=!1){if(!this.hostElement||!this.PlayerClass)return console.warn("VidPly Playlist: Cannot recreate player - missing hostElement or PlayerClass"),!1;let i=this.getTrackMediaType(e),s=i==="audio"?"audio":"video",n=this.isPanelVisible,r=[...this.tracks],c=this.currentIndex;this.trackArtworkElement&&this.trackArtworkElement.parentNode&&this.trackArtworkElement.parentNode.removeChild(this.trackArtworkElement),this.trackInfoElement&&this.trackInfoElement.parentNode&&this.trackInfoElement.parentNode.removeChild(this.trackInfoElement),this.navigationFeedback&&this.navigationFeedback.parentNode&&this.navigationFeedback.parentNode.removeChild(this.navigationFeedback),this.playlistPanel&&this.playlistPanel.parentNode&&this.playlistPanel.parentNode.removeChild(this.playlistPanel),this.player&&(this.player.off("ended",this.handleTrackEnd),this.player.off("error",this.handleTrackError),this.player.destroy()),this.hostElement.innerHTML="";let h=document.createElement(s);h.setAttribute("preload","metadata"),s==="video"&&e.poster&&(i==="video"||i==="hls")&&h.setAttribute("poster",e.poster);let o=["youtube","vimeo","soundcloud","hls"].includes(i);if(!o){let l=document.createElement("source");l.src=e.src,e.type&&(l.type=e.type),h.appendChild(l),e.tracks&&e.tracks.length>0&&e.tracks.forEach(g=>{let p=document.createElement("track");p.src=g.src,p.kind=g.kind||"captions",p.srclang=g.srclang||"en",p.label=g.label||g.srclang,g.default&&(p.default=!0),h.appendChild(p)})}this.hostElement.appendChild(h);let a={mediaType:s,poster:e.poster,audioDescriptionSrc:e.audioDescriptionSrc||null,audioDescriptionDuration:e.audioDescriptionDuration||null,signLanguageSrc:e.signLanguageSrc||null};if(this.player=new this.PlayerClass(h,a),this.player.playlistManager=this,await new Promise(l=>{this.player.on("ready",l)}),this.player.on("ended",this.handleTrackEnd),this.player.on("error",this.handleTrackError),this.player.container){if(this.trackArtworkElement){let l=this.player.container.querySelector(".vidply-video-wrapper");l?this.player.container.insertBefore(this.trackArtworkElement,l):this.player.container.appendChild(this.trackArtworkElement)}this.trackInfoElement&&this.player.container.appendChild(this.trackInfoElement),this.navigationFeedback&&this.player.container.appendChild(this.navigationFeedback),this.playlistPanel&&this.player.container.appendChild(this.playlistPanel)}return this.container=this.player.container,this.updatePlayerControls(),this.tracks=r,this.currentIndex=c,this.updatePlaylistUI(),this.isPanelVisible=n,this.playlistPanel&&(this.playlistPanel.style.display=n?"":"none"),o?this.player.load({src:e.src,type:e.type,poster:e.poster,tracks:e.tracks||[],audioDescriptionSrc:e.audioDescriptionSrc||null,signLanguageSrc:e.signLanguageSrc||null}):this.player.load({src:e.src,type:e.type,poster:e.poster,tracks:e.tracks||[],audioDescriptionSrc:e.audioDescriptionSrc||null,signLanguageSrc:e.signLanguageSrc||null}),t&&setTimeout(()=>{this.player.play()},100),!0}init(){this.player.on("ended",this.handleTrackEnd),this.player.on("error",this.handleTrackError),this.player.on("play",this.handlePlaybackStateChange.bind(this)),this.player.on("pause",this.handlePlaybackStateChange.bind(this)),this.player.on("ended",this.handlePlaybackStateChange.bind(this)),this.player.on("fullscreenchange",this.handleFullscreenChange.bind(this)),this.player.on("audiodescriptionenabled",this.handleAudioDescriptionChange.bind(this)),this.player.on("audiodescriptiondisabled",this.handleAudioDescriptionChange.bind(this)),this.options.showPanel&&this.createUI(),this.tracks.length===0&&this.initialTracks.length===0&&this.loadPlaylistFromAttribute()}loadPlaylistFromAttribute(){if(!this.player.element||!this.player.element.parentElement){console.log("VidPly Playlist: No player element found");return}let t=this.player.element.parentElement.parentElement,i=t?t.parentElement:null;if(!i){console.log("VidPly Playlist: No original element found");return}this.loadOptionsFromAttributes(i);let s=i.getAttribute("data-playlist");if(!s){console.log("VidPly Playlist: No data-playlist attribute found");return}console.log("VidPly Playlist: Found data-playlist attribute, parsing...");try{let n=JSON.parse(s);Array.isArray(n)&&n.length>0?(console.log(`VidPly Playlist: Loaded ${n.length} tracks from data-playlist`),this.loadPlaylist(n)):console.warn("VidPly Playlist: data-playlist is not a valid array or is empty")}catch(n){console.error("VidPly Playlist: Failed to parse data-playlist attribute",n)}}loadOptionsFromAttributes(e){let t=e.getAttribute("data-playlist-auto-advance");t!==null&&(this.options.autoAdvance=t==="true");let i=e.getAttribute("data-playlist-auto-play-first");i!==null&&(this.options.autoPlayFirst=i==="true");let s=e.getAttribute("data-playlist-loop");s!==null&&(this.options.loop=s==="true");let n=e.getAttribute("data-playlist-show-panel");n!==null&&(this.options.showPanel=n==="true"),console.log("VidPly Playlist: Options from attributes:",this.options)}updatePlayerControls(){if(!this.player.controlBar)return;let e=this.player.controlBar;e.element.innerHTML="",e.createControls(),e.attachEvents(),e.setupAutoHide()}loadPlaylist(e){this.tracks=e,this.currentIndex=-1,this.container&&this.container.classList.add("vidply-has-playlist"),this.playlistPanel&&this.renderPlaylist(),e.length>0&&(this.options.autoPlayFirst?this.play(0):this.loadTrack(0)),this.updatePlaylistVisibilityInFullscreen()}async loadTrack(e){if(e<0||e>=this.tracks.length){console.warn("VidPly Playlist: Invalid track index",e);return}let t=this.tracks[e];if(this.isChangingTrack=!0,this.currentIndex=e,this.options.recreatePlayers&&this.hostElement&&this.PlayerClass){let i=this.player?this.player.element.tagName==="AUDIO"?"audio":"video":null,s=this.getTrackMediaType(t);if(i!==(s==="audio"||s==="soundcloud"?"audio":"video")){await this.recreatePlayerForTrack(t,!1),this.updateTrackInfo(t),this.updatePlaylistUI(),this.player.emit("playlisttrackchange",{index:e,item:t,total:this.tracks.length}),setTimeout(()=>{this.isChangingTrack=!1},150);return}}this.player.load({src:t.src,type:t.type,poster:t.poster,tracks:t.tracks||[],audioDescriptionSrc:t.audioDescriptionSrc||null,signLanguageSrc:t.signLanguageSrc||null}),this.updateTrackInfo(t),this.updatePlaylistUI(),this.player.emit("playlisttrackchange",{index:e,item:t,total:this.tracks.length}),setTimeout(()=>{this.isChangingTrack=!1},150)}async play(e,t=!1){if(e<0||e>=this.tracks.length){console.warn("VidPly Playlist: Invalid track index",e);return}let i=this.tracks[e];if(this.isChangingTrack=!0,this.currentIndex=e,this.options.recreatePlayers&&this.hostElement&&this.PlayerClass){let s=this.player?this.player.element.tagName==="AUDIO"?"audio":"video":null,n=this.getTrackMediaType(i);if(s!==(n==="audio"||n==="soundcloud"?"audio":"video")){await this.recreatePlayerForTrack(i,!0),this.updateTrackInfo(i),this.updatePlaylistUI(),this.player.emit("playlisttrackchange",{index:e,item:i,total:this.tracks.length}),setTimeout(()=>{this.isChangingTrack=!1},150);return}}this.player.load({src:i.src,type:i.type,poster:i.poster,tracks:i.tracks||[],audioDescriptionSrc:i.audioDescriptionSrc||null,signLanguageSrc:i.signLanguageSrc||null}),this.updateTrackInfo(i),this.updatePlaylistUI(),this.player.emit("playlisttrackchange",{index:e,item:i,total:this.tracks.length}),setTimeout(()=>{this.player.play(),setTimeout(()=>{this.isChangingTrack=!1},50)},100)}next(){let e=this.currentIndex+1;if(e>=this.tracks.length)if(this.options.loop)e=0;else return;this.play(e)}previous(){let e=this.currentIndex-1;if(e<0)if(this.options.loop)e=this.tracks.length-1;else return;this.play(e)}handleTrackEnd(){this.isChangingTrack||this.options.autoAdvance&&this.next()}isExternalRendererUrl(e){return e?e.includes("youtube.com")||e.includes("youtu.be")||e.includes("vimeo.com")||e.includes("soundcloud.com")||e.includes("api.soundcloud.com")||e.includes(".m3u8"):!1}handleTrackError(e){let t=this.getCurrentTrack();t&&t.src&&this.isExternalRendererUrl(t.src)||this.isChangingTrack||(console.error("VidPly Playlist: Track error",e),this.options.autoAdvance&&setTimeout(()=>{this.next()},1e3))}handlePlaybackStateChange(){this.updatePlaylistVisibilityInFullscreen()}handleFullscreenChange(){setTimeout(()=>{this.updatePlaylistVisibilityInFullscreen()},50)}handleAudioDescriptionChange(){let e=this.getCurrentTrack();e&&(this.updateTrackInfo(e),this.updatePlaylistUI(),this.updatePlaylistDurations())}updatePlaylistDurations(){if(!this.playlistPanel)return;this.playlistPanel.querySelectorAll(".vidply-playlist-item").forEach((t,i)=>{let s=this.tracks[i];if(!s)return;let n=this.getEffectiveDuration(s),r=n?x.formatTime(n):"",c=t.querySelector(".vidply-playlist-duration-badge");c&&(c.textContent=r);let h=t.querySelector(".vidply-playlist-item-duration");h&&(h.textContent=r)})}getEffectiveDuration(e){return e?this.player.state.audioDescriptionEnabled&&e.audioDescriptionDuration?e.audioDescriptionDuration:e.duration||null:null}updatePlaylistVisibilityInFullscreen(){if(!this.playlistPanel||!this.tracks.length)return;let e=this.player.state.fullscreen,t=this.player.state.playing;e?t?(this.playlistPanel.classList.remove("vidply-playlist-fullscreen-visible"),setTimeout(()=>{this.player.state.playing&&this.player.state.fullscreen&&(this.playlistPanel.style.display="none")},300)):(this.playlistPanel.classList.add("vidply-playlist-fullscreen-visible"),this.playlistPanel.style.display="block"):(this.playlistPanel.classList.remove("vidply-playlist-fullscreen-visible"),this.isPanelVisible&&this.tracks.length>0?this.playlistPanel.style.display="block":this.playlistPanel.style.display="none")}createUI(){if(this.container=this.player.container,!this.container){console.warn("VidPly Playlist: No container found");return}if(this.player.element.tagName==="AUDIO"){this.trackArtworkElement=u.createElement("div",{className:"vidply-track-artwork",attributes:{"aria-hidden":"true"}}),this.trackArtworkElement.style.display="none";let e=this.container.querySelector(".vidply-video-wrapper");e?this.container.insertBefore(this.trackArtworkElement,e):this.container.appendChild(this.trackArtworkElement)}this.trackInfoElement=u.createElement("div",{className:"vidply-track-info",attributes:{role:"status"}}),this.trackInfoElement.style.display="none",this.container.appendChild(this.trackInfoElement),this.navigationFeedback=u.createElement("div",{className:"vidply-sr-only",attributes:{role:"status","aria-live":"polite","aria-atomic":"true"}}),this.container.appendChild(this.navigationFeedback),this.playlistPanel=u.createElement("div",{className:"vidply-playlist-panel",attributes:{id:`${this.uniqueId}-panel`,role:"region","aria-label":d.t("playlist.title"),"aria-labelledby":`${this.uniqueId}-heading`}}),this.playlistPanel.style.display=(this.isPanelVisible,"none"),this.container.appendChild(this.playlistPanel)}updateTrackInfo(e){if(!this.trackInfoElement)return;let t=this.currentIndex+1,i=this.tracks.length,s=e.title||d.t("playlist.untitled"),n=e.artist||"",r=this.getEffectiveDuration(e),c=r?x.formatTime(r):"",h=r?x.formatDuration(r):"",o=n?d.t("playlist.by")+n:"",a=h?`. ${h}`:"",l=d.t("playlist.nowPlaying",{current:t,total:i,title:s,artist:o})+a,g=d.t("playlist.trackOf",{current:t,total:i}),p=c?`<span class="vidply-track-duration" aria-hidden="true">${u.escapeHTML(c)}</span>`:"",y=e.description||"";this.trackInfoElement.innerHTML=`
      <span class="vidply-sr-only">${u.escapeHTML(l)}</span>
      <div class="vidply-track-header" aria-hidden="true">
        <span class="vidply-track-number">${u.escapeHTML(g)}</span>
        ${p}
      </div>
      <div class="vidply-track-title" aria-hidden="true">${u.escapeHTML(s)}</div>
      ${n?`<div class="vidply-track-artist" aria-hidden="true">${u.escapeHTML(n)}</div>`:""}
      ${y?`<div class="vidply-track-description" aria-hidden="true">${u.escapeHTML(y)}</div>`:""}
    `,this.trackInfoElement.style.display="block",this.updateTrackArtwork(e)}updateTrackArtwork(e){this.trackArtworkElement&&(e.poster?(this.trackArtworkElement.style.backgroundImage=`url(${e.poster})`,this.trackArtworkElement.style.display="block"):this.trackArtworkElement.style.display="none")}renderPlaylist(){if(!this.playlistPanel)return;this.playlistPanel.innerHTML="";let e=u.createElement("h2",{className:"vidply-playlist-header",attributes:{id:`${this.uniqueId}-heading`}});e.textContent=`${d.t("playlist.title")} (${this.tracks.length})`,this.playlistPanel.appendChild(e);let t=u.createElement("div",{className:"vidply-sr-only",attributes:{id:`${this.uniqueId}-keyboard-instructions`}});t.textContent=d.t("playlist.keyboardInstructions"),this.playlistPanel.appendChild(t);let i=u.createElement("ul",{className:"vidply-playlist-list",attributes:{role:"listbox","aria-labelledby":`${this.uniqueId}-heading`,"aria-describedby":`${this.uniqueId}-keyboard-instructions`}});this.tracks.forEach((s,n)=>{let r=this.createPlaylistItem(s,n);i.appendChild(r)}),this.playlistPanel.appendChild(i),this.isPanelVisible&&(this.playlistPanel.style.display="block")}createPlaylistItem(e,t){let i=d.t("playlist.trackOf",{current:t+1,total:this.tracks.length}),s=e.title||d.t("playlist.trackUntitled",{number:t+1}),n=e.artist?d.t("playlist.by")+e.artist:"",r=this.getEffectiveDuration(e),c=r?x.formatTime(r):"",h=r?x.formatDuration(r):"",o=t===this.currentIndex,a=`${s}${n}`;h&&(a+=`. ${h}`);let l=u.createElement("li",{className:o?"vidply-playlist-item vidply-playlist-item-active":"vidply-playlist-item",attributes:{"data-playlist-index":t}}),g=u.createElement("button",{className:"vidply-playlist-item-button",attributes:{type:"button",role:"option",tabIndex:t===0?0:-1,"aria-label":a,"aria-posinset":t+1,"aria-setsize":this.tracks.length,"aria-checked":o?"true":"false"}});o&&(g.setAttribute("aria-current","true"),g.setAttribute("tabIndex","0"));let p=u.createElement("span",{className:"vidply-playlist-thumbnail-container",attributes:{"aria-hidden":"true"}}),y=u.createElement("span",{className:"vidply-playlist-thumbnail"});if(e.poster)y.style.backgroundImage=`url(${e.poster})`;else{let f=w("music");f.classList.add("vidply-playlist-thumbnail-icon"),y.appendChild(f)}if(p.appendChild(y),c&&e.poster){let f=u.createElement("span",{className:"vidply-playlist-duration-badge"});f.textContent=c,p.appendChild(f)}g.appendChild(p);let b=u.createElement("span",{className:"vidply-playlist-item-info",attributes:{"aria-hidden":"true"}}),k=u.createElement("span",{className:"vidply-playlist-item-title-row"}),m=u.createElement("span",{className:"vidply-playlist-item-title"});if(m.textContent=s,k.appendChild(m),c&&!e.poster){let f=u.createElement("span",{className:"vidply-playlist-item-duration"});f.textContent=c,k.appendChild(f)}if(b.appendChild(k),e.artist){let f=u.createElement("span",{className:"vidply-playlist-item-artist"});f.textContent=e.artist,b.appendChild(f)}if(e.description){let f=u.createElement("span",{className:"vidply-playlist-item-description"});f.textContent=e.description,b.appendChild(f)}g.appendChild(b);let M=w("play");return M.classList.add("vidply-playlist-item-icon"),M.setAttribute("aria-hidden","true"),g.appendChild(M),g.addEventListener("click",()=>{this.play(t,!0)}),g.addEventListener("keydown",f=>{this.handlePlaylistItemKeydown(f,t)}),l.appendChild(g),l}handlePlaylistItemKeydown(e,t){let i=Array.from(this.playlistPanel.querySelectorAll(".vidply-playlist-item-button")),s=-1,n="";switch(e.key){case"Enter":case" ":e.preventDefault(),e.stopPropagation(),this.play(t,!0);return;case"ArrowDown":e.preventDefault(),e.stopPropagation(),t<i.length-1?s=t+1:n=d.t("playlist.endOfPlaylist",{current:i.length,total:i.length});break;case"ArrowUp":e.preventDefault(),e.stopPropagation(),t>0?s=t-1:n=d.t("playlist.beginningOfPlaylist",{total:i.length});break;case"PageDown":e.preventDefault(),e.stopPropagation(),s=Math.min(t+5,i.length-1),s===i.length-1&&t!==s&&(n=d.t("playlist.jumpedToLastTrack",{current:s+1,total:i.length}));break;case"PageUp":e.preventDefault(),e.stopPropagation(),s=Math.max(t-5,0),s===0&&t!==s&&(n=d.t("playlist.jumpedToFirstTrack",{total:i.length}));break;case"Home":e.preventDefault(),e.stopPropagation(),s=0,t!==0&&(n=d.t("playlist.firstTrack",{total:i.length}));break;case"End":e.preventDefault(),e.stopPropagation(),s=i.length-1,t!==i.length-1&&(n=d.t("playlist.lastTrack",{current:i.length,total:i.length}));break}if(s!==-1&&s!==t){i[t].setAttribute("tabIndex","-1"),i[s].setAttribute("tabIndex","0"),i[s].focus({preventScroll:!1});let r=i[s].closest(".vidply-playlist-item");r&&r.scrollIntoView({behavior:"smooth",block:"nearest"})}n&&this.navigationFeedback&&(this.navigationFeedback.textContent=n,setTimeout(()=>{this.navigationFeedback&&(this.navigationFeedback.textContent="")},1e3))}updatePlaylistUI(){if(!this.playlistPanel)return;let e=this.playlistPanel.querySelectorAll(".vidply-playlist-item"),t=this.playlistPanel.querySelectorAll(".vidply-playlist-item-button");e.forEach((i,s)=>{let n=t[s];if(!n)return;let r=this.tracks[s],c=d.t("playlist.trackOf",{current:s+1,total:this.tracks.length}),h=r.title||d.t("playlist.trackUntitled",{number:s+1}),o=r.artist?d.t("playlist.by")+r.artist:"",a=this.getEffectiveDuration(r),l=a?x.formatDuration(a):"";if(s===this.currentIndex){i.classList.add("vidply-playlist-item-active"),n.setAttribute("aria-current","true"),n.setAttribute("aria-checked","true"),n.setAttribute("tabIndex","0");let g=`${h}${o}`;l&&(g+=`. ${l}`),n.setAttribute("aria-label",g),i.scrollIntoView({behavior:"smooth",block:"nearest"})}else{i.classList.remove("vidply-playlist-item-active"),n.removeAttribute("aria-current"),n.setAttribute("aria-checked","false"),n.setAttribute("tabIndex","-1");let g=`${h}${o}`;l&&(g+=`. ${l}`),n.setAttribute("aria-label",g)}})}getCurrentTrack(){return this.tracks[this.currentIndex]||null}getPlaylistInfo(){return{currentIndex:this.currentIndex,totalTracks:this.tracks.length,currentTrack:this.getCurrentTrack(),hasNext:this.hasNext(),hasPrevious:this.hasPrevious()}}hasNext(){return this.options.loop?!0:this.currentIndex<this.tracks.length-1}hasPrevious(){return this.options.loop?!0:this.currentIndex>0}addTrack(e){this.tracks.push(e),this.playlistPanel&&this.renderPlaylist()}removeTrack(e){e<0||e>=this.tracks.length||(this.tracks.splice(e,1),e<this.currentIndex?this.currentIndex--:e===this.currentIndex&&(this.currentIndex>=this.tracks.length&&(this.currentIndex=this.tracks.length-1),this.currentIndex>=0&&this.play(this.currentIndex)),this.playlistPanel&&this.renderPlaylist())}clear(){this.tracks=[],this.currentIndex=-1,this.playlistPanel&&(this.playlistPanel.innerHTML="",this.playlistPanel.style.display="none"),this.trackInfoElement&&(this.trackInfoElement.innerHTML="",this.trackInfoElement.style.display="none"),this.trackArtworkElement&&(this.trackArtworkElement.style.backgroundImage="",this.trackArtworkElement.style.display="none")}togglePanel(e){return this.playlistPanel?((e!==void 0?e:this.playlistPanel.style.display==="none")?(this.playlistPanel.style.display="block",this.isPanelVisible=!0,this.tracks.length>0&&setTimeout(()=>{let i=this.playlistPanel.querySelector('.vidply-playlist-item[tabindex="0"]');i&&i.focus({preventScroll:!0})},100),this.player.controlBar&&this.player.controlBar.controls.playlistToggle&&(this.player.controlBar.controls.playlistToggle.setAttribute("aria-expanded","true"),this.player.controlBar.controls.playlistToggle.setAttribute("aria-pressed","true"))):(this.playlistPanel.style.display="none",this.isPanelVisible=!1,this.player.controlBar&&this.player.controlBar.controls.playlistToggle&&(this.player.controlBar.controls.playlistToggle.setAttribute("aria-expanded","false"),this.player.controlBar.controls.playlistToggle.setAttribute("aria-pressed","false"),this.player.controlBar.controls.playlistToggle.focus({preventScroll:!0}))),this.isPanelVisible):!1}showPanel(){return this.togglePanel(!0)}hidePanel(){return this.togglePanel(!1)}destroy(){this.player.off("ended",this.handleTrackEnd),this.player.off("error",this.handleTrackError),this.trackArtworkElement&&this.trackArtworkElement.remove(),this.trackInfoElement&&this.trackInfoElement.remove(),this.playlistPanel&&this.playlistPanel.remove(),this.clear()}};function ae(){document.querySelectorAll("[data-vidply]").forEach(e=>{let t=e.dataset.vidplyOptions?JSON.parse(e.dataset.vidplyOptions):{},s={...oe(e.dataset),...t};new F(e,s)})}function oe(T){let e={},t={signLanguageSrc:"signLanguageSrc",signLanguageButton:"signLanguageButton",signLanguagePosition:"signLanguagePosition",audioDescriptionSrc:"audioDescriptionSrc",audioDescriptionButton:"audioDescriptionButton",autoplay:"autoplay",loop:"loop",muted:"muted",controls:"controls",poster:"poster",width:"width",height:"height",language:"language",captions:"captions",captionsDefault:"captionsDefault",transcript:"transcript",transcriptButton:"transcriptButton",keyboard:"keyboard",responsive:"responsive",pipButton:"pipButton",fullscreenButton:"fullscreenButton"};Object.keys(t).forEach(s=>{let n=t[s],r=T[s];r!==void 0&&(r==="true"?e[n]=!0:r==="false"?e[n]=!1:!isNaN(r)&&r!==""?e[n]=Number(r):e[n]=r)});let i={};if(Object.keys(T).forEach(s=>{if(s.startsWith("signLanguageSrc")&&s!=="signLanguageSrc"){let n=s.match(/^signLanguageSrc([A-Z][a-z]*)$/);if(n){let r=n[1].toLowerCase();i[r]=T[s]}}}),Object.keys(i).length>0&&(e.signLanguageSources=i,T.signLanguageSrc&&!e.signLanguageSrc&&(e.signLanguageSrc=T.signLanguageSrc)),T.vidplyLanguageFiles)try{e.languageFiles=JSON.parse(T.vidplyLanguageFiles)}catch(s){console.warn("Invalid JSON in data-vidply-language-files:",s)}if(T.vidplyLanguageFile)try{let s=JSON.parse(T.vidplyLanguageFile);typeof s=="object"&&s!==null&&(e.languageFiles=s)}catch{T.vidplyLanguageFileCode&&T.vidplyLanguageFileUrl&&(e.languageFile=T.vidplyLanguageFileCode,e.languageFileUrl=T.vidplyLanguageFileUrl)}else T.vidplyLanguageFileCode&&T.vidplyLanguageFileUrl&&(e.languageFile=T.vidplyLanguageFileCode,e.languageFileUrl=T.vidplyLanguageFileUrl);return e}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ae):ae();var ze=F;export{F as Player,J as PlaylistManager,ze as default};
