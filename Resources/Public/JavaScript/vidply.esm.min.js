/*!
 * VidPly v1.0.0
 * Universal, Accessible Video Player
 * (c) 2025 Matthias Peltzer
 * Released under GPL-2.0-or-later License
 */
var be=Object.defineProperty;var ve=(p,e)=>()=>(p&&(e=p(p=0)),e);var we=(p,e)=>{for(var t in e)be(p,t,{get:e[t],enumerable:!0})};var me={};we(me,{HTML5Renderer:()=>q});var q,ne=ve(()=>{q=class{constructor(e){this.player=e,this.media=e.element}async init(){this.media.controls=!1,this.media.removeAttribute("controls"),this.attachEvents(),this.media.preload=this.player.options.preload,this.media.load()}attachEvents(){this.media.addEventListener("loadedmetadata",()=>{this.player.state.duration=this.media.duration,this.player.emit("loadedmetadata")}),this.media.addEventListener("play",()=>{this.player.state.playing=!0,this.player.state.paused=!1,this.player.state.ended=!1,this.player.emit("play"),this.player.options.onPlay&&this.player.options.onPlay.call(this.player),this.player.options.pauseOthersOnPlay&&this.pauseOtherPlayers()}),this.media.addEventListener("pause",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.emit("pause"),this.player.options.onPause&&this.player.options.onPause.call(this.player)}),this.media.addEventListener("ended",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.state.ended=!0,this.player.emit("ended"),this.player.options.onEnded&&this.player.options.onEnded.call(this.player),this.player.options.loop&&(this.player.seek(0),this.player.play())}),this.media.addEventListener("timeupdate",()=>{this.player.state.currentTime=this.media.currentTime,this.player.emit("timeupdate",this.media.currentTime),this.player.options.onTimeUpdate&&this.player.options.onTimeUpdate.call(this.player,this.media.currentTime)}),this.media.addEventListener("volumechange",()=>{this.player.state.volume=this.media.volume,this.player.state.muted=this.media.muted,this.player.emit("volumechange",this.media.volume),this.player.options.onVolumeChange&&this.player.options.onVolumeChange.call(this.player,this.media.volume)}),this.media.addEventListener("seeking",()=>{this.player.state.seeking=!0,this.player.emit("seeking")}),this.media.addEventListener("seeked",()=>{this.player.state.seeking=!1,this.player.emit("seeked")}),this.media.addEventListener("waiting",()=>{this.player.state.buffering=!0,this.player.emit("waiting")}),this.media.addEventListener("canplay",()=>{this.player.state.buffering=!1,this.player.emit("canplay")}),this.media.addEventListener("progress",()=>{if(this.media.buffered.length>0){let e=this.media.buffered.end(this.media.buffered.length-1);this.player.emit("progress",e)}}),this.media.addEventListener("error",e=>{this.player.handleError(this.media.error)}),this.media.addEventListener("ratechange",()=>{this.player.state.playbackSpeed=this.media.playbackRate,this.player.emit("ratechange",this.media.playbackRate)})}pauseOtherPlayers(){document.querySelectorAll(".vidply-player").forEach(t=>{if(t!==this.player.container){let i=t.querySelector("video, audio");i&&!i.paused&&i.pause()}})}play(){let e=window.scrollX,t=window.scrollY,i=this.media.play();window.scrollTo(e,t),i!==void 0&&i.catch(s=>{if(this.player.log("Play failed:",s,"warn"),this.player.options.autoplay&&!this.player.state.muted){this.player.log("Retrying play with muted audio","info"),this.media.muted=!0;let a=window.scrollX,r=window.scrollY;this.media.play().then(()=>{window.scrollTo(a,r)}).catch(l=>{this.player.handleError(l)})}})}pause(){this.media.pause()}seek(e){this.media.currentTime=e}setVolume(e){this.media.volume=e}setMuted(e){this.media.muted=e}setPlaybackSpeed(e){this.media.playbackRate=e}getQualities(){let e=Array.from(this.media.querySelectorAll("source"));return e.length<=1?[]:e.map((t,i)=>{let s=t.getAttribute("data-quality")||t.getAttribute("label")||"",a=t.getAttribute("data-height")||this.extractHeightFromLabel(s),r=t.getAttribute("data-width")||"";return{index:i,height:a?parseInt(a):0,width:r?parseInt(r):0,src:t.src,type:t.type,name:s||(a?`${a}p`:`Quality ${i+1}`)}}).filter(t=>t.height>0)}extractHeightFromLabel(e){let t=e.match(/(\d+)p/i);return t?parseInt(t[1]):0}switchQuality(e){let t=this.getQualities();if(e<0||e>=t.length){this.player.log("Invalid quality index","warn");return}let i=t[e],s=this.media.currentTime,a=!this.media.paused;if(this.media.currentSrc===i.src){this.player.log("Already at this quality level","info");return}this.player.log(`Switching to quality: ${i.name}`,"info"),this.media.src=i.src;let l=()=>{this.media.removeEventListener("loadedmetadata",l),this.media.currentTime=s,a&&this.media.play().catch(c=>{this.player.log("Failed to resume playback after quality switch","warn")}),this.player.emit("qualitychange",{quality:i.name,index:e})};this.media.addEventListener("loadedmetadata",l),this.media.load()}getCurrentQuality(){let e=this.getQualities(),t=this.media.currentSrc;for(let i=0;i<e.length;i++)if(e[i].src===t)return i;return 0}destroy(){this.media.removeEventListener("loadedmetadata",()=>{}),this.media.removeEventListener("play",()=>{}),this.media.removeEventListener("pause",()=>{})}}});var _=class{constructor(){this.events={}}on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),this}once(e,t){let i=(...s)=>{t(...s),this.off(e,i)};return this.on(e,i)}off(e,t){return this.events[e]?(t?this.events[e]=this.events[e].filter(i=>i!==t):delete this.events[e],this):this}emit(e,...t){return this.events[e]?(this.events[e].forEach(i=>{i(...t)}),this):this}removeAllListeners(){return this.events={},this}};var u={createElement(p,e={}){let t=document.createElement(p);return e.className&&(t.className=e.className),e.attributes&&Object.entries(e.attributes).forEach(([i,s])=>{t.setAttribute(i,s)}),e.innerHTML&&(t.innerHTML=e.innerHTML),e.textContent&&(t.textContent=e.textContent),e.style&&Object.assign(t.style,e.style),e.children&&e.children.forEach(i=>{i&&t.appendChild(i)}),t},addClass(p,e){p&&e&&p.classList.add(e)},removeClass(p,e){p&&e&&p.classList.remove(e)},toggleClass(p,e){p&&e&&p.classList.toggle(e)},hasClass(p,e){return p&&p.classList.contains(e)},show(p){p&&(p.style.display="")},hide(p){p&&(p.style.display="none")},fadeIn(p,e=300){if(!p)return;p.style.opacity="0",p.style.display="";let t=null,i=s=>{t||(t=s);let a=s-t,r=Math.min(a/e,1);p.style.opacity=r,a<e&&requestAnimationFrame(i)};requestAnimationFrame(i)},fadeOut(p,e=300){if(!p)return;let t=parseFloat(getComputedStyle(p).opacity)||1,i=null,s=a=>{i||(i=a);let r=a-i,l=Math.max(t-r/e,0);p.style.opacity=l,r<e?requestAnimationFrame(s):p.style.display="none"};requestAnimationFrame(s)},offset(p){if(!p)return{top:0,left:0};let e=p.getBoundingClientRect();return{top:e.top+window.pageYOffset,left:e.left+window.pageXOffset,width:e.width,height:e.height}},escapeHTML(p){let e=document.createElement("div");return e.textContent=p,e.innerHTML},sanitizeHTML(p){let e=document.createElement("div"),t=p.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/on\w+\s*=/gi,"").replace(/javascript:/gi,"");return e.innerHTML=t,e.innerHTML}};var oe={player:{label:"Video Player",play:"Play",pause:"Pause",stop:"Stop",restart:"Restart from beginning",rewind:"Rewind",forward:"Forward",rewindSeconds:"Rewind {seconds} seconds",forwardSeconds:"Forward {seconds} seconds",previous:"Previous track",next:"Next track",playlist:"Toggle playlist",volume:"Volume",mute:"Mute",unmute:"Unmute",fullscreen:"Fullscreen",exitFullscreen:"Exit Fullscreen",captions:"Captions",chapters:"Chapters",quality:"Quality",captionStyling:"Caption styling",transcript:"Toggle transcript",audioDescription:"Audio description",signLanguage:"Sign language video",settings:"Settings",speed:"Playback Speed",pip:"Picture in Picture",currentTime:"Current time",duration:"Duration",progress:"Progress",seekForward:"Seek forward {seconds} seconds",seekBackward:"Seek backward {seconds} seconds",volumeUp:"Volume up",volumeDown:"Volume down",loading:"Loading...",loadingChapters:"Loading chapters...",error:"Error loading media",buffering:"Buffering...",signLanguageVideo:"Sign Language Video",closeSignLanguage:"Close sign language video",signLanguageSettings:"Sign language settings",noChapters:"No chapters available",noCaptions:"No captions available",auto:"Auto",autoQuality:"Auto (no quality selection available)",noQuality:"Quality selection not available",signLanguageDragResize:"Sign Language Video - Press D to drag with keyboard, R to resize",signLanguageDragActive:"Sign Language Video - Drag mode active. Use arrow keys to move, Escape to exit.",signLanguageResizeActive:"Sign Language Video - Resize mode active. Use left/right arrow keys to resize, Escape to exit.",enableSignDragMode:"Enable drag mode. Shortcut: D key",disableSignDragMode:"Disable drag mode. Shortcut: D key",enableSignDragModeAria:"Enable toggle keyboard drag mode with arrow keys. Shortcut: D key",disableSignDragModeAria:"Disable toggle keyboard drag mode with arrow keys. Shortcut: D key",enableSignResizeMode:"Enable resize mode. Shortcut: R key",disableSignResizeMode:"Disable resize mode. Shortcut: R key",enableSignResizeModeAria:"Enable keyboard resize mode with arrow keys. Shortcut: R key",disableSignResizeModeAria:"Disable keyboard resize mode with arrow keys. Shortcut: R key",resizeHandle:"Resize {direction} corner",moreOptions:"More options",noMoreOptions:"No additional options available"},captions:{off:"Off",select:"Select captions",fontSize:"Font Size",fontFamily:"Font Family",color:"Text Color",backgroundColor:"Background Color",opacity:"Opacity"},fontSizes:{small:"Small",normal:"Normal",large:"Large",xlarge:"X-Large"},fontFamilies:{sansSerif:"Sans-serif",serif:"Serif",monospace:"Monospace"},styleLabels:{textColor:"Text Color",background:"Background",font:"Font",fontSize:"Font Size",opacity:"Opacity"},audioDescription:{enable:"Enable audio description",disable:"Disable audio description"},signLanguage:{show:"Show sign language video",hide:"Hide sign language video"},transcript:{title:"Transcript",close:"Close transcript",loading:"Loading transcript...",noTranscript:"No transcript available for this video.",settings:"Transcript settings. Press Enter to open menu, or D to enable drag mode",keyboardDragMode:"Toggle keyboard drag mode with arrow keys. Shortcut: D key",keyboardDragActive:"\u2328\uFE0F Keyboard Drag Mode Active (Arrow keys to move, Shift+Arrows for large steps, D or ESC to exit)",dragResizePrompt:"Press D to drag or R to resize. Use Home to reset position, Esc to close.",dragModeEnabled:"Keyboard drag mode enabled. Use arrow keys to move, Shift+Arrow for larger steps. Press D or Esc to exit.",dragModeDisabled:"Keyboard drag mode disabled.",enableDragMode:"Enable drag mode. Shortcut: D key",disableDragMode:"Disable drag mode. Shortcut: D key",enableDragModeAria:"Enable toggle keyboard drag mode with arrow keys. Shortcut: D key",disableDragModeAria:"Disable toggle keyboard drag mode with arrow keys. Shortcut: D key",resizeWindow:"Resize Window",disableResizeWindow:"Disable Resize Mode",enableResizeMode:"Enable resize mode. Shortcut: R key",disableResizeMode:"Disable resize mode. Shortcut: R key",enableResizeModeAria:"Enable keyboard resize mode with arrow keys. Shortcut: R key",disableResizeModeAria:"Disable keyboard resize mode with arrow keys. Shortcut: R key",resizeModeHint:"Resize handles enabled. Drag edges or corners to adjust. Press Esc or R to exit.",resizeModeEnabled:"Resize mode enabled. Drag edges or corners to adjust. Press Esc or R to exit.",resizeModeDisabled:"Resize mode disabled.",positionReset:"Transcript position reset.",styleTranscript:"Open transcript style settings",closeMenu:"Close Menu",styleTitle:"Transcript Style",autoscroll:"Autoscroll",settingsMenu:"Transcript dialog settings",showTimestamps:"Show timestamps",hideTimestamps:"Hide timestamps",showTimestampsAria:"Show timestamps in transcript",hideTimestampsAria:"Hide timestamps in transcript"},settings:{title:"Settings",quality:"Quality",speed:"Speed",captions:"Captions",language:"Language",reset:"Reset to defaults",close:"Close"},speeds:{normal:"Normal"},time:{display:"Time display",durationPrefix:"Duration: ",of:"of",hour:"{count} hour",hours:"{count} hours",minute:"{count} minute",minutes:"{count} minutes",second:"{count} second",seconds:"{count} seconds"},playlist:{title:"Playlist",trackOf:"Track {current} of {total}",nowPlaying:"Now playing: Track {current} of {total}. {title}{artist}",by:" by ",untitled:"Untitled",trackUntitled:"Track {number}",currentlyPlaying:"Currently playing",notPlaying:"Not playing",pressEnterPlay:"Press Enter to play",pressEnterRestart:"Press Enter to restart"}};var le={player:{label:"Videoplayer",play:"Abspielen",pause:"Pause",stop:"Stopp",restart:"Von vorne beginnen",rewind:"Zur\xFCckspulen",forward:"Vorspulen",rewindSeconds:"{seconds} Sekunden zur\xFCckspulen",forwardSeconds:"{seconds} Sekunden vorspulen",previous:"Vorheriger Titel",next:"N\xE4chster Titel",playlist:"Wiedergabeliste umschalten",volume:"Lautst\xE4rke",mute:"Stumm",unmute:"Ton ein",fullscreen:"Vollbild",exitFullscreen:"Vollbild beenden",captions:"Untertitel",chapters:"Kapitel",quality:"Qualit\xE4t",captionStyling:"Untertitel-Stil",transcript:"Transkript umschalten",audioDescription:"Audiodeskription",signLanguage:"Geb\xE4rdensprache-Video",settings:"Einstellungen",speed:"Wiedergabegeschwindigkeit",pip:"Bild-in-Bild",currentTime:"Aktuelle Zeit",duration:"Dauer",progress:"Fortschritt",seekForward:"{seconds} Sekunden vorspulen",seekBackward:"{seconds} Sekunden zur\xFCckspulen",volumeUp:"Lauter",volumeDown:"Leiser",loading:"L\xE4dt...",loadingChapters:"Kapitel werden geladen...",error:"Fehler beim Laden",buffering:"Puffern...",signLanguageVideo:"Geb\xE4rdensprache-Video",closeSignLanguage:"Geb\xE4rdensprache-Video schlie\xDFen",signLanguageSettings:"Geb\xE4rdensprache-Einstellungen",noChapters:"Keine Kapitel verf\xFCgbar",noCaptions:"Keine Untertitel verf\xFCgbar",auto:"Automatisch",autoQuality:"Automatisch (keine Qualit\xE4tsauswahl verf\xFCgbar)",noQuality:"Qualit\xE4tsauswahl nicht verf\xFCgbar",signLanguageDragResize:"Geb\xE4rdensprache-Video - Dr\xFCcken Sie D zum Verschieben per Tastatur, R zum \xC4ndern der Gr\xF6\xDFe",signLanguageDragActive:"Geb\xE4rdensprache-Video - Verschiebemodus aktiv. Pfeiltasten zum Bewegen, Escape zum Beenden.",signLanguageResizeActive:"Geb\xE4rdensprache-Video - Gr\xF6\xDFen\xE4nderungsmodus aktiv. Links-/Rechts-Pfeiltasten zum \xC4ndern der Gr\xF6\xDFe, Escape zum Beenden.",enableSignDragMode:"Verschiebemodus aktivieren. Tastenkombination: D-Taste",disableSignDragMode:"Verschiebemodus deaktivieren. Tastenkombination: D-Taste",enableSignDragModeAria:"Tastatur-Verschiebemodus mit Pfeiltasten aktivieren. Tastenkombination: D-Taste",disableSignDragModeAria:"Tastatur-Verschiebemodus mit Pfeiltasten deaktivieren. Tastenkombination: D-Taste",enableSignResizeMode:"Gr\xF6\xDFen\xE4nderungsmodus aktivieren. Tastenkombination: R-Taste",disableSignResizeMode:"Gr\xF6\xDFen\xE4nderungsmodus deaktivieren. Tastenkombination: R-Taste",enableSignResizeModeAria:"Tastatur-Gr\xF6\xDFen\xE4nderungsmodus mit Pfeiltasten aktivieren. Tastenkombination: R-Taste",disableSignResizeModeAria:"Tastatur-Gr\xF6\xDFen\xE4nderungsmodus mit Pfeiltasten deaktivieren. Tastenkombination: R-Taste",resizeHandle:"Gr\xF6\xDFen\xE4nderung {direction}-Ecke",moreOptions:"Weitere Optionen",noMoreOptions:"Keine weiteren Optionen verf\xFCgbar"},captions:{off:"Aus",select:"Untertitel ausw\xE4hlen",fontSize:"Schriftgr\xF6\xDFe",fontFamily:"Schriftart",color:"Textfarbe",backgroundColor:"Hintergrundfarbe",opacity:"Deckkraft"},fontSizes:{small:"Klein",normal:"Normal",large:"Gro\xDF",xlarge:"Sehr gro\xDF"},fontFamilies:{sansSerif:"Sans-serif",serif:"Serif",monospace:"Monospace"},styleLabels:{textColor:"Textfarbe",background:"Hintergrund",font:"Schrift",fontSize:"Schriftgr\xF6\xDFe",opacity:"Deckkraft"},audioDescription:{enable:"Audiodeskription aktivieren",disable:"Audiodeskription deaktivieren"},signLanguage:{show:"Geb\xE4rdensprache-Video anzeigen",hide:"Geb\xE4rdensprache-Video ausblenden"},transcript:{title:"Transkript",close:"Transkript schlie\xDFen",loading:"Transkript wird geladen...",noTranscript:"Kein Transkript f\xFCr dieses Video verf\xFCgbar.",settings:"Transkript-Einstellungen. Eingabetaste zum \xD6ffnen des Men\xFCs dr\xFCcken oder D zum Aktivieren des Verschiebemodus",keyboardDragMode:"Tastatur-Verschiebemodus mit Pfeiltasten umschalten. Tastenkombination: D-Taste",keyboardDragActive:"\u2328\uFE0F Tastatur-Verschiebemodus aktiv (Pfeiltasten zum Bewegen, Umschalt+Pfeiltasten f\xFCr gro\xDFe Schritte, D oder ESC zum Beenden)",dragResizePrompt:"Dr\xFCcken Sie D zum Verschieben oder R zur Gr\xF6\xDFen\xE4nderung. Home setzt die Position zur\xFCck, Esc schlie\xDFt.",dragModeEnabled:"Tastatur-Verschiebemodus aktiviert. Pfeiltasten zum Bewegen, Umschalt+Pfeiltasten f\xFCr gr\xF6\xDFere Schritte. D oder Esc zum Beenden.",dragModeDisabled:"Tastatur-Verschiebemodus deaktiviert.",enableDragMode:"Verschiebemodus aktivieren. Tastenkombination: D-Taste",disableDragMode:"Verschiebemodus deaktivieren. Tastenkombination: D-Taste",enableDragModeAria:"Tastatur-Verschiebemodus mit Pfeiltasten aktivieren. Tastenkombination: D-Taste",disableDragModeAria:"Tastatur-Verschiebemodus mit Pfeiltasten deaktivieren. Tastenkombination: D-Taste",resizeWindow:"Fenster vergr\xF6\xDFern/verkleinern",disableResizeWindow:"Resize-Modus deaktivieren",enableResizeMode:"Gr\xF6\xDFen\xE4nderungsmodus aktivieren. Tastenkombination: R-Taste",disableResizeMode:"Gr\xF6\xDFen\xE4nderungsmodus deaktivieren. Tastenkombination: R-Taste",enableResizeModeAria:"Tastatur-Gr\xF6\xDFen\xE4nderungsmodus mit Pfeiltasten aktivieren. Tastenkombination: R-Taste",disableResizeModeAria:"Tastatur-Gr\xF6\xDFen\xE4nderungsmodus mit Pfeiltasten deaktivieren. Tastenkombination: R-Taste",resizeModeHint:"Griffe aktiviert. Ziehen Sie Kanten oder Ecken zum Anpassen. Esc oder R zum Beenden.",resizeModeEnabled:"Resize-Modus aktiviert. Kanten oder Ecken ziehen; Esc oder R beendet.",resizeModeDisabled:"Resize-Modus deaktiviert.",positionReset:"Transkriptposition zur\xFCckgesetzt.",styleTranscript:"Transkript-Stileinstellungen \xF6ffnen",closeMenu:"Men\xFC schlie\xDFen",styleTitle:"Transkript-Stil",autoscroll:"Auto-Scroll",settingsMenu:"Transkript-Dialog-Einstellungen",showTimestamps:"Zeitstempel anzeigen",hideTimestamps:"Zeitstempel ausblenden",showTimestampsAria:"Zeitstempel im Transkript anzeigen",hideTimestampsAria:"Zeitstempel im Transkript ausblenden"},settings:{title:"Einstellungen",quality:"Qualit\xE4t",speed:"Geschwindigkeit",captions:"Untertitel",language:"Sprache",reset:"Zur\xFCcksetzen",close:"Schlie\xDFen"},speeds:{normal:"Normal"},time:{display:"Zeitanzeige",durationPrefix:"Dauer: ",of:"von",hour:"{count} Stunde",hours:"{count} Stunden",minute:"{count} Minute",minutes:"{count} Minuten",second:"{count} Sekunde",seconds:"{count} Sekunden"},playlist:{title:"Wiedergabeliste",trackOf:"Titel {current} von {total}",nowPlaying:"L\xE4uft gerade: Titel {current} von {total}. {title}{artist}",by:" von ",untitled:"Ohne Titel",trackUntitled:"Titel {number}",currentlyPlaying:"Wird gerade abgespielt",notPlaying:"Nicht aktiv",pressEnterPlay:"Eingabetaste zum Abspielen",pressEnterRestart:"Eingabetaste zum Neustart"}};var ce={player:{label:"Reproductor de video",play:"Reproducir",pause:"Pausa",stop:"Detener",restart:"Reiniciar desde el principio",rewind:"Retroceder",forward:"Avanzar",rewindSeconds:"Retroceder {seconds} segundos",forwardSeconds:"Avanzar {seconds} segundos",previous:"Pista anterior",next:"Siguiente pista",playlist:"Alternar lista de reproducci\xF3n",volume:"Volumen",mute:"Silenciar",unmute:"Activar sonido",fullscreen:"Pantalla completa",exitFullscreen:"Salir de pantalla completa",captions:"Subt\xEDtulos",chapters:"Cap\xEDtulos",quality:"Calidad",captionStyling:"Estilo de subt\xEDtulos",transcript:"Alternar transcripci\xF3n",audioDescription:"Audiodescripci\xF3n",signLanguage:"Video en lengua de se\xF1as",settings:"Configuraci\xF3n",speed:"Velocidad de reproducci\xF3n",pip:"Imagen en imagen",currentTime:"Tiempo actual",duration:"Duraci\xF3n",progress:"Progreso",seekForward:"Avanzar {seconds} segundos",seekBackward:"Retroceder {seconds} segundos",volumeUp:"Subir volumen",volumeDown:"Bajar volumen",loading:"Cargando...",loadingChapters:"Cargando cap\xEDtulos...",error:"Error al cargar",buffering:"Almacenando en b\xFAfer...",signLanguageVideo:"Video en Lengua de Se\xF1as",closeSignLanguage:"Cerrar video en lengua de se\xF1as",signLanguageSettings:"Configuraci\xF3n de lengua de se\xF1as",noChapters:"No hay cap\xEDtulos disponibles",noCaptions:"No hay subt\xEDtulos disponibles",auto:"Autom\xE1tico",autoQuality:"Autom\xE1tico (selecci\xF3n de calidad no disponible)",noQuality:"Selecci\xF3n de calidad no disponible",signLanguageDragResize:"Video en Lengua de Se\xF1as - Presione D para arrastrar con el teclado, R para cambiar el tama\xF1o",signLanguageDragActive:"Video en Lengua de Se\xF1as - Modo de arrastre activo. Use las teclas de flecha para mover, Escape para salir.",signLanguageResizeActive:"Video en Lengua de Se\xF1as - Modo de cambio de tama\xF1o activo. Use las teclas de flecha izquierda/derecha para cambiar el tama\xF1o, Escape para salir.",enableSignDragMode:"Activar modo de arrastre. Atajo: tecla D",disableSignDragMode:"Desactivar modo de arrastre. Atajo: tecla D",enableSignDragModeAria:"Activar modo de arrastre con teclado usando teclas de flecha. Atajo: tecla D",disableSignDragModeAria:"Desactivar modo de arrastre con teclado usando teclas de flecha. Atajo: tecla D",enableSignResizeMode:"Activar modo de cambio de tama\xF1o. Atajo: tecla R",disableSignResizeMode:"Desactivar modo de cambio de tama\xF1o. Atajo: tecla R",enableSignResizeModeAria:"Activar modo de cambio de tama\xF1o con teclado usando teclas de flecha. Atajo: tecla R",disableSignResizeModeAria:"Desactivar modo de cambio de tama\xF1o con teclado usando teclas de flecha. Atajo: tecla R",resizeHandle:"Cambiar tama\xF1o esquina {direction}",moreOptions:"M\xE1s opciones",noMoreOptions:"No hay opciones adicionales disponibles"},captions:{off:"Desactivado",select:"Seleccionar subt\xEDtulos",fontSize:"Tama\xF1o de fuente",fontFamily:"Familia de fuente",color:"Color de texto",backgroundColor:"Color de fondo",opacity:"Opacidad"},fontSizes:{small:"Peque\xF1o",normal:"Normal",large:"Grande",xlarge:"Muy grande"},fontFamilies:{sansSerif:"Sans-serif",serif:"Serif",monospace:"Monospace"},styleLabels:{textColor:"Color de texto",background:"Fondo",font:"Fuente",fontSize:"Tama\xF1o de fuente",opacity:"Opacidad"},audioDescription:{enable:"Activar audiodescripci\xF3n",disable:"Desactivar audiodescripci\xF3n"},signLanguage:{show:"Mostrar video en lengua de se\xF1as",hide:"Ocultar video en lengua de se\xF1as"},transcript:{title:"Transcripci\xF3n",close:"Cerrar transcripci\xF3n",loading:"Cargando transcripci\xF3n...",noTranscript:"No hay transcripci\xF3n disponible para este video.",settings:"Configuraci\xF3n de transcripci\xF3n. Presione Enter para abrir el men\xFA o D para activar el modo de arrastre",keyboardDragMode:"Alternar modo de arrastre con teclado usando teclas de flecha. Atajo: tecla D",keyboardDragActive:"\u2328\uFE0F Modo de Arrastre con Teclado Activo (Teclas de flecha para mover, May\xFAs+Flechas para pasos grandes, D o ESC para salir)",dragResizePrompt:"Pulsa D para mover o R para cambiar el tama\xF1o. Home restablece la posici\xF3n; Esc cierra.",dragModeEnabled:"Modo de arrastre con teclado activado. Usa flechas para mover, May\xFAs+Flechas para pasos grandes. Pulsa D o Esc para salir.",dragModeDisabled:"Modo de arrastre con teclado desactivado.",enableDragMode:"Activar modo de arrastre. Atajo: tecla D",disableDragMode:"Desactivar modo de arrastre. Atajo: tecla D",enableDragModeAria:"Activar modo de arrastre con teclado usando teclas de flecha. Atajo: tecla D",disableDragModeAria:"Desactivar modo de arrastre con teclado usando teclas de flecha. Atajo: tecla D",resizeWindow:"Cambiar tama\xF1o de ventana",disableResizeWindow:"Desactivar modo de cambio de tama\xF1o",enableResizeMode:"Activar modo de cambio de tama\xF1o. Atajo: tecla R",disableResizeMode:"Desactivar modo de cambio de tama\xF1o. Atajo: tecla R",enableResizeModeAria:"Activar modo de cambio de tama\xF1o con teclado usando teclas de flecha. Atajo: tecla R",disableResizeModeAria:"Desactivar modo de cambio de tama\xF1o con teclado usando teclas de flecha. Atajo: tecla R",resizeModeHint:"Controladores habilitados. Arrastra bordes o esquinas para ajustar. Pulsa Esc o R para salir.",resizeModeEnabled:"Modo de cambio de tama\xF1o activado. Arrastra bordes o esquinas. Pulsa Esc o R para salir.",resizeModeDisabled:"Modo de cambio de tama\xF1o desactivado.",positionReset:"Posici\xF3n de la transcripci\xF3n restablecida.",styleTranscript:"Abrir configuraci\xF3n de estilo de transcripci\xF3n",closeMenu:"Cerrar men\xFA",styleTitle:"Estilo de Transcripci\xF3n",autoscroll:"Desplazamiento autom\xE1tico",settingsMenu:"Configuraci\xF3n del di\xE1logo de transcripci\xF3n",showTimestamps:"Mostrar marcas de tiempo",hideTimestamps:"Ocultar marcas de tiempo",showTimestampsAria:"Mostrar marcas de tiempo en la transcripci\xF3n",hideTimestampsAria:"Ocultar marcas de tiempo en la transcripci\xF3n"},settings:{title:"Configuraci\xF3n",quality:"Calidad",speed:"Velocidad",captions:"Subt\xEDtulos",language:"Idioma",reset:"Restablecer",close:"Cerrar"},speeds:{normal:"Normal"},time:{display:"Visualizaci\xF3n de tiempo",durationPrefix:"Duraci\xF3n: ",of:"de",hour:"{count} hora",hours:"{count} horas",minute:"{count} minuto",minutes:"{count} minutos",second:"{count} segundo",seconds:"{count} segundos"},playlist:{title:"Lista de reproducci\xF3n",trackOf:"Pista {current} de {total}",nowPlaying:"Reproduciendo ahora: Pista {current} de {total}. {title}{artist}",by:" por ",untitled:"Sin t\xEDtulo",trackUntitled:"Pista {number}",currentlyPlaying:"Reproduciendo actualmente",notPlaying:"Sin reproducir",pressEnterPlay:"Pulsa Enter para reproducir",pressEnterRestart:"Pulsa Enter para reiniciar"}};var de={player:{label:"Lecteur vid\xE9o",play:"Lecture",pause:"Pause",stop:"Arr\xEAt",restart:"Red\xE9marrer du d\xE9but",rewind:"Reculer",forward:"Avancer",rewindSeconds:"Reculer de {seconds} secondes",forwardSeconds:"Avancer de {seconds} secondes",previous:"Piste pr\xE9c\xE9dente",next:"Piste suivante",playlist:"Basculer la liste de lecture",volume:"Volume",mute:"Muet",unmute:"Activer le son",fullscreen:"Plein \xE9cran",exitFullscreen:"Quitter le plein \xE9cran",captions:"Sous-titres",chapters:"Chapitres",quality:"Qualit\xE9",captionStyling:"Style des sous-titres",transcript:"Activer/d\xE9sactiver la transcription",audioDescription:"Audiodescription",signLanguage:"Vid\xE9o en langue des signes",settings:"Param\xE8tres",speed:"Vitesse de lecture",pip:"Image dans l'image",currentTime:"Temps actuel",duration:"Dur\xE9e",progress:"Progression",seekForward:"Avancer de {seconds} secondes",seekBackward:"Reculer de {seconds} secondes",volumeUp:"Augmenter le volume",volumeDown:"Diminuer le volume",loading:"Chargement...",loadingChapters:"Chargement des chapitres...",error:"Erreur de chargement",buffering:"Mise en m\xE9moire tampon...",signLanguageVideo:"Vid\xE9o en Langue des Signes",closeSignLanguage:"Fermer la vid\xE9o en langue des signes",signLanguageSettings:"Param\xE8tres de la langue des signes",noChapters:"Aucun chapitre disponible",noCaptions:"Aucun sous-titre disponible",auto:"Automatique",autoQuality:"Automatique (s\xE9lection de qualit\xE9 non disponible)",noQuality:"S\xE9lection de qualit\xE9 non disponible",signLanguageDragResize:"Vid\xE9o en Langue des Signes - Appuyez sur D pour d\xE9placer avec le clavier, R pour redimensionner",signLanguageDragActive:"Vid\xE9o en Langue des Signes - Mode glissement actif. Utilisez les touches fl\xE9ch\xE9es pour d\xE9placer, \xC9chap pour quitter.",signLanguageResizeActive:"Vid\xE9o en Langue des Signes - Mode redimensionnement actif. Utilisez les touches fl\xE9ch\xE9es gauche/droite pour redimensionner, \xC9chap pour quitter.",enableSignDragMode:"Activer le mode glissement. Raccourci : touche D",disableSignDragMode:"D\xE9sactiver le mode glissement. Raccourci : touche D",enableSignDragModeAria:"Activer le mode glissement clavier avec les touches fl\xE9ch\xE9es. Raccourci : touche D",disableSignDragModeAria:"D\xE9sactiver le mode glissement clavier avec les touches fl\xE9ch\xE9es. Raccourci : touche D",enableSignResizeMode:"Activer le mode redimensionnement. Raccourci : touche R",disableSignResizeMode:"D\xE9sactiver le mode redimensionnement. Raccourci : touche R",enableSignResizeModeAria:"Activer le mode redimensionnement clavier avec les touches fl\xE9ch\xE9es. Raccourci : touche R",disableSignResizeModeAria:"D\xE9sactiver le mode redimensionnement clavier avec les touches fl\xE9ch\xE9es. Raccourci : touche R",resizeHandle:"Redimensionner coin {direction}",moreOptions:"Plus d'options",noMoreOptions:"Aucune option suppl\xE9mentaire disponible"},captions:{off:"D\xE9sactiv\xE9",select:"S\xE9lectionner les sous-titres",fontSize:"Taille de police",fontFamily:"Police",color:"Couleur du texte",backgroundColor:"Couleur de fond",opacity:"Opacit\xE9"},fontSizes:{small:"Petit",normal:"Normal",large:"Grand",xlarge:"Tr\xE8s grand"},fontFamilies:{sansSerif:"Sans-serif",serif:"Serif",monospace:"Monospace"},styleLabels:{textColor:"Couleur du texte",background:"Arri\xE8re-plan",font:"Police",fontSize:"Taille de police",opacity:"Opacit\xE9"},audioDescription:{enable:"Activer l'audiodescription",disable:"D\xE9sactiver l'audiodescription"},signLanguage:{show:"Afficher la vid\xE9o en langue des signes",hide:"Masquer la vid\xE9o en langue des signes"},transcript:{title:"Transcription",close:"Fermer la transcription",loading:"Chargement de la transcription...",noTranscript:"Aucune transcription disponible pour cette vid\xE9o.",settings:"Param\xE8tres de transcription. Appuyez sur Entr\xE9e pour ouvrir le menu ou D pour activer le mode glissement",keyboardDragMode:"Basculer le mode glissement avec les touches fl\xE9ch\xE9es. Raccourci: touche D",keyboardDragActive:"\u2328\uFE0F Mode Glissement Clavier Actif (Touches fl\xE9ch\xE9es pour d\xE9placer, Maj+Fl\xE9ch\xE9es pour grands pas, D ou \xC9chap pour quitter)",dragResizePrompt:"Appuyez sur D pour d\xE9placer ou R pour redimensionner. Home r\xE9initialise la position, \xC9chap ferme.",dragModeEnabled:"Mode glissement clavier activ\xE9. Utilisez les fl\xE8ches pour d\xE9placer, Maj+Fl\xE8ches pour de grands pas. Appuyez sur D ou \xC9chap pour quitter.",dragModeDisabled:"Mode glissement clavier d\xE9sactiv\xE9.",enableDragMode:"Activer le mode glissement. Raccourci : touche D",disableDragMode:"D\xE9sactiver le mode glissement. Raccourci : touche D",enableDragModeAria:"Activer le mode glissement clavier avec les touches fl\xE9ch\xE9es. Raccourci : touche D",disableDragModeAria:"D\xE9sactiver le mode glissement clavier avec les touches fl\xE9ch\xE9es. Raccourci : touche D",resizeWindow:"Redimensionner la fen\xEAtre",disableResizeWindow:"D\xE9sactiver le mode de redimensionnement",enableResizeMode:"Activer le mode redimensionnement. Raccourci : touche R",disableResizeMode:"D\xE9sactiver le mode redimensionnement. Raccourci : touche R",enableResizeModeAria:"Activer le mode redimensionnement clavier avec les touches fl\xE9ch\xE9es. Raccourci : touche R",disableResizeModeAria:"D\xE9sactiver le mode redimensionnement clavier avec les touches fl\xE9ch\xE9es. Raccourci : touche R",resizeModeHint:"Poign\xE9es activ\xE9es. Faites glisser les bords ou les coins pour ajuster. Appuyez sur \xC9chap ou R pour quitter.",resizeModeEnabled:"Mode redimensionnement activ\xE9. Faites glisser les bords ou coins. Appuyez sur \xC9chap ou R pour quitter.",resizeModeDisabled:"Mode redimensionnement d\xE9sactiv\xE9.",positionReset:"Position de la transcription r\xE9initialis\xE9e.",styleTranscript:"Ouvrir les param\xE8tres de style de transcription",closeMenu:"Fermer le menu",styleTitle:"Style de Transcription",autoscroll:"D\xE9filement automatique",settingsMenu:"Param\xE8tres de dialogue de transcription",showTimestamps:"Afficher les horodatages",hideTimestamps:"Masquer les horodatages",showTimestampsAria:"Afficher les horodatages dans la transcription",hideTimestampsAria:"Masquer les horodatages dans la transcription"},settings:{title:"Param\xE8tres",quality:"Qualit\xE9",speed:"Vitesse",captions:"Sous-titres",language:"Langue",reset:"R\xE9initialiser",close:"Fermer"},speeds:{normal:"Normal"},time:{display:"Affichage du temps",durationPrefix:"Dur\xE9e : ",of:"sur",hour:"{count} heure",hours:"{count} heures",minute:"{count} minute",minutes:"{count} minutes",second:"{count} seconde",seconds:"{count} secondes"},playlist:{title:"Liste de lecture",trackOf:"Piste {current} sur {total}",nowPlaying:"Lecture en cours : Piste {current} sur {total}. {title}{artist}",by:" par ",untitled:"Sans titre",trackUntitled:"Piste {number}",currentlyPlaying:"En cours de lecture",notPlaying:"Non en lecture",pressEnterPlay:"Appuyez sur Entr\xE9e pour lire",pressEnterRestart:"Appuyez sur Entr\xE9e pour recommencer"}};var ue={player:{label:"\u30D3\u30C7\u30AA\u30D7\u30EC\u30FC\u30E4\u30FC",play:"\u518D\u751F",pause:"\u4E00\u6642\u505C\u6B62",stop:"\u505C\u6B62",restart:"\u6700\u521D\u304B\u3089\u518D\u751F",rewind:"\u5DFB\u304D\u623B\u3057",forward:"\u65E9\u9001\u308A",rewindSeconds:"{seconds}\u79D2\u623B\u3059",forwardSeconds:"{seconds}\u79D2\u9032\u3081\u308B",previous:"\u524D\u306E\u30C8\u30E9\u30C3\u30AF",next:"\u6B21\u306E\u30C8\u30E9\u30C3\u30AF",playlist:"\u30D7\u30EC\u30A4\u30EA\u30B9\u30C8\u306E\u5207\u308A\u66FF\u3048",volume:"\u97F3\u91CF",mute:"\u30DF\u30E5\u30FC\u30C8",unmute:"\u30DF\u30E5\u30FC\u30C8\u89E3\u9664",fullscreen:"\u5168\u753B\u9762\u8868\u793A",exitFullscreen:"\u5168\u753B\u9762\u8868\u793A\u3092\u7D42\u4E86",captions:"\u5B57\u5E55",chapters:"\u30C1\u30E3\u30D7\u30BF\u30FC",quality:"\u753B\u8CEA",captionStyling:"\u5B57\u5E55\u30B9\u30BF\u30A4\u30EB",transcript:"\u6587\u5B57\u8D77\u3053\u3057\u5207\u308A\u66FF\u3048",audioDescription:"\u97F3\u58F0\u89E3\u8AAC",signLanguage:"\u624B\u8A71\u52D5\u753B",settings:"\u8A2D\u5B9A",speed:"\u518D\u751F\u901F\u5EA6",pip:"\u30D4\u30AF\u30C1\u30E3\u30FC\u30A4\u30F3\u30D4\u30AF\u30C1\u30E3\u30FC",currentTime:"\u73FE\u5728\u306E\u6642\u9593",duration:"\u518D\u751F\u6642\u9593",progress:"\u9032\u884C\u72B6\u6CC1",seekForward:"{seconds}\u79D2\u9032\u3081\u308B",seekBackward:"{seconds}\u79D2\u623B\u3059",volumeUp:"\u97F3\u91CF\u3092\u4E0A\u3052\u308B",volumeDown:"\u97F3\u91CF\u3092\u4E0B\u3052\u308B",loading:"\u8AAD\u307F\u8FBC\u307F\u4E2D...",loadingChapters:"\u30C1\u30E3\u30D7\u30BF\u30FC\u8AAD\u307F\u8FBC\u307F\u4E2D...",error:"\u8AAD\u307F\u8FBC\u307F\u30A8\u30E9\u30FC",buffering:"\u30D0\u30C3\u30D5\u30A1\u30EA\u30F3\u30B0\u4E2D...",signLanguageVideo:"\u624B\u8A71\u52D5\u753B",closeSignLanguage:"\u624B\u8A71\u52D5\u753B\u3092\u9589\u3058\u308B",signLanguageSettings:"\u624B\u8A71\u8A2D\u5B9A",noChapters:"\u30C1\u30E3\u30D7\u30BF\u30FC\u304C\u3042\u308A\u307E\u305B\u3093",noCaptions:"\u5B57\u5E55\u304C\u3042\u308A\u307E\u305B\u3093",auto:"\u81EA\u52D5",autoQuality:"\u81EA\u52D5\uFF08\u753B\u8CEA\u9078\u629E\u4E0D\u53EF\uFF09",noQuality:"\u753B\u8CEA\u9078\u629E\u4E0D\u53EF",signLanguageDragResize:"\u624B\u8A71\u52D5\u753B - \u30AD\u30FC\u30DC\u30FC\u30C9\u3067\u30C9\u30E9\u30C3\u30B0\u3059\u308B\u306B\u306FD\u30AD\u30FC\u3092\u3001\u30B5\u30A4\u30BA\u5909\u66F4\u3059\u308B\u306B\u306FR\u30AD\u30FC\u3092\u62BC\u3057\u3066\u304F\u3060\u3055\u3044",signLanguageDragActive:"\u624B\u8A71\u52D5\u753B - \u30C9\u30E9\u30C3\u30B0\u30E2\u30FC\u30C9\u304C\u6709\u52B9\u3067\u3059\u3002\u77E2\u5370\u30AD\u30FC\u3067\u79FB\u52D5\u3001Escape\u3067\u7D42\u4E86\u3057\u307E\u3059\u3002",signLanguageResizeActive:"\u624B\u8A71\u52D5\u753B - \u30B5\u30A4\u30BA\u5909\u66F4\u30E2\u30FC\u30C9\u304C\u6709\u52B9\u3067\u3059\u3002\u5DE6\u53F3\u306E\u77E2\u5370\u30AD\u30FC\u3067\u30B5\u30A4\u30BA\u5909\u66F4\u3001Escape\u3067\u7D42\u4E86\u3057\u307E\u3059\u3002",enableSignDragMode:"\u30C9\u30E9\u30C3\u30B0\u30E2\u30FC\u30C9\u3092\u6709\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AD\u30AD\u30FC",disableSignDragMode:"\u30C9\u30E9\u30C3\u30B0\u30E2\u30FC\u30C9\u3092\u7121\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AD\u30AD\u30FC",enableSignDragModeAria:"\u77E2\u5370\u30AD\u30FC\u3067\u30AD\u30FC\u30DC\u30FC\u30C9\u30C9\u30E9\u30C3\u30B0\u30E2\u30FC\u30C9\u3092\u6709\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AD\u30AD\u30FC",disableSignDragModeAria:"\u77E2\u5370\u30AD\u30FC\u3067\u30AD\u30FC\u30DC\u30FC\u30C9\u30C9\u30E9\u30C3\u30B0\u30E2\u30FC\u30C9\u3092\u7121\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AD\u30AD\u30FC",enableSignResizeMode:"\u30B5\u30A4\u30BA\u5909\u66F4\u30E2\u30FC\u30C9\u3092\u6709\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AR\u30AD\u30FC",disableSignResizeMode:"\u30B5\u30A4\u30BA\u5909\u66F4\u30E2\u30FC\u30C9\u3092\u7121\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AR\u30AD\u30FC",enableSignResizeModeAria:"\u77E2\u5370\u30AD\u30FC\u3067\u30AD\u30FC\u30DC\u30FC\u30C9\u30B5\u30A4\u30BA\u5909\u66F4\u30E2\u30FC\u30C9\u3092\u6709\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AR\u30AD\u30FC",disableSignResizeModeAria:"\u77E2\u5370\u30AD\u30FC\u3067\u30AD\u30FC\u30DC\u30FC\u30C9\u30B5\u30A4\u30BA\u5909\u66F4\u30E2\u30FC\u30C9\u3092\u7121\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AR\u30AD\u30FC",resizeHandle:"{direction}\u30B3\u30FC\u30CA\u30FC\u306E\u30B5\u30A4\u30BA\u5909\u66F4",moreOptions:"\u305D\u306E\u4ED6\u306E\u30AA\u30D7\u30B7\u30E7\u30F3",noMoreOptions:"\u8FFD\u52A0\u306E\u30AA\u30D7\u30B7\u30E7\u30F3\u306F\u3042\u308A\u307E\u305B\u3093"},captions:{off:"\u30AA\u30D5",select:"\u5B57\u5E55\u3092\u9078\u629E",fontSize:"\u30D5\u30A9\u30F3\u30C8\u30B5\u30A4\u30BA",fontFamily:"\u30D5\u30A9\u30F3\u30C8",color:"\u30C6\u30AD\u30B9\u30C8\u306E\u8272",backgroundColor:"\u80CC\u666F\u8272",opacity:"\u4E0D\u900F\u660E\u5EA6"},fontSizes:{small:"\u5C0F",normal:"\u6A19\u6E96",large:"\u5927",xlarge:"\u7279\u5927"},fontFamilies:{sansSerif:"\u30B5\u30F3\u30BB\u30EA\u30D5",serif:"\u30BB\u30EA\u30D5",monospace:"\u7B49\u5E45"},styleLabels:{textColor:"\u30C6\u30AD\u30B9\u30C8\u306E\u8272",background:"\u80CC\u666F",font:"\u30D5\u30A9\u30F3\u30C8",fontSize:"\u30D5\u30A9\u30F3\u30C8\u30B5\u30A4\u30BA",opacity:"\u4E0D\u900F\u660E\u5EA6"},audioDescription:{enable:"\u97F3\u58F0\u89E3\u8AAC\u3092\u6709\u52B9\u306B\u3059\u308B",disable:"\u97F3\u58F0\u89E3\u8AAC\u3092\u7121\u52B9\u306B\u3059\u308B"},signLanguage:{show:"\u624B\u8A71\u52D5\u753B\u3092\u8868\u793A",hide:"\u624B\u8A71\u52D5\u753B\u3092\u975E\u8868\u793A"},transcript:{title:"\u6587\u5B57\u8D77\u3053\u3057",close:"\u6587\u5B57\u8D77\u3053\u3057\u3092\u9589\u3058\u308B",loading:"\u6587\u5B57\u8D77\u3053\u3057\u3092\u8AAD\u307F\u8FBC\u307F\u4E2D...",noTranscript:"\u3053\u306E\u30D3\u30C7\u30AA\u306E\u6587\u5B57\u8D77\u3053\u3057\u306F\u3042\u308A\u307E\u305B\u3093\u3002",settings:"\u6587\u5B57\u8D77\u3053\u3057\u8A2D\u5B9A\u3002Enter\u30AD\u30FC\u3067\u30E1\u30CB\u30E5\u30FC\u3092\u958B\u304F\u3001\u307E\u305F\u306FD\u30AD\u30FC\u3067\u30C9\u30E9\u30C3\u30B0\u30E2\u30FC\u30C9\u3092\u6709\u52B9\u306B\u3059\u308B",keyboardDragMode:"\u77E2\u5370\u30AD\u30FC\u3067\u30AD\u30FC\u30DC\u30FC\u30C9\u30C9\u30E9\u30C3\u30B0\u30E2\u30FC\u30C9\u3092\u5207\u308A\u66FF\u3048\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AD\u30AD\u30FC",keyboardDragActive:"\u2328\uFE0F \u30AD\u30FC\u30DC\u30FC\u30C9\u30C9\u30E9\u30C3\u30B0\u30E2\u30FC\u30C9\u6709\u52B9\uFF08\u77E2\u5370\u30AD\u30FC\u3067\u79FB\u52D5\u3001Shift+\u77E2\u5370\u30AD\u30FC\u3067\u5927\u304D\u304F\u79FB\u52D5\u3001D\u307E\u305F\u306FESC\u3067\u7D42\u4E86\uFF09",dragResizePrompt:"D\u30AD\u30FC\u3067\u79FB\u52D5\u3001R\u30AD\u30FC\u3067\u30B5\u30A4\u30BA\u5909\u66F4\u3002Home\u3067\u4F4D\u7F6E\u3092\u30EA\u30BB\u30C3\u30C8\u3001Esc\u3067\u9589\u3058\u307E\u3059\u3002",dragModeEnabled:"\u30AD\u30FC\u30DC\u30FC\u30C9\u30C9\u30E9\u30C3\u30B0\u30E2\u30FC\u30C9\u3092\u6709\u52B9\u306B\u3057\u307E\u3057\u305F\u3002\u77E2\u5370\u30AD\u30FC\u3067\u79FB\u52D5\u3001Shift+\u77E2\u5370\u30AD\u30FC\u3067\u5927\u304D\u304F\u79FB\u52D5\u3067\u304D\u307E\u3059\u3002\u7D42\u4E86\u3059\u308B\u306B\u306F D \u307E\u305F\u306F Esc \u3092\u62BC\u3057\u307E\u3059\u3002",dragModeDisabled:"\u30AD\u30FC\u30DC\u30FC\u30C9\u30C9\u30E9\u30C3\u30B0\u30E2\u30FC\u30C9\u3092\u7121\u52B9\u306B\u3057\u307E\u3057\u305F\u3002",enableDragMode:"\u30C9\u30E9\u30C3\u30B0\u30E2\u30FC\u30C9\u3092\u6709\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AD\u30AD\u30FC",disableDragMode:"\u30C9\u30E9\u30C3\u30B0\u30E2\u30FC\u30C9\u3092\u7121\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AD\u30AD\u30FC",enableDragModeAria:"\u77E2\u5370\u30AD\u30FC\u3067\u30AD\u30FC\u30DC\u30FC\u30C9\u30C9\u30E9\u30C3\u30B0\u30E2\u30FC\u30C9\u3092\u6709\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AD\u30AD\u30FC",disableDragModeAria:"\u77E2\u5370\u30AD\u30FC\u3067\u30AD\u30FC\u30DC\u30FC\u30C9\u30C9\u30E9\u30C3\u30B0\u30E2\u30FC\u30C9\u3092\u7121\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AD\u30AD\u30FC",resizeWindow:"\u30A6\u30A3\u30F3\u30C9\u30A6\u306E\u30B5\u30A4\u30BA\u5909\u66F4",disableResizeWindow:"\u30B5\u30A4\u30BA\u5909\u66F4\u30E2\u30FC\u30C9\u3092\u7121\u52B9\u306B\u3059\u308B",enableResizeMode:"\u30B5\u30A4\u30BA\u5909\u66F4\u30E2\u30FC\u30C9\u3092\u6709\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AR\u30AD\u30FC",disableResizeMode:"\u30B5\u30A4\u30BA\u5909\u66F4\u30E2\u30FC\u30C9\u3092\u7121\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AR\u30AD\u30FC",enableResizeModeAria:"\u77E2\u5370\u30AD\u30FC\u3067\u30AD\u30FC\u30DC\u30FC\u30C9\u30B5\u30A4\u30BA\u5909\u66F4\u30E2\u30FC\u30C9\u3092\u6709\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AR\u30AD\u30FC",disableResizeModeAria:"\u77E2\u5370\u30AD\u30FC\u3067\u30AD\u30FC\u30DC\u30FC\u30C9\u30B5\u30A4\u30BA\u5909\u66F4\u30E2\u30FC\u30C9\u3092\u7121\u52B9\u306B\u3059\u308B\u3002\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\uFF1AR\u30AD\u30FC",resizeModeHint:"\u30EA\u30B5\u30A4\u30BA\u30CF\u30F3\u30C9\u30EB\u304C\u6709\u52B9\u306B\u306A\u308A\u307E\u3057\u305F\u3002\u8FBA\u3084\u89D2\u3092\u30C9\u30E9\u30C3\u30B0\u3057\u3066\u8ABF\u6574\u3057\u307E\u3059\u3002Esc \u307E\u305F\u306F R \u3067\u7D42\u4E86\u3057\u307E\u3059\u3002",resizeModeEnabled:"\u30B5\u30A4\u30BA\u5909\u66F4\u30E2\u30FC\u30C9\u3092\u6709\u52B9\u306B\u3057\u307E\u3057\u305F\u3002\u8FBA\u3084\u89D2\u3092\u30C9\u30E9\u30C3\u30B0\u3057\u3066\u8ABF\u6574\u3057\u307E\u3059\u3002Esc \u307E\u305F\u306F R \u3067\u7D42\u4E86\u3057\u307E\u3059\u3002",resizeModeDisabled:"\u30B5\u30A4\u30BA\u5909\u66F4\u30E2\u30FC\u30C9\u3092\u7121\u52B9\u306B\u3057\u307E\u3057\u305F\u3002",positionReset:"\u6587\u5B57\u8D77\u3053\u3057\u306E\u4F4D\u7F6E\u3092\u30EA\u30BB\u30C3\u30C8\u3057\u307E\u3057\u305F\u3002",styleTranscript:"\u6587\u5B57\u8D77\u3053\u3057\u30B9\u30BF\u30A4\u30EB\u8A2D\u5B9A\u3092\u958B\u304F",closeMenu:"\u30E1\u30CB\u30E5\u30FC\u3092\u9589\u3058\u308B",styleTitle:"\u6587\u5B57\u8D77\u3053\u3057\u30B9\u30BF\u30A4\u30EB",autoscroll:"\u81EA\u52D5\u30B9\u30AF\u30ED\u30FC\u30EB",settingsMenu:"\u6587\u5B57\u8D77\u3053\u3057\u30C0\u30A4\u30A2\u30ED\u30B0\u8A2D\u5B9A",showTimestamps:"\u30BF\u30A4\u30E0\u30B9\u30BF\u30F3\u30D7\u3092\u8868\u793A",hideTimestamps:"\u30BF\u30A4\u30E0\u30B9\u30BF\u30F3\u30D7\u3092\u975E\u8868\u793A",showTimestampsAria:"\u6587\u5B57\u8D77\u3053\u3057\u306B\u30BF\u30A4\u30E0\u30B9\u30BF\u30F3\u30D7\u3092\u8868\u793A",hideTimestampsAria:"\u6587\u5B57\u8D77\u3053\u3057\u306E\u30BF\u30A4\u30E0\u30B9\u30BF\u30F3\u30D7\u3092\u975E\u8868\u793A"},settings:{title:"\u8A2D\u5B9A",quality:"\u753B\u8CEA",speed:"\u901F\u5EA6",captions:"\u5B57\u5E55",language:"\u8A00\u8A9E",reset:"\u30EA\u30BB\u30C3\u30C8",close:"\u9589\u3058\u308B"},speeds:{normal:"\u901A\u5E38"},time:{display:"\u6642\u9593\u8868\u793A",durationPrefix:"\u518D\u751F\u6642\u9593: ",of:"/",hour:"{count}\u6642\u9593",hours:"{count}\u6642\u9593",minute:"{count}\u5206",minutes:"{count}\u5206",second:"{count}\u79D2",seconds:"{count}\u79D2"},playlist:{title:"\u30D7\u30EC\u30A4\u30EA\u30B9\u30C8",trackOf:"\u30C8\u30E9\u30C3\u30AF {current}/{total}",nowPlaying:"\u518D\u751F\u4E2D: \u30C8\u30E9\u30C3\u30AF {current}/{total}. {title}{artist}",by:" - ",untitled:"\u30BF\u30A4\u30C8\u30EB\u306A\u3057",trackUntitled:"\u30C8\u30E9\u30C3\u30AF {number}",currentlyPlaying:"\u518D\u751F\u4E2D",notPlaying:"\u505C\u6B62\u4E2D",pressEnterPlay:"Enter\u30AD\u30FC\u3067\u518D\u751F",pressEnterRestart:"Enter\u30AD\u30FC\u3067\u6700\u521D\u304B\u3089\u518D\u751F"}};function ie(){return{en:oe,de:le,es:ce,fr:de,ja:ue}}var Fe=ie();var se=class{constructor(){this.currentLanguage="en",this.translations=ie(),this.loadingPromises=new Map}setLanguage(e){this.translations[e]?this.currentLanguage=e:(console.warn(`Language "${e}" not found, falling back to English`),this.currentLanguage="en")}getLanguage(){return this.currentLanguage}t(e,t={}){let i=e.split("."),s=this.translations[this.currentLanguage];for(let a of i)if(s&&typeof s=="object"&&a in s)s=s[a];else{s=this.translations.en;for(let r of i)if(s&&typeof s=="object"&&r in s)s=s[r];else return e;break}return typeof s=="string"&&Object.entries(t).forEach(([a,r])=>{s=s.replace(new RegExp(`{${a}}`,"g"),r)}),s}addTranslation(e,t){this.translations[e]||(this.translations[e]={}),Object.assign(this.translations[e],t)}async loadLanguageFromUrl(e,t){if(this.loadingPromises.has(t))return this.loadingPromises.get(t);let i=(async()=>{try{let s=await fetch(t);if(!s.ok)throw new Error(`Failed to load language file: ${s.statusText}`);let a=s.headers.get("content-type")||"",r;if(a.includes("application/json")||t.endsWith(".json"))r=await s.json();else if(a.includes("text/yaml")||a.includes("application/x-yaml")||t.endsWith(".yaml")||t.endsWith(".yml")){let l=await s.text();try{r=JSON.parse(l)}catch{if(typeof window<"u"&&window.jsyaml)r=window.jsyaml.load(l);else throw console.warn("YAML parsing requires js-yaml library. Please include it or use JSON format."),new Error("YAML parsing not available. Please use JSON format or include js-yaml library.")}}else r=await s.json();return this.addTranslation(e,r),r}catch(s){throw console.error(`Error loading language file from ${t}:`,s),s}finally{this.loadingPromises.delete(t)}})();return this.loadingPromises.set(t,i),i}async loadLanguagesFromUrls(e){let t=Object.entries(e).map(([i,s])=>this.loadLanguageFromUrl(i,s));await Promise.all(t)}},h=new se;var x={formatTime(p,e=!1){if(!isFinite(p)||p<0)return e?"00:00:00":"00:00";let t=Math.floor(p/3600),i=Math.floor(p%3600/60),s=Math.floor(p%60),a=r=>String(r).padStart(2,"0");return t>0||e?`${a(t)}:${a(i)}:${a(s)}`:`${a(i)}:${a(s)}`},parseTime(p){let e=p.split(":").map(t=>parseInt(t,10));return e.length===3?e[0]*3600+e[1]*60+e[2]:e.length===2?e[0]*60+e[1]:e.length===1?e[0]:0},formatDuration(p){if(!isFinite(p)||p<0)return h.t("time.seconds",{count:0});let e=Math.floor(p/3600),t=Math.floor(p%3600/60),i=Math.floor(p%60),s=[];if(e>0){let a=e===1?"time.hour":"time.hours";s.push(h.t(a,{count:e}))}if(t>0){let a=t===1?"time.minute":"time.minutes";s.push(h.t(a,{count:t}))}if(i>0||s.length===0){let a=i===1?"time.second":"time.seconds";s.push(h.t(a,{count:i}))}return s.join(", ")},formatPercentage(p,e){return e===0?0:Math.round(p/e*100)}};var Me={play:'<path d="M8 5v14l11-7z"/>',pause:'<path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>',stop:'<rect x="6" y="6" width="12" height="12"/>',rewind:'<path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/>',forward:'<path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"/>',skipPrevious:'<path d="M6 6h2v12H6V6zm3 6l8.5 6V6L9 12z"/>',skipNext:'<path d="M16 6h2v12h-2V6zM6 6l8.5 6L6 18V6z"/>',restart:'<path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>',volumeHigh:'<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>',volumeMedium:'<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>',volumeLow:'<path d="M7 9v6h4l5 5V4l-5 5H7z"/>',volumeMuted:'<path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>',fullscreen:'<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>',fullscreenExit:'<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>',settings:'<path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94L14.4 2.81c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>',captions:'<path d="M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 7H9.5v-.5h-2v3h2V13H11v1c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1zm7 0h-1.5v-.5h-2v3h2V13H18v1c0 .55-.45 1-1 1h-3c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1z"/>',captionsOff:'<path d="M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 7H9.5v-.5h-2v3h2V13H11v1c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1zm7 0h-1.5v-.5h-2v3h2V13H18v1c0 .55-.45 1-1 1h-3c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1z"/><path d="M0 0h24v24H0z" fill="none"/>',pip:'<path d="M19 7h-8v6h8V7zm2-4H3c-1.1 0-2 .9-2 2v14c0 1.1.9 1.98 2 1.98h18c1.1 0 2-.88 2-1.98V5c0-1.1-.9-2-2-2zm0 16.01H3V4.98h18v14.03z"/>',speed:'<path d="M20.38 8.57l-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44z"/><path d="M10.59 15.41a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83z"/>',close:'<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>',check:'<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>',arrowUp:'<path d="M7 14l5-5 5 5z"/>',arrowDown:'<path d="M7 10l5 5 5-5z"/>',arrowLeft:'<path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>',arrowRight:'<path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>',loading:'<path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>',error:'<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>',download:'<path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>',link:'<path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>',playlist:'<path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/>',language:'<path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56zm2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z"/>',hd:'<path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-8 12H9.5v-2h-2v2H6V9h1.5v2.5h2V9H11v6zm7-1c0 .55-.45 1-1 1h-.75v1.5h-1.5V15H14c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v4zm-3.5-.5h2v-3h-2v3z"/>',transcript:'<path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>',chapters:'<path d="M3 5h2v2H3V5zm0 4h2v2H3V9zm0 4h2v2H3v-2zm0 4h2v2H3v-2zM7 5h14v2H7V5zm0 4h14v2H7V9zm0 4h14v2H7v-2zm0 4h14v2H7v-2z"/>',audioDescription:'<rect x="2" y="5" width="20" height="14" rx="2" fill="#ffffff" stroke="#ffffff" stroke-width="2"/><text x="12" y="16" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#1a1a1a">AD</text>',audioDescriptionOn:'<rect x="2" y="5" width="20" height="14" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><text x="12" y="16" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="currentColor">AD</text>',signLanguage:'<g transform="scale(1.5)"><path d="M16 11.3c-.1-.9-4.8 1.3-5.4 1.1-2.6-1 5.8-1.3 5.1-2.9s-5.1 1.5-6 1.4C6.5 9.4 16.5 9.1 13.5 8c-1.9-.6-8.8 2.9-6.8.4.7-.6.7-1.9-.7-1.7-9.7 7.2-.7 12.2 8.8 7 0-1.3-3.5.4-4.1.4-2.6 0 5.6-2 5.4-3ZM3.9 7.8c3.2-4.2 3.7 1.2 6 .1s.2-.2.2-.3c.7-2.7 2.5-7.5-1.5-1.3-1.6 0 1.1-4 1-4.6C8.9-1 7.3 4.4 7.2 4.9c-1.6.7-.9-1.4-.7-1.5 3-6-.6-3.1-.9.4-2.5 1.8 0-2.8 0-3.5C2.8-.9 4 9.4 1.1 4.9S.1 4.6 0 5c-.4 2.7 2.6 7.2 3.9 2.8Z"/></g>',signLanguageOn:'<g transform="scale(1.5)"><path d="M16 11.3c-.1-.9-4.8 1.3-5.4 1.1-2.6-1 5.8-1.3 5.1-2.9s-5.1 1.5-6 1.4C6.5 9.4 16.5 9.1 13.5 8c-1.9-.6-8.8 2.9-6.8.4.7-.6.7-1.9-.7-1.7-9.7 7.2-.7 12.2 8.8 7 0-1.3-3.5.4-4.1.4-2.6 0 5.6-2 5.4-3ZM3.9 7.8c3.2-4.2 3.7 1.2 6 .1s.2-.2.2-.3c.7-2.7 2.5-7.5-1.5-1.3-1.6 0 1.1-4 1-4.6C8.9-1 7.3 4.4 7.2 4.9c-1.6.7-.9-1.4-.7-1.5 3-6-.6-3.1-.9.4-2.5 1.8 0-2.8 0-3.5C2.8-.9 4 9.4 1.1 4.9S.1 4.6 0 5c-.4 2.7 2.6 7.2 3.9 2.8Z"/></g>',speaker:'<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>',music:'<path d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7zm-1.5 16c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>',moreVertical:'<path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>',moreHorizontal:'<path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>',move:'<path d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"/>',resize:'<path d="M21.71 11.29l-9-9c-.39-.39-1.02-.39-1.41 0l-9 9c-.39.39-.39 1.02 0 1.41l9 9c.39.39 1.02.39 1.41 0l9-9c.39-.38.39-1.01 0-1.41zM14 14.5V12h-4v2.5L7 11l3-3.5V10h4V7.5l3 3.5-3 3.5z"/>',clock:'<path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/><path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>'},Se=p=>`<svg viewBox="0 0 24 24" fill="currentColor">${p}</svg>`,he=Object.fromEntries(Object.entries(Me).map(([p,e])=>[p,Se(e)]));function ke(p){return he[p]||he.play}function k(p,e=""){let t=document.createElement("span");return t.className=`vidply-icon ${e}`.trim(),t.innerHTML=ke(p),t.setAttribute("aria-hidden","true"),t}function pe(){let p=document.createElementNS("http://www.w3.org/2000/svg","svg");p.setAttribute("class","vidply-play-overlay"),p.setAttribute("viewBox","0 0 80 80"),p.setAttribute("width","80"),p.setAttribute("height","80"),p.setAttribute("aria-hidden","true"),p.setAttribute("role","presentation"),p.style.cursor="pointer";let e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t=`vidply-play-shadow-${Math.random().toString(36).substr(2,9)}`,i=document.createElementNS("http://www.w3.org/2000/svg","filter");i.setAttribute("id",t),i.setAttribute("x","-50%"),i.setAttribute("y","-50%"),i.setAttribute("width","200%"),i.setAttribute("height","200%");let s=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");s.setAttribute("in","SourceAlpha"),s.setAttribute("stdDeviation","3");let a=document.createElementNS("http://www.w3.org/2000/svg","feOffset");a.setAttribute("dx","0"),a.setAttribute("dy","2"),a.setAttribute("result","offsetblur");let r=document.createElementNS("http://www.w3.org/2000/svg","feComponentTransfer"),l=document.createElementNS("http://www.w3.org/2000/svg","feFuncA");l.setAttribute("type","linear"),l.setAttribute("slope","0.3"),r.appendChild(l);let c=document.createElementNS("http://www.w3.org/2000/svg","feMerge"),o=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode"),n=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");n.setAttribute("in","SourceGraphic"),c.appendChild(o),c.appendChild(n),i.appendChild(s),i.appendChild(a),i.appendChild(r),i.appendChild(c),e.appendChild(i),p.appendChild(e);let d=document.createElementNS("http://www.w3.org/2000/svg","circle");d.setAttribute("cx","40"),d.setAttribute("cy","40"),d.setAttribute("r","40"),d.setAttribute("fill","rgba(255, 255, 255, 0.95)"),d.setAttribute("filter",`url(#${t})`),d.setAttribute("class","vidply-play-overlay-bg"),p.appendChild(d);let m=document.createElementNS("http://www.w3.org/2000/svg","polygon");return m.setAttribute("points","32,28 32,52 54,40"),m.setAttribute("fill","#0a406e"),m.setAttribute("class","vidply-play-overlay-icon"),p.appendChild(m),p}function R(p,{delay:e=0,preventScroll:t=!0}={}){p&&requestAnimationFrame(()=>{setTimeout(()=>{p&&document.contains(p)&&p.focus({preventScroll:t})},e)})}function ge(p,e,t={}){if(!p)return;let i=p.querySelector(e);i&&R(i,t)}var Q=class{constructor(e){this.player=e,this.element=null,this.controls={},this.hideTimeout=null,this.isDraggingProgress=!1,this.isDraggingVolume=!1,this.openMenu=null,this.openMenuButton=null,this.init()}init(){this.createElement(),this.createControls(),this.attachEvents(),this.setupAutoHide(),this.setupOverflowDetection()}isMobile(){return window.innerWidth<768}isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}positionMenu(e,t,i=!1){let s=this.isMobile(),a=e.classList.contains(`${this.player.options.classPrefix}-overflow-menu-list`);if(this.player.state.fullscreen&&e.parentElement===this.player.container){let c=()=>{let o=t.getBoundingClientRect(),n=e.getBoundingClientRect(),d=this.player.container.getBoundingClientRect(),m=window.innerHeight,g=o.left+o.width/2-d.left,f=o.top-d.top,b=o.bottom-d.top,S=o.top-d.top,y=d.bottom-o.bottom;if(S>=n.height+20||S>y?(e.style.bottom=`${d.height-f+8}px`,e.style.top="auto",e.classList.remove("vidply-menu-below")):(e.style.top=`${b+8}px`,e.style.bottom="auto",e.classList.add("vidply-menu-below")),a){let v=o.right-d.left;e.style.right=`${d.width-v}px`,e.style.left="auto",e.style.transform="none"}else e.style.left=`${g}px`,e.style.right="auto",e.style.transform="translateX(-50%)"};i?c():requestAnimationFrame(c);return}if(s){let c=e.classList.contains(`${this.player.options.classPrefix}-volume-menu`),o=()=>{let n=t.parentElement;if(!n)return;let d=t.getBoundingClientRect(),m=n.getBoundingClientRect(),g=e.getBoundingClientRect(),f=window.innerWidth,b=window.innerHeight;if(c){let S=d.left+d.width/2-m.left;e.style.left=`${S}px`,e.style.right="auto",e.style.transform="translateX(-50%)";return}g.right>f&&(e.style.left="auto",e.style.right="10px",e.style.transform="none"),g.left<0&&(e.style.left="10px",e.style.right="auto",e.style.transform="none"),g.top<10&&(e.style.top="10px"),g.bottom>b-10&&(e.style.bottom="10px",e.style.top="auto")};i?o():requestAnimationFrame(o);return}let l=()=>{let c=t.getBoundingClientRect(),o=e.getBoundingClientRect(),n=window.innerWidth,d=window.innerHeight,m=t.parentElement;if(!m)return;let g=m.getBoundingClientRect(),f=c.left+c.width/2-g.left,b=c.bottom-g.top,S=c.top-g.top,y=c.top,v=d-c.bottom,E=S-o.height-8,M=null;y<o.height+20&&v>y?(E=null,M=g.bottom-g.top-b+8,e.classList.add("vidply-menu-below")):e.classList.remove("vidply-menu-below");let w="auto",T="auto",L="translateX(0)";if(a)w="auto",T=0,L="translateX(0)";else{w=f-o.width/2;let P=c.left+c.width/2-o.width/2;P<10?(w=0,L="translateX(0)"):P+o.width>n-10?(w="auto",T=0,L="translateX(0)"):(w=f,L="translateX(-50%)")}E!==null?(e.style.top=`${E}px`,e.style.bottom="auto"):M!==null&&(e.style.top="auto",e.style.bottom=`${M}px`),w!=="auto"?(e.style.left=`${w}px`,e.style.right="auto"):(e.style.left="auto",e.style.right=`${T}px`),e.style.transform=L};i?l():requestAnimationFrame(()=>{setTimeout(l,10)})}insertMenuIntoDOM(e,t){e.id||(e.id=`vidply-menu-${Math.random().toString(36).substr(2,9)}`),t.setAttribute("aria-controls",e.id),t.setAttribute("aria-haspopup","true"),this.player.state.fullscreen?(this.player.container.appendChild(e),e.dataset.triggerButton=t.getAttribute("aria-label")||"button"):t.insertAdjacentElement("afterend",e)}attachMenuCloseHandler(e,t,i=!1){this.openMenu&&this.openMenu!==e&&this.openMenuButton&&(this.openMenuButton._vidplyBlurHandler&&(this.openMenuButton.removeEventListener("blur",this.openMenuButton._vidplyBlurHandler),delete this.openMenuButton._vidplyBlurHandler),this.openMenuButton._vidplyMousedownHandler&&(this.openMenuButton.removeEventListener("mousedown",this.openMenuButton._vidplyMousedownHandler),delete this.openMenuButton._vidplyMousedownHandler),this.openMenu&&document.contains(this.openMenu)?this.openMenu.remove():this.openMenu&&this.openMenu.parentNode&&this.openMenu.parentNode.removeChild(this.openMenu),this.openMenuButton&&this.openMenuButton.setAttribute("aria-expanded","false")),this.openMenu=e,this.openMenuButton=t,this.positionMenu(e,t),t&&t.setAttribute("aria-expanded","true");let s=!1,a=!0,r=()=>{s=!0,a=!1,setTimeout(()=>{s=!1,a=!0},200)};t.addEventListener("mousedown",r),t._vidplyMousedownHandler=r;let l=d=>{if(!a||s||this.openMenu!==e)return;let m=d.relatedTarget;requestAnimationFrame(()=>{setTimeout(()=>{var E;if(!a||this.openMenu!==e)return;let g=document.activeElement;if(e.contains(g))return;let f=this.player.signLanguageWrapper,b=(E=this.player.transcriptManager)==null?void 0:E.transcriptWindow;if(f&&f.contains(g)||b&&b.contains(g))return;let S=this.element.querySelectorAll("button"),y=Array.from(S).includes(g)&&g!==t,v=m&&Array.from(S).includes(m)&&m!==t;if(y||v){if(this.openMenu!==e)return;e&&document.contains(e)?e.remove():e&&e.parentNode&&e.parentNode.removeChild(e),t&&t.setAttribute("aria-expanded","false"),this.openMenu===e&&(this.openMenu=null,this.openMenuButton=null),t.removeEventListener("blur",l),t.removeEventListener("mousedown",r),delete t._vidplyBlurHandler,delete t._vidplyMousedownHandler}},10)})};t.addEventListener("blur",l),t._vidplyBlurHandler=l;let c=()=>{this.closeMenuAndReturnFocus(e,t)},o=null,n=null;setTimeout(()=>{o=d=>{i&&e.contains(d.target)||this.openMenu===e&&!e.contains(d.target)&&!t.contains(d.target)&&(c(),o&&document.removeEventListener("click",o),n&&document.removeEventListener("keydown",n))},n=d=>{d.key==="Escape"&&this.openMenu===e&&(d.preventDefault(),d.stopPropagation(),this.closeMenuAndReturnFocus(e,t,!0),o&&document.removeEventListener("click",o),n&&document.removeEventListener("keydown",n))},document.addEventListener("click",o),document.addEventListener("keydown",n)},100)}closeMenuAndReturnFocus(e,t,i=!0){e&&(document.contains(e)?e.remove():e.parentNode&&e.parentNode.removeChild(e)),t&&(t.setAttribute("aria-expanded","false"),e&&e.id&&t.removeAttribute("aria-controls"),i&&requestAnimationFrame(()=>{setTimeout(()=>{t&&document.contains(t)&&t.focus({preventScroll:!0})},0)})),this.openMenu===e&&(this.openMenu=null,this.openMenuButton=null)}closeOpenMenu(){this.openMenu&&this.openMenuButton&&(this.openMenu&&document.contains(this.openMenu)?this.openMenu.remove():this.openMenu&&this.openMenu.parentNode&&this.openMenu.parentNode.removeChild(this.openMenu),this.openMenuButton&&this.openMenuButton.setAttribute("aria-expanded","false"),this.openMenu=null,this.openMenuButton=null)}attachMenuKeyboardNavigation(e,t){let i=Array.from(e.querySelectorAll(`.${this.player.options.classPrefix}-menu-item`));if(i.length===0)return;let s=a=>{let r=i.indexOf(document.activeElement);switch(a.key){case"ArrowDown":a.preventDefault(),a.stopPropagation();let l=(r+1)%i.length;i[l].focus({preventScroll:!0});break;case"ArrowUp":a.preventDefault(),a.stopPropagation();let c=(r-1+i.length)%i.length;i[c].focus({preventScroll:!0});break;case"ArrowLeft":case"ArrowRight":a.preventDefault(),a.stopPropagation();break;case"Home":a.preventDefault(),a.stopPropagation(),i[0].focus({preventScroll:!0});break;case"End":a.preventDefault(),a.stopPropagation(),i[i.length-1].focus({preventScroll:!0});break;case"Enter":case" ":a.preventDefault(),a.stopPropagation(),document.activeElement&&i.includes(document.activeElement)&&(document.activeElement.click(),R(t,{delay:0}));break;case"Escape":a.preventDefault(),a.stopPropagation(),this.closeMenuAndReturnFocus(e,t,!0);break}};e.addEventListener("keydown",s)}createElement(){this.element=u.createElement("div",{className:`${this.player.options.classPrefix}-controls`,attributes:{role:"region","aria-label":h.t("player.label")+" controls"}})}createControls(){let e=u.createElement("div",{className:`${this.player.options.classPrefix}-progress-time-wrapper`});this.player.options.progressBar&&(this.createProgressBar(),e.appendChild(this.controls.progress)),(this.player.options.currentTime||this.player.options.duration)&&e.appendChild(this.createTimeDisplay()),this.element.appendChild(e);let t=u.createElement("div",{className:`${this.player.options.classPrefix}-controls-buttons`}),i=u.createElement("div",{className:`${this.player.options.classPrefix}-controls-left`});this.player.playlistManager&&i.appendChild(this.createPreviousButton()),this.player.options.playPauseButton&&i.appendChild(this.createPlayPauseButton()),i.appendChild(this.createRestartButton()),this.player.playlistManager&&i.appendChild(this.createNextButton()),this.player.playlistManager||i.appendChild(this.createRewindButton()),this.player.playlistManager||i.appendChild(this.createForwardButton()),this.player.options.volumeControl&&(this.isTouchDevice()?i.appendChild(this.createMuteButton()):i.appendChild(this.createVolumeControl())),this.rightButtons=u.createElement("div",{className:`${this.player.options.classPrefix}-controls-right`});let s=this.hasChapterTracks(),a=this.hasCaptionTracks(),r=this.hasQualityLevels(),l=this.hasAudioDescription();if(this.player.options.chaptersButton&&s){let n=this.createChaptersButton();n.dataset.overflowPriority="3",n.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(n)}if(this.player.options.captionsButton&&a){let n=this.createCaptionsButton();n.dataset.overflowPriority="1",n.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(n)}if(this.player.options.captionStyleButton&&a){let n=this.createCaptionStyleButton();n.dataset.overflowPriority="3",n.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(n)}if(this.player.options.speedButton){let n=this.createSpeedButton();n.dataset.overflowPriority="1",n.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(n)}if(this.player.options.audioDescriptionButton&&l){let n=this.createAudioDescriptionButton();n.dataset.overflowPriority="2",n.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(n)}if(this.player.options.transcriptButton&&a){let n=this.createTranscriptButton();n.dataset.overflowPriority="3",n.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(n)}if(this.player.playlistManager&&this.player.options.playlistToggleButton!==!1){let n=this.createPlaylistToggleButton();n.dataset.overflowPriority="2",n.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(n)}let c=this.hasSignLanguage();if(this.player.options.signLanguageButton&&c){let n=this.createSignLanguageButton();n.dataset.overflowPriority="3",n.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(n)}if(this.player.options.qualityButton&&r){let n=this.createQualityButton();n.dataset.overflowPriority="2",n.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(n)}if(this.player.options.pipButton&&"pictureInPictureEnabled"in document){let n=this.createPipButton();n.dataset.overflowPriority="3",n.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(n)}let o=this.player.element.tagName.toLowerCase()==="audio";if(this.player.options.fullscreenButton&&!o){let n=this.createFullscreenButton();n.dataset.overflowPriority="1",n.dataset.overflowPriorityMobile="3",this.rightButtons.appendChild(n)}this.overflowMenuButton=this.createOverflowMenuButton(),this.overflowMenuButton.style.display="none",this.rightButtons.appendChild(this.overflowMenuButton),t.appendChild(i),t.appendChild(this.rightButtons),this.element.appendChild(t),this.ensureButtonTitles(t)}ensureButtonTitles(e){e.querySelectorAll("button").forEach(i=>{if(!i.hasAttribute("title")){let s=i.getAttribute("aria-label");s&&i.setAttribute("title",s)}})}hasChapterTracks(){let e=this.player.element.textTracks;for(let t=0;t<e.length;t++)if(e[t].kind==="chapters")return!0;return!1}hasCaptionTracks(){let e=this.player.element.textTracks;for(let t=0;t<e.length;t++)if(e[t].kind==="captions"||e[t].kind==="subtitles")return!0;return!1}hasQualityLevels(){if(this.player.renderer&&this.player.renderer.getQualities){let e=this.player.renderer.getQualities();return e&&e.length>1}return!1}hasAudioDescription(){return this.player.audioDescriptionSrc&&this.player.audioDescriptionSrc.length>0?!0:Array.from(this.player.element.textTracks||[]).some(t=>t.kind==="descriptions")}hasSignLanguage(){let e=this.player.signLanguageSrc&&this.player.signLanguageSrc.length>0,t=this.player.signLanguageSources&&Object.keys(this.player.signLanguageSources).length>0;return e||t}createProgressBar(){let e=u.createElement("div",{className:`${this.player.options.classPrefix}-progress-container`,attributes:{role:"slider","aria-label":h.t("player.progress"),"aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":"0",tabindex:"0"}});this.controls.buffered=u.createElement("div",{className:`${this.player.options.classPrefix}-progress-buffered`}),this.controls.played=u.createElement("div",{className:`${this.player.options.classPrefix}-progress-played`}),this.controls.progressHandle=u.createElement("div",{className:`${this.player.options.classPrefix}-progress-handle`}),this.controls.progressTooltip=u.createElement("div",{className:`${this.player.options.classPrefix}-progress-tooltip`}),e.appendChild(this.controls.buffered),e.appendChild(this.controls.played),this.controls.played.appendChild(this.controls.progressHandle),e.appendChild(this.controls.progressTooltip),this.controls.progress=e,this.setupProgressBarEvents()}setupProgressBarEvents(){let e=this.controls.progress,t=i=>{let s=e.getBoundingClientRect(),a=s.width>0?Math.max(0,Math.min(1,(i-s.left)/s.width)):0,r=this.player.state.duration||0,l=a*r;return{percent:a,time:l}};e.addEventListener("mousedown",i=>{this.isDraggingProgress=!0;let{time:s}=t(i.clientX);this.player.seek(s)}),document.addEventListener("mousemove",i=>{if(this.isDraggingProgress){let{time:s}=t(i.clientX);this.player.seek(s)}}),document.addEventListener("mouseup",()=>{this.isDraggingProgress=!1}),e.addEventListener("mousemove",i=>{if(!this.isDraggingProgress){let{time:s}=t(i.clientX);this.controls.progressTooltip.textContent=x.formatTime(s),this.controls.progressTooltip.setAttribute("aria-label",x.formatDuration(s)),this.controls.progressTooltip.style.left=`${i.clientX-e.getBoundingClientRect().left}px`,this.controls.progressTooltip.style.display="block"}}),e.addEventListener("mouseleave",()=>{this.controls.progressTooltip.style.display="none"}),e.addEventListener("keydown",i=>{i.key==="ArrowLeft"?(i.preventDefault(),this.player.seekBackward(5)):i.key==="ArrowRight"&&(i.preventDefault(),this.player.seekForward(5))}),e.addEventListener("touchstart",i=>{this.isDraggingProgress=!0;let s=i.touches[0],{time:a}=t(s.clientX);this.player.seek(a)}),e.addEventListener("touchmove",i=>{if(this.isDraggingProgress){i.preventDefault();let s=i.touches[0],{time:a}=t(s.clientX);this.player.seek(a)}}),e.addEventListener("touchend",()=>{this.isDraggingProgress=!1})}createPlayPauseButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-play-pause`,attributes:{type:"button","aria-label":h.t("player.play")}});return e.appendChild(k("play")),e.addEventListener("click",()=>{this.player.toggle()}),this.controls.playPause=e,e}createRestartButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-restart`,attributes:{type:"button","aria-label":h.t("player.restart")}});return e.appendChild(k("restart")),e.addEventListener("click",()=>{this.player.seek(0),this.player.play()}),e}createPreviousButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-previous`,attributes:{type:"button","aria-label":h.t("player.previous")}});e.appendChild(k("skipPrevious")),e.addEventListener("click",()=>{this.player.playlistManager&&this.player.playlistManager.previous()});let t=()=>{this.player.playlistManager&&(e.disabled=!this.player.playlistManager.hasPrevious()&&!this.player.playlistManager.options.loop)};return this.player.on("playlisttrackchange",t),t(),this.controls.previous=e,e}createNextButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-next`,attributes:{type:"button","aria-label":h.t("player.next")}});e.appendChild(k("skipNext")),e.addEventListener("click",()=>{this.player.playlistManager&&this.player.playlistManager.next()});let t=()=>{this.player.playlistManager&&(e.disabled=!this.player.playlistManager.hasNext()&&!this.player.playlistManager.options.loop)};return this.player.on("playlisttrackchange",t),t(),this.controls.next=e,e}createPlaylistToggleButton(){let e=this.player.playlistManager?`${this.player.playlistManager.uniqueId}-panel`:"vidply-playlist-panel",t=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-playlist-toggle`,attributes:{type:"button","aria-label":h.t("player.playlist"),"aria-expanded":"false","aria-pressed":"false","aria-controls":e}});return t.appendChild(k("playlist")),t.addEventListener("click",()=>{this.player.playlistManager&&this.player.playlistManager.togglePanel()}),this.controls.playlistToggle=t,t}createRewindButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-rewind`,attributes:{type:"button","aria-label":h.t("player.rewindSeconds",{seconds:15})}});return e.appendChild(k("rewind")),e.addEventListener("click",()=>{this.player.seekBackward(15)}),e}createForwardButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-forward`,attributes:{type:"button","aria-label":h.t("player.forwardSeconds",{seconds:15})}});return e.appendChild(k("forward")),e.addEventListener("click",()=>{this.player.seekForward(15)}),e}createMuteButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-mute`,attributes:{type:"button","aria-label":h.t("player.mute")}});return e.appendChild(k("volumeHigh")),e.addEventListener("click",()=>{this.player.toggleMute()}),this.controls.mute=e,e}createVolumeControl(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-mute`,attributes:{type:"button","aria-label":h.t("player.volume"),"aria-expanded":"false"}});return e.appendChild(k("volumeHigh")),e.addEventListener("contextmenu",t=>{t.preventDefault(),this.player.toggleMute()}),e.addEventListener("click",()=>{this.showVolumeSlider(e)}),this.controls.mute=e,e}showVolumeSlider(e){let t=document.querySelector(`.${this.player.options.classPrefix}-volume-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false");return}let i=u.createElement("div",{className:`${this.player.options.classPrefix}-volume-menu ${this.player.options.classPrefix}-menu`}),s=u.createElement("div",{className:`${this.player.options.classPrefix}-volume-slider`,attributes:{role:"slider","aria-label":h.t("player.volume"),"aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":String(Math.round(this.player.state.volume*100)),tabindex:"0"}}),a=u.createElement("div",{className:`${this.player.options.classPrefix}-volume-track`}),r=u.createElement("div",{className:`${this.player.options.classPrefix}-volume-fill`}),l=this.player.state.volume*100;r.style.height=`${l}%`;let c=u.createElement("div",{className:`${this.player.options.classPrefix}-volume-handle`});a.appendChild(r),r.appendChild(c),s.appendChild(a),i.appendChild(s);let o=n=>{let d=a.getBoundingClientRect(),m=Math.max(0,Math.min(1,1-(n-d.top)/d.height));this.player.setVolume(m)};s.addEventListener("mousedown",n=>{n.stopPropagation(),n.preventDefault(),this.isDraggingVolume=!0,o(n.clientY)}),document.addEventListener("mousemove",n=>{this.isDraggingVolume&&o(n.clientY)}),document.addEventListener("mouseup",()=>{this.isDraggingVolume=!1}),s.addEventListener("touchstart",n=>{n.stopPropagation(),n.preventDefault(),this.isDraggingVolume=!0;let d=n.touches[0];o(d.clientY)},{passive:!1}),s.addEventListener("touchmove",n=>{if(this.isDraggingVolume){n.preventDefault();let d=n.touches[0];o(d.clientY)}},{passive:!1}),s.addEventListener("touchend",n=>{n.stopPropagation(),n.preventDefault(),this.isDraggingVolume=!1},{passive:!1}),s.addEventListener("touchcancel",()=>{this.isDraggingVolume=!1}),s.addEventListener("keydown",n=>{n.key==="ArrowUp"?(n.preventDefault(),this.player.setVolume(Math.min(1,this.player.state.volume+.1))):n.key==="ArrowDown"?(n.preventDefault(),this.player.setVolume(Math.max(0,this.player.state.volume-.1))):n.key==="Escape"&&(n.preventDefault(),n.stopPropagation(),this.closeMenuAndReturnFocus(i,e,!0))}),i.addEventListener("click",n=>{n.stopPropagation()}),i.addEventListener("touchstart",n=>{n.stopPropagation()}),i.addEventListener("touchmove",n=>{n.stopPropagation()}),i.addEventListener("touchend",n=>{n.stopPropagation()}),i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.controls.volumeSlider=s,this.controls.volumeFill=r,R(s,{delay:50}),this.attachMenuCloseHandler(i,e,!0)}createTimeDisplay(){let e=u.createElement("div",{className:`${this.player.options.classPrefix}-time`,attributes:{role:"group","aria-label":h.t("time.display")}});this.controls.currentTimeDisplay=u.createElement("span",{className:`${this.player.options.classPrefix}-current-time`});let t=u.createElement("span",{textContent:"00:00",attributes:{"aria-hidden":"true"}}),i=u.createElement("span",{className:"vidply-sr-only",textContent:h.t("time.seconds",{count:0})});this.controls.currentTimeDisplay.appendChild(t),this.controls.currentTimeDisplay.appendChild(i),this.controls.currentTimeVisual=t,this.controls.currentTimeAccessible=i;let s=u.createElement("span",{textContent:" / ",attributes:{"aria-hidden":"true"}});this.controls.durationDisplay=u.createElement("span",{className:`${this.player.options.classPrefix}-duration`});let a=u.createElement("span",{textContent:"00:00",attributes:{"aria-hidden":"true"}}),r=u.createElement("span",{className:"vidply-sr-only",textContent:h.t("time.durationPrefix")+h.t("time.seconds",{count:0})});return this.controls.durationDisplay.appendChild(a),this.controls.durationDisplay.appendChild(r),this.controls.durationVisual=a,this.controls.durationAccessible=r,e.appendChild(this.controls.currentTimeDisplay),e.appendChild(s),e.appendChild(this.controls.durationDisplay),e}createChaptersButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-chapters`,attributes:{type:"button","aria-label":h.t("player.chapters"),"aria-expanded":"false"}});return e.appendChild(k("chapters")),e.addEventListener("click",()=>{this.showChaptersMenu(e)}),this.controls.chapters=e,e}showChaptersMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-chapters-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=u.createElement("div",{className:`${this.player.options.classPrefix}-chapters-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu","aria-label":h.t("player.chapters")}}),s=Array.from(this.player.element.textTracks).filter(a=>a.kind==="chapters");if(s.length===0){let a=u.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:h.t("player.noChapters"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(a)}else{let a=s[0];if(a.mode==="disabled"&&(a.mode="hidden"),!a.cues||a.cues.length===0){let r=u.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:h.t("player.loadingChapters"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(r);let l=()=>{i.remove(),this.showChaptersMenu(e)};a.addEventListener("load",l,{once:!0}),setTimeout(()=>{a.cues&&a.cues.length>0&&document.contains(i)&&(i.remove(),this.showChaptersMenu(e))},500)}else{let r=a.cues;for(let l=0;l<r.length;l++){let c=r[l],o=u.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,attributes:{type:"button",role:"menuitem",tabindex:"-1"}}),n=u.createElement("span",{className:`${this.player.options.classPrefix}-chapter-time`,textContent:x.formatTime(c.startTime),attributes:{"aria-label":x.formatDuration(c.startTime)}}),d=u.createElement("span",{className:`${this.player.options.classPrefix}-chapter-title`,textContent:c.text});o.appendChild(n),o.appendChild(document.createTextNode(" ")),o.appendChild(d),o.addEventListener("click",()=>{this.player.seek(c.startTime),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(o)}this.attachMenuKeyboardNavigation(i,e),setTimeout(()=>{let l=i.querySelector(`.${this.player.options.classPrefix}-menu-item`);l&&l.focus({preventScroll:!0})},0)}}i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e)}createQualityButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-quality`,attributes:{type:"button","aria-label":h.t("player.quality"),"aria-expanded":"false",title:h.t("player.quality")}});e.appendChild(k("hd"));let t=u.createElement("span",{className:`${this.player.options.classPrefix}-quality-text`,textContent:""});return e.appendChild(t),e.addEventListener("click",()=>{this.showQualityMenu(e)}),this.controls.quality=e,this.controls.qualityText=t,setTimeout(()=>this.updateQualityIndicator(),500),e}showQualityMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-quality-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=u.createElement("div",{className:`${this.player.options.classPrefix}-quality-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu","aria-label":h.t("player.quality")}});if(this.player.renderer&&this.player.renderer.getQualities){let s=this.player.renderer.getQualities(),a=this.player.renderer.getCurrentQuality?this.player.renderer.getCurrentQuality():-1,r=this.player.renderer.hls!==void 0;if(s.length===0){let l=u.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:h.t("player.autoQuality"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(l)}else{let l=null;if(r){let c=u.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:h.t("player.auto"),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});this.player.renderer.hls&&this.player.renderer.hls.currentLevel===-1&&(c.classList.add(`${this.player.options.classPrefix}-menu-item-active`),c.appendChild(k("check")),l=c),c.addEventListener("click",()=>{this.player.renderer.switchQuality&&this.player.renderer.switchQuality(-1),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(c)}s.forEach(c=>{let o=u.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:c.name||`${c.height}p`,attributes:{type:"button",role:"menuitem",tabindex:"-1"}});c.index===a&&(o.classList.add(`${this.player.options.classPrefix}-menu-item-active`),o.appendChild(k("check")),l=o),o.addEventListener("click",()=>{this.player.renderer.switchQuality&&this.player.renderer.switchQuality(c.index),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(o)}),this.attachMenuKeyboardNavigation(i,e),setTimeout(()=>{let c=l||i.querySelector(`.${this.player.options.classPrefix}-menu-item`);c&&c.focus({preventScroll:!0})},0)}}else{let s=u.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:h.t("player.noQuality"),style:{opacity:"0.5",cursor:"default"}});i.appendChild(s)}i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e)}createCaptionStyleButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-caption-style`,attributes:{type:"button","aria-label":h.t("player.captionStyling"),"aria-expanded":"false",title:h.t("player.captionStyling")}}),t=u.createElement("span",{textContent:"Aa",style:{fontSize:"14px",fontWeight:"bold"}});return e.appendChild(t),e.addEventListener("click",()=>{this.showCaptionStyleMenu(e)}),this.controls.captionStyle=e,e}showCaptionStyleMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-caption-style-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=u.createElement("div",{className:`${this.player.options.classPrefix}-caption-style-menu ${this.player.options.classPrefix}-menu ${this.player.options.classPrefix}-settings-menu`,attributes:{role:"menu","aria-label":h.t("player.captionStyling")}});if(i.addEventListener("click",o=>{o.stopPropagation()}),!this.player.captionManager||this.player.captionManager.tracks.length===0){let o=u.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:h.t("player.noCaptions"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default",padding:"12px 16px"}});i.appendChild(o),i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e,!0);return}let s=this.createStyleControl(h.t("styleLabels.fontSize"),"captionsFontSize",[{label:h.t("fontSizes.small"),value:"87.5%"},{label:h.t("fontSizes.normal"),value:"100%"},{label:h.t("fontSizes.large"),value:"125%"},{label:h.t("fontSizes.xlarge"),value:"150%"}]);i.appendChild(s);let a=this.createStyleControl(h.t("styleLabels.font"),"captionsFontFamily",[{label:h.t("fontFamilies.sansSerif"),value:"sans-serif"},{label:h.t("fontFamilies.serif"),value:"serif"},{label:h.t("fontFamilies.monospace"),value:"monospace"}]);i.appendChild(a);let r=this.createColorControl(h.t("styleLabels.textColor"),"captionsColor");i.appendChild(r);let l=this.createColorControl(h.t("styleLabels.background"),"captionsBackgroundColor");i.appendChild(l);let c=this.createOpacityControl(h.t("styleLabels.opacity"),"captionsOpacity");i.appendChild(c),i.style.minWidth="220px",i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e,!0),ge(i,`.${this.player.options.classPrefix}-style-select`)}createStyleControl(e,t,i){let s=u.createElement("div",{className:`${this.player.options.classPrefix}-style-group`}),a=`${this.player.options.classPrefix}-${t}-${Date.now()}`,r=u.createElement("label",{textContent:e,attributes:{for:a},style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"rgba(255,255,255,0.7)"}});s.appendChild(r);let l=u.createElement("select",{className:`${this.player.options.classPrefix}-style-select`,attributes:{id:a},style:{width:"100%",padding:"6px",background:"var(--vidply-white)",border:"1px solid var(--vidply-white-10)",borderRadius:"4px",color:"var(--vidply-black)",fontSize:"13px"}}),c=this.player.options[t];return i.forEach(o=>{let n=u.createElement("option",{textContent:o.label,attributes:{value:o.value}});o.value===c&&(n.selected=!0),l.appendChild(n)}),l.addEventListener("mousedown",o=>{o.stopPropagation()}),l.addEventListener("click",o=>{o.stopPropagation()}),l.addEventListener("change",o=>{o.stopPropagation(),this.player.options[t]=o.target.value,this.player.captionManager&&this.player.captionManager.setCaptionStyle(t.replace("captions","").charAt(0).toLowerCase()+t.replace("captions","").slice(1),o.target.value)}),s.appendChild(l),s}createColorControl(e,t){let i=u.createElement("div",{className:`${this.player.options.classPrefix}-style-group`}),s=`${this.player.options.classPrefix}-${t}-${Date.now()}`,a=u.createElement("label",{textContent:e,attributes:{for:s},style:{display:"block",fontSize:"12px",marginBottom:"4px",color:"rgba(255,255,255,0.7)"}});i.appendChild(a);let r=u.createElement("input",{attributes:{id:s,type:"color",value:this.player.options[t]},style:{width:"100%",height:"32px",padding:"2px",background:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"4px",cursor:"pointer"}});return r.addEventListener("mousedown",l=>{l.stopPropagation()}),r.addEventListener("click",l=>{l.stopPropagation()}),r.addEventListener("change",l=>{l.stopPropagation(),this.player.options[t]=l.target.value,this.player.captionManager&&this.player.captionManager.setCaptionStyle(t.replace("captions","").charAt(0).toLowerCase()+t.replace("captions","").slice(1),l.target.value)}),i.appendChild(r),i}createOpacityControl(e,t){let i=u.createElement("div",{className:`${this.player.options.classPrefix}-style-group`}),s=`${this.player.options.classPrefix}-${t}-${Date.now()}`,a=u.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"}}),r=u.createElement("label",{textContent:e,attributes:{for:s},style:{fontSize:"12px",color:"rgba(255,255,255,0.7)"}}),l=u.createElement("span",{textContent:Math.round(this.player.options[t]*100)+"%",style:{fontSize:"12px",color:"rgba(255,255,255,0.7)"}});a.appendChild(r),a.appendChild(l),i.appendChild(a);let c=u.createElement("input",{attributes:{id:s,type:"range",min:"0",max:"1",step:"0.1",value:String(this.player.options[t])},style:{width:"100%",cursor:"pointer"}});return c.addEventListener("mousedown",o=>{o.stopPropagation()}),c.addEventListener("click",o=>{o.stopPropagation()}),c.addEventListener("input",o=>{o.stopPropagation();let n=parseFloat(o.target.value);l.textContent=Math.round(n*100)+"%",this.player.options[t]=n,this.player.captionManager&&this.player.captionManager.setCaptionStyle(t.replace("captions","").charAt(0).toLowerCase()+t.replace("captions","").slice(1),n)}),i.appendChild(c),i}createSpeedButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-speed`,attributes:{type:"button","aria-label":h.t("player.speed"),"aria-expanded":"false"}});e.appendChild(k("speed"));let t=u.createElement("span",{className:`${this.player.options.classPrefix}-speed-text`,textContent:"1x"});return e.appendChild(t),e.addEventListener("click",()=>{this.showSpeedMenu(e)}),this.controls.speed=e,this.controls.speedText=t,e}formatSpeedLabel(e){return e===1?h.t("speeds.normal"):`${e.toLocaleString(h.getLanguage(),{minimumFractionDigits:0,maximumFractionDigits:2})}\xD7`}showSpeedMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-speed-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=u.createElement("div",{className:`${this.player.options.classPrefix}-speed-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu"}}),s=[.25,.5,.75,1,1.25,1.5,1.75,2],a=null;s.forEach(r=>{let l=u.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:this.formatSpeedLabel(r),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});r===this.player.state.playbackSpeed&&(l.classList.add(`${this.player.options.classPrefix}-menu-item-active`),l.appendChild(k("check")),a=l),l.addEventListener("click",()=>{this.player.setPlaybackSpeed(r),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(l)}),i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuKeyboardNavigation(i,e),this.attachMenuCloseHandler(i,e),setTimeout(()=>{let r=a||i.querySelector(`.${this.player.options.classPrefix}-menu-item`);r&&r.focus({preventScroll:!0})},0)}createCaptionsButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-captions-button`,attributes:{type:"button","aria-label":h.t("player.captions"),"aria-expanded":"false"}});return e.appendChild(k("captionsOff")),e.addEventListener("click",()=>{this.showCaptionsMenu(e)}),this.controls.captions=e,e}showCaptionsMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-captions-menu`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=u.createElement("div",{className:`${this.player.options.classPrefix}-captions-menu ${this.player.options.classPrefix}-menu`,attributes:{role:"menu","aria-label":h.t("captions.select")}});if(!this.player.captionManager||this.player.captionManager.tracks.length===0){let l=u.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:h.t("player.noCaptions"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(l),this.insertMenuIntoDOM(i,e),this.attachMenuCloseHandler(i,e);return}let s=null,a=u.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:h.t("captions.off"),attributes:{type:"button",role:"menuitem",tabindex:"-1"}});this.player.state.captionsEnabled||(a.classList.add(`${this.player.options.classPrefix}-menu-item-active`),a.appendChild(k("check")),s=a),a.addEventListener("click",()=>{this.player.disableCaptions(),this.updateCaptionsButton(),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(a),this.player.captionManager.getAvailableTracks().forEach(l=>{let c=u.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,textContent:l.label,attributes:{type:"button",role:"menuitem",lang:l.language,tabindex:"-1"}});this.player.state.captionsEnabled&&this.player.captionManager.currentTrack===this.player.captionManager.tracks[l.index]&&(c.classList.add(`${this.player.options.classPrefix}-menu-item-active`),c.appendChild(k("check")),s=c),c.addEventListener("click",()=>{this.player.captionManager.switchTrack(l.index),this.updateCaptionsButton(),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(c)}),this.insertMenuIntoDOM(i,e),this.attachMenuKeyboardNavigation(i,e),this.attachMenuCloseHandler(i,e),setTimeout(()=>{let l=s||i.querySelector(`.${this.player.options.classPrefix}-menu-item`);l&&l.focus({preventScroll:!0})},0)}updateCaptionsButton(){if(!this.controls.captions)return;let e=this.controls.captions.querySelector(".vidply-icon"),t=this.player.state.captionsEnabled;e.innerHTML=t?k("captions").innerHTML:k("captionsOff").innerHTML}createTranscriptButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-transcript`,attributes:{type:"button","aria-label":h.t("player.transcript"),"aria-expanded":"false"}});return e.appendChild(k("transcript")),e.addEventListener("click",()=>{this.player.transcriptManager&&(this.player.transcriptManager.toggleTranscript(),this.updateTranscriptButton())}),this.controls.transcript=e,e}updateTranscriptButton(){if(!this.controls.transcript)return;let e=this.player.transcriptManager&&this.player.transcriptManager.isVisible;this.controls.transcript.setAttribute("aria-expanded",e?"true":"false")}createAudioDescriptionButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-audio-description`,attributes:{type:"button","aria-label":h.t("player.audioDescription"),role:"switch","aria-checked":"false",title:h.t("player.audioDescription")}});return e.appendChild(k("audioDescription")),e.addEventListener("click",async()=>{await this.player.toggleAudioDescription(),this.updateAudioDescriptionButton()}),this.controls.audioDescription=e,e}updateAudioDescriptionButton(){if(!this.controls.audioDescription)return;let e=this.controls.audioDescription.querySelector(".vidply-icon"),t=this.player.state.audioDescriptionEnabled;e.innerHTML=t?k("audioDescriptionOn").innerHTML:k("audioDescription").innerHTML,this.controls.audioDescription.setAttribute("aria-checked",t?"true":"false")}createSignLanguageButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-sign-language`,attributes:{type:"button","aria-label":h.t("player.signLanguage"),"aria-expanded":"false",title:h.t("player.signLanguage")}});return e.appendChild(k("signLanguage")),e.addEventListener("click",()=>{this.player.toggleSignLanguage(),this.updateSignLanguageButton()}),this.controls.signLanguage=e,e}updateSignLanguageButton(){if(!this.controls.signLanguage)return;let e=this.controls.signLanguage.querySelector(".vidply-icon"),t=this.player.state.signLanguageEnabled;e.innerHTML=t?k("signLanguageOn").innerHTML:k("signLanguage").innerHTML,this.controls.signLanguage.setAttribute("aria-expanded",t?"true":"false"),this.controls.signLanguage.setAttribute("aria-label",t?h.t("signLanguage.hide"):h.t("signLanguage.show"))}updateAccessibilityButtons(){let e=this.hasAudioDescription(),t=this.hasSignLanguage();if(e){if(!this.controls.audioDescription&&this.player.options.audioDescriptionButton!==!1){let i=this.createAudioDescriptionButton();i.dataset.overflowPriority="2",i.dataset.overflowPriorityMobile="3";let s=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-transcript`),a=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-playlist-toggle`),r=s||a||null;r?this.rightButtons.insertBefore(i,r):this.rightButtons.appendChild(i),this.setupOverflowMenu()}this.controls.audioDescription&&(this.controls.audioDescription.style.display="")}else this.controls.audioDescription&&(this.controls.audioDescription.style.display="none");if(t){if(!this.controls.signLanguage&&this.player.options.signLanguageButton!==!1){let i=this.createSignLanguageButton();i.dataset.overflowPriority="3",i.dataset.overflowPriorityMobile="3";let s=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-quality`),a=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-fullscreen`),r=s||a||null;r?this.rightButtons.insertBefore(i,r):this.rightButtons.appendChild(i),this.setupOverflowMenu()}this.controls.signLanguage&&(this.controls.signLanguage.style.display="")}else this.controls.signLanguage&&(this.controls.signLanguage.style.display="none")}createSettingsButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-settings`,attributes:{type:"button","aria-label":h.t("player.settings")}});return e.appendChild(k("settings")),e.addEventListener("click",()=>{this.player.showSettings()}),e}createPipButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-pip`,attributes:{type:"button","aria-label":h.t("player.pip")}});return e.appendChild(k("pip")),e.addEventListener("click",()=>{this.player.togglePiP()}),e}createFullscreenButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-fullscreen`,attributes:{type:"button","aria-label":h.t("player.fullscreen")}});return e.appendChild(k("fullscreen")),e.addEventListener("click",()=>{this.player.toggleFullscreen()}),this.controls.fullscreen=e,e}attachEvents(){this.player.on("play",()=>this.updatePlayPauseButton()),this.player.on("pause",()=>this.updatePlayPauseButton()),this.player.on("timeupdate",()=>this.updateProgress()),this.player.on("loadedmetadata",()=>{this.updateDuration(),this.ensureQualityButton(),this.updateQualityIndicator()}),this.player.on("volumechange",()=>this.updateVolumeDisplay()),this.player.on("progress",()=>this.updateBuffered()),this.player.on("playbackspeedchange",()=>this.updateSpeedDisplay()),this.player.on("fullscreenchange",()=>this.updateFullscreenButton()),this.player.on("captionsenabled",()=>this.updateCaptionsButton()),this.player.on("captionsdisabled",()=>this.updateCaptionsButton()),this.player.on("audiodescriptionenabled",()=>this.updateAudioDescriptionButton()),this.player.on("audiodescriptiondisabled",()=>this.updateAudioDescriptionButton()),this.player.on("signlanguageenabled",()=>this.updateSignLanguageButton()),this.player.on("signlanguagedisabled",()=>this.updateSignLanguageButton()),this.player.on("qualitychange",()=>this.updateQualityIndicator()),this.player.on("hlslevelswitched",()=>this.updateQualityIndicator()),this.player.on("hlsmanifestparsed",()=>{this.ensureQualityButton(),this.updateQualityIndicator()})}updatePlayPauseButton(){if(!this.controls.playPause)return;let e=this.controls.playPause.querySelector(".vidply-icon"),t=this.player.state.playing;e.innerHTML=t?k("pause").innerHTML:k("play").innerHTML;let i=t?h.t("player.pause"):h.t("player.play");this.controls.playPause.setAttribute("aria-label",i),this.controls.playPause.setAttribute("title",i)}updateProgress(){if(!this.controls.played)return;let e=this.player.state.currentTime||0,t=this.player.state.duration||0,i=t>0?Math.min(100,Math.max(0,e/t*100)):0;this.controls.played.style.width=`${i}%`,this.controls.progress.setAttribute("aria-valuenow",String(Math.round(i)));let s=x.formatDuration(this.player.state.currentTime),a=x.formatDuration(this.player.state.duration);if(this.controls.progress.setAttribute("aria-valuetext",`${Math.round(i)}%, ${s} ${h.t("time.of")} ${a}`),this.controls.currentTimeVisual){let r=this.player.state.currentTime;this.controls.currentTimeVisual.textContent=x.formatTime(r),this.controls.currentTimeAccessible&&(this.controls.currentTimeAccessible.textContent=x.formatDuration(r))}}updateDuration(){if(this.controls.durationVisual){let e=this.player.state.duration;this.controls.durationVisual.textContent=x.formatTime(e),this.controls.durationAccessible&&(this.controls.durationAccessible.textContent=h.t("time.durationPrefix")+x.formatDuration(e))}}updateVolumeDisplay(){let e=this.player.state.volume*100;if(this.controls.volumeFill&&(this.controls.volumeFill.style.height=`${e}%`),this.controls.volumeSlider&&this.controls.volumeSlider.setAttribute("aria-valuenow",String(Math.round(e))),this.controls.mute){let t=this.controls.mute.querySelector(".vidply-icon");if(t){let i;this.player.state.muted||this.player.state.volume===0?i="volumeMuted":this.player.state.volume<.3?i="volumeLow":this.player.state.volume<.7?i="volumeMedium":i="volumeHigh",t.innerHTML=k(i).innerHTML;let s=this.player.state.muted?h.t("player.unmute"):h.t("player.mute");this.controls.mute.setAttribute("aria-label",s),this.controls.mute.setAttribute("title",s)}}this.controls.volumeSlider&&this.controls.volumeSlider.setAttribute("aria-valuenow",String(Math.round(e)))}updateBuffered(){if(!this.controls.buffered||!this.player.element.buffered||this.player.element.buffered.length===0)return;let t=this.player.element.buffered.end(this.player.element.buffered.length-1)/this.player.state.duration*100;this.controls.buffered.style.width=`${t}%`}updateSpeedDisplay(){this.controls.speedText&&(this.controls.speedText.textContent=`${this.player.state.playbackSpeed}x`)}updateFullscreenButton(){if(!this.controls.fullscreen)return;let e=this.controls.fullscreen.querySelector(".vidply-icon"),t=this.player.state.fullscreen;e.innerHTML=t?k("fullscreenExit").innerHTML:k("fullscreen").innerHTML,this.controls.fullscreen.setAttribute("aria-label",t?h.t("player.exitFullscreen"):h.t("player.fullscreen"))}ensureQualityButton(){if(!this.player.options.qualityButton||this.controls.quality||!this.hasQualityLevels())return;let e=this.createQualityButton(),t=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-speed`),s=this.rightButtons.querySelector(`.${this.player.options.classPrefix}-caption-style`)||t;s?this.rightButtons.insertBefore(e,s):this.rightButtons.insertBefore(e,this.rightButtons.firstChild),this.player.log("Quality button added dynamically","info")}updateQualityIndicator(){if(!this.controls.qualityText||!this.player.renderer||!this.player.renderer.getQualities)return;let e=this.player.renderer.getQualities();if(e.length===0){this.controls.qualityText.textContent="";return}let t="";if(this.player.renderer.hls&&this.player.renderer.hls.currentLevel===-1)t="Auto";else if(this.player.renderer.getCurrentQuality){let i=this.player.renderer.getCurrentQuality(),s=e.find(a=>a.index===i);s&&(t=s.height?`${s.height}p`:"")}this.controls.qualityText.textContent=t}setupAutoHide(){if(this.player.element.tagName!=="VIDEO")return;let e=()=>{if(this.element.classList.add(`${this.player.options.classPrefix}-controls-visible`),this.player.container.classList.add(`${this.player.options.classPrefix}-controls-visible`),this.player.state.controlsVisible=!0,clearTimeout(this.hideTimeout),this.player.state.playing){let t=this.player.state.fullscreen?this.player.options.hideControlsDelay*1.5:this.player.options.hideControlsDelay;this.hideTimeout=setTimeout(()=>{this.element.classList.remove(`${this.player.options.classPrefix}-controls-visible`),this.player.container.classList.remove(`${this.player.options.classPrefix}-controls-visible`),this.player.state.controlsVisible=!1},t)}};this.player.container.addEventListener("mousemove",e),this.player.container.addEventListener("touchstart",e),this.player.container.addEventListener("touchmove",e),this.player.container.addEventListener("click",e),this.player.container.addEventListener("tap",e),this.element.addEventListener("focusin",e),this.player.on("pause",()=>{e(),clearTimeout(this.hideTimeout)}),this.player.on("play",()=>{e()}),this.player.on("enterfullscreen",()=>{e(),this.player.state.fullscreen&&(clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(()=>{this.player.state.playing&&(this.element.classList.remove(`${this.player.options.classPrefix}-controls-visible`),this.player.container.classList.remove(`${this.player.options.classPrefix}-controls-visible`),this.player.state.controlsVisible=!1)},this.player.options.hideControlsDelay*2))}),e()}createOverflowMenuButton(){let e=u.createElement("button",{className:`${this.player.options.classPrefix}-button ${this.player.options.classPrefix}-overflow-menu`,attributes:{type:"button","aria-label":h.t("player.moreOptions"),"aria-expanded":"false",title:h.t("player.moreOptions")}});return e.appendChild(k("moreVertical")),e.addEventListener("click",()=>{this.showOverflowMenu(e)}),this.controls.overflowMenu=e,e}showOverflowMenu(e){let t=document.querySelector(`.${this.player.options.classPrefix}-overflow-menu-list`);if(t){t.remove(),e.setAttribute("aria-expanded","false"),this.openMenu===t&&(this.openMenu=null,this.openMenuButton=null);return}let i=u.createElement("div",{className:`${this.player.options.classPrefix}-overflow-menu-list ${this.player.options.classPrefix}-menu`,attributes:{role:"menu","aria-label":h.t("player.moreOptions")}}),s=Array.from(this.rightButtons.querySelectorAll('button[data-in-overflow="true"]'));if(s.length===0){let a=u.createElement("div",{className:`${this.player.options.classPrefix}-menu-item`,textContent:h.t("player.noMoreOptions"),attributes:{role:"menuitem"},style:{opacity:"0.5",cursor:"default"}});i.appendChild(a)}else s.forEach(a=>{let r=u.createElement("button",{className:`${this.player.options.classPrefix}-menu-item`,attributes:{type:"button",role:"menuitem",tabindex:"-1"}}),l=a.getAttribute("aria-label")||a.getAttribute("title")||"",c=a.querySelector(".vidply-icon");if(c){let n=c.cloneNode(!0);r.appendChild(n)}else{let n=a.querySelector("span");if(n&&n.textContent&&n.textContent.length<=3){let d=n.cloneNode(!0);d.classList.add("vidply-icon"),r.appendChild(d)}}let o=u.createElement("span",{textContent:l});r.appendChild(o),r.addEventListener("click",n=>{this._overflowMenuItemRef=r;let d=a.style.display;a.style.display="",a.style.visibility="hidden",a.click(),setTimeout(()=>{a.style.display=d,a.style.visibility="",this._overflowMenuItemRef=null},100),this.closeMenuAndReturnFocus(i,e)}),i.appendChild(r)}),this.attachMenuKeyboardNavigation(i,e),setTimeout(()=>{let a=i.querySelector(`.${this.player.options.classPrefix}-menu-item`);a&&a.tagName==="BUTTON"&&a.focus({preventScroll:!0})},0);i.style.visibility="hidden",i.style.display="block",this.insertMenuIntoDOM(i,e),this.positionMenu(i,e,!0),requestAnimationFrame(()=>{i.style.visibility="visible"}),this.attachMenuCloseHandler(i,e)}setupOverflowDetection(){let e=()=>{let i=window.innerWidth>=768,s=window.innerHeight<window.innerWidth,a=this.player.state.fullscreen,r=s&&a;if(!this.rightButtons||this.rightButtons.children.length===0){this.overflowMenuButton&&(this.overflowMenuButton.style.display="none");return}let l=Array.from(this.rightButtons.children).filter(y=>!y.classList.contains(`${this.player.options.classPrefix}-overflow-menu`));if(l.length===0){this.overflowMenuButton&&(this.overflowMenuButton.style.display="none");return}let c=!i&&!s;if(this.player.options.debug&&console.log("Overflow detection:",{isDesktop:i,isFullscreen:a,isLandscape:s,isLandscapeFullscreen:r,shouldUseOverflow:c,width:window.innerWidth,height:window.innerHeight}),!c){l.forEach(y=>{y.dataset.inOverflow="false",y.style.display=""}),this.overflowMenuButton&&(this.overflowMenuButton.style.display="none"),this.player.options.debug&&console.log("No overflow menu needed - all buttons visible, overflow button hidden");return}this.player.options.debug&&console.log("Mobile portrait - checking for overflow..."),l.forEach(y=>{y.style.display=""});let o=this.rightButtons.offsetWidth,d=o-50,m=0,g=l.map(y=>{let v=getComputedStyle(y),E=y.offsetWidth+parseInt(v.marginLeft||0)+parseInt(v.marginRight||0);return m+=E,{btn:y,width:E}});m+=(l.length-1)*8;let b=window.innerWidth<768,S=m>d||b||r&&!i;if(this.player.options.debug&&console.log("Overflow detection:",{containerWidth:o,availableWidth:d,totalWidth:m,needsOverflow:S,isSmallScreen:b,reason:b?"mobile screen":m>d?"not enough space":"enough space",buttonCount:l.length}),S){let y=window.innerWidth<768,v=y?"overflowPriorityMobile":"overflowPriority";this.player.options.debug&&console.log(`Using ${y?"mobile":"desktop"} priorities (width: ${window.innerWidth}px)`);let E=g.sort((T,L)=>{let P=parseInt(T.btn.dataset[v]||T.btn.dataset.overflowPriority||"1");return parseInt(L.btn.dataset[v]||L.btn.dataset.overflowPriority||"1")-P}),M=m,w=0;for(let{btn:T,width:L}of E){let P=parseInt(T.dataset[v]||T.dataset.overflowPriority||"1"),D=T.getAttribute("aria-label")||"unknown";if(P===1){T.dataset.inOverflow="false",T.style.display="";continue}(y?P>1:M>d)?(T.dataset.inOverflow="true",T.style.display="none",M-=L,w++,this.player.options.debug&&console.log(`  \u2192 Hiding button: ${D} (priority ${P}, ${y?"mobile":"desktop"})`)):(T.dataset.inOverflow="false",T.style.display="")}if(this.player.options.debug&&console.log("Overflow button exists?",!!this.overflowMenuButton),!this.overflowMenuButton){console.error("Overflow menu button not found!");return}w>0?(this.overflowMenuButton.style.display="",this.player.options.debug&&console.log("Showing overflow menu button -",w,"buttons moved")):(this.overflowMenuButton.style.display="none",this.player.options.debug&&console.log("Hiding overflow menu button - all buttons fit"))}else l.forEach(y=>{y.dataset.inOverflow="false",y.style.display=""}),this.overflowMenuButton.style.display="none"},t=new ResizeObserver(()=>{requestAnimationFrame(e)});t.observe(this.rightButtons),window.addEventListener("resize",()=>{requestAnimationFrame(e)}),this.player.on("fullscreenchange",()=>{setTimeout(()=>{requestAnimationFrame(e)},50)}),requestAnimationFrame(()=>{e(),setTimeout(()=>e(),100),setTimeout(()=>e(),300),setTimeout(()=>e(),500)}),document.fonts&&document.fonts.ready&&document.fonts.ready.then(()=>{requestAnimationFrame(e)}),this.overflowResizeObserver=t}show(){this.element.style.display=""}hide(){this.element.style.display="none"}destroy(){this.hideTimeout&&clearTimeout(this.hideTimeout),this.overflowResizeObserver&&this.overflowResizeObserver.disconnect(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}};var B=class{constructor(e="vidply"){this.namespace=e,this.storage=this.isStorageAvailable()?localStorage:null}isStorageAvailable(){try{let e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}getKey(e){return`${this.namespace}_${e}`}set(e,t){if(!this.storage)return!1;try{let i=this.getKey(e);return this.storage.setItem(i,JSON.stringify(t)),!0}catch(i){return console.warn("Failed to save to localStorage:",i),!1}}get(e,t=null){if(!this.storage)return t;try{let i=this.getKey(e),s=this.storage.getItem(i);return s?JSON.parse(s):t}catch(i){return console.warn("Failed to read from localStorage:",i),t}}remove(e){if(!this.storage)return!1;try{let t=this.getKey(e);return this.storage.removeItem(t),!0}catch(t){return console.warn("Failed to remove from localStorage:",t),!1}}clear(){if(!this.storage)return!1;try{return Object.keys(this.storage).forEach(t=>{t.startsWith(this.namespace)&&this.storage.removeItem(t)}),!0}catch(e){return console.warn("Failed to clear localStorage:",e),!1}}saveTranscriptPreferences(e){return this.set("transcript_preferences",e)}getTranscriptPreferences(){return this.get("transcript_preferences",null)}saveCaptionPreferences(e){return this.set("caption_preferences",e)}getCaptionPreferences(){return this.get("caption_preferences",null)}savePlayerPreferences(e){return this.set("player_preferences",e)}getPlayerPreferences(){return this.get("player_preferences",null)}saveSignLanguagePreferences(e){return this.set("sign_language_preferences",e)}getSignLanguagePreferences(){return this.get("sign_language_preferences",null)}};function j(p,e=100){let t;return function(...s){let a=()=>{clearTimeout(t),p(...s)};clearTimeout(t),t=setTimeout(a,e)}}function X(p=768){return window.innerWidth<p}function O(p,e=100){let t=!1,i=()=>{t||(t=!0,p())};requestAnimationFrame(i),setTimeout(i,e)}var N=class{constructor(e){this.player=e,this.element=null,this.tracks=[],this.currentTrack=null,this.currentCue=null,this.storage=new B("vidply"),this.loadSavedPreferences(),this.init()}loadSavedPreferences(){let e=this.storage.getCaptionPreferences();e&&(e.fontSize&&(this.player.options.captionsFontSize=e.fontSize),e.fontFamily&&(this.player.options.captionsFontFamily=e.fontFamily),e.color&&(this.player.options.captionsColor=e.color),e.backgroundColor&&(this.player.options.captionsBackgroundColor=e.backgroundColor),e.opacity!==void 0&&(this.player.options.captionsOpacity=e.opacity))}saveCaptionPreferences(){this.storage.saveCaptionPreferences({fontSize:this.player.options.captionsFontSize,fontFamily:this.player.options.captionsFontFamily,color:this.player.options.captionsColor,backgroundColor:this.player.options.captionsBackgroundColor,opacity:this.player.options.captionsOpacity})}init(){this.createElement(),this.loadTracks(),this.attachEvents(),this.player.options.captionsDefault&&this.tracks.length>0&&!this.currentTrack&&this.enable()}createElement(){this.element=u.createElement("div",{className:`${this.player.options.classPrefix}-captions`,attributes:{role:"region","aria-label":h.t("player.captions")}}),this.updateStyles(),(this.player.videoWrapper||this.player.container).appendChild(this.element)}loadTracks(){let e=this.player.element.textTracks,t=-1;for(let i=0;i<e.length;i++){let s=e[i];if(s.kind==="subtitles"||s.kind==="captions"){let a=this.player.findTrackElement(s),r=a&&a.hasAttribute("default");this.tracks.push({track:s,language:s.language,label:s.label,kind:s.kind,index:i,isDefault:r}),s.mode==="showing"||s.mode,s.mode="hidden",r&&(t=this.tracks.length-1)}}t>=0&&requestAnimationFrame(()=>{this.enable(t)})}attachEvents(){this.player.on("timeupdate",()=>{this.updateCaptions()}),this.player.on("captionschange",()=>{this.updateStyles()}),this.debouncedPositionCaptions=j(()=>{this.positionCaptionsOnMobile()},150),window.addEventListener("resize",this.debouncedPositionCaptions),this.player.on("enterfullscreen",()=>{O(()=>this.positionCaptionsOnMobile(),100)}),this.player.on("exitfullscreen",()=>{O(()=>this.positionCaptionsOnMobile(),100)})}enable(e=0){if(this.tracks.length===0)return;this.currentTrack&&this.currentTrack.track&&(this.cueChangeHandler&&this.currentTrack.track.removeEventListener("cuechange",this.cueChangeHandler),this.currentTrack.track.mode="hidden");let t=this.tracks[e];if(t&&t.track){t.track.mode="hidden",this.currentTrack=t,this.player.state.captionsEnabled=!0,t.language&&this.element.setAttribute("lang",t.language),this.cueChangeHandler&&t.track.removeEventListener("cuechange",this.cueChangeHandler),this.cueChangeHandler=()=>{this.updateCaptions()},t.track.addEventListener("cuechange",this.cueChangeHandler);let i=()=>{if(t.track.readyState<2){let s=()=>{t.track.removeEventListener("load",s),t.track.removeEventListener("error",s),requestAnimationFrame(()=>{this.currentTrack&&this.currentTrack.track===t.track&&this.updateCaptions()})};t.track.addEventListener("load",s,{once:!0}),t.track.addEventListener("error",s,{once:!0})}else requestAnimationFrame(()=>{this.currentTrack&&this.currentTrack.track===t.track&&this.updateCaptions()})};requestAnimationFrame(()=>{this.currentTrack&&this.currentTrack.track===t.track&&i()}),this.player.emit("captionsenabled",t)}}disable(){this.currentTrack&&(this.currentTrack.track.mode="hidden",this.currentTrack=null),this.element.style.display="none",this.element.innerHTML="",this.element.removeAttribute("lang"),this.currentCue=null,this.player.state.captionsEnabled=!1,this.player.emit("captionsdisabled")}updateCaptions(){if(!this.currentTrack||!this.currentTrack.track)return;if(this.currentTrack.track.mode==="disabled"&&(this.currentTrack.track.mode="hidden"),this.currentTrack.track.mode==="showing"&&(this.currentTrack.track.mode="hidden"),!this.currentTrack.track.activeCues){this.currentTrack.track.cues&&this.currentTrack.track.cues.length>0&&this.currentCue&&(this.element.innerHTML="",this.element.style.display="none",this.currentCue=null);return}let e=this.currentTrack.track.activeCues,t=this.player.element.tagName.toLowerCase()==="audio";if(e.length>0){let i=e[0];if(this.currentCue!==i){this.currentCue=i;let s=i.text;if(s=this.parseVTTFormatting(s),t){this.element.querySelectorAll(`.${this.player.options.classPrefix}-caption-cue`).forEach(c=>c.classList.remove(`${this.player.options.classPrefix}-caption-active`));let r=`cue-${i.startTime}-${i.endTime}`,l=this.element.querySelector(`[data-cue-id="${r}"]`);l||(l=document.createElement("div"),l.className=`${this.player.options.classPrefix}-caption-cue`,l.setAttribute("data-cue-id",r),l.innerHTML=u.sanitizeHTML(s),this.element.appendChild(l)),l.classList.add(`${this.player.options.classPrefix}-caption-active`),requestAnimationFrame(()=>{l&&l.scrollIntoView({behavior:"smooth",block:"center"})})}else this.element.innerHTML=u.sanitizeHTML(s);this.element.style.display="block",this.positionCaptionsOnMobile(),this.player.emit("captionchange",i)}}else this.currentCue&&(t||(this.element.innerHTML="",this.element.style.display="none"),this.currentCue=null)}positionCaptionsOnMobile(){var s,a;if(!this.element||this.element.style.display==="none")return;let e=((s=this.player.state)==null?void 0:s.fullscreen)||!1,t=X();if(!t&&!e){this.element.style.bottom="";return}let i=(a=this.player.controlBar)==null?void 0:a.element;i&&requestAnimationFrame(()=>{if(!this.element||this.element.style.display==="none")return;let r=i.getBoundingClientRect(),c=this.player.videoWrapper.getBoundingClientRect().bottom-r.top+16;this.element.style.bottom=`${c}px`,this.player.options.debug&&console.log("[VidPly] Caption position:",{mobile:t,isFullscreen:e,controlsHeight:r.height,bottomOffset:`${c}px`})})}parseVTTFormatting(e){return e=e.replace(/<c[^>]*>(.*?)<\/c>/g,'<span class="caption-class">$1</span>'),e=e.replace(/<b>(.*?)<\/b>/g,"<strong>$1</strong>"),e=e.replace(/<i>(.*?)<\/i>/g,"<em>$1</em>"),e=e.replace(/<u>(.*?)<\/u>/g,"<u>$1</u>"),e=e.replace(/<v\s+([^>]+)>(.*?)<\/v>/g,'<span class="caption-voice" data-voice="$1">$2</span>'),e}updateStyles(){if(!this.element)return;let e=this.player.options;this.element.style.fontSize=e.captionsFontSize,this.element.style.fontFamily=e.captionsFontFamily,this.element.style.color=e.captionsColor,this.element.style.backgroundColor=this.hexToRgba(e.captionsBackgroundColor,e.captionsOpacity)}hexToRgba(e,t){let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?`rgba(${parseInt(i[1],16)}, ${parseInt(i[2],16)}, ${parseInt(i[3],16)}, ${t})`:e}setCaptionStyle(e,t){switch(e){case"fontSize":this.player.options.captionsFontSize=t;break;case"fontFamily":this.player.options.captionsFontFamily=t;break;case"color":this.player.options.captionsColor=t;break;case"backgroundColor":this.player.options.captionsBackgroundColor=t;break;case"opacity":this.player.options.captionsOpacity=t;break}this.updateStyles(),this.saveCaptionPreferences(),this.player.emit("captionschange")}getAvailableTracks(){return this.tracks.map((e,t)=>({index:t,language:e.language,label:e.label||e.language,kind:e.kind}))}switchTrack(e){e>=0&&e<this.tracks.length&&(this.disable(),this.enable(e))}destroy(){this.disable(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}};var Y=class{constructor(e){this.player=e,this.shortcuts=e.options.keyboardShortcuts,this.init()}init(){this.attachEvents()}attachEvents(){this.player.container.addEventListener("keydown",e=>{this.handleKeydown(e)},!0),this.player.container.hasAttribute("tabindex")||this.player.container.setAttribute("tabindex","0")}handleKeydown(e){if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||e.target.tagName==="SELECT")return;let t=document.activeElement;if(t&&(t.closest('.vidply-menu, [role="menu"]')||t.closest(".vidply-playlist-item-button")))return;let i=e.key,s=!1;if(i==="Escape"&&this.player.state.fullscreen){this.player.exitFullscreen(),e.preventDefault(),e.stopPropagation();return}for(let[a,r]of Object.entries(this.shortcuts))if(r.includes(i)&&(s=this.executeAction(a,e),s)){e.preventDefault(),e.stopPropagation(),this.announceAction(a);break}!s&&this.player.options.debug&&console.log("[VidPly] Unhandled key:",e.key,"code:",e.code,"shiftKey:",e.shiftKey)}executeAction(e,t){switch(e){case"play-pause":return this.player.toggle(),!0;case"volume-up":return this.player.setVolume(Math.min(1,this.player.state.volume+.1)),!0;case"volume-down":return this.player.setVolume(Math.max(0,this.player.state.volume-.1)),!0;case"seek-forward":return this.player.seekForward(),!0;case"seek-backward":return this.player.seekBackward(),!0;case"mute":return this.player.toggleMute(),!0;case"fullscreen":return this.player.toggleFullscreen(),!0;case"captions":if(this.player.captionManager&&this.player.captionManager.tracks.length>1){let i=this.player.controlBar&&this.player.controlBar.controls.captions;i?this.player.controlBar.showCaptionsMenu(i):this.player.toggleCaptions()}else this.player.toggleCaptions();return!0;case"caption-style-menu":return this.player.controlBar&&this.player.controlBar.controls.captionStyle?(this.player.controlBar.showCaptionStyleMenu(this.player.controlBar.controls.captionStyle),!0):!1;case"speed-up":return this.player.setPlaybackSpeed(Math.min(2,this.player.state.playbackSpeed+.25)),!0;case"speed-down":return this.player.setPlaybackSpeed(Math.max(.25,this.player.state.playbackSpeed-.25)),!0;case"speed-menu":return this.player.controlBar&&this.player.controlBar.controls.speed?(this.player.controlBar.showSpeedMenu(this.player.controlBar.controls.speed),!0):!1;case"quality-menu":return this.player.controlBar&&this.player.controlBar.controls.quality?(this.player.controlBar.showQualityMenu(this.player.controlBar.controls.quality),!0):!1;case"chapters-menu":return this.player.controlBar&&this.player.controlBar.controls.chapters?(this.player.controlBar.showChaptersMenu(this.player.controlBar.controls.chapters),!0):!1;case"transcript-toggle":return this.player.transcriptManager?(this.player.transcriptManager.toggleTranscript(),!0):!1;default:return!1}}announceAction(e){if(!this.player.options.screenReaderAnnouncements)return;let t="";switch(e){case"play-pause":t=this.player.state.playing?"Playing":"Paused";break;case"volume-up":t=`Volume ${Math.round(this.player.state.volume*100)}%`;break;case"volume-down":t=`Volume ${Math.round(this.player.state.volume*100)}%`;break;case"mute":t=this.player.state.muted?"Muted":"Unmuted";break;case"fullscreen":t=this.player.state.fullscreen?"Fullscreen":"Exit fullscreen";break;case"captions":t=this.player.state.captionsEnabled?"Captions on":"Captions off";break;case"speed-up":case"speed-down":t=`Speed ${this.player.state.playbackSpeed}x`;break}t&&this.announce(t)}announce(e,t="polite"){let i=document.getElementById("vidply-announcer");i||(i=document.createElement("div"),i.id="vidply-announcer",i.className="vidply-sr-only",i.setAttribute("aria-live",t),i.setAttribute("aria-atomic","true"),i.style.cssText=`
        position: absolute;
        left: -10000px;
        width: 1px;
        height: 1px;
        overflow: hidden;
      `,document.body.appendChild(i)),i.textContent="",setTimeout(()=>{i.textContent=e},100)}updateShortcut(e,t){Array.isArray(t)&&(this.shortcuts[e]=t)}destroy(){}};function A({classPrefix:p,itemClass:e,icon:t,label:i,ariaLabel:s,onClick:a,hasTextClass:r=!1}){let l=typeof i=="string"&&(i.startsWith("transcript.")||i.startsWith("player.")||i.startsWith("settings.")),c=s||l&&h.t(i)||i,o=u.createElement("button",{className:e,attributes:{type:"button","aria-label":c,tabindex:"-1"}});t&&o.appendChild(k(t));let d=typeof i=="string"&&(i.startsWith("transcript.")||i.startsWith("player.")||i.startsWith("settings."))&&h.t(i)||i,m=u.createElement("span",{textContent:d,className:r?`${p}-settings-text`:void 0,attributes:{"aria-hidden":"true"}});return o.appendChild(m),a&&o.addEventListener("click",a),o}function H(p,e,t,i){if(!p)return;let s=Array.from(p.querySelectorAll(t));if(s.length===0)return;let a=r=>{let l=s.indexOf(document.activeElement);switch(r.key){case"ArrowDown":r.preventDefault(),r.stopPropagation();let c=(l+1)%s.length;s.forEach((d,m)=>{d.setAttribute("tabindex",m===c?"0":"-1")}),s[c].focus();break;case"ArrowUp":r.preventDefault(),r.stopPropagation();let o=(l-1+s.length)%s.length;s.forEach((d,m)=>{d.setAttribute("tabindex",m===o?"0":"-1")}),s[o].focus();break;case"Home":r.preventDefault(),r.stopPropagation(),s.forEach((d,m)=>{d.setAttribute("tabindex",m===0?"0":"-1")}),s[0].focus();break;case"End":r.preventDefault(),r.stopPropagation();let n=s.length-1;s.forEach((d,m)=>{d.setAttribute("tabindex",m===n?"0":"-1")}),s[n].focus();break;case"Enter":case" ":r.preventDefault(),r.stopPropagation(),document.activeElement&&s.includes(document.activeElement)&&(document.activeElement.click(),i&&setTimeout(()=>{e&&document.contains(e)&&e.focus()},0));break;case"Escape":r.preventDefault(),r.stopPropagation(),i&&i();break}};return p.addEventListener("keydown",a,!0),a}function ae(p,e,t=0){p&&setTimeout(()=>{let i=Array.from(p.querySelectorAll(e));i.length>0&&(i.forEach((s,a)=>{s.setAttribute("tabindex",a===0?"0":"-1")}),R(i[0],{delay:0}))},t)}var V=class{constructor(e,t={}){this.element=e,this.options={dragHandle:null,resizeHandles:[],onDragStart:null,onDrag:null,onDragEnd:null,onResizeStart:null,onResize:null,onResizeEnd:null,constrainToViewport:!0,minWidth:150,minHeight:100,maintainAspectRatio:!1,keyboardDragKey:"d",keyboardResizeKey:"r",keyboardStep:5,keyboardStepLarge:10,maxWidth:null,maxHeight:null,pointerResizeIndicatorText:null,onPointerResizeToggle:null,classPrefix:"draggable",storage:null,storageKey:null,...t},this.isDragging=!1,this.isResizing=!1,this.resizeDirection=null,this.dragOffsetX=0,this.dragOffsetY=0,this.positionOffsetX=0,this.positionOffsetY=0,this.initialMouseX=0,this.initialMouseY=0,this.needsPositionConversion=!1,this.resizeStartX=0,this.resizeStartY=0,this.resizeStartWidth=0,this.resizeStartHeight=0,this.resizeStartLeft=0,this.resizeStartTop=0,this.keyboardDragMode=!1,this.keyboardResizeMode=!1,this.pointerResizeMode=!1,this.manuallyPositioned=!1,this.resizeHandlesManaged=new Map,this.resizeIndicatorElement=null,this.handlers={mousedown:this.onMouseDown.bind(this),mousemove:this.onMouseMove.bind(this),mouseup:this.onMouseUp.bind(this),touchstart:this.onTouchStart.bind(this),touchmove:this.onTouchMove.bind(this),touchend:this.onTouchEnd.bind(this),keydown:this.onKeyDown.bind(this),resizeHandleMousedown:this.onResizeHandleMouseDown.bind(this)},this.init()}hasManagedResizeHandles(){return Array.from(this.resizeHandlesManaged.values()).some(Boolean)}storeOriginalHandleDisplay(e){e.dataset.originalDisplay||(e.dataset.originalDisplay=e.style.display||"")}hideResizeHandle(e){e.style.display="none",e.setAttribute("aria-hidden","true")}showResizeHandle(e){let t=e.dataset.originalDisplay!==void 0?e.dataset.originalDisplay:"";e.style.display=t,e.removeAttribute("aria-hidden")}setManagedHandlesVisible(e){!this.options.resizeHandles||this.options.resizeHandles.length===0||this.options.resizeHandles.forEach(t=>{this.resizeHandlesManaged.get(t)&&(e?this.showResizeHandle(t):this.hideResizeHandle(t))})}init(){let e=this.options.dragHandle||this.element;e.addEventListener("mousedown",this.handlers.mousedown),e.addEventListener("touchstart",this.handlers.touchstart),document.addEventListener("mousemove",this.handlers.mousemove),document.addEventListener("mouseup",this.handlers.mouseup),document.addEventListener("touchmove",this.handlers.touchmove,{passive:!1}),document.addEventListener("touchend",this.handlers.touchend),this.element.addEventListener("keydown",this.handlers.keydown),this.options.resizeHandles&&this.options.resizeHandles.length>0&&this.options.resizeHandles.forEach(t=>{t.addEventListener("mousedown",this.handlers.resizeHandleMousedown),t.addEventListener("touchstart",this.handlers.resizeHandleMousedown);let i=t.dataset.vidplyManagedResize==="true";this.resizeHandlesManaged.set(t,i),i&&(this.storeOriginalHandleDisplay(t),this.hideResizeHandle(t))})}onMouseDown(e){e.target.classList.contains(`${this.options.classPrefix}-resize-handle`)||this.options.onDragStart&&!this.options.onDragStart(e)||(this.startDragging(e.clientX,e.clientY),e.preventDefault())}onTouchStart(e){if(e.target.classList.contains(`${this.options.classPrefix}-resize-handle`)||this.options.onDragStart&&!this.options.onDragStart(e))return;let t=e.touches[0];this.startDragging(t.clientX,t.clientY)}onResizeHandleMouseDown(e){var a,r,l,c;e.preventDefault(),e.stopPropagation();let t=e.target;this.resizeDirection=t.getAttribute("data-direction");let i=e.clientX||((r=(a=e.touches)==null?void 0:a[0])==null?void 0:r.clientX),s=e.clientY||((c=(l=e.touches)==null?void 0:l[0])==null?void 0:c.clientY);this.startResizing(i,s)}onMouseMove(e){this.isDragging?(this.drag(e.clientX,e.clientY),e.preventDefault()):this.isResizing&&(this.resize(e.clientX,e.clientY),e.preventDefault())}onTouchMove(e){if(this.isDragging||this.isResizing){let t=e.touches[0];this.isDragging?this.drag(t.clientX,t.clientY):this.resize(t.clientX,t.clientY),e.preventDefault()}}onMouseUp(){this.isDragging?this.stopDragging():this.isResizing&&this.stopResizing()}onTouchEnd(){this.isDragging?this.stopDragging():this.isResizing&&this.stopResizing()}onKeyDown(e){if(e.key.toLowerCase()===this.options.keyboardDragKey.toLowerCase()){e.preventDefault(),this.toggleKeyboardDragMode();return}if(e.key.toLowerCase()===this.options.keyboardResizeKey.toLowerCase()){e.preventDefault(),this.hasManagedResizeHandles()?this.togglePointerResizeMode():this.toggleKeyboardResizeMode();return}if(e.key==="Escape"){if(this.pointerResizeMode){e.preventDefault(),this.disablePointerResizeMode();return}if(this.keyboardDragMode||this.keyboardResizeMode){e.preventDefault(),this.disableKeyboardDragMode(),this.disableKeyboardResizeMode();return}}["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)&&(this.keyboardDragMode?(e.preventDefault(),e.stopPropagation(),this.keyboardDrag(e.key,e.shiftKey)):this.keyboardResizeMode&&(e.preventDefault(),e.stopPropagation(),this.keyboardResize(e.key,e.shiftKey))),e.key==="Home"&&(this.keyboardDragMode||this.keyboardResizeMode)&&(e.preventDefault(),this.resetPosition())}startDragging(e,t){let i=this.element.getBoundingClientRect(),s=window.getComputedStyle(this.element),a=s.right!=="auto"||s.bottom!=="auto"||s.transform!=="none";if(this.positionOffsetX=0,this.positionOffsetY=0,a){let l,c;if(s.position==="absolute"){let m=(this.element.offsetParent||document.body).getBoundingClientRect();l=i.left-m.left,c=i.top-m.top,this.positionOffsetX=m.left,this.positionOffsetY=m.top}else if(s.position==="fixed"){let d=parseFloat(s.left),m=parseFloat(s.top),g=Number.isFinite(d),f=Number.isFinite(m);l=g?d:i.left,c=f?m:i.top,this.positionOffsetX=i.left-l,this.positionOffsetY=i.top-c}else l=i.left,c=i.top,this.positionOffsetX=i.left-l,this.positionOffsetY=i.top-c;let n=this.element.style.cssText.split(";").filter(d=>{let m=d.trim();if(!m)return!1;let g=m.indexOf(":");if(g===-1)return!1;let f=m.substring(0,g).trim(),b=m.substring(g+1).trim();return!(!b||b===""||f==="right"||f==="bottom"||f==="transform"||f==="left"||f==="top"||f==="inset"||f.startsWith("border-image"))}).join("; ");n&&(n+="; "),n+=`left: ${l}px; top: ${c}px; right: auto; bottom: auto; transform: none`,this.element.style.cssText=n}let r=this.element.getBoundingClientRect();this.dragOffsetX=e-r.left,this.dragOffsetY=t-r.top,this.isDragging=!0,this.element.classList.add(`${this.options.classPrefix}-dragging`),document.body.style.cursor="grabbing",document.body.style.userSelect="none"}drag(e,t){if(!this.isDragging)return;let i=e-this.dragOffsetX-this.positionOffsetX,s=t-this.dragOffsetY-this.positionOffsetY;if(this.options.constrainToViewport){let a=this.element.getBoundingClientRect(),r=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=100,o=-(a.width-c),n=-(a.height-c),d=r-c,m=l-c;i=Math.max(o,Math.min(i,d)),s=Math.max(n,Math.min(s,m))}this.element.style.left=`${i}px`,this.element.style.top=`${s}px`,this.options.onDrag&&this.options.onDrag({x:i,y:s})}stopDragging(){this.isDragging=!1,this.element.classList.remove(`${this.options.classPrefix}-dragging`),document.body.style.cursor="",document.body.style.userSelect="",this.manuallyPositioned=!0,this.options.onDragEnd&&this.options.onDragEnd()}startResizing(e,t){this.isResizing=!0,this.resizeStartX=e,this.resizeStartY=t;let i=this.element.getBoundingClientRect();this.resizeStartWidth=i.width,this.resizeStartHeight=i.height,this.resizeStartLeft=i.left,this.resizeStartTop=i.top,this.element.classList.add(`${this.options.classPrefix}-resizing`),document.body.style.userSelect="none",this.options.onResizeStart&&this.options.onResizeStart()}resize(e,t){if(!this.isResizing)return;let i=e-this.resizeStartX,s=t-this.resizeStartY,a=this.resizeStartWidth,r=this.resizeStartHeight,l=this.resizeStartLeft,c=this.resizeStartTop;if(this.resizeDirection.includes("e")&&(a=Math.max(this.options.minWidth,this.resizeStartWidth+i)),this.resizeDirection.includes("w")){let n=Math.max(this.options.minWidth,this.resizeStartWidth-i);l=this.resizeStartLeft+(this.resizeStartWidth-n),a=n}let o=typeof this.options.maxWidth=="function"?this.options.maxWidth():this.options.maxWidth;if(Number.isFinite(o)){let n=Math.min(a,o);n!==a&&this.resizeDirection.includes("w")&&(l+=a-n),a=n}if(!this.options.maintainAspectRatio){if(this.resizeDirection.includes("s")&&(r=Math.max(this.options.minHeight,this.resizeStartHeight+s)),this.resizeDirection.includes("n")){let d=Math.max(this.options.minHeight,this.resizeStartHeight-s);c=this.resizeStartTop+(this.resizeStartHeight-d),r=d}let n=typeof this.options.maxHeight=="function"?this.options.maxHeight():this.options.maxHeight;if(Number.isFinite(n)){let d=Math.min(r,n);d!==r&&this.resizeDirection.includes("n")&&(c+=r-d),r=d}}this.element.style.width=`${a}px`,this.options.maintainAspectRatio?this.element.style.height="auto":this.element.style.height=`${r}px`,this.resizeDirection.includes("w")&&(this.element.style.left=`${l}px`),this.resizeDirection.includes("n")&&!this.options.maintainAspectRatio&&(this.element.style.top=`${c}px`),this.options.onResize&&this.options.onResize({width:a,height:r,left:l,top:c})}stopResizing(){this.isResizing=!1,this.resizeDirection=null,this.element.classList.remove(`${this.options.classPrefix}-resizing`),document.body.style.userSelect="",this.manuallyPositioned=!0,this.options.onResizeEnd&&this.options.onResizeEnd()}toggleKeyboardDragMode(){this.keyboardDragMode?this.disableKeyboardDragMode():this.enableKeyboardDragMode()}enableKeyboardDragMode(){this.keyboardDragMode=!0,this.keyboardResizeMode=!1,this.element.classList.add(`${this.options.classPrefix}-keyboard-drag`),this.element.classList.remove(`${this.options.classPrefix}-keyboard-resize`),this.focusElement()}disableKeyboardDragMode(){this.keyboardDragMode=!1,this.element.classList.remove(`${this.options.classPrefix}-keyboard-drag`)}toggleKeyboardResizeMode(){this.keyboardResizeMode?this.disableKeyboardResizeMode():this.enableKeyboardResizeMode()}enableKeyboardResizeMode(){this.keyboardResizeMode=!0,this.keyboardDragMode=!1,this.element.classList.add(`${this.options.classPrefix}-keyboard-resize`),this.element.classList.remove(`${this.options.classPrefix}-keyboard-drag`),this.focusElement()}disableKeyboardResizeMode(){this.keyboardResizeMode=!1,this.element.classList.remove(`${this.options.classPrefix}-keyboard-resize`)}enablePointerResizeMode({focus:e=!0}={}){if(!this.hasManagedResizeHandles()){this.enableKeyboardResizeMode();return}this.pointerResizeMode||(this.pointerResizeMode=!0,this.setManagedHandlesVisible(!0),this.element.classList.add(`${this.options.classPrefix}-resizable`),this.enableKeyboardResizeMode(),e&&this.focusElement(),typeof this.options.onPointerResizeToggle=="function"&&this.options.onPointerResizeToggle(!0))}disablePointerResizeMode({focus:e=!1}={}){this.pointerResizeMode&&(this.pointerResizeMode=!1,this.setManagedHandlesVisible(!1),this.element.classList.remove(`${this.options.classPrefix}-resizable`),this.disableKeyboardResizeMode(),e&&this.focusElement(),typeof this.options.onPointerResizeToggle=="function"&&this.options.onPointerResizeToggle(!1))}togglePointerResizeMode(){return this.pointerResizeMode?this.disablePointerResizeMode():this.enablePointerResizeMode(),this.pointerResizeMode}focusElement(){if(typeof this.element.focus=="function")try{this.element.focus({preventScroll:!0})}catch{this.element.focus()}}keyboardDrag(e,t){let i=t?this.options.keyboardStepLarge:this.options.keyboardStep,s=parseFloat(this.element.style.left)||0,a=parseFloat(this.element.style.top)||0;if(window.getComputedStyle(this.element).transform!=="none"){let o=this.element.getBoundingClientRect();s=o.left,a=o.top,this.element.style.transform="none",this.element.style.left=`${s}px`,this.element.style.top=`${a}px`}let l=s,c=a;switch(e){case"ArrowLeft":l-=i;break;case"ArrowRight":l+=i;break;case"ArrowUp":c-=i;break;case"ArrowDown":c+=i;break}this.element.style.left=`${l}px`,this.element.style.top=`${c}px`,this.options.onDrag&&this.options.onDrag({x:l,y:c})}keyboardResize(e,t){let i=t?this.options.keyboardStepLarge:this.options.keyboardStep,s=this.element.getBoundingClientRect(),a=s.width,r=s.height;switch(e){case"ArrowLeft":a-=i;break;case"ArrowRight":a+=i;break;case"ArrowUp":this.options.maintainAspectRatio?a+=i:r-=i;break;case"ArrowDown":this.options.maintainAspectRatio?a-=i:r+=i;break}a=Math.max(this.options.minWidth,a),r=Math.max(this.options.minHeight,r),this.element.style.width=`${a}px`,this.options.maintainAspectRatio?this.element.style.height="auto":this.element.style.height=`${r}px`,this.options.onResize&&this.options.onResize({width:a,height:r})}resetPosition(){this.element.style.left="50%",this.element.style.top="50%",this.element.style.transform="translate(-50%, -50%)",this.element.style.right="",this.element.style.bottom="",this.manuallyPositioned=!1,this.options.onDrag&&this.options.onDrag({centered:!0})}destroy(){let e=this.options.dragHandle||this.element;this.disablePointerResizeMode(),e.removeEventListener("mousedown",this.handlers.mousedown),e.removeEventListener("touchstart",this.handlers.touchstart),document.removeEventListener("mousemove",this.handlers.mousemove),document.removeEventListener("mouseup",this.handlers.mouseup),document.removeEventListener("touchmove",this.handlers.touchmove),document.removeEventListener("touchend",this.handlers.touchend),this.element.removeEventListener("keydown",this.handlers.keydown),this.options.resizeHandles&&this.options.resizeHandles.length>0&&this.options.resizeHandles.forEach(t=>{t.removeEventListener("mousedown",this.handlers.resizeHandleMousedown),t.removeEventListener("touchstart",this.handlers.resizeHandleMousedown)}),this.element.classList.remove(`${this.options.classPrefix}-dragging`,`${this.options.classPrefix}-resizing`,`${this.options.classPrefix}-keyboard-drag`,`${this.options.classPrefix}-keyboard-resize`)}};function G({classPrefix:p,labelClass:e,selectClass:t,labelText:i,selectId:s,hidden:a=!1,onChange:r=null,options:l=[]}){let o=typeof i=="string"&&(i.startsWith("transcript.")||i.startsWith("player.")||i.startsWith("settings.")||i.startsWith("captions."))&&h.t(i)||i,n=u.createElement("label",{className:e,textContent:o,attributes:{for:s,style:a?"display: none;":void 0}}),d=u.createElement("select",{className:t,attributes:{id:s,style:a?"display: none;":void 0}});return l.forEach(m=>{let g=u.createElement("option",{textContent:m.text,attributes:{value:m.value,selected:m.selected?"selected":void 0}});d.appendChild(g)}),r&&d.addEventListener("change",r),{label:n,select:d}}function J(p){p&&["mousedown","click"].forEach(e=>{p.addEventListener(e,t=>{t.stopPropagation()})})}var I=class{constructor(e){this.player=e,this.transcriptWindow=null,this.transcriptEntries=[],this.metadataCues=[],this.currentActiveEntry=null,this.isVisible=!1,this.storage=new B("vidply"),this.draggableResizable=null,this.settingsMenuVisible=!1,this.settingsMenu=null,this.settingsButton=null,this.settingsMenuJustOpened=!1,this.resizeOptionButton=null,this.resizeOptionText=null,this.dragOptionButton=null,this.dragOptionText=null,this.resizeModeIndicator=null,this.resizeModeIndicatorTimeout=null,this.transcriptResizeHandles=[],this.liveRegion=null,this.styleDialog=null,this.styleDialogVisible=!1,this.styleDialogJustOpened=!1,this.languageSelector=null,this.languageLabel=null,this.currentTranscriptLanguage=null,this.availableTranscriptLanguages=[],this.languageSelectorHandler=null;let t=this.storage.getTranscriptPreferences();this.autoscrollEnabled=(t==null?void 0:t.autoscroll)!==void 0?t.autoscroll:!0,this.showTimestamps=(t==null?void 0:t.showTimestamps)!==void 0?t.showTimestamps:!1,this.transcriptStyle={fontSize:(t==null?void 0:t.fontSize)||this.player.options.transcriptFontSize||"100%",fontFamily:(t==null?void 0:t.fontFamily)||this.player.options.transcriptFontFamily||"sans-serif",color:(t==null?void 0:t.color)||this.player.options.transcriptColor||"#ffffff",backgroundColor:(t==null?void 0:t.backgroundColor)||this.player.options.transcriptBackgroundColor||"#1e1e1e",opacity:(t==null?void 0:t.opacity)??this.player.options.transcriptOpacity??.98},this.handlers={timeupdate:()=>this.updateActiveEntry(),audiodescriptionenabled:()=>{this.isVisible&&this.loadTranscriptData()},audiodescriptiondisabled:()=>{this.isVisible&&this.loadTranscriptData()},resize:null,settingsClick:null,settingsKeydown:null,documentClick:null,styleDialogKeydown:null},this.timeouts=new Set,this.init()}init(){this.setupMetadataHandlingOnLoad(),this.player.on("timeupdate",this.handlers.timeupdate),this.player.on("audiodescriptionenabled",this.handlers.audiodescriptionenabled),this.player.on("audiodescriptiondisabled",this.handlers.audiodescriptiondisabled),this.player.on("fullscreenchange",()=>{this.isVisible&&(window.innerWidth<768&&this.setupDragAndDrop(),(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.setManagedTimeout(()=>this.positionTranscript(),100))})}toggleTranscript(){this.isVisible?this.hideTranscript():this.showTranscript()}showTranscript(){if(this.transcriptWindow){this.transcriptWindow.style.display="flex",this.isVisible=!0,this.player.controlBar&&typeof this.player.controlBar.updateTranscriptButton=="function"&&this.player.controlBar.updateTranscriptButton(),R(this.settingsButton,{delay:150});return}this.createTranscriptWindow(),this.loadTranscriptData(),this.transcriptWindow&&(this.transcriptWindow.style.display="flex",(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.setManagedTimeout(()=>this.positionTranscript(),0),R(this.settingsButton,{delay:150})),this.isVisible=!0}hideTranscript({focusButton:e=!1}={}){var t,i;if(this.transcriptWindow&&(this.transcriptWindow.style.display="none",this.isVisible=!1),this.draggableResizable&&this.draggableResizable.pointerResizeMode&&(this.draggableResizable.disablePointerResizeMode(),this.updateResizeOptionState()),this.hideResizeModeIndicator(),this.announceLive(""),this.player.controlBar&&typeof this.player.controlBar.updateTranscriptButton=="function"&&this.player.controlBar.updateTranscriptButton(),e){let s=(i=(t=this.player.controlBar)==null?void 0:t.controls)==null?void 0:i.transcript;s&&typeof s.focus=="function"&&s.focus({preventScroll:!0})}}createTranscriptWindow(){this.transcriptWindow=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-window`,attributes:{role:"dialog","aria-label":"Video Transcript",tabindex:"-1"}}),this.transcriptHeader=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-header`,attributes:{tabindex:"0"}}),this.headerLeft=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-header-left`}),this.settingsButton=u.createElement("button",{className:`${this.player.options.classPrefix}-transcript-settings`,attributes:{type:"button","aria-label":h.t("transcript.settingsMenu"),"aria-expanded":"false"}}),this.settingsButton.appendChild(k("settings")),this.handlers.settingsClick=d=>{d.preventDefault(),d.stopPropagation(),this.settingsMenuVisible?this.hideSettingsMenu():this.showSettingsMenu()},this.settingsButton.addEventListener("click",this.handlers.settingsClick),this.handlers.settingsKeydown=d=>{d.key==="d"||d.key==="D"?(d.preventDefault(),d.stopPropagation(),this.toggleKeyboardDragMode()):d.key==="r"||d.key==="R"?(d.preventDefault(),d.stopPropagation(),this.toggleResizeMode()):d.key==="Escape"&&this.settingsMenuVisible&&(d.preventDefault(),d.stopPropagation(),this.hideSettingsMenu())},this.settingsButton.addEventListener("keydown",this.handlers.settingsKeydown);let e=u.createElement("h3",{textContent:`${h.t("transcript.title")}. ${h.t("transcript.dragResizePrompt")}`}),t=`${this.player.options.classPrefix}-transcript-autoscroll-${Date.now()}`,i=u.createElement("label",{className:`${this.player.options.classPrefix}-transcript-autoscroll-label`,attributes:{for:t,title:h.t("transcript.autoscroll")}});this.autoscrollCheckbox=u.createElement("input",{attributes:{id:t,type:"checkbox"}}),this.autoscrollEnabled&&(this.autoscrollCheckbox.checked=!0);let s=u.createElement("span",{textContent:h.t("transcript.autoscroll"),className:`${this.player.options.classPrefix}-transcript-autoscroll-text`});i.appendChild(this.autoscrollCheckbox),i.appendChild(s),this.autoscrollCheckbox.addEventListener("change",d=>{this.autoscrollEnabled=d.target.checked,this.saveAutoscrollPreference()}),this.transcriptHeader.appendChild(e),this.headerLeft.appendChild(this.settingsButton),this.headerLeft.appendChild(i);let a=`${this.player.options.classPrefix}-transcript-language-select-${Date.now()}`,{label:r,select:l}=G({classPrefix:this.player.options.classPrefix,labelClass:`${this.player.options.classPrefix}-transcript-language-label`,selectClass:`${this.player.options.classPrefix}-transcript-language-select`,labelText:"settings.language",selectId:a,hidden:!1});this.languageLabel=r,this.languageSelector=l;let c=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-language-wrapper`,attributes:{style:"display: none;"}});c.appendChild(this.languageLabel),c.appendChild(this.languageSelector),this.languageSelectorWrapper=c,J(c),this.headerLeft.appendChild(c);let o=u.createElement("button",{className:`${this.player.options.classPrefix}-transcript-close`,attributes:{type:"button","aria-label":h.t("transcript.close")}});o.appendChild(k("close")),o.addEventListener("click",()=>this.hideTranscript({focusButton:!0})),this.transcriptHeader.appendChild(this.headerLeft),this.transcriptHeader.appendChild(o),this.transcriptContent=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-content`}),this.transcriptWindow.appendChild(this.transcriptHeader),this.transcriptWindow.appendChild(this.transcriptContent),this.createResizeHandles(),this.liveRegion=u.createElement("div",{className:"vidply-sr-only",attributes:{"aria-live":"polite","aria-atomic":"true"}}),this.transcriptWindow.appendChild(this.liveRegion),this.player.container.appendChild(this.transcriptWindow),this.setupDragAndDrop(),(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.positionTranscript(),this.handlers.documentClick=d=>{this.settingsMenuJustOpened||this.styleDialogJustOpened||this.settingsButton&&this.settingsButton.contains(d.target)||this.settingsMenu&&this.settingsMenu.contains(d.target)||(this.settingsMenuVisible&&this.hideSettingsMenu(),this.styleDialogVisible&&this.styleDialog&&!this.styleDialog.contains(d.target)&&this.hideStyleDialog())},this.documentClickHandlerAdded=!1;let n;this.handlers.resize=()=>{n&&this.clearManagedTimeout(n),n=this.setManagedTimeout(()=>{(!this.draggableResizable||!this.draggableResizable.manuallyPositioned)&&this.positionTranscript()},100)},window.addEventListener("resize",this.handlers.resize)}createResizeHandles(){if(!this.transcriptWindow)return;let e=["n","s","e","w","ne","nw","se","sw"];this.transcriptResizeHandles=e.map(t=>{let i=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-resize-handle ${this.player.options.classPrefix}-transcript-resize-${t}`,attributes:{"data-direction":t,"data-vidply-managed-resize":"true","aria-hidden":"true"}});return i.style.display="none",this.transcriptWindow.appendChild(i),i})}positionTranscript(){if(!this.transcriptWindow||!this.player.videoWrapper||!this.isVisible||this.draggableResizable&&this.draggableResizable.manuallyPositioned)return;let e=window.innerWidth<768,t=this.player.videoWrapper.getBoundingClientRect(),i=this.player.state.fullscreen;if(e&&!i)this.transcriptWindow.style.position="relative",this.transcriptWindow.style.left="0",this.transcriptWindow.style.right="0",this.transcriptWindow.style.bottom="auto",this.transcriptWindow.style.top="auto",this.transcriptWindow.style.width="100%",this.transcriptWindow.style.maxWidth="100%",this.transcriptWindow.style.maxHeight="400px",this.transcriptWindow.style.height="auto",this.transcriptWindow.style.borderRadius="0",this.transcriptWindow.style.transform="none",this.transcriptWindow.style.border="none",this.transcriptWindow.style.borderTop="1px solid var(--vidply-border-light)",this.transcriptWindow.style.removeProperty("border-right"),this.transcriptWindow.style.removeProperty("border-bottom"),this.transcriptWindow.style.removeProperty("border-left"),this.transcriptWindow.style.removeProperty("border-image"),this.transcriptWindow.style.removeProperty("border-image-source"),this.transcriptWindow.style.removeProperty("border-image-slice"),this.transcriptWindow.style.removeProperty("border-image-width"),this.transcriptWindow.style.removeProperty("border-image-outset"),this.transcriptWindow.style.removeProperty("border-image-repeat"),this.transcriptWindow.style.boxShadow="none",this.transcriptHeader&&(this.transcriptHeader.style.cursor="default"),this.transcriptWindow.parentNode!==this.player.container&&this.player.container.appendChild(this.transcriptWindow);else if(i){this.transcriptWindow.style.position="fixed",this.transcriptWindow.style.left="auto",this.transcriptWindow.style.right="20px",this.transcriptWindow.style.bottom="80px",this.transcriptWindow.style.top="auto",this.transcriptWindow.style.maxHeight="calc(100vh - 180px)",this.transcriptWindow.style.height="auto";let s=260,a=Math.max(s,window.innerWidth-40),r=parseFloat(this.transcriptWindow.style.width)||400,l=Math.max(s,Math.min(r,a));this.transcriptWindow.style.width=`${l}px`,this.transcriptWindow.style.maxWidth="none",this.transcriptWindow.style.borderRadius="8px",this.transcriptWindow.style.border="1px solid var(--vidply-border)",this.transcriptWindow.style.removeProperty("border-top"),this.transcriptWindow.style.removeProperty("border-right"),this.transcriptWindow.style.removeProperty("border-bottom"),this.transcriptWindow.style.removeProperty("border-left"),this.transcriptWindow.style.removeProperty("border-image"),this.transcriptWindow.style.removeProperty("border-image-source"),this.transcriptWindow.style.removeProperty("border-image-slice"),this.transcriptWindow.style.removeProperty("border-image-width"),this.transcriptWindow.style.removeProperty("border-image-outset"),this.transcriptWindow.style.removeProperty("border-image-repeat"),this.transcriptHeader&&(this.transcriptHeader.style.cursor="move"),this.transcriptWindow.parentNode!==this.player.container&&this.player.container.appendChild(this.transcriptWindow)}else{let s=parseFloat(this.transcriptWindow.style.width)||400,a=20,r=260,l=this.player.container.getBoundingClientRect();window.getComputedStyle(this.player.container).position==="static"&&(this.player.container.style.position="relative");let o=t.right-l.left+a,n=window.innerWidth-t.right-a,d=Math.max(r,Math.min(s,n)),m=t.height;this.transcriptWindow.style.position="absolute",this.transcriptWindow.style.left=`${o}px`,this.transcriptWindow.style.right="auto",this.transcriptWindow.style.bottom="auto",this.transcriptWindow.style.top="0",this.transcriptWindow.style.height=`${m}px`,this.transcriptWindow.style.maxHeight="none",this.transcriptWindow.style.width=`${d}px`,this.transcriptWindow.style.maxWidth="none",this.transcriptWindow.style.borderRadius="8px",this.transcriptWindow.style.border="1px solid var(--vidply-border)",this.transcriptWindow.style.removeProperty("border-top"),this.transcriptWindow.style.removeProperty("border-right"),this.transcriptWindow.style.removeProperty("border-bottom"),this.transcriptWindow.style.removeProperty("border-left"),this.transcriptWindow.style.removeProperty("border-image"),this.transcriptWindow.style.removeProperty("border-image-source"),this.transcriptWindow.style.removeProperty("border-image-slice"),this.transcriptWindow.style.removeProperty("border-image-width"),this.transcriptWindow.style.removeProperty("border-image-outset"),this.transcriptWindow.style.removeProperty("border-image-repeat"),this.transcriptHeader&&(this.transcriptHeader.style.cursor="move"),this.transcriptWindow.parentNode!==this.player.container&&this.player.container.appendChild(this.transcriptWindow)}}getAvailableTranscriptLanguages(){let e=this.player.textTracks,t=new Map;return e.forEach(i=>{(i.kind==="captions"||i.kind==="subtitles")&&i.language&&(t.has(i.language)||t.set(i.language,{language:i.language,label:i.label||i.language,track:i}))}),Array.from(t.values())}updateLanguageSelector(){if(this.languageSelector){if(this.availableTranscriptLanguages=this.getAvailableTranscriptLanguages(),this.languageSelector.innerHTML="",this.availableTranscriptLanguages.length<2){this.languageSelectorWrapper&&(this.languageSelectorWrapper.style.display="none");return}if(this.languageSelectorWrapper&&(this.languageSelectorWrapper.style.display="flex"),this.availableTranscriptLanguages.forEach((e,t)=>{let i=u.createElement("option",{textContent:e.label,attributes:{value:e.language,lang:e.language}});this.languageSelector.appendChild(i)}),this.currentTranscriptLanguage)this.languageSelector.value=this.currentTranscriptLanguage;else if(this.availableTranscriptLanguages.length>0){let e=this.player.textTracks.find(t=>(t.kind==="captions"||t.kind==="subtitles")&&t.mode==="showing");this.currentTranscriptLanguage=e?e.language:this.availableTranscriptLanguages[0].language,this.languageSelector.value=this.currentTranscriptLanguage}this.languageSelectorHandler&&this.languageSelector.removeEventListener("change",this.languageSelectorHandler),this.languageSelectorHandler=e=>{this.currentTranscriptLanguage=e.target.value,this.loadTranscriptData(),this.transcriptContent&&this.currentTranscriptLanguage&&this.transcriptContent.setAttribute("lang",this.currentTranscriptLanguage)},this.languageSelector.addEventListener("change",this.languageSelectorHandler)}}loadTranscriptData(){this.transcriptEntries=[],this.transcriptContent.innerHTML="";let e=this.player.textTracks,t=null;this.currentTranscriptLanguage&&(t=e.find(o=>(o.kind==="captions"||o.kind==="subtitles")&&o.language===this.currentTranscriptLanguage)),t||(t=e.find(o=>o.kind==="captions"||o.kind==="subtitles"),t&&(this.currentTranscriptLanguage=t.language));let i=null;this.currentTranscriptLanguage&&(i=e.find(o=>o.kind==="descriptions"&&o.language===this.currentTranscriptLanguage)),i||(i=e.find(o=>o.kind==="descriptions"));let s=e.find(o=>o.kind==="metadata"),a=i&&this.player.state.audioDescriptionEnabled;if(!t&&!a&&!s){this.showNoTranscriptMessage();return}let r=[t,i,s].filter(Boolean);if(r.forEach(o=>{o.mode==="disabled"&&(o.mode="hidden")}),r.some(o=>!o.cues||o.cues.length===0)){let o=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-loading`,textContent:h.t("transcript.loading")});this.transcriptContent.appendChild(o);let n=0,d=()=>{n++,n>=r.length&&this.loadTranscriptData()};r.forEach(m=>{m.addEventListener("load",d,{once:!0})}),this.setManagedTimeout(()=>{this.loadTranscriptData()},500);return}let c=[];t&&t.cues&&Array.from(t.cues).forEach(o=>{c.push({cue:o,type:"caption"})}),i&&i.cues&&this.player.state.audioDescriptionEnabled&&Array.from(i.cues).forEach(o=>{c.push({cue:o,type:"description"})}),s&&s.cues&&(this.metadataCues=Array.from(s.cues),this.setupMetadataHandling()),c.sort((o,n)=>o.cue.startTime-n.cue.startTime),c.forEach((o,n)=>{let d=this.createTranscriptEntry(o.cue,n,o.type);this.transcriptEntries.push({element:d,cue:o.cue,type:o.type,startTime:o.cue.startTime,endTime:o.cue.endTime}),this.transcriptContent.appendChild(d)}),this.applyTranscriptStyles(),this.updateTimestampVisibility(),this.transcriptContent&&this.currentTranscriptLanguage&&this.transcriptContent.setAttribute("lang",this.currentTranscriptLanguage),this.updateLanguageSelector()}setupMetadataHandlingOnLoad(){let e=()=>{let i=this.player.textTracks.find(s=>s.kind==="metadata");if(i){if(i.mode==="disabled"&&(i.mode="hidden"),this.metadataCueChangeHandler&&i.removeEventListener("cuechange",this.metadataCueChangeHandler),this.metadataCueChangeHandler=()=>{let s=Array.from(i.activeCues||[]);s.length>0&&this.player.options.debug&&console.log("[VidPly Metadata] Active cues:",s.map(a=>({start:a.startTime,end:a.endTime,text:a.text}))),s.forEach(a=>{this.handleMetadataCue(a)})},i.addEventListener("cuechange",this.metadataCueChangeHandler),this.player.options.debug){let s=i.cues?i.cues.length:0;console.log("[VidPly Metadata] Track enabled,",s,"cues available")}}else this.player.options.debug&&console.warn("[VidPly Metadata] No metadata track found")};e(),this.player.on("loadedmetadata",e)}setupMetadataHandling(){!this.metadataCues||this.metadataCues.length===0||this.player.options.debug&&console.log("[VidPly Metadata]",this.metadataCues.length,"cues stored from transcript load")}handleMetadataCue(e){let t=e.text.trim();this.player.options.debug&&console.log("[VidPly Metadata] Processing cue:",{time:e.startTime,text:t}),this.player.emit("metadata",{time:e.startTime,endTime:e.endTime,text:t,cue:e}),t.includes("PAUSE")&&(this.player.state.paused||(this.player.options.debug&&console.log("[VidPly Metadata] Pausing video at",e.startTime),this.player.pause()),this.player.emit("metadata:pause",{time:e.startTime,text:t}));let i=t.match(/FOCUS:([\w#-]+)/);if(i){let a=i[1],r=document.querySelector(a);r?(this.player.options.debug&&console.log("[VidPly Metadata] Focusing element:",a),this.setManagedTimeout(()=>{r.focus({preventScroll:!0})},10)):this.player.options.debug&&console.warn("[VidPly Metadata] Element not found:",a),this.player.emit("metadata:focus",{time:e.startTime,target:a,element:r,text:t})}let s=t.match(/#[\w-]+/g);s&&(this.player.options.debug&&console.log("[VidPly Metadata] Hashtags found:",s),this.player.emit("metadata:hashtags",{time:e.startTime,hashtags:s,text:t}))}createTranscriptEntry(e,t,i="caption"){let s=this.stripVTTFormatting(e.text),a=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-entry ${this.player.options.classPrefix}-transcript-${i}`,attributes:{tabindex:"0","data-start":String(e.startTime),"data-end":String(e.endTime),"data-type":i}}),r=u.createElement("span",{className:`${this.player.options.classPrefix}-transcript-time`,textContent:x.formatTime(e.startTime),attributes:{"aria-hidden":"true"}}),l=u.createElement("span",{className:`${this.player.options.classPrefix}-transcript-text`,textContent:s});a.appendChild(r),a.appendChild(l);let c=()=>{this.player.seek(e.startTime),this.player.state.paused&&this.player.play()};return a.addEventListener("click",c),a.addEventListener("keydown",o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),c())}),a}stripVTTFormatting(e){return e.replace(/<[^>]+>/g,"").replace(/\n/g," ").trim()}showNoTranscriptMessage(){let e=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-empty`,textContent:h.t("transcript.noTranscript")});this.transcriptContent.appendChild(e)}updateActiveEntry(){if(!this.isVisible||this.transcriptEntries.length===0)return;let e=this.player.state.currentTime,t=this.transcriptEntries.find(i=>e>=i.startTime&&e<i.endTime);t&&t!==this.currentActiveEntry?(this.currentActiveEntry&&this.currentActiveEntry.element.classList.remove(`${this.player.options.classPrefix}-transcript-entry-active`),t.element.classList.add(`${this.player.options.classPrefix}-transcript-entry-active`),this.scrollToEntry(t.element),this.currentActiveEntry=t):!t&&this.currentActiveEntry&&(this.currentActiveEntry.element.classList.remove(`${this.player.options.classPrefix}-transcript-entry-active`),this.currentActiveEntry=null)}scrollToEntry(e){if(!this.transcriptContent||!this.autoscrollEnabled)return;let t=this.transcriptContent.getBoundingClientRect(),i=e.getBoundingClientRect();if(i.top<t.top||i.bottom>t.bottom){let s=e.offsetTop-this.transcriptContent.clientHeight/2+e.clientHeight/2;this.transcriptContent.scrollTo({top:s,behavior:"smooth"})}}saveAutoscrollPreference(){let e=this.storage.getTranscriptPreferences()||{};e.autoscroll=this.autoscrollEnabled,this.storage.saveTranscriptPreferences(e)}setupDragAndDrop(){if(!this.transcriptHeader||!this.transcriptWindow)return;let e=window.innerWidth<768,t=this.player.state.fullscreen;if(e&&!t){this.draggableResizable&&(this.draggableResizable.destroy(),this.draggableResizable=null);return}this.draggableResizable||(this.draggableResizable=new V(this.transcriptWindow,{dragHandle:this.transcriptHeader,resizeHandles:this.transcriptResizeHandles,constrainToViewport:!0,classPrefix:`${this.player.options.classPrefix}-transcript`,keyboardDragKey:"d",keyboardResizeKey:"r",keyboardStep:10,keyboardStepLarge:50,minWidth:300,minHeight:200,maxWidth:()=>Math.max(320,window.innerWidth-40),maxHeight:()=>Math.max(200,window.innerHeight-120),pointerResizeIndicatorText:h.t("transcript.resizeModeHint"),onPointerResizeToggle:i=>{this.transcriptResizeHandles.forEach(s=>{s.style.display=i?"block":"none"}),this.onPointerResizeModeChange(i)},onDragStart:i=>{let s=[`.${this.player.options.classPrefix}-transcript-close`,`.${this.player.options.classPrefix}-transcript-settings`,`.${this.player.options.classPrefix}-transcript-language-select`,`.${this.player.options.classPrefix}-transcript-language-label`,`.${this.player.options.classPrefix}-transcript-settings-menu`,`.${this.player.options.classPrefix}-transcript-style-dialog`];for(let a of s)if(i.target.closest(a))return!1;return!0}}),this.customKeyHandler=i=>{let s=i.key.toLowerCase(),a=i.defaultPrevented;if(!(this.settingsMenuVisible||this.styleDialogVisible)){if(s==="home"){i.preventDefault(),i.stopPropagation(),this.draggableResizable&&(this.draggableResizable.pointerResizeMode&&this.draggableResizable.disablePointerResizeMode(),this.draggableResizable.manuallyPositioned=!1,this.positionTranscript(),this.updateResizeOptionState(),this.announceLive(h.t("transcript.positionReset")));return}if(s==="r"){if(a)return;i.preventDefault(),i.stopPropagation(),this.toggleResizeMode()&&this.transcriptWindow.focus({preventScroll:!0});return}if(s==="escape"){if(this.draggableResizable&&this.draggableResizable.pointerResizeMode){i.preventDefault(),i.stopPropagation(),this.draggableResizable.disablePointerResizeMode();return}if(this.draggableResizable&&this.draggableResizable.keyboardDragMode){i.preventDefault(),i.stopPropagation(),this.draggableResizable.disableKeyboardDragMode(),this.announceLive(h.t("transcript.dragModeDisabled"));return}i.preventDefault(),i.stopPropagation(),this.hideTranscript({focusButton:!0});return}}},this.transcriptWindow.addEventListener("keydown",this.customKeyHandler))}toggleKeyboardDragMode(){if(this.draggableResizable){let e=this.draggableResizable.keyboardDragMode;this.draggableResizable.toggleKeyboardDragMode();let t=this.draggableResizable.keyboardDragMode;!e&&t&&this.enableMoveMode(),this.updateDragOptionState(),this.settingsMenuVisible&&this.hideSettingsMenu(),this.transcriptWindow.focus({preventScroll:!0})}}toggleSettingsMenu(){this.settingsMenuVisible?this.hideSettingsMenu():this.showSettingsMenu()}showSettingsMenu(){if(this.settingsMenuJustOpened=!0,setTimeout(()=>{this.settingsMenuJustOpened=!1},350),this.documentClickHandlerAdded||setTimeout(()=>{document.addEventListener("click",this.handlers.documentClick),this.documentClickHandlerAdded=!0},300),this.settingsMenu){this.settingsMenu.style.display="block",this.settingsMenuVisible=!0,this.settingsButton&&this.settingsButton.setAttribute("aria-expanded","true"),this.attachSettingsMenuKeyboardNavigation(),this.positionSettingsMenuImmediate(),this.updateResizeOptionState(),setTimeout(()=>{let r=this.settingsMenu.querySelectorAll(`.${this.player.options.classPrefix}-transcript-settings-item`);if(r.length>0){r[0].setAttribute("tabindex","0");for(let l=1;l<r.length;l++)r[l].setAttribute("tabindex","-1");r[0].focus({preventScroll:!0})}},50);return}this.settingsMenu=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-settings-menu`,attributes:{role:"menu"}});let e=A({classPrefix:this.player.options.classPrefix,itemClass:`${this.player.options.classPrefix}-transcript-settings-item`,icon:"move",label:"transcript.enableDragMode",hasTextClass:!0,onClick:()=>{this.toggleKeyboardDragMode(),this.hideSettingsMenu()}});e.setAttribute("role","switch"),e.setAttribute("aria-checked","false"),this.dragOptionButton=e,this.dragOptionText=e.querySelector(`.${this.player.options.classPrefix}-settings-text`),this.updateDragOptionState();let t=A({classPrefix:this.player.options.classPrefix,itemClass:`${this.player.options.classPrefix}-transcript-settings-item`,icon:"settings",label:"transcript.styleTranscript",onClick:r=>{r.preventDefault(),r.stopPropagation(),this.hideSettingsMenu(),setTimeout(()=>{this.showStyleDialog()},50)}}),i=A({classPrefix:this.player.options.classPrefix,itemClass:`${this.player.options.classPrefix}-transcript-settings-item`,icon:"resize",label:"transcript.enableResizeMode",hasTextClass:!0,onClick:r=>{r.preventDefault(),r.stopPropagation(),this.toggleResizeMode({focus:!1})?(this.hideSettingsMenu({focusButton:!1}),setTimeout(()=>{this.transcriptWindow&&this.transcriptWindow.focus({preventScroll:!0})},20)):this.hideSettingsMenu({focusButton:!0})}});i.setAttribute("role","switch"),i.setAttribute("aria-checked","false"),this.resizeOptionButton=i,this.resizeOptionText=i.querySelector(`.${this.player.options.classPrefix}-settings-text`),this.updateResizeOptionState();let s=A({classPrefix:this.player.options.classPrefix,itemClass:`${this.player.options.classPrefix}-transcript-settings-item`,icon:"clock",label:"transcript.showTimestamps",hasTextClass:!0,onClick:()=>{this.toggleShowTimestamps()}});s.setAttribute("role","switch"),s.setAttribute("aria-checked",this.showTimestamps?"true":"false"),this.showTimestampsButton=s,this.showTimestampsText=s.querySelector(`.${this.player.options.classPrefix}-settings-text`),this.updateShowTimestampsState();let a=A({classPrefix:this.player.options.classPrefix,itemClass:`${this.player.options.classPrefix}-transcript-settings-item`,icon:"close",label:"transcript.closeMenu",onClick:()=>{this.hideSettingsMenu()}});this.settingsMenu.appendChild(e),this.settingsMenu.appendChild(i),this.settingsMenu.appendChild(t),this.settingsMenu.appendChild(s),this.settingsMenu.appendChild(a),this.settingsMenu.style.visibility="hidden",this.settingsMenu.style.display="block",this.settingsButton&&this.settingsButton.parentNode?this.settingsButton.insertAdjacentElement("afterend",this.settingsMenu):this.headerLeft?this.headerLeft.appendChild(this.settingsMenu):this.transcriptHeader?this.transcriptHeader.appendChild(this.settingsMenu):this.transcriptWindow.appendChild(this.settingsMenu),this.positionSettingsMenuImmediate(),requestAnimationFrame(()=>{this.settingsMenu&&(this.settingsMenu.style.visibility="visible")}),this.settingsMenuKeyHandler=H(this.settingsMenu,this.settingsButton,`.${this.player.options.classPrefix}-transcript-settings-item`,()=>this.hideSettingsMenu({focusButton:!0})),this.settingsMenuVisible=!0,this.settingsMenu.style.display="block",this.settingsButton&&this.settingsButton.setAttribute("aria-expanded","true"),this.updateResizeOptionState(),setTimeout(()=>{let r=this.settingsMenu.querySelectorAll(`.${this.player.options.classPrefix}-transcript-settings-item`);if(r.length>0){r[0].setAttribute("tabindex","0");for(let l=1;l<r.length;l++)r[l].setAttribute("tabindex","-1");r[0].focus({preventScroll:!0})}},50)}positionSettingsMenuImmediate(){if(!this.settingsMenu||!this.settingsButton)return;let e=this.settingsButton.parentElement;if(!e)return;let t=this.settingsButton.getBoundingClientRect(),i=e.getBoundingClientRect(),s=this.settingsMenu.getBoundingClientRect(),a=window.innerHeight,r=t.left-i.left,l=t.bottom-i.top,c=t.top-i.top,o=a-t.bottom,n=t.top,d=l+4;o<s.height+20&&n>o?(d=c-s.height-4,this.settingsMenu.classList.add("vidply-menu-above")):this.settingsMenu.classList.remove("vidply-menu-above"),this.settingsMenu.style.top=`${d}px`,this.settingsMenu.style.left=`${r}px`,this.settingsMenu.style.right="auto",this.settingsMenu.style.bottom="auto"}positionSettingsMenu(){!this.settingsMenu||!this.settingsButton||requestAnimationFrame(()=>{setTimeout(()=>{this.positionSettingsMenuImmediate()},10)})}attachSettingsMenuKeyboardNavigation(){if(!this.settingsMenu)return;this.settingsMenuKeyHandler&&this.settingsMenu.removeEventListener("keydown",this.settingsMenuKeyHandler,!0);let e=H(this.settingsMenu,this.settingsButton,`.${this.player.options.classPrefix}-transcript-settings-item`,()=>this.hideSettingsMenu({focusButton:!0}));this.settingsMenuKeyHandler=e}hideSettingsMenu({focusButton:e=!0}={}){this.settingsMenu&&(this.settingsMenu.style.display="none",this.settingsMenuVisible=!1,this.settingsMenuJustOpened=!1,this.settingsMenuKeyHandler&&(this.settingsMenu.removeEventListener("keydown",this.settingsMenuKeyHandler,!0),this.settingsMenuKeyHandler=null),this.settingsButton&&(this.settingsButton.setAttribute("aria-expanded","false"),e&&this.settingsButton.focus({preventScroll:!0})))}enableMoveMode(){this.hideResizeModeIndicator(),this.transcriptWindow.classList.add(`${this.player.options.classPrefix}-transcript-move-mode`);let e=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-move-tooltip`,textContent:"Drag with mouse or press D for keyboard drag mode"});this.transcriptHeader.appendChild(e),setTimeout(()=>{this.transcriptWindow.classList.remove(`${this.player.options.classPrefix}-transcript-move-mode`),e.parentNode&&e.remove()},2e3)}toggleResizeMode({focus:e=!0}={}){return this.draggableResizable?this.draggableResizable.pointerResizeMode?(this.draggableResizable.disablePointerResizeMode({focus:e}),!1):(this.draggableResizable.enablePointerResizeMode({focus:e}),!0):!1}updateDragOptionState(){if(!this.dragOptionButton)return;let e=!!(this.draggableResizable&&this.draggableResizable.keyboardDragMode),t=e?h.t("transcript.disableDragMode"):h.t("transcript.enableDragMode"),i=e?h.t("transcript.disableDragModeAria"):h.t("transcript.enableDragModeAria");this.dragOptionButton.setAttribute("aria-checked",e?"true":"false"),this.dragOptionButton.setAttribute("aria-label",i),this.dragOptionButton.setAttribute("title",t),this.dragOptionText&&(this.dragOptionText.textContent=t)}updateResizeOptionState(){if(!this.resizeOptionButton)return;let e=!!(this.draggableResizable&&this.draggableResizable.pointerResizeMode),t=e?h.t("transcript.disableResizeMode"):h.t("transcript.enableResizeMode"),i=e?h.t("transcript.disableResizeModeAria"):h.t("transcript.enableResizeModeAria");this.resizeOptionButton.setAttribute("aria-checked",e?"true":"false"),this.resizeOptionButton.setAttribute("aria-label",i),this.resizeOptionButton.setAttribute("title",t),this.resizeOptionText&&(this.resizeOptionText.textContent=t)}toggleShowTimestamps(){this.showTimestamps=!this.showTimestamps,this.updateShowTimestampsState(),this.updateTimestampVisibility(),this.saveTimestampsPreference()}updateShowTimestampsState(){if(!this.showTimestampsButton)return;let e=this.showTimestamps?h.t("transcript.hideTimestamps"):h.t("transcript.showTimestamps"),t=this.showTimestamps?h.t("transcript.hideTimestampsAria"):h.t("transcript.showTimestampsAria");this.showTimestampsButton.setAttribute("aria-checked",this.showTimestamps?"true":"false"),this.showTimestampsButton.setAttribute("aria-label",t),this.showTimestampsButton.setAttribute("title",e),this.showTimestampsText&&(this.showTimestampsText.textContent=e)}updateTimestampVisibility(){if(!this.transcriptContent)return;this.transcriptContent.querySelectorAll(`.${this.player.options.classPrefix}-transcript-time`).forEach(t=>{t.style.display=this.showTimestamps?"":"none"})}saveTimestampsPreference(){let e=this.storage.getTranscriptPreferences()||{};e.showTimestamps=this.showTimestamps,this.storage.saveTranscriptPreferences(e)}showResizeModeIndicator(){if(!this.transcriptHeader)return;this.hideResizeModeIndicator();let e=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-resize-tooltip`,textContent:h.t("transcript.resizeModeHint")||"Resize handles enabled. Drag edges or corners to adjust. Press Esc or R to exit."});this.transcriptHeader.appendChild(e),this.resizeModeIndicator=e,this.resizeModeIndicatorTimeout=this.setManagedTimeout(()=>{this.hideResizeModeIndicator()},3e3)}hideResizeModeIndicator(){this.resizeModeIndicatorTimeout&&(this.clearManagedTimeout(this.resizeModeIndicatorTimeout),this.resizeModeIndicatorTimeout=null),this.resizeModeIndicator&&this.resizeModeIndicator.parentNode&&this.resizeModeIndicator.remove(),this.resizeModeIndicator=null}onPointerResizeModeChange(e){this.updateResizeOptionState(),e?(this.showResizeModeIndicator(),this.announceLive(h.t("transcript.resizeModeEnabled"))):(this.hideResizeModeIndicator(),this.announceLive(h.t("transcript.resizeModeDisabled")))}showStyleDialog(){if(this.styleDialog){this.styleDialog.style.display="block",this.styleDialogVisible=!0,this.handlers.styleDialogKeydown&&document.addEventListener("keydown",this.handlers.styleDialogKeydown),this.styleDialogJustOpened=!0,setTimeout(()=>{this.styleDialogJustOpened=!1},350),setTimeout(()=>{let c=this.styleDialog.querySelector("select, input");c&&c.focus({preventScroll:!0})},0);return}this.styleDialog=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-style-dialog`});let e=u.createElement("h4",{textContent:h.t("transcript.styleTitle"),className:`${this.player.options.classPrefix}-transcript-style-title`});this.styleDialog.appendChild(e);let t=this.createStyleSelectControl(h.t("captions.fontSize"),"fontSize",[{label:h.t("fontSizes.small"),value:"90%"},{label:h.t("fontSizes.normal"),value:"100%"},{label:h.t("fontSizes.large"),value:"110%"},{label:h.t("fontSizes.xlarge"),value:"120%"}]);this.styleDialog.appendChild(t);let i=this.createStyleSelectControl(h.t("captions.fontFamily"),"fontFamily",[{label:h.t("fontFamilies.sansSerif"),value:"sans-serif"},{label:h.t("fontFamilies.serif"),value:"serif"},{label:h.t("fontFamilies.monospace"),value:"monospace"}]);this.styleDialog.appendChild(i);let s=this.createStyleColorControl(h.t("captions.color"),"color");this.styleDialog.appendChild(s);let a=this.createStyleColorControl(h.t("captions.backgroundColor"),"backgroundColor");this.styleDialog.appendChild(a);let r=this.createStyleOpacityControl(h.t("captions.opacity"),"opacity");this.styleDialog.appendChild(r);let l=u.createElement("button",{className:`${this.player.options.classPrefix}-transcript-style-close`,textContent:h.t("settings.close"),attributes:{type:"button"}});l.addEventListener("click",()=>this.hideStyleDialog()),this.styleDialog.appendChild(l),this.handlers.styleDialogKeydown=c=>{if(this.styleDialogVisible){if(c.key==="Escape"){c.preventDefault(),c.stopPropagation(),this.hideStyleDialog();return}if(c.key==="Tab"){let o=this.styleDialog.querySelectorAll("select, input, button"),n=o[0],d=o[o.length-1];c.shiftKey&&document.activeElement===n?(c.preventDefault(),d.focus({preventScroll:!0})):!c.shiftKey&&document.activeElement===d&&(c.preventDefault(),n.focus({preventScroll:!0}))}}},document.addEventListener("keydown",this.handlers.styleDialogKeydown),this.headerLeft?this.headerLeft.appendChild(this.styleDialog):this.transcriptHeader.appendChild(this.styleDialog),this.applyTranscriptStyles(),this.styleDialogVisible=!0,this.styleDialog.style.display="block",this.styleDialogJustOpened=!0,setTimeout(()=>{this.styleDialogJustOpened=!1},350),setTimeout(()=>{let c=this.styleDialog.querySelector("select, input");c&&c.focus({preventScroll:!0})},0)}hideStyleDialog(){this.styleDialog&&(this.styleDialog.style.display="none",this.styleDialogVisible=!1,this.handlers.styleDialogKeydown&&document.removeEventListener("keydown",this.handlers.styleDialogKeydown),this.settingsButton&&this.settingsButton.focus({preventScroll:!0}))}createStyleSelectControl(e,t,i){let s=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-style-group`}),a=`${this.player.options.classPrefix}-transcript-${t}-${Date.now()}`,r=u.createElement("label",{textContent:e,attributes:{for:a}});s.appendChild(r);let l=u.createElement("select",{className:`${this.player.options.classPrefix}-transcript-style-select`,attributes:{id:a}});return i.forEach(c=>{let o=u.createElement("option",{textContent:c.label,attributes:{value:c.value}});this.transcriptStyle[t]===c.value&&(o.selected=!0),l.appendChild(o)}),l.addEventListener("change",c=>{this.transcriptStyle[t]=c.target.value,this.applyTranscriptStyles(),this.savePreferences()}),s.appendChild(l),s}createStyleColorControl(e,t){let i=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-style-group`}),s=`${this.player.options.classPrefix}-transcript-${t}-${Date.now()}`,a=u.createElement("label",{textContent:e,attributes:{for:s}});i.appendChild(a);let r=u.createElement("input",{attributes:{id:s,type:"color",value:this.transcriptStyle[t]},className:`${this.player.options.classPrefix}-transcript-style-color`});return r.addEventListener("input",l=>{this.transcriptStyle[t]=l.target.value,this.applyTranscriptStyles(),this.savePreferences()}),i.appendChild(r),i}createStyleOpacityControl(e,t){let i=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-style-group`}),s=`${this.player.options.classPrefix}-transcript-${t}-${Date.now()}`,a=u.createElement("label",{textContent:e,attributes:{for:s}});i.appendChild(a);let r=u.createElement("span",{textContent:Math.round(this.transcriptStyle[t]*100)+"%",className:`${this.player.options.classPrefix}-transcript-style-value`}),l=u.createElement("input",{attributes:{id:s,type:"range",min:"0",max:"1",step:"0.1",value:String(this.transcriptStyle[t])},className:`${this.player.options.classPrefix}-transcript-style-range`});l.addEventListener("input",o=>{let n=parseFloat(o.target.value);this.transcriptStyle[t]=n,r.textContent=Math.round(n*100)+"%",this.applyTranscriptStyles(),this.savePreferences()});let c=u.createElement("div",{className:`${this.player.options.classPrefix}-transcript-style-range-container`});return c.appendChild(l),c.appendChild(r),i.appendChild(a),i.appendChild(c),i}savePreferences(){this.storage.saveTranscriptPreferences(this.transcriptStyle)}applyTranscriptStyles(){if(!this.transcriptWindow)return;this.transcriptWindow.style.backgroundColor=this.transcriptStyle.backgroundColor,this.transcriptWindow.style.opacity=String(this.transcriptStyle.opacity),this.transcriptContent&&(this.transcriptContent.style.fontSize=this.transcriptStyle.fontSize,this.transcriptContent.style.fontFamily=this.transcriptStyle.fontFamily,this.transcriptContent.style.color=this.transcriptStyle.color),this.transcriptWindow.querySelectorAll(`.${this.player.options.classPrefix}-transcript-text`).forEach(i=>{i.style.fontSize=this.transcriptStyle.fontSize,i.style.fontFamily=this.transcriptStyle.fontFamily,i.style.color=this.transcriptStyle.color}),this.transcriptWindow.querySelectorAll(`.${this.player.options.classPrefix}-transcript-time`).forEach(i=>{i.style.fontFamily=this.transcriptStyle.fontFamily})}setManagedTimeout(e,t){let i=setTimeout(()=>{this.timeouts.delete(i),e()},t);return this.timeouts.add(i),i}clearManagedTimeout(e){e&&(clearTimeout(e),this.timeouts.delete(e))}destroy(){this.hideResizeModeIndicator(),this.draggableResizable&&(this.draggableResizable.pointerResizeMode&&(this.draggableResizable.disablePointerResizeMode(),this.updateResizeOptionState()),this.draggableResizable.destroy(),this.draggableResizable=null),this.transcriptWindow&&this.customKeyHandler&&(this.transcriptWindow.removeEventListener("keydown",this.customKeyHandler),this.customKeyHandler=null),this.handlers.timeupdate&&this.player.off("timeupdate",this.handlers.timeupdate),this.handlers.audiodescriptionenabled&&this.player.off("audiodescriptionenabled",this.handlers.audiodescriptionenabled),this.handlers.audiodescriptiondisabled&&this.player.off("audiodescriptiondisabled",this.handlers.audiodescriptiondisabled),this.settingsButton&&(this.handlers.settingsClick&&this.settingsButton.removeEventListener("click",this.handlers.settingsClick),this.handlers.settingsKeydown&&this.settingsButton.removeEventListener("keydown",this.handlers.settingsKeydown)),this.handlers.styleDialogKeydown&&document.removeEventListener("keydown",this.handlers.styleDialogKeydown),this.handlers.documentClick&&document.removeEventListener("click",this.handlers.documentClick),this.handlers.resize&&window.removeEventListener("resize",this.handlers.resize),this.timeouts.forEach(e=>clearTimeout(e)),this.timeouts.clear(),this.handlers=null,this.transcriptWindow&&this.transcriptWindow.parentNode&&this.transcriptWindow.parentNode.removeChild(this.transcriptWindow),this.transcriptWindow=null,this.transcriptHeader=null,this.transcriptContent=null,this.transcriptEntries=[],this.settingsMenu=null,this.styleDialog=null,this.transcriptResizeHandles=[],this.resizeOptionButton=null,this.resizeOptionText=null,this.liveRegion=null}announceLive(e){this.liveRegion&&(this.liveRegion.textContent=e||"")}};ne();var Z=class{constructor(e){this.player=e,this.youtube=null,this.videoId=null,this.isReady=!1,this.iframe=null}async init(){if(this.videoId=this.extractVideoId(this.player.element.src),!this.videoId)throw new Error("Invalid YouTube URL");await this.loadYouTubeAPI(),this.createIframe(),await this.initializePlayer()}extractVideoId(e){let t=[/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/,/youtube\.com\/embed\/([^&\s]+)/];for(let i of t){let s=e.match(i);if(s&&s[1])return s[1]}return null}async loadYouTubeAPI(){return window.YT&&window.YT.Player?Promise.resolve():new Promise((e,t)=>{if(window.onYouTubeIframeAPIReady){let a=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{a(),e()};return}let i=document.createElement("script");i.src="https://www.youtube.com/iframe_api",window.onYouTubeIframeAPIReady=()=>{e()},i.onerror=()=>t(new Error("Failed to load YouTube API"));let s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(i,s)})}createIframe(){this.player.element.style.display="none",this.iframe=document.createElement("div"),this.iframe.id=`youtube-player-${Math.random().toString(36).substr(2,9)}`,this.iframe.style.width="100%",this.iframe.style.height="100%",this.player.element.parentNode.insertBefore(this.iframe,this.player.element)}async initializePlayer(){return new Promise(e=>{this.youtube=new window.YT.Player(this.iframe.id,{videoId:this.videoId,width:"100%",height:"100%",playerVars:{controls:0,disablekb:1,fs:0,modestbranding:1,rel:0,showinfo:0,iv_load_policy:3,autoplay:this.player.options.autoplay?1:0,mute:this.player.options.muted?1:0,start:this.player.options.startTime||0},events:{onReady:t=>{this.isReady=!0,this.attachEvents(),e()},onStateChange:t=>this.handleStateChange(t),onError:t=>this.handleError(t)}})})}attachEvents(){this.timeUpdateInterval=setInterval(()=>{if(this.isReady&&this.youtube){let e=this.youtube.getCurrentTime(),t=this.youtube.getDuration();this.player.state.currentTime=e,this.player.state.duration=t,this.player.emit("timeupdate",e)}},250),this.youtube.getDuration&&(this.player.state.duration=this.youtube.getDuration(),this.player.emit("loadedmetadata"))}handleStateChange(e){let t=window.YT.PlayerState;switch(e.data){case t.PLAYING:this.player.state.playing=!0,this.player.state.paused=!1,this.player.state.ended=!1,this.player.state.buffering=!1,this.player.emit("play"),this.player.emit("playing"),this.player.options.onPlay&&this.player.options.onPlay.call(this.player);break;case t.PAUSED:this.player.state.playing=!1,this.player.state.paused=!0,this.player.emit("pause"),this.player.options.onPause&&this.player.options.onPause.call(this.player);break;case t.ENDED:this.player.state.playing=!1,this.player.state.paused=!0,this.player.state.ended=!0,this.player.emit("ended"),this.player.options.onEnded&&this.player.options.onEnded.call(this.player),this.player.options.loop&&(this.youtube.seekTo(0),this.youtube.playVideo());break;case t.BUFFERING:this.player.state.buffering=!0,this.player.emit("waiting");break;case t.CUED:this.player.emit("loadedmetadata");break}}handleError(e){let t={2:"Invalid video ID",5:"HTML5 player error",100:"Video not found",101:"Video not allowed to be played in embedded players",150:"Video not allowed to be played in embedded players"},i=new Error(t[e.data]||"YouTube player error");this.player.handleError(i)}play(){if(this.isReady&&this.youtube){let e=window.scrollX,t=window.scrollY;this.youtube.playVideo(),window.scrollTo(e,t)}}pause(){this.isReady&&this.youtube&&this.youtube.pauseVideo()}seek(e){this.isReady&&this.youtube&&this.youtube.seekTo(e,!0)}setVolume(e){this.isReady&&this.youtube&&(this.youtube.setVolume(e*100),this.player.state.volume=e)}setMuted(e){this.isReady&&this.youtube&&(e?this.youtube.mute():this.youtube.unMute(),this.player.state.muted=e)}setPlaybackSpeed(e){this.isReady&&this.youtube&&(this.youtube.setPlaybackRate(e),this.player.state.playbackSpeed=e)}destroy(){this.timeUpdateInterval&&clearInterval(this.timeUpdateInterval),this.youtube&&this.youtube.destroy&&this.youtube.destroy(),this.iframe&&this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),this.player.element&&(this.player.element.style.display="")}};var ee=class{constructor(e){this.player=e,this.vimeo=null,this.videoId=null,this.isReady=!1,this.iframe=null}async init(){if(this.videoId=this.extractVideoId(this.player.element.src),!this.videoId)throw new Error("Invalid Vimeo URL");await this.loadVimeoAPI(),this.createIframe(),await this.initializePlayer()}extractVideoId(e){let t=[/vimeo\.com\/(\d+)/,/vimeo\.com\/video\/(\d+)/,/player\.vimeo\.com\/video\/(\d+)/];for(let i of t){let s=e.match(i);if(s&&s[1])return s[1]}return null}async loadVimeoAPI(){return window.Vimeo&&window.Vimeo.Player?Promise.resolve():new Promise((e,t)=>{let i=document.createElement("script");i.src="https://player.vimeo.com/api/player.js",i.onload=()=>e(),i.onerror=()=>t(new Error("Failed to load Vimeo API")),document.head.appendChild(i)})}createIframe(){this.player.element.style.display="none",this.iframe=document.createElement("div"),this.iframe.id=`vimeo-player-${Math.random().toString(36).substr(2,9)}`,this.iframe.style.width="100%",this.iframe.style.height="100%",this.player.element.parentNode.insertBefore(this.iframe,this.player.element)}async initializePlayer(){let e={id:this.videoId,width:"100%",height:"100%",controls:!1,autoplay:this.player.options.autoplay,muted:this.player.options.muted,loop:this.player.options.loop,keyboard:!1};this.player.options.startTime>0&&(e.startTime=this.player.options.startTime),this.vimeo=new window.Vimeo.Player(this.iframe.id,e),await this.vimeo.ready(),this.isReady=!0,this.attachEvents();try{let t=await this.vimeo.getDuration();this.player.state.duration=t,this.player.emit("loadedmetadata")}catch(t){this.player.log("Error getting duration:",t,"warn")}}attachEvents(){this.vimeo.on("play",()=>{this.player.state.playing=!0,this.player.state.paused=!1,this.player.state.ended=!1,this.player.emit("play"),this.player.options.onPlay&&this.player.options.onPlay.call(this.player)}),this.vimeo.on("pause",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.emit("pause"),this.player.options.onPause&&this.player.options.onPause.call(this.player)}),this.vimeo.on("ended",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.state.ended=!0,this.player.emit("ended"),this.player.options.onEnded&&this.player.options.onEnded.call(this.player)}),this.vimeo.on("timeupdate",e=>{this.player.state.currentTime=e.seconds,this.player.state.duration=e.duration,this.player.emit("timeupdate",e.seconds),this.player.options.onTimeUpdate&&this.player.options.onTimeUpdate.call(this.player,e.seconds)}),this.vimeo.on("volumechange",e=>{this.player.state.volume=e.volume,this.player.emit("volumechange",e.volume)}),this.vimeo.on("bufferstart",()=>{this.player.state.buffering=!0,this.player.emit("waiting")}),this.vimeo.on("bufferend",()=>{this.player.state.buffering=!1,this.player.emit("canplay")}),this.vimeo.on("seeking",()=>{this.player.state.seeking=!0,this.player.emit("seeking")}),this.vimeo.on("seeked",()=>{this.player.state.seeking=!1,this.player.emit("seeked")}),this.vimeo.on("playbackratechange",e=>{this.player.state.playbackSpeed=e.playbackRate,this.player.emit("ratechange",e.playbackRate)}),this.vimeo.on("error",e=>{this.player.handleError(new Error(`Vimeo error: ${e.message}`))})}play(){if(this.isReady&&this.vimeo){let e=window.scrollX,t=window.scrollY;this.vimeo.play().catch(i=>{this.player.log("Play error:",i,"warn")}),window.scrollTo(e,t)}}pause(){this.isReady&&this.vimeo&&this.vimeo.pause().catch(e=>{this.player.log("Pause error:",e,"warn")})}seek(e){this.isReady&&this.vimeo&&this.vimeo.setCurrentTime(e).catch(t=>{this.player.log("Seek error:",t,"warn")})}setVolume(e){this.isReady&&this.vimeo&&(this.vimeo.setVolume(e).catch(t=>{this.player.log("Volume error:",t,"warn")}),this.player.state.volume=e)}setMuted(e){this.isReady&&this.vimeo&&(e?this.vimeo.setVolume(0):this.vimeo.setVolume(this.player.state.volume),this.player.state.muted=e)}setPlaybackSpeed(e){this.isReady&&this.vimeo&&(this.vimeo.setPlaybackRate(e).catch(t=>{this.player.log("Playback rate error:",t,"warn")}),this.player.state.playbackSpeed=e)}destroy(){this.vimeo&&this.vimeo.destroy&&this.vimeo.destroy(),this.iframe&&this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),this.player.element&&(this.player.element.style.display="")}};var te=class{constructor(e){this.player=e,this.media=e.element,this.hls=null}async init(){this.canPlayNatively()?(this.player.log("Using native HLS support"),await this.initNative()):(this.player.log("Using hls.js for HLS support"),await this.initHlsJs())}canPlayNatively(){let e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),t=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;return!e&&!t?!1:document.createElement("video").canPlayType("application/vnd.apple.mpegurl")!==""}async initNative(){let e=(await Promise.resolve().then(()=>(ne(),me))).HTML5Renderer,t=new e(this.player);await t.init(),Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(i=>{i!=="constructor"&&typeof t[i]=="function"&&(this[i]=t[i].bind(t))})}async initHlsJs(){if(this.media.controls=!1,this.media.removeAttribute("controls"),window.Hls||await this.loadHlsJs(),!window.Hls.isSupported())throw new Error("HLS is not supported in this browser");this.hls=new window.Hls({debug:this.player.options.debug,enableWorker:!0,lowLatencyMode:!1,backBufferLength:90,maxBufferLength:30,maxMaxBufferLength:600,maxBufferSize:60*1e3*1e3,maxBufferHole:.5,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:4,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3}),this.hls.attachMedia(this.media);let e,t=this.player.element.querySelector("source");if(t?e=t.getAttribute("src"):e=this.player.element.getAttribute("src")||this.player.element.src,this.player.log(`Loading HLS source: ${e}`,"log"),!e)throw new Error("No HLS source found");this.hls.loadSource(e),this.attachHlsEvents(),this.attachMediaEvents()}async loadHlsJs(){return new Promise((e,t)=>{let i=document.createElement("script");i.src="https://cdn.jsdelivr.net/npm/hls.js@latest",i.onload=()=>e(),i.onerror=()=>t(new Error("Failed to load hls.js")),document.head.appendChild(i)})}attachHlsEvents(){this.hls.on(window.Hls.Events.MANIFEST_PARSED,(e,t)=>{this.player.log("HLS manifest loaded, found "+t.levels.length+" quality levels"),this.player.emit("hlsmanifestparsed",t)}),this.hls.on(window.Hls.Events.LEVEL_SWITCHED,(e,t)=>{this.player.log("HLS level switched to "+t.level),this.player.emit("hlslevelswitched",t)}),this.hls.on(window.Hls.Events.ERROR,(e,t)=>{this.handleHlsError(t)}),this.hls.on(window.Hls.Events.FRAG_BUFFERED,()=>{this.player.state.buffering=!1})}attachMediaEvents(){this.media.addEventListener("loadedmetadata",()=>{this.player.state.duration=this.media.duration,this.player.emit("loadedmetadata")}),this.media.addEventListener("play",()=>{this.player.state.playing=!0,this.player.state.paused=!1,this.player.state.ended=!1,this.player.emit("play"),this.player.options.onPlay&&this.player.options.onPlay.call(this.player)}),this.media.addEventListener("pause",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.emit("pause"),this.player.options.onPause&&this.player.options.onPause.call(this.player)}),this.media.addEventListener("ended",()=>{this.player.state.playing=!1,this.player.state.paused=!0,this.player.state.ended=!0,this.player.emit("ended"),this.player.options.onEnded&&this.player.options.onEnded.call(this.player),this.player.options.loop&&(this.player.seek(0),this.player.play())}),this.media.addEventListener("timeupdate",()=>{this.player.state.currentTime=this.media.currentTime,this.player.emit("timeupdate",this.media.currentTime),this.player.options.onTimeUpdate&&this.player.options.onTimeUpdate.call(this.player,this.media.currentTime)}),this.media.addEventListener("volumechange",()=>{this.player.state.volume=this.media.volume,this.player.state.muted=this.media.muted,this.player.emit("volumechange",this.media.volume)}),this.media.addEventListener("waiting",()=>{this.player.state.buffering=!0,this.player.emit("waiting")}),this.media.addEventListener("canplay",()=>{this.player.state.buffering=!1,this.player.emit("canplay")}),this.media.addEventListener("error",()=>{this.player.handleError(this.media.error)})}handleHlsError(e){if(this.player.log(`HLS Error - Type: ${e.type}, Details: ${e.details}, Fatal: ${e.fatal}`,"warn"),e.response&&this.player.log(`Response code: ${e.response.code}, URL: ${e.response.url}`,"warn"),e.fatal)switch(e.type){case window.Hls.ErrorTypes.NETWORK_ERROR:this.player.log("Fatal network error, trying to recover...","error"),this.player.log(`Network error details: ${e.details}`,"error"),setTimeout(()=>{this.hls.startLoad()},1e3);break;case window.Hls.ErrorTypes.MEDIA_ERROR:this.player.log("Fatal media error, trying to recover...","error"),this.hls.recoverMediaError();break;default:this.player.log("Fatal error, cannot recover","error"),this.player.handleError(new Error(`HLS Error: ${e.type} - ${e.details}`)),this.hls.destroy();break}else this.player.log("Non-fatal HLS error: "+e.details,"warn")}play(){let e=window.scrollX,t=window.scrollY,i=this.media.play();window.scrollTo(e,t),i!==void 0&&i.catch(s=>{this.player.log("Play failed:",s,"warn")})}pause(){this.media.pause()}seek(e){this.media.currentTime=e}setVolume(e){this.media.volume=e}setMuted(e){this.media.muted=e}setPlaybackSpeed(e){this.media.playbackRate=e}switchQuality(e){this.hls&&(this.hls.currentLevel=e)}getQualities(){return this.hls&&this.hls.levels?this.hls.levels.map((e,t)=>({index:t,height:e.height,width:e.width,bitrate:e.bitrate,name:`${e.height}p`})):[]}destroy(){this.hls&&(this.hls.destroy(),this.hls=null)}};var ye=0,F=class p extends _{constructor(e,t={}){if(super(),this.element=typeof e=="string"?document.querySelector(e):e,!this.element)throw new Error("VidPly: Element not found");if(ye++,this.instanceId=ye,this.element.tagName!=="VIDEO"&&this.element.tagName!=="AUDIO"){let s=t.mediaType||"video",a=document.createElement(s);Array.from(this.element.attributes).forEach(l=>{l.name!=="id"&&l.name!=="class"&&!l.name.startsWith("data-")&&a.setAttribute(l.name,l.value)}),this.element.querySelectorAll("track").forEach(l=>{a.appendChild(l.cloneNode(!0))}),this.element.innerHTML="",this.element.appendChild(a),this.element=a}this.options={width:null,height:null,poster:null,responsive:!0,fillContainer:!1,autoplay:!1,loop:!1,muted:!1,volume:.8,playbackSpeed:1,preload:"metadata",startTime:0,playsInline:!0,controls:!0,hideControlsDelay:3e3,playPauseButton:!0,progressBar:!0,currentTime:!0,duration:!0,volumeControl:!0,muteButton:!0,chaptersButton:!0,qualityButton:!0,captionStyleButton:!0,speedButton:!0,captionsButton:!0,transcriptButton:!0,fullscreenButton:!0,pipButton:!1,seekInterval:10,seekIntervalLarge:30,captions:!0,captionsDefault:!1,captionsFontSize:"100%",captionsFontFamily:"sans-serif",captionsColor:"#FFFFFF",captionsBackgroundColor:"#000000",captionsOpacity:.8,audioDescription:!0,audioDescriptionSrc:null,audioDescriptionButton:!0,signLanguage:!0,signLanguageSrc:null,signLanguageButton:!0,signLanguagePosition:"bottom-right",transcript:!1,transcriptPosition:"external",transcriptContainer:null,keyboard:!0,keyboardShortcuts:{"play-pause":[" ","p","k"],"volume-up":["ArrowUp"],"volume-down":["ArrowDown"],"seek-forward":["ArrowRight"],"seek-backward":["ArrowLeft"],mute:["m"],fullscreen:["f"],captions:["c"],"caption-style-menu":["a"],"speed-up":[">"],"speed-down":["<"],"speed-menu":["s"],"quality-menu":["q"],"chapters-menu":["j"],"transcript-toggle":["t"]},ariaLabels:{},screenReaderAnnouncements:!0,highContrast:!1,focusHighlight:!0,metadataAlerts:{},metadataHashtags:{},language:"en",languages:["en"],debug:!1,classPrefix:"vidply",iconType:"svg",pauseOthersOnPlay:!0,onReady:null,onPlay:null,onPause:null,onEnded:null,onTimeUpdate:null,onVolumeChange:null,onError:null,...t},this.options.metadataAlerts=this.options.metadataAlerts||{},this.options.metadataHashtags=this.options.metadataHashtags||{},this.storage=new B("vidply");let i=this.storage.getPlayerPreferences();i&&(i.volume!==void 0&&(this.options.volume=i.volume),i.playbackSpeed!==void 0&&(this.options.playbackSpeed=i.playbackSpeed),i.muted!==void 0&&(this.options.muted=i.muted)),this.state={ready:!1,playing:!1,paused:!0,ended:!1,buffering:!1,seeking:!1,muted:this.options.muted,volume:this.options.volume,currentTime:0,duration:0,playbackSpeed:this.options.playbackSpeed,fullscreen:!1,pip:!1,captionsEnabled:this.options.captionsDefault,currentCaption:null,controlsVisible:!0,audioDescriptionEnabled:!1,signLanguageEnabled:!1},this.originalSrc=null,this.audioDescriptionSrc=this.options.audioDescriptionSrc,this.signLanguageSrc=this.options.signLanguageSrc,this.signLanguageSources=this.options.signLanguageSources||{},this.currentSignLanguage=null,this.signLanguageVideo=null,this.audioDescriptionSourceElement=null,this.originalAudioDescriptionSource=null,this.audioDescriptionCaptionTracks=[],this._audioDescriptionDesiredState=!1,this._textTracksCache=null,this._textTracksDirty=!0,this._sourceElementsCache=null,this._sourceElementsDirty=!0,this._trackElementsCache=null,this._trackElementsDirty=!0,this.timeouts=new Set,this.container=null,this.renderer=null,this.controlBar=null,this.captionManager=null,this.keyboardManager=null,this.settingsDialog=null,this.metadataCueChangeHandler=null,this.metadataAlertHandlers=new Map,this.init()}async init(){var e;try{if(this.log("Initializing VidPly player"),this.options.languageFiles)try{await h.loadLanguagesFromUrls(this.options.languageFiles)}catch(i){console.warn("Failed to load some language files:",i)}if(this.options.languageFile&&this.options.languageFileUrl)try{await h.loadLanguageFromUrl(this.options.languageFile,this.options.languageFileUrl),this.log(`Custom language file loaded for ${this.options.languageFile}`)}catch(i){console.warn(`Failed to load language file for ${this.options.languageFile}:`,i)}if(!this.options.language||this.options.language==="en"){let i=this.detectHtmlLanguage();i&&(this.options.language=i,this.log(`Auto-detected language from HTML: ${i}`))}this.options.language||(this.options.language="en"),h.setLanguage(this.options.language),this.createContainer(),this.element.src||((e=this.element.querySelector("source"))==null?void 0:e.src)?await this.initializeRenderer():this.log("No initial source - waiting for playlist or manual load"),this.options.controls&&(this.controlBar=new Q(this),this.videoWrapper.appendChild(this.controlBar.element)),this.options.captions&&(this.captionManager=new N(this)),(this.options.transcript||this.options.transcriptButton)&&(this.transcriptManager=new I(this)),this.setupMetadataHandling(),this.options.keyboard&&(this.keyboardManager=new Y(this)),this.setupResponsiveHandlers(),this.options.startTime>0&&this.seek(this.options.startTime),requestAnimationFrame(()=>{this.options.muted?this.mute():this.renderer&&this.renderer.media&&this.renderer.setMuted(!1),this.options.volume!==.8?this.setVolume(this.options.volume):this.renderer&&this.renderer.media&&this.renderer.setVolume(this.options.volume)}),this.state.ready=!0,this.emit("ready"),this.options.onReady&&this.options.onReady.call(this),this.options.autoplay&&this.play(),this.log("Player initialized successfully")}catch(t){this.handleError(t)}}detectHtmlLanguage(){let e=document.documentElement.lang||document.documentElement.getAttribute("lang");if(!e)return null;let t=e.toLowerCase().split("-")[0];return h.translations[t]?t:(this.log(`Language "${e}" not available, using English as fallback`),null)}createContainer(){let e=this.instanceId>1?`${h.t("player.label")} ${this.instanceId}`:h.t("player.label");this.container=u.createElement("div",{className:`${this.options.classPrefix}-player`,attributes:{role:"application","aria-label":e,tabindex:"0"}});let t=this.element.tagName.toLowerCase();this.container.classList.add(`${this.options.classPrefix}-${t}`),this.options.responsive&&this.container.classList.add(`${this.options.classPrefix}-responsive`),this.videoWrapper=u.createElement("div",{className:`${this.options.classPrefix}-video-wrapper`}),this.element.parentNode.insertBefore(this.container,this.element),this.element.tagName==="AUDIO"&&this.options.poster&&(this.trackArtworkElement=u.createElement("div",{className:`${this.options.classPrefix}-track-artwork`,attributes:{"aria-hidden":"true"}}),this.trackArtworkElement.style.backgroundImage=`url(${this.options.poster})`,this.container.appendChild(this.trackArtworkElement)),this.container.appendChild(this.videoWrapper),this.videoWrapper.appendChild(this.element),this.element.controls=!1,this.element.removeAttribute("controls"),this.element.setAttribute("tabindex","-1"),this.element.style.width="100%",this.element.style.height="100%",this.element.tagName==="VIDEO"&&this.options.playsInline&&(this.element.setAttribute("playsinline",""),this.element.playsInline=!0),this.options.width&&(this.container.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width),this.options.height&&(this.container.style.height=typeof this.options.height=="number"?`${this.options.height}px`:this.options.height),this.options.poster&&this.element.tagName==="VIDEO"&&(this.element.poster=this.resolvePosterPath(this.options.poster)),this.element.tagName==="VIDEO"&&this.createPlayButtonOverlay(),this.element.vidply=this,p.instances.push(this),this.element.style.cursor="pointer",this.element.addEventListener("click",i=>{i.target===this.element&&this.toggle()}),this.on("play",()=>{this.hidePosterOverlay()}),this.on("timeupdate",()=>{this.state.currentTime>0&&this.hidePosterOverlay()}),this.element.addEventListener("loadeddata",()=>{(this.state.playing||this.state.currentTime>0)&&this.hidePosterOverlay()},{once:!0})}createPlayButtonOverlay(){this.playButtonOverlay=pe(),this.playButtonOverlay.addEventListener("click",()=>{this.toggle()}),this.videoWrapper.appendChild(this.playButtonOverlay),this.on("play",()=>{this.playButtonOverlay.style.opacity="0",this.playButtonOverlay.style.pointerEvents="none"}),this.on("pause",()=>{this.playButtonOverlay.style.opacity="1",this.playButtonOverlay.style.pointerEvents="auto",this.positionPlayOverlayOnMobile()}),this.on("ended",()=>{this.playButtonOverlay.style.opacity="1",this.playButtonOverlay.style.pointerEvents="auto",this.positionPlayOverlayOnMobile()}),this.debouncedPositionPlayOverlay=j(()=>{this.positionPlayOverlayOnMobile()},150),window.addEventListener("resize",this.debouncedPositionPlayOverlay),this.on("loadedmetadata",()=>{this.positionPlayOverlayOnMobile()}),this.on("enterfullscreen",()=>{O(()=>this.positionPlayOverlayOnMobile(),100)}),this.on("exitfullscreen",()=>{O(()=>this.positionPlayOverlayOnMobile(),100)})}positionPlayOverlayOnMobile(){if(!this.playButtonOverlay||this.element.tagName!=="VIDEO")return;if(!X()){this.playButtonOverlay.style.top="";return}let t=this.element.getBoundingClientRect(),i=this.videoWrapper.getBoundingClientRect(),s=t.top-i.top+t.height/2;this.playButtonOverlay.style.top=`${s}px`}async initializeRenderer(){var a;let e=this.element.src||((a=this.element.querySelector("source"))==null?void 0:a.src);if(!e)throw new Error("No media source found");let t=this.sourceElements;for(let r of t){let l=r.getAttribute("data-desc-src"),c=r.getAttribute("data-orig-src");if(l||c){if(this.audioDescriptionSourceElement||(this.audioDescriptionSourceElement=r),c)this.originalAudioDescriptionSource||(this.originalAudioDescriptionSource=c),this.originalSrc||(this.originalSrc=c);else{let o=r.getAttribute("src");!this.originalAudioDescriptionSource&&o&&(this.originalAudioDescriptionSource=o),!this.originalSrc&&o&&(this.originalSrc=o)}l&&!this.audioDescriptionSrc&&(this.audioDescriptionSrc=l)}}this.trackElements.forEach(r=>{let l=r.getAttribute("kind"),c=r.getAttribute("data-desc-src");(l==="captions"||l==="subtitles"||l==="chapters")&&c&&(this.audioDescriptionCaptionTracks.push({trackElement:r,originalSrc:r.getAttribute("src"),describedSrc:c,originalTrackSrc:r.getAttribute("data-orig-src")||r.getAttribute("src"),explicit:!0}),this.log(`Found explicit described ${l} track: ${r.getAttribute("src")} -> ${c}`))}),this.originalSrc||(this.originalSrc=e);let s;e.includes("youtube.com")||e.includes("youtu.be")?s=Z:e.includes("vimeo.com")?s=ee:e.includes(".m3u8")?s=te:s=q,this.log(`Using ${s.name} renderer`),this.renderer=new s(this),await this.renderer.init(),this.invalidateTrackCache()}get textTracks(){return(!this._textTracksCache||this._textTracksDirty)&&(this._textTracksCache=Array.from(this.element.textTracks||[]),this._textTracksDirty=!1),this._textTracksCache}get sourceElements(){return(!this._sourceElementsCache||this._sourceElementsDirty)&&(this._sourceElementsCache=Array.from(this.element.querySelectorAll("source")),this._sourceElementsDirty=!1),this._sourceElementsCache}get trackElements(){return(!this._trackElementsCache||this._trackElementsDirty)&&(this._trackElementsCache=Array.from(this.element.querySelectorAll("track")),this._trackElementsDirty=!1),this._trackElementsCache}invalidateTrackCache(){this._textTracksDirty=!0,this._trackElementsDirty=!0,this._sourceElementsDirty=!0}findTextTrack(e,t=null){let i=this.textTracks;return t?i.find(s=>s.kind===e&&s.language===t):i.find(s=>s.kind===e)}findSourceElement(e,t=null){let i=this.sourceElements;return t?i.find(s=>s.getAttribute(e)===t):i.find(s=>s.hasAttribute(e))}findTrackElement(e){return this.trackElements.find(t=>t.track===e)}resolvePosterPath(e){if(!e||e.match(/^(https?:|\/)/))return e;try{return new URL(e,window.location.href).href}catch{return e}}showPosterOverlay(){if(!this.videoWrapper||this.element.tagName!=="VIDEO")return;let e=this.element.getAttribute("poster")||this.element.poster||this.options.poster;if(!e)return;let t=this.resolvePosterPath(e);this.videoWrapper.style.setProperty("--vidply-poster-image",`url("${t}")`),this.videoWrapper.classList.add("vidply-forced-poster")}hidePosterOverlay(){this.videoWrapper&&(this.videoWrapper.classList.remove("vidply-forced-poster"),this.videoWrapper.style.removeProperty("--vidply-poster-image"))}setManagedTimeout(e,t){let i=setTimeout(()=>{this.timeouts.delete(i),e()},t);return this.timeouts.add(i),i}clearManagedTimeout(e){e&&(clearTimeout(e),this.timeouts.delete(e))}async load(e){try{this.log("Loading new media:",e.src),this.renderer&&this.pause();let t=window.scrollX||window.pageXOffset,i=window.scrollY||window.pageYOffset;this.trackElements.forEach(c=>c.remove()),this.invalidateTrackCache(),this.element.src=e.src,e.type&&(this.element.type=e.type),e.poster&&this.element.tagName==="VIDEO"&&(this.element.poster=this.resolvePosterPath(e.poster)),e.tracks&&e.tracks.length>0&&(e.tracks.forEach(c=>{let o=document.createElement("track");o.src=c.src,o.kind=c.kind||"captions",o.srclang=c.srclang||"en",o.label=c.label||c.srclang,c.default&&(o.default=!0),this.element.appendChild(o)}),this.invalidateTrackCache());let a=this.state.signLanguageEnabled,r=this.state.audioDescriptionEnabled;this.audioDescriptionSrc=e.audioDescriptionSrc||null,this.signLanguageSrc=e.signLanguageSrc||null,this.originalSrc=e.src,r&&this.disableAudioDescription(),a&&this.disableSignLanguage();let l=this.shouldChangeRenderer(e.src);if(l&&this.renderer&&(this.renderer.destroy(),this.renderer=null),!this.renderer||l?await this.initializeRenderer():(this.renderer.media=this.element,this.element.load()),window.scrollTo(t,i),this.captionManager&&(this.captionManager.destroy(),this.captionManager=new N(this)),this.transcriptManager){let c=this.transcriptManager.isVisible;this.transcriptManager.destroy(),this.transcriptManager=new I(this),c&&this.controlBar&&this.controlBar.hasCaptionTracks()&&this.transcriptManager.showTranscript()}this.controlBar&&this.updateControlBar(),window.scrollTo(t,i),a&&this.signLanguageSrc&&setTimeout(()=>{this.enableSignLanguage(),window.scrollTo(t,i)},150),r&&this.audioDescriptionSrc&&setTimeout(()=>{this.enableAudioDescription(),window.scrollTo(t,i)},150),this.emit("sourcechange",e),this.log("Media loaded successfully")}catch(t){this.handleError(t)}}updateControlBar(){if(!this.controlBar)return;let e=this.controlBar;e.element.innerHTML="",e.createControls(),e.attachEvents(),e.setupAutoHide(),e.setupOverflowDetection()}shouldChangeRenderer(e){if(!this.renderer)return!0;let t=e.includes("youtube.com")||e.includes("youtu.be"),i=e.includes("vimeo.com"),s=e.includes(".m3u8"),a=this.renderer.constructor.name;return!!(t&&a!=="YouTubeRenderer"||i&&a!=="VimeoRenderer"||s&&a!=="HLSRenderer"||!t&&!i&&!s&&a!=="HTML5Renderer")}play(){this.renderer&&this.renderer.play()}pause(){this.renderer&&this.renderer.pause()}stop(){this.pause(),this.seek(0)}toggle(){this.state.playing?this.pause():this.play()}seek(e){this.renderer&&this.renderer.seek(e)}seekForward(e=this.options.seekInterval){this.seek(Math.min(this.state.currentTime+e,this.state.duration))}seekBackward(e=this.options.seekInterval){this.seek(Math.max(this.state.currentTime-e,0))}setVolume(e){let t=Math.max(0,Math.min(1,e));this.renderer&&this.renderer.setVolume(t),this.state.volume=t,t>0&&this.state.muted&&(this.state.muted=!1,this.renderer&&this.renderer.setMuted(!1),this.emit("volumechange")),this.savePlayerPreferences()}getVolume(){return this.state.volume}mute(){this.renderer&&this.renderer.setMuted(!0),this.state.muted=!0,this.savePlayerPreferences(),this.emit("volumechange")}unmute(){this.renderer&&this.renderer.setMuted(!1),this.state.muted=!1,this.savePlayerPreferences(),this.emit("volumechange")}toggleMute(){this.state.muted?this.unmute():this.mute()}setPlaybackSpeed(e){let t=Math.max(.25,Math.min(2,e));this.renderer&&this.renderer.setPlaybackSpeed(t),this.state.playbackSpeed=t,this.savePlayerPreferences(),this.emit("playbackspeedchange",t)}getPlaybackSpeed(){return this.state.playbackSpeed}savePlayerPreferences(){this.storage.savePlayerPreferences({volume:this.state.volume,muted:this.state.muted,playbackSpeed:this.state.playbackSpeed})}enterFullscreen(){let e=this.container,t=null;if(/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1){this._enablePseudoFullscreen();return}e.requestFullscreen?t=e.requestFullscreen():e.webkitRequestFullscreen?t=e.webkitRequestFullscreen():e.mozRequestFullScreen?t=e.mozRequestFullScreen():e.msRequestFullscreen&&(t=e.msRequestFullscreen()),t&&t.catch&&t.catch(s=>{this.log("Fullscreen API failed, using pseudo-fullscreen:",s.message),this._enablePseudoFullscreen()}),!e.requestFullscreen&&!e.webkitRequestFullscreen&&!e.mozRequestFullScreen&&!e.msRequestFullscreen?this._enablePseudoFullscreen():(this.state.fullscreen=!0,this.container.classList.add(`${this.options.classPrefix}-fullscreen`),this.emit("fullscreenchange",!0))}exitFullscreen(){!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():this._disablePseudoFullscreen(),this.state.fullscreen=!1,this.container.classList.remove(`${this.options.classPrefix}-fullscreen`),this.emit("fullscreenchange",!1)}toggleFullscreen(){this.state.fullscreen?this.exitFullscreen():this.enterFullscreen()}_enablePseudoFullscreen(){var t;this.state.fullscreen=!0,this.container.classList.add(`${this.options.classPrefix}-fullscreen`),this._originalScrollX=window.scrollX||window.pageXOffset,this._originalScrollY=window.scrollY||window.pageYOffset,this._originalBodyOverflow=document.body.style.overflow,this._originalBodyPosition=document.body.style.position,this._originalBodyWidth=document.body.style.width,this._originalBodyHeight=document.body.style.height,this._originalHtmlOverflow=document.documentElement.style.overflow,document.body.style.overflow="hidden",document.body.style.width="100%",document.body.style.height="100%",document.documentElement.style.overflow="hidden",this._originalViewport=(t=document.querySelector('meta[name="viewport"]'))==null?void 0:t.getAttribute("content");let e=document.querySelector('meta[name="viewport"]');e&&e.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"),window.scrollTo(0,0),this.emit("fullscreenchange",!0),this.emit("enterfullscreen")}_disablePseudoFullscreen(){if(this._originalBodyOverflow!==void 0&&(document.body.style.overflow=this._originalBodyOverflow,delete this._originalBodyOverflow),this._originalBodyPosition!==void 0&&(document.body.style.position=this._originalBodyPosition,delete this._originalBodyPosition),this._originalBodyWidth!==void 0&&(document.body.style.width=this._originalBodyWidth,delete this._originalBodyWidth),this._originalBodyHeight!==void 0&&(document.body.style.height=this._originalBodyHeight,delete this._originalBodyHeight),this._originalHtmlOverflow!==void 0&&(document.documentElement.style.overflow=this._originalHtmlOverflow,delete this._originalHtmlOverflow),this._originalViewport!==void 0){let e=document.querySelector('meta[name="viewport"]');e&&e.setAttribute("content",this._originalViewport),delete this._originalViewport}this._originalScrollX!==void 0&&this._originalScrollY!==void 0&&(window.scrollTo(this._originalScrollX,this._originalScrollY),delete this._originalScrollX,delete this._originalScrollY),this.emit("exitfullscreen")}enterPiP(){this.element.requestPictureInPicture&&(this.element.requestPictureInPicture(),this.state.pip=!0,this.emit("pipchange",!0))}exitPiP(){document.pictureInPictureElement&&(document.exitPictureInPicture(),this.state.pip=!1,this.emit("pipchange",!1))}togglePiP(){this.state.pip?this.exitPiP():this.enterPiP()}enableCaptions(){this.captionManager&&(this.captionManager.enable(),this.state.captionsEnabled=!0)}disableCaptions(){this.captionManager&&(this.captionManager.disable(),this.state.captionsEnabled=!1)}toggleCaptions(){this.state.captionsEnabled?this.disableCaptions():this.enableCaptions()}async validateTrackExists(e){try{return(await fetch(e,{method:"HEAD",cache:"no-cache"})).ok}catch{return!1}}stripVTTFormatting(e){return e?e.replace(/<[^>]+>/g,"").replace(/\n/g," ").trim().toLowerCase():""}findMatchingCaptionTime(e,t){if(!e||!t||t.length===0)return null;let i=this.stripVTTFormatting(e);for(let s of t){if(s.kind!=="captions"&&s.kind!=="subtitles")continue;let a=s.track;if(!(!a||!a.cues))for(let r=0;r<a.cues.length;r++){let l=a.cues[r],c=this.stripVTTFormatting(l.text);if(c===i)return l.startTime;let o=i.split(/\s+/).filter(d=>d.length>2),n=c.split(/\s+/).filter(d=>d.length>2);if(o.length>0&&n.length>0&&o.filter(g=>n.includes(g)).length/o.length>=.8)return l.startTime}}return null}async enableAudioDescription(){let e=this.sourceElements.some(n=>n.getAttribute("data-desc-src")),t=this.audioDescriptionCaptionTracks.length>0;if(!this.audioDescriptionSrc&&!e&&!t){console.warn("VidPly: No audio description source, source elements, or tracks provided");return}let i=this.element.currentTime,s=this.state.playing,a=!s&&i===0,r=null;if(this.captionManager&&this.captionManager.currentTrack){let n=this.captionManager.currentTrack.track;if(n&&n.activeCues&&n.activeCues.length>0){let d=n.activeCues[0];r=this.stripVTTFormatting(d.text)}}let l=this.resolvePosterPath(this.element.getAttribute("poster")||this.element.poster||this.options.poster);a&&this.showPosterOverlay();let c=[];if(this.audioDescriptionSourceElement){let n=this.element.currentSrc||this.element.src,d=this.sourceElements,m=null,g=this.audioDescriptionSrc;for(let y of d){let v=y.getAttribute("src"),E=y.getAttribute("data-desc-src"),M=v?v.split("/").pop():"",w=n?n.split("/").pop():"";if(n&&(n===v||n.includes(v)||n.includes(M)||M&&w===M)){m=y,E?g=E:v&&(g=this.audioDescriptionSrc||g);break}}if(!m){m=this.audioDescriptionSourceElement;let y=m.getAttribute("data-desc-src");y&&(g=y)}if(this.audioDescriptionCaptionTracks.length>0){let y=this.audioDescriptionCaptionTracks.map(async M=>{if(M.trackElement&&M.describedSrc)if(M.explicit===!0)try{let w=await this.validateTrackExists(M.describedSrc);return{trackInfo:M,exists:w}}catch{return{trackInfo:M,exists:!1}}else return{trackInfo:M,exists:!1};return{trackInfo:M,exists:!1}}),v=await Promise.all(y),E=v.filter(M=>M.exists);if(E.length>0){let M=new Map;E.forEach(({trackInfo:L})=>{let P=L.trackElement.track;P?M.set(L,{wasShowing:P.mode==="showing",wasHidden:P.mode==="hidden"}):M.set(L,{wasShowing:!1,wasHidden:!1})});let w=E.map(({trackInfo:L})=>{let P=L.trackElement.getAttribute("src"),D=L.trackElement.parentNode,K=L.trackElement.nextSibling,C={};return Array.from(L.trackElement.attributes).forEach(z=>{C[z.name]=z.value}),{trackInfo:L,oldSrc:P,parent:D,nextSibling:K,attributes:C}});w.forEach(({trackInfo:L})=>{L.trackElement.remove()}),this.element.load(),await new Promise(L=>{setTimeout(()=>{w.forEach(({trackInfo:D,oldSrc:K,parent:C,nextSibling:z,attributes:$})=>{c.push(D);let W=document.createElement("track");W.setAttribute("src",D.describedSrc),Object.keys($).forEach(U=>{U!=="src"&&U!=="data-desc-src"&&W.setAttribute(U,$[U])}),z&&z.parentNode?C.insertBefore(W,z):C.appendChild(W),D.trackElement=W}),this.invalidateTrackCache();let P=()=>{this.setManagedTimeout(()=>{c.forEach(D=>{let C=D.trackElement.track;if(C){let z=M.get(D)||{wasShowing:!1,wasHidden:!1};C.mode="hidden";let $=()=>{z.wasShowing||z.wasHidden?C.mode="hidden":C.mode="disabled"};C.readyState>=2?$():(C.addEventListener("load",$,{once:!0}),C.addEventListener("error",$,{once:!0}))}})},300)};this.element.readyState>=1?setTimeout(P,200):(this.element.addEventListener("loadedmetadata",P,{once:!0}),setTimeout(P,2e3)),L()},100)});let T=v.length-E.length}}let f=this.sourceElements,b=[];f.forEach(y=>{let v=y.getAttribute("data-desc-src"),E=y.getAttribute("src");if(v){let M=y.getAttribute("type"),w=y.getAttribute("data-orig-src");w||(w=E),b.push({src:v,type:M,origSrc:w,descSrc:v})}else{let M=y.getAttribute("type"),w=y.getAttribute("src");b.push({src:w,type:M,origSrc:null,descSrc:null})}}),f.forEach(y=>{y.remove()}),b.forEach(y=>{let v=document.createElement("source");v.setAttribute("src",y.src),y.type&&v.setAttribute("type",y.type),y.origSrc&&v.setAttribute("data-orig-src",y.origSrc),y.descSrc&&v.setAttribute("data-desc-src",y.descSrc);let E=this.element.querySelector("track");E?this.element.insertBefore(v,E):this.element.appendChild(v)}),this._sourceElementsDirty=!0,this._sourceElementsCache=null,l&&this.element.tagName==="VIDEO"&&(this.element.poster=l),this.element.load(),await new Promise(y=>{let v=()=>{this.element.removeEventListener("loadedmetadata",v),y()};this.element.readyState>=1?y():this.element.addEventListener("loadedmetadata",v)}),await new Promise(y=>setTimeout(y,300)),(i>0||s)&&await new Promise(y=>{let v=()=>{this.element.removeEventListener("canplay",v),this.element.removeEventListener("canplaythrough",v),y()};this.element.readyState>=3?y():(this.element.addEventListener("canplay",v,{once:!0}),this.element.addEventListener("canplaythrough",v,{once:!0}),setTimeout(()=>{this.element.removeEventListener("canplay",v),this.element.removeEventListener("canplaythrough",v),y()},3e3))});let S=i;if(r&&this.captionManager&&this.captionManager.tracks.length>0){await new Promise(v=>setTimeout(v,500));let y=this.findMatchingCaptionTime(r,this.captionManager.tracks);y!==null&&(S=y,this.options.debug&&console.log(`[VidPly] Syncing via caption: ${i}s -> ${S}s`))}if(S>0&&(this.seek(S),await new Promise(y=>setTimeout(y,100))),s?(await this.play(),this.setManagedTimeout(()=>{this.hidePosterOverlay()},100)):(this.pause(),a||this.hidePosterOverlay()),!this._audioDescriptionDesiredState)return;this.state.audioDescriptionEnabled=!0,this.emit("audiodescriptionenabled")}else{if(this.audioDescriptionCaptionTracks.length>0){let m=this.audioDescriptionCaptionTracks.map(async b=>{if(b.trackElement&&b.describedSrc)if(b.explicit===!0)try{let S=await this.validateTrackExists(b.describedSrc);return{trackInfo:b,exists:S}}catch{return{trackInfo:b,exists:!1}}else return{trackInfo:b,exists:!1};return{trackInfo:b,exists:!1}}),f=(await Promise.all(m)).filter(b=>b.exists);if(f.length>0){let b=new Map;f.forEach(({trackInfo:y})=>{let v=y.trackElement.track;v?b.set(y,{wasShowing:v.mode==="showing",wasHidden:v.mode==="hidden"}):b.set(y,{wasShowing:!1,wasHidden:!1})});let S=f.map(({trackInfo:y})=>{let v=y.trackElement.getAttribute("src"),E=y.trackElement.parentNode,M=y.trackElement.nextSibling,w={};return Array.from(y.trackElement.attributes).forEach(T=>{w[T.name]=T.value}),{trackInfo:y,oldSrc:v,parent:E,nextSibling:M,attributes:w}});S.forEach(({trackInfo:y})=>{y.trackElement.remove()}),this.element.load(),setTimeout(()=>{S.forEach(({trackInfo:v,oldSrc:E,parent:M,nextSibling:w,attributes:T})=>{c.push(v);let L=document.createElement("track");L.setAttribute("src",v.describedSrc),Object.keys(T).forEach(P=>{P!=="src"&&P!=="data-desc-src"&&L.setAttribute(P,T[P])}),w&&w.parentNode?M.insertBefore(L,w):M.appendChild(L),v.trackElement=L}),this.element.load();let y=()=>{setTimeout(()=>{c.forEach(v=>{let M=v.trackElement.track;if(M){let w=b.get(v)||{wasShowing:!1,wasHidden:!1};M.mode="hidden";let T=()=>{w.wasShowing||w.wasHidden?M.mode="hidden":M.mode="disabled"};M.readyState>=2?T():(M.addEventListener("load",T,{once:!0}),M.addEventListener("error",T,{once:!0}))}})},300)};this.element.readyState>=1?setTimeout(y,200):(this.element.addEventListener("loadedmetadata",y,{once:!0}),setTimeout(y,2e3))},100)}}let n=this.sourceElements;if(n.some(m=>m.getAttribute("data-desc-src"))){let m=[];n.forEach(g=>{let f=g.getAttribute("data-desc-src"),b=g.getAttribute("src");if(f){let S=g.getAttribute("type"),y=g.getAttribute("data-orig-src");y||(y=b),m.push({src:f,type:S,origSrc:y,descSrc:f})}else{let S=g.getAttribute("type"),y=g.getAttribute("src");m.push({src:y,type:S,origSrc:null,descSrc:null})}}),n.forEach(g=>{g.remove()}),m.forEach(g=>{let f=document.createElement("source");f.setAttribute("src",g.src),g.type&&f.setAttribute("type",g.type),g.origSrc&&f.setAttribute("data-orig-src",g.origSrc),g.descSrc&&f.setAttribute("data-desc-src",g.descSrc),this.element.appendChild(f)}),l&&this.element.tagName==="VIDEO"&&(this.element.poster=l),this.element.load(),this.invalidateTrackCache()}else l&&this.element.tagName==="VIDEO"&&(this.element.poster=l),this.element.src=this.audioDescriptionSrc}await new Promise(n=>{let d=()=>{this.element.removeEventListener("loadedmetadata",d),n()};this.element.readyState>=1?n():this.element.addEventListener("loadedmetadata",d)}),(i>0||s)&&await new Promise(n=>{let d=()=>{this.element.removeEventListener("canplay",d),this.element.removeEventListener("canplaythrough",d),n()};this.element.readyState>=3?n():(this.element.addEventListener("canplay",d,{once:!0}),this.element.addEventListener("canplaythrough",d,{once:!0}),setTimeout(()=>{this.element.removeEventListener("canplay",d),this.element.removeEventListener("canplaythrough",d),n()},3e3))}),this.element.tagName==="VIDEO"&&i===0&&!s&&this.element.readyState>=1&&(this.element.currentTime=.001,this.setManagedTimeout(()=>{this.element.currentTime=0},10));let o=i;if(r&&this.captionManager&&this.captionManager.tracks.length>0){await new Promise(d=>setTimeout(d,500));let n=this.findMatchingCaptionTime(r,this.captionManager.tracks);n!==null&&(o=n,this.options.debug&&console.log(`[VidPly] Syncing via caption: ${i}s -> ${o}s`))}if(o>0&&(this.seek(o),await new Promise(n=>setTimeout(n,100))),s?(await this.play(),this.setManagedTimeout(()=>{this.hidePosterOverlay()},100)):(this.pause(),a||this.hidePosterOverlay()),c.length>0&&this.captionManager){let n=this.state.captionsEnabled,d=null;if(this.captionManager.currentTrack){let g=this.captionManager.tracks.findIndex(f=>f.track===this.captionManager.currentTrack.track);g>=0&&(d={language:this.captionManager.tracks[g].language,kind:this.captionManager.tracks[g].kind})}setTimeout(()=>{if(this.captionManager.tracks=[],this.captionManager.loadTracks(),n&&d&&this.captionManager.tracks.length>0){let g=this.captionManager.tracks.findIndex(f=>f.language===d.language&&f.kind===d.kind);if(g>=0){let f=this.captionManager.tracks[g];if(f.track.readyState>=2)this.captionManager.enable(g);else{let b=()=>{f.track.removeEventListener("load",b),f.track.removeEventListener("error",b),this.captionManager&&this.captionManager.tracks.includes(f)&&this.captionManager.enable(g)};f.track.addEventListener("load",b,{once:!0}),f.track.addEventListener("error",b,{once:!0}),f.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(f)&&this.captionManager.enable(g)},1e3)}}else if(this.captionManager.tracks.length>0){let f=this.captionManager.tracks[0];if(f.track.readyState>=2)this.captionManager.enable(0);else{let b=()=>{f.track.removeEventListener("load",b),f.track.removeEventListener("error",b),this.captionManager&&this.captionManager.tracks.includes(f)&&this.captionManager.enable(0)};f.track.addEventListener("load",b,{once:!0}),f.track.addEventListener("error",b,{once:!0}),f.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(f)&&this.captionManager.enable(0)},1e3)}}}},600)}if(this.transcriptManager&&this.transcriptManager.isVisible){let n=typeof c<"u"?c:[];if(n.length>0){let d=()=>{this.invalidateTrackCache();let g=this.textTracks,f=n.map(y=>{let v=y.trackElement,E=v.getAttribute("src"),M=v.getAttribute("srclang"),w=v.getAttribute("kind"),T=g.find(L=>v.track===L);if(T||(T=g.find(L=>{if(L.language===M&&(L.kind===w||w==="captions"&&L.kind==="subtitles")){let P=this.findTrackElement(L);if(P&&P.getAttribute("src")===E)return!0}return!1})),T){let L=this.findTrackElement(T);if(L&&L.getAttribute("src")!==E)return null}return T}).filter(Boolean);if(f.length===0){this.setManagedTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},1e3);return}f.forEach(y=>{y.mode==="disabled"&&(y.mode="hidden")});let b=0,S=()=>{b++,b>=f.length&&this.setManagedTimeout(()=>{if(this.transcriptManager&&this.transcriptManager.loadTranscriptData){this.invalidateTrackCache();let y=this.textTracks,v=n.map(M=>M.describedSrc);(f.some(M=>{let w=this.findTrackElement(M);return w&&v.includes(w.getAttribute("src"))})||f.length>0)&&this.transcriptManager.loadTranscriptData()}},800)};f.forEach(y=>{y.mode==="disabled"&&(y.mode="hidden");let v=this.findTrackElement(y),E=v?v.getAttribute("src"):null,M=n.find(T=>{let L=T.trackElement;return L&&(L.track===y||L.getAttribute("srclang")===y.language&&L.getAttribute("kind")===y.kind)}),w=M?M.describedSrc:null;if(w&&E&&E!==w){S();return}if(y.readyState>=2&&y.cues&&y.cues.length>0)S();else{y.mode==="disabled"&&(y.mode="hidden");let T=()=>{this.setManagedTimeout(S,300)};y.readyState>=2?this.setManagedTimeout(()=>{y.cues&&y.cues.length>0?S():y.addEventListener("load",T,{once:!0})},100):(y.addEventListener("load",T,{once:!0}),y.addEventListener("error",()=>{S()},{once:!0}))}})};this.setManagedTimeout(()=>{this.element.readyState>=1?d():(this.element.addEventListener("loadedmetadata",d,{once:!0}),this.setManagedTimeout(d,2e3))},500),setTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},5e3)}else setTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},800)}a||this.hidePosterOverlay(),this._audioDescriptionDesiredState&&(this.state.audioDescriptionEnabled=!0,this.emit("audiodescriptionenabled"))}async disableAudioDescription(){if(!this.originalSrc)return;let e=this.element.currentTime,t=this.state.playing,i=null;if(this.captionManager&&this.captionManager.currentTrack){let o=this.captionManager.currentTrack.track;if(o&&o.activeCues&&o.activeCues.length>0){let n=o.activeCues[0];i=this.stripVTTFormatting(n.text)}}let s=this.resolvePosterPath(this.element.getAttribute("poster")||this.element.poster||this.options.poster),a=[];if(this.audioDescriptionCaptionTracks.length>0){let o=this.audioDescriptionCaptionTracks.map(n=>{let d=n.trackElement;if(!d||!d.parentNode)return null;let m=d.parentNode,g=d.nextSibling,f={};return Array.from(d.attributes).forEach(b=>{f[b.name]=b.value}),{trackInfo:n,parent:m,nextSibling:g,attributes:f}}).filter(Boolean);o.forEach(({trackInfo:n})=>{n.trackElement&&n.trackElement.parentNode&&n.trackElement.remove()}),this.element.load(),await new Promise(n=>{setTimeout(()=>{o.forEach(({trackInfo:d,parent:m,nextSibling:g,attributes:f})=>{a.push(d);let b=document.createElement("track");b.setAttribute("src",d.originalTrackSrc),Object.keys(f).forEach(S=>{S!=="src"&&S!=="data-desc-src"&&b.setAttribute(S,f[S])}),d.describedSrc&&b.setAttribute("data-desc-src",d.describedSrc),g&&g.parentNode?m.insertBefore(b,g):m.appendChild(b),d.trackElement=b}),this.invalidateTrackCache(),n()},100)})}let r=this.sourceElements;if(r.some(o=>o.getAttribute("data-orig-src"))){let o=[];r.forEach(n=>{let d=n.getAttribute("data-orig-src"),m=n.getAttribute("data-desc-src");if(d){let g=n.getAttribute("type");o.push({src:d,type:g,origSrc:d,descSrc:m})}else{let g=n.getAttribute("type"),f=n.getAttribute("src");o.push({src:f,type:g,origSrc:null,descSrc:m})}}),r.forEach(n=>{n.remove()}),o.forEach(n=>{let d=document.createElement("source");d.setAttribute("src",n.src),n.type&&d.setAttribute("type",n.type),n.origSrc&&d.setAttribute("data-orig-src",n.origSrc),n.descSrc&&d.setAttribute("data-desc-src",n.descSrc);let m=this.element.querySelector("track");m?this.element.insertBefore(d,m):this.element.appendChild(d)}),this._sourceElementsDirty=!0,this._sourceElementsCache=null,s&&this.element.tagName==="VIDEO"&&(this.element.poster=s),this.element.load()}else{s&&this.element.tagName==="VIDEO"&&(this.element.poster=s);let o=this.originalAudioDescriptionSource||this.originalSrc;this.element.src=o,this.element.load()}await new Promise(o=>{let n=()=>{this.element.removeEventListener("loadedmetadata",n),o()};this.element.readyState>=1?o():this.element.addEventListener("loadedmetadata",n)}),(e>0||t)&&await new Promise(o=>{let n=()=>{this.element.removeEventListener("canplay",n),this.element.removeEventListener("canplaythrough",n),o()};this.element.readyState>=3?o():(this.element.addEventListener("canplay",n,{once:!0}),this.element.addEventListener("canplaythrough",n,{once:!0}),setTimeout(()=>{this.element.removeEventListener("canplay",n),this.element.removeEventListener("canplaythrough",n),o()},3e3))});let c=e;if(i&&this.captionManager&&this.captionManager.tracks.length>0){await new Promise(n=>setTimeout(n,500));let o=this.findMatchingCaptionTime(i,this.captionManager.tracks);o!==null&&(c=o,this.options.debug&&console.log(`[VidPly] Syncing via caption: ${e}s -> ${c}s`))}if(c>0&&(this.seek(c),await new Promise(o=>setTimeout(o,100))),t?(await this.play(),this.hidePosterOverlay()):(this.pause(),!t&&c===0?this.showPosterOverlay():this.hidePosterOverlay()),a.length>0&&this.captionManager){let o=this.state.captionsEnabled,n=null;if(this.captionManager.currentTrack){let m=this.captionManager.tracks.findIndex(g=>g.track===this.captionManager.currentTrack.track);m>=0&&(n={language:this.captionManager.tracks[m].language,kind:this.captionManager.tracks[m].kind})}setTimeout(()=>{if(this.captionManager.tracks=[],this.captionManager.loadTracks(),o&&n&&this.captionManager.tracks.length>0){let m=this.captionManager.tracks.findIndex(g=>g.language===n.language&&g.kind===n.kind);if(m>=0){let g=this.captionManager.tracks[m];if(g.track.readyState>=2)this.captionManager.enable(m);else{let f=()=>{g.track.removeEventListener("load",f),g.track.removeEventListener("error",f),this.captionManager&&this.captionManager.tracks.includes(g)&&this.captionManager.enable(m)};g.track.addEventListener("load",f,{once:!0}),g.track.addEventListener("error",f,{once:!0}),g.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(g)&&this.captionManager.enable(m)},1e3)}}else if(this.captionManager.tracks.length>0){let g=this.captionManager.tracks[0];if(g.track.readyState>=2)this.captionManager.enable(0);else{let f=()=>{g.track.removeEventListener("load",f),g.track.removeEventListener("error",f),this.captionManager&&this.captionManager.tracks.includes(g)&&this.captionManager.enable(0)};g.track.addEventListener("load",f,{once:!0}),g.track.addEventListener("error",f,{once:!0}),g.track.mode="hidden",setTimeout(()=>{this.captionManager&&this.captionManager.tracks.includes(g)&&this.captionManager.enable(0)},1e3)}}}},600)}this.transcriptManager&&this.transcriptManager.isVisible&&this.setManagedTimeout(()=>{this.transcriptManager&&this.transcriptManager.loadTranscriptData&&this.transcriptManager.loadTranscriptData()},500),!this._audioDescriptionDesiredState&&(this.state.audioDescriptionEnabled=!1,this.emit("audiodescriptiondisabled"))}async toggleAudioDescription(){let e=this.findTextTrack("descriptions"),t=this.audioDescriptionSrc||this.sourceElements.some(i=>i.getAttribute("data-desc-src"));if(e&&t)if(this.state.audioDescriptionEnabled)this._audioDescriptionDesiredState=!1,e.mode="hidden",await this.disableAudioDescription();else{this._audioDescriptionDesiredState=!0,await this.enableAudioDescription();let i=()=>{this.invalidateTrackCache();let s=this.findTextTrack("descriptions");s?s.mode==="disabled"?(s.mode="hidden",this.setManagedTimeout(()=>{s.mode="showing"},50)):s.mode="showing":this.element.readyState<2&&this.setManagedTimeout(i,100)};this.element.readyState>=1?this.setManagedTimeout(i,200):this.element.addEventListener("loadedmetadata",()=>{this.setManagedTimeout(i,200)},{once:!0})}else e?e.mode==="showing"?(this._audioDescriptionDesiredState=!1,e.mode="hidden",this.state.audioDescriptionEnabled=!1,this.emit("audiodescriptiondisabled")):(this._audioDescriptionDesiredState=!0,e.mode="showing",this.state.audioDescriptionEnabled=!0,this.emit("audiodescriptionenabled")):t&&(this.state.audioDescriptionEnabled?(this._audioDescriptionDesiredState=!1,await this.disableAudioDescription()):(this._audioDescriptionDesiredState=!0,await this.enableAudioDescription()))}enableSignLanguage(){var o;let e=Object.keys(this.signLanguageSources).length>0,t=!!this.signLanguageSrc;if(!e&&!t){console.warn("No sign language video source provided");return}if(this.signLanguageWrapper){this.signLanguageWrapper.style.display="block",this.state.signLanguageEnabled=!0,this.emit("signlanguageenabled"),this.setManagedTimeout(()=>{this.signLanguageSettingsButton&&document.contains(this.signLanguageSettingsButton)&&this.signLanguageSettingsButton.focus({preventScroll:!0})},150);return}let i=null,s=null;if(e){if(this.captionManager&&this.captionManager.currentTrack){let n=(o=this.captionManager.currentTrack.language)==null?void 0:o.toLowerCase().split("-")[0];n&&this.signLanguageSources[n]&&(i=n,s=this.signLanguageSources[n])}if(!i&&this.options.language){let n=this.options.language.toLowerCase().split("-")[0];this.signLanguageSources[n]&&(i=n,s=this.signLanguageSources[n])}i||(i=Object.keys(this.signLanguageSources)[0],s=this.signLanguageSources[i]),this.currentSignLanguage=i}else s=this.signLanguageSrc;this.signLanguageWrapper=document.createElement("div"),this.signLanguageWrapper.className="vidply-sign-language-wrapper",this.signLanguageWrapper.setAttribute("tabindex","0"),this.signLanguageWrapper.setAttribute("aria-label",h.t("player.signLanguageDragResize")),this.signLanguageHeader=u.createElement("div",{className:`${this.options.classPrefix}-sign-language-header`,attributes:{tabindex:"0"}});let a=u.createElement("div",{className:`${this.options.classPrefix}-sign-language-header-left`}),r=u.createElement("h3",{textContent:h.t("player.signLanguageVideo")});if(this.signLanguageSettingsButton=u.createElement("button",{className:`${this.options.classPrefix}-sign-language-settings`,attributes:{type:"button","aria-label":h.t("player.signLanguageSettings"),"aria-expanded":"false"}}),this.signLanguageSettingsButton.appendChild(k("settings")),this.signLanguageSettingsHandlers={settingsClick:n=>{if(n.preventDefault(),n.stopPropagation(),this.signLanguageDocumentClickHandler){let d=this.signLanguageSettingsMenuJustOpened;this.signLanguageSettingsMenuJustOpened=!0,setTimeout(()=>{this.signLanguageSettingsMenuJustOpened=d},100)}this.signLanguageSettingsMenuVisible?this.hideSignLanguageSettingsMenu():this.showSignLanguageSettingsMenu()},settingsKeydown:n=>{n.key==="d"||n.key==="D"?(n.preventDefault(),n.stopPropagation(),this.toggleSignLanguageKeyboardDragMode()):n.key==="r"||n.key==="R"?(n.preventDefault(),n.stopPropagation(),this.toggleSignLanguageResizeMode()):n.key==="Escape"&&this.signLanguageSettingsMenuVisible&&(n.preventDefault(),n.stopPropagation(),this.hideSignLanguageSettingsMenu())}},this.signLanguageSettingsButton.addEventListener("click",this.signLanguageSettingsHandlers.settingsClick),this.signLanguageSettingsButton.addEventListener("keydown",this.signLanguageSettingsHandlers.settingsKeydown),a.appendChild(this.signLanguageSettingsButton),this.signLanguageSelector=null,e){let n=`${this.options.classPrefix}-sign-language-select-${Date.now()}`,d=Object.keys(this.signLanguageSources).map(b=>({value:b,text:this.getSignLanguageLabel(b),selected:b===i})),{label:m,select:g}=G({classPrefix:this.options.classPrefix,labelClass:`${this.options.classPrefix}-sign-language-label`,selectClass:`${this.options.classPrefix}-sign-language-select`,labelText:"settings.language",selectId:n,options:d,onChange:b=>{b.stopPropagation();let S=b.target.value;this.switchSignLanguage(S)}});this.signLanguageSelector=g;let f=u.createElement("div",{className:`${this.options.classPrefix}-sign-language-selector-wrapper`});f.appendChild(m),f.appendChild(this.signLanguageSelector),J(f),a.appendChild(f)}a.appendChild(r);let l=u.createElement("button",{className:`${this.options.classPrefix}-sign-language-close`,attributes:{type:"button","aria-label":h.t("player.closeSignLanguage")}});l.appendChild(k("close")),l.addEventListener("click",()=>{this.disableSignLanguage(),this.controlBar&&this.controlBar.controls&&this.controlBar.controls.signLanguage&&setTimeout(()=>{this.controlBar.controls.signLanguage.focus({preventScroll:!0})},0)}),this.signLanguageHeader.appendChild(a),this.signLanguageHeader.appendChild(l),this.signLanguageSettingsMenuVisible=!1,this.signLanguageSettingsMenu=null,this.signLanguageSettingsMenuJustOpened=!1,this.signLanguageResizeOptionButton=null,this.signLanguageResizeOptionText=null,this.signLanguageDragOptionButton=null,this.signLanguageDragOptionText=null,this.signLanguageDocumentClickHandler=null,this.signLanguageDocumentClickHandlerAdded=!1,this.signLanguageVideo=document.createElement("video"),this.signLanguageVideo.className="vidply-sign-language-video",this.signLanguageVideo.src=s,this.signLanguageVideo.setAttribute("aria-label",h.t("player.signLanguage")),this.signLanguageVideo.muted=!0,this.signLanguageVideo.setAttribute("playsinline",""),this.signLanguageResizeHandles=["n","s","e","w","ne","nw","se","sw"].map(n=>{let d=u.createElement("div",{className:`${this.options.classPrefix}-sign-resize-handle ${this.options.classPrefix}-sign-resize-${n}`,attributes:{"data-direction":n,"data-vidply-managed-resize":"true","aria-hidden":"true"}});return d.style.display="none",d}),this.signLanguageWrapper.appendChild(this.signLanguageHeader),this.signLanguageWrapper.appendChild(this.signLanguageVideo),this.signLanguageResizeHandles.forEach(n=>this.signLanguageWrapper.appendChild(n));let c=this.storage.getSignLanguagePreferences();c&&c.size&&c.size.width?this.signLanguageWrapper.style.width=c.size.width:this.signLanguageWrapper.style.width="280px",this.signLanguageWrapper.style.height="auto",this.signLanguageDesiredPosition=this.options.signLanguagePosition||"bottom-right",this.container.appendChild(this.signLanguageWrapper),requestAnimationFrame(()=>{this.constrainSignLanguagePosition()}),this.signLanguageVideo.currentTime=this.state.currentTime,this.state.paused||this.signLanguageVideo.play(),this.setupSignLanguageInteraction(),this.signLanguageHandlers={play:()=>{this.signLanguageVideo&&this.signLanguageVideo.play()},pause:()=>{this.signLanguageVideo&&this.signLanguageVideo.pause()},timeupdate:()=>{this.signLanguageVideo&&Math.abs(this.signLanguageVideo.currentTime-this.state.currentTime)>.5&&(this.signLanguageVideo.currentTime=this.state.currentTime)},ratechange:()=>{this.signLanguageVideo&&(this.signLanguageVideo.playbackRate=this.state.playbackSpeed)}},this.on("play",this.signLanguageHandlers.play),this.on("pause",this.signLanguageHandlers.pause),this.on("timeupdate",this.signLanguageHandlers.timeupdate),this.on("ratechange",this.signLanguageHandlers.ratechange),e&&(this.signLanguageHandlers.captionChange=()=>{var n;if(this.captionManager&&this.captionManager.currentTrack&&this.signLanguageSelector){let d=(n=this.captionManager.currentTrack.language)==null?void 0:n.toLowerCase().split("-")[0];d&&this.signLanguageSources[d]&&this.currentSignLanguage!==d&&(this.switchSignLanguage(d),this.signLanguageSelector.value=d)}},this.on("captionsenabled",this.signLanguageHandlers.captionChange)),this.state.signLanguageEnabled=!0,this.emit("signlanguageenabled"),this.setManagedTimeout(()=>{this.signLanguageSettingsButton&&document.contains(this.signLanguageSettingsButton)&&this.signLanguageSettingsButton.focus({preventScroll:!0})},150)}disableSignLanguage(){this.signLanguageSettingsMenuVisible&&this.hideSignLanguageSettingsMenu({focusButton:!1}),this.signLanguageWrapper&&(this.signLanguageWrapper.style.display="none"),this.state.signLanguageEnabled=!1,this.emit("signlanguagedisabled")}toggleSignLanguage(){this.state.signLanguageEnabled?this.disableSignLanguage():this.enableSignLanguage()}setupSignLanguageInteraction(){if(!this.signLanguageWrapper)return;let e=window.innerWidth<768,t=this.state.fullscreen;if(e&&!t){this.signLanguageDraggable&&(this.signLanguageDraggable.destroy(),this.signLanguageDraggable=null);return}this.signLanguageDraggable||(this.signLanguageDraggable=new V(this.signLanguageWrapper,{dragHandle:this.signLanguageHeader,resizeHandles:this.signLanguageResizeHandles,constrainToViewport:!0,maintainAspectRatio:!0,minWidth:150,minHeight:100,classPrefix:`${this.options.classPrefix}-sign`,keyboardDragKey:"d",keyboardResizeKey:"r",keyboardStep:10,keyboardStepLarge:50,pointerResizeIndicatorText:h.t("player.signLanguageResizeActive"),onPointerResizeToggle:i=>{this.signLanguageResizeHandles.forEach(s=>{s.style.display=i?"block":"none"})},onDragStart:i=>!(i.target.closest(`.${this.options.classPrefix}-sign-language-close`)||i.target.closest(`.${this.options.classPrefix}-sign-language-settings`)||i.target.closest(`.${this.options.classPrefix}-sign-language-select`)||i.target.closest(`.${this.options.classPrefix}-sign-language-label`)||i.target.closest(`.${this.options.classPrefix}-sign-language-settings-menu`))}),this.signLanguageCustomKeyHandler=i=>{let s=i.key.toLowerCase();if(!this.signLanguageSettingsMenuVisible){if(s==="home"){i.preventDefault(),i.stopPropagation(),this.signLanguageDraggable&&(this.signLanguageDraggable.pointerResizeMode&&this.signLanguageDraggable.disablePointerResizeMode(),this.signLanguageDraggable.manuallyPositioned=!1,this.constrainSignLanguagePosition());return}if(s==="r"){i.preventDefault(),i.stopPropagation(),this.toggleSignLanguageResizeMode()&&this.signLanguageWrapper.focus({preventScroll:!0});return}if(s==="escape"){if(i.preventDefault(),i.stopPropagation(),this.signLanguageDraggable&&this.signLanguageDraggable.pointerResizeMode){this.signLanguageDraggable.disablePointerResizeMode();return}if(this.signLanguageDraggable&&this.signLanguageDraggable.keyboardDragMode){this.signLanguageDraggable.disableKeyboardDragMode();return}this.disableSignLanguage(),this.controlBar&&this.controlBar.controls&&this.controlBar.controls.signLanguage&&setTimeout(()=>{this.controlBar.controls.signLanguage.focus({preventScroll:!0})},0);return}}},this.signLanguageWrapper.addEventListener("keydown",this.signLanguageCustomKeyHandler),this.signLanguageInteractionHandlers={draggable:this.signLanguageDraggable,headerKeyHandler:this.signLanguageHeaderKeyHandler,customKeyHandler:this.signLanguageCustomKeyHandler})}toggleSignLanguageKeyboardDragMode(){if(this.signLanguageDraggable){let e=this.signLanguageDraggable.keyboardDragMode;this.signLanguageDraggable.toggleKeyboardDragMode();let t=this.signLanguageDraggable.keyboardDragMode;!e&&t&&this.enableSignLanguageMoveMode(),this.updateSignLanguageDragOptionState()}}enableSignLanguageMoveMode(){this.signLanguageWrapper.classList.add(`${this.options.classPrefix}-sign-move-mode`),this.updateSignLanguageResizeOptionState(),setTimeout(()=>{this.signLanguageWrapper.classList.remove(`${this.options.classPrefix}-sign-move-mode`)},2e3)}toggleSignLanguageResizeMode({focus:e=!0}={}){return this.signLanguageDraggable?this.signLanguageDraggable.pointerResizeMode?(this.signLanguageDraggable.disablePointerResizeMode({focus:e}),this.updateSignLanguageResizeOptionState(),!1):(this.signLanguageDraggable.enablePointerResizeMode({focus:e}),this.updateSignLanguageResizeOptionState(),!0):!1}getSignLanguageLabel(e){return{en:"English",de:"Deutsch",es:"Espa\xF1ol",fr:"Fran\xE7ais",it:"Italiano",ja:"\u65E5\u672C\u8A9E",pt:"Portugu\xEAs",ar:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629",hi:"\u0939\u093F\u0928\u094D\u0926\u0940"}[e]||e.toUpperCase()}switchSignLanguage(e){if(!this.signLanguageSources[e]||!this.signLanguageVideo)return;let t=this.signLanguageVideo.currentTime,i=!this.signLanguageVideo.paused;this.signLanguageVideo.src=this.signLanguageSources[e],this.currentSignLanguage=e,this.signLanguageVideo.currentTime=t,i&&this.signLanguageVideo.play().catch(()=>{}),this.emit("signlanguagelanguagechanged",e)}showSignLanguageSettingsMenu(){if(this.signLanguageSettingsMenuJustOpened=!0,setTimeout(()=>{this.signLanguageSettingsMenuJustOpened=!1},350),this.signLanguageDocumentClickHandlerAdded||(this.signLanguageDocumentClickHandler=s=>{this.signLanguageSettingsMenuJustOpened||this.signLanguageSettingsButton&&(this.signLanguageSettingsButton===s.target||this.signLanguageSettingsButton.contains(s.target))||this.signLanguageSettingsMenu&&this.signLanguageSettingsMenu.contains(s.target)||this.signLanguageSettingsMenuVisible&&this.hideSignLanguageSettingsMenu()},setTimeout(()=>{document.addEventListener("mousedown",this.signLanguageDocumentClickHandler,!0),this.signLanguageDocumentClickHandlerAdded=!0},300)),this.signLanguageSettingsMenu){this.signLanguageSettingsMenu.style.display="block",this.signLanguageSettingsMenuVisible=!0,this.signLanguageSettingsButton&&this.signLanguageSettingsButton.setAttribute("aria-expanded","true"),this.signLanguageSettingsMenuKeyHandler=H(this.signLanguageSettingsMenu,this.signLanguageSettingsButton,`.${this.options.classPrefix}-sign-language-settings-item`,()=>this.hideSignLanguageSettingsMenu({focusButton:!0})),this.positionSignLanguageSettingsMenu(),this.updateSignLanguageDragOptionState(),this.updateSignLanguageResizeOptionState(),ae(this.signLanguageSettingsMenu,`.${this.options.classPrefix}-sign-language-settings-item`);return}this.signLanguageSettingsMenu=u.createElement("div",{className:`${this.options.classPrefix}-sign-language-settings-menu`,attributes:{role:"menu"}});let e=A({classPrefix:this.options.classPrefix,itemClass:`${this.options.classPrefix}-sign-language-settings-item`,icon:"move",label:"player.enableSignDragMode",hasTextClass:!0,onClick:()=>{this.toggleSignLanguageKeyboardDragMode(),this.hideSignLanguageSettingsMenu()}});e.setAttribute("role","switch"),e.setAttribute("aria-checked","false"),this.signLanguageDragOptionButton=e,this.signLanguageDragOptionText=e.querySelector(`.${this.options.classPrefix}-settings-text`),this.updateSignLanguageDragOptionState();let t=A({classPrefix:this.options.classPrefix,itemClass:`${this.options.classPrefix}-sign-language-settings-item`,icon:"resize",label:"player.enableSignResizeMode",hasTextClass:!0,onClick:s=>{s.preventDefault(),s.stopPropagation(),this.toggleSignLanguageResizeMode({focus:!1})?(this.hideSignLanguageSettingsMenu({focusButton:!1}),setTimeout(()=>{this.signLanguageWrapper&&this.signLanguageWrapper.focus({preventScroll:!0})},20)):this.hideSignLanguageSettingsMenu({focusButton:!0})}});t.setAttribute("role","switch"),t.setAttribute("aria-checked","false"),this.signLanguageResizeOptionButton=t,this.signLanguageResizeOptionText=t.querySelector(`.${this.options.classPrefix}-settings-text`),this.updateSignLanguageResizeOptionState();let i=A({classPrefix:this.options.classPrefix,itemClass:`${this.options.classPrefix}-sign-language-settings-item`,icon:"close",label:"transcript.closeMenu",onClick:()=>{this.hideSignLanguageSettingsMenu()}});this.signLanguageSettingsMenu.appendChild(e),this.signLanguageSettingsMenu.appendChild(t),this.signLanguageSettingsMenu.appendChild(i),this.signLanguageSettingsMenu.style.visibility="hidden",this.signLanguageSettingsMenu.style.display="block",this.signLanguageSettingsButton&&this.signLanguageSettingsButton.parentNode?this.signLanguageSettingsButton.insertAdjacentElement("afterend",this.signLanguageSettingsMenu):this.signLanguageWrapper&&this.signLanguageWrapper.appendChild(this.signLanguageSettingsMenu),this.positionSignLanguageSettingsMenuImmediate(),requestAnimationFrame(()=>{this.signLanguageSettingsMenu&&(this.signLanguageSettingsMenu.style.visibility="visible")}),this.signLanguageSettingsMenuKeyHandler=H(this.signLanguageSettingsMenu,this.signLanguageSettingsButton,`.${this.options.classPrefix}-sign-language-settings-item`,()=>this.hideSignLanguageSettingsMenu({focusButton:!0})),this.signLanguageSettingsMenuVisible=!0,this.signLanguageSettingsButton&&this.signLanguageSettingsButton.setAttribute("aria-expanded","true"),this.updateSignLanguageDragOptionState(),this.updateSignLanguageResizeOptionState(),ae(this.signLanguageSettingsMenu,`.${this.options.classPrefix}-sign-language-settings-item`)}hideSignLanguageSettingsMenu({focusButton:e=!0}={}){this.signLanguageSettingsMenu&&(this.signLanguageSettingsMenu.style.display="none",this.signLanguageSettingsMenuVisible=!1,this.signLanguageSettingsMenuJustOpened=!1,this.signLanguageSettingsMenuKeyHandler&&(this.signLanguageSettingsMenu.removeEventListener("keydown",this.signLanguageSettingsMenuKeyHandler),this.signLanguageSettingsMenuKeyHandler=null),Array.from(this.signLanguageSettingsMenu.querySelectorAll(`.${this.options.classPrefix}-sign-language-settings-item`)).forEach(i=>{i.setAttribute("tabindex","-1")}),this.signLanguageSettingsButton&&(this.signLanguageSettingsButton.setAttribute("aria-expanded","false"),e&&this.signLanguageSettingsButton.focus({preventScroll:!0})))}positionSignLanguageSettingsMenuImmediate(){if(!this.signLanguageSettingsMenu||!this.signLanguageSettingsButton)return;let e=this.signLanguageSettingsButton.getBoundingClientRect(),t=this.signLanguageSettingsMenu.getBoundingClientRect(),i=window.innerWidth,s=window.innerHeight,a=this.signLanguageSettingsButton.parentElement;if(!a)return;let r=a.getBoundingClientRect(),l=e.left+e.width/2-r.left,c=e.bottom-r.top,o=e.top-r.top,n=e.top,d=s-e.bottom,m=c+8,g=null;d<t.height+20&&n>d?(m=null,g=r.bottom-r.top-o+8,this.signLanguageSettingsMenu.classList.add("vidply-menu-above")):this.signLanguageSettingsMenu.classList.remove("vidply-menu-above");let f=l-t.width/2,b="auto",S="translateX(0)",y=e.left+e.width/2-t.width/2;y<10?(f=0,S="translateX(0)"):y+t.width>i-10?(f="auto",b=0,S="translateX(0)"):(f=l,S="translateX(-50%)"),m!==null?(this.signLanguageSettingsMenu.style.top=`${m}px`,this.signLanguageSettingsMenu.style.bottom="auto"):g!==null&&(this.signLanguageSettingsMenu.style.top="auto",this.signLanguageSettingsMenu.style.bottom=`${g}px`),f!=="auto"?(this.signLanguageSettingsMenu.style.left=`${f}px`,this.signLanguageSettingsMenu.style.right="auto"):(this.signLanguageSettingsMenu.style.left="auto",this.signLanguageSettingsMenu.style.right=`${b}px`),this.signLanguageSettingsMenu.style.transform=S}positionSignLanguageSettingsMenu(){!this.signLanguageSettingsMenu||!this.signLanguageSettingsButton||!this.signLanguageWrapper||requestAnimationFrame(()=>{setTimeout(()=>{this.positionSignLanguageSettingsMenuImmediate()},10)})}attachSignLanguageSettingsMenuKeyboardNavigation(){this.signLanguageSettingsMenu&&(this.signLanguageSettingsMenuKeyHandler&&this.signLanguageSettingsMenu.removeEventListener("keydown",this.signLanguageSettingsMenuKeyHandler),this.signLanguageSettingsMenuKeyHandler=H(this.signLanguageSettingsMenu,this.signLanguageSettingsButton,`.${this.options.classPrefix}-sign-language-settings-item`,()=>this.hideSignLanguageSettingsMenu({focusButton:!0})))}updateSignLanguageDragOptionState(){if(!this.signLanguageDragOptionButton)return;let e=!!(this.signLanguageDraggable&&this.signLanguageDraggable.keyboardDragMode),t=e?h.t("player.disableSignDragMode"):h.t("player.enableSignDragMode"),i=e?h.t("player.disableSignDragModeAria"):h.t("player.enableSignDragModeAria");this.signLanguageDragOptionButton.setAttribute("aria-checked",e?"true":"false"),this.signLanguageDragOptionButton.setAttribute("aria-label",i),this.signLanguageDragOptionButton.setAttribute("title",t),this.signLanguageDragOptionText&&(this.signLanguageDragOptionText.textContent=t)}updateSignLanguageResizeOptionState(){if(!this.signLanguageResizeOptionButton)return;let e=!!(this.signLanguageDraggable&&this.signLanguageDraggable.pointerResizeMode),t=e?h.t("player.disableSignResizeMode"):h.t("player.enableSignResizeMode"),i=e?h.t("player.disableSignResizeModeAria"):h.t("player.enableSignResizeModeAria");this.signLanguageResizeOptionButton.setAttribute("aria-checked",e?"true":"false"),this.signLanguageResizeOptionButton.setAttribute("aria-label",i),this.signLanguageResizeOptionButton.setAttribute("title",t),this.signLanguageResizeOptionText&&(this.signLanguageResizeOptionText.textContent=t)}constrainSignLanguagePosition(){if(!this.signLanguageWrapper||!this.videoWrapper||this.signLanguageDraggable&&this.signLanguageDraggable.manuallyPositioned)return;(!this.signLanguageWrapper.style.width||this.signLanguageWrapper.style.width==="")&&(this.signLanguageWrapper.style.width="280px");let e=this.videoWrapper.getBoundingClientRect(),t=this.container.getBoundingClientRect(),i=this.signLanguageWrapper.getBoundingClientRect(),s=e.left-t.left,a=e.top-t.top,r=e.width,l=e.height,c=i.width||280,o=i.height||280*9/16,n,d,m=16,g=95;switch(this.signLanguageDesiredPosition||"bottom-right"){case"bottom-right":n=s+r-c-m,d=a+l-o-g;break;case"bottom-left":n=s+m,d=a+l-o-g;break;case"top-right":n=s+r-c-m,d=a+m;break;case"top-left":n=s+m,d=a+m;break;default:n=s+r-c-m,d=a+l-o-g}n=Math.max(s,Math.min(n,s+r-c)),d=Math.max(a,Math.min(d,a+l-o-g)),this.signLanguageWrapper.style.left=`${n}px`,this.signLanguageWrapper.style.top=`${d}px`,this.signLanguageWrapper.style.right="auto",this.signLanguageWrapper.style.bottom="auto",this.signLanguageWrapper.classList.remove(...Array.from(this.signLanguageWrapper.classList).filter(b=>b.startsWith("vidply-sign-position-")))}saveSignLanguagePreferences(){this.signLanguageWrapper&&this.storage.saveSignLanguagePreferences({size:{width:this.signLanguageWrapper.style.width}})}cleanupSignLanguage(){this.signLanguageSettingsMenuVisible&&this.hideSignLanguageSettingsMenu({focusButton:!1}),this.signLanguageDocumentClickHandler&&this.signLanguageDocumentClickHandlerAdded&&(document.removeEventListener("mousedown",this.signLanguageDocumentClickHandler,!0),this.signLanguageDocumentClickHandlerAdded=!1,this.signLanguageDocumentClickHandler=null),this.signLanguageSettingsHandlers&&(this.signLanguageSettingsButton&&(this.signLanguageSettingsButton.removeEventListener("click",this.signLanguageSettingsHandlers.settingsClick),this.signLanguageSettingsButton.removeEventListener("keydown",this.signLanguageSettingsHandlers.settingsKeydown)),this.signLanguageSettingsHandlers=null),this.signLanguageHandlers&&(this.off("play",this.signLanguageHandlers.play),this.off("pause",this.signLanguageHandlers.pause),this.off("timeupdate",this.signLanguageHandlers.timeupdate),this.off("ratechange",this.signLanguageHandlers.ratechange),this.signLanguageHandlers.captionChange&&this.off("captionsenabled",this.signLanguageHandlers.captionChange),this.signLanguageHandlers=null),this.signLanguageInteractionHandlers&&(this.signLanguageHeader&&this.signLanguageInteractionHandlers.headerKeyHandler&&this.signLanguageHeader.removeEventListener("keydown",this.signLanguageInteractionHandlers.headerKeyHandler),this.signLanguageWrapper&&this.signLanguageInteractionHandlers.customKeyHandler&&this.signLanguageWrapper.removeEventListener("keydown",this.signLanguageInteractionHandlers.customKeyHandler)),this.signLanguageDraggable&&(this.signLanguageDraggable.pointerResizeMode&&this.signLanguageDraggable.disablePointerResizeMode(),this.signLanguageDraggable.destroy(),this.signLanguageDraggable=null),this.signLanguageInteractionHandlers=null,this.signLanguageWrapper&&this.signLanguageWrapper.parentNode&&(this.signLanguageVideo&&(this.signLanguageVideo.pause(),this.signLanguageVideo.src=""),this.signLanguageWrapper.parentNode.removeChild(this.signLanguageWrapper)),this.signLanguageWrapper=null,this.signLanguageVideo=null,this.signLanguageSettingsButton=null,this.signLanguageSettingsMenu=null}showSettings(){console.warn("[VidPly] Settings dialog has been removed. Use individual control buttons (speed, captions, etc.)")}hideSettings(){}getCurrentTime(){return this.state.currentTime}getDuration(){return this.state.duration}isPlaying(){return this.state.playing}isPaused(){return this.state.paused}isEnded(){return this.state.ended}isMuted(){return this.state.muted}isFullscreen(){return this.state.fullscreen}handleError(e){this.log("Error:",e,"error"),this.emit("error",e),this.options.onError&&this.options.onError.call(this,e)}log(...e){if(!this.options.debug)return;let t="log";if(e.length>0){let i=e[e.length-1];typeof i=="string"&&console[i]&&(t=i,e=e.slice(0,-1))}e.length===0&&(e=[""]),typeof console[t]=="function"?console[t]("[VidPly]",...e):console.log("[VidPly]",...e)}setupResponsiveHandlers(){if(typeof ResizeObserver<"u"?(this.resizeObserver=new ResizeObserver(e=>{for(let t of e){let i=t.contentRect.width;this.controlBar&&typeof this.controlBar.updateControlsForViewport=="function"&&this.controlBar.updateControlsForViewport(i),this.transcriptManager&&this.transcriptManager.isVisible&&this.transcriptManager.positionTranscript()}}),this.resizeObserver.observe(this.container)):(this.resizeHandler=()=>{let e=this.container.clientWidth;this.controlBar&&typeof this.controlBar.updateControlsForViewport=="function"&&this.controlBar.updateControlsForViewport(e),this.transcriptManager&&this.transcriptManager.isVisible&&(!this.transcriptManager.draggableResizable||!this.transcriptManager.draggableResizable.manuallyPositioned)&&this.transcriptManager.positionTranscript()},window.addEventListener("resize",this.resizeHandler)),window.matchMedia){this.orientationHandler=t=>{setTimeout(()=>{this.transcriptManager&&this.transcriptManager.isVisible&&(!this.transcriptManager.draggableResizable||!this.transcriptManager.draggableResizable.manuallyPositioned)&&this.transcriptManager.positionTranscript()},100)};let e=window.matchMedia("(orientation: portrait)");e.addEventListener?e.addEventListener("change",this.orientationHandler):e.addListener&&e.addListener(this.orientationHandler),this.orientationQuery=e}this.fullscreenChangeHandler=()=>{let e=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);this.state.fullscreen!==e&&(this.state.fullscreen=e,e?this.container.classList.add(`${this.options.classPrefix}-fullscreen`):(this.container.classList.remove(`${this.options.classPrefix}-fullscreen`),this._disablePseudoFullscreen()),this.emit("fullscreenchange",e),this.controlBar&&this.controlBar.updateFullscreenButton(),this.signLanguageWrapper&&this.signLanguageWrapper.style.display!=="none"&&(window.innerWidth<768&&this.setupSignLanguageInteraction(),this.setManagedTimeout(()=>{requestAnimationFrame(()=>{this.storage.saveSignLanguagePreferences({size:null}),this.signLanguageDesiredPosition="bottom-right",this.signLanguageWrapper.style.width=e?"400px":"280px",this.constrainSignLanguagePosition()})},500)))},document.addEventListener("fullscreenchange",this.fullscreenChangeHandler),document.addEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),document.addEventListener("mozfullscreenchange",this.fullscreenChangeHandler),document.addEventListener("MSFullscreenChange",this.fullscreenChangeHandler)}destroy(){if(this.log("Destroying player"),this.renderer&&this.renderer.destroy(),this.controlBar&&this.controlBar.destroy(),this.captionManager&&this.captionManager.destroy(),this.keyboardManager&&this.keyboardManager.destroy(),this.transcriptManager&&this.transcriptManager.destroy(),this.cleanupSignLanguage(),this.playButtonOverlay&&this.playButtonOverlay.parentNode&&(this.playButtonOverlay.remove(),this.playButtonOverlay=null),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),this.orientationQuery&&this.orientationHandler&&(this.orientationQuery.removeEventListener?this.orientationQuery.removeEventListener("change",this.orientationHandler):this.orientationQuery.removeListener&&this.orientationQuery.removeListener(this.orientationHandler),this.orientationQuery=null,this.orientationHandler=null),this.fullscreenChangeHandler&&(document.removeEventListener("fullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("mozfullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("MSFullscreenChange",this.fullscreenChangeHandler),this.fullscreenChangeHandler=null),this.timeouts.forEach(e=>clearTimeout(e)),this.timeouts.clear(),this.metadataCueChangeHandler){let t=this.textTracks.find(i=>i.kind==="metadata");t&&t.removeEventListener("cuechange",this.metadataCueChangeHandler),this.metadataCueChangeHandler=null}this.metadataAlertHandlers&&this.metadataAlertHandlers.size>0&&(this.metadataAlertHandlers.forEach(({button:e,handler:t})=>{e&&t&&e.removeEventListener("click",t)}),this.metadataAlertHandlers.clear()),this.container&&this.container.parentNode&&(this.container.parentNode.insertBefore(this.element,this.container),this.container.parentNode.removeChild(this.container)),this.removeAllListeners()}setupMetadataHandling(){let e=()=>{let i=this.textTracks.find(s=>s.kind==="metadata");if(i){if(i.mode==="disabled"&&(i.mode="hidden"),this.metadataCueChangeHandler&&i.removeEventListener("cuechange",this.metadataCueChangeHandler),this.metadataCueChangeHandler=()=>{let s=Array.from(i.activeCues||[]);s.length>0&&this.options.debug&&this.log("[Metadata] Active cues:",s.map(a=>({start:a.startTime,end:a.endTime,text:a.text}))),s.forEach(a=>{this.handleMetadataCue(a)})},i.addEventListener("cuechange",this.metadataCueChangeHandler),this.options.debug){let s=i.cues?i.cues.length:0;this.log("[Metadata] Track enabled,",s,"cues available")}}else this.options.debug&&this.log("[Metadata] No metadata track found")};e(),this.on("loadedmetadata",e)}normalizeMetadataSelector(e){if(!e)return null;let t=e.trim();return t?t.startsWith("#")||t.startsWith(".")||t.startsWith("[")?t:`#${t}`:null}resolveMetadataConfig(e,t){if(!e||!t)return null;if(Object.prototype.hasOwnProperty.call(e,t))return e[t];let i=t.replace(/^#/,"");return Object.prototype.hasOwnProperty.call(e,i)?e[i]:null}cacheMetadataAlertContent(e,t={}){if(!e)return;let i=t.titleSelector||"[data-vidply-alert-title], h3, header",s=t.messageSelector||"[data-vidply-alert-message], p",a=e.querySelector(i);a&&!a.dataset.vidplyAlertTitleOriginal&&(a.dataset.vidplyAlertTitleOriginal=a.textContent.trim());let r=e.querySelector(s);r&&!r.dataset.vidplyAlertMessageOriginal&&(r.dataset.vidplyAlertMessageOriginal=r.textContent.trim())}restoreMetadataAlertContent(e,t={}){if(!e)return;let i=t.titleSelector||"[data-vidply-alert-title], h3, header",s=t.messageSelector||"[data-vidply-alert-message], p",a=e.querySelector(i);a&&a.dataset.vidplyAlertTitleOriginal&&(a.textContent=a.dataset.vidplyAlertTitleOriginal);let r=e.querySelector(s);r&&r.dataset.vidplyAlertMessageOriginal&&(r.textContent=r.dataset.vidplyAlertMessageOriginal)}focusMetadataTarget(e,t=null){var i,s;if(!(!e||e==="none")){if(e==="alert"&&t){t.focus({preventScroll:!0});return}if(e==="player"){this.container&&this.container.focus({preventScroll:!0});return}if(e==="media"){this.element.focus({preventScroll:!0});return}if(e==="playButton"){let a=(s=(i=this.controlBar)==null?void 0:i.controls)==null?void 0:s.playPause;a&&a.focus({preventScroll:!0});return}if(typeof e=="string"){let a=document.querySelector(e);a&&(a.tabIndex===-1&&!a.hasAttribute("tabindex")&&a.setAttribute("tabindex","-1"),a.focus({preventScroll:!0}))}}}handleMetadataAlert(e,t={}){if(!e)return;let i=this.resolveMetadataConfig(this.options.metadataAlerts,e)||{},s=t.element||document.querySelector(e);if(!s){this.options.debug&&this.log("[Metadata] Alert element not found:",e);return}this.options.debug&&this.log("[Metadata] Handling alert",e,{reason:t.reason,config:i}),this.cacheMetadataAlertContent(s,i),s.dataset.vidplyAlertOriginalDisplay||(s.dataset.vidplyAlertOriginalDisplay=s.style.display||""),s.dataset.vidplyAlertDisplay||(s.dataset.vidplyAlertDisplay=i.display||"block");let a=t.show!==void 0?t.show:i.show!==!1;if(a){let o=i.display||s.dataset.vidplyAlertDisplay||"block";s.style.display=o,s.hidden=!1,s.removeAttribute("hidden"),s.setAttribute("aria-hidden","false"),s.setAttribute("data-vidply-alert-active","true")}i.resetContent!==!1&&t.reason==="focus"&&this.restoreMetadataAlertContent(s,i);let l=t.focus!==void 0?t.focus:i.focusOnShow??t.reason!=="focus";a&&l&&(s.tabIndex===-1&&!s.hasAttribute("tabindex")&&s.setAttribute("tabindex","-1"),s.focus({preventScroll:!0})),a&&i.autoScroll!==!1&&t.autoScroll!==!1&&s.scrollIntoView({behavior:"smooth",block:"nearest"});let c=i.continueButton;if(c){let o=null;if(c==="self"||s.matches(c)?o=s:o=s.querySelector(c)||document.querySelector(c),o&&!this.metadataAlertHandlers.has(e)){let n=()=>{if(i.hideOnContinue!==!1){let g=s.dataset.vidplyAlertOriginalDisplay||"";s.style.display=i.hideDisplay||g||"none",s.setAttribute("aria-hidden","true"),s.removeAttribute("data-vidply-alert-active")}i.resume!==!1&&this.state.paused&&this.play();let m=i.focusTarget||"playButton";this.setManagedTimeout(()=>{this.focusMetadataTarget(m,s)},i.focusDelay??100)};o.addEventListener("click",n),this.metadataAlertHandlers.set(e,{button:o,handler:n})}}return s}handleMetadataHashtags(e){if(!Array.isArray(e)||e.length===0)return;let t=this.options.metadataHashtags;t&&e.forEach(i=>{let s=this.resolveMetadataConfig(t,i);if(!s)return;let a=this.normalizeMetadataSelector(s.alert||s.selector||s.target);if(!a)return;let r=document.querySelector(a);if(!r){this.options.debug&&this.log("[Metadata] Hashtag target not found:",a);return}if(this.options.debug&&this.log("[Metadata] Handling hashtag",i,{selector:a,config:s}),this.cacheMetadataAlertContent(r,s),s.title){let o=s.titleSelector||"[data-vidply-alert-title], h3, header",n=r.querySelector(o);n&&(n.textContent=s.title)}if(s.message){let o=s.messageSelector||"[data-vidply-alert-message], p",n=r.querySelector(o);n&&(n.textContent=s.message)}let l=s.show!==!1,c=s.focus!==void 0?s.focus:!1;this.handleMetadataAlert(a,{element:r,show:l,focus:c,autoScroll:s.autoScroll,reason:"hashtag"})})}handleMetadataCue(e){let t=e.text.trim();this.options.debug&&this.log("[Metadata] Processing cue:",{time:e.startTime,text:t}),this.emit("metadata",{time:e.startTime,endTime:e.endTime,text:t,cue:e}),t.includes("PAUSE")&&(this.state.paused||(this.options.debug&&this.log("[Metadata] Pausing video at",e.startTime),this.pause()),this.emit("metadata:pause",{time:e.startTime,text:t}));let i=t.match(/FOCUS:([\w#-]+)/);if(i){let a=i[1],r=this.normalizeMetadataSelector(a),l=r?document.querySelector(r):null;l?(this.options.debug&&this.log("[Metadata] Focusing element:",r),l.tabIndex===-1&&!l.hasAttribute("tabindex")&&l.setAttribute("tabindex","-1"),this.setManagedTimeout(()=>{l.focus({preventScroll:!0})},10)):this.options.debug&&this.log("[Metadata] Element not found:",r||a),this.emit("metadata:focus",{time:e.startTime,target:a,selector:r,element:l,text:t}),r&&this.handleMetadataAlert(r,{element:l,reason:"focus"})}let s=t.match(/#[\w-]+/g);s&&(this.options.debug&&this.log("[Metadata] Hashtags found:",s),this.emit("metadata:hashtags",{time:e.startTime,hashtags:s,text:t}),this.handleMetadataHashtags(s))}};F.instances=[];var Le=0,re=class{constructor(e,t={}){this.player=e,this.tracks=[],this.currentIndex=-1,this.instanceId=++Le,this.uniqueId=`vidply-playlist-${this.instanceId}`,this.options={autoAdvance:t.autoAdvance!==!1,autoPlayFirst:t.autoPlayFirst!==!1,loop:t.loop||!1,showPanel:t.showPanel!==!1,...t},this.container=null,this.playlistPanel=null,this.trackInfoElement=null,this.navigationFeedback=null,this.isPanelVisible=this.options.showPanel!==!1,this.isChangingTrack=!1,this.handleTrackEnd=this.handleTrackEnd.bind(this),this.handleTrackError=this.handleTrackError.bind(this),this.player.playlistManager=this,this.init(),this.updatePlayerControls(),t.tracks&&Array.isArray(t.tracks)&&this.loadPlaylist(t.tracks)}init(){this.player.on("ended",this.handleTrackEnd),this.player.on("error",this.handleTrackError),this.player.on("play",this.handlePlaybackStateChange.bind(this)),this.player.on("pause",this.handlePlaybackStateChange.bind(this)),this.player.on("ended",this.handlePlaybackStateChange.bind(this)),this.player.on("fullscreenchange",this.handleFullscreenChange.bind(this)),this.player.on("audiodescriptionenabled",this.handleAudioDescriptionChange.bind(this)),this.player.on("audiodescriptiondisabled",this.handleAudioDescriptionChange.bind(this)),this.options.showPanel&&this.createUI(),this.tracks.length===0&&this.loadPlaylistFromAttribute()}loadPlaylistFromAttribute(){if(!this.player.element||!this.player.element.parentElement){console.log("VidPly Playlist: No player element found");return}let t=this.player.element.parentElement.parentElement,i=t?t.parentElement:null;if(!i){console.log("VidPly Playlist: No original element found");return}this.loadOptionsFromAttributes(i);let s=i.getAttribute("data-playlist");if(!s){console.log("VidPly Playlist: No data-playlist attribute found");return}console.log("VidPly Playlist: Found data-playlist attribute, parsing...");try{let a=JSON.parse(s);Array.isArray(a)&&a.length>0?(console.log(`VidPly Playlist: Loaded ${a.length} tracks from data-playlist`),this.loadPlaylist(a)):console.warn("VidPly Playlist: data-playlist is not a valid array or is empty")}catch(a){console.error("VidPly Playlist: Failed to parse data-playlist attribute",a)}}loadOptionsFromAttributes(e){let t=e.getAttribute("data-playlist-auto-advance");t!==null&&(this.options.autoAdvance=t==="true");let i=e.getAttribute("data-playlist-auto-play-first");i!==null&&(this.options.autoPlayFirst=i==="true");let s=e.getAttribute("data-playlist-loop");s!==null&&(this.options.loop=s==="true");let a=e.getAttribute("data-playlist-show-panel");a!==null&&(this.options.showPanel=a==="true"),console.log("VidPly Playlist: Options from attributes:",this.options)}updatePlayerControls(){if(!this.player.controlBar)return;let e=this.player.controlBar;e.element.innerHTML="",e.createControls(),e.attachEvents(),e.setupAutoHide()}loadPlaylist(e){this.tracks=e,this.currentIndex=-1,this.container&&this.container.classList.add("vidply-has-playlist"),this.playlistPanel&&this.renderPlaylist(),e.length>0&&(this.options.autoPlayFirst?this.play(0):this.loadTrack(0)),this.updatePlaylistVisibilityInFullscreen()}loadTrack(e){if(e<0||e>=this.tracks.length){console.warn("VidPly Playlist: Invalid track index",e);return}let t=this.tracks[e];this.isChangingTrack=!0,this.currentIndex=e,this.player.load({src:t.src,type:t.type,poster:t.poster,tracks:t.tracks||[],audioDescriptionSrc:t.audioDescriptionSrc||null,signLanguageSrc:t.signLanguageSrc||null}),this.updateTrackInfo(t),this.updatePlaylistUI(),this.player.emit("playlisttrackchange",{index:e,item:t,total:this.tracks.length}),setTimeout(()=>{this.isChangingTrack=!1},150)}play(e,t=!1){if(e<0||e>=this.tracks.length){console.warn("VidPly Playlist: Invalid track index",e);return}let i=this.tracks[e];this.isChangingTrack=!0,this.currentIndex=e,this.player.load({src:i.src,type:i.type,poster:i.poster,tracks:i.tracks||[],audioDescriptionSrc:i.audioDescriptionSrc||null,signLanguageSrc:i.signLanguageSrc||null}),this.updateTrackInfo(i),this.updatePlaylistUI(),this.player.emit("playlisttrackchange",{index:e,item:i,total:this.tracks.length}),setTimeout(()=>{this.player.play(),setTimeout(()=>{this.isChangingTrack=!1},50)},100)}next(){let e=this.currentIndex+1;if(e>=this.tracks.length)if(this.options.loop)e=0;else return;this.play(e)}previous(){let e=this.currentIndex-1;if(e<0)if(this.options.loop)e=this.tracks.length-1;else return;this.play(e)}handleTrackEnd(){this.isChangingTrack||this.options.autoAdvance&&this.next()}handleTrackError(e){console.error("VidPly Playlist: Track error",e),this.options.autoAdvance&&setTimeout(()=>{this.next()},1e3)}handlePlaybackStateChange(){this.updatePlaylistVisibilityInFullscreen()}handleFullscreenChange(){setTimeout(()=>{this.updatePlaylistVisibilityInFullscreen()},50)}handleAudioDescriptionChange(){let e=this.getCurrentTrack();e&&(this.updateTrackInfo(e),this.updatePlaylistUI(),this.updatePlaylistDurations())}updatePlaylistDurations(){if(!this.playlistPanel)return;this.playlistPanel.querySelectorAll(".vidply-playlist-item").forEach((t,i)=>{let s=this.tracks[i];if(!s)return;let a=this.getEffectiveDuration(s),r=a?x.formatTime(a):"",l=t.querySelector(".vidply-playlist-duration-badge");l&&(l.textContent=r);let c=t.querySelector(".vidply-playlist-item-duration");c&&(c.textContent=r)})}getEffectiveDuration(e){return e?this.player.state.audioDescriptionEnabled&&e.audioDescriptionDuration?e.audioDescriptionDuration:e.duration||null:null}updatePlaylistVisibilityInFullscreen(){if(!this.playlistPanel||!this.tracks.length)return;let e=this.player.state.fullscreen,t=this.player.state.playing;e?t?(this.playlistPanel.classList.remove("vidply-playlist-fullscreen-visible"),setTimeout(()=>{this.player.state.playing&&this.player.state.fullscreen&&(this.playlistPanel.style.display="none")},300)):(this.playlistPanel.classList.add("vidply-playlist-fullscreen-visible"),this.playlistPanel.style.display="block"):(this.playlistPanel.classList.remove("vidply-playlist-fullscreen-visible"),this.isPanelVisible&&this.tracks.length>0?this.playlistPanel.style.display="block":this.playlistPanel.style.display="none")}createUI(){if(this.container=this.player.container,!this.container){console.warn("VidPly Playlist: No container found");return}if(this.player.element.tagName==="AUDIO"){this.trackArtworkElement=u.createElement("div",{className:"vidply-track-artwork",attributes:{"aria-hidden":"true"}}),this.trackArtworkElement.style.display="none";let e=this.container.querySelector(".vidply-video-wrapper");e?this.container.insertBefore(this.trackArtworkElement,e):this.container.appendChild(this.trackArtworkElement)}this.trackInfoElement=u.createElement("div",{className:"vidply-track-info",attributes:{role:"status","aria-live":"polite","aria-atomic":"true"}}),this.trackInfoElement.style.display="none",this.container.appendChild(this.trackInfoElement),this.navigationFeedback=u.createElement("div",{className:"vidply-sr-only",attributes:{role:"status","aria-live":"polite","aria-atomic":"true"}}),this.container.appendChild(this.navigationFeedback),this.playlistPanel=u.createElement("div",{className:"vidply-playlist-panel",attributes:{id:`${this.uniqueId}-panel`,role:"region","aria-label":h.t("playlist.title"),"aria-labelledby":`${this.uniqueId}-heading`}}),this.playlistPanel.style.display=(this.isPanelVisible,"none"),this.container.appendChild(this.playlistPanel)}updateTrackInfo(e){if(!this.trackInfoElement)return;let t=this.currentIndex+1,i=this.tracks.length,s=e.title||h.t("playlist.untitled"),a=e.artist||"",r=this.getEffectiveDuration(e),l=r?x.formatTime(r):"",c=r?x.formatDuration(r):"",o=a?h.t("playlist.by")+a:"",n=c?`. ${c}`:"",d=h.t("playlist.nowPlaying",{current:t,total:i,title:s,artist:o})+n,m=h.t("playlist.trackOf",{current:t,total:i}),g=l?`<span class="vidply-track-duration" aria-hidden="true">${u.escapeHTML(l)}</span>`:"",f=e.description||"";this.trackInfoElement.innerHTML=`
      <span class="vidply-sr-only">${u.escapeHTML(d)}</span>
      <div class="vidply-track-header" aria-hidden="true">
        <span class="vidply-track-number">${u.escapeHTML(m)}</span>
        ${g}
      </div>
      <div class="vidply-track-title" aria-hidden="true">${u.escapeHTML(s)}</div>
      ${a?`<div class="vidply-track-artist" aria-hidden="true">${u.escapeHTML(a)}</div>`:""}
      ${f?`<div class="vidply-track-description" aria-hidden="true">${u.escapeHTML(f)}</div>`:""}
    `,this.trackInfoElement.style.display="block",this.updateTrackArtwork(e)}updateTrackArtwork(e){this.trackArtworkElement&&(e.poster?(this.trackArtworkElement.style.backgroundImage=`url(${e.poster})`,this.trackArtworkElement.style.display="block"):this.trackArtworkElement.style.display="none")}renderPlaylist(){if(!this.playlistPanel)return;this.playlistPanel.innerHTML="";let e=u.createElement("h2",{className:"vidply-playlist-header",attributes:{id:`${this.uniqueId}-heading`}});e.textContent=`${h.t("playlist.title")} (${this.tracks.length})`,this.playlistPanel.appendChild(e);let t=u.createElement("div",{className:"vidply-sr-only",attributes:{id:`${this.uniqueId}-keyboard-instructions`}});t.textContent="Playlist navigation: Use Up and Down arrow keys to move between tracks. Press Page Up or Page Down to skip 5 tracks. Press Home to go to first track, End to go to last track. Press Enter or Space to play the selected track.",this.playlistPanel.appendChild(t);let i=u.createElement("ul",{className:"vidply-playlist-list",attributes:{"aria-labelledby":`${this.uniqueId}-heading`,"aria-describedby":`${this.uniqueId}-keyboard-instructions`}});this.tracks.forEach((s,a)=>{let r=this.createPlaylistItem(s,a);i.appendChild(r)}),this.playlistPanel.appendChild(i),this.isPanelVisible&&(this.playlistPanel.style.display="block")}createPlaylistItem(e,t){let i=h.t("playlist.trackOf",{current:t+1,total:this.tracks.length}),s=e.title||h.t("playlist.trackUntitled",{number:t+1}),a=e.artist?h.t("playlist.by")+e.artist:"",r=this.getEffectiveDuration(e),l=r?x.formatTime(r):"",c=r?x.formatDuration(r):"",o=t===this.currentIndex,n=o?h.t("playlist.currentlyPlaying"):h.t("playlist.notPlaying"),d=o?h.t("playlist.pressEnterRestart"):h.t("playlist.pressEnterPlay"),m=`${i}. ${s}${a}.`;c&&(m+=` ${c}.`),m+=` ${n}. ${d}.`;let g=u.createElement("li",{className:o?"vidply-playlist-item vidply-playlist-item-active":"vidply-playlist-item",attributes:{"data-playlist-index":t}}),f=u.createElement("button",{className:"vidply-playlist-item-button",attributes:{type:"button",tabIndex:t===0?0:-1,"aria-label":m,"aria-posinset":t+1,"aria-setsize":this.tracks.length}});o&&(f.setAttribute("aria-current","true"),f.setAttribute("tabIndex","0"));let b=u.createElement("span",{className:"vidply-playlist-thumbnail-container",attributes:{"aria-hidden":"true"}}),S=u.createElement("span",{className:"vidply-playlist-thumbnail"});if(e.poster)S.style.backgroundImage=`url(${e.poster})`;else{let w=k("music");w.classList.add("vidply-playlist-thumbnail-icon"),S.appendChild(w)}if(b.appendChild(S),l&&e.poster){let w=u.createElement("span",{className:"vidply-playlist-duration-badge"});w.textContent=l,b.appendChild(w)}f.appendChild(b);let y=u.createElement("span",{className:"vidply-playlist-item-info",attributes:{"aria-hidden":"true"}}),v=u.createElement("span",{className:"vidply-playlist-item-title-row"}),E=u.createElement("span",{className:"vidply-playlist-item-title"});if(E.textContent=s,v.appendChild(E),l&&!e.poster){let w=u.createElement("span",{className:"vidply-playlist-item-duration"});w.textContent=l,v.appendChild(w)}if(y.appendChild(v),e.artist){let w=u.createElement("span",{className:"vidply-playlist-item-artist"});w.textContent=e.artist,y.appendChild(w)}if(e.description){let w=u.createElement("span",{className:"vidply-playlist-item-description"});w.textContent=e.description,y.appendChild(w)}f.appendChild(y);let M=k("play");return M.classList.add("vidply-playlist-item-icon"),M.setAttribute("aria-hidden","true"),f.appendChild(M),f.addEventListener("click",()=>{this.play(t,!0)}),f.addEventListener("keydown",w=>{this.handlePlaylistItemKeydown(w,t)}),g.appendChild(f),g}handlePlaylistItemKeydown(e,t){let i=Array.from(this.playlistPanel.querySelectorAll(".vidply-playlist-item-button")),s=-1,a="";switch(e.key){case"Enter":case" ":e.preventDefault(),e.stopPropagation(),this.play(t,!0);return;case"ArrowDown":e.preventDefault(),e.stopPropagation(),t<i.length-1?s=t+1:a=`End of playlist. ${i.length} of ${i.length}.`;break;case"ArrowUp":e.preventDefault(),e.stopPropagation(),t>0?s=t-1:a="Beginning of playlist. 1 of "+i.length+".";break;case"PageDown":e.preventDefault(),e.stopPropagation(),s=Math.min(t+5,i.length-1),s===i.length-1&&t!==s&&(a=`Jumped to last track. ${s+1} of ${i.length}.`);break;case"PageUp":e.preventDefault(),e.stopPropagation(),s=Math.max(t-5,0),s===0&&t!==s&&(a=`Jumped to first track. 1 of ${i.length}.`);break;case"Home":e.preventDefault(),e.stopPropagation(),s=0,t!==0&&(a=`First track. 1 of ${i.length}.`);break;case"End":e.preventDefault(),e.stopPropagation(),s=i.length-1,t!==i.length-1&&(a=`Last track. ${i.length} of ${i.length}.`);break}s!==-1&&s!==t&&(i[t].setAttribute("tabIndex","-1"),i[s].setAttribute("tabIndex","0"),i[s].focus({preventScroll:!0})),a&&this.navigationFeedback&&(this.navigationFeedback.textContent=a,setTimeout(()=>{this.navigationFeedback&&(this.navigationFeedback.textContent="")},1e3))}updatePlaylistUI(){if(!this.playlistPanel)return;let e=this.playlistPanel.querySelectorAll(".vidply-playlist-item"),t=this.playlistPanel.querySelectorAll(".vidply-playlist-item-button");e.forEach((i,s)=>{let a=t[s];if(!a)return;let r=this.tracks[s],l=h.t("playlist.trackOf",{current:s+1,total:this.tracks.length}),c=r.title||h.t("playlist.trackUntitled",{number:s+1}),o=r.artist?h.t("playlist.by")+r.artist:"",n=this.getEffectiveDuration(r),d=n?x.formatDuration(n):"";if(s===this.currentIndex){i.classList.add("vidply-playlist-item-active"),a.setAttribute("aria-current","true"),a.setAttribute("tabIndex","0");let m=h.t("playlist.currentlyPlaying"),g=h.t("playlist.pressEnterRestart"),f=`${l}. ${c}${o}.`;d&&(f+=` ${d}.`),f+=` ${m}. ${g}.`,a.setAttribute("aria-label",f),i.scrollIntoView({behavior:"smooth",block:"nearest"})}else{i.classList.remove("vidply-playlist-item-active"),a.removeAttribute("aria-current"),a.setAttribute("tabIndex","-1");let m=h.t("playlist.notPlaying"),g=h.t("playlist.pressEnterPlay"),f=`${l}. ${c}${o}.`;d&&(f+=` ${d}.`),f+=` ${m}. ${g}.`,a.setAttribute("aria-label",f)}})}getCurrentTrack(){return this.tracks[this.currentIndex]||null}getPlaylistInfo(){return{currentIndex:this.currentIndex,totalTracks:this.tracks.length,currentTrack:this.getCurrentTrack(),hasNext:this.hasNext(),hasPrevious:this.hasPrevious()}}hasNext(){return this.options.loop?!0:this.currentIndex<this.tracks.length-1}hasPrevious(){return this.options.loop?!0:this.currentIndex>0}addTrack(e){this.tracks.push(e),this.playlistPanel&&this.renderPlaylist()}removeTrack(e){e<0||e>=this.tracks.length||(this.tracks.splice(e,1),e<this.currentIndex?this.currentIndex--:e===this.currentIndex&&(this.currentIndex>=this.tracks.length&&(this.currentIndex=this.tracks.length-1),this.currentIndex>=0&&this.play(this.currentIndex)),this.playlistPanel&&this.renderPlaylist())}clear(){this.tracks=[],this.currentIndex=-1,this.playlistPanel&&(this.playlistPanel.innerHTML="",this.playlistPanel.style.display="none"),this.trackInfoElement&&(this.trackInfoElement.innerHTML="",this.trackInfoElement.style.display="none"),this.trackArtworkElement&&(this.trackArtworkElement.style.backgroundImage="",this.trackArtworkElement.style.display="none")}togglePanel(e){return this.playlistPanel?((e!==void 0?e:this.playlistPanel.style.display==="none")?(this.playlistPanel.style.display="block",this.isPanelVisible=!0,this.tracks.length>0&&setTimeout(()=>{let i=this.playlistPanel.querySelector('.vidply-playlist-item[tabindex="0"]');i&&i.focus({preventScroll:!0})},100),this.player.controlBar&&this.player.controlBar.controls.playlistToggle&&(this.player.controlBar.controls.playlistToggle.setAttribute("aria-expanded","true"),this.player.controlBar.controls.playlistToggle.setAttribute("aria-pressed","true"))):(this.playlistPanel.style.display="none",this.isPanelVisible=!1,this.player.controlBar&&this.player.controlBar.controls.playlistToggle&&(this.player.controlBar.controls.playlistToggle.setAttribute("aria-expanded","false"),this.player.controlBar.controls.playlistToggle.setAttribute("aria-pressed","false"),this.player.controlBar.controls.playlistToggle.focus({preventScroll:!0}))),this.isPanelVisible):!1}showPanel(){return this.togglePanel(!0)}hidePanel(){return this.togglePanel(!1)}destroy(){this.player.off("ended",this.handleTrackEnd),this.player.off("error",this.handleTrackError),this.trackArtworkElement&&this.trackArtworkElement.remove(),this.trackInfoElement&&this.trackInfoElement.remove(),this.playlistPanel&&this.playlistPanel.remove(),this.clear()}};function fe(){document.querySelectorAll("[data-vidply]").forEach(e=>{let t=e.dataset.vidplyOptions?JSON.parse(e.dataset.vidplyOptions):{},s={...Ee(e.dataset),...t};new F(e,s)})}function Ee(p){let e={},t={signLanguageSrc:"signLanguageSrc",signLanguageButton:"signLanguageButton",signLanguagePosition:"signLanguagePosition",audioDescriptionSrc:"audioDescriptionSrc",audioDescriptionButton:"audioDescriptionButton",autoplay:"autoplay",loop:"loop",muted:"muted",controls:"controls",poster:"poster",width:"width",height:"height",language:"language",captions:"captions",captionsDefault:"captionsDefault",transcript:"transcript",transcriptButton:"transcriptButton",keyboard:"keyboard",responsive:"responsive",pipButton:"pipButton",fullscreenButton:"fullscreenButton"};Object.keys(t).forEach(s=>{let a=t[s],r=p[s];r!==void 0&&(r==="true"?e[a]=!0:r==="false"?e[a]=!1:!isNaN(r)&&r!==""?e[a]=Number(r):e[a]=r)});let i={};if(Object.keys(p).forEach(s=>{if(s.startsWith("signLanguageSrc")&&s!=="signLanguageSrc"){let a=s.match(/^signLanguageSrc([A-Z][a-z]*)$/);if(a){let r=a[1].toLowerCase();i[r]=p[s]}}}),Object.keys(i).length>0&&(e.signLanguageSources=i,p.signLanguageSrc&&!e.signLanguageSrc&&(e.signLanguageSrc=p.signLanguageSrc)),p.vidplyLanguageFiles)try{e.languageFiles=JSON.parse(p.vidplyLanguageFiles)}catch(s){console.warn("Invalid JSON in data-vidply-language-files:",s)}if(p.vidplyLanguageFile)try{let s=JSON.parse(p.vidplyLanguageFile);typeof s=="object"&&s!==null&&(e.languageFiles=s)}catch{p.vidplyLanguageFileCode&&p.vidplyLanguageFileUrl&&(e.languageFile=p.vidplyLanguageFileCode,e.languageFileUrl=p.vidplyLanguageFileUrl)}else p.vidplyLanguageFileCode&&p.vidplyLanguageFileUrl&&(e.languageFile=p.vidplyLanguageFileCode,e.languageFileUrl=p.vidplyLanguageFileUrl);return e}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",fe):fe();var si=F;export{F as Player,re as PlaylistManager,si as default};
